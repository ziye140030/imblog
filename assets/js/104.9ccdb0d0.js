(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{452:function(t,e,r){"use strict";r.r(e);var v=r(0),o=Object(v.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("GlusterFS文件存储介绍")]),t._v(" "),e("p",[t._v("原文链接：https://www.viayc.com/categories/GlusterFS/")]),t._v(" "),e("p",[e("strong",[t._v("说明")])]),t._v(" "),e("p",[e("strong",[t._v("简介")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1234567891011")]),t._v(" "),e("th",[t._v("GlusterFS 是 Scale-Out 存储解决方案 Gluster 的核心，它是一个开源的分布式文件系统， 具有强大的横向扩展能力，通过扩展能够支持数 PB 存储容量和处理数千客户端。 GlusterFS 借助 TCP/IP 或 InfiniBand RDMA 网络将物理分布的存储资源聚集在一起，使用单一全局命名空间来管理数据。 GlusterFS 基于可堆叠的用户空间设计，可为各种不同的数据负载提供优异的性能。 GlusterFS 支持运行在任何 IP 网络上的标准应用程序的标准客户端，用户可以在全局统一的命名空间中使用 NFS/CIFS 等标准协议来访问应用数据。 GlusterFS 使得用户可摆脱原有的独立、高成本的封闭存储系统，能够利用普通廉价的存储设备来部署可集中管理、横向扩展、虚拟化的存储池，存储容量可扩展至 TB/PB 级。 目前 GlusterFS 已被 Red Hat 收购，它的官网是：https://www.gluster.org/")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[e("strong",[t._v("GlusterFS 在企业中的应用场景")])]),t._v(" "),e("p",[t._v("理论和实践上分析，GlusterFS 目前主要适用于大文件存储场景，对于小文件尤其是海量小文件，存储效率和访问性能都表现不佳。建议存放文件大小大于 1MB")]),t._v(" "),e("p",[e("strong",[t._v("GlusterFS 安装")])]),t._v(" "),e("p",[e("strong",[t._v("环境说明")])]),t._v(" "),e("ul",[e("li",[t._v("CentOS 7")]),t._v(" "),e("li",[t._v("GlusterFS")])]),t._v(" "),e("p",[t._v("3 台机器安装 GlusterFS 组成一个集群。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("12345678910111213")]),t._v(" "),e("th",[t._v("服务器：10.1.0.1110.1.0.1210.1.0.13 配置 hosts 10.1.0.11 manager10.1.0.12 node-110.1.0.13 node-2 client:10.1.0.10 client")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[e("strong",[t._v("安装 GlusterFS")])]),t._v(" "),e("p",[t._v("CentOS 安装 GlusterFS 非常的简单")]),t._v(" "),e("p",[t._v("在三个节点都安装 GlusterFS")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("12345")]),t._v(" "),e("th",[t._v("# 安装 GlusterFS yum 源文件#yum install centos-release-gluster # 安装 GlusterFS 软件yum install -y glusterfs glusterfs-server glusterfs-fuse glusterfs-rdma")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("启动 GlusterFS")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1234567891011121314")]),t._v(" "),e("th",[t._v("[root@manager ~]#systemctl start glusterd.service[root@manager ~]#systemctl enable glusterd.service[root@manager ~]#systemctl status glusterd.service● glusterd.service - GlusterFS, a clustered file-system server  Loaded: loaded (/usr/lib/systemd/system/glusterd.service; disabled; vendor preset: disabled)  Active: active (running) since 一 2017-02-27 17:55:56 CST; 11s ago Process: 5476 ExecStart=/usr/sbin/glusterd -p /var/run/glusterd.pid --log-level $LOG_LEVEL $GLUSTERD_OPTIONS (code=exited, status=0/SUCCESS)Main PID: 5477 (glusterd) Memory: 15.0M CGroup: /system.slice/glusterd.service        └─5477 /usr/sbin/glusterd -p /var/run/glusterd.pid --log-level INFO 2 月 27 17:55:56 meetbill systemd[1]: Starting GlusterFS, a clustered file-system server...2 月 27 17:55:56 meetbill systemd[1]: Started GlusterFS, a clustered file-system server.")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[e("strong",[t._v("配置 GlusterFS")])]),t._v(" "),e("p",[t._v("在 manager 节点上配置，将 节点 加入到 集群中。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("12345678")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster peer probe managerpeer probe: success. Probe on localhost not needed [root@manager ~]#gluster peer probe node-1peer probe: success. [root@manager ~]#gluster peer probe node-2peer probe: success.")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("查看集群状态：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("12345678910")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster peer statusNumber of Peers: 2 Hostname: node-1Uuid: 41573e8b-eb00-4802-84f0-f923a2c7be79State: Peer in Cluster (Connected) Hostname: node-2Uuid: da068e0b-eada-4a50-94ff-623f630986d7State: Peer in Cluster (Connected)")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("创建数据存储目录：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("123")]),t._v(" "),e("th",[t._v("[root@manager ~]#mkdir -p /opt/gluster/data[root@node-1 ~]# mkdir -p /opt/gluster/data[root@node-2 ~]# mkdir -p /opt/gluster/data")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("查看 volume 状态：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("12")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume infoNo volumes present")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[e("strong",[t._v("volume 模式说明")])]),t._v(" "),e("p",[t._v("一、 默认模式，既 DHT, 也叫 分布卷：将文件已 hash 算法随机分布到 一台服务器节点中存储。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("gluster volume create test-volume server1:/exp1 server2:/exp2")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("二、 复制模式，既 AFR, 创建 volume 时带 replica x 数量：将文件复制到 replica x 个节点中。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("gluster volume create test-volume replica 2 transport tcp server1:/exp1 server2:/exp2")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("三、 条带模式，既 Striped, 创建 volume 时带 stripe x 数量： 将文件切割成数据块，分别存储到 stripe x 个节点中 ( 类似 raid 0 )。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("gluster volume create test-volume stripe 2 transport tcp server1:/exp1 server2:/exp2")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("四、 分布式条带模式（组合型），最少需要 4 台服务器才能创建。 创建 volume 时 stripe 2 server = 4 个节点： 是 DHT 与 Striped 的组合型。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("gluster volume create test-volume stripe 2 transport tcp server1:/exp1 server2:/exp2 server3:/exp3 server4:/exp4")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("五、 分布式复制模式（组合型）, 最少需要 4 台服务器才能创建。 创建 volume 时 replica 2 server = 4 个节点：是 DHT 与 AFR 的组合型。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("gluster volume create test-volume replica 2 transport tcp server1:/exp1 server2:/exp2　server3:/exp3 server4:/exp4")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("六、 条带复制卷模式（组合型）, 最少需要 4 台服务器才能创建。 创建 volume 时 stripe 2 replica 2 server = 4 个节点： 是 Striped 与 AFR 的组合型。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("gluster volume create test-volume stripe 2 replica 2 transport tcp server1:/exp1 server2:/exp2 server3:/exp3 server4:/exp4")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("七、 三种模式混合，至少需要 8 台 服务器才能创建。 stripe 2 replica 2 , 每 4 个节点 组成一个 组。")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("gluster volume create test-volume stripe 2 replica 2 transport tcp server1:/exp1 server2:/exp2 server3:/exp3 server4:/exp4 server5:/exp5 server6:/exp6 server7:/exp7 server8:/exp8")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[e("strong",[t._v("创建 GlusterFS 磁盘")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("12")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume create models replica 3 manager:/opt/gluster/data node-1:/opt/gluster/data node-2:/opt/gluster/data forcevolume create: models: success: please start the volume to access data")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("再查看 volume 状态：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1234567891011121314")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume info Volume Name: modelsType: ReplicateVolume ID: e539ff3b-2278-4f3f-a594-1f101eabbf1eStatus: CreatedNumber of Bricks: 1 x 3 = 3Transport-type: tcpBricks:Brick1: manager:/opt/gluster/dataBrick2: node-1:/opt/gluster/dataBrick3: node-2:/opt/gluster/dataOptions Reconfigured:performance.readdir-ahead: on")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("启动 models")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("12")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume start modelsvolume start: models: success")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[e("strong",[t._v("GlusterFS 客户端")])]),t._v(" "),e("p",[t._v("部署 GlusterFS 客户端并 mount GlusterFS 文件系统")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("123")]),t._v(" "),e("th",[t._v("[root@client ~]#yum install -y glusterfs glusterfs-fuse[root@client ~]#mkdir -p /opt/gfsmnt[root@client ~]#mount -t glusterfs manager:models /opt/gfsmnt/")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1234567891011")]),t._v(" "),e("th",[t._v("[root@node-94 ~]#df -h文件系统 容量 已用 可用 已用 % 挂载点/dev/mapper/vg001-root 98G 1.2G 97G 2% /devtmpfs 32G 0 32G 0% /devtmpfs 32G 0 32G 0% /dev/shmtmpfs 32G 130M 32G 1% /runtmpfs 32G 0 32G 0% /sys/fs/cgroup/dev/mapper/vg001-opt 441G 71G 370G 17% /opt/dev/sda2 497M 153M 344M 31% /boottmpfs 6.3G 0 6.3G 0% /run/user/0manager:models 441G 18G 424G 4% /opt/gfsmnt")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[e("strong",[t._v("维护")])]),t._v(" "),e("ol",[e("li",[t._v("查看 GlusterFS 中所有的 volume:")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume list")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("ol",[e("li",[t._v("删除 GlusterFS 磁盘：")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("12")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume stop models   #停止名字为 models 的磁盘[root@manager ~]#gluster volume delete models #删除名字为 models 的磁盘")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("注： 删除 磁盘 以后，必须删除 磁盘 ( /opt/gluster/data ) 中的 （ .glusterfs/ .trashcan/ ）目录。")]),t._v(" "),e("p",[t._v("否则创建新 volume 相同的 磁盘 会出现文件 不分布，或者 类型 错乱 的问题。")]),t._v(" "),e("ol",[e("li",[t._v("卸载某个节点 GlusterFS 磁盘")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster peer detach node-2")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("ol",[e("li",[t._v("设置访问限制，按照每个 volume 来限制")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume set models auth.allow 10.6.0."),e("em",[t._v(",10.7.0.")])])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("ol",[e("li",[t._v("添加 GlusterFS 节点：")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("12")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster peer probe node-3[root@manager ~]#gluster volume add-brick models node-3:/opt/gluster/data")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("注：如果是复制卷或者条带卷，则每次添加的 Brick 数必须是 replica 或者 stripe 的整数倍")]),t._v(" "),e("ol",[e("li",[t._v("配置卷")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("[root@manager ~]# gluster volume set")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("ol",[e("li",[t._v("缩容 volume:")])]),t._v(" "),e("p",[t._v("先将数据迁移到其它可用的 Brick，迁移结束后才将该 Brick 移除：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume remove-brick models node-2:/opt/gluster/data node-3:/opt/gluster/data start")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("在执行了 start 之后，可以使用 status 命令查看移除进度：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume remove-brick models node-2:/opt/gluster/data node-3:/opt/gluster/data status")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("不进行数据迁移，直接删除该 Brick：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume remove-brick models node-2:/opt/gluster/data node-3:/opt/gluster/data commit")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("注意，如果是复制卷或者条带卷，则每次移除的 Brick 数必须是 replica 或者 stripe 的整数倍。")]),t._v(" "),e("p",[t._v("扩容：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("gluster volume add-brick models node-2:/opt/gluster/data")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("ol",[e("li",[t._v("修复命令：")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume replace-brick models node-2:/opt/gluster/data node-3:/opt/gluster/data commit -force")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("ol",[e("li",[t._v("迁移 volume:")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume replace-brick models node-2:/opt/gluster/data node-3:/opt/gluster/data start")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("pause 为暂停迁移")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume replace-brick models node-2:/opt/gluster/data node-3:/opt/gluster/data pause")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("abort 为终止迁移")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume replace-brick models node-2:/opt/gluster/data node-3:/opt/gluster/data abort")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("status 查看迁移状态")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume replace-brick models node-2:/opt/gluster/data node-3:/opt/gluster/data status")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("迁移结束后使用 commit 来生效")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("1")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume replace-brick models node-2:/opt/gluster/data node-3:/opt/gluster/data commit")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])]),t._v(" "),e("ol",[e("li",[t._v("均衡 volume:")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("12345")]),t._v(" "),e("th",[t._v("[root@manager ~]#gluster volume models lay-outstart[root@manager ~]#gluster volume models start[root@manager ~]#gluster volume models startforce[root@manager ~]#gluster volume models status[root@manager ~]#gluster volume models stop")])])]),t._v(" "),e("tbody",[e("tr",[e("td"),t._v(" "),e("td")])])])])}),[],!1,null,null,null);e.default=o.exports}}]);