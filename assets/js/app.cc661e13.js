(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[]]);!function(n){function e(e){for(var o,r,i=e[0],l=e[1],c=e[2],d=0,m=[];d<i.length;d++)r=i[d],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&m.push(a[r][0]),a[r]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(n[o]=l[o]);for(p&&p(e);m.length;)m.shift()();return s.push.apply(s,c||[]),t()}function t(){for(var n,e=0;e<s.length;e++){for(var t=s[e],o=!0,i=1;i<t.length;i++){var l=t[i];0!==a[l]&&(o=!1)}o&&(s.splice(e--,1),n=r(r.s=t[0]))}return n}var o={},a={1:0},s=[];function r(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.e=function(n){var e=[],t=a[n];if(0!==t)if(t)e.push(t[2]);else{var o=new Promise((function(e,o){t=a[n]=[e,o]}));e.push(t[2]=o);var s,i=document.createElement("script");i.charset="utf-8",i.timeout=120,r.nc&&i.setAttribute("nonce",r.nc),i.src=function(n){return r.p+"assets/js/"+({}[n]||n)+"."+{2:"5530ac35",3:"0352ef92",4:"eef75fb3",5:"ff0128d3",6:"9233c8ba",7:"6ac946b2",8:"6ac87516",9:"110e5553",10:"2d0df2a5",11:"5eca3f4f",12:"000e424f",13:"d35f48a7",14:"d21bcc14",15:"bb17458d",16:"8ba4b22c",17:"5c165ba6",18:"39fda8a3",19:"31bca7fe",20:"2647de20",21:"44bb34ac",22:"045c3eec",23:"71a82ea5",24:"27169789",25:"2c50d526",26:"b04032a5",27:"5f0f85c8",28:"9824180b",29:"d8a04e43",30:"b2c233b5",31:"cef434d1",32:"b1abe5c1",33:"00dc451a",34:"252282a6",35:"fbd57bac",36:"a9407b64",37:"c44a5298",38:"976712a7",39:"cd572f10",40:"38b41e51",41:"e4ca8e43",42:"13c9d4af",43:"b03d9849",44:"8398e8cf",45:"ec632fdc",46:"dd574d55",47:"ab623724",48:"34ea7aa2",49:"0a0b9eb7",50:"65692633",51:"d9dde319",52:"bc5cf8a3",53:"aa1f302d",54:"541e7bff",55:"64453af7",56:"5f2660ae",57:"4b2c03e7",58:"333ef6f4",59:"50c18168",60:"d91921c3",61:"5ecf9fc6",62:"85909a07",63:"0f9b17f6",64:"f734321b",65:"4f36c96b",66:"9405b55d",67:"a294d0a3",68:"3f539faa",69:"8b833214",70:"42add28d",71:"da59fb0c",72:"c5db2036",73:"355c1bbf",74:"b37cbbce",75:"cc8bf69e",76:"b1ca7f2e",77:"10f40ba5",78:"ccd6927f",79:"87ae66c0",80:"ff648a8c",81:"e00fed98",82:"abc72fcf",83:"39b970d8",84:"dc5bc5f6",85:"7dfc87e4",86:"1830134e",87:"85a74bcc",88:"7e5782e1",89:"e90e0d13",90:"2354d1f3",91:"5458d664",92:"12fca424",93:"37139e21",94:"966d3bdb",95:"9c44c86e",96:"36fa2e18",97:"acd3e8c6",98:"ddcf4b1a",99:"a2d5af04",100:"d2864acc",101:"299ca1f8",102:"3e135c28",103:"bce6619e",104:"9ccdb0d0",105:"4f76a5e1",106:"189480e1",107:"537609be",108:"481d9c6a",109:"a8c1085a",110:"f8270c34",111:"bafa5b75",112:"6094cd5f",113:"79ca4714",114:"b001833b",115:"e6070513",116:"666ddd03",117:"4a256a2b",118:"f1e3ea77",119:"e2c3254a",120:"e54f57d6",121:"8070e5e3",122:"3664033b",123:"22ebac4e",124:"f22556ce",125:"07d5d849",126:"2b6eea89",127:"05fd3232",128:"07108ccf",129:"77d20ad5",130:"e48c927a",131:"349fa17d",132:"c92f3d4b",133:"5162df80",134:"5e15d059",135:"1ebe9412",136:"29b44c8e",137:"0511ba65",138:"0360d58e",139:"52117293",140:"8303166a",141:"c886b9b3",142:"2d4d36c5",143:"482b783c",144:"5ff5f2ab",145:"8da4569b",146:"61829b48",147:"58814577",148:"65c2b04b"}[n]+".js"}(n);var l=new Error;s=function(e){i.onerror=i.onload=null,clearTimeout(c);var t=a[n];if(0!==t){if(t){var o=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src;l.message="Loading chunk "+n+" failed.\n("+o+": "+s+")",l.name="ChunkLoadError",l.type=o,l.request=s,t[1](l)}a[n]=void 0}};var c=setTimeout((function(){s({type:"timeout",target:i})}),12e4);i.onerror=i.onload=s,document.head.appendChild(i)}return Promise.all(e)},r.m=n,r.c=o,r.d=function(n,e,t){r.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},r.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,e){if(1&e&&(n=r(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)r.d(t,o,function(e){return n[e]}.bind(null,o));return t},r.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(e,"a",e),e},r.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},r.p="/",r.oe=function(n){throw console.error(n),n};var i=window.webpackJsonp=window.webpackJsonp||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var p=l;s.push([107,0]),t()}([function(n,e,t){"use strict";function o(n,e,t,o,a,s,r,i){var l,c="function"==typeof n?n.options:n;if(e&&(c.render=e,c.staticRenderFns=t,c._compiled=!0),o&&(c.functional=!0),s&&(c._scopeId="data-v-"+s),r?(l=function(n){(n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(n=__VUE_SSR_CONTEXT__),a&&a.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(r)},c._ssrRegister=l):a&&(l=i?function(){a.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:a),l)if(c.functional){c._injectStyles=l;var p=c.render;c.render=function(n,e){return l.call(e),p(n,e)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:n,options:c}}t.d(e,"a",(function(){return o}))},function(n,e,t){var o=t(56),a=o.all;n.exports=o.IS_HTMLDDA?function(n){return"function"==typeof n||n===a}:function(n){return"function"==typeof n}},function(n,e,t){var o=t(29),a=Function.prototype,s=a.call,r=o&&a.bind.bind(s,s);n.exports=o?r:function(n){return function(){return s.apply(n,arguments)}}},function(n,e){var t=function(n){return n&&n.Math==Math&&n};n.exports=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof global&&global)||function(){return this}()||Function("return this")()},function(n,e){n.exports=function(n){try{return!!n()}catch(n){return!0}}},function(n,e,t){var o=t(4);n.exports=!o((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(n,e){var t=Array.isArray;n.exports=t},function(n,e,t){var o=t(2),a=t(33),s=o({}.hasOwnProperty);n.exports=Object.hasOwn||function(n,e){return s(a(n),e)}},function(n,e,t){var o=t(70),a="object"==typeof self&&self&&self.Object===Object&&self,s=o||a||Function("return this")();n.exports=s},function(n,e,t){var o=t(1),a=t(56),s=a.all;n.exports=a.IS_HTMLDDA?function(n){return"object"==typeof n?null!==n:o(n)||n===s}:function(n){return"object"==typeof n?null!==n:o(n)}},function(n,e,t){var o=t(167),a=t(170);n.exports=function(n,e){var t=a(n,e);return o(t)?t:void 0}},function(n,e,t){"use strict";t.d(e,"e",(function(){return o})),t.d(e,"b",(function(){return s})),t.d(e,"j",(function(){return r})),t.d(e,"g",(function(){return l})),t.d(e,"h",(function(){return c})),t.d(e,"i",(function(){return p})),t.d(e,"c",(function(){return d})),t.d(e,"f",(function(){return m})),t.d(e,"l",(function(){return u})),t.d(e,"m",(function(){return h})),t.d(e,"d",(function(){return b})),t.d(e,"k",(function(){return f})),t.d(e,"n",(function(){return y})),t.d(e,"a",(function(){return v}));t(18);const o=/#.*$/,a=/\.(md|html)$/,s=/\/$/,r=/^[a-z]+:/i;function i(n){return decodeURI(n).replace(o,"").replace(a,"")}function l(n){return r.test(n)}function c(n){return/^mailto:/.test(n)}function p(n){return/^tel:/.test(n)}function d(n){if(l(n))return n;if(!n)return"404";const e=n.match(o),t=e?e[0]:"",a=i(n);return s.test(a)?n:a+".html"+t}function m(n,e){const t=n.hash,a=function(n){const e=n&&n.match(o);if(e)return e[0]}(e);if(a&&t!==a)return!1;return i(n.path)===i(e)}function u(n,e,t){if(l(e))return{type:"external",path:e};t&&(e=function(n,e,t){const o=n.charAt(0);if("/"===o)return n;if("?"===o||"#"===o)return e+n;const a=e.split("/");t&&a[a.length-1]||a.pop();const s=n.replace(/^\//,"").split("/");for(let n=0;n<s.length;n++){const e=s[n];".."===e?a.pop():"."!==e&&a.push(e)}""!==a[0]&&a.unshift("");return a.join("/")}(e,t));const o=i(e);for(let e=0;e<n.length;e++)if(i(n[e].regularPath)===o)return Object.assign({},n[e],{type:"page",path:d(n[e].path)});return console.error(`[vuepress] No matching page found for sidebar item "${e}"`),{}}function h(n,e,t,o){const{pages:a,themeConfig:s}=t,r=o&&s.locales&&s.locales[o]||s;if("auto"===(n.frontmatter.sidebar||r.sidebar||s.sidebar))return g(n);const i=r.sidebar||s.sidebar;if(i){const{base:t,config:o}=function(n,e){if(Array.isArray(e))return{base:"/",config:e};for(const o in e)if(0===(t=n,/(\.html|\/)$/.test(t)?t:t+"/").indexOf(encodeURI(o)))return{base:o,config:e[o]};var t;return{}}(e,i);return"auto"===o?g(n):o?o.map(n=>function n(e,t,o,a=1){if("string"==typeof e)return u(t,e,o);if(Array.isArray(e))return Object.assign(u(t,e[0],o),{title:e[1]});{a>3&&console.error("[vuepress] detected a too deep nested sidebar group.");const s=e.children||[];return 0===s.length&&e.path?Object.assign(u(t,e.path,o),{title:e.title}):{type:"group",path:e.path,title:e.title,sidebarDepth:e.sidebarDepth,initialOpenGroupIndex:e.initialOpenGroupIndex,children:s.map(e=>n(e,t,o,a+1)),collapsable:!1!==e.collapsable}}}(n,a,t)):[]}return[]}function g(n){const e=b(n.headers||[]);return[{type:"group",collapsable:!1,title:n.title,path:null,children:e.map(e=>({type:"auto",title:e.title,basePath:n.path,path:n.path+"#"+e.slug,children:e.children||[]}))}]}function b(n){let e;return(n=n.map(n=>Object.assign({},n))).forEach(n=>{2===n.level?e=n:e&&(e.children||(e.children=[])).push(n)}),n.filter(n=>2===n.level)}function f(n){return Object.assign(n,{type:n.items&&n.items.length?"links":"link"})}function y(n){return Object.prototype.toString.call(n).match(/\[object (.*?)\]/)[1].toLowerCase()}function _(n){let e=n.frontmatter.date||n.lastUpdated||new Date,t=new Date(e);return"Invalid Date"==t&&e&&(t=new Date(e.replace(/-/g,"/"))),t.getTime()}function v(n,e){return _(e)-_(n)}},function(n,e){n.exports=function(n){return null!=n&&"object"==typeof n}},function(n,e,t){var o=t(5),a=t(65),s=t(102),r=t(28),i=t(55),l=TypeError,c=Object.defineProperty,p=Object.getOwnPropertyDescriptor;e.f=o?s?function(n,e,t){if(r(n),e=i(e),r(t),"function"==typeof n&&"prototype"===e&&"value"in t&&"writable"in t&&!t.writable){var o=p(n,e);o&&o.writable&&(n[e]=t.value,t={configurable:"configurable"in t?t.configurable:o.configurable,enumerable:"enumerable"in t?t.enumerable:o.enumerable,writable:!1})}return c(n,e,t)}:c:function(n,e,t){if(r(n),e=i(e),r(t),a)try{return c(n,e,t)}catch(n){}if("get"in t||"set"in t)throw l("Accessors not supported");return"value"in t&&(n[e]=t.value),n}},function(n,e,t){var o=t(16),a=t(152),s=t(153),r=o?o.toStringTag:void 0;n.exports=function(n){return null==n?void 0===n?"[object Undefined]":"[object Null]":r&&r in Object(n)?a(n):s(n)}},function(n,e,t){var o=t(5),a=t(13),s=t(36);n.exports=o?function(n,e,t){return a.f(n,e,s(1,t))}:function(n,e,t){return n[e]=t,n}},function(n,e,t){var o=t(8).Symbol;n.exports=o},function(n){n.exports=JSON.parse('{"name":"vuepress-plugin-vdoing-comment","version":"1.0.7","description":"Comment plugin in vuepress vdoing theme, supports Gitalk, Valine, Artalk...","main":"index.js","scripts":{"test":"echo \\"Error: no test specified\\" && exit 1"},"repository":{"type":"git","url":"git+ssh://git@github.com/terwer/vuepress-plugin-vdoing-comment.git"},"keywords":["vuepress","comment","plugin","vue","gitalk","valine","artalk"],"author":"terwer","license":"MIT","bugs":{"url":"https://github.com/terwer/vuepress-plugin-vdoing-comment/issues"},"homepage":"https://github.com/terwer/vuepress-plugin-vdoing-comment/blob/main/README.md","dependencies":{"ejs":"^3.1.8","gitalk":"^1.5.0","gitalk-fix":"^1.5.2","i":"^0.3.6","npm":"^6.9.0","valine":"^1.3.9","artalk":"^2.4.4"}}')},function(n,e,t){"use strict";var o=t(19),a=t(33),s=t(34),r=t(132),i=t(134);o({target:"Array",proto:!0,arity:1,forced:t(4)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(n){return n instanceof TypeError}}()},{push:function(n){var e=a(this),t=s(e),o=arguments.length;i(t+o);for(var l=0;l<o;l++)e[t]=arguments[l],t++;return r(e,t),t}})},function(n,e,t){var o=t(3),a=t(52).f,s=t(15),r=t(115),i=t(38),l=t(66),c=t(128);n.exports=function(n,e){var t,p,d,m,u,h=n.target,g=n.global,b=n.stat;if(t=g?o:b?o[h]||i(h,{}):(o[h]||{}).prototype)for(p in e){if(m=e[p],d=n.dontCallGetSet?(u=a(t,p))&&u.value:t[p],!c(g?p:h+(b?".":"#")+p,n.forced)&&void 0!==d){if(typeof m==typeof d)continue;l(m,d)}(n.sham||d&&d.sham)&&s(m,"sham",!0),r(t,p,m,n)}}},function(n,e,t){var o=t(2),a=o({}.toString),s=o("".slice);n.exports=function(n){return s(a(n),8,-1)}},function(n,e,t){var o=t(3),a=t(62),s=t(7),r=t(64),i=t(60),l=t(59),c=o.Symbol,p=a("wks"),d=l?c.for||c:c&&c.withoutSetter||r;n.exports=function(n){return s(p,n)||(p[n]=i&&s(c,n)?c[n]:d("Symbol."+n)),p[n]}},function(n,e,t){var o=t(157),a=t(158),s=t(159),r=t(160),i=t(161);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var o=n[e];this.set(o[0],o[1])}}l.prototype.clear=o,l.prototype.delete=a,l.prototype.get=s,l.prototype.has=r,l.prototype.set=i,n.exports=l},function(n,e,t){var o=t(72);n.exports=function(n,e){for(var t=n.length;t--;)if(o(n[t][0],e))return t;return-1}},function(n,e,t){var o=t(10)(Object,"create");n.exports=o},function(n,e,t){var o=t(179);n.exports=function(n,e){var t=n.__data__;return o(e)?t["string"==typeof e?"string":"hash"]:t.map}},function(n,e,t){var o=t(46);n.exports=function(n){if("string"==typeof n||o(n))return n;var e=n+"";return"0"==e&&1/n==-1/0?"-0":e}},function(n,e,t){var o,a;
/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */void 0===(a="function"==typeof(o=function(){var n,e,t={version:"0.2.0"},o=t.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function a(n,e,t){return n<e?e:n>t?t:n}function s(n){return 100*(-1+n)}t.configure=function(n){var e,t;for(e in n)void 0!==(t=n[e])&&n.hasOwnProperty(e)&&(o[e]=t);return this},t.status=null,t.set=function(n){var e=t.isStarted();n=a(n,o.minimum,1),t.status=1===n?null:n;var l=t.render(!e),c=l.querySelector(o.barSelector),p=o.speed,d=o.easing;return l.offsetWidth,r((function(e){""===o.positionUsing&&(o.positionUsing=t.getPositioningCSS()),i(c,function(n,e,t){var a;return(a="translate3d"===o.positionUsing?{transform:"translate3d("+s(n)+"%,0,0)"}:"translate"===o.positionUsing?{transform:"translate("+s(n)+"%,0)"}:{"margin-left":s(n)+"%"}).transition="all "+e+"ms "+t,a}(n,p,d)),1===n?(i(l,{transition:"none",opacity:1}),l.offsetWidth,setTimeout((function(){i(l,{transition:"all "+p+"ms linear",opacity:0}),setTimeout((function(){t.remove(),e()}),p)}),p)):setTimeout(e,p)})),this},t.isStarted=function(){return"number"==typeof t.status},t.start=function(){t.status||t.set(0);var n=function(){setTimeout((function(){t.status&&(t.trickle(),n())}),o.trickleSpeed)};return o.trickle&&n(),this},t.done=function(n){return n||t.status?t.inc(.3+.5*Math.random()).set(1):this},t.inc=function(n){var e=t.status;return e?("number"!=typeof n&&(n=(1-e)*a(Math.random()*e,.1,.95)),e=a(e+n,0,.994),t.set(e)):t.start()},t.trickle=function(){return t.inc(Math.random()*o.trickleRate)},n=0,e=0,t.promise=function(o){return o&&"resolved"!==o.state()?(0===e&&t.start(),n++,e++,o.always((function(){0==--e?(n=0,t.done()):t.set((n-e)/n)})),this):this},t.render=function(n){if(t.isRendered())return document.getElementById("nprogress");c(document.documentElement,"nprogress-busy");var e=document.createElement("div");e.id="nprogress",e.innerHTML=o.template;var a,r=e.querySelector(o.barSelector),l=n?"-100":s(t.status||0),p=document.querySelector(o.parent);return i(r,{transition:"all 0 linear",transform:"translate3d("+l+"%,0,0)"}),o.showSpinner||(a=e.querySelector(o.spinnerSelector))&&m(a),p!=document.body&&c(p,"nprogress-custom-parent"),p.appendChild(e),e},t.remove=function(){p(document.documentElement,"nprogress-busy"),p(document.querySelector(o.parent),"nprogress-custom-parent");var n=document.getElementById("nprogress");n&&m(n)},t.isRendered=function(){return!!document.getElementById("nprogress")},t.getPositioningCSS=function(){var n=document.body.style,e="WebkitTransform"in n?"Webkit":"MozTransform"in n?"Moz":"msTransform"in n?"ms":"OTransform"in n?"O":"";return e+"Perspective"in n?"translate3d":e+"Transform"in n?"translate":"margin"};var r=function(){var n=[];function e(){var t=n.shift();t&&t(e)}return function(t){n.push(t),1==n.length&&e()}}(),i=function(){var n=["Webkit","O","Moz","ms"],e={};function t(t){return t=t.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(n,e){return e.toUpperCase()})),e[t]||(e[t]=function(e){var t=document.body.style;if(e in t)return e;for(var o,a=n.length,s=e.charAt(0).toUpperCase()+e.slice(1);a--;)if((o=n[a]+s)in t)return o;return e}(t))}function o(n,e,o){e=t(e),n.style[e]=o}return function(n,e){var t,a,s=arguments;if(2==s.length)for(t in e)void 0!==(a=e[t])&&e.hasOwnProperty(t)&&o(n,t,a);else o(n,s[1],s[2])}}();function l(n,e){return("string"==typeof n?n:d(n)).indexOf(" "+e+" ")>=0}function c(n,e){var t=d(n),o=t+e;l(t,e)||(n.className=o.substring(1))}function p(n,e){var t,o=d(n);l(n,e)&&(t=o.replace(" "+e+" "," "),n.className=t.substring(1,t.length-1))}function d(n){return(" "+(n.className||"")+" ").replace(/\s+/gi," ")}function m(n){n&&n.parentNode&&n.parentNode.removeChild(n)}return t})?o.call(e,t,e,n):o)||(n.exports=a)},function(n,e,t){var o=t(9),a=String,s=TypeError;n.exports=function(n){if(o(n))return n;throw s(a(n)+" is not an object")}},function(n,e,t){var o=t(4);n.exports=!o((function(){var n=function(){}.bind();return"function"!=typeof n||n.hasOwnProperty("prototype")}))},function(n,e,t){var o=t(48),a=t(53);n.exports=function(n){return o(a(n))}},function(n,e,t){var o=t(3),a=t(1),s=function(n){return a(n)?n:void 0};n.exports=function(n,e){return arguments.length<2?s(o[n]):o[n]&&o[n][e]}},function(n,e,t){var o=t(1),a=t(113),s=TypeError;n.exports=function(n){if(o(n))return n;throw s(a(n)+" is not a function")}},function(n,e,t){var o=t(53),a=Object;n.exports=function(n){return a(o(n))}},function(n,e,t){var o=t(126);n.exports=function(n){return o(n.length)}},function(n,e,t){var o=t(29),a=Function.prototype.call;n.exports=o?a.bind(a):function(){return a.apply(a,arguments)}},function(n,e){n.exports=function(n,e){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:e}}},function(n,e,t){var o=t(3),a=t(38),s=o["__core-js_shared__"]||a("__core-js_shared__",{});n.exports=s},function(n,e,t){var o=t(3),a=Object.defineProperty;n.exports=function(n,e){try{a(o,n,{value:e,configurable:!0,writable:!0})}catch(t){o[n]=e}return e}},function(n,e,t){var o=t(151),a=t(12),s=Object.prototype,r=s.hasOwnProperty,i=s.propertyIsEnumerable,l=o(function(){return arguments}())?o:function(n){return a(n)&&r.call(n,"callee")&&!i.call(n,"callee")};n.exports=l},function(n,e,t){var o=t(10)(t(8),"Map");n.exports=o},function(n,e){n.exports=function(n){var e=typeof n;return null!=n&&("object"==e||"function"==e)}},function(n,e,t){var o=t(171),a=t(178),s=t(180),r=t(181),i=t(182);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var o=n[e];this.set(o[0],o[1])}}l.prototype.clear=o,l.prototype.delete=a,l.prototype.get=s,l.prototype.has=r,l.prototype.set=i,n.exports=l},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n){t[++e]=n})),t}},function(n,e){n.exports=function(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=9007199254740991}},function(n,e,t){var o=t(6),a=t(46),s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;n.exports=function(n,e){if(o(n))return!1;var t=typeof n;return!("number"!=t&&"symbol"!=t&&"boolean"!=t&&null!=n&&!a(n))||(r.test(n)||!s.test(n)||null!=e&&n in Object(e))}},function(n,e,t){var o=t(14),a=t(12);n.exports=function(n){return"symbol"==typeof n||a(n)&&"[object Symbol]"==o(n)}},function(n,e){n.exports=function(n){return n}},function(n,e,t){var o=t(2),a=t(4),s=t(20),r=Object,i=o("".split);n.exports=a((function(){return!r("z").propertyIsEnumerable(0)}))?function(n){return"String"==s(n)?i(n,""):r(n)}:r},function(n,e){n.exports={}},function(n,e){n.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],n.children||(n.children=[]),Object.defineProperty(n,"loaded",{enumerable:!0,get:function(){return n.l}}),Object.defineProperty(n,"id",{enumerable:!0,get:function(){return n.i}}),n.webpackPolyfill=1),n}},function(n,e){var t=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,r=parseInt,i="object"==typeof global&&global&&global.Object===Object&&global,l="object"==typeof self&&self&&self.Object===Object&&self,c=i||l||Function("return this")(),p=Object.prototype.toString,d=Math.max,m=Math.min,u=function(){return c.Date.now()};function h(n){var e=typeof n;return!!n&&("object"==e||"function"==e)}function g(n){if("number"==typeof n)return n;if(function(n){return"symbol"==typeof n||function(n){return!!n&&"object"==typeof n}(n)&&"[object Symbol]"==p.call(n)}(n))return NaN;if(h(n)){var e="function"==typeof n.valueOf?n.valueOf():n;n=h(e)?e+"":e}if("string"!=typeof n)return 0===n?n:+n;n=n.replace(t,"");var i=a.test(n);return i||s.test(n)?r(n.slice(2),i?2:8):o.test(n)?NaN:+n}n.exports=function(n,e,t){var o,a,s,r,i,l,c=0,p=!1,b=!1,f=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function y(e){var t=o,s=a;return o=a=void 0,c=e,r=n.apply(s,t)}function _(n){return c=n,i=setTimeout(k,e),p?y(n):r}function v(n){var t=n-l;return void 0===l||t>=e||t<0||b&&n-c>=s}function k(){var n=u();if(v(n))return x(n);i=setTimeout(k,function(n){var t=e-(n-l);return b?m(t,s-(n-c)):t}(n))}function x(n){return i=void 0,f&&o?y(n):(o=a=void 0,r)}function w(){var n=u(),t=v(n);if(o=arguments,a=this,l=n,t){if(void 0===i)return _(l);if(b)return i=setTimeout(k,e),y(l)}return void 0===i&&(i=setTimeout(k,e)),r}return e=g(e)||0,h(t)&&(p=!!t.leading,s=(b="maxWait"in t)?d(g(t.maxWait)||0,e):s,f="trailing"in t?!!t.trailing:f),w.cancel=function(){void 0!==i&&clearTimeout(i),c=0,o=l=a=i=void 0},w.flush=function(){return void 0===i?r:x(u())},w}},function(n,e,t){var o=t(5),a=t(35),s=t(109),r=t(36),i=t(30),l=t(55),c=t(7),p=t(65),d=Object.getOwnPropertyDescriptor;e.f=o?d:function(n,e){if(n=i(n),e=l(e),p)try{return d(n,e)}catch(n){}if(c(n,e))return r(!a(s.f,n,e),n[e])}},function(n,e,t){var o=t(54),a=TypeError;n.exports=function(n){if(o(n))throw a("Can't call method on "+n);return n}},function(n,e){n.exports=function(n){return null==n}},function(n,e,t){var o=t(110),a=t(57);n.exports=function(n){var e=o(n,"string");return a(e)?e:e+""}},function(n,e){var t="object"==typeof document&&document.all,o=void 0===t&&void 0!==t;n.exports={all:t,IS_HTMLDDA:o}},function(n,e,t){var o=t(31),a=t(1),s=t(58),r=t(59),i=Object;n.exports=r?function(n){return"symbol"==typeof n}:function(n){var e=o("Symbol");return a(e)&&s(e.prototype,i(n))}},function(n,e,t){var o=t(2);n.exports=o({}.isPrototypeOf)},function(n,e,t){var o=t(60);n.exports=o&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(n,e,t){var o=t(61),a=t(4);n.exports=!!Object.getOwnPropertySymbols&&!a((function(){var n=Symbol();return!String(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&o&&o<41}))},function(n,e,t){var o,a,s=t(3),r=t(111),i=s.process,l=s.Deno,c=i&&i.versions||l&&l.version,p=c&&c.v8;p&&(a=(o=p.split("."))[0]>0&&o[0]<4?1:+(o[0]+o[1])),!a&&r&&(!(o=r.match(/Edge\/(\d+)/))||o[1]>=74)&&(o=r.match(/Chrome\/(\d+)/))&&(a=+o[1]),n.exports=a},function(n,e,t){var o=t(63),a=t(37);(n.exports=function(n,e){return a[n]||(a[n]=void 0!==e?e:{})})("versions",[]).push({version:"3.29.0",mode:o?"pure":"global",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.29.0/LICENSE",source:"https://github.com/zloirock/core-js"})},function(n,e){n.exports=!1},function(n,e,t){var o=t(2),a=0,s=Math.random(),r=o(1..toString);n.exports=function(n){return"Symbol("+(void 0===n?"":n)+")_"+r(++a+s,36)}},function(n,e,t){var o=t(5),a=t(4),s=t(101);n.exports=!o&&!a((function(){return 7!=Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},function(n,e,t){var o=t(7),a=t(121),s=t(52),r=t(13);n.exports=function(n,e,t){for(var i=a(e),l=r.f,c=s.f,p=0;p<i.length;p++){var d=i[p];o(n,d)||t&&o(t,d)||l(n,d,c(e,d))}}},function(n,e,t){var o=t(125);n.exports=function(n){var e=+n;return e!=e||0===e?0:o(e)}},function(n,e,t){var o=t(137),a=t(28),s=t(138);n.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var n,e=!1,t={};try{(n=o(Object.prototype,"__proto__","set"))(t,[]),e=t instanceof Array}catch(n){}return function(t,o){return a(t),s(o),e?n(t,o):t.__proto__=o,t}}():void 0)},function(n,e){n.exports=function(n,e){for(var t=-1,o=e.length,a=n.length;++t<o;)n[a+t]=e[t];return n}},function(n,e){var t="object"==typeof global&&global&&global.Object===Object&&global;n.exports=t},function(n,e,t){var o=t(22),a=t(162),s=t(163),r=t(164),i=t(165),l=t(166);function c(n){var e=this.__data__=new o(n);this.size=e.size}c.prototype.clear=a,c.prototype.delete=s,c.prototype.get=r,c.prototype.has=i,c.prototype.set=l,n.exports=c},function(n,e){n.exports=function(n,e){return n===e||n!=n&&e!=e}},function(n,e,t){var o=t(14),a=t(41);n.exports=function(n){if(!a(n))return!1;var e=o(n);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(n,e){var t=Function.prototype.toString;n.exports=function(n){if(null!=n){try{return t.call(n)}catch(n){}try{return n+""}catch(n){}}return""}},function(n,e,t){var o=t(183),a=t(12);n.exports=function n(e,t,s,r,i){return e===t||(null==e||null==t||!a(e)&&!a(t)?e!=e&&t!=t:o(e,t,s,r,n,i))}},function(n,e,t){var o=t(77),a=t(186),s=t(78);n.exports=function(n,e,t,r,i,l){var c=1&t,p=n.length,d=e.length;if(p!=d&&!(c&&d>p))return!1;var m=l.get(n),u=l.get(e);if(m&&u)return m==e&&u==n;var h=-1,g=!0,b=2&t?new o:void 0;for(l.set(n,e),l.set(e,n);++h<p;){var f=n[h],y=e[h];if(r)var _=c?r(y,f,h,e,n,l):r(f,y,h,n,e,l);if(void 0!==_){if(_)continue;g=!1;break}if(b){if(!a(e,(function(n,e){if(!s(b,e)&&(f===n||i(f,n,t,r,l)))return b.push(e)}))){g=!1;break}}else if(f!==y&&!i(f,y,t,r,l)){g=!1;break}}return l.delete(n),l.delete(e),g}},function(n,e,t){var o=t(42),a=t(184),s=t(185);function r(n){var e=-1,t=null==n?0:n.length;for(this.__data__=new o;++e<t;)this.add(n[e])}r.prototype.add=r.prototype.push=a,r.prototype.has=s,n.exports=r},function(n,e){n.exports=function(n,e){return n.has(e)}},function(n,e,t){var o=t(196),a=t(202),s=t(83);n.exports=function(n){return s(n)?o(n):a(n)}},function(n,e,t){(function(n){var o=t(8),a=t(198),s=e&&!e.nodeType&&e,r=s&&"object"==typeof n&&n&&!n.nodeType&&n,i=r&&r.exports===s?o.Buffer:void 0,l=(i?i.isBuffer:void 0)||a;n.exports=l}).call(this,t(50)(n))},function(n,e){var t=/^(?:0|[1-9]\d*)$/;n.exports=function(n,e){var o=typeof n;return!!(e=null==e?9007199254740991:e)&&("number"==o||"symbol"!=o&&t.test(n))&&n>-1&&n%1==0&&n<e}},function(n,e,t){var o=t(199),a=t(200),s=t(201),r=s&&s.isTypedArray,i=r?a(r):o;n.exports=i},function(n,e,t){var o=t(73),a=t(44);n.exports=function(n){return null!=n&&a(n.length)&&!o(n)}},function(n,e,t){var o=t(10)(t(8),"Set");n.exports=o},function(n,e,t){var o=t(41);n.exports=function(n){return n==n&&!o(n)}},function(n,e){n.exports=function(n,e){return function(t){return null!=t&&(t[n]===e&&(void 0!==e||n in Object(t)))}}},function(n,e,t){var o=t(88),a=t(26);n.exports=function(n,e){for(var t=0,s=(e=o(e,n)).length;null!=n&&t<s;)n=n[a(e[t++])];return t&&t==s?n:void 0}},function(n,e,t){var o=t(6),a=t(45),s=t(213),r=t(216);n.exports=function(n,e){return o(n)?n:a(n,e)?[n]:s(r(n))}},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){},function(n,e,t){var o=t(149),a=t(154),s=t(225),r=t(233),i=t(242),l=t(106),c=s((function(n){var e=l(n);return i(e)&&(e=void 0),r(o(n,1,i,!0),a(e,2))}));n.exports=c},function(n,e,t){"use strict";
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */var o=/["'&<>]/;n.exports=function(n){var e,t=""+n,a=o.exec(t);if(!a)return t;var s="",r=0,i=0;for(r=a.index;r<t.length;r++){switch(t.charCodeAt(r)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#39;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}i!==r&&(s+=t.substring(i,r)),i=r+1,s+=e}return i!==r?s+t.substring(i,r):s}},function(n,e,t){"use strict";
/**
 * @file Embedded JavaScript templating engine. {@link http://ejs.co}
 * @author Matthew Eernisse <mde@fleegix.org>
 * @author Tiancheng "Timothy" Gu <timothygu99@gmail.com>
 * @project EJS
 * @license {@link http://www.apache.org/licenses/LICENSE-2.0 Apache License, Version 2.0}
 */var o=t(253),a=t(254),s=t(255),r=!1,i=t(256).version,l=["delimiter","scope","context","debug","compileDebug","client","_with","rmWhitespace","strict","filename","async"],c=l.concat("cache"),p=/^\uFEFF/,d=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/;function m(n,t){var a;if(t.some((function(t){return a=e.resolveInclude(n,t,!0),o.existsSync(a)})))return a}function u(n,t){var o,a=n.filename,s=arguments.length>1;if(n.cache){if(!a)throw new Error("cache option requires a filename");if(o=e.cache.get(a))return o;s||(t=g(a).toString().replace(p,""))}else if(!s){if(!a)throw new Error("Internal EJS error: no file name or template provided");t=g(a).toString().replace(p,"")}return o=e.compile(t,n),n.cache&&e.cache.set(a,o),o}function h(n,t,o){var a;if(!o){if("function"==typeof e.promiseImpl)return new e.promiseImpl((function(e,o){try{e(a=u(n)(t))}catch(n){o(n)}}));throw new Error("Please provide a callback function")}try{a=u(n)(t)}catch(n){return o(n)}o(null,a)}function g(n){return e.fileLoader(n)}function b(n,t){var a=s.shallowCopy(s.createNullProtoObjWherePossible(),t);if(a.filename=function(n,t){var a,s,r=t.views,i=/^[A-Za-z]+:\\|^\//.exec(n);if(i&&i.length)n=n.replace(/^\/*/,""),a=Array.isArray(t.root)?m(n,t.root):e.resolveInclude(n,t.root||"/",!0);else if(t.filename&&(s=e.resolveInclude(n,t.filename),o.existsSync(s)&&(a=s)),!a&&Array.isArray(r)&&(a=m(n,r)),!a&&"function"!=typeof t.includer)throw new Error('Could not find the include file "'+t.escapeFunction(n)+'"');return a}(n,a),"function"==typeof t.includer){var r=t.includer(n,a.filename);if(r&&(r.filename&&(a.filename=r.filename),r.template))return u(a,r.template)}return u(a)}function f(n,e,t,o,a){var s=e.split("\n"),r=Math.max(o-3,0),i=Math.min(s.length,o+3),l=a(t),c=s.slice(r,i).map((function(n,e){var t=e+r+1;return(t==o?" >> ":"    ")+t+"| "+n})).join("\n");throw n.path=l,n.message=(l||"ejs")+":"+o+"\n"+c+"\n\n"+n.message,n}function y(n){return n.replace(/;(\s*$)/,"$1")}function _(n,t){t=t||s.createNullProtoObjWherePossible();var o=s.createNullProtoObjWherePossible();this.templateText=n,this.mode=null,this.truncate=!1,this.currentLine=1,this.source="",o.client=t.client||!1,o.escapeFunction=t.escape||t.escapeFunction||s.escapeXML,o.compileDebug=!1!==t.compileDebug,o.debug=!!t.debug,o.filename=t.filename,o.openDelimiter=t.openDelimiter||e.openDelimiter||"<",o.closeDelimiter=t.closeDelimiter||e.closeDelimiter||">",o.delimiter=t.delimiter||e.delimiter||"%",o.strict=t.strict||!1,o.context=t.context,o.cache=t.cache||!1,o.rmWhitespace=t.rmWhitespace,o.root=t.root,o.includer=t.includer,o.outputFunctionName=t.outputFunctionName,o.localsName=t.localsName||e.localsName||"locals",o.views=t.views,o.async=t.async,o.destructuredLocals=t.destructuredLocals,o.legacyInclude=void 0===t.legacyInclude||!!t.legacyInclude,o.strict?o._with=!1:o._with=void 0===t._with||t._with,this.opts=o,this.regex=this.createRegex()}e.cache=s.cache,e.fileLoader=o.readFileSync,e.localsName="locals",e.promiseImpl=new Function("return this;")().Promise,e.resolveInclude=function(n,e,t){var o=a.dirname,s=a.extname,r=(0,a.resolve)(t?e:o(e),n);return s(n)||(r+=".ejs"),r},e.compile=function(n,e){return e&&e.scope&&(r||(console.warn("`scope` option is deprecated and will be removed in EJS 3"),r=!0),e.context||(e.context=e.scope),delete e.scope),new _(n,e).compile()},e.render=function(n,e,t){var o=e||s.createNullProtoObjWherePossible(),a=t||s.createNullProtoObjWherePossible();return 2==arguments.length&&s.shallowCopyFromList(a,o,l),u(a,n)(o)},e.renderFile=function(){var n,e,t,o=Array.prototype.slice.call(arguments),a=o.shift(),r={filename:a};return"function"==typeof arguments[arguments.length-1]&&(n=o.pop()),o.length?(e=o.shift(),o.length?s.shallowCopy(r,o.pop()):(e.settings&&(e.settings.views&&(r.views=e.settings.views),e.settings["view cache"]&&(r.cache=!0),(t=e.settings["view options"])&&s.shallowCopy(r,t)),s.shallowCopyFromList(r,e,c)),r.filename=a):e=s.createNullProtoObjWherePossible(),h(r,e,n)},e.Template=_,e.clearCache=function(){e.cache.reset()},_.modes={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"},_.prototype={createRegex:function(){var n="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",e=s.escapeRegExpChars(this.opts.delimiter),t=s.escapeRegExpChars(this.opts.openDelimiter),o=s.escapeRegExpChars(this.opts.closeDelimiter);return n=n.replace(/%/g,e).replace(/</g,t).replace(/>/g,o),new RegExp(n)},compile:function(){var n,e,t,o=this.opts,r="",i="",l=o.escapeFunction,c=o.filename?JSON.stringify(o.filename):"undefined";if(!this.source){if(this.generateSource(),r+='  var __output = "";\n  function __append(s) { if (s !== undefined && s !== null) __output += s }\n',o.outputFunctionName){if(!d.test(o.outputFunctionName))throw new Error("outputFunctionName is not a valid JS identifier.");r+="  var "+o.outputFunctionName+" = __append;\n"}if(o.localsName&&!d.test(o.localsName))throw new Error("localsName is not a valid JS identifier.");if(o.destructuredLocals&&o.destructuredLocals.length){for(var p="  var __locals = ("+o.localsName+" || {}),\n",m=0;m<o.destructuredLocals.length;m++){var u=o.destructuredLocals[m];if(!d.test(u))throw new Error("destructuredLocals["+m+"] is not a valid JS identifier.");m>0&&(p+=",\n  "),p+=u+" = __locals."+u}r+=p+";\n"}!1!==o._with&&(r+="  with ("+o.localsName+" || {}) {\n",i+="  }\n"),i+="  return __output;\n",this.source=r+this.source+i}n=o.compileDebug?"var __line = 1\n  , __lines = "+JSON.stringify(this.templateText)+"\n  , __filename = "+c+";\ntry {\n"+this.source+"} catch (e) {\n  rethrow(e, __lines, __filename, __line, escapeFn);\n}\n":this.source,o.client&&(n="escapeFn = escapeFn || "+l.toString()+";\n"+n,o.compileDebug&&(n="rethrow = rethrow || "+f.toString()+";\n"+n)),o.strict&&(n='"use strict";\n'+n),o.debug&&console.log(n),o.compileDebug&&o.filename&&(n=n+"\n//# sourceURL="+c+"\n");try{if(o.async)try{t=new Function("return (async function(){}).constructor;")()}catch(n){throw n instanceof SyntaxError?new Error("This environment does not support async/await"):n}else t=Function;e=new t(o.localsName+", escapeFn, include, rethrow",n)}catch(n){throw n instanceof SyntaxError&&(o.filename&&(n.message+=" in "+o.filename),n.message+=" while compiling ejs\n\n",n.message+="If the above error is not helpful, you may want to try EJS-Lint:\n",n.message+="https://github.com/RyanZim/EJS-Lint",o.async||(n.message+="\n",n.message+="Or, if you meant to create an async function, pass `async: true` as an option.")),n}var h=o.client?e:function(n){return e.apply(o.context,[n||s.createNullProtoObjWherePossible(),l,function(e,t){var a=s.shallowCopy(s.createNullProtoObjWherePossible(),n);return t&&(a=s.shallowCopy(a,t)),b(e,o)(a)},f])};if(o.filename&&"function"==typeof Object.defineProperty){var g=o.filename,y=a.basename(g,a.extname(g));try{Object.defineProperty(h,"name",{value:y,writable:!1,enumerable:!1,configurable:!0})}catch(n){}}return h},generateSource:function(){this.opts.rmWhitespace&&(this.templateText=this.templateText.replace(/[\r\n]+/g,"\n").replace(/^\s+|\s+$/gm,"")),this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");var n=this,e=this.parseTemplateText(),t=this.opts.delimiter,o=this.opts.openDelimiter,a=this.opts.closeDelimiter;e&&e.length&&e.forEach((function(s,r){var i;if(0===s.indexOf(o+t)&&0!==s.indexOf(o+t+t)&&(i=e[r+2])!=t+a&&i!="-"+t+a&&i!="_"+t+a)throw new Error('Could not find matching close tag for "'+s+'".');n.scanLine(s)}))},parseTemplateText:function(){for(var n,e=this.templateText,t=this.regex,o=t.exec(e),a=[];o;)0!==(n=o.index)&&(a.push(e.substring(0,n)),e=e.slice(n)),a.push(o[0]),e=e.slice(o[0].length),o=t.exec(e);return e&&a.push(e),a},_addOutput:function(n){if(this.truncate&&(n=n.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1),!n)return n;n=(n=(n=(n=n.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/"/g,'\\"'),this.source+='    ; __append("'+n+'")\n'},scanLine:function(n){var e,t=this.opts.delimiter,o=this.opts.openDelimiter,a=this.opts.closeDelimiter;switch(e=n.split("\n").length-1,n){case o+t:case o+t+"_":this.mode=_.modes.EVAL;break;case o+t+"=":this.mode=_.modes.ESCAPED;break;case o+t+"-":this.mode=_.modes.RAW;break;case o+t+"#":this.mode=_.modes.COMMENT;break;case o+t+t:this.mode=_.modes.LITERAL,this.source+='    ; __append("'+n.replace(o+t+t,o+t)+'")\n';break;case t+t+a:this.mode=_.modes.LITERAL,this.source+='    ; __append("'+n.replace(t+t+a,t+a)+'")\n';break;case t+a:case"-"+t+a:case"_"+t+a:this.mode==_.modes.LITERAL&&this._addOutput(n),this.mode=null,this.truncate=0===n.indexOf("-")||0===n.indexOf("_");break;default:if(this.mode){switch(this.mode){case _.modes.EVAL:case _.modes.ESCAPED:case _.modes.RAW:n.lastIndexOf("//")>n.lastIndexOf("\n")&&(n+="\n")}switch(this.mode){case _.modes.EVAL:this.source+="    ; "+n+"\n";break;case _.modes.ESCAPED:this.source+="    ; __append(escapeFn("+y(n)+"))\n";break;case _.modes.RAW:this.source+="    ; __append("+y(n)+")\n";break;case _.modes.COMMENT:break;case _.modes.LITERAL:this._addOutput(n)}}else this._addOutput(n)}this.opts.compileDebug&&e&&(this.currentLine+=e,this.source+="    ; __line = "+this.currentLine+"\n")}},e.escapeXML=s.escapeXML,e.__express=e.renderFile,e.VERSION=i,e.name="ejs","undefined"!=typeof window&&(window.ejs=e)},function(n,e,t){"use strict";t.r(e);var o={name:"CodeBlock",props:{title:{type:String,required:!0},active:{type:Boolean,default:!1}}},a=(t(245),t(0)),s=Object(a.a)(o,(function(){return(0,this._self._c)("div",{staticClass:"theme-code-block",class:{"theme-code-block__active":this.active}},[this._t("default")],2)}),[],!1,null,"4f1e9d0c",null);e.default=s.exports},function(n,e,t){"use strict";t.r(e);var o={name:"CodeGroup",data:()=>({codeTabs:[],activeCodeTabIndex:-1}),watch:{activeCodeTabIndex(n){this.codeTabs.forEach(n=>{n.elm.classList.remove("theme-code-block__active")}),this.codeTabs[n].elm.classList.add("theme-code-block__active")}},mounted(){this.codeTabs=(this.$slots.default||[]).filter(n=>Boolean(n.componentOptions)).map((n,e)=>(""===n.componentOptions.propsData.active&&(this.activeCodeTabIndex=e),{title:n.componentOptions.propsData.title,elm:n.elm})),-1===this.activeCodeTabIndex&&this.codeTabs.length>0&&(this.activeCodeTabIndex=0)},methods:{changeCodeTab(n){this.activeCodeTabIndex=n}}},a=(t(246),t(0)),s=Object(a.a)(o,(function(){var n=this,e=n._self._c;return e("div",{staticClass:"theme-code-group"},[e("div",{staticClass:"theme-code-group__nav"},[e("ul",{staticClass:"theme-code-group__ul"},n._l(n.codeTabs,(function(t,o){return e("li",{key:t.title,staticClass:"theme-code-group__li"},[e("button",{staticClass:"theme-code-group__nav-tab",class:{"theme-code-group__nav-tab-active":o===n.activeCodeTabIndex},on:{click:function(e){return n.changeCodeTab(o)}}},[n._v("\n            "+n._s(t.title)+"\n          ")])])})),0)]),n._v(" "),n._t("default"),n._v(" "),n.codeTabs.length<1?e("pre",{staticClass:"pre-blank"},[n._v("// Make sure to add code blocks to your code group")]):n._e()],2)}),[],!1,null,"2f5f1757",null);e.default=s.exports},function(n,e){n.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(n,e,t){var o=t(3),a=t(9),s=o.document,r=a(s)&&a(s.createElement);n.exports=function(n){return r?s.createElement(n):{}}},function(n,e,t){var o=t(5),a=t(4);n.exports=o&&a((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(n,e,t){var o=t(62),a=t(64),s=o("keys");n.exports=function(n){return s[n]||(s[n]=a(n))}},function(n,e,t){var o=t(2),a=t(7),s=t(30),r=t(123).indexOf,i=t(49),l=o([].push);n.exports=function(n,e){var t,o=s(n),c=0,p=[];for(t in o)!a(i,t)&&a(o,t)&&l(p,t);for(;e.length>c;)a(o,t=e[c++])&&(~r(p,t)||l(p,t));return p}},function(n,e,t){var o=t(19),a=t(3),s=t(135),r=t(136),i=a.WebAssembly,l=7!==Error("e",{cause:7}).cause,c=function(n,e){var t={};t[n]=r(n,e,l),o({global:!0,constructor:!0,arity:1,forced:l},t)},p=function(n,e){if(i&&i[n]){var t={};t[n]=r("WebAssembly."+n,e,l),o({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:l},t)}};c("Error",(function(n){return function(e){return s(n,this,arguments)}})),c("EvalError",(function(n){return function(e){return s(n,this,arguments)}})),c("RangeError",(function(n){return function(e){return s(n,this,arguments)}})),c("ReferenceError",(function(n){return function(e){return s(n,this,arguments)}})),c("SyntaxError",(function(n){return function(e){return s(n,this,arguments)}})),c("TypeError",(function(n){return function(e){return s(n,this,arguments)}})),c("URIError",(function(n){return function(e){return s(n,this,arguments)}})),p("CompileError",(function(n){return function(e){return s(n,this,arguments)}})),p("LinkError",(function(n){return function(e){return s(n,this,arguments)}})),p("RuntimeError",(function(n){return function(e){return s(n,this,arguments)}}))},function(n,e){n.exports=function(n){var e=null==n?0:n.length;return e?n[e-1]:void 0}},function(n,e,t){n.exports=t(259)},function(n,e,t){"use strict";var o=t(19),a=t(129).left,s=t(130),r=t(61);o({target:"Array",proto:!0,forced:!t(131)&&r>79&&r<83||!s("reduce")},{reduce:function(n){var e=arguments.length;return a(this,n,e,e>1?arguments[1]:void 0)}})},function(n,e,t){"use strict";var o={}.propertyIsEnumerable,a=Object.getOwnPropertyDescriptor,s=a&&!o.call({1:2},1);e.f=s?function(n){var e=a(this,n);return!!e&&e.enumerable}:o},function(n,e,t){var o=t(35),a=t(9),s=t(57),r=t(112),i=t(114),l=t(21),c=TypeError,p=l("toPrimitive");n.exports=function(n,e){if(!a(n)||s(n))return n;var t,l=r(n,p);if(l){if(void 0===e&&(e="default"),t=o(l,n,e),!a(t)||s(t))return t;throw c("Can't convert object to primitive value")}return void 0===e&&(e="number"),i(n,e)}},function(n,e){n.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},function(n,e,t){var o=t(32),a=t(54);n.exports=function(n,e){var t=n[e];return a(t)?void 0:o(t)}},function(n,e){var t=String;n.exports=function(n){try{return t(n)}catch(n){return"Object"}}},function(n,e,t){var o=t(35),a=t(1),s=t(9),r=TypeError;n.exports=function(n,e){var t,i;if("string"===e&&a(t=n.toString)&&!s(i=o(t,n)))return i;if(a(t=n.valueOf)&&!s(i=o(t,n)))return i;if("string"!==e&&a(t=n.toString)&&!s(i=o(t,n)))return i;throw r("Can't convert object to primitive value")}},function(n,e,t){var o=t(1),a=t(13),s=t(116),r=t(38);n.exports=function(n,e,t,i){i||(i={});var l=i.enumerable,c=void 0!==i.name?i.name:e;if(o(t)&&s(t,c,i),i.global)l?n[e]=t:r(e,t);else{try{i.unsafe?n[e]&&(l=!0):delete n[e]}catch(n){}l?n[e]=t:a.f(n,e,{value:t,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return n}},function(n,e,t){var o=t(2),a=t(4),s=t(1),r=t(7),i=t(5),l=t(117).CONFIGURABLE,c=t(118),p=t(119),d=p.enforce,m=p.get,u=String,h=Object.defineProperty,g=o("".slice),b=o("".replace),f=o([].join),y=i&&!a((function(){return 8!==h((function(){}),"length",{value:8}).length})),_=String(String).split("String"),v=n.exports=function(n,e,t){"Symbol("===g(u(e),0,7)&&(e="["+b(u(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!r(n,"name")||l&&n.name!==e)&&(i?h(n,"name",{value:e,configurable:!0}):n.name=e),y&&t&&r(t,"arity")&&n.length!==t.arity&&h(n,"length",{value:t.arity});try{t&&r(t,"constructor")&&t.constructor?i&&h(n,"prototype",{writable:!1}):n.prototype&&(n.prototype=void 0)}catch(n){}var o=d(n);return r(o,"source")||(o.source=f(_,"string"==typeof e?e:"")),n};Function.prototype.toString=v((function(){return s(this)&&m(this).source||c(this)}),"toString")},function(n,e,t){var o=t(5),a=t(7),s=Function.prototype,r=o&&Object.getOwnPropertyDescriptor,i=a(s,"name"),l=i&&"something"===function(){}.name,c=i&&(!o||o&&r(s,"name").configurable);n.exports={EXISTS:i,PROPER:l,CONFIGURABLE:c}},function(n,e,t){var o=t(2),a=t(1),s=t(37),r=o(Function.toString);a(s.inspectSource)||(s.inspectSource=function(n){return r(n)}),n.exports=s.inspectSource},function(n,e,t){var o,a,s,r=t(120),i=t(3),l=t(9),c=t(15),p=t(7),d=t(37),m=t(103),u=t(49),h=i.TypeError,g=i.WeakMap;if(r||d.state){var b=d.state||(d.state=new g);b.get=b.get,b.has=b.has,b.set=b.set,o=function(n,e){if(b.has(n))throw h("Object already initialized");return e.facade=n,b.set(n,e),e},a=function(n){return b.get(n)||{}},s=function(n){return b.has(n)}}else{var f=m("state");u[f]=!0,o=function(n,e){if(p(n,f))throw h("Object already initialized");return e.facade=n,c(n,f,e),e},a=function(n){return p(n,f)?n[f]:{}},s=function(n){return p(n,f)}}n.exports={set:o,get:a,has:s,enforce:function(n){return s(n)?a(n):o(n,{})},getterFor:function(n){return function(e){var t;if(!l(e)||(t=a(e)).type!==n)throw h("Incompatible receiver, "+n+" required");return t}}}},function(n,e,t){var o=t(3),a=t(1),s=o.WeakMap;n.exports=a(s)&&/native code/.test(String(s))},function(n,e,t){var o=t(31),a=t(2),s=t(122),r=t(127),i=t(28),l=a([].concat);n.exports=o("Reflect","ownKeys")||function(n){var e=s.f(i(n)),t=r.f;return t?l(e,t(n)):e}},function(n,e,t){var o=t(104),a=t(100).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(n){return o(n,a)}},function(n,e,t){var o=t(30),a=t(124),s=t(34),r=function(n){return function(e,t,r){var i,l=o(e),c=s(l),p=a(r,c);if(n&&t!=t){for(;c>p;)if((i=l[p++])!=i)return!0}else for(;c>p;p++)if((n||p in l)&&l[p]===t)return n||p||0;return!n&&-1}};n.exports={includes:r(!0),indexOf:r(!1)}},function(n,e,t){var o=t(67),a=Math.max,s=Math.min;n.exports=function(n,e){var t=o(n);return t<0?a(t+e,0):s(t,e)}},function(n,e){var t=Math.ceil,o=Math.floor;n.exports=Math.trunc||function(n){var e=+n;return(e>0?o:t)(e)}},function(n,e,t){var o=t(67),a=Math.min;n.exports=function(n){return n>0?a(o(n),9007199254740991):0}},function(n,e){e.f=Object.getOwnPropertySymbols},function(n,e,t){var o=t(4),a=t(1),s=/#|\.prototype\./,r=function(n,e){var t=l[i(n)];return t==p||t!=c&&(a(e)?o(e):!!e)},i=r.normalize=function(n){return String(n).replace(s,".").toLowerCase()},l=r.data={},c=r.NATIVE="N",p=r.POLYFILL="P";n.exports=r},function(n,e,t){var o=t(32),a=t(33),s=t(48),r=t(34),i=TypeError,l=function(n){return function(e,t,l,c){o(t);var p=a(e),d=s(p),m=r(p),u=n?m-1:0,h=n?-1:1;if(l<2)for(;;){if(u in d){c=d[u],u+=h;break}if(u+=h,n?u<0:m<=u)throw i("Reduce of empty array with no initial value")}for(;n?u>=0:m>u;u+=h)u in d&&(c=t(c,d[u],u,p));return c}};n.exports={left:l(!1),right:l(!0)}},function(n,e,t){"use strict";var o=t(4);n.exports=function(n,e){var t=[][n];return!!t&&o((function(){t.call(null,e||function(){return 1},1)}))}},function(n,e,t){var o=t(20);n.exports="undefined"!=typeof process&&"process"==o(process)},function(n,e,t){"use strict";var o=t(5),a=t(133),s=TypeError,r=Object.getOwnPropertyDescriptor,i=o&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(n){return n instanceof TypeError}}();n.exports=i?function(n,e){if(a(n)&&!r(n,"length").writable)throw s("Cannot set read only .length");return n.length=e}:function(n,e){return n.length=e}},function(n,e,t){var o=t(20);n.exports=Array.isArray||function(n){return"Array"==o(n)}},function(n,e){var t=TypeError;n.exports=function(n){if(n>9007199254740991)throw t("Maximum allowed index exceeded");return n}},function(n,e,t){var o=t(29),a=Function.prototype,s=a.apply,r=a.call;n.exports="object"==typeof Reflect&&Reflect.apply||(o?r.bind(s):function(){return r.apply(s,arguments)})},function(n,e,t){"use strict";var o=t(31),a=t(7),s=t(15),r=t(58),i=t(68),l=t(66),c=t(139),p=t(140),d=t(141),m=t(145),u=t(146),h=t(5),g=t(63);n.exports=function(n,e,t,b){var f=b?2:1,y=n.split("."),_=y[y.length-1],v=o.apply(null,y);if(v){var k=v.prototype;if(!g&&a(k,"cause")&&delete k.cause,!t)return v;var x=o("Error"),w=e((function(n,e){var t=d(b?e:n,void 0),o=b?new v(n):new v;return void 0!==t&&s(o,"message",t),u(o,w,o.stack,2),this&&r(k,this)&&p(o,this,w),arguments.length>f&&m(o,arguments[f]),o}));if(w.prototype=k,"Error"!==_?i?i(w,x):l(w,x,{name:!0}):h&&"stackTraceLimit"in v&&(c(w,v,"stackTraceLimit"),c(w,v,"prepareStackTrace")),l(w,v),!g)try{k.name!==_&&s(k,"name",_),k.constructor=w}catch(n){}return w}}},function(n,e,t){var o=t(2),a=t(32);n.exports=function(n,e,t){try{return o(a(Object.getOwnPropertyDescriptor(n,e)[t]))}catch(n){}}},function(n,e,t){var o=t(1),a=String,s=TypeError;n.exports=function(n){if("object"==typeof n||o(n))return n;throw s("Can't set "+a(n)+" as a prototype")}},function(n,e,t){var o=t(13).f;n.exports=function(n,e,t){t in n||o(n,t,{configurable:!0,get:function(){return e[t]},set:function(n){e[t]=n}})}},function(n,e,t){var o=t(1),a=t(9),s=t(68);n.exports=function(n,e,t){var r,i;return s&&o(r=e.constructor)&&r!==t&&a(i=r.prototype)&&i!==t.prototype&&s(n,i),n}},function(n,e,t){var o=t(142);n.exports=function(n,e){return void 0===n?arguments.length<2?"":e:o(n)}},function(n,e,t){var o=t(143),a=String;n.exports=function(n){if("Symbol"===o(n))throw TypeError("Cannot convert a Symbol value to a string");return a(n)}},function(n,e,t){var o=t(144),a=t(1),s=t(20),r=t(21)("toStringTag"),i=Object,l="Arguments"==s(function(){return arguments}());n.exports=o?s:function(n){var e,t,o;return void 0===n?"Undefined":null===n?"Null":"string"==typeof(t=function(n,e){try{return n[e]}catch(n){}}(e=i(n),r))?t:l?s(e):"Object"==(o=s(e))&&a(e.callee)?"Arguments":o}},function(n,e,t){var o={};o[t(21)("toStringTag")]="z",n.exports="[object z]"===String(o)},function(n,e,t){var o=t(9),a=t(15);n.exports=function(n,e){o(e)&&"cause"in e&&a(n,"cause",e.cause)}},function(n,e,t){var o=t(15),a=t(147),s=t(148),r=Error.captureStackTrace;n.exports=function(n,e,t,i){s&&(r?r(n,e):o(n,"stack",a(t,i)))}},function(n,e,t){var o=t(2),a=Error,s=o("".replace),r=String(a("zxcasd").stack),i=/\n\s*at [^:]*:[^\n]*/,l=i.test(r);n.exports=function(n,e){if(l&&"string"==typeof n&&!a.prepareStackTrace)for(;e--;)n=s(n,i,"");return n}},function(n,e,t){var o=t(4),a=t(36);n.exports=!o((function(){var n=Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",a(1,7)),7!==n.stack)}))},function(n,e,t){var o=t(69),a=t(150);n.exports=function n(e,t,s,r,i){var l=-1,c=e.length;for(s||(s=a),i||(i=[]);++l<c;){var p=e[l];t>0&&s(p)?t>1?n(p,t-1,s,r,i):o(i,p):r||(i[i.length]=p)}return i}},function(n,e,t){var o=t(16),a=t(39),s=t(6),r=o?o.isConcatSpreadable:void 0;n.exports=function(n){return s(n)||a(n)||!!(r&&n&&n[r])}},function(n,e,t){var o=t(14),a=t(12);n.exports=function(n){return a(n)&&"[object Arguments]"==o(n)}},function(n,e,t){var o=t(16),a=Object.prototype,s=a.hasOwnProperty,r=a.toString,i=o?o.toStringTag:void 0;n.exports=function(n){var e=s.call(n,i),t=n[i];try{n[i]=void 0;var o=!0}catch(n){}var a=r.call(n);return o&&(e?n[i]=t:delete n[i]),a}},function(n,e){var t=Object.prototype.toString;n.exports=function(n){return t.call(n)}},function(n,e,t){var o=t(155),a=t(211),s=t(47),r=t(6),i=t(222);n.exports=function(n){return"function"==typeof n?n:null==n?s:"object"==typeof n?r(n)?a(n[0],n[1]):o(n):i(n)}},function(n,e,t){var o=t(156),a=t(210),s=t(86);n.exports=function(n){var e=a(n);return 1==e.length&&e[0][2]?s(e[0][0],e[0][1]):function(t){return t===n||o(t,n,e)}}},function(n,e,t){var o=t(71),a=t(75);n.exports=function(n,e,t,s){var r=t.length,i=r,l=!s;if(null==n)return!i;for(n=Object(n);r--;){var c=t[r];if(l&&c[2]?c[1]!==n[c[0]]:!(c[0]in n))return!1}for(;++r<i;){var p=(c=t[r])[0],d=n[p],m=c[1];if(l&&c[2]){if(void 0===d&&!(p in n))return!1}else{var u=new o;if(s)var h=s(d,m,p,n,e,u);if(!(void 0===h?a(m,d,3,s,u):h))return!1}}return!0}},function(n,e){n.exports=function(){this.__data__=[],this.size=0}},function(n,e,t){var o=t(23),a=Array.prototype.splice;n.exports=function(n){var e=this.__data__,t=o(e,n);return!(t<0)&&(t==e.length-1?e.pop():a.call(e,t,1),--this.size,!0)}},function(n,e,t){var o=t(23);n.exports=function(n){var e=this.__data__,t=o(e,n);return t<0?void 0:e[t][1]}},function(n,e,t){var o=t(23);n.exports=function(n){return o(this.__data__,n)>-1}},function(n,e,t){var o=t(23);n.exports=function(n,e){var t=this.__data__,a=o(t,n);return a<0?(++this.size,t.push([n,e])):t[a][1]=e,this}},function(n,e,t){var o=t(22);n.exports=function(){this.__data__=new o,this.size=0}},function(n,e){n.exports=function(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}},function(n,e){n.exports=function(n){return this.__data__.get(n)}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e,t){var o=t(22),a=t(40),s=t(42);n.exports=function(n,e){var t=this.__data__;if(t instanceof o){var r=t.__data__;if(!a||r.length<199)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new s(r)}return t.set(n,e),this.size=t.size,this}},function(n,e,t){var o=t(73),a=t(168),s=t(41),r=t(74),i=/^\[object .+?Constructor\]$/,l=Function.prototype,c=Object.prototype,p=l.toString,d=c.hasOwnProperty,m=RegExp("^"+p.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");n.exports=function(n){return!(!s(n)||a(n))&&(o(n)?m:i).test(r(n))}},function(n,e,t){var o,a=t(169),s=(o=/[^.]+$/.exec(a&&a.keys&&a.keys.IE_PROTO||""))?"Symbol(src)_1."+o:"";n.exports=function(n){return!!s&&s in n}},function(n,e,t){var o=t(8)["__core-js_shared__"];n.exports=o},function(n,e){n.exports=function(n,e){return null==n?void 0:n[e]}},function(n,e,t){var o=t(172),a=t(22),s=t(40);n.exports=function(){this.size=0,this.__data__={hash:new o,map:new(s||a),string:new o}}},function(n,e,t){var o=t(173),a=t(174),s=t(175),r=t(176),i=t(177);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var o=n[e];this.set(o[0],o[1])}}l.prototype.clear=o,l.prototype.delete=a,l.prototype.get=s,l.prototype.has=r,l.prototype.set=i,n.exports=l},function(n,e,t){var o=t(24);n.exports=function(){this.__data__=o?o(null):{},this.size=0}},function(n,e){n.exports=function(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}},function(n,e,t){var o=t(24),a=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;if(o){var t=e[n];return"__lodash_hash_undefined__"===t?void 0:t}return a.call(e,n)?e[n]:void 0}},function(n,e,t){var o=t(24),a=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;return o?void 0!==e[n]:a.call(e,n)}},function(n,e,t){var o=t(24);n.exports=function(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=o&&void 0===e?"__lodash_hash_undefined__":e,this}},function(n,e,t){var o=t(25);n.exports=function(n){var e=o(this,n).delete(n);return this.size-=e?1:0,e}},function(n,e){n.exports=function(n){var e=typeof n;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==n:null===n}},function(n,e,t){var o=t(25);n.exports=function(n){return o(this,n).get(n)}},function(n,e,t){var o=t(25);n.exports=function(n){return o(this,n).has(n)}},function(n,e,t){var o=t(25);n.exports=function(n,e){var t=o(this,n),a=t.size;return t.set(n,e),this.size+=t.size==a?0:1,this}},function(n,e,t){var o=t(71),a=t(76),s=t(187),r=t(190),i=t(206),l=t(6),c=t(80),p=t(82),d="[object Object]",m=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,u,h,g){var b=l(n),f=l(e),y=b?"[object Array]":i(n),_=f?"[object Array]":i(e),v=(y="[object Arguments]"==y?d:y)==d,k=(_="[object Arguments]"==_?d:_)==d,x=y==_;if(x&&c(n)){if(!c(e))return!1;b=!0,v=!1}if(x&&!v)return g||(g=new o),b||p(n)?a(n,e,t,u,h,g):s(n,e,y,t,u,h,g);if(!(1&t)){var w=v&&m.call(n,"__wrapped__"),E=k&&m.call(e,"__wrapped__");if(w||E){var A=w?n.value():n,z=E?e.value():e;return g||(g=new o),h(A,z,t,u,g)}}return!!x&&(g||(g=new o),r(n,e,t,u,h,g))}},function(n,e){n.exports=function(n){return this.__data__.set(n,"__lodash_hash_undefined__"),this}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e){n.exports=function(n,e){for(var t=-1,o=null==n?0:n.length;++t<o;)if(e(n[t],t,n))return!0;return!1}},function(n,e,t){var o=t(16),a=t(188),s=t(72),r=t(76),i=t(189),l=t(43),c=o?o.prototype:void 0,p=c?c.valueOf:void 0;n.exports=function(n,e,t,o,c,d,m){switch(t){case"[object DataView]":if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(n.byteLength!=e.byteLength||!d(new a(n),new a(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return s(+n,+e);case"[object Error]":return n.name==e.name&&n.message==e.message;case"[object RegExp]":case"[object String]":return n==e+"";case"[object Map]":var u=i;case"[object Set]":var h=1&o;if(u||(u=l),n.size!=e.size&&!h)return!1;var g=m.get(n);if(g)return g==e;o|=2,m.set(n,e);var b=r(u(n),u(e),o,c,d,m);return m.delete(n),b;case"[object Symbol]":if(p)return p.call(n)==p.call(e)}return!1}},function(n,e,t){var o=t(8).Uint8Array;n.exports=o},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n,o){t[++e]=[o,n]})),t}},function(n,e,t){var o=t(191),a=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,s,r,i){var l=1&t,c=o(n),p=c.length;if(p!=o(e).length&&!l)return!1;for(var d=p;d--;){var m=c[d];if(!(l?m in e:a.call(e,m)))return!1}var u=i.get(n),h=i.get(e);if(u&&h)return u==e&&h==n;var g=!0;i.set(n,e),i.set(e,n);for(var b=l;++d<p;){var f=n[m=c[d]],y=e[m];if(s)var _=l?s(y,f,m,e,n,i):s(f,y,m,n,e,i);if(!(void 0===_?f===y||r(f,y,t,s,i):_)){g=!1;break}b||(b="constructor"==m)}if(g&&!b){var v=n.constructor,k=e.constructor;v==k||!("constructor"in n)||!("constructor"in e)||"function"==typeof v&&v instanceof v&&"function"==typeof k&&k instanceof k||(g=!1)}return i.delete(n),i.delete(e),g}},function(n,e,t){var o=t(192),a=t(193),s=t(79);n.exports=function(n){return o(n,s,a)}},function(n,e,t){var o=t(69),a=t(6);n.exports=function(n,e,t){var s=e(n);return a(n)?s:o(s,t(n))}},function(n,e,t){var o=t(194),a=t(195),s=Object.prototype.propertyIsEnumerable,r=Object.getOwnPropertySymbols,i=r?function(n){return null==n?[]:(n=Object(n),o(r(n),(function(e){return s.call(n,e)})))}:a;n.exports=i},function(n,e){n.exports=function(n,e){for(var t=-1,o=null==n?0:n.length,a=0,s=[];++t<o;){var r=n[t];e(r,t,n)&&(s[a++]=r)}return s}},function(n,e){n.exports=function(){return[]}},function(n,e,t){var o=t(197),a=t(39),s=t(6),r=t(80),i=t(81),l=t(82),c=Object.prototype.hasOwnProperty;n.exports=function(n,e){var t=s(n),p=!t&&a(n),d=!t&&!p&&r(n),m=!t&&!p&&!d&&l(n),u=t||p||d||m,h=u?o(n.length,String):[],g=h.length;for(var b in n)!e&&!c.call(n,b)||u&&("length"==b||d&&("offset"==b||"parent"==b)||m&&("buffer"==b||"byteLength"==b||"byteOffset"==b)||i(b,g))||h.push(b);return h}},function(n,e){n.exports=function(n,e){for(var t=-1,o=Array(n);++t<n;)o[t]=e(t);return o}},function(n,e){n.exports=function(){return!1}},function(n,e,t){var o=t(14),a=t(44),s=t(12),r={};r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0,r["[object Arguments]"]=r["[object Array]"]=r["[object ArrayBuffer]"]=r["[object Boolean]"]=r["[object DataView]"]=r["[object Date]"]=r["[object Error]"]=r["[object Function]"]=r["[object Map]"]=r["[object Number]"]=r["[object Object]"]=r["[object RegExp]"]=r["[object Set]"]=r["[object String]"]=r["[object WeakMap]"]=!1,n.exports=function(n){return s(n)&&a(n.length)&&!!r[o(n)]}},function(n,e){n.exports=function(n){return function(e){return n(e)}}},function(n,e,t){(function(n){var o=t(70),a=e&&!e.nodeType&&e,s=a&&"object"==typeof n&&n&&!n.nodeType&&n,r=s&&s.exports===a&&o.process,i=function(){try{var n=s&&s.require&&s.require("util").types;return n||r&&r.binding&&r.binding("util")}catch(n){}}();n.exports=i}).call(this,t(50)(n))},function(n,e,t){var o=t(203),a=t(204),s=Object.prototype.hasOwnProperty;n.exports=function(n){if(!o(n))return a(n);var e=[];for(var t in Object(n))s.call(n,t)&&"constructor"!=t&&e.push(t);return e}},function(n,e){var t=Object.prototype;n.exports=function(n){var e=n&&n.constructor;return n===("function"==typeof e&&e.prototype||t)}},function(n,e,t){var o=t(205)(Object.keys,Object);n.exports=o},function(n,e){n.exports=function(n,e){return function(t){return n(e(t))}}},function(n,e,t){var o=t(207),a=t(40),s=t(208),r=t(84),i=t(209),l=t(14),c=t(74),p=c(o),d=c(a),m=c(s),u=c(r),h=c(i),g=l;(o&&"[object DataView]"!=g(new o(new ArrayBuffer(1)))||a&&"[object Map]"!=g(new a)||s&&"[object Promise]"!=g(s.resolve())||r&&"[object Set]"!=g(new r)||i&&"[object WeakMap]"!=g(new i))&&(g=function(n){var e=l(n),t="[object Object]"==e?n.constructor:void 0,o=t?c(t):"";if(o)switch(o){case p:return"[object DataView]";case d:return"[object Map]";case m:return"[object Promise]";case u:return"[object Set]";case h:return"[object WeakMap]"}return e}),n.exports=g},function(n,e,t){var o=t(10)(t(8),"DataView");n.exports=o},function(n,e,t){var o=t(10)(t(8),"Promise");n.exports=o},function(n,e,t){var o=t(10)(t(8),"WeakMap");n.exports=o},function(n,e,t){var o=t(85),a=t(79);n.exports=function(n){for(var e=a(n),t=e.length;t--;){var s=e[t],r=n[s];e[t]=[s,r,o(r)]}return e}},function(n,e,t){var o=t(75),a=t(212),s=t(219),r=t(45),i=t(85),l=t(86),c=t(26);n.exports=function(n,e){return r(n)&&i(e)?l(c(n),e):function(t){var r=a(t,n);return void 0===r&&r===e?s(t,n):o(e,r,3)}}},function(n,e,t){var o=t(87);n.exports=function(n,e,t){var a=null==n?void 0:o(n,e);return void 0===a?t:a}},function(n,e,t){var o=t(214),a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,s=/\\(\\)?/g,r=o((function(n){var e=[];return 46===n.charCodeAt(0)&&e.push(""),n.replace(a,(function(n,t,o,a){e.push(o?a.replace(s,"$1"):t||n)})),e}));n.exports=r},function(n,e,t){var o=t(215);n.exports=function(n){var e=o(n,(function(n){return 500===t.size&&t.clear(),n})),t=e.cache;return e}},function(n,e,t){var o=t(42);function a(n,e){if("function"!=typeof n||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var t=function(){var o=arguments,a=e?e.apply(this,o):o[0],s=t.cache;if(s.has(a))return s.get(a);var r=n.apply(this,o);return t.cache=s.set(a,r)||s,r};return t.cache=new(a.Cache||o),t}a.Cache=o,n.exports=a},function(n,e,t){var o=t(217);n.exports=function(n){return null==n?"":o(n)}},function(n,e,t){var o=t(16),a=t(218),s=t(6),r=t(46),i=o?o.prototype:void 0,l=i?i.toString:void 0;n.exports=function n(e){if("string"==typeof e)return e;if(s(e))return a(e,n)+"";if(r(e))return l?l.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(n,e){n.exports=function(n,e){for(var t=-1,o=null==n?0:n.length,a=Array(o);++t<o;)a[t]=e(n[t],t,n);return a}},function(n,e,t){var o=t(220),a=t(221);n.exports=function(n,e){return null!=n&&a(n,e,o)}},function(n,e){n.exports=function(n,e){return null!=n&&e in Object(n)}},function(n,e,t){var o=t(88),a=t(39),s=t(6),r=t(81),i=t(44),l=t(26);n.exports=function(n,e,t){for(var c=-1,p=(e=o(e,n)).length,d=!1;++c<p;){var m=l(e[c]);if(!(d=null!=n&&t(n,m)))break;n=n[m]}return d||++c!=p?d:!!(p=null==n?0:n.length)&&i(p)&&r(m,p)&&(s(n)||a(n))}},function(n,e,t){var o=t(223),a=t(224),s=t(45),r=t(26);n.exports=function(n){return s(n)?o(r(n)):a(n)}},function(n,e){n.exports=function(n){return function(e){return null==e?void 0:e[n]}}},function(n,e,t){var o=t(87);n.exports=function(n){return function(e){return o(e,n)}}},function(n,e,t){var o=t(47),a=t(226),s=t(228);n.exports=function(n,e){return s(a(n,e,o),n+"")}},function(n,e,t){var o=t(227),a=Math.max;n.exports=function(n,e,t){return e=a(void 0===e?n.length-1:e,0),function(){for(var s=arguments,r=-1,i=a(s.length-e,0),l=Array(i);++r<i;)l[r]=s[e+r];r=-1;for(var c=Array(e+1);++r<e;)c[r]=s[r];return c[e]=t(l),o(n,this,c)}}},function(n,e){n.exports=function(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}},function(n,e,t){var o=t(229),a=t(232)(o);n.exports=a},function(n,e,t){var o=t(230),a=t(231),s=t(47),r=a?function(n,e){return a(n,"toString",{configurable:!0,enumerable:!1,value:o(e),writable:!0})}:s;n.exports=r},function(n,e){n.exports=function(n){return function(){return n}}},function(n,e,t){var o=t(10),a=function(){try{var n=o(Object,"defineProperty");return n({},"",{}),n}catch(n){}}();n.exports=a},function(n,e){var t=Date.now;n.exports=function(n){var e=0,o=0;return function(){var a=t(),s=16-(a-o);if(o=a,s>0){if(++e>=800)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}},function(n,e,t){var o=t(77),a=t(234),s=t(239),r=t(78),i=t(240),l=t(43);n.exports=function(n,e,t){var c=-1,p=a,d=n.length,m=!0,u=[],h=u;if(t)m=!1,p=s;else if(d>=200){var g=e?null:i(n);if(g)return l(g);m=!1,p=r,h=new o}else h=e?[]:u;n:for(;++c<d;){var b=n[c],f=e?e(b):b;if(b=t||0!==b?b:0,m&&f==f){for(var y=h.length;y--;)if(h[y]===f)continue n;e&&h.push(f),u.push(b)}else p(h,f,t)||(h!==u&&h.push(f),u.push(b))}return u}},function(n,e,t){var o=t(235);n.exports=function(n,e){return!!(null==n?0:n.length)&&o(n,e,0)>-1}},function(n,e,t){var o=t(236),a=t(237),s=t(238);n.exports=function(n,e,t){return e==e?s(n,e,t):o(n,a,t)}},function(n,e){n.exports=function(n,e,t,o){for(var a=n.length,s=t+(o?1:-1);o?s--:++s<a;)if(e(n[s],s,n))return s;return-1}},function(n,e){n.exports=function(n){return n!=n}},function(n,e){n.exports=function(n,e,t){for(var o=t-1,a=n.length;++o<a;)if(n[o]===e)return o;return-1}},function(n,e){n.exports=function(n,e,t){for(var o=-1,a=null==n?0:n.length;++o<a;)if(t(e,n[o]))return!0;return!1}},function(n,e,t){var o=t(84),a=t(241),s=t(43),r=o&&1/s(new o([,-0]))[1]==1/0?function(n){return new o(n)}:a;n.exports=r},function(n,e){n.exports=function(){}},function(n,e,t){var o=t(83),a=t(12);n.exports=function(n){return a(n)&&o(n)}},function(n,e,t){},function(n,e,t){},function(n,e,t){"use strict";t(89)},function(n,e,t){"use strict";t(90)},function(n,e,t){},function(n,e,t){},function(n,e,t){"use strict";t(91)},function(n,e,t){"use strict";t(92)},function(n,e,t){var o=t(19),a=t(3),s=t(252);o({global:!0},{Reflect:{}}),s(a.Reflect,"Reflect",!0)},function(n,e,t){var o=t(13).f,a=t(7),s=t(21)("toStringTag");n.exports=function(n,e,t){n&&!t&&(n=n.prototype),n&&!a(n,s)&&o(n,s,{configurable:!0,value:e})}},function(n,e){},function(n,e){function t(n,e){for(var t=0,o=n.length-1;o>=0;o--){var a=n[o];"."===a?n.splice(o,1):".."===a?(n.splice(o,1),t++):t&&(n.splice(o,1),t--)}if(e)for(;t--;t)n.unshift("..");return n}function o(n,e){if(n.filter)return n.filter(e);for(var t=[],o=0;o<n.length;o++)e(n[o],o,n)&&t.push(n[o]);return t}e.resolve=function(){for(var n="",e=!1,a=arguments.length-1;a>=-1&&!e;a--){var s=a>=0?arguments[a]:process.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(n=s+"/"+n,e="/"===s.charAt(0))}return(e?"/":"")+(n=t(o(n.split("/"),(function(n){return!!n})),!e).join("/"))||"."},e.normalize=function(n){var s=e.isAbsolute(n),r="/"===a(n,-1);return(n=t(o(n.split("/"),(function(n){return!!n})),!s).join("/"))||s||(n="."),n&&r&&(n+="/"),(s?"/":"")+n},e.isAbsolute=function(n){return"/"===n.charAt(0)},e.join=function(){var n=Array.prototype.slice.call(arguments,0);return e.normalize(o(n,(function(n,e){if("string"!=typeof n)throw new TypeError("Arguments to path.join must be strings");return n})).join("/"))},e.relative=function(n,t){function o(n){for(var e=0;e<n.length&&""===n[e];e++);for(var t=n.length-1;t>=0&&""===n[t];t--);return e>t?[]:n.slice(e,t-e+1)}n=e.resolve(n).substr(1),t=e.resolve(t).substr(1);for(var a=o(n.split("/")),s=o(t.split("/")),r=Math.min(a.length,s.length),i=r,l=0;l<r;l++)if(a[l]!==s[l]){i=l;break}var c=[];for(l=i;l<a.length;l++)c.push("..");return(c=c.concat(s.slice(i))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(n){if("string"!=typeof n&&(n+=""),0===n.length)return".";for(var e=n.charCodeAt(0),t=47===e,o=-1,a=!0,s=n.length-1;s>=1;--s)if(47===(e=n.charCodeAt(s))){if(!a){o=s;break}}else a=!1;return-1===o?t?"/":".":t&&1===o?"/":n.slice(0,o)},e.basename=function(n,e){var t=function(n){"string"!=typeof n&&(n+="");var e,t=0,o=-1,a=!0;for(e=n.length-1;e>=0;--e)if(47===n.charCodeAt(e)){if(!a){t=e+1;break}}else-1===o&&(a=!1,o=e+1);return-1===o?"":n.slice(t,o)}(n);return e&&t.substr(-1*e.length)===e&&(t=t.substr(0,t.length-e.length)),t},e.extname=function(n){"string"!=typeof n&&(n+="");for(var e=-1,t=0,o=-1,a=!0,s=0,r=n.length-1;r>=0;--r){var i=n.charCodeAt(r);if(47!==i)-1===o&&(a=!1,o=r+1),46===i?-1===e?e=r:1!==s&&(s=1):-1!==e&&(s=-1);else if(!a){t=r+1;break}}return-1===e||-1===o||0===s||1===s&&e===o-1&&e===t+1?"":n.slice(e,o)};var a="b"==="ab".substr(-1)?function(n,e,t){return n.substr(e,t)}:function(n,e,t){return e<0&&(e=n.length+e),n.substr(e,t)}},function(n,e,t){"use strict";var o=/[|\\{}()[\]^$+*?.]/g,a=Object.prototype.hasOwnProperty,s=function(n,e){return a.apply(n,[e])};e.escapeRegExpChars=function(n){return n?String(n).replace(o,"\\$&"):""};var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},i=/[&<>'"]/g;function l(n){return r[n]||n}e.escapeXML=function(n){return null==n?"":String(n).replace(i,l)},e.escapeXML.toString=function(){return Function.prototype.toString.call(this)+';\nvar _ENCODE_HTML_RULES = {\n      "&": "&amp;"\n    , "<": "&lt;"\n    , ">": "&gt;"\n    , \'"\': "&#34;"\n    , "\'": "&#39;"\n    }\n  , _MATCH_HTML = /[&<>\'"]/g;\nfunction encode_char(c) {\n  return _ENCODE_HTML_RULES[c] || c;\n};\n'},e.shallowCopy=function(n,e){if(e=e||{},null!=n)for(var t in e)s(e,t)&&"__proto__"!==t&&"constructor"!==t&&(n[t]=e[t]);return n},e.shallowCopyFromList=function(n,e,t){if(t=t||[],e=e||{},null!=n)for(var o=0;o<t.length;o++){var a=t[o];if(void 0!==e[a]){if(!s(e,a))continue;if("__proto__"===a||"constructor"===a)continue;n[a]=e[a]}}return n},e.cache={_data:{},set:function(n,e){this._data[n]=e},get:function(n){return this._data[n]},remove:function(n){delete this._data[n]},reset:function(){this._data={}}},e.hyphenToCamel=function(n){return n.replace(/-[a-z]/g,(function(n){return n[1].toUpperCase()}))},e.createNullProtoObjWherePossible="function"==typeof Object.create?function(){return Object.create(null)}:{__proto__:null}instanceof Object?function(){return{}}:function(){return{__proto__:null}}},function(n){n.exports=JSON.parse('{"name":"ejs","description":"Embedded JavaScript templates","keywords":["template","engine","ejs"],"version":"3.1.8","author":"Matthew Eernisse <mde@fleegix.org> (http://fleegix.org)","license":"Apache-2.0","bin":{"ejs":"./bin/cli.js"},"main":"./lib/ejs.js","jsdelivr":"ejs.min.js","unpkg":"ejs.min.js","repository":{"type":"git","url":"git://github.com/mde/ejs.git"},"bugs":"https://github.com/mde/ejs/issues","homepage":"https://github.com/mde/ejs","dependencies":{"jake":"^10.8.5"},"devDependencies":{"browserify":"^16.5.1","eslint":"^6.8.0","git-directory-deploy":"^1.5.1","jsdoc":"^3.6.7","lru-cache":"^4.0.1","mocha":"^7.1.1","uglify-js":"^3.3.16"},"engines":{"node":">=0.10.0"},"scripts":{"test":"mocha"}}')},function(n,e,t){"use strict";t(93)},function(n,e,t){"use strict";t(94)},function(n,e,t){"use strict";t.r(e);
/*!
 * Vue.js v2.7.14
 * (c) 2014-2022 Evan You
 * Released under the MIT License.
 */
var o=Object.freeze({}),a=Array.isArray;function s(n){return null==n}function r(n){return null!=n}function i(n){return!0===n}function l(n){return"string"==typeof n||"number"==typeof n||"symbol"==typeof n||"boolean"==typeof n}function c(n){return"function"==typeof n}function p(n){return null!==n&&"object"==typeof n}var d=Object.prototype.toString;function m(n){return"[object Object]"===d.call(n)}function u(n){return"[object RegExp]"===d.call(n)}function h(n){var e=parseFloat(String(n));return e>=0&&Math.floor(e)===e&&isFinite(n)}function g(n){return r(n)&&"function"==typeof n.then&&"function"==typeof n.catch}function b(n){return null==n?"":Array.isArray(n)||m(n)&&n.toString===d?JSON.stringify(n,null,2):String(n)}function f(n){var e=parseFloat(n);return isNaN(e)?n:e}function y(n,e){for(var t=Object.create(null),o=n.split(","),a=0;a<o.length;a++)t[o[a]]=!0;return e?function(n){return t[n.toLowerCase()]}:function(n){return t[n]}}y("slot,component",!0);var _=y("key,ref,slot,slot-scope,is");function v(n,e){var t=n.length;if(t){if(e===n[t-1])return void(n.length=t-1);var o=n.indexOf(e);if(o>-1)return n.splice(o,1)}}var k=Object.prototype.hasOwnProperty;function x(n,e){return k.call(n,e)}function w(n){var e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}var E=/-(\w)/g,A=w((function(n){return n.replace(E,(function(n,e){return e?e.toUpperCase():""}))})),z=w((function(n){return n.charAt(0).toUpperCase()+n.slice(1)})),B=/\B([A-Z])/g,T=w((function(n){return n.replace(B,"-$1").toLowerCase()}));var S=Function.prototype.bind?function(n,e){return n.bind(e)}:function(n,e){function t(t){var o=arguments.length;return o?o>1?n.apply(e,arguments):n.call(e,t):n.call(e)}return t._length=n.length,t};function $(n,e){e=e||0;for(var t=n.length-e,o=new Array(t);t--;)o[t]=n[t+e];return o}function j(n,e){for(var t in e)n[t]=e[t];return n}function I(n){for(var e={},t=0;t<n.length;t++)n[t]&&j(e,n[t]);return e}function P(n,e,t){}var D=function(n,e,t){return!1},C=function(n){return n};function R(n,e){if(n===e)return!0;var t=p(n),o=p(e);if(!t||!o)return!t&&!o&&String(n)===String(e);try{var a=Array.isArray(n),s=Array.isArray(e);if(a&&s)return n.length===e.length&&n.every((function(n,t){return R(n,e[t])}));if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(a||s)return!1;var r=Object.keys(n),i=Object.keys(e);return r.length===i.length&&r.every((function(t){return R(n[t],e[t])}))}catch(n){return!1}}function O(n,e){for(var t=0;t<n.length;t++)if(R(n[t],e))return t;return-1}function L(n){var e=!1;return function(){e||(e=!0,n.apply(this,arguments))}}function M(n,e){return n===e?0===n&&1/n!=1/e:n==n||e==e}var q=["component","directive","filter"],N=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch","renderTracked","renderTriggered"],F={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:D,isReservedAttr:D,isUnknownElement:D,getTagNamespace:P,parsePlatformTagName:C,mustUseProp:D,async:!0,_lifecycleHooks:N},U=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function G(n){var e=(n+"").charCodeAt(0);return 36===e||95===e}function H(n,e,t,o){Object.defineProperty(n,e,{value:t,enumerable:!!o,writable:!0,configurable:!0})}var V=new RegExp("[^".concat(U.source,".$_\\d]"));var Z="__proto__"in{},K="undefined"!=typeof window,W=K&&window.navigator.userAgent.toLowerCase(),Y=W&&/msie|trident/.test(W),X=W&&W.indexOf("msie 9.0")>0,Q=W&&W.indexOf("edge/")>0;W&&W.indexOf("android");var J=W&&/iphone|ipad|ipod|ios/.test(W);W&&/chrome\/\d+/.test(W),W&&/phantomjs/.test(W);var nn,en=W&&W.match(/firefox\/(\d+)/),tn={}.watch,on=!1;if(K)try{var an={};Object.defineProperty(an,"passive",{get:function(){on=!0}}),window.addEventListener("test-passive",null,an)}catch(Bl){}var sn=function(){return void 0===nn&&(nn=!K&&"undefined"!=typeof global&&(global.process&&"server"===global.process.env.VUE_ENV)),nn},rn=K&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function ln(n){return"function"==typeof n&&/native code/.test(n.toString())}var cn,pn="undefined"!=typeof Symbol&&ln(Symbol)&&"undefined"!=typeof Reflect&&ln(Reflect.ownKeys);cn="undefined"!=typeof Set&&ln(Set)?Set:function(){function n(){this.set=Object.create(null)}return n.prototype.has=function(n){return!0===this.set[n]},n.prototype.add=function(n){this.set[n]=!0},n.prototype.clear=function(){this.set=Object.create(null)},n}();var dn=null;function mn(n){void 0===n&&(n=null),n||dn&&dn._scope.off(),dn=n,n&&n._scope.on()}var un=function(){function n(n,e,t,o,a,s,r,i){this.tag=n,this.data=e,this.children=t,this.text=o,this.elm=a,this.ns=void 0,this.context=s,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=r,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=i,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1}return Object.defineProperty(n.prototype,"child",{get:function(){return this.componentInstance},enumerable:!1,configurable:!0}),n}(),hn=function(n){void 0===n&&(n="");var e=new un;return e.text=n,e.isComment=!0,e};function gn(n){return new un(void 0,void 0,void 0,String(n))}function bn(n){var e=new un(n.tag,n.data,n.children&&n.children.slice(),n.text,n.elm,n.context,n.componentOptions,n.asyncFactory);return e.ns=n.ns,e.isStatic=n.isStatic,e.key=n.key,e.isComment=n.isComment,e.fnContext=n.fnContext,e.fnOptions=n.fnOptions,e.fnScopeId=n.fnScopeId,e.asyncMeta=n.asyncMeta,e.isCloned=!0,e}var fn=0,yn=[],_n=function(){function n(){this._pending=!1,this.id=fn++,this.subs=[]}return n.prototype.addSub=function(n){this.subs.push(n)},n.prototype.removeSub=function(n){this.subs[this.subs.indexOf(n)]=null,this._pending||(this._pending=!0,yn.push(this))},n.prototype.depend=function(e){n.target&&n.target.addDep(this)},n.prototype.notify=function(n){var e=this.subs.filter((function(n){return n}));for(var t=0,o=e.length;t<o;t++){0,e[t].update()}},n}();_n.target=null;var vn=[];function kn(n){vn.push(n),_n.target=n}function xn(){vn.pop(),_n.target=vn[vn.length-1]}var wn=Array.prototype,En=Object.create(wn);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(n){var e=wn[n];H(En,n,(function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];var a,s=e.apply(this,t),r=this.__ob__;switch(n){case"push":case"unshift":a=t;break;case"splice":a=t.slice(2)}return a&&r.observeArray(a),r.dep.notify(),s}))}));var An=Object.getOwnPropertyNames(En),zn={},Bn=!0;function Tn(n){Bn=n}var Sn={notify:P,depend:P,addSub:P,removeSub:P},$n=function(){function n(n,e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),this.value=n,this.shallow=e,this.mock=t,this.dep=t?Sn:new _n,this.vmCount=0,H(n,"__ob__",this),a(n)){if(!t)if(Z)n.__proto__=En;else for(var o=0,s=An.length;o<s;o++){H(n,i=An[o],En[i])}e||this.observeArray(n)}else{var r=Object.keys(n);for(o=0;o<r.length;o++){var i;In(n,i=r[o],zn,void 0,e,t)}}}return n.prototype.observeArray=function(n){for(var e=0,t=n.length;e<t;e++)jn(n[e],!1,this.mock)},n}();function jn(n,e,t){return n&&x(n,"__ob__")&&n.__ob__ instanceof $n?n.__ob__:!Bn||!t&&sn()||!a(n)&&!m(n)||!Object.isExtensible(n)||n.__v_skip||Mn(n)||n instanceof un?void 0:new $n(n,e,t)}function In(n,e,t,o,s,r){var i=new _n,l=Object.getOwnPropertyDescriptor(n,e);if(!l||!1!==l.configurable){var c=l&&l.get,p=l&&l.set;c&&!p||t!==zn&&2!==arguments.length||(t=n[e]);var d=!s&&jn(t,!1,r);return Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){var e=c?c.call(n):t;return _n.target&&(i.depend(),d&&(d.dep.depend(),a(e)&&Cn(e))),Mn(e)&&!s?e.value:e},set:function(e){var o=c?c.call(n):t;if(M(o,e)){if(p)p.call(n,e);else{if(c)return;if(!s&&Mn(o)&&!Mn(e))return void(o.value=e);t=e}d=!s&&jn(e,!1,r),i.notify()}}}),i}}function Pn(n,e,t){if(!Ln(n)){var o=n.__ob__;return a(n)&&h(e)?(n.length=Math.max(n.length,e),n.splice(e,1,t),o&&!o.shallow&&o.mock&&jn(t,!1,!0),t):e in n&&!(e in Object.prototype)?(n[e]=t,t):n._isVue||o&&o.vmCount?t:o?(In(o.value,e,t,void 0,o.shallow,o.mock),o.dep.notify(),t):(n[e]=t,t)}}function Dn(n,e){if(a(n)&&h(e))n.splice(e,1);else{var t=n.__ob__;n._isVue||t&&t.vmCount||Ln(n)||x(n,e)&&(delete n[e],t&&t.dep.notify())}}function Cn(n){for(var e=void 0,t=0,o=n.length;t<o;t++)(e=n[t])&&e.__ob__&&e.__ob__.dep.depend(),a(e)&&Cn(e)}function Rn(n){return On(n,!0),H(n,"__v_isShallow",!0),n}function On(n,e){if(!Ln(n)){jn(n,e,sn());0}}function Ln(n){return!(!n||!n.__v_isReadonly)}function Mn(n){return!(!n||!0!==n.__v_isRef)}function qn(n,e,t){Object.defineProperty(n,t,{enumerable:!0,configurable:!0,get:function(){var n=e[t];if(Mn(n))return n.value;var o=n&&n.__ob__;return o&&o.dep.depend(),n},set:function(n){var o=e[t];Mn(o)&&!Mn(n)?o.value=n:e[t]=n}})}"".concat("watcher"," callback"),"".concat("watcher"," getter"),"".concat("watcher"," cleanup");var Nn;var Fn=function(){function n(n){void 0===n&&(n=!1),this.detached=n,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Nn,!n&&Nn&&(this.index=(Nn.scopes||(Nn.scopes=[])).push(this)-1)}return n.prototype.run=function(n){if(this.active){var e=Nn;try{return Nn=this,n()}finally{Nn=e}}else 0},n.prototype.on=function(){Nn=this},n.prototype.off=function(){Nn=this.parent},n.prototype.stop=function(n){if(this.active){var e=void 0,t=void 0;for(e=0,t=this.effects.length;e<t;e++)this.effects[e].teardown();for(e=0,t=this.cleanups.length;e<t;e++)this.cleanups[e]();if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!n){var o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.parent=void 0,this.active=!1}},n}();function Un(n){var e=n._provided,t=n.$parent&&n.$parent._provided;return t===e?n._provided=Object.create(t):e}var Gn=w((function(n){var e="&"===n.charAt(0),t="~"===(n=e?n.slice(1):n).charAt(0),o="!"===(n=t?n.slice(1):n).charAt(0);return{name:n=o?n.slice(1):n,once:t,capture:o,passive:e}}));function Hn(n,e){function t(){var n=t.fns;if(!a(n))return Be(n,null,arguments,e,"v-on handler");for(var o=n.slice(),s=0;s<o.length;s++)Be(o[s],null,arguments,e,"v-on handler")}return t.fns=n,t}function Vn(n,e,t,o,a,r){var l,c,p,d;for(l in n)c=n[l],p=e[l],d=Gn(l),s(c)||(s(p)?(s(c.fns)&&(c=n[l]=Hn(c,r)),i(d.once)&&(c=n[l]=a(d.name,c,d.capture)),t(d.name,c,d.capture,d.passive,d.params)):c!==p&&(p.fns=c,n[l]=p));for(l in e)s(n[l])&&o((d=Gn(l)).name,e[l],d.capture)}function Zn(n,e,t){var o;n instanceof un&&(n=n.data.hook||(n.data.hook={}));var a=n[e];function l(){t.apply(this,arguments),v(o.fns,l)}s(a)?o=Hn([l]):r(a.fns)&&i(a.merged)?(o=a).fns.push(l):o=Hn([a,l]),o.merged=!0,n[e]=o}function Kn(n,e,t,o,a){if(r(e)){if(x(e,t))return n[t]=e[t],a||delete e[t],!0;if(x(e,o))return n[t]=e[o],a||delete e[o],!0}return!1}function Wn(n){return l(n)?[gn(n)]:a(n)?function n(e,t){var o,c,p,d,m=[];for(o=0;o<e.length;o++)s(c=e[o])||"boolean"==typeof c||(p=m.length-1,d=m[p],a(c)?c.length>0&&(Yn((c=n(c,"".concat(t||"","_").concat(o)))[0])&&Yn(d)&&(m[p]=gn(d.text+c[0].text),c.shift()),m.push.apply(m,c)):l(c)?Yn(d)?m[p]=gn(d.text+c):""!==c&&m.push(gn(c)):Yn(c)&&Yn(d)?m[p]=gn(d.text+c.text):(i(e._isVList)&&r(c.tag)&&s(c.key)&&r(t)&&(c.key="__vlist".concat(t,"_").concat(o,"__")),m.push(c)));return m}(n):void 0}function Yn(n){return r(n)&&r(n.text)&&function(n){return!1===n}(n.isComment)}function Xn(n,e){var t,o,s,i,l=null;if(a(n)||"string"==typeof n)for(l=new Array(n.length),t=0,o=n.length;t<o;t++)l[t]=e(n[t],t);else if("number"==typeof n)for(l=new Array(n),t=0;t<n;t++)l[t]=e(t+1,t);else if(p(n))if(pn&&n[Symbol.iterator]){l=[];for(var c=n[Symbol.iterator](),d=c.next();!d.done;)l.push(e(d.value,l.length)),d=c.next()}else for(s=Object.keys(n),l=new Array(s.length),t=0,o=s.length;t<o;t++)i=s[t],l[t]=e(n[i],i,t);return r(l)||(l=[]),l._isVList=!0,l}function Qn(n,e,t,o){var a,s=this.$scopedSlots[n];s?(t=t||{},o&&(t=j(j({},o),t)),a=s(t)||(c(e)?e():e)):a=this.$slots[n]||(c(e)?e():e);var r=t&&t.slot;return r?this.$createElement("template",{slot:r},a):a}function Jn(n){return $t(this.$options,"filters",n,!0)||C}function ne(n,e){return a(n)?-1===n.indexOf(e):n!==e}function ee(n,e,t,o,a){var s=F.keyCodes[e]||t;return a&&o&&!F.keyCodes[e]?ne(a,o):s?ne(s,n):o?T(o)!==e:void 0===n}function te(n,e,t,o,s){if(t)if(p(t)){a(t)&&(t=I(t));var r=void 0,i=function(a){if("class"===a||"style"===a||_(a))r=n;else{var i=n.attrs&&n.attrs.type;r=o||F.mustUseProp(e,i,a)?n.domProps||(n.domProps={}):n.attrs||(n.attrs={})}var l=A(a),c=T(a);l in r||c in r||(r[a]=t[a],s&&((n.on||(n.on={}))["update:".concat(a)]=function(n){t[a]=n}))};for(var l in t)i(l)}else;return n}function oe(n,e){var t=this._staticTrees||(this._staticTrees=[]),o=t[n];return o&&!e||se(o=t[n]=this.$options.staticRenderFns[n].call(this._renderProxy,this._c,this),"__static__".concat(n),!1),o}function ae(n,e,t){return se(n,"__once__".concat(e).concat(t?"_".concat(t):""),!0),n}function se(n,e,t){if(a(n))for(var o=0;o<n.length;o++)n[o]&&"string"!=typeof n[o]&&re(n[o],"".concat(e,"_").concat(o),t);else re(n,e,t)}function re(n,e,t){n.isStatic=!0,n.key=e,n.isOnce=t}function ie(n,e){if(e)if(m(e)){var t=n.on=n.on?j({},n.on):{};for(var o in e){var a=t[o],s=e[o];t[o]=a?[].concat(a,s):s}}else;return n}function le(n,e,t,o){e=e||{$stable:!t};for(var s=0;s<n.length;s++){var r=n[s];a(r)?le(r,e,t):r&&(r.proxy&&(r.fn.proxy=!0),e[r.key]=r.fn)}return o&&(e.$key=o),e}function ce(n,e){for(var t=0;t<e.length;t+=2){var o=e[t];"string"==typeof o&&o&&(n[e[t]]=e[t+1])}return n}function pe(n,e){return"string"==typeof n?e+n:n}function de(n){n._o=ae,n._n=f,n._s=b,n._l=Xn,n._t=Qn,n._q=R,n._i=O,n._m=oe,n._f=Jn,n._k=ee,n._b=te,n._v=gn,n._e=hn,n._u=le,n._g=ie,n._d=ce,n._p=pe}function me(n,e){if(!n||!n.length)return{};for(var t={},o=0,a=n.length;o<a;o++){var s=n[o],r=s.data;if(r&&r.attrs&&r.attrs.slot&&delete r.attrs.slot,s.context!==e&&s.fnContext!==e||!r||null==r.slot)(t.default||(t.default=[])).push(s);else{var i=r.slot,l=t[i]||(t[i]=[]);"template"===s.tag?l.push.apply(l,s.children||[]):l.push(s)}}for(var c in t)t[c].every(ue)&&delete t[c];return t}function ue(n){return n.isComment&&!n.asyncFactory||" "===n.text}function he(n){return n.isComment&&n.asyncFactory}function ge(n,e,t,a){var s,r=Object.keys(t).length>0,i=e?!!e.$stable:!r,l=e&&e.$key;if(e){if(e._normalized)return e._normalized;if(i&&a&&a!==o&&l===a.$key&&!r&&!a.$hasNormal)return a;for(var c in s={},e)e[c]&&"$"!==c[0]&&(s[c]=be(n,t,c,e[c]))}else s={};for(var p in t)p in s||(s[p]=fe(t,p));return e&&Object.isExtensible(e)&&(e._normalized=s),H(s,"$stable",i),H(s,"$key",l),H(s,"$hasNormal",r),s}function be(n,e,t,o){var s=function(){var e=dn;mn(n);var t=arguments.length?o.apply(null,arguments):o({}),s=(t=t&&"object"==typeof t&&!a(t)?[t]:Wn(t))&&t[0];return mn(e),t&&(!s||1===t.length&&s.isComment&&!he(s))?void 0:t};return o.proxy&&Object.defineProperty(e,t,{get:s,enumerable:!0,configurable:!0}),s}function fe(n,e){return function(){return n[e]}}function ye(n){return{get attrs(){if(!n._attrsProxy){var e=n._attrsProxy={};H(e,"_v_attr_proxy",!0),_e(e,n.$attrs,o,n,"$attrs")}return n._attrsProxy},get listeners(){n._listenersProxy||_e(n._listenersProxy={},n.$listeners,o,n,"$listeners");return n._listenersProxy},get slots(){return function(n){n._slotsProxy||ke(n._slotsProxy={},n.$scopedSlots);return n._slotsProxy}(n)},emit:S(n.$emit,n),expose:function(e){e&&Object.keys(e).forEach((function(t){return qn(n,e,t)}))}}}function _e(n,e,t,o,a){var s=!1;for(var r in e)r in n?e[r]!==t[r]&&(s=!0):(s=!0,ve(n,r,o,a));for(var r in n)r in e||(s=!0,delete n[r]);return s}function ve(n,e,t,o){Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){return t[o][e]}})}function ke(n,e){for(var t in e)n[t]=e[t];for(var t in n)t in e||delete n[t]}var xe=null;function we(n,e){return(n.__esModule||pn&&"Module"===n[Symbol.toStringTag])&&(n=n.default),p(n)?e.extend(n):n}function Ee(n){if(a(n))for(var e=0;e<n.length;e++){var t=n[e];if(r(t)&&(r(t.componentOptions)||he(t)))return t}}function Ae(n,e,t,o,d,m){return(a(t)||l(t))&&(d=o,o=t,t=void 0),i(m)&&(d=2),function(n,e,t,o,l){if(r(t)&&r(t.__ob__))return hn();r(t)&&r(t.is)&&(e=t.is);if(!e)return hn();0;a(o)&&c(o[0])&&((t=t||{}).scopedSlots={default:o[0]},o.length=0);2===l?o=Wn(o):1===l&&(o=function(n){for(var e=0;e<n.length;e++)if(a(n[e]))return Array.prototype.concat.apply([],n);return n}(o));var d,m;if("string"==typeof e){var u=void 0;m=n.$vnode&&n.$vnode.ns||F.getTagNamespace(e),d=F.isReservedTag(e)?new un(F.parsePlatformTagName(e),t,o,void 0,void 0,n):t&&t.pre||!r(u=$t(n.$options,"components",e))?new un(e,t,o,void 0,void 0,n):vt(u,t,n,o,e)}else d=vt(e,t,n,o);return a(d)?d:r(d)?(r(m)&&function n(e,t,o){e.ns=t,"foreignObject"===e.tag&&(t=void 0,o=!0);if(r(e.children))for(var a=0,l=e.children.length;a<l;a++){var c=e.children[a];r(c.tag)&&(s(c.ns)||i(o)&&"svg"!==c.tag)&&n(c,t,o)}}(d,m),r(t)&&function(n){p(n.style)&&Fe(n.style);p(n.class)&&Fe(n.class)}(t),d):hn()}(n,e,t,o,d)}function ze(n,e,t){kn();try{if(e)for(var o=e;o=o.$parent;){var a=o.$options.errorCaptured;if(a)for(var s=0;s<a.length;s++)try{if(!1===a[s].call(o,n,e,t))return}catch(n){Te(n,o,"errorCaptured hook")}}Te(n,e,t)}finally{xn()}}function Be(n,e,t,o,a){var s;try{(s=t?n.apply(e,t):n.call(e))&&!s._isVue&&g(s)&&!s._handled&&(s.catch((function(n){return ze(n,o,a+" (Promise/async)")})),s._handled=!0)}catch(n){ze(n,o,a)}return s}function Te(n,e,t){if(F.errorHandler)try{return F.errorHandler.call(null,n,e,t)}catch(e){e!==n&&Se(e,null,"config.errorHandler")}Se(n,e,t)}function Se(n,e,t){if(!K||"undefined"==typeof console)throw n;console.error(n)}var $e,je=!1,Ie=[],Pe=!1;function De(){Pe=!1;var n=Ie.slice(0);Ie.length=0;for(var e=0;e<n.length;e++)n[e]()}if("undefined"!=typeof Promise&&ln(Promise)){var Ce=Promise.resolve();$e=function(){Ce.then(De),J&&setTimeout(P)},je=!0}else if(Y||"undefined"==typeof MutationObserver||!ln(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())$e="undefined"!=typeof setImmediate&&ln(setImmediate)?function(){setImmediate(De)}:function(){setTimeout(De,0)};else{var Re=1,Oe=new MutationObserver(De),Le=document.createTextNode(String(Re));Oe.observe(Le,{characterData:!0}),$e=function(){Re=(Re+1)%2,Le.data=String(Re)},je=!0}function Me(n,e){var t;if(Ie.push((function(){if(n)try{n.call(e)}catch(n){ze(n,e,"nextTick")}else t&&t(e)})),Pe||(Pe=!0,$e()),!n&&"undefined"!=typeof Promise)return new Promise((function(n){t=n}))}function qe(n){return function(e,t){if(void 0===t&&(t=dn),t)return function(n,e,t){var o=n.$options;o[e]=zt(o[e],t)}(t,n,e)}}qe("beforeMount"),qe("mounted"),qe("beforeUpdate"),qe("updated"),qe("beforeDestroy"),qe("destroyed"),qe("activated"),qe("deactivated"),qe("serverPrefetch"),qe("renderTracked"),qe("renderTriggered"),qe("errorCaptured");var Ne=new cn;function Fe(n){return function n(e,t){var o,s,r=a(e);if(!r&&!p(e)||e.__v_skip||Object.isFrozen(e)||e instanceof un)return;if(e.__ob__){var i=e.__ob__.dep.id;if(t.has(i))return;t.add(i)}if(r)for(o=e.length;o--;)n(e[o],t);else if(Mn(e))n(e.value,t);else for(s=Object.keys(e),o=s.length;o--;)n(e[s[o]],t)}(n,Ne),Ne.clear(),n}var Ue,Ge=0,He=function(){function n(n,e,t,o,a){var s,r;s=this,void 0===(r=Nn&&!Nn._vm?Nn:n?n._scope:void 0)&&(r=Nn),r&&r.active&&r.effects.push(s),(this.vm=n)&&a&&(n._watcher=this),o?(this.deep=!!o.deep,this.user=!!o.user,this.lazy=!!o.lazy,this.sync=!!o.sync,this.before=o.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=t,this.id=++Ge,this.active=!0,this.post=!1,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new cn,this.newDepIds=new cn,this.expression="",c(e)?this.getter=e:(this.getter=function(n){if(!V.test(n)){var e=n.split(".");return function(n){for(var t=0;t<e.length;t++){if(!n)return;n=n[e[t]]}return n}}}(e),this.getter||(this.getter=P)),this.value=this.lazy?void 0:this.get()}return n.prototype.get=function(){var n;kn(this);var e=this.vm;try{n=this.getter.call(e,e)}catch(n){if(!this.user)throw n;ze(n,e,'getter for watcher "'.concat(this.expression,'"'))}finally{this.deep&&Fe(n),xn(),this.cleanupDeps()}return n},n.prototype.addDep=function(n){var e=n.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(n),this.depIds.has(e)||n.addSub(this))},n.prototype.cleanupDeps=function(){for(var n=this.deps.length;n--;){var e=this.deps[n];this.newDepIds.has(e.id)||e.removeSub(this)}var t=this.depIds;this.depIds=this.newDepIds,this.newDepIds=t,this.newDepIds.clear(),t=this.deps,this.deps=this.newDeps,this.newDeps=t,this.newDeps.length=0},n.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():mt(this)},n.prototype.run=function(){if(this.active){var n=this.get();if(n!==this.value||p(n)||this.deep){var e=this.value;if(this.value=n,this.user){var t='callback for watcher "'.concat(this.expression,'"');Be(this.cb,this.vm,[n,e],this.vm,t)}else this.cb.call(this.vm,n,e)}}},n.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},n.prototype.depend=function(){for(var n=this.deps.length;n--;)this.deps[n].depend()},n.prototype.teardown=function(){if(this.vm&&!this.vm._isBeingDestroyed&&v(this.vm._scope.effects,this),this.active){for(var n=this.deps.length;n--;)this.deps[n].removeSub(this);this.active=!1,this.onStop&&this.onStop()}},n}();function Ve(n,e){Ue.$on(n,e)}function Ze(n,e){Ue.$off(n,e)}function Ke(n,e){var t=Ue;return function o(){var a=e.apply(null,arguments);null!==a&&t.$off(n,o)}}function We(n,e,t){Ue=n,Vn(e,t||{},Ve,Ze,Ke,n),Ue=void 0}var Ye=null;function Xe(n){var e=Ye;return Ye=n,function(){Ye=e}}function Qe(n){for(;n&&(n=n.$parent);)if(n._inactive)return!0;return!1}function Je(n,e){if(e){if(n._directInactive=!1,Qe(n))return}else if(n._directInactive)return;if(n._inactive||null===n._inactive){n._inactive=!1;for(var t=0;t<n.$children.length;t++)Je(n.$children[t]);nt(n,"activated")}}function nt(n,e,t,o){void 0===o&&(o=!0),kn();var a=dn;o&&mn(n);var s=n.$options[e],r="".concat(e," hook");if(s)for(var i=0,l=s.length;i<l;i++)Be(s[i],n,t||null,n,r);n._hasHookEvent&&n.$emit("hook:"+e),o&&mn(a),xn()}var et=[],tt=[],ot={},at=!1,st=!1,rt=0;var it=0,lt=Date.now;if(K&&!Y){var ct=window.performance;ct&&"function"==typeof ct.now&&lt()>document.createEvent("Event").timeStamp&&(lt=function(){return ct.now()})}var pt=function(n,e){if(n.post){if(!e.post)return 1}else if(e.post)return-1;return n.id-e.id};function dt(){var n,e;for(it=lt(),st=!0,et.sort(pt),rt=0;rt<et.length;rt++)(n=et[rt]).before&&n.before(),e=n.id,ot[e]=null,n.run();var t=tt.slice(),o=et.slice();rt=et.length=tt.length=0,ot={},at=st=!1,function(n){for(var e=0;e<n.length;e++)n[e]._inactive=!0,Je(n[e],!0)}(t),function(n){var e=n.length;for(;e--;){var t=n[e],o=t.vm;o&&o._watcher===t&&o._isMounted&&!o._isDestroyed&&nt(o,"updated")}}(o),function(){for(var n=0;n<yn.length;n++){var e=yn[n];e.subs=e.subs.filter((function(n){return n})),e._pending=!1}yn.length=0}(),rn&&F.devtools&&rn.emit("flush")}function mt(n){var e=n.id;if(null==ot[e]&&(n!==_n.target||!n.noRecurse)){if(ot[e]=!0,st){for(var t=et.length-1;t>rt&&et[t].id>n.id;)t--;et.splice(t+1,0,n)}else et.push(n);at||(at=!0,Me(dt))}}function ut(n,e){if(n){for(var t=Object.create(null),o=pn?Reflect.ownKeys(n):Object.keys(n),a=0;a<o.length;a++){var s=o[a];if("__ob__"!==s){var r=n[s].from;if(r in e._provided)t[s]=e._provided[r];else if("default"in n[s]){var i=n[s].default;t[s]=c(i)?i.call(e):i}else 0}}return t}}function ht(n,e,t,s,r){var l,c=this,p=r.options;x(s,"_uid")?(l=Object.create(s))._original=s:(l=s,s=s._original);var d=i(p._compiled),m=!d;this.data=n,this.props=e,this.children=t,this.parent=s,this.listeners=n.on||o,this.injections=ut(p.inject,s),this.slots=function(){return c.$slots||ge(s,n.scopedSlots,c.$slots=me(t,s)),c.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return ge(s,n.scopedSlots,this.slots())}}),d&&(this.$options=p,this.$slots=this.slots(),this.$scopedSlots=ge(s,n.scopedSlots,this.$slots)),p._scopeId?this._c=function(n,e,t,o){var r=Ae(l,n,e,t,o,m);return r&&!a(r)&&(r.fnScopeId=p._scopeId,r.fnContext=s),r}:this._c=function(n,e,t,o){return Ae(l,n,e,t,o,m)}}function gt(n,e,t,o,a){var s=bn(n);return s.fnContext=t,s.fnOptions=o,e.slot&&((s.data||(s.data={})).slot=e.slot),s}function bt(n,e){for(var t in e)n[A(t)]=e[t]}function ft(n){return n.name||n.__name||n._componentTag}de(ht.prototype);var yt={init:function(n,e){if(n.componentInstance&&!n.componentInstance._isDestroyed&&n.data.keepAlive){var t=n;yt.prepatch(t,t)}else{(n.componentInstance=function(n,e){var t={_isComponent:!0,_parentVnode:n,parent:e},o=n.data.inlineTemplate;r(o)&&(t.render=o.render,t.staticRenderFns=o.staticRenderFns);return new n.componentOptions.Ctor(t)}(n,Ye)).$mount(e?n.elm:void 0,e)}},prepatch:function(n,e){var t=e.componentOptions;!function(n,e,t,a,s){var r=a.data.scopedSlots,i=n.$scopedSlots,l=!!(r&&!r.$stable||i!==o&&!i.$stable||r&&n.$scopedSlots.$key!==r.$key||!r&&n.$scopedSlots.$key),c=!!(s||n.$options._renderChildren||l),p=n.$vnode;n.$options._parentVnode=a,n.$vnode=a,n._vnode&&(n._vnode.parent=a),n.$options._renderChildren=s;var d=a.data.attrs||o;n._attrsProxy&&_e(n._attrsProxy,d,p.data&&p.data.attrs||o,n,"$attrs")&&(c=!0),n.$attrs=d,t=t||o;var m=n.$options._parentListeners;if(n._listenersProxy&&_e(n._listenersProxy,t,m||o,n,"$listeners"),n.$listeners=n.$options._parentListeners=t,We(n,t,m),e&&n.$options.props){Tn(!1);for(var u=n._props,h=n.$options._propKeys||[],g=0;g<h.length;g++){var b=h[g],f=n.$options.props;u[b]=jt(b,f,e,n)}Tn(!0),n.$options.propsData=e}c&&(n.$slots=me(s,a.context),n.$forceUpdate())}(e.componentInstance=n.componentInstance,t.propsData,t.listeners,e,t.children)},insert:function(n){var e,t=n.context,o=n.componentInstance;o._isMounted||(o._isMounted=!0,nt(o,"mounted")),n.data.keepAlive&&(t._isMounted?((e=o)._inactive=!1,tt.push(e)):Je(o,!0))},destroy:function(n){var e=n.componentInstance;e._isDestroyed||(n.data.keepAlive?function n(e,t){if(!(t&&(e._directInactive=!0,Qe(e))||e._inactive)){e._inactive=!0;for(var o=0;o<e.$children.length;o++)n(e.$children[o]);nt(e,"deactivated")}}(e,!0):e.$destroy())}},_t=Object.keys(yt);function vt(n,e,t,l,c){if(!s(n)){var d=t.$options._base;if(p(n)&&(n=d.extend(n)),"function"==typeof n){var m;if(s(n.cid)&&void 0===(n=function(n,e){if(i(n.error)&&r(n.errorComp))return n.errorComp;if(r(n.resolved))return n.resolved;var t=xe;if(t&&r(n.owners)&&-1===n.owners.indexOf(t)&&n.owners.push(t),i(n.loading)&&r(n.loadingComp))return n.loadingComp;if(t&&!r(n.owners)){var o=n.owners=[t],a=!0,l=null,c=null;t.$on("hook:destroyed",(function(){return v(o,t)}));var d=function(n){for(var e=0,t=o.length;e<t;e++)o[e].$forceUpdate();n&&(o.length=0,null!==l&&(clearTimeout(l),l=null),null!==c&&(clearTimeout(c),c=null))},m=L((function(t){n.resolved=we(t,e),a?o.length=0:d(!0)})),u=L((function(e){r(n.errorComp)&&(n.error=!0,d(!0))})),h=n(m,u);return p(h)&&(g(h)?s(n.resolved)&&h.then(m,u):g(h.component)&&(h.component.then(m,u),r(h.error)&&(n.errorComp=we(h.error,e)),r(h.loading)&&(n.loadingComp=we(h.loading,e),0===h.delay?n.loading=!0:l=setTimeout((function(){l=null,s(n.resolved)&&s(n.error)&&(n.loading=!0,d(!1))}),h.delay||200)),r(h.timeout)&&(c=setTimeout((function(){c=null,s(n.resolved)&&u(null)}),h.timeout)))),a=!1,n.loading?n.loadingComp:n.resolved}}(m=n,d)))return function(n,e,t,o,a){var s=hn();return s.asyncFactory=n,s.asyncMeta={data:e,context:t,children:o,tag:a},s}(m,e,t,l,c);e=e||{},Ht(n),r(e.model)&&function(n,e){var t=n.model&&n.model.prop||"value",o=n.model&&n.model.event||"input";(e.attrs||(e.attrs={}))[t]=e.model.value;var s=e.on||(e.on={}),i=s[o],l=e.model.callback;r(i)?(a(i)?-1===i.indexOf(l):i!==l)&&(s[o]=[l].concat(i)):s[o]=l}(n.options,e);var u=function(n,e,t){var o=e.options.props;if(!s(o)){var a={},i=n.attrs,l=n.props;if(r(i)||r(l))for(var c in o){var p=T(c);Kn(a,l,c,p,!0)||Kn(a,i,c,p,!1)}return a}}(e,n);if(i(n.options.functional))return function(n,e,t,s,i){var l=n.options,c={},p=l.props;if(r(p))for(var d in p)c[d]=jt(d,p,e||o);else r(t.attrs)&&bt(c,t.attrs),r(t.props)&&bt(c,t.props);var m=new ht(t,c,i,s,n),u=l.render.call(null,m._c,m);if(u instanceof un)return gt(u,t,m.parent,l,m);if(a(u)){for(var h=Wn(u)||[],g=new Array(h.length),b=0;b<h.length;b++)g[b]=gt(h[b],t,m.parent,l,m);return g}}(n,u,e,t,l);var h=e.on;if(e.on=e.nativeOn,i(n.options.abstract)){var b=e.slot;e={},b&&(e.slot=b)}!function(n){for(var e=n.hook||(n.hook={}),t=0;t<_t.length;t++){var o=_t[t],a=e[o],s=yt[o];a===s||a&&a._merged||(e[o]=a?kt(s,a):s)}}(e);var f=ft(n.options)||c;return new un("vue-component-".concat(n.cid).concat(f?"-".concat(f):""),e,void 0,void 0,void 0,t,{Ctor:n,propsData:u,listeners:h,tag:c,children:l},m)}}}function kt(n,e){var t=function(t,o){n(t,o),e(t,o)};return t._merged=!0,t}var xt=P,wt=F.optionMergeStrategies;function Et(n,e,t){if(void 0===t&&(t=!0),!e)return n;for(var o,a,s,r=pn?Reflect.ownKeys(e):Object.keys(e),i=0;i<r.length;i++)"__ob__"!==(o=r[i])&&(a=n[o],s=e[o],t&&x(n,o)?a!==s&&m(a)&&m(s)&&Et(a,s):Pn(n,o,s));return n}function At(n,e,t){return t?function(){var o=c(e)?e.call(t,t):e,a=c(n)?n.call(t,t):n;return o?Et(o,a):a}:e?n?function(){return Et(c(e)?e.call(this,this):e,c(n)?n.call(this,this):n)}:e:n}function zt(n,e){var t=e?n?n.concat(e):a(e)?e:[e]:n;return t?function(n){for(var e=[],t=0;t<n.length;t++)-1===e.indexOf(n[t])&&e.push(n[t]);return e}(t):t}function Bt(n,e,t,o){var a=Object.create(n||null);return e?j(a,e):a}wt.data=function(n,e,t){return t?At(n,e,t):e&&"function"!=typeof e?n:At(n,e)},N.forEach((function(n){wt[n]=zt})),q.forEach((function(n){wt[n+"s"]=Bt})),wt.watch=function(n,e,t,o){if(n===tn&&(n=void 0),e===tn&&(e=void 0),!e)return Object.create(n||null);if(!n)return e;var s={};for(var r in j(s,n),e){var i=s[r],l=e[r];i&&!a(i)&&(i=[i]),s[r]=i?i.concat(l):a(l)?l:[l]}return s},wt.props=wt.methods=wt.inject=wt.computed=function(n,e,t,o){if(!n)return e;var a=Object.create(null);return j(a,n),e&&j(a,e),a},wt.provide=function(n,e){return n?function(){var t=Object.create(null);return Et(t,c(n)?n.call(this):n),e&&Et(t,c(e)?e.call(this):e,!1),t}:e};var Tt=function(n,e){return void 0===e?n:e};function St(n,e,t){if(c(e)&&(e=e.options),function(n,e){var t=n.props;if(t){var o,s,r={};if(a(t))for(o=t.length;o--;)"string"==typeof(s=t[o])&&(r[A(s)]={type:null});else if(m(t))for(var i in t)s=t[i],r[A(i)]=m(s)?s:{type:s};else 0;n.props=r}}(e),function(n,e){var t=n.inject;if(t){var o=n.inject={};if(a(t))for(var s=0;s<t.length;s++)o[t[s]]={from:t[s]};else if(m(t))for(var r in t){var i=t[r];o[r]=m(i)?j({from:r},i):{from:i}}else 0}}(e),function(n){var e=n.directives;if(e)for(var t in e){var o=e[t];c(o)&&(e[t]={bind:o,update:o})}}(e),!e._base&&(e.extends&&(n=St(n,e.extends,t)),e.mixins))for(var o=0,s=e.mixins.length;o<s;o++)n=St(n,e.mixins[o],t);var r,i={};for(r in n)l(r);for(r in e)x(n,r)||l(r);function l(o){var a=wt[o]||Tt;i[o]=a(n[o],e[o],t,o)}return i}function $t(n,e,t,o){if("string"==typeof t){var a=n[e];if(x(a,t))return a[t];var s=A(t);if(x(a,s))return a[s];var r=z(s);return x(a,r)?a[r]:a[t]||a[s]||a[r]}}function jt(n,e,t,o){var a=e[n],s=!x(t,n),r=t[n],i=Ct(Boolean,a.type);if(i>-1)if(s&&!x(a,"default"))r=!1;else if(""===r||r===T(n)){var l=Ct(String,a.type);(l<0||i<l)&&(r=!0)}if(void 0===r){r=function(n,e,t){if(!x(e,"default"))return;var o=e.default;0;if(n&&n.$options.propsData&&void 0===n.$options.propsData[t]&&void 0!==n._props[t])return n._props[t];return c(o)&&"Function"!==Pt(e.type)?o.call(n):o}(o,a,n);var p=Bn;Tn(!0),jn(r),Tn(p)}return r}var It=/^\s*function (\w+)/;function Pt(n){var e=n&&n.toString().match(It);return e?e[1]:""}function Dt(n,e){return Pt(n)===Pt(e)}function Ct(n,e){if(!a(e))return Dt(e,n)?0:-1;for(var t=0,o=e.length;t<o;t++)if(Dt(e[t],n))return t;return-1}var Rt={enumerable:!0,configurable:!0,get:P,set:P};function Ot(n,e,t){Rt.get=function(){return this[e][t]},Rt.set=function(n){this[e][t]=n},Object.defineProperty(n,t,Rt)}function Lt(n){var e=n.$options;if(e.props&&function(n,e){var t=n.$options.propsData||{},o=n._props=Rn({}),a=n.$options._propKeys=[];n.$parent&&Tn(!1);var s=function(s){a.push(s);var r=jt(s,e,t,n);In(o,s,r),s in n||Ot(n,"_props",s)};for(var r in e)s(r);Tn(!0)}(n,e.props),function(n){var e=n.$options,t=e.setup;if(t){var o=n._setupContext=ye(n);mn(n),kn();var a=Be(t,null,[n._props||Rn({}),o],n,"setup");if(xn(),mn(),c(a))e.render=a;else if(p(a))if(n._setupState=a,a.__sfc){var s=n._setupProxy={};for(var r in a)"__sfc"!==r&&qn(s,a,r)}else for(var r in a)G(r)||qn(n,a,r);else 0}}(n),e.methods&&function(n,e){n.$options.props;for(var t in e)n[t]="function"!=typeof e[t]?P:S(e[t],n)}(n,e.methods),e.data)!function(n){var e=n.$options.data;m(e=n._data=c(e)?function(n,e){kn();try{return n.call(e,e)}catch(n){return ze(n,e,"data()"),{}}finally{xn()}}(e,n):e||{})||(e={});var t=Object.keys(e),o=n.$options.props,a=(n.$options.methods,t.length);for(;a--;){var s=t[a];0,o&&x(o,s)||G(s)||Ot(n,"_data",s)}var r=jn(e);r&&r.vmCount++}(n);else{var t=jn(n._data={});t&&t.vmCount++}e.computed&&function(n,e){var t=n._computedWatchers=Object.create(null),o=sn();for(var a in e){var s=e[a],r=c(s)?s:s.get;0,o||(t[a]=new He(n,r||P,P,Mt)),a in n||qt(n,a,s)}}(n,e.computed),e.watch&&e.watch!==tn&&function(n,e){for(var t in e){var o=e[t];if(a(o))for(var s=0;s<o.length;s++)Ut(n,t,o[s]);else Ut(n,t,o)}}(n,e.watch)}var Mt={lazy:!0};function qt(n,e,t){var o=!sn();c(t)?(Rt.get=o?Nt(e):Ft(t),Rt.set=P):(Rt.get=t.get?o&&!1!==t.cache?Nt(e):Ft(t.get):P,Rt.set=t.set||P),Object.defineProperty(n,e,Rt)}function Nt(n){return function(){var e=this._computedWatchers&&this._computedWatchers[n];if(e)return e.dirty&&e.evaluate(),_n.target&&e.depend(),e.value}}function Ft(n){return function(){return n.call(this,this)}}function Ut(n,e,t,o){return m(t)&&(o=t,t=t.handler),"string"==typeof t&&(t=n[t]),n.$watch(e,t,o)}var Gt=0;function Ht(n){var e=n.options;if(n.super){var t=Ht(n.super);if(t!==n.superOptions){n.superOptions=t;var o=function(n){var e,t=n.options,o=n.sealedOptions;for(var a in t)t[a]!==o[a]&&(e||(e={}),e[a]=t[a]);return e}(n);o&&j(n.extendOptions,o),(e=n.options=St(t,n.extendOptions)).name&&(e.components[e.name]=n)}}return e}function Vt(n){this._init(n)}function Zt(n){n.cid=0;var e=1;n.extend=function(n){n=n||{};var t=this,o=t.cid,a=n._Ctor||(n._Ctor={});if(a[o])return a[o];var s=ft(n)||ft(t.options);var r=function(n){this._init(n)};return(r.prototype=Object.create(t.prototype)).constructor=r,r.cid=e++,r.options=St(t.options,n),r.super=t,r.options.props&&function(n){var e=n.options.props;for(var t in e)Ot(n.prototype,"_props",t)}(r),r.options.computed&&function(n){var e=n.options.computed;for(var t in e)qt(n.prototype,t,e[t])}(r),r.extend=t.extend,r.mixin=t.mixin,r.use=t.use,q.forEach((function(n){r[n]=t[n]})),s&&(r.options.components[s]=r),r.superOptions=t.options,r.extendOptions=n,r.sealedOptions=j({},r.options),a[o]=r,r}}function Kt(n){return n&&(ft(n.Ctor.options)||n.tag)}function Wt(n,e){return a(n)?n.indexOf(e)>-1:"string"==typeof n?n.split(",").indexOf(e)>-1:!!u(n)&&n.test(e)}function Yt(n,e){var t=n.cache,o=n.keys,a=n._vnode;for(var s in t){var r=t[s];if(r){var i=r.name;i&&!e(i)&&Xt(t,s,o,a)}}}function Xt(n,e,t,o){var a=n[e];!a||o&&a.tag===o.tag||a.componentInstance.$destroy(),n[e]=null,v(t,e)}!function(n){n.prototype._init=function(n){var e=this;e._uid=Gt++,e._isVue=!0,e.__v_skip=!0,e._scope=new Fn(!0),e._scope._vm=!0,n&&n._isComponent?function(n,e){var t=n.$options=Object.create(n.constructor.options),o=e._parentVnode;t.parent=e.parent,t._parentVnode=o;var a=o.componentOptions;t.propsData=a.propsData,t._parentListeners=a.listeners,t._renderChildren=a.children,t._componentTag=a.tag,e.render&&(t.render=e.render,t.staticRenderFns=e.staticRenderFns)}(e,n):e.$options=St(Ht(e.constructor),n||{},e),e._renderProxy=e,e._self=e,function(n){var e=n.$options,t=e.parent;if(t&&!e.abstract){for(;t.$options.abstract&&t.$parent;)t=t.$parent;t.$children.push(n)}n.$parent=t,n.$root=t?t.$root:n,n.$children=[],n.$refs={},n._provided=t?t._provided:Object.create(null),n._watcher=null,n._inactive=null,n._directInactive=!1,n._isMounted=!1,n._isDestroyed=!1,n._isBeingDestroyed=!1}(e),function(n){n._events=Object.create(null),n._hasHookEvent=!1;var e=n.$options._parentListeners;e&&We(n,e)}(e),function(n){n._vnode=null,n._staticTrees=null;var e=n.$options,t=n.$vnode=e._parentVnode,a=t&&t.context;n.$slots=me(e._renderChildren,a),n.$scopedSlots=t?ge(n.$parent,t.data.scopedSlots,n.$slots):o,n._c=function(e,t,o,a){return Ae(n,e,t,o,a,!1)},n.$createElement=function(e,t,o,a){return Ae(n,e,t,o,a,!0)};var s=t&&t.data;In(n,"$attrs",s&&s.attrs||o,null,!0),In(n,"$listeners",e._parentListeners||o,null,!0)}(e),nt(e,"beforeCreate",void 0,!1),function(n){var e=ut(n.$options.inject,n);e&&(Tn(!1),Object.keys(e).forEach((function(t){In(n,t,e[t])})),Tn(!0))}(e),Lt(e),function(n){var e=n.$options.provide;if(e){var t=c(e)?e.call(n):e;if(!p(t))return;for(var o=Un(n),a=pn?Reflect.ownKeys(t):Object.keys(t),s=0;s<a.length;s++){var r=a[s];Object.defineProperty(o,r,Object.getOwnPropertyDescriptor(t,r))}}}(e),nt(e,"created"),e.$options.el&&e.$mount(e.$options.el)}}(Vt),function(n){var e={get:function(){return this._data}},t={get:function(){return this._props}};Object.defineProperty(n.prototype,"$data",e),Object.defineProperty(n.prototype,"$props",t),n.prototype.$set=Pn,n.prototype.$delete=Dn,n.prototype.$watch=function(n,e,t){if(m(e))return Ut(this,n,e,t);(t=t||{}).user=!0;var o=new He(this,n,e,t);if(t.immediate){var a='callback for immediate watcher "'.concat(o.expression,'"');kn(),Be(e,this,[o.value],this,a),xn()}return function(){o.teardown()}}}(Vt),function(n){var e=/^hook:/;n.prototype.$on=function(n,t){var o=this;if(a(n))for(var s=0,r=n.length;s<r;s++)o.$on(n[s],t);else(o._events[n]||(o._events[n]=[])).push(t),e.test(n)&&(o._hasHookEvent=!0);return o},n.prototype.$once=function(n,e){var t=this;function o(){t.$off(n,o),e.apply(t,arguments)}return o.fn=e,t.$on(n,o),t},n.prototype.$off=function(n,e){var t=this;if(!arguments.length)return t._events=Object.create(null),t;if(a(n)){for(var o=0,s=n.length;o<s;o++)t.$off(n[o],e);return t}var r,i=t._events[n];if(!i)return t;if(!e)return t._events[n]=null,t;for(var l=i.length;l--;)if((r=i[l])===e||r.fn===e){i.splice(l,1);break}return t},n.prototype.$emit=function(n){var e=this,t=e._events[n];if(t){t=t.length>1?$(t):t;for(var o=$(arguments,1),a='event handler for "'.concat(n,'"'),s=0,r=t.length;s<r;s++)Be(t[s],e,o,e,a)}return e}}(Vt),function(n){n.prototype._update=function(n,e){var t=this,o=t.$el,a=t._vnode,s=Xe(t);t._vnode=n,t.$el=a?t.__patch__(a,n):t.__patch__(t.$el,n,e,!1),s(),o&&(o.__vue__=null),t.$el&&(t.$el.__vue__=t);for(var r=t;r&&r.$vnode&&r.$parent&&r.$vnode===r.$parent._vnode;)r.$parent.$el=r.$el,r=r.$parent},n.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},n.prototype.$destroy=function(){var n=this;if(!n._isBeingDestroyed){nt(n,"beforeDestroy"),n._isBeingDestroyed=!0;var e=n.$parent;!e||e._isBeingDestroyed||n.$options.abstract||v(e.$children,n),n._scope.stop(),n._data.__ob__&&n._data.__ob__.vmCount--,n._isDestroyed=!0,n.__patch__(n._vnode,null),nt(n,"destroyed"),n.$off(),n.$el&&(n.$el.__vue__=null),n.$vnode&&(n.$vnode.parent=null)}}}(Vt),function(n){de(n.prototype),n.prototype.$nextTick=function(n){return Me(n,this)},n.prototype._render=function(){var n,e=this,t=e.$options,o=t.render,s=t._parentVnode;s&&e._isMounted&&(e.$scopedSlots=ge(e.$parent,s.data.scopedSlots,e.$slots,e.$scopedSlots),e._slotsProxy&&ke(e._slotsProxy,e.$scopedSlots)),e.$vnode=s;try{mn(e),xe=e,n=o.call(e._renderProxy,e.$createElement)}catch(t){ze(t,e,"render"),n=e._vnode}finally{xe=null,mn()}return a(n)&&1===n.length&&(n=n[0]),n instanceof un||(n=hn()),n.parent=s,n}}(Vt);var Qt=[String,RegExp,Array],Jt={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:Qt,exclude:Qt,max:[String,Number]},methods:{cacheVNode:function(){var n=this.cache,e=this.keys,t=this.vnodeToCache,o=this.keyToCache;if(t){var a=t.tag,s=t.componentInstance,r=t.componentOptions;n[o]={name:Kt(r),tag:a,componentInstance:s},e.push(o),this.max&&e.length>parseInt(this.max)&&Xt(n,e[0],e,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var n in this.cache)Xt(this.cache,n,this.keys)},mounted:function(){var n=this;this.cacheVNode(),this.$watch("include",(function(e){Yt(n,(function(n){return Wt(e,n)}))})),this.$watch("exclude",(function(e){Yt(n,(function(n){return!Wt(e,n)}))}))},updated:function(){this.cacheVNode()},render:function(){var n=this.$slots.default,e=Ee(n),t=e&&e.componentOptions;if(t){var o=Kt(t),a=this.include,s=this.exclude;if(a&&(!o||!Wt(a,o))||s&&o&&Wt(s,o))return e;var r=this.cache,i=this.keys,l=null==e.key?t.Ctor.cid+(t.tag?"::".concat(t.tag):""):e.key;r[l]?(e.componentInstance=r[l].componentInstance,v(i,l),i.push(l)):(this.vnodeToCache=e,this.keyToCache=l),e.data.keepAlive=!0}return e||n&&n[0]}}};!function(n){var e={get:function(){return F}};Object.defineProperty(n,"config",e),n.util={warn:xt,extend:j,mergeOptions:St,defineReactive:In},n.set=Pn,n.delete=Dn,n.nextTick=Me,n.observable=function(n){return jn(n),n},n.options=Object.create(null),q.forEach((function(e){n.options[e+"s"]=Object.create(null)})),n.options._base=n,j(n.options.components,Jt),function(n){n.use=function(n){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(n)>-1)return this;var t=$(arguments,1);return t.unshift(this),c(n.install)?n.install.apply(n,t):c(n)&&n.apply(null,t),e.push(n),this}}(n),function(n){n.mixin=function(n){return this.options=St(this.options,n),this}}(n),Zt(n),function(n){q.forEach((function(e){n[e]=function(n,t){return t?("component"===e&&m(t)&&(t.name=t.name||n,t=this.options._base.extend(t)),"directive"===e&&c(t)&&(t={bind:t,update:t}),this.options[e+"s"][n]=t,t):this.options[e+"s"][n]}}))}(n)}(Vt),Object.defineProperty(Vt.prototype,"$isServer",{get:sn}),Object.defineProperty(Vt.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(Vt,"FunctionalRenderContext",{value:ht}),Vt.version="2.7.14";var no=y("style,class"),eo=y("input,textarea,option,select,progress"),to=y("contenteditable,draggable,spellcheck"),oo=y("events,caret,typing,plaintext-only"),ao=y("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),so="http://www.w3.org/1999/xlink",ro=function(n){return":"===n.charAt(5)&&"xlink"===n.slice(0,5)},io=function(n){return ro(n)?n.slice(6,n.length):""},lo=function(n){return null==n||!1===n};function co(n){for(var e=n.data,t=n,o=n;r(o.componentInstance);)(o=o.componentInstance._vnode)&&o.data&&(e=po(o.data,e));for(;r(t=t.parent);)t&&t.data&&(e=po(e,t.data));return function(n,e){if(r(n)||r(e))return mo(n,uo(e));return""}(e.staticClass,e.class)}function po(n,e){return{staticClass:mo(n.staticClass,e.staticClass),class:r(n.class)?[n.class,e.class]:e.class}}function mo(n,e){return n?e?n+" "+e:n:e||""}function uo(n){return Array.isArray(n)?function(n){for(var e,t="",o=0,a=n.length;o<a;o++)r(e=uo(n[o]))&&""!==e&&(t&&(t+=" "),t+=e);return t}(n):p(n)?function(n){var e="";for(var t in n)n[t]&&(e&&(e+=" "),e+=t);return e}(n):"string"==typeof n?n:""}var ho={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},go=y("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),bo=y("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),fo=function(n){return go(n)||bo(n)};var yo=Object.create(null);var _o=y("text,number,password,search,email,tel,url");var vo=Object.freeze({__proto__:null,createElement:function(n,e){var t=document.createElement(n);return"select"!==n||e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&t.setAttribute("multiple","multiple"),t},createElementNS:function(n,e){return document.createElementNS(ho[n],e)},createTextNode:function(n){return document.createTextNode(n)},createComment:function(n){return document.createComment(n)},insertBefore:function(n,e,t){n.insertBefore(e,t)},removeChild:function(n,e){n.removeChild(e)},appendChild:function(n,e){n.appendChild(e)},parentNode:function(n){return n.parentNode},nextSibling:function(n){return n.nextSibling},tagName:function(n){return n.tagName},setTextContent:function(n,e){n.textContent=e},setStyleScope:function(n,e){n.setAttribute(e,"")}}),ko={create:function(n,e){xo(e)},update:function(n,e){n.data.ref!==e.data.ref&&(xo(n,!0),xo(e))},destroy:function(n){xo(n,!0)}};function xo(n,e){var t=n.data.ref;if(r(t)){var o=n.context,s=n.componentInstance||n.elm,i=e?null:s,l=e?void 0:s;if(c(t))Be(t,o,[i],o,"template ref function");else{var p=n.data.refInFor,d="string"==typeof t||"number"==typeof t,m=Mn(t),u=o.$refs;if(d||m)if(p){var h=d?u[t]:t.value;e?a(h)&&v(h,s):a(h)?h.includes(s)||h.push(s):d?(u[t]=[s],wo(o,t,u[t])):t.value=[s]}else if(d){if(e&&u[t]!==s)return;u[t]=l,wo(o,t,i)}else if(m){if(e&&t.value!==s)return;t.value=i}else 0}}}function wo(n,e,t){var o=n._setupState;o&&x(o,e)&&(Mn(o[e])?o[e].value=t:o[e]=t)}var Eo=new un("",{},[]),Ao=["create","activate","update","remove","destroy"];function zo(n,e){return n.key===e.key&&n.asyncFactory===e.asyncFactory&&(n.tag===e.tag&&n.isComment===e.isComment&&r(n.data)===r(e.data)&&function(n,e){if("input"!==n.tag)return!0;var t,o=r(t=n.data)&&r(t=t.attrs)&&t.type,a=r(t=e.data)&&r(t=t.attrs)&&t.type;return o===a||_o(o)&&_o(a)}(n,e)||i(n.isAsyncPlaceholder)&&s(e.asyncFactory.error))}function Bo(n,e,t){var o,a,s={};for(o=e;o<=t;++o)r(a=n[o].key)&&(s[a]=o);return s}var To={create:So,update:So,destroy:function(n){So(n,Eo)}};function So(n,e){(n.data.directives||e.data.directives)&&function(n,e){var t,o,a,s=n===Eo,r=e===Eo,i=jo(n.data.directives,n.context),l=jo(e.data.directives,e.context),c=[],p=[];for(t in l)o=i[t],a=l[t],o?(a.oldValue=o.value,a.oldArg=o.arg,Po(a,"update",e,n),a.def&&a.def.componentUpdated&&p.push(a)):(Po(a,"bind",e,n),a.def&&a.def.inserted&&c.push(a));if(c.length){var d=function(){for(var t=0;t<c.length;t++)Po(c[t],"inserted",e,n)};s?Zn(e,"insert",d):d()}p.length&&Zn(e,"postpatch",(function(){for(var t=0;t<p.length;t++)Po(p[t],"componentUpdated",e,n)}));if(!s)for(t in i)l[t]||Po(i[t],"unbind",n,n,r)}(n,e)}var $o=Object.create(null);function jo(n,e){var t,o,a=Object.create(null);if(!n)return a;for(t=0;t<n.length;t++){if((o=n[t]).modifiers||(o.modifiers=$o),a[Io(o)]=o,e._setupState&&e._setupState.__sfc){var s=o.def||$t(e,"_setupState","v-"+o.name);o.def="function"==typeof s?{bind:s,update:s}:s}o.def=o.def||$t(e.$options,"directives",o.name)}return a}function Io(n){return n.rawName||"".concat(n.name,".").concat(Object.keys(n.modifiers||{}).join("."))}function Po(n,e,t,o,a){var s=n.def&&n.def[e];if(s)try{s(t.elm,n,t,o,a)}catch(o){ze(o,t.context,"directive ".concat(n.name," ").concat(e," hook"))}}var Do=[ko,To];function Co(n,e){var t=e.componentOptions;if(!(r(t)&&!1===t.Ctor.options.inheritAttrs||s(n.data.attrs)&&s(e.data.attrs))){var o,a,l=e.elm,c=n.data.attrs||{},p=e.data.attrs||{};for(o in(r(p.__ob__)||i(p._v_attr_proxy))&&(p=e.data.attrs=j({},p)),p)a=p[o],c[o]!==a&&Ro(l,o,a,e.data.pre);for(o in(Y||Q)&&p.value!==c.value&&Ro(l,"value",p.value),c)s(p[o])&&(ro(o)?l.removeAttributeNS(so,io(o)):to(o)||l.removeAttribute(o))}}function Ro(n,e,t,o){o||n.tagName.indexOf("-")>-1?Oo(n,e,t):ao(e)?lo(t)?n.removeAttribute(e):(t="allowfullscreen"===e&&"EMBED"===n.tagName?"true":e,n.setAttribute(e,t)):to(e)?n.setAttribute(e,function(n,e){return lo(e)||"false"===e?"false":"contenteditable"===n&&oo(e)?e:"true"}(e,t)):ro(e)?lo(t)?n.removeAttributeNS(so,io(e)):n.setAttributeNS(so,e,t):Oo(n,e,t)}function Oo(n,e,t){if(lo(t))n.removeAttribute(e);else{if(Y&&!X&&"TEXTAREA"===n.tagName&&"placeholder"===e&&""!==t&&!n.__ieph){var o=function(e){e.stopImmediatePropagation(),n.removeEventListener("input",o)};n.addEventListener("input",o),n.__ieph=!0}n.setAttribute(e,t)}}var Lo={create:Co,update:Co};function Mo(n,e){var t=e.elm,o=e.data,a=n.data;if(!(s(o.staticClass)&&s(o.class)&&(s(a)||s(a.staticClass)&&s(a.class)))){var i=co(e),l=t._transitionClasses;r(l)&&(i=mo(i,uo(l))),i!==t._prevClass&&(t.setAttribute("class",i),t._prevClass=i)}}var qo,No={create:Mo,update:Mo};function Fo(n,e,t){var o=qo;return function a(){var s=e.apply(null,arguments);null!==s&&Ho(n,a,t,o)}}var Uo=je&&!(en&&Number(en[1])<=53);function Go(n,e,t,o){if(Uo){var a=it,s=e;e=s._wrapper=function(n){if(n.target===n.currentTarget||n.timeStamp>=a||n.timeStamp<=0||n.target.ownerDocument!==document)return s.apply(this,arguments)}}qo.addEventListener(n,e,on?{capture:t,passive:o}:t)}function Ho(n,e,t,o){(o||qo).removeEventListener(n,e._wrapper||e,t)}function Vo(n,e){if(!s(n.data.on)||!s(e.data.on)){var t=e.data.on||{},o=n.data.on||{};qo=e.elm||n.elm,function(n){if(r(n.__r)){var e=Y?"change":"input";n[e]=[].concat(n.__r,n[e]||[]),delete n.__r}r(n.__c)&&(n.change=[].concat(n.__c,n.change||[]),delete n.__c)}(t),Vn(t,o,Go,Ho,Fo,e.context),qo=void 0}}var Zo,Ko={create:Vo,update:Vo,destroy:function(n){return Vo(n,Eo)}};function Wo(n,e){if(!s(n.data.domProps)||!s(e.data.domProps)){var t,o,a=e.elm,l=n.data.domProps||{},c=e.data.domProps||{};for(t in(r(c.__ob__)||i(c._v_attr_proxy))&&(c=e.data.domProps=j({},c)),l)t in c||(a[t]="");for(t in c){if(o=c[t],"textContent"===t||"innerHTML"===t){if(e.children&&(e.children.length=0),o===l[t])continue;1===a.childNodes.length&&a.removeChild(a.childNodes[0])}if("value"===t&&"PROGRESS"!==a.tagName){a._value=o;var p=s(o)?"":String(o);Yo(a,p)&&(a.value=p)}else if("innerHTML"===t&&bo(a.tagName)&&s(a.innerHTML)){(Zo=Zo||document.createElement("div")).innerHTML="<svg>".concat(o,"</svg>");for(var d=Zo.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;d.firstChild;)a.appendChild(d.firstChild)}else if(o!==l[t])try{a[t]=o}catch(n){}}}}function Yo(n,e){return!n.composing&&("OPTION"===n.tagName||function(n,e){var t=!0;try{t=document.activeElement!==n}catch(n){}return t&&n.value!==e}(n,e)||function(n,e){var t=n.value,o=n._vModifiers;if(r(o)){if(o.number)return f(t)!==f(e);if(o.trim)return t.trim()!==e.trim()}return t!==e}(n,e))}var Xo={create:Wo,update:Wo},Qo=w((function(n){var e={},t=/:(.+)/;return n.split(/;(?![^(]*\))/g).forEach((function(n){if(n){var o=n.split(t);o.length>1&&(e[o[0].trim()]=o[1].trim())}})),e}));function Jo(n){var e=na(n.style);return n.staticStyle?j(n.staticStyle,e):e}function na(n){return Array.isArray(n)?I(n):"string"==typeof n?Qo(n):n}var ea,ta=/^--/,oa=/\s*!important$/,aa=function(n,e,t){if(ta.test(e))n.style.setProperty(e,t);else if(oa.test(t))n.style.setProperty(T(e),t.replace(oa,""),"important");else{var o=ra(e);if(Array.isArray(t))for(var a=0,s=t.length;a<s;a++)n.style[o]=t[a];else n.style[o]=t}},sa=["Webkit","Moz","ms"],ra=w((function(n){if(ea=ea||document.createElement("div").style,"filter"!==(n=A(n))&&n in ea)return n;for(var e=n.charAt(0).toUpperCase()+n.slice(1),t=0;t<sa.length;t++){var o=sa[t]+e;if(o in ea)return o}}));function ia(n,e){var t=e.data,o=n.data;if(!(s(t.staticStyle)&&s(t.style)&&s(o.staticStyle)&&s(o.style))){var a,i,l=e.elm,c=o.staticStyle,p=o.normalizedStyle||o.style||{},d=c||p,m=na(e.data.style)||{};e.data.normalizedStyle=r(m.__ob__)?j({},m):m;var u=function(n,e){var t,o={};if(e)for(var a=n;a.componentInstance;)(a=a.componentInstance._vnode)&&a.data&&(t=Jo(a.data))&&j(o,t);(t=Jo(n.data))&&j(o,t);for(var s=n;s=s.parent;)s.data&&(t=Jo(s.data))&&j(o,t);return o}(e,!0);for(i in d)s(u[i])&&aa(l,i,"");for(i in u)(a=u[i])!==d[i]&&aa(l,i,null==a?"":a)}}var la={create:ia,update:ia},ca=/\s+/;function pa(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(ca).forEach((function(e){return n.classList.add(e)})):n.classList.add(e);else{var t=" ".concat(n.getAttribute("class")||""," ");t.indexOf(" "+e+" ")<0&&n.setAttribute("class",(t+e).trim())}}function da(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(ca).forEach((function(e){return n.classList.remove(e)})):n.classList.remove(e),n.classList.length||n.removeAttribute("class");else{for(var t=" ".concat(n.getAttribute("class")||""," "),o=" "+e+" ";t.indexOf(o)>=0;)t=t.replace(o," ");(t=t.trim())?n.setAttribute("class",t):n.removeAttribute("class")}}function ma(n){if(n){if("object"==typeof n){var e={};return!1!==n.css&&j(e,ua(n.name||"v")),j(e,n),e}return"string"==typeof n?ua(n):void 0}}var ua=w((function(n){return{enterClass:"".concat(n,"-enter"),enterToClass:"".concat(n,"-enter-to"),enterActiveClass:"".concat(n,"-enter-active"),leaveClass:"".concat(n,"-leave"),leaveToClass:"".concat(n,"-leave-to"),leaveActiveClass:"".concat(n,"-leave-active")}})),ha=K&&!X,ga="transition",ba="transitionend",fa="animation",ya="animationend";ha&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(ga="WebkitTransition",ba="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(fa="WebkitAnimation",ya="webkitAnimationEnd"));var _a=K?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(n){return n()};function va(n){_a((function(){_a(n)}))}function ka(n,e){var t=n._transitionClasses||(n._transitionClasses=[]);t.indexOf(e)<0&&(t.push(e),pa(n,e))}function xa(n,e){n._transitionClasses&&v(n._transitionClasses,e),da(n,e)}function wa(n,e,t){var o=Aa(n,e),a=o.type,s=o.timeout,r=o.propCount;if(!a)return t();var i="transition"===a?ba:ya,l=0,c=function(){n.removeEventListener(i,p),t()},p=function(e){e.target===n&&++l>=r&&c()};setTimeout((function(){l<r&&c()}),s+1),n.addEventListener(i,p)}var Ea=/\b(transform|all)(,|$)/;function Aa(n,e){var t,o=window.getComputedStyle(n),a=(o[ga+"Delay"]||"").split(", "),s=(o[ga+"Duration"]||"").split(", "),r=za(a,s),i=(o[fa+"Delay"]||"").split(", "),l=(o[fa+"Duration"]||"").split(", "),c=za(i,l),p=0,d=0;return"transition"===e?r>0&&(t="transition",p=r,d=s.length):"animation"===e?c>0&&(t="animation",p=c,d=l.length):d=(t=(p=Math.max(r,c))>0?r>c?"transition":"animation":null)?"transition"===t?s.length:l.length:0,{type:t,timeout:p,propCount:d,hasTransform:"transition"===t&&Ea.test(o[ga+"Property"])}}function za(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max.apply(null,e.map((function(e,t){return Ba(e)+Ba(n[t])})))}function Ba(n){return 1e3*Number(n.slice(0,-1).replace(",","."))}function Ta(n,e){var t=n.elm;r(t._leaveCb)&&(t._leaveCb.cancelled=!0,t._leaveCb());var o=ma(n.data.transition);if(!s(o)&&!r(t._enterCb)&&1===t.nodeType){for(var a=o.css,i=o.type,l=o.enterClass,d=o.enterToClass,m=o.enterActiveClass,u=o.appearClass,h=o.appearToClass,g=o.appearActiveClass,b=o.beforeEnter,y=o.enter,_=o.afterEnter,v=o.enterCancelled,k=o.beforeAppear,x=o.appear,w=o.afterAppear,E=o.appearCancelled,A=o.duration,z=Ye,B=Ye.$vnode;B&&B.parent;)z=B.context,B=B.parent;var T=!z._isMounted||!n.isRootInsert;if(!T||x||""===x){var S=T&&u?u:l,$=T&&g?g:m,j=T&&h?h:d,I=T&&k||b,P=T&&c(x)?x:y,D=T&&w||_,C=T&&E||v,R=f(p(A)?A.enter:A);0;var O=!1!==a&&!X,M=ja(P),q=t._enterCb=L((function(){O&&(xa(t,j),xa(t,$)),q.cancelled?(O&&xa(t,S),C&&C(t)):D&&D(t),t._enterCb=null}));n.data.show||Zn(n,"insert",(function(){var e=t.parentNode,o=e&&e._pending&&e._pending[n.key];o&&o.tag===n.tag&&o.elm._leaveCb&&o.elm._leaveCb(),P&&P(t,q)})),I&&I(t),O&&(ka(t,S),ka(t,$),va((function(){xa(t,S),q.cancelled||(ka(t,j),M||($a(R)?setTimeout(q,R):wa(t,i,q)))}))),n.data.show&&(e&&e(),P&&P(t,q)),O||M||q()}}}function Sa(n,e){var t=n.elm;r(t._enterCb)&&(t._enterCb.cancelled=!0,t._enterCb());var o=ma(n.data.transition);if(s(o)||1!==t.nodeType)return e();if(!r(t._leaveCb)){var a=o.css,i=o.type,l=o.leaveClass,c=o.leaveToClass,d=o.leaveActiveClass,m=o.beforeLeave,u=o.leave,h=o.afterLeave,g=o.leaveCancelled,b=o.delayLeave,y=o.duration,_=!1!==a&&!X,v=ja(u),k=f(p(y)?y.leave:y);0;var x=t._leaveCb=L((function(){t.parentNode&&t.parentNode._pending&&(t.parentNode._pending[n.key]=null),_&&(xa(t,c),xa(t,d)),x.cancelled?(_&&xa(t,l),g&&g(t)):(e(),h&&h(t)),t._leaveCb=null}));b?b(w):w()}function w(){x.cancelled||(!n.data.show&&t.parentNode&&((t.parentNode._pending||(t.parentNode._pending={}))[n.key]=n),m&&m(t),_&&(ka(t,l),ka(t,d),va((function(){xa(t,l),x.cancelled||(ka(t,c),v||($a(k)?setTimeout(x,k):wa(t,i,x)))}))),u&&u(t,x),_||v||x())}}function $a(n){return"number"==typeof n&&!isNaN(n)}function ja(n){if(s(n))return!1;var e=n.fns;return r(e)?ja(Array.isArray(e)?e[0]:e):(n._length||n.length)>1}function Ia(n,e){!0!==e.data.show&&Ta(e)}var Pa=function(n){var e,t,o={},c=n.modules,p=n.nodeOps;for(e=0;e<Ao.length;++e)for(o[Ao[e]]=[],t=0;t<c.length;++t)r(c[t][Ao[e]])&&o[Ao[e]].push(c[t][Ao[e]]);function d(n){var e=p.parentNode(n);r(e)&&p.removeChild(e,n)}function m(n,e,t,a,s,l,c){if(r(n.elm)&&r(l)&&(n=l[c]=bn(n)),n.isRootInsert=!s,!function(n,e,t,a){var s=n.data;if(r(s)){var l=r(n.componentInstance)&&s.keepAlive;if(r(s=s.hook)&&r(s=s.init)&&s(n,!1),r(n.componentInstance))return u(n,e),h(t,n.elm,a),i(l)&&function(n,e,t,a){var s,i=n;for(;i.componentInstance;)if(i=i.componentInstance._vnode,r(s=i.data)&&r(s=s.transition)){for(s=0;s<o.activate.length;++s)o.activate[s](Eo,i);e.push(i);break}h(t,n.elm,a)}(n,e,t,a),!0}}(n,e,t,a)){var d=n.data,m=n.children,b=n.tag;r(b)?(n.elm=n.ns?p.createElementNS(n.ns,b):p.createElement(b,n),_(n),g(n,m,e),r(d)&&f(n,e),h(t,n.elm,a)):i(n.isComment)?(n.elm=p.createComment(n.text),h(t,n.elm,a)):(n.elm=p.createTextNode(n.text),h(t,n.elm,a))}}function u(n,e){r(n.data.pendingInsert)&&(e.push.apply(e,n.data.pendingInsert),n.data.pendingInsert=null),n.elm=n.componentInstance.$el,b(n)?(f(n,e),_(n)):(xo(n),e.push(n))}function h(n,e,t){r(n)&&(r(t)?p.parentNode(t)===n&&p.insertBefore(n,e,t):p.appendChild(n,e))}function g(n,e,t){if(a(e)){0;for(var o=0;o<e.length;++o)m(e[o],t,n.elm,null,!0,e,o)}else l(n.text)&&p.appendChild(n.elm,p.createTextNode(String(n.text)))}function b(n){for(;n.componentInstance;)n=n.componentInstance._vnode;return r(n.tag)}function f(n,t){for(var a=0;a<o.create.length;++a)o.create[a](Eo,n);r(e=n.data.hook)&&(r(e.create)&&e.create(Eo,n),r(e.insert)&&t.push(n))}function _(n){var e;if(r(e=n.fnScopeId))p.setStyleScope(n.elm,e);else for(var t=n;t;)r(e=t.context)&&r(e=e.$options._scopeId)&&p.setStyleScope(n.elm,e),t=t.parent;r(e=Ye)&&e!==n.context&&e!==n.fnContext&&r(e=e.$options._scopeId)&&p.setStyleScope(n.elm,e)}function v(n,e,t,o,a,s){for(;o<=a;++o)m(t[o],s,n,e,!1,t,o)}function k(n){var e,t,a=n.data;if(r(a))for(r(e=a.hook)&&r(e=e.destroy)&&e(n),e=0;e<o.destroy.length;++e)o.destroy[e](n);if(r(e=n.children))for(t=0;t<n.children.length;++t)k(n.children[t])}function x(n,e,t){for(;e<=t;++e){var o=n[e];r(o)&&(r(o.tag)?(w(o),k(o)):d(o.elm))}}function w(n,e){if(r(e)||r(n.data)){var t,a=o.remove.length+1;for(r(e)?e.listeners+=a:e=function(n,e){function t(){0==--t.listeners&&d(n)}return t.listeners=e,t}(n.elm,a),r(t=n.componentInstance)&&r(t=t._vnode)&&r(t.data)&&w(t,e),t=0;t<o.remove.length;++t)o.remove[t](n,e);r(t=n.data.hook)&&r(t=t.remove)?t(n,e):e()}else d(n.elm)}function E(n,e,t,o){for(var a=t;a<o;a++){var s=e[a];if(r(s)&&zo(n,s))return a}}function A(n,e,t,a,l,c){if(n!==e){r(e.elm)&&r(a)&&(e=a[l]=bn(e));var d=e.elm=n.elm;if(i(n.isAsyncPlaceholder))r(e.asyncFactory.resolved)?T(n.elm,e,t):e.isAsyncPlaceholder=!0;else if(i(e.isStatic)&&i(n.isStatic)&&e.key===n.key&&(i(e.isCloned)||i(e.isOnce)))e.componentInstance=n.componentInstance;else{var u,h=e.data;r(h)&&r(u=h.hook)&&r(u=u.prepatch)&&u(n,e);var g=n.children,f=e.children;if(r(h)&&b(e)){for(u=0;u<o.update.length;++u)o.update[u](n,e);r(u=h.hook)&&r(u=u.update)&&u(n,e)}s(e.text)?r(g)&&r(f)?g!==f&&function(n,e,t,o,a){var i,l,c,d=0,u=0,h=e.length-1,g=e[0],b=e[h],f=t.length-1,y=t[0],_=t[f],k=!a;for(0;d<=h&&u<=f;)s(g)?g=e[++d]:s(b)?b=e[--h]:zo(g,y)?(A(g,y,o,t,u),g=e[++d],y=t[++u]):zo(b,_)?(A(b,_,o,t,f),b=e[--h],_=t[--f]):zo(g,_)?(A(g,_,o,t,f),k&&p.insertBefore(n,g.elm,p.nextSibling(b.elm)),g=e[++d],_=t[--f]):zo(b,y)?(A(b,y,o,t,u),k&&p.insertBefore(n,b.elm,g.elm),b=e[--h],y=t[++u]):(s(i)&&(i=Bo(e,d,h)),s(l=r(y.key)?i[y.key]:E(y,e,d,h))?m(y,o,n,g.elm,!1,t,u):zo(c=e[l],y)?(A(c,y,o,t,u),e[l]=void 0,k&&p.insertBefore(n,c.elm,g.elm)):m(y,o,n,g.elm,!1,t,u),y=t[++u]);d>h?v(n,s(t[f+1])?null:t[f+1].elm,t,u,f,o):u>f&&x(e,d,h)}(d,g,f,t,c):r(f)?(r(n.text)&&p.setTextContent(d,""),v(d,null,f,0,f.length-1,t)):r(g)?x(g,0,g.length-1):r(n.text)&&p.setTextContent(d,""):n.text!==e.text&&p.setTextContent(d,e.text),r(h)&&r(u=h.hook)&&r(u=u.postpatch)&&u(n,e)}}}function z(n,e,t){if(i(t)&&r(n.parent))n.parent.data.pendingInsert=e;else for(var o=0;o<e.length;++o)e[o].data.hook.insert(e[o])}var B=y("attrs,class,staticClass,staticStyle,key");function T(n,e,t,o){var a,s=e.tag,l=e.data,c=e.children;if(o=o||l&&l.pre,e.elm=n,i(e.isComment)&&r(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(r(l)&&(r(a=l.hook)&&r(a=a.init)&&a(e,!0),r(a=e.componentInstance)))return u(e,t),!0;if(r(s)){if(r(c))if(n.hasChildNodes())if(r(a=l)&&r(a=a.domProps)&&r(a=a.innerHTML)){if(a!==n.innerHTML)return!1}else{for(var p=!0,d=n.firstChild,m=0;m<c.length;m++){if(!d||!T(d,c[m],t,o)){p=!1;break}d=d.nextSibling}if(!p||d)return!1}else g(e,c,t);if(r(l)){var h=!1;for(var b in l)if(!B(b)){h=!0,f(e,t);break}!h&&l.class&&Fe(l.class)}}else n.data!==e.text&&(n.data=e.text);return!0}return function(n,e,t,a){if(!s(e)){var l,c=!1,d=[];if(s(n))c=!0,m(e,d);else{var u=r(n.nodeType);if(!u&&zo(n,e))A(n,e,d,null,null,a);else{if(u){if(1===n.nodeType&&n.hasAttribute("data-server-rendered")&&(n.removeAttribute("data-server-rendered"),t=!0),i(t)&&T(n,e,d))return z(e,d,!0),n;l=n,n=new un(p.tagName(l).toLowerCase(),{},[],void 0,l)}var h=n.elm,g=p.parentNode(h);if(m(e,d,h._leaveCb?null:g,p.nextSibling(h)),r(e.parent))for(var f=e.parent,y=b(e);f;){for(var _=0;_<o.destroy.length;++_)o.destroy[_](f);if(f.elm=e.elm,y){for(var v=0;v<o.create.length;++v)o.create[v](Eo,f);var w=f.data.hook.insert;if(w.merged)for(var E=1;E<w.fns.length;E++)w.fns[E]()}else xo(f);f=f.parent}r(g)?x([n],0,0):r(n.tag)&&k(n)}}return z(e,d,c),e.elm}r(n)&&k(n)}}({nodeOps:vo,modules:[Lo,No,Ko,Xo,la,K?{create:Ia,activate:Ia,remove:function(n,e){!0!==n.data.show?Sa(n,e):e()}}:{}].concat(Do)});X&&document.addEventListener("selectionchange",(function(){var n=document.activeElement;n&&n.vmodel&&Na(n,"input")}));var Da={inserted:function(n,e,t,o){"select"===t.tag?(o.elm&&!o.elm._vOptions?Zn(t,"postpatch",(function(){Da.componentUpdated(n,e,t)})):Ca(n,e,t.context),n._vOptions=[].map.call(n.options,La)):("textarea"===t.tag||_o(n.type))&&(n._vModifiers=e.modifiers,e.modifiers.lazy||(n.addEventListener("compositionstart",Ma),n.addEventListener("compositionend",qa),n.addEventListener("change",qa),X&&(n.vmodel=!0)))},componentUpdated:function(n,e,t){if("select"===t.tag){Ca(n,e,t.context);var o=n._vOptions,a=n._vOptions=[].map.call(n.options,La);if(a.some((function(n,e){return!R(n,o[e])})))(n.multiple?e.value.some((function(n){return Oa(n,a)})):e.value!==e.oldValue&&Oa(e.value,a))&&Na(n,"change")}}};function Ca(n,e,t){Ra(n,e,t),(Y||Q)&&setTimeout((function(){Ra(n,e,t)}),0)}function Ra(n,e,t){var o=e.value,a=n.multiple;if(!a||Array.isArray(o)){for(var s,r,i=0,l=n.options.length;i<l;i++)if(r=n.options[i],a)s=O(o,La(r))>-1,r.selected!==s&&(r.selected=s);else if(R(La(r),o))return void(n.selectedIndex!==i&&(n.selectedIndex=i));a||(n.selectedIndex=-1)}}function Oa(n,e){return e.every((function(e){return!R(e,n)}))}function La(n){return"_value"in n?n._value:n.value}function Ma(n){n.target.composing=!0}function qa(n){n.target.composing&&(n.target.composing=!1,Na(n.target,"input"))}function Na(n,e){var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!0),n.dispatchEvent(t)}function Fa(n){return!n.componentInstance||n.data&&n.data.transition?n:Fa(n.componentInstance._vnode)}var Ua={model:Da,show:{bind:function(n,e,t){var o=e.value,a=(t=Fa(t)).data&&t.data.transition,s=n.__vOriginalDisplay="none"===n.style.display?"":n.style.display;o&&a?(t.data.show=!0,Ta(t,(function(){n.style.display=s}))):n.style.display=o?s:"none"},update:function(n,e,t){var o=e.value;!o!=!e.oldValue&&((t=Fa(t)).data&&t.data.transition?(t.data.show=!0,o?Ta(t,(function(){n.style.display=n.__vOriginalDisplay})):Sa(t,(function(){n.style.display="none"}))):n.style.display=o?n.__vOriginalDisplay:"none")},unbind:function(n,e,t,o,a){a||(n.style.display=n.__vOriginalDisplay)}}},Ga={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function Ha(n){var e=n&&n.componentOptions;return e&&e.Ctor.options.abstract?Ha(Ee(e.children)):n}function Va(n){var e={},t=n.$options;for(var o in t.propsData)e[o]=n[o];var a=t._parentListeners;for(var o in a)e[A(o)]=a[o];return e}function Za(n,e){if(/\d-keep-alive$/.test(e.tag))return n("keep-alive",{props:e.componentOptions.propsData})}var Ka=function(n){return n.tag||he(n)},Wa=function(n){return"show"===n.name},Ya={name:"transition",props:Ga,abstract:!0,render:function(n){var e=this,t=this.$slots.default;if(t&&(t=t.filter(Ka)).length){0;var o=this.mode;0;var a=t[0];if(function(n){for(;n=n.parent;)if(n.data.transition)return!0}(this.$vnode))return a;var s=Ha(a);if(!s)return a;if(this._leaving)return Za(n,a);var r="__transition-".concat(this._uid,"-");s.key=null==s.key?s.isComment?r+"comment":r+s.tag:l(s.key)?0===String(s.key).indexOf(r)?s.key:r+s.key:s.key;var i=(s.data||(s.data={})).transition=Va(this),c=this._vnode,p=Ha(c);if(s.data.directives&&s.data.directives.some(Wa)&&(s.data.show=!0),p&&p.data&&!function(n,e){return e.key===n.key&&e.tag===n.tag}(s,p)&&!he(p)&&(!p.componentInstance||!p.componentInstance._vnode.isComment)){var d=p.data.transition=j({},i);if("out-in"===o)return this._leaving=!0,Zn(d,"afterLeave",(function(){e._leaving=!1,e.$forceUpdate()})),Za(n,a);if("in-out"===o){if(he(s))return c;var m,u=function(){m()};Zn(i,"afterEnter",u),Zn(i,"enterCancelled",u),Zn(d,"delayLeave",(function(n){m=n}))}}return a}}},Xa=j({tag:String,moveClass:String},Ga);function Qa(n){n.elm._moveCb&&n.elm._moveCb(),n.elm._enterCb&&n.elm._enterCb()}function Ja(n){n.data.newPos=n.elm.getBoundingClientRect()}function ns(n){var e=n.data.pos,t=n.data.newPos,o=e.left-t.left,a=e.top-t.top;if(o||a){n.data.moved=!0;var s=n.elm.style;s.transform=s.WebkitTransform="translate(".concat(o,"px,").concat(a,"px)"),s.transitionDuration="0s"}}delete Xa.mode;var es={Transition:Ya,TransitionGroup:{props:Xa,beforeMount:function(){var n=this,e=this._update;this._update=function(t,o){var a=Xe(n);n.__patch__(n._vnode,n.kept,!1,!0),n._vnode=n.kept,a(),e.call(n,t,o)}},render:function(n){for(var e=this.tag||this.$vnode.data.tag||"span",t=Object.create(null),o=this.prevChildren=this.children,a=this.$slots.default||[],s=this.children=[],r=Va(this),i=0;i<a.length;i++){if((p=a[i]).tag)if(null!=p.key&&0!==String(p.key).indexOf("__vlist"))s.push(p),t[p.key]=p,(p.data||(p.data={})).transition=r;else;}if(o){var l=[],c=[];for(i=0;i<o.length;i++){var p;(p=o[i]).data.transition=r,p.data.pos=p.elm.getBoundingClientRect(),t[p.key]?l.push(p):c.push(p)}this.kept=n(e,null,l),this.removed=c}return n(e,null,s)},updated:function(){var n=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";n.length&&this.hasMove(n[0].elm,e)&&(n.forEach(Qa),n.forEach(Ja),n.forEach(ns),this._reflow=document.body.offsetHeight,n.forEach((function(n){if(n.data.moved){var t=n.elm,o=t.style;ka(t,e),o.transform=o.WebkitTransform=o.transitionDuration="",t.addEventListener(ba,t._moveCb=function n(o){o&&o.target!==t||o&&!/transform$/.test(o.propertyName)||(t.removeEventListener(ba,n),t._moveCb=null,xa(t,e))})}})))},methods:{hasMove:function(n,e){if(!ha)return!1;if(this._hasMove)return this._hasMove;var t=n.cloneNode();n._transitionClasses&&n._transitionClasses.forEach((function(n){da(t,n)})),pa(t,e),t.style.display="none",this.$el.appendChild(t);var o=Aa(t);return this.$el.removeChild(t),this._hasMove=o.hasTransform}}}};function ts(n,e){for(var t in e)n[t]=e[t];return n}Vt.config.mustUseProp=function(n,e,t){return"value"===t&&eo(n)&&"button"!==e||"selected"===t&&"option"===n||"checked"===t&&"input"===n||"muted"===t&&"video"===n},Vt.config.isReservedTag=fo,Vt.config.isReservedAttr=no,Vt.config.getTagNamespace=function(n){return bo(n)?"svg":"math"===n?"math":void 0},Vt.config.isUnknownElement=function(n){if(!K)return!0;if(fo(n))return!1;if(n=n.toLowerCase(),null!=yo[n])return yo[n];var e=document.createElement(n);return n.indexOf("-")>-1?yo[n]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:yo[n]=/HTMLUnknownElement/.test(e.toString())},j(Vt.options.directives,Ua),j(Vt.options.components,es),Vt.prototype.__patch__=K?Pa:P,Vt.prototype.$mount=function(n,e){return function(n,e,t){var o;n.$el=e,n.$options.render||(n.$options.render=hn),nt(n,"beforeMount"),o=function(){n._update(n._render(),t)},new He(n,o,P,{before:function(){n._isMounted&&!n._isDestroyed&&nt(n,"beforeUpdate")}},!0),t=!1;var a=n._preWatchers;if(a)for(var s=0;s<a.length;s++)a[s].run();return null==n.$vnode&&(n._isMounted=!0,nt(n,"mounted")),n}(this,n=n&&K?function(n){if("string"==typeof n){var e=document.querySelector(n);return e||document.createElement("div")}return n}(n):void 0,e)},K&&setTimeout((function(){F.devtools&&rn&&rn.emit("init",Vt)}),0);var os=/[!'()*]/g,as=function(n){return"%"+n.charCodeAt(0).toString(16)},ss=/%2C/g,rs=function(n){return encodeURIComponent(n).replace(os,as).replace(ss,",")};function is(n){try{return decodeURIComponent(n)}catch(n){0}return n}var ls=function(n){return null==n||"object"==typeof n?n:String(n)};function cs(n){var e={};return(n=n.trim().replace(/^(\?|#|&)/,""))?(n.split("&").forEach((function(n){var t=n.replace(/\+/g," ").split("="),o=is(t.shift()),a=t.length>0?is(t.join("=")):null;void 0===e[o]?e[o]=a:Array.isArray(e[o])?e[o].push(a):e[o]=[e[o],a]})),e):e}function ps(n){var e=n?Object.keys(n).map((function(e){var t=n[e];if(void 0===t)return"";if(null===t)return rs(e);if(Array.isArray(t)){var o=[];return t.forEach((function(n){void 0!==n&&(null===n?o.push(rs(e)):o.push(rs(e)+"="+rs(n)))})),o.join("&")}return rs(e)+"="+rs(t)})).filter((function(n){return n.length>0})).join("&"):null;return e?"?"+e:""}var ds=/\/?$/;function ms(n,e,t,o){var a=o&&o.options.stringifyQuery,s=e.query||{};try{s=us(s)}catch(n){}var r={name:e.name||n&&n.name,meta:n&&n.meta||{},path:e.path||"/",hash:e.hash||"",query:s,params:e.params||{},fullPath:bs(e,a),matched:n?gs(n):[]};return t&&(r.redirectedFrom=bs(t,a)),Object.freeze(r)}function us(n){if(Array.isArray(n))return n.map(us);if(n&&"object"==typeof n){var e={};for(var t in n)e[t]=us(n[t]);return e}return n}var hs=ms(null,{path:"/"});function gs(n){for(var e=[];n;)e.unshift(n),n=n.parent;return e}function bs(n,e){var t=n.path,o=n.query;void 0===o&&(o={});var a=n.hash;return void 0===a&&(a=""),(t||"/")+(e||ps)(o)+a}function fs(n,e,t){return e===hs?n===e:!!e&&(n.path&&e.path?n.path.replace(ds,"")===e.path.replace(ds,"")&&(t||n.hash===e.hash&&ys(n.query,e.query)):!(!n.name||!e.name)&&(n.name===e.name&&(t||n.hash===e.hash&&ys(n.query,e.query)&&ys(n.params,e.params))))}function ys(n,e){if(void 0===n&&(n={}),void 0===e&&(e={}),!n||!e)return n===e;var t=Object.keys(n).sort(),o=Object.keys(e).sort();return t.length===o.length&&t.every((function(t,a){var s=n[t];if(o[a]!==t)return!1;var r=e[t];return null==s||null==r?s===r:"object"==typeof s&&"object"==typeof r?ys(s,r):String(s)===String(r)}))}function _s(n){for(var e=0;e<n.matched.length;e++){var t=n.matched[e];for(var o in t.instances){var a=t.instances[o],s=t.enteredCbs[o];if(a&&s){delete t.enteredCbs[o];for(var r=0;r<s.length;r++)a._isBeingDestroyed||s[r](a)}}}}var vs={name:"RouterView",functional:!0,props:{name:{type:String,default:"default"}},render:function(n,e){var t=e.props,o=e.children,a=e.parent,s=e.data;s.routerView=!0;for(var r=a.$createElement,i=t.name,l=a.$route,c=a._routerViewCache||(a._routerViewCache={}),p=0,d=!1;a&&a._routerRoot!==a;){var m=a.$vnode?a.$vnode.data:{};m.routerView&&p++,m.keepAlive&&a._directInactive&&a._inactive&&(d=!0),a=a.$parent}if(s.routerViewDepth=p,d){var u=c[i],h=u&&u.component;return h?(u.configProps&&ks(h,s,u.route,u.configProps),r(h,s,o)):r()}var g=l.matched[p],b=g&&g.components[i];if(!g||!b)return c[i]=null,r();c[i]={component:b},s.registerRouteInstance=function(n,e){var t=g.instances[i];(e&&t!==n||!e&&t===n)&&(g.instances[i]=e)},(s.hook||(s.hook={})).prepatch=function(n,e){g.instances[i]=e.componentInstance},s.hook.init=function(n){n.data.keepAlive&&n.componentInstance&&n.componentInstance!==g.instances[i]&&(g.instances[i]=n.componentInstance),_s(l)};var f=g.props&&g.props[i];return f&&(ts(c[i],{route:l,configProps:f}),ks(b,s,l,f)),r(b,s,o)}};function ks(n,e,t,o){var a=e.props=function(n,e){switch(typeof e){case"undefined":return;case"object":return e;case"function":return e(n);case"boolean":return e?n.params:void 0;default:0}}(t,o);if(a){a=e.props=ts({},a);var s=e.attrs=e.attrs||{};for(var r in a)n.props&&r in n.props||(s[r]=a[r],delete a[r])}}function xs(n,e,t){var o=n.charAt(0);if("/"===o)return n;if("?"===o||"#"===o)return e+n;var a=e.split("/");t&&a[a.length-1]||a.pop();for(var s=n.replace(/^\//,"").split("/"),r=0;r<s.length;r++){var i=s[r];".."===i?a.pop():"."!==i&&a.push(i)}return""!==a[0]&&a.unshift(""),a.join("/")}function ws(n){return n.replace(/\/(?:\s*\/)+/g,"/")}var Es=Array.isArray||function(n){return"[object Array]"==Object.prototype.toString.call(n)},As=Ms,zs=js,Bs=function(n,e){return Ps(js(n,e),e)},Ts=Ps,Ss=Ls,$s=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function js(n,e){for(var t,o=[],a=0,s=0,r="",i=e&&e.delimiter||"/";null!=(t=$s.exec(n));){var l=t[0],c=t[1],p=t.index;if(r+=n.slice(s,p),s=p+l.length,c)r+=c[1];else{var d=n[s],m=t[2],u=t[3],h=t[4],g=t[5],b=t[6],f=t[7];r&&(o.push(r),r="");var y=null!=m&&null!=d&&d!==m,_="+"===b||"*"===b,v="?"===b||"*"===b,k=t[2]||i,x=h||g;o.push({name:u||a++,prefix:m||"",delimiter:k,optional:v,repeat:_,partial:y,asterisk:!!f,pattern:x?Cs(x):f?".*":"[^"+Ds(k)+"]+?"})}}return s<n.length&&(r+=n.substr(s)),r&&o.push(r),o}function Is(n){return encodeURI(n).replace(/[\/?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()}))}function Ps(n,e){for(var t=new Array(n.length),o=0;o<n.length;o++)"object"==typeof n[o]&&(t[o]=new RegExp("^(?:"+n[o].pattern+")$",Os(e)));return function(e,o){for(var a="",s=e||{},r=(o||{}).pretty?Is:encodeURIComponent,i=0;i<n.length;i++){var l=n[i];if("string"!=typeof l){var c,p=s[l.name];if(null==p){if(l.optional){l.partial&&(a+=l.prefix);continue}throw new TypeError('Expected "'+l.name+'" to be defined')}if(Es(p)){if(!l.repeat)throw new TypeError('Expected "'+l.name+'" to not repeat, but received `'+JSON.stringify(p)+"`");if(0===p.length){if(l.optional)continue;throw new TypeError('Expected "'+l.name+'" to not be empty')}for(var d=0;d<p.length;d++){if(c=r(p[d]),!t[i].test(c))throw new TypeError('Expected all "'+l.name+'" to match "'+l.pattern+'", but received `'+JSON.stringify(c)+"`");a+=(0===d?l.prefix:l.delimiter)+c}}else{if(c=l.asterisk?encodeURI(p).replace(/[?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()})):r(p),!t[i].test(c))throw new TypeError('Expected "'+l.name+'" to match "'+l.pattern+'", but received "'+c+'"');a+=l.prefix+c}}else a+=l}return a}}function Ds(n){return n.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function Cs(n){return n.replace(/([=!:$\/()])/g,"\\$1")}function Rs(n,e){return n.keys=e,n}function Os(n){return n&&n.sensitive?"":"i"}function Ls(n,e,t){Es(e)||(t=e||t,e=[]);for(var o=(t=t||{}).strict,a=!1!==t.end,s="",r=0;r<n.length;r++){var i=n[r];if("string"==typeof i)s+=Ds(i);else{var l=Ds(i.prefix),c="(?:"+i.pattern+")";e.push(i),i.repeat&&(c+="(?:"+l+c+")*"),s+=c=i.optional?i.partial?l+"("+c+")?":"(?:"+l+"("+c+"))?":l+"("+c+")"}}var p=Ds(t.delimiter||"/"),d=s.slice(-p.length)===p;return o||(s=(d?s.slice(0,-p.length):s)+"(?:"+p+"(?=$))?"),s+=a?"$":o&&d?"":"(?="+p+"|$)",Rs(new RegExp("^"+s,Os(t)),e)}function Ms(n,e,t){return Es(e)||(t=e||t,e=[]),t=t||{},n instanceof RegExp?function(n,e){var t=n.source.match(/\((?!\?)/g);if(t)for(var o=0;o<t.length;o++)e.push({name:o,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return Rs(n,e)}(n,e):Es(n)?function(n,e,t){for(var o=[],a=0;a<n.length;a++)o.push(Ms(n[a],e,t).source);return Rs(new RegExp("(?:"+o.join("|")+")",Os(t)),e)}(n,e,t):function(n,e,t){return Ls(js(n,t),e,t)}(n,e,t)}As.parse=zs,As.compile=Bs,As.tokensToFunction=Ts,As.tokensToRegExp=Ss;var qs=Object.create(null);function Ns(n,e,t){e=e||{};try{var o=qs[n]||(qs[n]=As.compile(n));return"string"==typeof e.pathMatch&&(e[0]=e.pathMatch),o(e,{pretty:!0})}catch(n){return""}finally{delete e[0]}}function Fs(n,e,t,o){var a="string"==typeof n?{path:n}:n;if(a._normalized)return a;if(a.name){var s=(a=ts({},n)).params;return s&&"object"==typeof s&&(a.params=ts({},s)),a}if(!a.path&&a.params&&e){(a=ts({},a))._normalized=!0;var r=ts(ts({},e.params),a.params);if(e.name)a.name=e.name,a.params=r;else if(e.matched.length){var i=e.matched[e.matched.length-1].path;a.path=Ns(i,r,e.path)}else 0;return a}var l=function(n){var e="",t="",o=n.indexOf("#");o>=0&&(e=n.slice(o),n=n.slice(0,o));var a=n.indexOf("?");return a>=0&&(t=n.slice(a+1),n=n.slice(0,a)),{path:n,query:t,hash:e}}(a.path||""),c=e&&e.path||"/",p=l.path?xs(l.path,c,t||a.append):c,d=function(n,e,t){void 0===e&&(e={});var o,a=t||cs;try{o=a(n||"")}catch(n){o={}}for(var s in e){var r=e[s];o[s]=Array.isArray(r)?r.map(ls):ls(r)}return o}(l.query,a.query,o&&o.options.parseQuery),m=a.hash||l.hash;return m&&"#"!==m.charAt(0)&&(m="#"+m),{_normalized:!0,path:p,query:d,hash:m}}var Us,Gs=function(){},Hs={name:"RouterLink",props:{to:{type:[String,Object],required:!0},tag:{type:String,default:"a"},custom:Boolean,exact:Boolean,exactPath:Boolean,append:Boolean,replace:Boolean,activeClass:String,exactActiveClass:String,ariaCurrentValue:{type:String,default:"page"},event:{type:[String,Array],default:"click"}},render:function(n){var e=this,t=this.$router,o=this.$route,a=t.resolve(this.to,o,this.append),s=a.location,r=a.route,i=a.href,l={},c=t.options.linkActiveClass,p=t.options.linkExactActiveClass,d=null==c?"router-link-active":c,m=null==p?"router-link-exact-active":p,u=null==this.activeClass?d:this.activeClass,h=null==this.exactActiveClass?m:this.exactActiveClass,g=r.redirectedFrom?ms(null,Fs(r.redirectedFrom),null,t):r;l[h]=fs(o,g,this.exactPath),l[u]=this.exact||this.exactPath?l[h]:function(n,e){return 0===n.path.replace(ds,"/").indexOf(e.path.replace(ds,"/"))&&(!e.hash||n.hash===e.hash)&&function(n,e){for(var t in e)if(!(t in n))return!1;return!0}(n.query,e.query)}(o,g);var b=l[h]?this.ariaCurrentValue:null,f=function(n){Vs(n)&&(e.replace?t.replace(s,Gs):t.push(s,Gs))},y={click:Vs};Array.isArray(this.event)?this.event.forEach((function(n){y[n]=f})):y[this.event]=f;var _={class:l},v=!this.$scopedSlots.$hasNormal&&this.$scopedSlots.default&&this.$scopedSlots.default({href:i,route:r,navigate:f,isActive:l[u],isExactActive:l[h]});if(v){if(1===v.length)return v[0];if(v.length>1||!v.length)return 0===v.length?n():n("span",{},v)}if("a"===this.tag)_.on=y,_.attrs={href:i,"aria-current":b};else{var k=function n(e){var t;if(e)for(var o=0;o<e.length;o++){if("a"===(t=e[o]).tag)return t;if(t.children&&(t=n(t.children)))return t}}(this.$slots.default);if(k){k.isStatic=!1;var x=k.data=ts({},k.data);for(var w in x.on=x.on||{},x.on){var E=x.on[w];w in y&&(x.on[w]=Array.isArray(E)?E:[E])}for(var A in y)A in x.on?x.on[A].push(y[A]):x.on[A]=f;var z=k.data.attrs=ts({},k.data.attrs);z.href=i,z["aria-current"]=b}else _.on=y}return n(this.tag,_,this.$slots.default)}};function Vs(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey||n.defaultPrevented||void 0!==n.button&&0!==n.button)){if(n.currentTarget&&n.currentTarget.getAttribute){var e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}var Zs="undefined"!=typeof window;function Ks(n,e,t,o,a){var s=e||[],r=t||Object.create(null),i=o||Object.create(null);n.forEach((function(n){!function n(e,t,o,a,s,r){var i=a.path,l=a.name;0;var c=a.pathToRegexpOptions||{},p=function(n,e,t){t||(n=n.replace(/\/$/,""));if("/"===n[0])return n;if(null==e)return n;return ws(e.path+"/"+n)}(i,s,c.strict);"boolean"==typeof a.caseSensitive&&(c.sensitive=a.caseSensitive);var d={path:p,regex:Ws(p,c),components:a.components||{default:a.component},alias:a.alias?"string"==typeof a.alias?[a.alias]:a.alias:[],instances:{},enteredCbs:{},name:l,parent:s,matchAs:r,redirect:a.redirect,beforeEnter:a.beforeEnter,meta:a.meta||{},props:null==a.props?{}:a.components?a.props:{default:a.props}};a.children&&a.children.forEach((function(a){var s=r?ws(r+"/"+a.path):void 0;n(e,t,o,a,d,s)}));t[d.path]||(e.push(d.path),t[d.path]=d);if(void 0!==a.alias)for(var m=Array.isArray(a.alias)?a.alias:[a.alias],u=0;u<m.length;++u){0;var h={path:m[u],children:a.children};n(e,t,o,h,s,d.path||"/")}l&&(o[l]||(o[l]=d))}(s,r,i,n,a)}));for(var l=0,c=s.length;l<c;l++)"*"===s[l]&&(s.push(s.splice(l,1)[0]),c--,l--);return{pathList:s,pathMap:r,nameMap:i}}function Ws(n,e){return As(n,[],e)}function Ys(n,e){var t=Ks(n),o=t.pathList,a=t.pathMap,s=t.nameMap;function r(n,t,r){var i=Fs(n,t,!1,e),c=i.name;if(c){var p=s[c];if(!p)return l(null,i);var d=p.regex.keys.filter((function(n){return!n.optional})).map((function(n){return n.name}));if("object"!=typeof i.params&&(i.params={}),t&&"object"==typeof t.params)for(var m in t.params)!(m in i.params)&&d.indexOf(m)>-1&&(i.params[m]=t.params[m]);return i.path=Ns(p.path,i.params),l(p,i,r)}if(i.path){i.params={};for(var u=0;u<o.length;u++){var h=o[u],g=a[h];if(Xs(g.regex,i.path,i.params))return l(g,i,r)}}return l(null,i)}function i(n,t){var o=n.redirect,a="function"==typeof o?o(ms(n,t,null,e)):o;if("string"==typeof a&&(a={path:a}),!a||"object"!=typeof a)return l(null,t);var i=a,c=i.name,p=i.path,d=t.query,m=t.hash,u=t.params;if(d=i.hasOwnProperty("query")?i.query:d,m=i.hasOwnProperty("hash")?i.hash:m,u=i.hasOwnProperty("params")?i.params:u,c){s[c];return r({_normalized:!0,name:c,query:d,hash:m,params:u},void 0,t)}if(p){var h=function(n,e){return xs(n,e.parent?e.parent.path:"/",!0)}(p,n);return r({_normalized:!0,path:Ns(h,u),query:d,hash:m},void 0,t)}return l(null,t)}function l(n,t,o){return n&&n.redirect?i(n,o||t):n&&n.matchAs?function(n,e,t){var o=r({_normalized:!0,path:Ns(t,e.params)});if(o){var a=o.matched,s=a[a.length-1];return e.params=o.params,l(s,e)}return l(null,e)}(0,t,n.matchAs):ms(n,t,o,e)}return{match:r,addRoute:function(n,e){var t="object"!=typeof n?s[n]:void 0;Ks([e||n],o,a,s,t),t&&t.alias.length&&Ks(t.alias.map((function(n){return{path:n,children:[e]}})),o,a,s,t)},getRoutes:function(){return o.map((function(n){return a[n]}))},addRoutes:function(n){Ks(n,o,a,s)}}}function Xs(n,e,t){var o=e.match(n);if(!o)return!1;if(!t)return!0;for(var a=1,s=o.length;a<s;++a){var r=n.keys[a-1];r&&(t[r.name||"pathMatch"]="string"==typeof o[a]?is(o[a]):o[a])}return!0}var Qs=Zs&&window.performance&&window.performance.now?window.performance:Date;function Js(){return Qs.now().toFixed(3)}var nr=Js();function er(){return nr}function tr(n){return nr=n}var or=Object.create(null);function ar(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var n=window.location.protocol+"//"+window.location.host,e=window.location.href.replace(n,""),t=ts({},window.history.state);return t.key=er(),window.history.replaceState(t,"",e),window.addEventListener("popstate",ir),function(){window.removeEventListener("popstate",ir)}}function sr(n,e,t,o){if(n.app){var a=n.options.scrollBehavior;a&&n.app.$nextTick((function(){var s=function(){var n=er();if(n)return or[n]}(),r=a.call(n,e,t,o?s:null);r&&("function"==typeof r.then?r.then((function(n){mr(n,s)})).catch((function(n){0})):mr(r,s))}))}}function rr(){var n=er();n&&(or[n]={x:window.pageXOffset,y:window.pageYOffset})}function ir(n){rr(),n.state&&n.state.key&&tr(n.state.key)}function lr(n){return pr(n.x)||pr(n.y)}function cr(n){return{x:pr(n.x)?n.x:window.pageXOffset,y:pr(n.y)?n.y:window.pageYOffset}}function pr(n){return"number"==typeof n}var dr=/^#\d/;function mr(n,e){var t,o="object"==typeof n;if(o&&"string"==typeof n.selector){var a=dr.test(n.selector)?document.getElementById(n.selector.slice(1)):document.querySelector(n.selector);if(a){var s=n.offset&&"object"==typeof n.offset?n.offset:{};e=function(n,e){var t=document.documentElement.getBoundingClientRect(),o=n.getBoundingClientRect();return{x:o.left-t.left-e.x,y:o.top-t.top-e.y}}(a,s={x:pr((t=s).x)?t.x:0,y:pr(t.y)?t.y:0})}else lr(n)&&(e=cr(n))}else o&&lr(n)&&(e=cr(n));e&&("scrollBehavior"in document.documentElement.style?window.scrollTo({left:e.x,top:e.y,behavior:n.behavior}):window.scrollTo(e.x,e.y))}var ur,hr=Zs&&((-1===(ur=window.navigator.userAgent).indexOf("Android 2.")&&-1===ur.indexOf("Android 4.0")||-1===ur.indexOf("Mobile Safari")||-1!==ur.indexOf("Chrome")||-1!==ur.indexOf("Windows Phone"))&&window.history&&"function"==typeof window.history.pushState);function gr(n,e){rr();var t=window.history;try{if(e){var o=ts({},t.state);o.key=er(),t.replaceState(o,"",n)}else t.pushState({key:tr(Js())},"",n)}catch(t){window.location[e?"replace":"assign"](n)}}function br(n){gr(n,!0)}var fr={redirected:2,aborted:4,cancelled:8,duplicated:16};function yr(n,e){return vr(n,e,fr.redirected,'Redirected when going from "'+n.fullPath+'" to "'+function(n){if("string"==typeof n)return n;if("path"in n)return n.path;var e={};return kr.forEach((function(t){t in n&&(e[t]=n[t])})),JSON.stringify(e,null,2)}(e)+'" via a navigation guard.')}function _r(n,e){return vr(n,e,fr.cancelled,'Navigation cancelled from "'+n.fullPath+'" to "'+e.fullPath+'" with a new navigation.')}function vr(n,e,t,o){var a=new Error(o);return a._isRouter=!0,a.from=n,a.to=e,a.type=t,a}var kr=["params","query","hash"];function xr(n){return Object.prototype.toString.call(n).indexOf("Error")>-1}function wr(n,e){return xr(n)&&n._isRouter&&(null==e||n.type===e)}function Er(n,e,t){var o=function(a){a>=n.length?t():n[a]?e(n[a],(function(){o(a+1)})):o(a+1)};o(0)}function Ar(n){return function(e,t,o){var a=!1,s=0,r=null;zr(n,(function(n,e,t,i){if("function"==typeof n&&void 0===n.cid){a=!0,s++;var l,c=Sr((function(e){var a;((a=e).__esModule||Tr&&"Module"===a[Symbol.toStringTag])&&(e=e.default),n.resolved="function"==typeof e?e:Us.extend(e),t.components[i]=e,--s<=0&&o()})),p=Sr((function(n){var e="Failed to resolve async component "+i+": "+n;r||(r=xr(n)?n:new Error(e),o(r))}));try{l=n(c,p)}catch(n){p(n)}if(l)if("function"==typeof l.then)l.then(c,p);else{var d=l.component;d&&"function"==typeof d.then&&d.then(c,p)}}})),a||o()}}function zr(n,e){return Br(n.map((function(n){return Object.keys(n.components).map((function(t){return e(n.components[t],n.instances[t],n,t)}))})))}function Br(n){return Array.prototype.concat.apply([],n)}var Tr="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;function Sr(n){var e=!1;return function(){for(var t=[],o=arguments.length;o--;)t[o]=arguments[o];if(!e)return e=!0,n.apply(this,t)}}var $r=function(n,e){this.router=n,this.base=function(n){if(!n)if(Zs){var e=document.querySelector("base");n=(n=e&&e.getAttribute("href")||"/").replace(/^https?:\/\/[^\/]+/,"")}else n="/";"/"!==n.charAt(0)&&(n="/"+n);return n.replace(/\/$/,"")}(e),this.current=hs,this.pending=null,this.ready=!1,this.readyCbs=[],this.readyErrorCbs=[],this.errorCbs=[],this.listeners=[]};function jr(n,e,t,o){var a=zr(n,(function(n,o,a,s){var r=function(n,e){"function"!=typeof n&&(n=Us.extend(n));return n.options[e]}(n,e);if(r)return Array.isArray(r)?r.map((function(n){return t(n,o,a,s)})):t(r,o,a,s)}));return Br(o?a.reverse():a)}function Ir(n,e){if(e)return function(){return n.apply(e,arguments)}}$r.prototype.listen=function(n){this.cb=n},$r.prototype.onReady=function(n,e){this.ready?n():(this.readyCbs.push(n),e&&this.readyErrorCbs.push(e))},$r.prototype.onError=function(n){this.errorCbs.push(n)},$r.prototype.transitionTo=function(n,e,t){var o,a=this;try{o=this.router.match(n,this.current)}catch(n){throw this.errorCbs.forEach((function(e){e(n)})),n}var s=this.current;this.confirmTransition(o,(function(){a.updateRoute(o),e&&e(o),a.ensureURL(),a.router.afterHooks.forEach((function(n){n&&n(o,s)})),a.ready||(a.ready=!0,a.readyCbs.forEach((function(n){n(o)})))}),(function(n){t&&t(n),n&&!a.ready&&(wr(n,fr.redirected)&&s===hs||(a.ready=!0,a.readyErrorCbs.forEach((function(e){e(n)}))))}))},$r.prototype.confirmTransition=function(n,e,t){var o=this,a=this.current;this.pending=n;var s,r,i=function(n){!wr(n)&&xr(n)&&(o.errorCbs.length?o.errorCbs.forEach((function(e){e(n)})):console.error(n)),t&&t(n)},l=n.matched.length-1,c=a.matched.length-1;if(fs(n,a)&&l===c&&n.matched[l]===a.matched[c])return this.ensureURL(),n.hash&&sr(this.router,a,n,!1),i(((r=vr(s=a,n,fr.duplicated,'Avoided redundant navigation to current location: "'+s.fullPath+'".')).name="NavigationDuplicated",r));var p=function(n,e){var t,o=Math.max(n.length,e.length);for(t=0;t<o&&n[t]===e[t];t++);return{updated:e.slice(0,t),activated:e.slice(t),deactivated:n.slice(t)}}(this.current.matched,n.matched),d=p.updated,m=p.deactivated,u=p.activated,h=[].concat(function(n){return jr(n,"beforeRouteLeave",Ir,!0)}(m),this.router.beforeHooks,function(n){return jr(n,"beforeRouteUpdate",Ir)}(d),u.map((function(n){return n.beforeEnter})),Ar(u)),g=function(e,t){if(o.pending!==n)return i(_r(a,n));try{e(n,a,(function(e){!1===e?(o.ensureURL(!0),i(function(n,e){return vr(n,e,fr.aborted,'Navigation aborted from "'+n.fullPath+'" to "'+e.fullPath+'" via a navigation guard.')}(a,n))):xr(e)?(o.ensureURL(!0),i(e)):"string"==typeof e||"object"==typeof e&&("string"==typeof e.path||"string"==typeof e.name)?(i(yr(a,n)),"object"==typeof e&&e.replace?o.replace(e):o.push(e)):t(e)}))}catch(n){i(n)}};Er(h,g,(function(){Er(function(n){return jr(n,"beforeRouteEnter",(function(n,e,t,o){return function(n,e,t){return function(o,a,s){return n(o,a,(function(n){"function"==typeof n&&(e.enteredCbs[t]||(e.enteredCbs[t]=[]),e.enteredCbs[t].push(n)),s(n)}))}}(n,t,o)}))}(u).concat(o.router.resolveHooks),g,(function(){if(o.pending!==n)return i(_r(a,n));o.pending=null,e(n),o.router.app&&o.router.app.$nextTick((function(){_s(n)}))}))}))},$r.prototype.updateRoute=function(n){this.current=n,this.cb&&this.cb(n)},$r.prototype.setupListeners=function(){},$r.prototype.teardown=function(){this.listeners.forEach((function(n){n()})),this.listeners=[],this.current=hs,this.pending=null};var Pr=function(n){function e(e,t){n.call(this,e,t),this._startLocation=Dr(this.base)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router,t=e.options.scrollBehavior,o=hr&&t;o&&this.listeners.push(ar());var a=function(){var t=n.current,a=Dr(n.base);n.current===hs&&a===n._startLocation||n.transitionTo(a,(function(n){o&&sr(e,n,t,!0)}))};window.addEventListener("popstate",a),this.listeners.push((function(){window.removeEventListener("popstate",a)}))}},e.prototype.go=function(n){window.history.go(n)},e.prototype.push=function(n,e,t){var o=this,a=this.current;this.transitionTo(n,(function(n){gr(ws(o.base+n.fullPath)),sr(o.router,n,a,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var o=this,a=this.current;this.transitionTo(n,(function(n){br(ws(o.base+n.fullPath)),sr(o.router,n,a,!1),e&&e(n)}),t)},e.prototype.ensureURL=function(n){if(Dr(this.base)!==this.current.fullPath){var e=ws(this.base+this.current.fullPath);n?gr(e):br(e)}},e.prototype.getCurrentLocation=function(){return Dr(this.base)},e}($r);function Dr(n){var e=window.location.pathname,t=e.toLowerCase(),o=n.toLowerCase();return!n||t!==o&&0!==t.indexOf(ws(o+"/"))||(e=e.slice(n.length)),(e||"/")+window.location.search+window.location.hash}var Cr=function(n){function e(e,t,o){n.call(this,e,t),o&&function(n){var e=Dr(n);if(!/^\/#/.test(e))return window.location.replace(ws(n+"/#"+e)),!0}(this.base)||Rr()}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router.options.scrollBehavior,t=hr&&e;t&&this.listeners.push(ar());var o=function(){var e=n.current;Rr()&&n.transitionTo(Or(),(function(o){t&&sr(n.router,o,e,!0),hr||qr(o.fullPath)}))},a=hr?"popstate":"hashchange";window.addEventListener(a,o),this.listeners.push((function(){window.removeEventListener(a,o)}))}},e.prototype.push=function(n,e,t){var o=this,a=this.current;this.transitionTo(n,(function(n){Mr(n.fullPath),sr(o.router,n,a,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var o=this,a=this.current;this.transitionTo(n,(function(n){qr(n.fullPath),sr(o.router,n,a,!1),e&&e(n)}),t)},e.prototype.go=function(n){window.history.go(n)},e.prototype.ensureURL=function(n){var e=this.current.fullPath;Or()!==e&&(n?Mr(e):qr(e))},e.prototype.getCurrentLocation=function(){return Or()},e}($r);function Rr(){var n=Or();return"/"===n.charAt(0)||(qr("/"+n),!1)}function Or(){var n=window.location.href,e=n.indexOf("#");return e<0?"":n=n.slice(e+1)}function Lr(n){var e=window.location.href,t=e.indexOf("#");return(t>=0?e.slice(0,t):e)+"#"+n}function Mr(n){hr?gr(Lr(n)):window.location.hash=n}function qr(n){hr?br(Lr(n)):window.location.replace(Lr(n))}var Nr=function(n){function e(e,t){n.call(this,e,t),this.stack=[],this.index=-1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.push=function(n,e,t){var o=this;this.transitionTo(n,(function(n){o.stack=o.stack.slice(0,o.index+1).concat(n),o.index++,e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var o=this;this.transitionTo(n,(function(n){o.stack=o.stack.slice(0,o.index).concat(n),e&&e(n)}),t)},e.prototype.go=function(n){var e=this,t=this.index+n;if(!(t<0||t>=this.stack.length)){var o=this.stack[t];this.confirmTransition(o,(function(){var n=e.current;e.index=t,e.updateRoute(o),e.router.afterHooks.forEach((function(e){e&&e(o,n)}))}),(function(n){wr(n,fr.duplicated)&&(e.index=t)}))}},e.prototype.getCurrentLocation=function(){var n=this.stack[this.stack.length-1];return n?n.fullPath:"/"},e.prototype.ensureURL=function(){},e}($r),Fr=function(n){void 0===n&&(n={}),this.app=null,this.apps=[],this.options=n,this.beforeHooks=[],this.resolveHooks=[],this.afterHooks=[],this.matcher=Ys(n.routes||[],this);var e=n.mode||"hash";switch(this.fallback="history"===e&&!hr&&!1!==n.fallback,this.fallback&&(e="hash"),Zs||(e="abstract"),this.mode=e,e){case"history":this.history=new Pr(this,n.base);break;case"hash":this.history=new Cr(this,n.base,this.fallback);break;case"abstract":this.history=new Nr(this,n.base);break;default:0}},Ur={currentRoute:{configurable:!0}};Fr.prototype.match=function(n,e,t){return this.matcher.match(n,e,t)},Ur.currentRoute.get=function(){return this.history&&this.history.current},Fr.prototype.init=function(n){var e=this;if(this.apps.push(n),n.$once("hook:destroyed",(function(){var t=e.apps.indexOf(n);t>-1&&e.apps.splice(t,1),e.app===n&&(e.app=e.apps[0]||null),e.app||e.history.teardown()})),!this.app){this.app=n;var t=this.history;if(t instanceof Pr||t instanceof Cr){var o=function(n){t.setupListeners(),function(n){var o=t.current,a=e.options.scrollBehavior;hr&&a&&"fullPath"in n&&sr(e,n,o,!1)}(n)};t.transitionTo(t.getCurrentLocation(),o,o)}t.listen((function(n){e.apps.forEach((function(e){e._route=n}))}))}},Fr.prototype.beforeEach=function(n){return Hr(this.beforeHooks,n)},Fr.prototype.beforeResolve=function(n){return Hr(this.resolveHooks,n)},Fr.prototype.afterEach=function(n){return Hr(this.afterHooks,n)},Fr.prototype.onReady=function(n,e){this.history.onReady(n,e)},Fr.prototype.onError=function(n){this.history.onError(n)},Fr.prototype.push=function(n,e,t){var o=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){o.history.push(n,e,t)}));this.history.push(n,e,t)},Fr.prototype.replace=function(n,e,t){var o=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){o.history.replace(n,e,t)}));this.history.replace(n,e,t)},Fr.prototype.go=function(n){this.history.go(n)},Fr.prototype.back=function(){this.go(-1)},Fr.prototype.forward=function(){this.go(1)},Fr.prototype.getMatchedComponents=function(n){var e=n?n.matched?n:this.resolve(n).route:this.currentRoute;return e?[].concat.apply([],e.matched.map((function(n){return Object.keys(n.components).map((function(e){return n.components[e]}))}))):[]},Fr.prototype.resolve=function(n,e,t){var o=Fs(n,e=e||this.history.current,t,this),a=this.match(o,e),s=a.redirectedFrom||a.fullPath;return{location:o,route:a,href:function(n,e,t){var o="hash"===t?"#"+e:e;return n?ws(n+"/"+o):o}(this.history.base,s,this.mode),normalizedTo:o,resolved:a}},Fr.prototype.getRoutes=function(){return this.matcher.getRoutes()},Fr.prototype.addRoute=function(n,e){this.matcher.addRoute(n,e),this.history.current!==hs&&this.history.transitionTo(this.history.getCurrentLocation())},Fr.prototype.addRoutes=function(n){this.matcher.addRoutes(n),this.history.current!==hs&&this.history.transitionTo(this.history.getCurrentLocation())},Object.defineProperties(Fr.prototype,Ur);var Gr=Fr;function Hr(n,e){return n.push(e),function(){var t=n.indexOf(e);t>-1&&n.splice(t,1)}}Fr.install=function n(e){if(!n.installed||Us!==e){n.installed=!0,Us=e;var t=function(n){return void 0!==n},o=function(n,e){var o=n.$options._parentVnode;t(o)&&t(o=o.data)&&t(o=o.registerRouteInstance)&&o(n,e)};e.mixin({beforeCreate:function(){t(this.$options.router)?(this._routerRoot=this,this._router=this.$options.router,this._router.init(this),e.util.defineReactive(this,"_route",this._router.history.current)):this._routerRoot=this.$parent&&this.$parent._routerRoot||this,o(this,this)},destroyed:function(){o(this)}}),Object.defineProperty(e.prototype,"$router",{get:function(){return this._routerRoot._router}}),Object.defineProperty(e.prototype,"$route",{get:function(){return this._routerRoot._route}}),e.component("RouterView",vs),e.component("RouterLink",Hs);var a=e.config.optionMergeStrategies;a.beforeRouteEnter=a.beforeRouteLeave=a.beforeRouteUpdate=a.created}},Fr.version="3.6.5",Fr.isNavigationFailure=wr,Fr.NavigationFailureType=fr,Fr.START_LOCATION=hs,Zs&&window.Vue&&window.Vue.use(Fr);t(108);t(18),t(105);var Vr={NotFound:()=>Promise.all([t.e(0),t.e(6)]).then(t.bind(null,353)),Layout:()=>Promise.all([t.e(0),t.e(2)]).then(t.bind(null,351))},Zr={"v-12697179":()=>t.e(9).then(t.bind(null,356)),"v-f6d557ce":()=>t.e(10).then(t.bind(null,357)),"v-460f57d9":()=>t.e(12).then(t.bind(null,358)),"v-538f7059":()=>t.e(13).then(t.bind(null,359)),"v-e8898224":()=>t.e(14).then(t.bind(null,360)),"v-5bfdcf08":()=>t.e(15).then(t.bind(null,361)),"v-125e2d39":()=>t.e(11).then(t.bind(null,362)),"v-390cfdc4":()=>t.e(16).then(t.bind(null,363)),"v-d4660b6a":()=>t.e(17).then(t.bind(null,364)),"v-00ab4999":()=>t.e(19).then(t.bind(null,365)),"v-508a552b":()=>t.e(18).then(t.bind(null,366)),"v-06859f1a":()=>t.e(20).then(t.bind(null,367)),"v-c48b57a8":()=>t.e(22).then(t.bind(null,368)),"v-6d0e3699":()=>t.e(23).then(t.bind(null,369)),"v-ba6e35ce":()=>t.e(24).then(t.bind(null,370)),"v-3ae46072":()=>t.e(21).then(t.bind(null,371)),"v-799b0d32":()=>t.e(25).then(t.bind(null,372)),"v-f1cf5a38":()=>t.e(27).then(t.bind(null,373)),"v-3e101fea":()=>t.e(28).then(t.bind(null,374)),"v-7c1d5117":()=>t.e(26).then(t.bind(null,375)),"v-d172e978":()=>t.e(29).then(t.bind(null,376)),"v-21c554e7":()=>t.e(31).then(t.bind(null,377)),"v-7a7009dc":()=>t.e(32).then(t.bind(null,378)),"v-7492cf63":()=>t.e(30).then(t.bind(null,379)),"v-9ffde008":()=>t.e(33).then(t.bind(null,380)),"v-16ca57ce":()=>t.e(34).then(t.bind(null,381)),"v-9c028ada":()=>t.e(35).then(t.bind(null,382)),"v-3a928a43":()=>t.e(36).then(t.bind(null,383)),"v-6bdef9fc":()=>t.e(37).then(t.bind(null,384)),"v-f0715856":()=>t.e(38).then(t.bind(null,385)),"v-23f7a879":()=>t.e(39).then(t.bind(null,386)),"v-6f8ad9d9":()=>t.e(40).then(t.bind(null,387)),"v-0d3f68c1":()=>t.e(41).then(t.bind(null,388)),"v-d692e0c2":()=>t.e(42).then(t.bind(null,389)),"v-4e6cb445":()=>t.e(43).then(t.bind(null,390)),"v-12346ac4":()=>t.e(44).then(t.bind(null,391)),"v-5a9f7a7c":()=>t.e(45).then(t.bind(null,392)),"v-4b66e9c6":()=>t.e(46).then(t.bind(null,393)),"v-dd6a2a08":()=>t.e(47).then(t.bind(null,394)),"v-b8800ef2":()=>t.e(48).then(t.bind(null,395)),"v-9066c126":()=>t.e(49).then(t.bind(null,396)),"v-5aabcc3a":()=>t.e(51).then(t.bind(null,397)),"v-099c9ca4":()=>t.e(50).then(t.bind(null,398)),"v-5436895e":()=>t.e(52).then(t.bind(null,399)),"v-5cac2a3b":()=>t.e(53).then(t.bind(null,400)),"v-228a9bce":()=>t.e(54).then(t.bind(null,401)),"v-4c3a43d2":()=>t.e(55).then(t.bind(null,402)),"v-765df57e":()=>t.e(56).then(t.bind(null,403)),"v-e52dd084":()=>t.e(57).then(t.bind(null,404)),"v-e2ff91da":()=>t.e(58).then(t.bind(null,405)),"v-df98990e":()=>t.e(59).then(t.bind(null,406)),"v-303fed36":()=>t.e(60).then(t.bind(null,407)),"v-e138df4c":()=>t.e(61).then(t.bind(null,408)),"v-19ff8e6a":()=>t.e(62).then(t.bind(null,409)),"v-24ef5f44":()=>t.e(63).then(t.bind(null,410)),"v-403a5ccb":()=>t.e(64).then(t.bind(null,411)),"v-0542148a":()=>t.e(65).then(t.bind(null,412)),"v-7246ae2c":()=>t.e(66).then(t.bind(null,413)),"v-0580956a":()=>t.e(67).then(t.bind(null,414)),"v-71ab6464":()=>t.e(68).then(t.bind(null,415)),"v-2e07d1a0":()=>t.e(69).then(t.bind(null,416)),"v-6c2001b3":()=>t.e(70).then(t.bind(null,417)),"v-6ba31c1d":()=>t.e(71).then(t.bind(null,418)),"v-a840ca1e":()=>t.e(72).then(t.bind(null,419)),"v-8d36e636":()=>t.e(73).then(t.bind(null,420)),"v-08986d40":()=>t.e(74).then(t.bind(null,421)),"v-38a8ed18":()=>t.e(75).then(t.bind(null,422)),"v-45252678":()=>t.e(76).then(t.bind(null,423)),"v-c86447e2":()=>t.e(77).then(t.bind(null,424)),"v-1ae891a8":()=>t.e(78).then(t.bind(null,425)),"v-0aaf2f47":()=>t.e(79).then(t.bind(null,426)),"v-11090b27":()=>t.e(80).then(t.bind(null,427)),"v-2f584880":()=>t.e(81).then(t.bind(null,428)),"v-52cf205e":()=>t.e(82).then(t.bind(null,429)),"v-44ab5907":()=>t.e(83).then(t.bind(null,430)),"v-e8e0b9ea":()=>t.e(84).then(t.bind(null,431)),"v-ba2529e4":()=>t.e(85).then(t.bind(null,432)),"v-2c290406":()=>t.e(86).then(t.bind(null,433)),"v-78111152":()=>t.e(87).then(t.bind(null,434)),"v-c1c1c24e":()=>t.e(88).then(t.bind(null,435)),"v-0cc13236":()=>t.e(89).then(t.bind(null,436)),"v-0df2a669":()=>t.e(90).then(t.bind(null,437)),"v-74be9f5b":()=>t.e(91).then(t.bind(null,438)),"v-38030407":()=>t.e(92).then(t.bind(null,439)),"v-0576e07d":()=>t.e(93).then(t.bind(null,440)),"v-8488e3a8":()=>t.e(94).then(t.bind(null,441)),"v-515e9f9a":()=>t.e(95).then(t.bind(null,442)),"v-66a7ae24":()=>t.e(98).then(t.bind(null,443)),"v-084ed8e0":()=>t.e(97).then(t.bind(null,444)),"v-9198a8e6":()=>t.e(99).then(t.bind(null,445)),"v-28967f21":()=>t.e(96).then(t.bind(null,446)),"v-44bb153f":()=>t.e(101).then(t.bind(null,447)),"v-0cf4e9e4":()=>t.e(100).then(t.bind(null,448)),"v-c30db28e":()=>t.e(102).then(t.bind(null,449)),"v-477589d8":()=>t.e(103).then(t.bind(null,450)),"v-0bebf3bd":()=>t.e(105).then(t.bind(null,451)),"v-ed9b282c":()=>t.e(104).then(t.bind(null,452)),"v-0a29d12e":()=>t.e(106).then(t.bind(null,453)),"v-09ffdab8":()=>t.e(107).then(t.bind(null,454)),"v-b2ae320e":()=>t.e(110).then(t.bind(null,455)),"v-1ebf1e36":()=>t.e(108).then(t.bind(null,456)),"v-447429d0":()=>t.e(111).then(t.bind(null,457)),"v-64021198":()=>t.e(112).then(t.bind(null,458)),"v-c4242b76":()=>t.e(113).then(t.bind(null,459)),"v-6feefc5e":()=>t.e(114).then(t.bind(null,460)),"v-28dc669e":()=>t.e(115).then(t.bind(null,461)),"v-65a31f9a":()=>t.e(117).then(t.bind(null,462)),"v-db6593ce":()=>t.e(109).then(t.bind(null,463)),"v-3ed70d81":()=>t.e(116).then(t.bind(null,464)),"v-573ab138":()=>t.e(118).then(t.bind(null,465)),"v-20b39df5":()=>t.e(119).then(t.bind(null,466)),"v-0f41bfdd":()=>t.e(120).then(t.bind(null,467)),"v-28471c42":()=>t.e(121).then(t.bind(null,468)),"v-2e1ddaa3":()=>t.e(122).then(t.bind(null,469)),"v-10b832a2":()=>t.e(125).then(t.bind(null,470)),"v-282498df":()=>t.e(126).then(t.bind(null,471)),"v-7b122aa1":()=>t.e(124).then(t.bind(null,472)),"v-787b413e":()=>t.e(123).then(t.bind(null,473)),"v-68775ace":()=>t.e(127).then(t.bind(null,474)),"v-3bd0d01e":()=>t.e(129).then(t.bind(null,475)),"v-1955a3de":()=>t.e(128).then(t.bind(null,476)),"v-8105e1aa":()=>t.e(130).then(t.bind(null,477)),"v-c5ed0f8c":()=>t.e(131).then(t.bind(null,478)),"v-20df7df7":()=>t.e(132).then(t.bind(null,479)),"v-4008dcfe":()=>t.e(133).then(t.bind(null,480)),"v-6f6532a7":()=>t.e(134).then(t.bind(null,481)),"v-003c987e":()=>t.e(135).then(t.bind(null,482)),"v-403d9ae8":()=>t.e(139).then(t.bind(null,483)),"v-75545c56":()=>t.e(136).then(t.bind(null,484)),"v-17a259f2":()=>t.e(137).then(t.bind(null,485)),"v-50528ad2":()=>t.e(138).then(t.bind(null,486)),"v-65b5a670":()=>t.e(140).then(t.bind(null,487)),"v-8923d930":()=>t.e(141).then(t.bind(null,488)),"v-7e9c1840":()=>t.e(142).then(t.bind(null,489))};function Kr(n){const e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}const Wr=/-(\w)/g,Yr=Kr(n=>n.replace(Wr,(n,e)=>e?e.toUpperCase():"")),Xr=/\B([A-Z])/g,Qr=Kr(n=>n.replace(Xr,"-$1").toLowerCase()),Jr=Kr(n=>n.charAt(0).toUpperCase()+n.slice(1));function ni(n,e){if(!e)return;if(n(e))return n(e);return e.includes("-")?n(Jr(Yr(e))):n(Jr(e))||n(Qr(e))}const ei=Object.assign({},Vr,Zr),ti=n=>ei[n],oi=n=>Zr[n],ai=n=>Vr[n],si=n=>Vt.component(n);function ri(n){return ni(oi,n)}function ii(n){return ni(ai,n)}function li(n){return ni(ti,n)}function ci(n){return ni(si,n)}function pi(...n){return Promise.all(n.filter(n=>n).map(async n=>{if(!ci(n)&&li(n)){const e=await li(n)();Vt.component(n,e.default)}}))}function di(n,e){"undefined"!=typeof window&&window.__VUEPRESS__&&(window.__VUEPRESS__[n]=e)}var mi=t(95),ui=t.n(mi),hi=t(96),gi=t.n(hi),bi={created(){if(this.siteMeta=this.$site.headTags.filter(([n])=>"meta"===n).map(([n,e])=>e),this.$ssrContext){const e=this.getMergedMetaTags();this.$ssrContext.title=this.$title,this.$ssrContext.lang=this.$lang,this.$ssrContext.pageMeta=(n=e)?n.map(n=>{let e="<meta";return Object.keys(n).forEach(t=>{e+=` ${t}="${gi()(n[t])}"`}),e+">"}).join("\n    "):"",this.$ssrContext.canonicalLink=yi(this.$canonicalUrl)}var n},mounted(){this.currentMetaTags=[...document.querySelectorAll("meta")],this.updateMeta(),this.updateCanonicalLink()},methods:{updateMeta(){document.title=this.$title,document.documentElement.lang=this.$lang;const n=this.getMergedMetaTags();this.currentMetaTags=_i(n,this.currentMetaTags)},getMergedMetaTags(){const n=this.$page.frontmatter.meta||[];return ui()([{name:"description",content:this.$description}],n,this.siteMeta,vi)},updateCanonicalLink(){fi(),this.$canonicalUrl&&document.head.insertAdjacentHTML("beforeend",yi(this.$canonicalUrl))}},watch:{$page(){this.updateMeta(),this.updateCanonicalLink()}},beforeDestroy(){_i(null,this.currentMetaTags),fi()}};function fi(){const n=document.querySelector("link[rel='canonical']");n&&n.remove()}function yi(n=""){return n?`<link href="${n}" rel="canonical" />`:""}function _i(n,e){if(e&&[...e].filter(n=>n.parentNode===document.head).forEach(n=>document.head.removeChild(n)),n)return n.map(n=>{const e=document.createElement("meta");return Object.keys(n).forEach(t=>{e.setAttribute(t,n[t])}),document.head.appendChild(e),e})}function vi(n){for(const e of["name","property","itemprop"])if(n.hasOwnProperty(e))return n[e]+e;return JSON.stringify(n)}var ki=t(51),xi={mounted(){window.addEventListener("scroll",this.onScroll)},methods:{onScroll:t.n(ki)()((function(){this.setActiveHash()}),300),setActiveHash(){const n=[].slice.call(document.querySelectorAll(".sidebar-link")),e=[].slice.call(document.querySelectorAll(".header-anchor")).filter(e=>n.some(n=>n.hash===e.hash)),t=Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop),o=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),a=window.innerHeight+t;for(let n=0;n<e.length;n++){const s=e[n],r=e[n+1],i=0===n&&0===t||t>=s.parentElement.offsetTop+10&&(!r||t<r.parentElement.offsetTop-10),l=decodeURIComponent(this.$route.hash);if(i&&l!==decodeURIComponent(s.hash)){const t=s;if(a===o)for(let t=n+1;t<e.length;t++)if(l===decodeURIComponent(e[t].hash))return;return this.$vuepress.$set("disableScrollBehavior",!0),void this.$router.replace(decodeURIComponent(t.hash),()=>{this.$nextTick(()=>{this.$vuepress.$set("disableScrollBehavior",!1)})})}}}},beforeDestroy(){window.removeEventListener("scroll",this.onScroll)}},wi=t(27),Ei=t.n(wi),Ai={mounted(){Ei.a.configure({showSpinner:!1}),this.$router.beforeEach((n,e,t)=>{n.path===e.path||Vt.component(n.name)||Ei.a.start(),t()}),this.$router.afterEach(()=>{Ei.a.done(),this.isSidebarOpen=!1})}};t(243),t(244);class zi{constructor(){this.containerEl=document.getElementById("message-container"),this.containerEl||(this.containerEl=document.createElement("div"),this.containerEl.id="message-container",document.body.appendChild(this.containerEl))}show({text:n="",duration:e=3e3}){let t=document.createElement("div");t.className="message move-in",t.innerHTML=`\n      <i style="fill: #06a35a;font-size: 14px;display:inline-flex;align-items: center;">\n        <svg style="fill: #06a35a;font-size: 14px;" t="1572421810237" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2323" width="16" height="16"><path d="M822.811993 824.617989c-83.075838 81.99224-188.546032 124.613757-316.049383 127.86455-122.085362-3.250794-223.943563-45.87231-305.935802-127.86455s-124.613757-184.21164-127.86455-305.935802c3.250794-127.503351 45.87231-232.973545 127.86455-316.049383 81.99224-83.075838 184.21164-126.058554 305.935802-129.309347 127.503351 3.250794 232.973545 46.23351 316.049383 129.309347 83.075838 83.075838 126.058554 188.546032 129.309347 316.049383C949.231746 640.406349 905.887831 742.62575 822.811993 824.617989zM432.716755 684.111464c3.973192 3.973192 8.307584 5.779189 13.364374 6.140388 5.05679 0.361199 9.752381-1.444797 13.364374-5.417989l292.571429-287.514638c3.973192-3.973192 5.779189-8.307584 5.779189-13.364374 0-5.05679-1.805996-9.752381-5.779189-13.364374l1.805996 1.805996c-3.973192-3.973192-8.668783-5.779189-14.086772-6.140388-5.417989-0.361199-10.47478 1.444797-14.809171 5.417989l-264.397884 220.33157c-3.973192 3.250794-8.668783 4.695591-14.447972 4.695591-5.779189 0-10.835979-1.444797-15.53157-3.973192l-94.273016-72.962257c-4.334392-3.250794-9.391182-4.334392-14.447972-3.973192s-9.391182 3.250794-12.641975 7.585185l-2.889594 3.973192c-3.250794 4.334392-4.334392 9.391182-3.973192 14.809171 0.722399 5.417989 2.528395 10.11358 5.779189 14.086772L432.716755 684.111464z" p-id="2324"></path></svg>\n      </i>\n      <div class="text">${n}</div>\n    `,this.containerEl.appendChild(t),e>0&&setTimeout(()=>{this.close(t)},e)}close(n){n.className=n.className.replace("move-in",""),n.className+="move-out",n.addEventListener("animationend",()=>{n.remove()})}}var Bi={mounted(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},updated(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},methods:{updateCopy(){setTimeout(()=>{(['div[class*="language-"] pre','div[class*="aside-code"] aside']instanceof Array||Array.isArray(['div[class*="language-"] pre','div[class*="aside-code"] aside']))&&['div[class*="language-"] pre','div[class*="aside-code"] aside'].forEach(n=>{document.querySelectorAll(n).forEach(this.generateCopyButton)})},1e3)},generateCopyButton(n){if(n.classList.contains("codecopy-enabled"))return;const e=document.createElement("i");e.className="code-copy",e.innerHTML='<svg  style="color:#aaa;font-size:14px" t="1572422231464" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3201" width="14" height="14"><path d="M866.461538 39.384615H354.461538c-43.323077 0-78.769231 35.446154-78.76923 78.769231v39.384616h472.615384c43.323077 0 78.769231 35.446154 78.769231 78.76923v551.384616h39.384615c43.323077 0 78.769231-35.446154 78.769231-78.769231V118.153846c0-43.323077-35.446154-78.769231-78.769231-78.769231z m-118.153846 275.692308c0-43.323077-35.446154-78.769231-78.76923-78.769231H157.538462c-43.323077 0-78.769231 35.446154-78.769231 78.769231v590.769231c0 43.323077 35.446154 78.769231 78.769231 78.769231h512c43.323077 0 78.769231-35.446154 78.76923-78.769231V315.076923z m-354.461538 137.846154c0 11.815385-7.876923 19.692308-19.692308 19.692308h-157.538461c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h157.538461c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z m157.538461 315.076923c0 11.815385-7.876923 19.692308-19.692307 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h315.076923c11.815385 0 19.692308 7.876923 19.692307 19.692308v39.384615z m78.769231-157.538462c0 11.815385-7.876923 19.692308-19.692308 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h393.846153c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z" p-id="3202"></path></svg>',e.title="Copy to clipboard",e.addEventListener("click",()=>{this.copyToClipboard(n.innerText)}),n.appendChild(e),n.classList.add("codecopy-enabled")},copyToClipboard(n){const e=document.createElement("textarea");e.value=n,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e);const t=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);e.select(),document.execCommand("copy");(new zi).show({text:"å¤å¶æå ð",duration:1e3}),document.body.removeChild(e),t&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(t))}}};!function(n,e){void 0===e&&(e={});var t=e.insertAt;if(n&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===t&&o.firstChild?o.insertBefore(a,o.firstChild):o.appendChild(a),a.styleSheet?a.styleSheet.cssText=n:a.appendChild(document.createTextNode(n))}}("@media (max-width: 1000px) {\n  .vuepress-plugin-demo-block__h_code {\n    display: none;\n  }\n  .vuepress-plugin-demo-block__app {\n    margin-left: auto !important;\n    margin-right: auto !important;\n  }\n}\n.vuepress-plugin-demo-block__wrapper {\n  margin-top: 10px;\n  border: 1px solid #ebebeb;\n  border-radius: 4px;\n  transition: all 0.2s;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display {\n  height: 400px;\n  display: flex;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__app {\n  width: 300px;\n  border: 1px solid #ebebeb;\n  box-shadow: 1px 1px 3px #ebebeb;\n  margin-right: 5px;\n  overflow: auto;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__h_code {\n  flex: 1;\n  overflow: auto;\n  height: 100%;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__h_code > pre {\n  overflow: visible;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__display {\n  max-height: 400px;\n  overflow: auto;\n}\n.vuepress-plugin-demo-block__wrapper div {\n  box-sizing: border-box;\n}\n.vuepress-plugin-demo-block__wrapper:hover {\n  box-shadow: 0 0 11px rgba(33, 33, 33, 0.2);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__code {\n  overflow: hidden;\n  height: 0;\n  padding: 0 !important;\n  background-color: #282c34;\n  border-radius: 0 !important;\n  transition: height 0.5s;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__code pre {\n  margin: 0 !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__display {\n  padding: 20px;\n  border-bottom: 1px solid #ebebeb;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer {\n  position: relative;\n  text-align: center;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__codepen {\n  opacity: 1;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__expand::before {\n  border-top: none;\n  border-right: 6px solid transparent;\n  border-bottom: 6px solid #ccc;\n  border-left: 6px solid transparent;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__codepen,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand span,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand {\n  opacity: 1;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand::before {\n  border-top-color: #3eaf7c !important;\n  border-bottom-color: #3eaf7c !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover svg {\n  fill: #3eaf7c !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand-text {\n  transition: all 0.5s;\n  opacity: 0;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer form:nth-last-child(2) {\n  right: 50px;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer form:last-child {\n  right: 10px;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button {\n  border-color: transparent;\n  background-color: transparent;\n  font-size: 14px;\n  color: #3eaf7c;\n  cursor: pointer;\n  outline: none;\n  margin: 0;\n  width: 46px;\n  position: relative;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button:hover::before {\n  content: attr(data-tip);\n  white-space: nowrap;\n  position: absolute;\n  top: -30px;\n  left: 50%;\n  color: #eee;\n  line-height: 1;\n  z-index: 1000;\n  border-radius: 4px;\n  padding: 6px;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  background-color: rgba(0, 0, 0, 0.8);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button:hover::after {\n  content: '' !important;\n  display: block;\n  position: absolute;\n  left: 50%;\n  top: -5px;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  border: 5px solid transparent;\n  border-top-color: rgba(0, 0, 0, 0.8);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button svg {\n  width: 34px;\n  height: 20px;\n  fill: #ccc;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__codepen {\n  position: absolute;\n  top: 10px;\n  transition: all 0.5s;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand {\n  position: relative;\n  width: 100px;\n  height: 40px;\n  margin: 0;\n  color: #3eaf7c;\n  font-size: 14px;\n  background-color: transparent;\n  border-color: transparent;\n  outline: none;\n  transition: all 0.5s;\n  cursor: pointer;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand::before {\n  content: \"\";\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 0;\n  height: 0;\n  border-top: 6px solid #ccc;\n  border-right: 6px solid transparent;\n  border-left: 6px solid transparent;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n");var Ti={jsLib:[],cssLib:[],jsfiddle:!0,codepen:!0,codepenLayout:"left",codepenJsProcessor:"babel",codepenEditors:"101",horizontal:!1,vue:"https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js",react:"https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js",reactDOM:"https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"},Si={},$i=function(n){return'<div id="app">\n'.concat(n,"\n</div>")},ji=function(n){return window.$VUEPRESS_DEMO_BLOCK&&void 0!==window.$VUEPRESS_DEMO_BLOCK[n]?window.$VUEPRESS_DEMO_BLOCK[n]:Ti[n]},Ii=function n(e,t,o){var a=document.createElement(e);return t&&Object.keys(t).forEach((function(n){if(n.indexOf("data"))a[n]=t[n];else{var e=n.replace("data","");a.dataset[e]=t[n]}})),o&&o.forEach((function(e){var t=e.tag,o=e.attrs,s=e.children;a.appendChild(n(t,o,s))})),a},Pi=function(n,e,t){var o,a=(o=n.querySelectorAll(".".concat(e)),Array.prototype.slice.call(o));return 1!==a.length||t?a:a[0]},Di=function(n,e){var t,o,a=n.match(/<style>([\s\S]+)<\/style>/),s=n.match(/<template>([\s\S]+)<\/template>/),r=n.match(/<script>([\s\S]+)<\/script>/),i={css:a&&a[1].replace(/^\n|\n$/g,""),html:s&&s[1].replace(/^\n|\n$/g,""),js:r&&r[1].replace(/^\n|\n$/g,""),jsLib:e.jsLib||[],cssLib:e.cssLib||[]};i.htmlTpl=$i(i.html),i.jsTpl=(t=i.js,o=t.replace(/export\s+default\s*?\{\n*/,"").replace(/\n*\}\s*$/,"").trim(),"new Vue({\n  el: '#app',\n  ".concat(o,"\n})")),i.script=function(n,e){var t=n.split(/export\s+default/),o="(function() {".concat(t[0]," ; return ").concat(t[1],"})()"),a=window.Babel?window.Babel.transform(o,{presets:["es2015"]}).code:o,s=[eval][0](a);return s.template=e,s}(i.js,i.html);var l=ji("vue");return i.jsLib.unshift(l),i},Ci=function(n,e){var t,o=n.match(/<style>([\s\S]+)<\/style>/),a=n.match(/<html>([\s\S]+)<\/html>/),s=n.match(/<script>([\s\S]+)<\/script>/),r={css:o&&o[1].replace(/^\n|\n$/g,""),html:a&&a[1].replace(/^\n|\n$/g,""),js:s&&s[1].replace(/^\n|\n$/g,""),jsLib:e.jsLib||[],cssLib:e.cssLib||[]};return r.htmlTpl=r.html,r.jsTpl=r.js,r.script=(t=r.js,window.Babel?window.Babel.transform(t,{presets:["es2015"]}).code:t),r},Ri=function(n){return n=n.replace("export default ","").replace(/App\.__style__(\s*)=(\s*)`([\s\S]*)?`/,""),n+='ReactDOM.render(React.createElement(App), document.getElementById("app"))'};function Oi(){var n=Pi(document,"vuepress-plugin-demo-block__wrapper",!0);n.length?n.forEach((function(n){if("true"!==n.dataset.created){n.style.display="block";var e=Pi(n,"vuepress-plugin-demo-block__code"),t=Pi(n,"vuepress-plugin-demo-block__display"),o=Pi(n,"vuepress-plugin-demo-block__footer"),a=Pi(t,"vuepress-plugin-demo-block__app"),s=decodeURIComponent(n.dataset.code),r=decodeURIComponent(n.dataset.config),i=decodeURIComponent(n.dataset.type);r=r?JSON.parse(r):{};var l=e.querySelector("div").clientHeight,c="react"===i?function(n,e){var t=(0,window.Babel.transform)(n,{presets:["es2015","react"]}).code,o="(function(exports){var module={};module.exports=exports;".concat(t,";return module.exports.__esModule?module.exports.default:module.exports;})({})"),a=new Function("return ".concat(o))(),s={js:a,css:a.__style__||"",jsLib:e.jsLib||[],cssLib:e.cssLib||[],jsTpl:Ri(n),htmlTpl:$i("")},r=ji("react"),i=ji("reactDOM");return s.jsLib.unshift(r,i),s}(s,r):"vanilla"===i?Ci(s,r):Di(s,r),p=Ii("button",{className:"".concat("vuepress-plugin-demo-block__expand")});if(o.appendChild(p),p.addEventListener("click",Li.bind(null,p,l,e,o)),ji("jsfiddle")&&o.appendChild(function(n){var e=n.css,t=n.htmlTpl,o=n.jsTpl,a=n.jsLib,s=n.cssLib,r=a.concat(s).concat(ji("cssLib")).concat(ji("jsLib")).join(",");return Ii("form",{className:"vuepress-plugin-demo-block__jsfiddle",target:"_blank",action:"https://jsfiddle.net/api/post/library/pure/",method:"post"},[{tag:"input",attrs:{type:"hidden",name:"css",value:e}},{tag:"input",attrs:{type:"hidden",name:"html",value:t}},{tag:"input",attrs:{type:"hidden",name:"js",value:o}},{tag:"input",attrs:{type:"hidden",name:"panel_js",value:3}},{tag:"input",attrs:{type:"hidden",name:"wrap",value:1}},{tag:"input",attrs:{type:"hidden",name:"resources",value:r}},{tag:"button",attrs:{type:"submit",className:"vuepress-plugin-demo-block__button",innerHTML:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1547088289967" class="icon" style="" viewBox="0 0 1170 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1952" xmlns:xlink="http://www.w3.org/1999/xlink" width="228.515625" height="200"><defs><style type="text/css"></style></defs><path d="M1028.571429 441.142857q63.428571 26.285714 102.571428 83.142857T1170.285714 650.857143q0 93.714286-67.428571 160.285714T940 877.714286q-2.285714 0-6.571429-0.285715t-6-0.285714H232q-97.142857-5.714286-164.571429-71.714286T0 645.142857q0-62.857143 31.428571-116t84-84q-6.857143-22.285714-6.857142-46.857143 0-65.714286 46.857142-112t113.714286-46.285714q54.285714 0 98.285714 33.142857 42.857143-88 127.142858-141.714286t186.571428-53.714285q94.857143 0 174.857143 46T982.571429 248.571429t46.571428 172q0 3.428571-0.285714 10.285714t-0.285714 10.285714zM267.428571 593.142857q0 69.714286 48 110.285714t118.857143 40.571429q78.285714 0 137.142857-56.571429-9.142857-11.428571-27.142857-32.285714T519.428571 626.285714q-38.285714 37.142857-82.285714 37.142857-31.428571 0-53.428571-19.142857T361.714286 594.285714q0-30.285714 22-49.714285t52.285714-19.428572q25.142857 0 48.285714 12t41.714286 31.428572 37.142857 42.857142 39.428572 46.857143 44 42.857143 55.428571 31.428572 69.428571 12q69.142857 0 116.857143-40.857143T936 594.857143q0-69.142857-48-109.714286t-118.285714-40.571428q-81.714286 0-137.714286 55.428571l53.142857 61.714286q37.714286-36.571429 81.142857-36.571429 29.714286 0 52.571429 18.857143t22.857143 48q0 32.571429-21.142857 52.285714t-53.714286 19.714286q-24.571429 0-47.142857-12t-41.142857-31.428571-37.428572-42.857143-39.714286-46.857143-44.285714-42.857143-55.142857-31.428571T434.285714 444.571429q-69.714286 0-118.285714 40.285714T267.428571 593.142857z" p-id="1953"></path></svg>',datatip:"JSFiddle"}}])}(c)),ji("codepen")&&o.appendChild(function(n){var e=n.css,t=n.htmlTpl,o=n.jsTpl,a=n.jsLib,s=n.cssLib,r=JSON.stringify({css:e,html:t,js:o,js_external:a.concat(ji("jsLib")).join(";"),css_external:s.concat(ji("cssLib")).join(";"),layout:ji("codepenLayout"),js_pre_processor:ji("codepenJsProcessor"),editors:ji("codepenEditors")});return Ii("form",{className:"vuepress-plugin-demo-block__codepen",target:"_blank",action:"https://codepen.io/pen/define",method:"post"},[{tag:"input",attrs:{type:"hidden",name:"data",value:r}},{tag:"button",attrs:{type:"submit",innerHTML:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1547088271207" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1737" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M123.428571 668l344.571429 229.714286v-205.142857L277.142857 565.142857z m-35.428571-82.285714l110.285714-73.714286-110.285714-73.714286v147.428572z m468 312l344.571429-229.714286-153.714286-102.857143-190.857143 127.428572v205.142857z m-44-281.714286l155.428571-104-155.428571-104-155.428571 104zM277.142857 458.857143l190.857143-127.428572V126.285714L123.428571 356z m548.571429 53.142857l110.285714 73.714286V438.285714z m-78.857143-53.142857l153.714286-102.857143-344.571429-229.714286v205.142857z m277.142857-102.857143v312q0 23.428571-19.428571 36.571429l-468 312q-12 7.428571-24.571429 7.428571t-24.571429-7.428571L19.428571 704.571429q-19.428571-13.142857-19.428571-36.571429V356q0-23.428571 19.428571-36.571429L487.428571 7.428571q12-7.428571 24.571429-7.428571t24.571429 7.428571l468 312q19.428571 13.142857 19.428571 36.571429z" p-id="1738"></path></svg>',className:"vuepress-plugin-demo-block__button",datatip:"Codepen"}}])}(c)),void 0!==r.horizontal?r.horizontal:ji("horizontal")){n.classList.add("vuepress-plugin-demo-block__horizontal");var d=e.firstChild.cloneNode(!0);d.classList.add("vuepress-plugin-demo-block__h_code"),t.appendChild(d)}if(c.css&&function(n){if(!Si[n]){var e=Ii("style",{innerHTML:n});document.body.appendChild(e),Si[n]=!0}}(c.css),"react"===i)ReactDOM.render(React.createElement(c.js),a);else if("vue"===i){var m=(new(Vue.extend(c.script))).$mount();a.appendChild(m.$el)}else"vanilla"===i&&(a.innerHTML=c.html,new Function("return (function(){".concat(c.script,"})()"))());n.dataset.created="true"}})):setTimeout((function(n){Oi()}),300)}function Li(n,e,t,o){var a="1"!==n.dataset.isExpand;t.style.height=a?"".concat(e,"px"):0,a?o.classList.add("vuepress-plugin-demo-block__show-link"):o.classList.remove("vuepress-plugin-demo-block__show-link"),n.dataset.isExpand=a?"1":"0"}var Mi={mounted:function(){window.$VUEPRESS_DEMO_BLOCK={jsfiddle:!1,codepen:!0,horizontal:!1},Oi()},updated:function(){Oi()}},qi="auto",Ni="zoom-in",Fi="zoom-out",Ui="grab",Gi="move";function Hi(n,e,t){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a={passive:!1};o?n.addEventListener(e,t,a):n.removeEventListener(e,t,a)}function Vi(n,e){if(n){var t=new Image;t.onload=function(){e&&e(t)},t.src=n}}function Zi(n){return n.dataset.original?n.dataset.original:"A"===n.parentNode.tagName?n.parentNode.getAttribute("href"):null}function Ki(n,e,t){!function(n){var e=Wi,t=Yi;if(n.transition){var o=n.transition;delete n.transition,n[e]=o}if(n.transform){var a=n.transform;delete n.transform,n[t]=a}}(e);var o=n.style,a={};for(var s in e)t&&(a[s]=o[s]||""),o[s]=e[s];return a}var Wi="transition",Yi="transform",Xi="transform",Qi="transitionend";var Ji=function(){},nl={enableGrab:!0,preloadImage:!1,closeOnWindowResize:!0,transitionDuration:.4,transitionTimingFunction:"cubic-bezier(0.4, 0, 0, 1)",bgColor:"rgb(255, 255, 255)",bgOpacity:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,zIndex:998,customSize:null,onOpen:Ji,onClose:Ji,onGrab:Ji,onMove:Ji,onRelease:Ji,onBeforeOpen:Ji,onBeforeClose:Ji,onBeforeGrab:Ji,onBeforeRelease:Ji,onImageLoading:Ji,onImageLoaded:Ji},el={init:function(n){var e,t;e=this,t=n,Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(n){e[n]=e[n].bind(t)}))},click:function(n){if(n.preventDefault(),ol(n))return window.open(this.target.srcOriginal||n.currentTarget.src,"_blank");this.shown?this.released?this.close():this.release():this.open(n.currentTarget)},scroll:function(){var n=document.documentElement||document.body.parentNode||document.body,e=window.pageXOffset||n.scrollLeft,t=window.pageYOffset||n.scrollTop;null===this.lastScrollPosition&&(this.lastScrollPosition={x:e,y:t});var o=this.lastScrollPosition.x-e,a=this.lastScrollPosition.y-t,s=this.options.scrollThreshold;(Math.abs(a)>=s||Math.abs(o)>=s)&&(this.lastScrollPosition=null,this.close())},keydown:function(n){(function(n){return"Escape"===(n.key||n.code)||27===n.keyCode})(n)&&(this.released?this.close():this.release(this.close))},mousedown:function(n){if(tl(n)&&!ol(n)){n.preventDefault();var e=n.clientX,t=n.clientY;this.pressTimer=setTimeout(function(){this.grab(e,t)}.bind(this),200)}},mousemove:function(n){this.released||this.move(n.clientX,n.clientY)},mouseup:function(n){tl(n)&&!ol(n)&&(clearTimeout(this.pressTimer),this.released?this.close():this.release())},touchstart:function(n){n.preventDefault();var e=n.touches[0],t=e.clientX,o=e.clientY;this.pressTimer=setTimeout(function(){this.grab(t,o)}.bind(this),200)},touchmove:function(n){if(!this.released){var e=n.touches[0],t=e.clientX,o=e.clientY;this.move(t,o)}},touchend:function(n){(function(n){n.targetTouches.length})(n)||(clearTimeout(this.pressTimer),this.released?this.close():this.release())},clickOverlay:function(){this.close()},resizeWindow:function(){this.close()}};function tl(n){return 0===n.button}function ol(n){return n.metaKey||n.ctrlKey}var al={init:function(n){this.el=document.createElement("div"),this.instance=n,this.parent=document.body,Ki(this.el,{position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0}),this.updateStyle(n.options),Hi(this.el,"click",n.handler.clickOverlay.bind(n))},updateStyle:function(n){Ki(this.el,{zIndex:n.zIndex,backgroundColor:n.bgColor,transition:"opacity\n        "+n.transitionDuration+"s\n        "+n.transitionTimingFunction})},insert:function(){this.parent.appendChild(this.el)},remove:function(){this.parent.removeChild(this.el)},fadeIn:function(){this.el.offsetWidth,this.el.style.opacity=this.instance.options.bgOpacity},fadeOut:function(){this.el.style.opacity=0}},sl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},rl=function(){function n(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),il=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},ll={init:function(n,e){this.el=n,this.instance=e,this.srcThumbnail=this.el.getAttribute("src"),this.srcset=this.el.getAttribute("srcset"),this.srcOriginal=Zi(this.el),this.rect=this.el.getBoundingClientRect(),this.translate=null,this.scale=null,this.styleOpen=null,this.styleClose=null},zoomIn:function(){var n=this.instance.options,e=n.zIndex,t=n.enableGrab,o=n.transitionDuration,a=n.transitionTimingFunction;this.translate=this.calculateTranslate(),this.scale=this.calculateScale(),this.styleOpen={position:"relative",zIndex:e+1,cursor:t?Ui:Fi,transition:Xi+"\n        "+o+"s\n        "+a,transform:"translate3d("+this.translate.x+"px, "+this.translate.y+"px, 0px)\n        scale("+this.scale.x+","+this.scale.y+")",height:this.rect.height+"px",width:this.rect.width+"px"},this.el.offsetWidth,this.styleClose=Ki(this.el,this.styleOpen,!0)},zoomOut:function(){this.el.offsetWidth,Ki(this.el,{transform:"none"})},grab:function(n,e,t){var o=cl(),a=o.x-n,s=o.y-e;Ki(this.el,{cursor:Gi,transform:"translate3d(\n        "+(this.translate.x+a)+"px, "+(this.translate.y+s)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},move:function(n,e,t){var o=cl(),a=o.x-n,s=o.y-e;Ki(this.el,{transition:Xi,transform:"translate3d(\n        "+(this.translate.x+a)+"px, "+(this.translate.y+s)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},restoreCloseStyle:function(){Ki(this.el,this.styleClose)},restoreOpenStyle:function(){Ki(this.el,this.styleOpen)},upgradeSource:function(){if(this.srcOriginal){var n=this.el.parentNode;this.srcset&&this.el.removeAttribute("srcset");var e=this.el.cloneNode(!1);e.setAttribute("src",this.srcOriginal),e.style.position="fixed",e.style.visibility="hidden",n.appendChild(e),setTimeout(function(){this.el.setAttribute("src",this.srcOriginal),n.removeChild(e)}.bind(this),50)}},downgradeSource:function(){this.srcOriginal&&(this.srcset&&this.el.setAttribute("srcset",this.srcset),this.el.setAttribute("src",this.srcThumbnail))},calculateTranslate:function(){var n=cl(),e=this.rect.left+this.rect.width/2,t=this.rect.top+this.rect.height/2;return{x:n.x-e,y:n.y-t}},calculateScale:function(){var n=this.el.dataset,e=n.zoomingHeight,t=n.zoomingWidth,o=this.instance.options,a=o.customSize,s=o.scaleBase;if(!a&&e&&t)return{x:t/this.rect.width,y:e/this.rect.height};if(a&&"object"===(void 0===a?"undefined":sl(a)))return{x:a.width/this.rect.width,y:a.height/this.rect.height};var r=this.rect.width/2,i=this.rect.height/2,l=cl(),c={x:l.x-r,y:l.y-i},p=c.x/r,d=c.y/i,m=s+Math.min(p,d);if(a&&"string"==typeof a){var u=t||this.el.naturalWidth,h=e||this.el.naturalHeight,g=parseFloat(a)*u/(100*this.rect.width),b=parseFloat(a)*h/(100*this.rect.height);if(m>g||m>b)return{x:g,y:b}}return{x:m,y:m}}};function cl(){var n=document.documentElement;return{x:Math.min(n.clientWidth,window.innerWidth)/2,y:Math.min(n.clientHeight,window.innerHeight)/2}}function pl(n,e,t){["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"].forEach((function(o){Hi(n,o,e[o],t)}))}var dl=function(){function n(e){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.target=Object.create(ll),this.overlay=Object.create(al),this.handler=Object.create(el),this.body=document.body,this.shown=!1,this.lock=!1,this.released=!0,this.lastScrollPosition=null,this.pressTimer=null,this.options=il({},nl,e),this.overlay.init(this),this.handler.init(this)}return rl(n,[{key:"listen",value:function(n){if("string"==typeof n)for(var e=document.querySelectorAll(n),t=e.length;t--;)this.listen(e[t]);else"IMG"===n.tagName&&(n.style.cursor=Ni,Hi(n,"click",this.handler.click),this.options.preloadImage&&Vi(Zi(n)));return this}},{key:"config",value:function(n){return n?(il(this.options,n),this.overlay.updateStyle(this.options),this):this.options}},{key:"open",value:function(n){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.onOpen;if(!this.shown&&!this.lock){var o="string"==typeof n?document.querySelector(n):n;if("IMG"===o.tagName){if(this.options.onBeforeOpen(o),this.target.init(o,this),!this.options.preloadImage){var a=this.target.srcOriginal;null!=a&&(this.options.onImageLoading(o),Vi(a,this.options.onImageLoaded))}this.shown=!0,this.lock=!0,this.target.zoomIn(),this.overlay.insert(),this.overlay.fadeIn(),Hi(document,"scroll",this.handler.scroll),Hi(document,"keydown",this.handler.keydown),this.options.closeOnWindowResize&&Hi(window,"resize",this.handler.resizeWindow);var s=function n(){Hi(o,Qi,n,!1),e.lock=!1,e.target.upgradeSource(),e.options.enableGrab&&pl(document,e.handler,!0),t(o)};return Hi(o,Qi,s),this}}}},{key:"close",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onClose;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeClose(t),this.lock=!0,this.body.style.cursor=qi,this.overlay.fadeOut(),this.target.zoomOut(),Hi(document,"scroll",this.handler.scroll,!1),Hi(document,"keydown",this.handler.keydown,!1),this.options.closeOnWindowResize&&Hi(window,"resize",this.handler.resizeWindow,!1);var o=function o(){Hi(t,Qi,o,!1),n.shown=!1,n.lock=!1,n.target.downgradeSource(),n.options.enableGrab&&pl(document,n.handler,!1),n.target.restoreCloseStyle(),n.overlay.remove(),e(t)};return Hi(t,Qi,o),this}}},{key:"grab",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onGrab;if(this.shown&&!this.lock){var a=this.target.el;this.options.onBeforeGrab(a),this.released=!1,this.target.grab(n,e,t);var s=function n(){Hi(a,Qi,n,!1),o(a)};return Hi(a,Qi,s),this}}},{key:"move",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onMove;if(this.shown&&!this.lock){this.released=!1,this.body.style.cursor=Gi,this.target.move(n,e,t);var a=this.target.el,s=function n(){Hi(a,Qi,n,!1),o(a)};return Hi(a,Qi,s),this}}},{key:"release",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onRelease;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeRelease(t),this.lock=!0,this.body.style.cursor=qi,this.target.restoreOpenStyle();var o=function o(){Hi(t,Qi,o,!1),n.lock=!1,n.released=!0,e(t)};return Hi(t,Qi,o),this}}}]),n}();const ml=JSON.parse('{"bgColor":"rgba(0,0,0,0.6)"}'),ul=Number("500");class hl{constructor(){this.instance=new dl(ml)}update(n=".theme-vdoing-content img:not(.no-zoom)"){"undefined"!=typeof window&&this.instance.listen(n)}updateDelay(n=".theme-vdoing-content img:not(.no-zoom)",e=ul){setTimeout(()=>this.update(n),e)}}var gl=[bi,xi,Ai,Bi,Mi,{watch:{"$page.path"(){void 0!==this.$vuepress.zooming&&this.$vuepress.zooming.updateDelay()}},mounted(){this.$vuepress.zooming=new hl,this.$vuepress.zooming.updateDelay()}}],bl={name:"GlobalLayout",computed:{layout(){const n=this.getLayout();return di("layout",n),Vt.component(n)}},methods:{getLayout(){if(this.$page.path){const n=this.$page.frontmatter.layout;return n&&(this.$vuepress.getLayoutAsyncComponent(n)||this.$vuepress.getVueComponent(n))?n:"Layout"}return"NotFound"}}},fl=t(0),yl=Object(fl.a)(bl,(function(){return(0,this._self._c)(this.layout,{tag:"component"})}),[],!1,null,null,null).exports;!function(n,e,t){switch(e){case"components":n[e]||(n[e]={}),Object.assign(n[e],t);break;case"mixins":n[e]||(n[e]=[]),n[e].push(...t);break;default:throw new Error("Unknown option name.")}}(yl,"mixins",gl);const _l=[{name:"v-12697179",path:"/ansible/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-12697179").then(t)}},{path:"/ansible/index.html",redirect:"/ansible/"},{path:"/00.ç®å½é¡µ/01.ansible.html",redirect:"/ansible/"},{name:"v-f6d557ce",path:"/k8s/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-f6d557ce").then(t)}},{path:"/k8s/index.html",redirect:"/k8s/"},{path:"/00.ç®å½é¡µ/02.k8s.html",redirect:"/k8s/"},{name:"v-460f57d9",path:"/jenkins/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-460f57d9").then(t)}},{path:"/jenkins/index.html",redirect:"/jenkins/"},{path:"/00.ç®å½é¡µ/04.jenkins.html",redirect:"/jenkins/"},{name:"v-538f7059",path:"/suibi/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-538f7059").then(t)}},{path:"/suibi/index.html",redirect:"/suibi/"},{path:"/00.ç®å½é¡µ/05.éç¬.html",redirect:"/suibi/"},{name:"v-e8898224",path:"/mianshi/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-e8898224").then(t)}},{path:"/mianshi/index.html",redirect:"/mianshi/"},{path:"/00.ç®å½é¡µ/06.é¢è¯.html",redirect:"/mianshi/"},{name:"v-5bfdcf08",path:"/gongju/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-5bfdcf08").then(t)}},{path:"/gongju/index.html",redirect:"/gongju/"},{path:"/00.ç®å½é¡µ/07.å·¥å·.html",redirect:"/gongju/"},{name:"v-125e2d39",path:"/elk/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-125e2d39").then(t)}},{path:"/elk/index.html",redirect:"/elk/"},{path:"/00.ç®å½é¡µ/03.elk.html",redirect:"/elk/"},{name:"v-390cfdc4",path:"/life/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-390cfdc4").then(t)}},{path:"/life/index.html",redirect:"/life/"},{path:"/00.ç®å½é¡µ/08.çæ´».html",redirect:"/life/"},{name:"v-d4660b6a",path:"/code/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-d4660b6a").then(t)}},{path:"/code/index.html",redirect:"/code/"},{path:"/00.ç®å½é¡µ/09.ç¼ç¨.html",redirect:"/code/"},{name:"v-00ab4999",path:"/shell/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-00ab4999").then(t)}},{path:"/shell/index.html",redirect:"/shell/"},{path:"/00.ç®å½é¡µ/11.shell.html",redirect:"/shell/"},{name:"v-508a552b",path:"/python/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-508a552b").then(t)}},{path:"/python/index.html",redirect:"/python/"},{path:"/00.ç®å½é¡µ/10.python.html",redirect:"/python/"},{name:"v-06859f1a",path:"/topic/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-06859f1a").then(t)}},{path:"/topic/index.html",redirect:"/topic/"},{path:"/00.ç®å½é¡µ/12.ä¸é¢.html",redirect:"/topic/"},{name:"v-c48b57a8",path:"/middleware/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-c48b57a8").then(t)}},{path:"/middleware/index.html",redirect:"/middleware/"},{path:"/00.ç®å½é¡µ/14.ä¸­é´ä»¶.html",redirect:"/middleware/"},{name:"v-6d0e3699",path:"/linux/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-6d0e3699").then(t)}},{path:"/linux/index.html",redirect:"/linux/"},{path:"/00.ç®å½é¡µ/15.linux.html",redirect:"/linux/"},{name:"v-ba6e35ce",path:"/windows/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-ba6e35ce").then(t)}},{path:"/windows/index.html",redirect:"/windows/"},{path:"/00.ç®å½é¡µ/16.windows.html",redirect:"/windows/"},{name:"v-3ae46072",path:"/ops/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-3ae46072").then(t)}},{path:"/ops/index.html",redirect:"/ops/"},{path:"/00.ç®å½é¡µ/13.è¿ç»´.html",redirect:"/ops/"},{name:"v-799b0d32",path:"/network/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-799b0d32").then(t)}},{path:"/network/index.html",redirect:"/network/"},{path:"/00.ç®å½é¡µ/17.ç½ç».html",redirect:"/network/"},{name:"v-f1cf5a38",path:"/storage/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-f1cf5a38").then(t)}},{path:"/storage/index.html",redirect:"/storage/"},{path:"/00.ç®å½é¡µ/19.å­å¨.html",redirect:"/storage/"},{name:"v-3e101fea",path:"/firewalld/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-3e101fea").then(t)}},{path:"/firewalld/index.html",redirect:"/firewalld/"},{path:"/00.ç®å½é¡µ/20.é²ç«å¢.html",redirect:"/firewalld/"},{name:"v-7c1d5117",path:"/safety/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-7c1d5117").then(t)}},{path:"/safety/index.html",redirect:"/safety/"},{path:"/00.ç®å½é¡µ/18.å®å¨.html",redirect:"/safety/"},{name:"v-d172e978",path:"/db/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-d172e978").then(t)}},{path:"/db/index.html",redirect:"/db/"},{path:"/00.ç®å½é¡µ/21.æ°æ®åº.html",redirect:"/db/"},{name:"v-21c554e7",path:"/docker/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-21c554e7").then(t)}},{path:"/docker/index.html",redirect:"/docker/"},{path:"/00.ç®å½é¡µ/23.docker.html",redirect:"/docker/"},{name:"v-7a7009dc",path:"/tool/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-7a7009dc").then(t)}},{path:"/tool/index.html",redirect:"/tool/"},{path:"/00.ç®å½é¡µ/24.è¿ç»´å·¥å·.html",redirect:"/tool/"},{name:"v-7492cf63",path:"/sys/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-7492cf63").then(t)}},{path:"/sys/index.html",redirect:"/sys/"},{path:"/00.ç®å½é¡µ/22.ç³»ç».html",redirect:"/sys/"},{name:"v-9ffde008",path:"/monitor/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-9ffde008").then(t)}},{path:"/monitor/index.html",redirect:"/monitor/"},{path:"/00.ç®å½é¡µ/25.çæ§.html",redirect:"/monitor/"},{name:"v-16ca57ce",path:"/other/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-16ca57ce").then(t)}},{path:"/other/index.html",redirect:"/other/"},{path:"/00.ç®å½é¡µ/26.other.html",redirect:"/other/"},{name:"v-9c028ada",path:"/pages/12c5da01/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-9c028ada").then(t)}},{path:"/pages/12c5da01/index.html",redirect:"/pages/12c5da01/"},{path:"/01.ä¸é¢/01.ansibleç³»åæç« /01.ansibleå¥é¨.html",redirect:"/pages/12c5da01/"},{name:"v-3a928a43",path:"/pages/f8f66c/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-3a928a43").then(t)}},{path:"/pages/f8f66c/index.html",redirect:"/pages/f8f66c/"},{path:"/01.ä¸é¢/01.ansibleç³»åæç« /02.anisbleæ¹éå®è£node_exporter.html",redirect:"/pages/f8f66c/"},{name:"v-6bdef9fc",path:"/pages/d740bc/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-6bdef9fc").then(t)}},{path:"/pages/d740bc/index.html",redirect:"/pages/d740bc/"},{path:"/01.ä¸é¢/01.ansibleç³»åæç« /03.ansible-playbookä¸­çåé.html",redirect:"/pages/d740bc/"},{name:"v-f0715856",path:"/pages/a06506/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-f0715856").then(t)}},{path:"/pages/a06506/index.html",redirect:"/pages/a06506/"},{path:"/01.ä¸é¢/01.ansibleç³»åæç« /04.Ansibleæ§è½ä¼åââæåansibleæ§è¡æç.html",redirect:"/pages/a06506/"},{name:"v-23f7a879",path:"/pages/847542/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-23f7a879").then(t)}},{path:"/pages/847542/index.html",redirect:"/pages/847542/"},{path:"/01.ä¸é¢/01.ansibleç³»åæç« /05.ansibleä¹rolesç®åä½¿ç¨.html",redirect:"/pages/847542/"},{name:"v-6f8ad9d9",path:"/pages/4189b8/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-6f8ad9d9").then(t)}},{path:"/pages/4189b8/index.html",redirect:"/pages/4189b8/"},{path:"/01.ä¸é¢/01.ansibleç³»åæç« /06.ansibleä¸­templateç®åä½¿ç¨.html",redirect:"/pages/4189b8/"},{name:"v-0d3f68c1",path:"/pages/14eda9/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-0d3f68c1").then(t)}},{path:"/pages/14eda9/index.html",redirect:"/pages/14eda9/"},{path:"/01.ä¸é¢/01.ansibleç³»åæç« /07.Ansibleä¸­çplaybook è¯¦è§£.html",redirect:"/pages/14eda9/"},{name:"v-d692e0c2",path:"/pages/7eca6b/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-d692e0c2").then(t)}},{path:"/pages/7eca6b/index.html",redirect:"/pages/7eca6b/"},{path:"/01.ä¸é¢/01.ansibleç³»åæç« /08.ansible-playbookç¼æä½¿ç¨tips.html",redirect:"/pages/7eca6b/"},{name:"v-4e6cb445",path:"/pages/4fbba1/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-4e6cb445").then(t)}},{path:"/pages/4fbba1/index.html",redirect:"/pages/4fbba1/"},{path:"/01.ä¸é¢/01.ansibleç³»åæç« /09.ansibleä¼ç§æ¡ä¾.html",redirect:"/pages/4fbba1/"},{name:"v-12346ac4",path:"/pages/fc6bfb/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-12346ac4").then(t)}},{path:"/pages/fc6bfb/index.html",redirect:"/pages/fc6bfb/"},{path:"/01.ä¸é¢/02.k8s/01.å¿«éé¨ç½²k8séç¾¤.html",redirect:"/pages/fc6bfb/"},{name:"v-5a9f7a7c",path:"/pages/98c9f5/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-5a9f7a7c").then(t)}},{path:"/pages/98c9f5/index.html",redirect:"/pages/98c9f5/"},{path:"/01.ä¸é¢/03.elk/01.elkå®è£.html",redirect:"/pages/98c9f5/"},{name:"v-4b66e9c6",path:"/pages/bbe108/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-4b66e9c6").then(t)}},{path:"/pages/bbe108/index.html",redirect:"/pages/bbe108/"},{path:"/01.ä¸é¢/03.elk/02.docker-composeå®è£elk.html",redirect:"/pages/bbe108/"},{name:"v-dd6a2a08",path:"/pages/ed9e8d/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-dd6a2a08").then(t)}},{path:"/pages/ed9e8d/index.html",redirect:"/pages/ed9e8d/"},{path:"/01.ä¸é¢/03.elk/03.filebeat-logç¸å³éç½®æå.html",redirect:"/pages/ed9e8d/"},{name:"v-b8800ef2",path:"/pages/ce2b89/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-b8800ef2").then(t)}},{path:"/pages/ce2b89/index.html",redirect:"/pages/ce2b89/"},{path:"/01.ä¸é¢/04.jenkins/01.jenkinså®¹å¨å®è£.html",redirect:"/pages/ce2b89/"},{name:"v-9066c126",path:"/pages/a9ff44/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-9066c126").then(t)}},{path:"/pages/a9ff44/index.html",redirect:"/pages/a9ff44/"},{path:"/01.ä¸é¢/04.jenkins/02.jenkinsæµæ°´çº¿é¨ç½².html",redirect:"/pages/a9ff44/"},{name:"v-5aabcc3a",path:"/pages/0cd089/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-5aabcc3a").then(t)}},{path:"/pages/0cd089/index.html",redirect:"/pages/0cd089/"},{path:"/02.çæ´»/01.éç¬/02.å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯.html",redirect:"/pages/0cd089/"},{name:"v-099c9ca4",path:"/pages/aa6ada/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-099c9ca4").then(t)}},{path:"/pages/aa6ada/index.html",redirect:"/pages/aa6ada/"},{path:"/02.çæ´»/01.éç¬/01.ç·äººå¿æºæççä¹å¤§è¡¨ç°.html",redirect:"/pages/aa6ada/"},{name:"v-5436895e",path:"/pages/7b0831/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-5436895e").then(t)}},{path:"/pages/7b0831/index.html",redirect:"/pages/7b0831/"},{path:"/02.çæ´»/01.éç¬/03.è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç.html",redirect:"/pages/7b0831/"},{name:"v-5cac2a3b",path:"/pages/e7e74b/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-5cac2a3b").then(t)}},{path:"/pages/e7e74b/index.html",redirect:"/pages/e7e74b/"},{path:"/02.çæ´»/01.éç¬/04.å°è¯´æ´»çæå½.html",redirect:"/pages/e7e74b/"},{name:"v-228a9bce",path:"/pages/58b3c0/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-228a9bce").then(t)}},{path:"/pages/58b3c0/index.html",redirect:"/pages/58b3c0/"},{path:"/02.çæ´»/01.éç¬/05.äººçæ ¼è¨.html",redirect:"/pages/58b3c0/"},{name:"v-4c3a43d2",path:"/pages/f6c9c9/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-4c3a43d2").then(t)}},{path:"/pages/f6c9c9/index.html",redirect:"/pages/f6c9c9/"},{path:"/02.çæ´»/02.é¢è¯/01.è¿ç»´10éåºç¡é¢è¯é¢.html",redirect:"/pages/f6c9c9/"},{name:"v-765df57e",path:"/pages/a2e381/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-765df57e").then(t)}},{path:"/pages/a2e381/index.html",redirect:"/pages/a2e381/"},{path:"/02.çæ´»/02.é¢è¯/02.httpç¶æç .html",redirect:"/pages/a2e381/"},{name:"v-e52dd084",path:"/pages/9245d9/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-e52dd084").then(t)}},{path:"/pages/9245d9/index.html",redirect:"/pages/9245d9/"},{path:"/02.çæ´»/02.é¢è¯/03.é«çº§è¿ç»´å·¥ç¨éè¦ææ¡çæè½.html",redirect:"/pages/9245d9/"},{name:"v-e2ff91da",path:"/pages/45fa3c/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-e2ff91da").then(t)}},{path:"/pages/45fa3c/index.html",redirect:"/pages/45fa3c/"},{path:"/02.çæ´»/03.å·¥å·/01.vpn/01.ä¼ä¸çº§openvpnæ­å»º.html",redirect:"/pages/45fa3c/"},{name:"v-df98990e",path:"/pages/e9bb88/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-df98990e").then(t)}},{path:"/pages/e9bb88/index.html",redirect:"/pages/e9bb88/"},{path:"/02.çæ´»/03.å·¥å·/02.ç¿»å¢æç¨/01.å®ç°V2Rayéè¿CloudFlareèªéIPå é.html",redirect:"/pages/e9bb88/"},{name:"v-303fed36",path:"/pages/4ad301/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-303fed36").then(t)}},{path:"/pages/4ad301/index.html",redirect:"/pages/4ad301/"},{path:"/02.çæ´»/03.å·¥å·/03.macçµèå¸¸ç¨è½¯ä»¶.html",redirect:"/pages/4ad301/"},{name:"v-e138df4c",path:"/pages/8994e9/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-e138df4c").then(t)}},{path:"/pages/8994e9/index.html",redirect:"/pages/8994e9/"},{path:"/02.çæ´»/03.å·¥å·/04.ä¸ªäººå·¥å·é¾æ¥.html",redirect:"/pages/8994e9/"},{name:"v-19ff8e6a",path:"/pages/468f43/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-19ff8e6a").then(t)}},{path:"/pages/468f43/index.html",redirect:"/pages/468f43/"},{path:"/02.çæ´»/03.å·¥å·/05.vuepresséç½®artalk.html",redirect:"/pages/468f43/"},{name:"v-24ef5f44",path:"/pages/112008/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-24ef5f44").then(t)}},{path:"/pages/112008/index.html",redirect:"/pages/112008/"},{path:"/02.çæ´»/03.å·¥å·/06.windowsç®å½å®æ¶åæ­¥å·¥å·.html",redirect:"/pages/112008/"},{name:"v-403a5ccb",path:"/pages/f8da74/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-403a5ccb").then(t)}},{path:"/pages/f8da74/index.html",redirect:"/pages/f8da74/"},{path:"/03.ç¼ç¨/01.python/01.çæ§ç®å½ææä»¶åå.html",redirect:"/pages/f8da74/"},{name:"v-0542148a",path:"/pages/f659cd/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-0542148a").then(t)}},{path:"/pages/f659cd/index.html",redirect:"/pages/f659cd/"},{path:"/03.ç¼ç¨/01.python/02.æ¹éæ´æ¹æä»¶.html",redirect:"/pages/f659cd/"},{name:"v-7246ae2c",path:"/pages/a109ec/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-7246ae2c").then(t)}},{path:"/pages/a109ec/index.html",redirect:"/pages/a109ec/"},{path:"/03.ç¼ç¨/01.python/03.pythonå¼ç¨æ°æ®åº.html",redirect:"/pages/a109ec/"},{name:"v-0580956a",path:"/pages/457fb7/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-0580956a").then(t)}},{path:"/pages/457fb7/index.html",redirect:"/pages/457fb7/"},{path:"/03.ç¼ç¨/01.python/04.python3ç»é²ç«å¢æ·»å æ¾è¡.html",redirect:"/pages/457fb7/"},{name:"v-71ab6464",path:"/pages/d0fcb5/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-71ab6464").then(t)}},{path:"/pages/d0fcb5/index.html",redirect:"/pages/d0fcb5/"},{path:"/03.ç¼ç¨/01.python/05.pythonçæé¨ç½²èæ¬.html",redirect:"/pages/d0fcb5/"},{name:"v-2e07d1a0",path:"/pages/8d0b76/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-2e07d1a0").then(t)}},{path:"/pages/8d0b76/index.html",redirect:"/pages/8d0b76/"},{path:"/03.ç¼ç¨/01.python/06.pythonå°å¤ä¸ªæä»¶åå®¹è¾åºå°ä¸ä¸ªæä»¶ä¸­.html",redirect:"/pages/8d0b76/"},{name:"v-6c2001b3",path:"/pages/cae02d/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-6c2001b3").then(t)}},{path:"/pages/cae02d/index.html",redirect:"/pages/cae02d/"},{path:"/03.ç¼ç¨/02.shell/01.è¿ç¨pidå¤æ­èæ¬.html",redirect:"/pages/cae02d/"},{name:"v-6ba31c1d",path:"/pages/3b937e/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-6ba31c1d").then(t)}},{path:"/pages/3b937e/index.html",redirect:"/pages/3b937e/"},{path:"/03.ç¼ç¨/02.shell/02.æ¥å¿åå²èæ¬.html",redirect:"/pages/3b937e/"},{name:"v-a840ca1e",path:"/pages/69b699/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-a840ca1e").then(t)}},{path:"/pages/69b699/index.html",redirect:"/pages/69b699/"},{path:"/03.ç¼ç¨/02.shell/03.è®¾ç½®è·³æ¿æºèæ¬.html",redirect:"/pages/69b699/"},{name:"v-8d36e636",path:"/pages/fe0782/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-8d36e636").then(t)}},{path:"/pages/fe0782/index.html",redirect:"/pages/fe0782/"},{path:"/03.ç¼ç¨/02.shell/04.ç¼åå¯å¨ãåæ­¢ãéå¯çèæ¬.html",redirect:"/pages/fe0782/"},{name:"v-08986d40",path:"/pages/93dcc7/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-08986d40").then(t)}},{path:"/pages/93dcc7/index.html",redirect:"/pages/93dcc7/"},{path:"/03.ç¼ç¨/02.shell/05.mysqlæ°æ®åºå¤ä»½çä¸ç§æ¹å¼.html",redirect:"/pages/93dcc7/"},{name:"v-38a8ed18",path:"/pages/2019f8/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-38a8ed18").then(t)}},{path:"/pages/2019f8/index.html",redirect:"/pages/2019f8/"},{path:"/03.ç¼ç¨/02.shell/06.jenkinsç¼è¯æå¡èæ¬.html",redirect:"/pages/2019f8/"},{name:"v-45252678",path:"/pages/fd3678/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-45252678").then(t)}},{path:"/pages/fd3678/index.html",redirect:"/pages/fd3678/"},{path:"/03.ç¼ç¨/02.shell/07.appç¼è¯èæ¬.html",redirect:"/pages/fd3678/"},{name:"v-c86447e2",path:"/pages/8fdac1/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-c86447e2").then(t)}},{path:"/pages/8fdac1/index.html",redirect:"/pages/8fdac1/"},{path:"/03.ç¼ç¨/02.shell/08.å¸¸ç¨shellèæ¬.html",redirect:"/pages/8fdac1/"},{name:"v-1ae891a8",path:"/pages/f5c376/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-1ae891a8").then(t)}},{path:"/pages/f5c376/index.html",redirect:"/pages/f5c376/"},{path:"/03.ç¼ç¨/02.shell/09.å­ç¬¦ä¸²çæªåæ¼æ¥.html",redirect:"/pages/f5c376/"},{name:"v-0aaf2f47",path:"/pages/665355/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-0aaf2f47").then(t)}},{path:"/pages/665355/index.html",redirect:"/pages/665355/"},{path:"/03.ç¼ç¨/02.shell/10.shellåºç¡.html",redirect:"/pages/665355/"},{name:"v-11090b27",path:"/pages/98cac7/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-11090b27").then(t)}},{path:"/pages/98cac7/index.html",redirect:"/pages/98cac7/"},{path:"/04.è¿ç»´/01.linux/01.rsync/01.rsyncç¨æ³ååæ°è¯¦è§£.html",redirect:"/pages/98cac7/"},{name:"v-2f584880",path:"/pages/c7f1bc/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-2f584880").then(t)}},{path:"/pages/c7f1bc/index.html",redirect:"/pages/c7f1bc/"},{path:"/04.è¿ç»´/01.linux/01.rsync/02.rsyncæå¡å®ç°æ¨éï¼æå.html",redirect:"/pages/c7f1bc/"},{name:"v-52cf205e",path:"/pages/78c801/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-52cf205e").then(t)}},{path:"/pages/78c801/index.html",redirect:"/pages/78c801/"},{path:"/04.è¿ç»´/01.linux/02.dns/01.centos7æ­å»ºdns,bindéç½®.html",redirect:"/pages/78c801/"},{name:"v-44ab5907",path:"/pages/4baba0/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-44ab5907").then(t)}},{path:"/pages/4baba0/index.html",redirect:"/pages/4baba0/"},{path:"/04.è¿ç»´/01.linux/03.sedãawkãgrepãfindååå®¢/01.sedå½ä»¤å¨ææ¬æ¯è¡,è¡å°¾æè¡é¦æ·»å å­ç¬¦.html",redirect:"/pages/4baba0/"},{name:"v-e8e0b9ea",path:"/pages/5f261c/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-e8e0b9ea").then(t)}},{path:"/pages/5f261c/index.html",redirect:"/pages/5f261c/"},{path:"/04.è¿ç»´/01.linux/04.LVMç®¡ç.html",redirect:"/pages/5f261c/"},{name:"v-ba2529e4",path:"/pages/0bac05/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-ba2529e4").then(t)}},{path:"/pages/0bac05/index.html",redirect:"/pages/0bac05/"},{path:"/04.è¿ç»´/01.linux/05.sudoæéè§å.html",redirect:"/pages/0bac05/"},{name:"v-2c290406",path:"/pages/c17655/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-2c290406").then(t)}},{path:"/pages/c17655/index.html",redirect:"/pages/c17655/"},{path:"/04.è¿ç»´/01.linux/06.linuxä¿®æ¹ç½å¡ä¸ºeth0çä¸¤ç§æ¹æ³.html",redirect:"/pages/c17655/"},{name:"v-78111152",path:"/pages/a8c469/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-78111152").then(t)}},{path:"/pages/a8c469/index.html",redirect:"/pages/a8c469/"},{path:"/04.è¿ç»´/01.linux/07.Logrotateå¥é¨äºè§£åçäº§å®è·µ.html",redirect:"/pages/a8c469/"},{name:"v-c1c1c24e",path:"/pages/18b06c/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-c1c1c24e").then(t)}},{path:"/pages/18b06c/index.html",redirect:"/pages/18b06c/"},{path:"/04.è¿ç»´/02.windows/01.windowsæ¯æå¤ç¨æ·è¿ç¨ç»å½.html",redirect:"/pages/18b06c/"},{name:"v-0cc13236",path:"/pages/adbe78/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-0cc13236").then(t)}},{path:"/pages/adbe78/index.html",redirect:"/pages/adbe78/"},{path:"/04.è¿ç»´/02.windows/02.windowsåºç¨æå¡é¨ç½²èæ¬.html",redirect:"/pages/adbe78/"},{name:"v-0df2a669",path:"/pages/5ed327/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-0df2a669").then(t)}},{path:"/pages/5ed327/index.html",redirect:"/pages/5ed327/"},{path:"/04.è¿ç»´/03.ä¸­é´ä»¶/01.nginx/01.nginxéç½®æç¨.html",redirect:"/pages/5ed327/"},{name:"v-74be9f5b",path:"/pages/df9ea8/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-74be9f5b").then(t)}},{path:"/pages/df9ea8/index.html",redirect:"/pages/df9ea8/"},{path:"/04.è¿ç»´/03.ä¸­é´ä»¶/01.nginx/02.nginxå¸¸ç¨éç½®.html",redirect:"/pages/df9ea8/"},{name:"v-38030407",path:"/pages/98b071/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-38030407").then(t)}},{path:"/pages/98b071/index.html",redirect:"/pages/98b071/"},{path:"/04.è¿ç»´/03.ä¸­é´ä»¶/02.kafka/01.kafkaä»ç»åå¸¸è§æä½.html",redirect:"/pages/98b071/"},{name:"v-0576e07d",path:"/pages/43f361/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-0576e07d").then(t)}},{path:"/pages/43f361/index.html",redirect:"/pages/43f361/"},{path:"/04.è¿ç»´/03.ä¸­é´ä»¶/02.kafka/02.docker-composeå®è£kafkaéç¾¤.html",redirect:"/pages/43f361/"},{name:"v-8488e3a8",path:"/pages/b73d79/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-8488e3a8").then(t)}},{path:"/pages/b73d79/index.html",redirect:"/pages/b73d79/"},{path:"/04.è¿ç»´/03.ä¸­é´ä»¶/02.kafka/03.kafkaå·¥ä½åç.html",redirect:"/pages/b73d79/"},{name:"v-515e9f9a",path:"/pages/fd6cf8/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-515e9f9a").then(t)}},{path:"/pages/fd6cf8/index.html",redirect:"/pages/fd6cf8/"},{path:"/04.è¿ç»´/03.ä¸­é´ä»¶/03.apolloé¨ç½².html",redirect:"/pages/fd6cf8/"},{name:"v-66a7ae24",path:"/pages/38ce88/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-66a7ae24").then(t)}},{path:"/pages/38ce88/index.html",redirect:"/pages/38ce88/"},{path:"/04.è¿ç»´/04.ç½ç»/03.ç½ç»å·¥å·.html",redirect:"/pages/38ce88/"},{name:"v-084ed8e0",path:"/pages/5933ee/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-084ed8e0").then(t)}},{path:"/pages/5933ee/index.html",redirect:"/pages/5933ee/"},{path:"/04.è¿ç»´/04.ç½ç»/02.ç½ç»ä»£ç.html",redirect:"/pages/5933ee/"},{name:"v-9198a8e6",path:"/pages/7f4bdd/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-9198a8e6").then(t)}},{path:"/pages/7f4bdd/index.html",redirect:"/pages/7f4bdd/"},{path:"/04.è¿ç»´/05.å®å¨/01.dockeré¨ç½²openvas.html",redirect:"/pages/7f4bdd/"},{name:"v-28967f21",path:"/pages/2f613d/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-28967f21").then(t)}},{path:"/pages/2f613d/index.html",redirect:"/pages/2f613d/"},{path:"/04.è¿ç»´/04.ç½ç»/01.æåå·¥å· tcpdump ç¨æ³è¯´æ.html",redirect:"/pages/2f613d/"},{name:"v-44bb153f",path:"/pages/3913e5/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-44bb153f").then(t)}},{path:"/pages/3913e5/index.html",redirect:"/pages/3913e5/"},{path:"/04.è¿ç»´/05.å®å¨/03.sshå®å¨.html",redirect:"/pages/3913e5/"},{name:"v-0cf4e9e4",path:"/pages/fcba46/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-0cf4e9e4").then(t)}},{path:"/pages/fcba46/index.html",redirect:"/pages/fcba46/"},{path:"/04.è¿ç»´/05.å®å¨/02.ç½å¸½å­è®²webå®å¨.html",redirect:"/pages/fcba46/"},{name:"v-c30db28e",path:"/pages/8dcd54/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-c30db28e").then(t)}},{path:"/pages/8dcd54/index.html",redirect:"/pages/8dcd54/"},{path:"/04.è¿ç»´/05.å®å¨/04.ç³»ç»å®å¨ååºç¨åºç¡.html",redirect:"/pages/8dcd54/"},{name:"v-477589d8",path:"/pages/988870/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-477589d8").then(t)}},{path:"/pages/988870/index.html",redirect:"/pages/988870/"},{path:"/04.è¿ç»´/06.å­å¨/01.fastdfs.html",redirect:"/pages/988870/"},{name:"v-0bebf3bd",path:"/pages/88a4de/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-0bebf3bd").then(t)}},{path:"/pages/88a4de/index.html",redirect:"/pages/88a4de/"},{path:"/04.è¿ç»´/06.å­å¨/03.ceph/01.é¨ç½²cephéç¾¤ Nautilusç.html",redirect:"/pages/88a4de/"},{name:"v-ed9b282c",path:"/pages/70e7ad/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-ed9b282c").then(t)}},{path:"/pages/70e7ad/index.html",redirect:"/pages/70e7ad/"},{path:"/04.è¿ç»´/06.å­å¨/02.glusterfs.html",redirect:"/pages/70e7ad/"},{name:"v-0a29d12e",path:"/pages/ce46b6/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-0a29d12e").then(t)}},{path:"/pages/ce46b6/index.html",redirect:"/pages/ce46b6/"},{path:"/04.è¿ç»´/07.é²ç«å¢/01.centos7ä¸éç½®firewalldå®ç°natè½¬åè½¯è·¯ç±.html",redirect:"/pages/ce46b6/"},{name:"v-09ffdab8",path:"/pages/1f5460/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-09ffdab8").then(t)}},{path:"/pages/1f5460/index.html",redirect:"/pages/1f5460/"},{path:"/04.è¿ç»´/08.æ°æ®åº/01.mysql/01.æ°æ®åºäºè¿å¶å®è£.html",redirect:"/pages/1f5460/"},{name:"v-b2ae320e",path:"/pages/e977f3/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-b2ae320e").then(t)}},{path:"/pages/e977f3/index.html",redirect:"/pages/e977f3/"},{path:"/04.è¿ç»´/08.æ°æ®åº/03.oracle/01.oracleæ°æ®åºå®è£.html",redirect:"/pages/e977f3/"},{name:"v-1ebf1e36",path:"/pages/598be1/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-1ebf1e36").then(t)}},{path:"/pages/598be1/index.html",redirect:"/pages/598be1/"},{path:"/04.è¿ç»´/08.æ°æ®åº/02.mongodb/01.mongodbç¸å³æ¦å¿µ.html",redirect:"/pages/598be1/"},{name:"v-447429d0",path:"/pages/26f193/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-447429d0").then(t)}},{path:"/pages/26f193/index.html",redirect:"/pages/26f193/"},{path:"/04.è¿ç»´/09.ç³»ç»/01.vmware/01.æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤.html",redirect:"/pages/26f193/"},{name:"v-64021198",path:"/pages/affcf2/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-64021198").then(t)}},{path:"/pages/affcf2/index.html",redirect:"/pages/affcf2/"},{path:"/04.è¿ç»´/09.ç³»ç»/02.ftp/01.proftpdç¯å¢é¨ç½².html",redirect:"/pages/affcf2/"},{name:"v-c4242b76",path:"/pages/af4fce/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-c4242b76").then(t)}},{path:"/pages/af4fce/index.html",redirect:"/pages/af4fce/"},{path:"/04.è¿ç»´/09.ç³»ç»/03.nexus/01.nexuså®è£.html",redirect:"/pages/af4fce/"},{name:"v-6feefc5e",path:"/pages/b851fe/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-6feefc5e").then(t)}},{path:"/pages/b851fe/index.html",redirect:"/pages/b851fe/"},{path:"/04.è¿ç»´/09.ç³»ç»/03.nexus/02.ä½¿ç¨nexus3éç½®npmç§æä»åº.html",redirect:"/pages/b851fe/"},{name:"v-28dc669e",path:"/pages/12e16a/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-28dc669e").then(t)}},{path:"/pages/12e16a/index.html",redirect:"/pages/12e16a/"},{path:"/04.è¿ç»´/09.ç³»ç»/03.nexus/03.ä½¿ç¨nexus3éç½®mavenç§æä»åº.html",redirect:"/pages/12e16a/"},{name:"v-65a31f9a",path:"/pages/217e32/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-65a31f9a").then(t)}},{path:"/pages/217e32/index.html",redirect:"/pages/217e32/"},{path:"/04.è¿ç»´/10.docker/02.dockerådocker-composeå®è£.html",redirect:"/pages/217e32/"},{name:"v-db6593ce",path:"/pages/359db9/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-db6593ce").then(t)}},{path:"/pages/359db9/index.html",redirect:"/pages/359db9/"},{path:"/04.è¿ç»´/08.æ°æ®åº/02.mongodb/02.mongodbå¯æ¬é.html",redirect:"/pages/359db9/"},{name:"v-3ed70d81",path:"/pages/83a393/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-3ed70d81").then(t)}},{path:"/pages/83a393/index.html",redirect:"/pages/83a393/"},{path:"/04.è¿ç»´/10.docker/01.Dockeræå»ºéå.html",redirect:"/pages/83a393/"},{name:"v-573ab138",path:"/pages/8884ac/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-573ab138").then(t)}},{path:"/pages/8884ac/index.html",redirect:"/pages/8884ac/"},{path:"/04.è¿ç»´/10.docker/03.å¦ä½éæ©dockeråºç¡éå.html",redirect:"/pages/8884ac/"},{name:"v-20b39df5",path:"/pages/382a6c/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-20b39df5").then(t)}},{path:"/pages/382a6c/index.html",redirect:"/pages/382a6c/"},{path:"/04.è¿ç»´/10.docker/04.å¸¸è§çdockerfileæ±æ».html",redirect:"/pages/382a6c/"},{name:"v-0f41bfdd",path:"/pages/6e3cb9/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-0f41bfdd").then(t)}},{path:"/pages/6e3cb9/index.html",redirect:"/pages/6e3cb9/"},{path:"/04.è¿ç»´/10.docker/05.åºäºå®æ¹php7-2-34éåæå»ºçäº§å¯ç¨éå.html",redirect:"/pages/6e3cb9/"},{name:"v-28471c42",path:"/pages/767641/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-28471c42").then(t)}},{path:"/pages/767641/index.html",redirect:"/pages/767641/"},{path:"/04.è¿ç»´/11.other/01.debianä¸­ç§å¤§æ¿æ¢æç¨.html",redirect:"/pages/767641/"},{name:"v-2e1ddaa3",path:"/pages/aa9eee/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-2e1ddaa3").then(t)}},{path:"/pages/aa9eee/index.html",redirect:"/pages/aa9eee/"},{path:"/04.è¿ç»´/11.other/02.Alpineå®è£phpåç§æ©å±.html",redirect:"/pages/aa9eee/"},{name:"v-10b832a2",path:"/pages/e0085e/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-10b832a2").then(t)}},{path:"/pages/e0085e/index.html",redirect:"/pages/e0085e/"},{path:"/04.è¿ç»´/12.çæ§/01.zabbix/03.dockeræä»¶å®è£zabbix5.html",redirect:"/pages/e0085e/"},{name:"v-282498df",path:"/pages/a4e3ce/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-282498df").then(t)}},{path:"/pages/a4e3ce/index.html",redirect:"/pages/a4e3ce/"},{path:"/04.è¿ç»´/12.çæ§/01.zabbix/04.zabbixéç½®ééåè­¦.html",redirect:"/pages/a4e3ce/"},{name:"v-7b122aa1",path:"/pages/a0a3ae/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-7b122aa1").then(t)}},{path:"/pages/a0a3ae/index.html",redirect:"/pages/a0a3ae/"},{path:"/04.è¿ç»´/12.çæ§/01.zabbix/02.zabbixæ·»å ç«¯å£åè¿ç¨çæ§.html",redirect:"/pages/a0a3ae/"},{name:"v-787b413e",path:"/pages/3dac52/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-787b413e").then(t)}},{path:"/pages/3dac52/index.html",redirect:"/pages/3dac52/"},{path:"/04.è¿ç»´/12.çæ§/01.zabbix/01.zabbixæ·»å è¯ä¹¦çæ§.html",redirect:"/pages/3dac52/"},{name:"v-68775ace",path:"/pages/334bec/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-68775ace").then(t)}},{path:"/pages/334bec/index.html",redirect:"/pages/334bec/"},{path:"/04.è¿ç»´/12.çæ§/01.zabbix/05.zabbixæ·»å æ¥å¿çæ§.html",redirect:"/pages/334bec/"},{name:"v-3bd0d01e",path:"/pages/269839/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-3bd0d01e").then(t)}},{path:"/pages/269839/index.html",redirect:"/pages/269839/"},{path:"/04.è¿ç»´/12.çæ§/01.zabbix/07.zabbixçæ§windowsè¿ç¨.html",redirect:"/pages/269839/"},{name:"v-1955a3de",path:"/pages/20f905/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-1955a3de").then(t)}},{path:"/pages/20f905/index.html",redirect:"/pages/20f905/"},{path:"/04.è¿ç»´/12.çæ§/01.zabbix/06.zabbixæ·»å è¿ç¨pidçæ§.html",redirect:"/pages/20f905/"},{name:"v-8105e1aa",path:"/pages/b70eb8/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-8105e1aa").then(t)}},{path:"/pages/b70eb8/index.html",redirect:"/pages/b70eb8/"},{path:"/04.è¿ç»´/12.çæ§/01.zabbix/08.zabbixæ·»å webçæ§.html",redirect:"/pages/b70eb8/"},{name:"v-c5ed0f8c",path:"/pages/723e7e/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-c5ed0f8c").then(t)}},{path:"/pages/723e7e/index.html",redirect:"/pages/723e7e/"},{path:"/04.è¿ç»´/12.çæ§/01.zabbix/09.centos7ç¼è¯å®è£zabbix proxyç«¯.html",redirect:"/pages/723e7e/"},{name:"v-20df7df7",path:"/pages/ef347e/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-20df7df7").then(t)}},{path:"/pages/ef347e/index.html",redirect:"/pages/ef347e/"},{path:"/04.è¿ç»´/12.çæ§/01.zabbix/10.rpmå®è£zabbix proxyè¿ç¨ç®è®°.html",redirect:"/pages/ef347e/"},{name:"v-4008dcfe",path:"/pages/40794d/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-4008dcfe").then(t)}},{path:"/pages/40794d/index.html",redirect:"/pages/40794d/"},{path:"/04.è¿ç»´/12.çæ§/02.prometheus/01.prometheusçæ§ãåè­¦ä¸å­å¨.html",redirect:"/pages/40794d/"},{name:"v-6f6532a7",path:"/pages/712f5c/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-6f6532a7").then(t)}},{path:"/pages/712f5c/index.html",redirect:"/pages/712f5c/"},{path:"/04.è¿ç»´/12.çæ§/02.prometheus/02.ä½¿ç¨docker-composeæ­å»ºpromethes+grafanaçæ§ç³»ç».html",redirect:"/pages/712f5c/"},{name:"v-003c987e",path:"/pages/22b836/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-003c987e").then(t)}},{path:"/pages/22b836/index.html",redirect:"/pages/22b836/"},{path:"/04.è¿ç»´/12.çæ§/02.prometheus/03.prometheusæ·»å ééæ¶æ¯åè­¦.html",redirect:"/pages/22b836/"},{name:"v-403d9ae8",path:"/archives/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-403d9ae8").then(t)}},{path:"/archives/index.html",redirect:"/archives/"},{path:"/@pages/archivesPage.html",redirect:"/archives/"},{name:"v-75545c56",path:"/pages/96c6ce/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-75545c56").then(t)}},{path:"/pages/96c6ce/index.html",redirect:"/pages/96c6ce/"},{path:"/04.è¿ç»´/12.çæ§/02.prometheus/04.alertmanagerå®ç°æä¸ªæ¶é´æ®µéé»æäºåè­¦é¡¹.html",redirect:"/pages/96c6ce/"},{name:"v-17a259f2",path:"/about/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-17a259f2").then(t)}},{path:"/about/index.html",redirect:"/about/"},{path:"/05.å³äº/01.å³äº.html",redirect:"/about/"},{name:"v-50528ad2",path:"/friends/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-50528ad2").then(t)}},{path:"/friends/index.html",redirect:"/friends/"},{path:"/06.åé¾/01.åé¾.html",redirect:"/friends/"},{name:"v-65b5a670",path:"/categories/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-65b5a670").then(t)}},{path:"/categories/index.html",redirect:"/categories/"},{path:"/@pages/categoriesPage.html",redirect:"/categories/"},{name:"v-8923d930",path:"/tags/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-8923d930").then(t)}},{path:"/tags/index.html",redirect:"/tags/"},{path:"/@pages/tagsPage.html",redirect:"/tags/"},{name:"v-7e9c1840",path:"/",component:yl,beforeEnter:(n,e,t)=>{pi("Layout","v-7e9c1840").then(t)}},{path:"/index.html",redirect:"/"},{path:"*",component:yl}],vl={title:"ç« å·¥è¿ç»´",description:"å¥½å¥½å­¦ä¹ ï¼å¤©å¤©åä¸",base:"/",headTags:[["link",{rel:"icon",href:"/img/favicon.ico"}],["meta",{name:"keywords",content:"åäº«çæ´»,åäº«ææ¯,zpj,jenkins,ansible,k8s,çæ§"}],["meta",{name:"theme-color",content:"#11a8cd"}],["meta",{name:"referrer",content:"no-referrer-when-downgrade"}],["link",{rel:"stylesheet",href:"https://at.alicdn.com/t/font_3114978_qe0b39no76.css"}],["script",{language:"javascript",type:"text/javascript",src:"/js/pgmanor-self.js"}],["link",{rel:"alternate",type:"application/rss+xml",href:"https://blog.zzppjj.top/rss.xml",title:"ç« å·¥è¿ç»´ RSS Feed"}],["link",{rel:"alternate",type:"application/atom+xml",href:"https://blog.zzppjj.top/feed.atom",title:"ç« å·¥è¿ç»´ Atom Feed"}],["link",{rel:"alternate",type:"application/json",href:"https://blog.zzppjj.top/feed.json",title:"ç« å·¥è¿ç»´ JSON Feed"}]],pages:[{title:"ansible",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"01.ä¸é¢/01.ansibleç³»åæç« ",description:"ansible"}},title:"ansible",date:"2022-12-15T10:37:52.000Z",permalink:"/ansible/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"ansible"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/01.ansible.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ansible"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/01.ansible.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T10:37:52.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ansible"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/01.ansible.html",relativePath:"00.ç®å½é¡µ/01.ansible.md",key:"v-12697179",path:"/ansible/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"k8s",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"01.ä¸é¢/02.k8s",description:"k8s"}},title:"k8s",date:"2022-12-15T14:40:52.000Z",permalink:"/k8s/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"k8s"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/02.k8s.html"},{property:"og:type",content:"article"},{property:"og:title",content:"k8s"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/02.k8s.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:40:52.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"k8s"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/02.k8s.html",relativePath:"00.ç®å½é¡µ/02.k8s.md",key:"v-f6d557ce",path:"/k8s/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"jenkins",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"01.ä¸é¢/06.jenkins",description:"jenkins"}},title:"jenkins",date:"2022-12-15T14:43:23.000Z",permalink:"/jenkins/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"jenkins"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/04.jenkins.html"},{property:"og:type",content:"article"},{property:"og:title",content:"jenkins"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/04.jenkins.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"jenkins"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/04.jenkins.html",relativePath:"00.ç®å½é¡µ/04.jenkins.md",key:"v-460f57d9",path:"/jenkins/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"éç¬",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"02.çæ´»/01.éç¬",description:"éç¬"}},title:"éç¬",date:"2022-12-15T14:43:23.000Z",permalink:"/suibi/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"éç¬"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/05.%E9%9A%8F%E7%AC%94.html"},{property:"og:type",content:"article"},{property:"og:title",content:"éç¬"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/05.%E9%9A%8F%E7%AC%94.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"éç¬"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/05.%E9%9A%8F%E7%AC%94.html",relativePath:"00.ç®å½é¡µ/05.éç¬.md",key:"v-538f7059",path:"/suibi/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"é¢è¯",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"02.çæ´»/02.é¢è¯",description:"é¢è¯"}},title:"é¢è¯",date:"2022-12-15T14:43:23.000Z",permalink:"/mianshi/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"é¢è¯"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/06.%E9%9D%A2%E8%AF%95.html"},{property:"og:type",content:"article"},{property:"og:title",content:"é¢è¯"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/06.%E9%9D%A2%E8%AF%95.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"é¢è¯"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/06.%E9%9D%A2%E8%AF%95.html",relativePath:"00.ç®å½é¡µ/06.é¢è¯.md",key:"v-e8898224",path:"/mianshi/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"å·¥å·",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"02.çæ´»/03.å·¥å·",description:"å·¥å·"}},title:"å·¥å·",date:"2022-12-15T14:43:23.000Z",permalink:"/gongju/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"å·¥å·"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/07.%E5%B7%A5%E5%85%B7.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å·¥å·"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/07.%E5%B7%A5%E5%85%B7.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"å·¥å·"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/07.%E5%B7%A5%E5%85%B7.html",relativePath:"00.ç®å½é¡µ/07.å·¥å·.md",key:"v-5bfdcf08",path:"/gongju/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"elk",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"01.ä¸é¢/03.elk",description:"elk"}},title:"elk",date:"2022-12-15T10:41:32.000Z",permalink:"/elk/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"elk"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/03.elk.html"},{property:"og:type",content:"article"},{property:"og:title",content:"elk"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/03.elk.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T10:41:32.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"elk"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/03.elk.html",relativePath:"00.ç®å½é¡µ/03.elk.md",key:"v-125e2d39",path:"/elk/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"çæ´»",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"02.çæ´»",description:"çæ´»"}},title:"çæ´»",date:"2022-12-15T14:43:23.000Z",permalink:"/life/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"çæ´»"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/08.%E7%94%9F%E6%B4%BB.html"},{property:"og:type",content:"article"},{property:"og:title",content:"çæ´»"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/08.%E7%94%9F%E6%B4%BB.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"çæ´»"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/08.%E7%94%9F%E6%B4%BB.html",relativePath:"00.ç®å½é¡µ/08.çæ´».md",key:"v-390cfdc4",path:"/life/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"ç¼ç¨",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"03.ç¼ç¨",description:"ç¼ç¨"}},title:"ç¼ç¨",date:"2022-12-15T14:43:23.000Z",permalink:"/code/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"ç¼ç¨"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/09.%E7%BC%96%E7%A8%8B.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ç¼ç¨"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/09.%E7%BC%96%E7%A8%8B.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ç¼ç¨"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/09.%E7%BC%96%E7%A8%8B.html",relativePath:"00.ç®å½é¡µ/09.ç¼ç¨.md",key:"v-d4660b6a",path:"/code/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"shell",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"03.ç¼ç¨/02.shell",description:"shell"}},title:"shell",date:"2022-12-15T14:43:23.000Z",permalink:"/shell/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"shell"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/11.shell.html"},{property:"og:type",content:"article"},{property:"og:title",content:"shell"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/11.shell.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"shell"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/11.shell.html",relativePath:"00.ç®å½é¡µ/11.shell.md",key:"v-00ab4999",path:"/shell/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"python",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"03.ç¼ç¨/01.python",description:"python"}},title:"python",date:"2022-12-15T14:43:23.000Z",permalink:"/python/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"python"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/10.python.html"},{property:"og:type",content:"article"},{property:"og:title",content:"python"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/10.python.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"python"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/10.python.html",relativePath:"00.ç®å½é¡µ/10.python.md",key:"v-508a552b",path:"/python/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"ä¸é¢",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"01.ä¸é¢",description:"ä¸é¢"}},title:"ä¸é¢",date:"2022-12-15T14:43:23.000Z",permalink:"/topic/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"ä¸é¢"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/12.%E4%B8%93%E9%A2%98.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ä¸é¢"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/12.%E4%B8%93%E9%A2%98.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ä¸é¢"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/12.%E4%B8%93%E9%A2%98.html",relativePath:"00.ç®å½é¡µ/12.ä¸é¢.md",key:"v-06859f1a",path:"/topic/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"ä¸­é´ä»¶",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/03.ä¸­é´ä»¶",description:"ä¸­é´ä»¶"}},title:"ä¸­é´ä»¶",date:"2022-12-15T14:43:23.000Z",permalink:"/middleware/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"ä¸­é´ä»¶"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/14.%E4%B8%AD%E9%97%B4%E4%BB%B6.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ä¸­é´ä»¶"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/14.%E4%B8%AD%E9%97%B4%E4%BB%B6.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ä¸­é´ä»¶"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/14.%E4%B8%AD%E9%97%B4%E4%BB%B6.html",relativePath:"00.ç®å½é¡µ/14.ä¸­é´ä»¶.md",key:"v-c48b57a8",path:"/middleware/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"linux",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/01.linux",description:"linux"}},title:"linux",date:"2022-12-15T14:43:23.000Z",permalink:"/linux/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"linux"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/15.linux.html"},{property:"og:type",content:"article"},{property:"og:title",content:"linux"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/15.linux.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"linux"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/15.linux.html",relativePath:"00.ç®å½é¡µ/15.linux.md",key:"v-6d0e3699",path:"/linux/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"windows",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/02.windows",description:"windows"}},title:"windows",date:"2022-12-15T14:43:23.000Z",permalink:"/windows/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"windows"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/16.windows.html"},{property:"og:type",content:"article"},{property:"og:title",content:"windows"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/16.windows.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"windows"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/16.windows.html",relativePath:"00.ç®å½é¡µ/16.windows.md",key:"v-ba6e35ce",path:"/windows/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"è¿ç»´",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´",description:"è¿ç»´"}},title:"è¿ç»´",date:"2022-12-15T14:43:23.000Z",permalink:"/ops/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"è¿ç»´"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/13.%E8%BF%90%E7%BB%B4.html"},{property:"og:type",content:"article"},{property:"og:title",content:"è¿ç»´"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/13.%E8%BF%90%E7%BB%B4.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"è¿ç»´"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/13.%E8%BF%90%E7%BB%B4.html",relativePath:"00.ç®å½é¡µ/13.è¿ç»´.md",key:"v-3ae46072",path:"/ops/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"ç½ç»",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/04.ç½ç»",description:"ç½ç»"}},title:"ç½ç»",date:"2022-12-15T14:43:23.000Z",permalink:"/network/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"ç½ç»"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/17.%E7%BD%91%E7%BB%9C.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ç½ç»"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/17.%E7%BD%91%E7%BB%9C.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ç½ç»"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/17.%E7%BD%91%E7%BB%9C.html",relativePath:"00.ç®å½é¡µ/17.ç½ç».md",key:"v-799b0d32",path:"/network/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"å­å¨",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/06.å­å¨",description:"å­å¨"}},title:"å­å¨",date:"2022-12-15T14:43:23.000Z",permalink:"/storage/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"å­å¨"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/19.%E5%AD%98%E5%82%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å­å¨"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/19.%E5%AD%98%E5%82%A8.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"å­å¨"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/19.%E5%AD%98%E5%82%A8.html",relativePath:"00.ç®å½é¡µ/19.å­å¨.md",key:"v-f1cf5a38",path:"/storage/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"é²ç«å¢",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/07.é²ç«å¢",description:"é²ç«å¢"}},title:"é²ç«å¢",date:"2022-12-15T14:43:23.000Z",permalink:"/firewalld/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"é²ç«å¢"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/20.%E9%98%B2%E7%81%AB%E5%A2%99.html"},{property:"og:type",content:"article"},{property:"og:title",content:"é²ç«å¢"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/20.%E9%98%B2%E7%81%AB%E5%A2%99.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"é²ç«å¢"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/20.%E9%98%B2%E7%81%AB%E5%A2%99.html",relativePath:"00.ç®å½é¡µ/20.é²ç«å¢.md",key:"v-3e101fea",path:"/firewalld/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"å®å¨",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/05.å®å¨",description:"å®å¨"}},title:"å®å¨",date:"2022-12-15T14:43:23.000Z",permalink:"/safety/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"å®å¨"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/18.%E5%AE%89%E5%85%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å®å¨"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/18.%E5%AE%89%E5%85%A8.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"å®å¨"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/18.%E5%AE%89%E5%85%A8.html",relativePath:"00.ç®å½é¡µ/18.å®å¨.md",key:"v-7c1d5117",path:"/safety/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"æ°æ®åº",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/08.æ°æ®åº",description:"æ°æ®åº"}},title:"æ°æ®åº",date:"2022-12-15T14:43:23.000Z",permalink:"/db/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"æ°æ®åº"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/21.%E6%95%B0%E6%8D%AE%E5%BA%93.html"},{property:"og:type",content:"article"},{property:"og:title",content:"æ°æ®åº"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/21.%E6%95%B0%E6%8D%AE%E5%BA%93.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"æ°æ®åº"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/21.%E6%95%B0%E6%8D%AE%E5%BA%93.html",relativePath:"00.ç®å½é¡µ/21.æ°æ®åº.md",key:"v-d172e978",path:"/db/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"docker",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/10.docker",description:"docker"}},title:"docker",date:"2022-12-15T14:43:23.000Z",permalink:"/docker/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"docker"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/23.docker.html"},{property:"og:type",content:"article"},{property:"og:title",content:"docker"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/23.docker.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"docker"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/23.docker.html",relativePath:"00.ç®å½é¡µ/23.docker.md",key:"v-21c554e7",path:"/docker/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"è¿ç»´å·¥å·",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"02.çæ´»/03.å·¥å·",description:"å·¥å·"}},title:"è¿ç»´å·¥å·",date:"2022-12-15T14:43:23.000Z",permalink:"/tool/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"è¿ç»´å·¥å·"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/24.%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7.html"},{property:"og:type",content:"article"},{property:"og:title",content:"è¿ç»´å·¥å·"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/24.%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"è¿ç»´å·¥å·"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/24.%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7.html",relativePath:"00.ç®å½é¡µ/24.è¿ç»´å·¥å·.md",key:"v-7a7009dc",path:"/tool/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"ç³»ç»",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/09.ç³»ç»",description:"ç³»ç»"}},title:"ç³»ç»",date:"2022-12-15T14:43:23.000Z",permalink:"/sys/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"ç³»ç»"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/22.%E7%B3%BB%E7%BB%9F.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ç³»ç»"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/22.%E7%B3%BB%E7%BB%9F.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ç³»ç»"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/22.%E7%B3%BB%E7%BB%9F.html",relativePath:"00.ç®å½é¡µ/22.ç³»ç».md",key:"v-7492cf63",path:"/sys/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"çæ§",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/12.çæ§",description:"çæ§"}},title:"çæ§",date:"2022-12-15T14:43:23.000Z",permalink:"/monitor/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"çæ§"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/25.%E7%9B%91%E6%8E%A7.html"},{property:"og:type",content:"article"},{property:"og:title",content:"çæ§"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/25.%E7%9B%91%E6%8E%A7.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"çæ§"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/25.%E7%9B%91%E6%8E%A7.html",relativePath:"00.ç®å½é¡µ/25.çæ§.md",key:"v-9ffde008",path:"/monitor/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"other",frontmatter:{pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/11.other",description:"other"}},title:"other",date:"2022-12-15T14:43:23.000Z",permalink:"/other/",categories:["ç®å½é¡µ"],tags:[null],readingShow:"top",description:"::: center",meta:[{name:"twitter:title",content:"other"},{name:"twitter:description",content:"::: center"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/26.other.html"},{property:"og:type",content:"article"},{property:"og:title",content:"other"},{property:"og:description",content:"::: center"},{property:"og:url",content:"https://blog.zzppjj.top/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/26.other.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:43:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"other"},{itemprop:"description",content:"::: center"}]},regularPath:"/00.%E7%9B%AE%E5%BD%95%E9%A1%B5/26.other.html",relativePath:"00.ç®å½é¡µ/26.other.md",key:"v-16ca57ce",path:"/other/",headers:[{level:2,title:"åæï¼åæï¼ååæ",slug:"åæ-åæ-ååæ",normalizedTitle:"åæï¼åæï¼ååæ",charIndex:2}],headersStr:"åæï¼åæï¼ååæ",content:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",normalizedContent:"# åæï¼åæï¼ååæ\n\nå­¦ä¹ ï¼è®°å½ï¼åäº«",charsets:{cjk:!0}},{title:"ansibleå¥é¨",frontmatter:{title:"ansibleå¥é¨",date:null,permalink:"/pages/12c5da01/",categories:["ç³»åä¸é¢","ansible"],tags:["ansible"],description:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14199445.html",readingShow:"top",meta:[{name:"image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/Dingtalk_20221209141135.jpg"},{name:"twitter:title",content:"ansibleå¥é¨"},{name:"twitter:description",content:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14199445.html"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/Dingtalk_20221209141135.jpg"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/01.ansible%E5%85%A5%E9%97%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ansibleå¥é¨"},{property:"og:description",content:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14199445.html"},{property:"og:image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/Dingtalk_20221209141135.jpg"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/01.ansible%E5%85%A5%E9%97%A8.html"},{property:"og:site_name",content:"zpj"},{property:"article:tag",content:"ansible"},{itemprop:"name",content:"ansibleå¥é¨"},{itemprop:"description",content:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14199445.html"},{itemprop:"image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/Dingtalk_20221209141135.jpg"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/01.ansible%E5%85%A5%E9%97%A8.html",relativePath:"01.ä¸é¢/01.ansibleç³»åæç« /01.ansibleå¥é¨.md",key:"v-9c028ada",path:"/pages/12c5da01/",headers:[{level:3,title:"ä¸ãAnsibleåºç¡æ¦è¿°",slug:"ä¸ãansibleåºç¡æ¦è¿°",normalizedTitle:"ä¸ãansibleåºç¡æ¦è¿°",charIndex:79},{level:4,title:"1.1 ä»ä¹æ¯Ansible",slug:"_1-1-ä»ä¹æ¯ansible",normalizedTitle:"1.1 ä»ä¹æ¯ansible",charIndex:98},{level:4,title:"1.2 Ansible å¯ä»¥å®æåªäºåè½",slug:"_1-2-ansible-å¯ä»¥å®æåªäºåè½",normalizedTitle:"1.2 ansible å¯ä»¥å®æåªäºåè½",charIndex:118},{level:4,title:"1.3 Ansibleç¹ç¹",slug:"_1-3-ansibleç¹ç¹",normalizedTitle:"1.3 ansibleç¹ç¹",charIndex:144},{level:4,title:"1.4 Ansibleçæ¶æä¸­çæ§å¶èç¹ãè¢«æ§å¶èç¹ãinventoryãad-hocãplaybookãè¿æ¥åè®®è¿äºæ¯ä»ä¹ï¼",slug:"_1-4-ansibleçæ¶æä¸­çæ§å¶èç¹ãè¢«æ§å¶èç¹ãinventoryãad-hocãplaybookãè¿æ¥åè®®è¿äºæ¯ä»ä¹",normalizedTitle:"1.4 ansibleçæ¶æä¸­çæ§å¶èç¹ãè¢«æ§å¶èç¹ãinventoryãad-hocãplaybookãè¿æ¥åè®®è¿äºæ¯ä»ä¹ï¼",charIndex:163},{level:3,title:"äºãAnsibleå®è£éç½®",slug:"äºãansibleå®è£éç½®",normalizedTitle:"äºãansibleå®è£éç½®",charIndex:230},{level:4,title:"2.1 ansibleå®è£",slug:"_2-1-ansibleå®è£",normalizedTitle:"2.1 ansibleå®è£",charIndex:249},{level:3,title:"ä¸ãAnsible inventory",slug:"ä¸ãansible-inventory",normalizedTitle:"ä¸ãansible inventory",charIndex:266},{level:4,title:"3.1 åºæ¯ä¸ï¼åºäºå¯ç è¿æ¥",slug:"_3-1-åºæ¯ä¸-åºäºå¯ç è¿æ¥",normalizedTitle:"3.1 åºæ¯ä¸ï¼åºäºå¯ç è¿æ¥",charIndex:291},{level:4,title:"3.2 åºæ¯äºï¼åºäºç§é¥è¿æ¥",slug:"_3-2-åºæ¯äº-åºäºç§é¥è¿æ¥",normalizedTitle:"3.2 åºæ¯äºï¼åºäºç§é¥è¿æ¥",charIndex:311},{level:4,title:"3.3 åºæ¯ä¸ï¼ä¸»æºç»ä½¿ç¨æ¹å¼",slug:"_3-3-åºæ¯ä¸-ä¸»æºç»ä½¿ç¨æ¹å¼",normalizedTitle:"3.3 åºæ¯ä¸ï¼ä¸»æºç»ä½¿ç¨æ¹å¼",charIndex:331},{level:4,title:"3.4 ååºæ¯ä¸ªä¸»æºç»ä¸é¢çä¸»æºæåµ",slug:"_3-4-ååºæ¯ä¸ªä¸»æºç»ä¸é¢çä¸»æºæåµ",normalizedTitle:"3.4 ååºæ¯ä¸ªä¸»æºç»ä¸é¢çä¸»æºæåµ",charIndex:352},{level:3,title:"åãAnsible ad-hoc",slug:"åãansible-ad-hoc",normalizedTitle:"åãansible ad-hoc",charIndex:374},{level:4,title:"4.1 ä»ä¹æ¯ad-hoc",slug:"_4-1-ä»ä¹æ¯ad-hoc",normalizedTitle:"4.1 ä»ä¹æ¯ad-hoc",charIndex:396},{level:4,title:"4.2 ad-hocmæ¨¡å¼çä½¿ç¨åºæ¯",slug:"_4-2-ad-hocmæ¨¡å¼çä½¿ç¨åºæ¯",normalizedTitle:"4.2 ad-hocmæ¨¡å¼çä½¿ç¨åºæ¯",charIndex:415},{level:4,title:"4.3 ad-hocæ¨¡å¼çå½ä»¤ä½¿ç¨",slug:"_4-3-ad-hocæ¨¡å¼çå½ä»¤ä½¿ç¨",normalizedTitle:"4.3 ad-hocæ¨¡å¼çå½ä»¤ä½¿ç¨",charIndex:439},{level:4,title:"4.4 ä½¿ç¨ad-docæå®ä¸æ¬¡è¿ç¨å½ä»¤ï¼æ³¨æè§å¯è¿åç»æçé¢è²",slug:"_4-4-ä½¿ç¨ad-docæå®ä¸æ¬¡è¿ç¨å½ä»¤-æ³¨æè§å¯è¿åç»æçé¢è²",normalizedTitle:"4.4 ä½¿ç¨ad-docæå®ä¸æ¬¡è¿ç¨å½ä»¤ï¼æ³¨æè§å¯è¿åç»æçé¢è²",charIndex:462},{level:4,title:"4.5 ad-hocå¸¸ç¨çæ¨¡å",slug:"_4-5-ad-hocå¸¸ç¨çæ¨¡å",normalizedTitle:"4.5 ad-hocå¸¸ç¨çæ¨¡å",charIndex:500},{level:4,title:"4.6 ä½¿ç¨è¿ç¨ä¸­éè¦åäºè§£anisble-docå¸®å©æå",slug:"_4-6-ä½¿ç¨è¿ç¨ä¸­éè¦åäºè§£anisble-docå¸®å©æå",normalizedTitle:"4.6 ä½¿ç¨è¿ç¨ä¸­éè¦åäºè§£anisble-docå¸®å©æå",charIndex:521},{level:3,title:"äºãansibel æ¨¡å",slug:"äºãansibel-æ¨¡å",normalizedTitle:"äºãansibel æ¨¡å",charIndex:554},{level:4,title:"5.1 yumæ¨¡å",slug:"_5-1-yumæ¨¡å",normalizedTitle:"5.1 yumæ¨¡å",charIndex:572},{level:4,title:"5.2 copyæ¨¡å",slug:"_5-2-copyæ¨¡å",normalizedTitle:"5.2 copyæ¨¡å",charIndex:587},{level:4,title:"5.3 fileæ¨¡å",slug:"_5-3-fileæ¨¡å",normalizedTitle:"5.3 fileæ¨¡å",charIndex:603},{level:4,title:"5.4 get_urlæ¨¡å",slug:"_5-4-get-urlæ¨¡å",normalizedTitle:"5.4 get_urlæ¨¡å",charIndex:619},{level:4,title:"5.5 serviceæ¨¡å",slug:"_5-5-serviceæ¨¡å",normalizedTitle:"5.5 serviceæ¨¡å",charIndex:638},{level:4,title:"5.6 groupæ¨¡å",slug:"_5-6-groupæ¨¡å",normalizedTitle:"5.6 groupæ¨¡å",charIndex:657},{level:4,title:"5.7 useræ¨¡å",slug:"_5-7-useræ¨¡å",normalizedTitle:"5.7 useræ¨¡å",charIndex:674},{level:4,title:"5.8 cronæ¨¡å",slug:"_5-8-cronæ¨¡å",normalizedTitle:"5.8 cronæ¨¡å",charIndex:690},{level:4,title:"5.9 mount",slug:"_5-9-mount",normalizedTitle:"5.9 mount",charIndex:706},{level:4,title:"5.10 firewalld",slug:"_5-10-firewalld",normalizedTitle:"5.10 firewalld",charIndex:721},{level:3,title:"å­ãAnsible playbook",slug:"å­ãansible-playbook",normalizedTitle:"å­ãansible playbook",charIndex:739},{level:4,title:"6.1 ä»ä¹æ¯playbook",slug:"_6-1-ä»ä¹æ¯playbook",normalizedTitle:"6.1 ä»ä¹æ¯playbook",charIndex:763},{level:4,title:"6.3 Ansible playbookä¹¦åæ ¼å¼",slug:"_6-3-ansible-playbookä¹¦åæ ¼å¼",normalizedTitle:"6.3 ansible playbookä¹¦åæ ¼å¼",charIndex:820},{level:3,title:"ä¸ãåé",slug:"ä¸ãåé",normalizedTitle:"ä¸ãåé",charIndex:848},{level:4,title:"7.1 åéæ¦è¿°",slug:"_7-1-åéæ¦è¿°",normalizedTitle:"7.1 åéæ¦è¿°",charIndex:858},{level:4,title:"7.2 åéå®ä¹",slug:"_7-2-åéå®ä¹",normalizedTitle:"7.2 åéå®ä¹",charIndex:872},{level:4,title:"7.3 åéæ³¨å",slug:"_7-3-åéæ³¨å",normalizedTitle:"7.3 åéæ³¨å",charIndex:886},{level:4,title:"7.4 factsåé",slug:"_7-4-factsåé",normalizedTitle:"7.4 factsåé",charIndex:900},{level:3,title:"å«ãAnsible Task ä»»å¡æ§å¶",slug:"å«ãansible-task-ä»»å¡æ§å¶",normalizedTitle:"å«ãansible task ä»»å¡æ§å¶",charIndex:915},{level:4,title:"8.1 piaybookæ¡ä»¶è¯­å¥",slug:"_8-1-piaybookæ¡ä»¶è¯­å¥",normalizedTitle:"8.1 piaybookæ¡ä»¶è¯­å¥",charIndex:940},{level:5,title:"æ¡ä¾ä¸ï¼æ ¹æ®ä¸åæä½ç³»ç»ï¼å®è£ç¸åçè½¯ä»¶å",slug:"æ¡ä¾ä¸-æ ¹æ®ä¸åæä½ç³»ç»-å®è£ç¸åçè½¯ä»¶å",normalizedTitle:"æ¡ä¾ä¸ï¼æ ¹æ®ä¸åæä½ç³»ç»ï¼å®è£ç¸åçè½¯ä»¶å",charIndex:964},{level:5,title:"æ¡ä¾äºï¼ä¸ºææwebä¸»æºåçæ·»å nginxä»åºï¼å¶ä½çé½è·³è¿æ·»å ",slug:"æ¡ä¾äº-ä¸ºææwebä¸»æºåçæ·»å nginxä»åº-å¶ä½çé½è·³è¿æ·»å ",normalizedTitle:"æ¡ä¾äºï¼ä¸ºææwebä¸»æºåçæ·»å nginxä»åºï¼å¶ä½çé½è·³è¿æ·»å ",charIndex:993},{level:5,title:"æ¡ä¾ä¸ï¼æ ¹æ®å½ä»¤æ§è¡çç»æè¿è¡å¤æ­",slug:"æ¡ä¾ä¸-æ ¹æ®å½ä»¤æ§è¡çç»æè¿è¡å¤æ­",normalizedTitle:"æ¡ä¾ä¸ï¼æ ¹æ®å½ä»¤æ§è¡çç»æè¿è¡å¤æ­",charIndex:1033},{level:4,title:"8.2 playbookå¾ªç¯è¯­å¥",slug:"_8-2-playbookå¾ªç¯è¯­å¥",normalizedTitle:"8.2 playbookå¾ªç¯è¯­å¥",charIndex:1056},{level:5,title:"æ¡ä¾ä¸ï¼ ä½¿ç¨å¾ªç¯å¯å¨å¤ä¸ªæå¡",slug:"æ¡ä¾ä¸-ä½¿ç¨å¾ªç¯å¯å¨å¤ä¸ªæå¡",normalizedTitle:"æ¡ä¾ä¸ï¼ ä½¿ç¨å¾ªç¯å¯å¨å¤ä¸ªæå¡",charIndex:1080},{level:5,title:"æ¡ä¾äºï¼ ä½¿ç¨å­å¸æ¹éåå»ºç¨æ·",slug:"æ¡ä¾äº-ä½¿ç¨å­å¸æ¹éåå»ºç¨æ·",normalizedTitle:"æ¡ä¾äºï¼ ä½¿ç¨å­å¸æ¹éåå»ºç¨æ·",charIndex:1103},{level:5,title:"æ¡ä¾ä¸ï¼ ä½¿ç¨åéå­å¸å¾ªç¯çæ¹å¼æ·è´æä»¶",slug:"æ¡ä¾ä¸-ä½¿ç¨åéå­å¸å¾ªç¯çæ¹å¼æ·è´æä»¶",normalizedTitle:"æ¡ä¾ä¸ï¼ ä½¿ç¨åéå­å¸å¾ªç¯çæ¹å¼æ·è´æä»¶",charIndex:1126},{level:4,title:"8.3 playbook handlers",slug:"_8-3-playbook-handlers",normalizedTitle:"8.3 playbook handlers",charIndex:1152},{level:5,title:"æ¡ä¾ï¼playbookå®è£nginx",slug:"æ¡ä¾-playbookå®è£nginx",normalizedTitle:"æ¡ä¾ï¼playbookå®è£nginx",charIndex:1181},{level:4,title:"8.4 playbook tag",slug:"_8-4-playbook-tag",normalizedTitle:"8.4 playbook tag",charIndex:1205},{level:6,title:"æ¡ä¾ï¼",slug:"æ¡ä¾",normalizedTitle:"æ¡ä¾ï¼",charIndex:1181},{level:4,title:"8.5 playbook include",slug:"_8-5-playbook-include",normalizedTitle:"8.5 playbook include",charIndex:1238},{level:6,title:"æ¡ä¾ï¼",slug:"æ¡ä¾-2",normalizedTitle:"æ¡ä¾ï¼",charIndex:1181},{level:4,title:"8.6 ignore_errorså¿½ç¥éè¯¯",slug:"_8-6-ignore-errorså¿½ç¥éè¯¯",normalizedTitle:"8.6 ignore_errorså¿½ç¥éè¯¯",charIndex:1275},{level:4,title:"8.7 playbookéè¯¯å¤ç",slug:"_8-7-playbookéè¯¯å¤ç",normalizedTitle:"8.7 playbookéè¯¯å¤ç",charIndex:1302},{level:5,title:"æ¡ä¾ä¸ï¼taskæ§è¡å¤±è´¥å¼ºå¶è°ç¨handlers",slug:"æ¡ä¾ä¸-taskæ§è¡å¤±è´¥å¼ºå¶è°ç¨handlers",normalizedTitle:"æ¡ä¾ä¸ï¼taskæ§è¡å¤±è´¥å¼ºå¶è°ç¨handlers",charIndex:1326},{level:5,title:"æ¡ä¾äºï¼ å³é­changeçç¶æï¼ç¡®å®ä¸ä¼å¯¹è¢«æ§ç«¯ä¸»æºè¿è¡ä»»ä½çä¿®æ¹ååæ´ï¼",slug:"æ¡ä¾äº-å³é­changeçç¶æ-ç¡®å®ä¸ä¼å¯¹è¢«æ§ç«¯ä¸»æºè¿è¡ä»»ä½çä¿®æ¹ååæ´",normalizedTitle:"æ¡ä¾äºï¼ å³é­changeçç¶æï¼ç¡®å®ä¸ä¼å¯¹è¢«æ§ç«¯ä¸»æºè¿è¡ä»»ä½çä¿®æ¹ååæ´ï¼",charIndex:1358},{level:5,title:"æ¡ä¾ä¸ï¼ ä½¿ç¨changed_whenæ£æ¥tasksrreä»»å¡è¿åç»æ",slug:"æ¡ä¾ä¸-ä½¿ç¨changed-whenæ£æ¥tasksrreä»»å¡è¿åç»æ",normalizedTitle:"æ¡ä¾ä¸ï¼ ä½¿ç¨changed_whenæ£æ¥tasksrreä»»å¡è¿åç»æ",charIndex:1404}],headersStr:"ä¸ãAnsibleåºç¡æ¦è¿° 1.1 ä»ä¹æ¯Ansible 1.2 Ansible å¯ä»¥å®æåªäºåè½ 1.3 Ansibleç¹ç¹ 1.4 Ansibleçæ¶æä¸­çæ§å¶èç¹ãè¢«æ§å¶èç¹ãinventoryãad-hocãplaybookãè¿æ¥åè®®è¿äºæ¯ä»ä¹ï¼ äºãAnsibleå®è£éç½® 2.1 ansibleå®è£ ä¸ãAnsible inventory 3.1 åºæ¯ä¸ï¼åºäºå¯ç è¿æ¥ 3.2 åºæ¯äºï¼åºäºç§é¥è¿æ¥ 3.3 åºæ¯ä¸ï¼ä¸»æºç»ä½¿ç¨æ¹å¼ 3.4 ååºæ¯ä¸ªä¸»æºç»ä¸é¢çä¸»æºæåµ åãAnsible ad-hoc 4.1 ä»ä¹æ¯ad-hoc 4.2 ad-hocmæ¨¡å¼çä½¿ç¨åºæ¯ 4.3 ad-hocæ¨¡å¼çå½ä»¤ä½¿ç¨ 4.4 ä½¿ç¨ad-docæå®ä¸æ¬¡è¿ç¨å½ä»¤ï¼æ³¨æè§å¯è¿åç»æçé¢è² 4.5 ad-hocå¸¸ç¨çæ¨¡å 4.6 ä½¿ç¨è¿ç¨ä¸­éè¦åäºè§£anisble-docå¸®å©æå äºãansibel æ¨¡å 5.1 yumæ¨¡å 5.2 copyæ¨¡å 5.3 fileæ¨¡å 5.4 get_urlæ¨¡å 5.5 serviceæ¨¡å 5.6 groupæ¨¡å 5.7 useræ¨¡å 5.8 cronæ¨¡å 5.9 mount 5.10 firewalld å­ãAnsible playbook 6.1 ä»ä¹æ¯playbook 6.3 Ansible playbookä¹¦åæ ¼å¼ ä¸ãåé 7.1 åéæ¦è¿° 7.2 åéå®ä¹ 7.3 åéæ³¨å 7.4 factsåé å«ãAnsible Task ä»»å¡æ§å¶ 8.1 piaybookæ¡ä»¶è¯­å¥ æ¡ä¾ä¸ï¼æ ¹æ®ä¸åæä½ç³»ç»ï¼å®è£ç¸åçè½¯ä»¶å æ¡ä¾äºï¼ä¸ºææwebä¸»æºåçæ·»å nginxä»åºï¼å¶ä½çé½è·³è¿æ·»å  æ¡ä¾ä¸ï¼æ ¹æ®å½ä»¤æ§è¡çç»æè¿è¡å¤æ­ 8.2 playbookå¾ªç¯è¯­å¥ æ¡ä¾ä¸ï¼ ä½¿ç¨å¾ªç¯å¯å¨å¤ä¸ªæå¡ æ¡ä¾äºï¼ ä½¿ç¨å­å¸æ¹éåå»ºç¨æ· æ¡ä¾ä¸ï¼ ä½¿ç¨åéå­å¸å¾ªç¯çæ¹å¼æ·è´æä»¶ 8.3 playbook handlers æ¡ä¾ï¼playbookå®è£nginx 8.4 playbook tag æ¡ä¾ï¼ 8.5 playbook include æ¡ä¾ï¼ 8.6 ignore_errorså¿½ç¥éè¯¯ 8.7 playbookéè¯¯å¤ç æ¡ä¾ä¸ï¼taskæ§è¡å¤±è´¥å¼ºå¶è°ç¨handlers æ¡ä¾äºï¼ å³é­changeçç¶æï¼ç¡®å®ä¸ä¼å¯¹è¢«æ§ç«¯ä¸»æºè¿è¡ä»»ä½çä¿®æ¹ååæ´ï¼ æ¡ä¾ä¸ï¼ ä½¿ç¨changed_whenæ£æ¥tasksrreä»»å¡è¿åç»æ",content:'åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14199445.html\n\n\n# ansibleå¥é¨\n\nç®å½\n\n * ä¸ãAnsibleåºç¡æ¦è¿°\n   * 1.1 ä»ä¹æ¯Ansible\n   * 1.2 Ansible å¯ä»¥å®æåªäºåè½\n   * 1.3 Ansibleç¹ç¹\n   * 1.4 Ansibleçæ¶æä¸­çæ§å¶èç¹ãè¢«æ§å¶èç¹ãinventoryãad-hocãplaybookãè¿æ¥åè®®è¿äºæ¯ä»ä¹ï¼\n * äºãAnsibleå®è£éç½®\n   * 2.1 ansibleå®è£\n * ä¸ãAnsible inventory\n   * 3.1 åºæ¯ä¸ï¼åºäºå¯ç è¿æ¥\n   * 3.2 åºæ¯äºï¼åºäºç§é¥è¿æ¥\n   * 3.3 åºæ¯ä¸ï¼ä¸»æºç»ä½¿ç¨æ¹å¼\n   * 3.4 ååºæ¯ä¸ªä¸»æºç»ä¸é¢çä¸»æºæåµ\n * åãAnsible ad-hoc\n   * 4.1 ä»ä¹æ¯ad-hoc\n   * 4.2 ad-hocmæ¨¡å¼çä½¿ç¨åºæ¯\n   * 4.3 ad-hocæ¨¡å¼çå½ä»¤ä½¿ç¨\n   * 4.4 ä½¿ç¨ad-docæå®ä¸æ¬¡è¿ç¨å½ä»¤ï¼æ³¨æè§å¯è¿åç»æçé¢è²\n   * 4.5 ad-hocå¸¸ç¨çæ¨¡å\n   * 4.6 ä½¿ç¨è¿ç¨ä¸­éè¦åäºè§£anisble-docå¸®å©æå\n * äºãansibel æ¨¡å\n   * 5.1 yumæ¨¡å\n   * 5.2 copyæ¨¡å\n   * 5.3 fileæ¨¡å\n   * 5.4 get_urlæ¨¡å\n   * 5.5 serviceæ¨¡å\n   * 5.6 groupæ¨¡å\n   * 5.7 useræ¨¡å\n   * 5.8 cronæ¨¡å\n   * 5.9 mount\n   * 5.10 firewalld\n * å­ãAnsible playbook\n   * 6.1 ä»ä¹æ¯playbook\n   * 6.2 Ansible playbookä¸ad-hocçå³ç³»\n   * 6.3 Ansible playbookä¹¦åæ ¼å¼\n * ä¸ãåé\n   * 7.1 åéæ¦è¿°\n   * 7.2 åéå®ä¹\n   * 7.3 åéæ³¨å\n   * 7.4 factsåé\n * å«ãAnsible Task ä»»å¡æ§å¶\n   * 8.1 piaybookæ¡ä»¶è¯­å¥\n     * æ¡ä¾ä¸ï¼æ ¹æ®ä¸åæä½ç³»ç»ï¼å®è£ç¸åçè½¯ä»¶å\n     * æ¡ä¾äºï¼ä¸ºææwebä¸»æºåçæ·»å nginxä»åºï¼å¶ä½çé½è·³è¿æ·»å \n     * æ¡ä¾ä¸ï¼æ ¹æ®å½ä»¤æ§è¡çç»æè¿è¡å¤æ­\n   * 8.2 playbookå¾ªç¯è¯­å¥\n     * æ¡ä¾ä¸ï¼ ä½¿ç¨å¾ªç¯å¯å¨å¤ä¸ªæå¡\n     * æ¡ä¾äºï¼ ä½¿ç¨å­å¸æ¹éåå»ºç¨æ·\n     * æ¡ä¾ä¸ï¼ ä½¿ç¨åéå­å¸å¾ªç¯çæ¹å¼æ·è´æä»¶\n   * 8.3 playbook handlers\n     * æ¡ä¾ï¼playbookå®è£nginx\n   * 8.4 playbook tag\n     * æ¡ä¾ï¼\n   * 8.5 playbook include\n     * æ¡ä¾ï¼\n   * 8.6 ignore_errorså¿½ç¥éè¯¯\n   * 8.7 playbookéè¯¯å¤ç\n     * æ¡ä¾ä¸ï¼taskæ§è¡å¤±è´¥å¼ºå¶è°ç¨handlers\n     * æ¡ä¾äºï¼ å³é­changeçç¶æï¼ç¡®å®ä¸ä¼å¯¹è¢«æ§ç«¯ä¸»æºè¿è¡ä»»ä½çä¿®æ¹ååæ´ï¼\n     * æ¡ä¾ä¸ï¼ ä½¿ç¨changed_whenæ£æ¥tasksrreä»»å¡è¿åç»æ\n\n\n# ä¸ãAnsibleåºç¡æ¦è¿°\n\n# 1.1 ä»ä¹æ¯Ansible\n\nAnsibleæ¯ä¸ä¸ªITèªå¨åçéç½®ç®¡çå·¥å·ï¼èªå¨åä¸»è¦ä½ç°å¨Ansibleéæäºä¸°å¯æ¨¡åãä¸°å¯çåè½ç»ä»¶ï¼å¯ä»¥éè¿ä¸ä¸ªå½ä»¤å®æä¸ç³»åçæä½ãè¿èåå°æä»¬éå¤æ§çå·¥ä½åç»´æ¤ææ¬ï¼ä»¥æé«å·¥ä½æçï¼\n\n# 1.2 Ansible å¯ä»¥å®æåªäºåè½\n\n * æ¹éæ§è¡è¿ç¨å½ä»¤ï¼å¯ä»¥å¯¹Nå¤å°ä¸»æºåæ¶è¿è¡å½ä»¤çæ§è¡ï¼\n * æ¹ééç½®è½¯ä»¶æå¡ï¼å¯ä»¥è¿è¡èªå¨åçæ¹å¼éç½®åç®¡çæå¡ï¼\n * å®ç°è½¯ä»¶å¼ååè½ï¼Jumpserveråºå±ä½¿ç¨ansibleæ¥å®ç°çèªå¨åç®¡çï¼\n * ç¼æé«çº§çITä»»å¡ï¼AnsibleçPlaybookæ¯ä¸é¨ç¼ç¨è¯­è¨ï¼å¯ä»¥ç¨æ¥æç»ä¸å¥ITæ¶æï¼\n\n# 1.3 Ansibleç¹ç¹\n\n * å®¹æå­¦ä¹ ï¼æ ä»£çæ¨¡å¼ï¼ä¸åsaltstackæ¢è¦å­¦ä¹ å®¢æ·ç«¯ä¸æå¡ç«¯ï¼è¿è¦å­¦ä¹ å®¢æ·ç«¯ä¸æå¡ç«¯ä¸­é´éä¿¡åè®®ï¼\n * æä½çµæ´»ï¼ä½ç°å¨Ansibleæè¾å¤çæ¨¡åï¼æä¾äºä¸°å¯çåè½ãplaybookåæä¾ç±»ä¼¼äºç¼ç¨è¯­è¨çå¤æåè½ï¼\n * ç®åå¤ç¨ï¼ä½ç°å¨Ansibleä¸ä¸ªå½ä»¤å¯ä»¥å®æå¾å¤äºæï¼\n * å®å¨å¯é ï¼å ä¸ºAnsibleä½¿ç¨äºSSHåè®®è¿è¡éä¿¡ï¼æ¢ç¨³å®ä¹å®å¨ï¼\n * ç§»æ¤æ§é«ï¼å¯ä»¥å°åå¥½çplaybookæ·è´ä»»ææºå¨è¿è¡æ§è¡ï¼\n\n# 1.4 Ansibleçæ¶æä¸­çæ§å¶èç¹ãè¢«æ§å¶èç¹ãinventoryãad-hocãplaybookãè¿æ¥åè®®è¿äºæ¯ä»ä¹ï¼\n\n\n\n\n# äºãAnsibleå®è£éç½®\n\n# 2.1 ansibleå®è£\n\n$ wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\n$ yum install ansible -y\n$ ansible --version\nansible 2.9.10\n  config file = /etc/ansible/ansible.cfg\n  configured module search path = [u\'/root/.ansible/plugins/modules\', u\'/usr/share/ansible/plugins/modules\']\n  ansible python module location = /usr/lib/python2.7/site-packages/ansible\n  executable location = /usr/bin/ansible\n  python version = 2.7.5 (default, Nov 20 2015, 02:00:19) [GCC 4.8.5 20150623 (Red Hat 4.8.5-4)]\n\n$ ansible <host-pattern> [option]\n--version: # ansibleçæ¬ä¿¡æ¯\n-vï¼æ¾ç¤ºè¯¦ç»ä¿¡æ¯\n-iï¼ä¸»æºæ¸åæä»¶è·¯å¾ï¼é»è®¤æ¯/etc/ansibel/hosts\n-mï¼ä½¿ç¨çæ¨¡åçåç§°ï¼é»è®¤ä½¿ç¨commandæ¨¡å\n-aï¼ä½¿ç¨çæ¨¡ååæ°ï¼æ¨¡åçå·ä½å·¥ä½\n-kï¼æç¤ºè¾å¥sshå¯ç ï¼èä¸ä½¿ç¨åºäºsshçç§é¥è®¤è¯\n-Cï¼æ¨¡ææ§è¡æµè¯ï¼ä½ä¸ä¼ççæ§è¡\n-Tï¼æå®å½ä»¤çè¶æ¶æ¶é´\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nansibleéç½®æä»¶ä¼åçº§é¡ºåºï¼\n\n * æåæ¥æ¾$ANSIBLE_CONFIGåéï¼\n * å¶æ¬¡æ¥æ¾å½åç®å½ä¸ansible.cfg\n * ç¶åæ¥æ¾ç¨æ·å®¶ç®å½ä¸ç.ansible.cfg\n * æåæ¥æ¾/etc/ansible/ansible.cfgï¼é»è®¤ï¼\n\n\n# ä¸ãAnsible inventory\n\nInventoryæä»¶ä¸­å¡«åéè¦è¢«ç®¡çä¸»æºä¸ä¸»æºç»ä¿¡æ¯ï¼é»è¾ä¸å®ä¹ï¼ãé»è®¤Inventoryæä»¶å¨/etc/ansible/hostsãå½ç¶ä¹å¯ä»¥èªå®ä¹ï¼ç¶åä½¿ç¨-iæå®Inventoryæä»¶ä½ç½®ï¼ç¤ºä¾ï¼\n\n# 3.1 åºæ¯ä¸ï¼åºäºå¯ç è¿æ¥\n\n$ cat /etc/ansible/hosts\n\n# æ¹æ³ä¸\n[webservers]\n192.168.100.225 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_pass=\'123456\'\n192.168.100.226 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_pass=\'123456\'\n\n# æ¹æ³äº\n[webservers]\nweb[1:2].lzj.com ansible_ssh_pass=\'123456\'\n\n# æ¹æ³ä¸\n[webservers]\nweb[1:2].lzj.com\n[webserversï¼vars]\nansible_ssh_pass=\'123456\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# 3.2 åºæ¯äºï¼åºäºç§é¥è¿æ¥\n\n$ ssh-keygen\n$ ssh-copy-id 192.168.100.225\n$ ssh-copy-id 192.168.100.226\n$ mkdir project1/ && cd project1/\n$ vim hosts\n[web]\n192.168.100.225\n192.168.100.226\n$ ansible web -m ping -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# 3.3 åºæ¯ä¸ï¼ä¸»æºç»ä½¿ç¨æ¹å¼\n\n[lbservers]\n192.168.100.221\n192.168.100.222\n\n[webservers]\n192.168.100.223\n192.168.100.224\n\n[servers:children]    # å®ä¹serversç»åå«ä¸¤ä¸ªå­ç»ï¼lbserversãwebserversï¼\nlbservers\nwebservers\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n# 3.4 ååºæ¯ä¸ªä¸»æºç»ä¸é¢çä¸»æºæåµ\n\n$ ansible all -i hosts --list-hosts\n  hosts (2):\n    192.168.100.225\n    192.168.100.226\n$ ansible web -i hosts --list-hosts\n  hosts (2):\n    192.168.100.225\n    192.168.100.226\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# åãAnsible ad-hoc\n\n# 4.1 ä»ä¹æ¯ad-hoc\n\nad-hocå°±æ¯ä¸´æ¶å½ä»¤ï¼æ§è¡å®æåå°±ç»æï¼å¹¶ä¸ä¼ä¿å­ï¼\n\n# 4.2 ad-hocmæ¨¡å¼çä½¿ç¨åºæ¯\n\næ¯å¦å¨å¤å°æºå¨ä¸æ¥çæä¸ªè¿ç¨æ¯å¦å¯å¨ï¼ææ·è´æå®æä»¶å°æ¬å°ï¼ç­ç­ï¼\n\n# 4.3 ad-hocæ¨¡å¼çå½ä»¤ä½¿ç¨\n\nå½ä»¤æ ¼å¼   ANSIBLE   ZPJ    -M     COMMAND   -A     \'DF -H\'\næ ¼å¼è¯´æ   å½ä»¤        ä¸»æºåç§°   æå®æ¨¡å   æ¨¡ååç§°      æ¨¡åå¨ä½   å·ä½å½ä»¤\n\n# 4.4 ä½¿ç¨ad-docæå®ä¸æ¬¡è¿ç¨å½ä»¤ï¼æ³¨æè§å¯è¿åç»æçé¢è²\n\n * ç»¿è²ï¼è¡¨ç¤ºè¢«ç®¡çä¸»æºæ²¡æè¢«ä¿®æ¹ï¼\n * é»è²ï¼è¡¨ç¤ºè¢«ç®¡çç«¯ä¸»æºåç°åæ´ï¼\n * çº¢è²ï¼è¡¨ç¤ºåºç°äºæéï¼æ³¨ææ¥çæç¤ºï¼\n\n# 4.5 ad-hocå¸¸ç¨çæ¨¡å\n\ncommand            # æå®shellå½ä»¤ï¼ä¸æ¯æç®¡éç­ç¹æ®å­ç¬¦ï¼\nshell            # æ§è¡shellå½ä»¤\nscripts            # æ§è¡shellèæ¬\nyum_repository    # éç½®yumä»åº\nyum                # å®è£è½¯ä»¶\ncopy            # åæ´éç½®æä»¶\nfile            # å»ºç«ç®å½ææä»¶\nservice            # å¯å¨ãåæ­¢æå¡\nmount            # æè½½è®¾å¤\ncron            # å®æ¶ä»»å¡\nfirewalld        # é²ç«å¢\nget_url            # ä¸è½½è½¯ä»¶\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n# 4.6 ä½¿ç¨è¿ç¨ä¸­éè¦åäºè§£anisble-docå¸®å©æå\n\n$ ansible-doc -l        # æ¥çæææ¨¡åè¯´æ\n$ ansible-doc copy        # è¡¨ç¤ºæå®æ¨¡åæ¹æ³\n$ ansible-doc -s copy    # è¡¨ç¤ºæå®æ¨¡ååæ°\n\n\n1\n2\n3\n\n\n\n# äºãansibel æ¨¡å\n\n# 5.1 yumæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ å®è£å½åææ°çApacheè½¯ä»¶ï¼å¦æå­å¨åæ´æ°\n$ ansible web -m yum -a "name=httpd state=latest" -i hosts\n\n# ç¤ºä¾äºï¼ å®è£å½åææ°çApacheè½¯ä»¶ï¼éè¿epelå®è£\n$ ansible web -m yum -a "name=httpd state=present enablerepo=epel" -i hosts\n\n# ç¤ºä¾ä¸ï¼ éè¿å¬ç½URLå®è£rpmè½¯ä»¶\n$ ansible web -m yum -a "name=https://mirrors4.tuna.tsinghua.edu.cn/zabbix/zabbix/4.0/rhel/7/x86_64/zabbix-agent-4.0.0-2.el7.x86_64.rpm state=present" -i hosts\n\n# ç¤ºä¾åï¼æ´æ°ææçè½¯ä»¶åï¼ä½æé¤åkernelç¸å³ç\n$ ansible web -m yum -a "name="*" state=present exclude="kernel*" -i hosts\n\n# ç¤ºä¾äºï¼ å é¤Apacheè½¯ä»¶\n$  ansible web -m yum -a "name=httpd state=absent" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# 5.2 copyæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ å°æ¬å°çhttpd.confæä»¶Listen ç«¯å£ä¿®æ¹ä¸º9999ï¼ç¶åæ¨éå°è¿ç¨ä¸»æº\n$ sed -i \'s/Listen 80/Listen 9999/g\' httpd.conf\n$ ansible web -m copy -a "src=httpd.conf dest=/etc/httpd/conf/httpd.conf owner=root group=root mode-644" -i hosts\n\n# ç¤ºä¾äºï¼ å°æ¬å°çhttpd.confæä»¶Listenç«¯å£ä¿®æ¹ä¸º9988ï¼ç¶åæ¨éå°è¿ç«¯ï¼æ£æ¥è¿ç«¯æ¯å¦å­å¨ä¸æ¬¡å¤ä»½çæä»¶\n$ sed -i \'s/Listen 9999/Listen 9988/g\' httpd.conf\n$ ansible web -m copy -a "src=httpd.conf dest=/etc/httpd/conf/httpd.conf owner=root group=root mode=644 backup=yes" -i hosts\n\n# ç¤ºä¾ä¸ï¼ å¾è¿ç¨çä¸»æºæä»¶åå¥åå®¹\n$ ansible web -m copy -a "content=123456........ dest=/var/www/html/index.html" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# 5.3 fileæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ åå»ºæä»¶ï¼å¹¶è®¾ç½®å±ä¸»ãå±ç»ãæé\n$ ansible web -m file -a "path=/var/www/html/t1.html state=touch owner=apache group=apache mode=644" -i hosts\n\n# ç¤ºä¾äºï¼ åå»ºç®å½ï¼å¹¶è®¾ç½®å±ä¸»ãå±ç»ãæé\n$ ansible web -m file -a "path=/var/www/html/dd state=directory owner=apache group=apache mode=755" -i hosts\n# ç¤ºä¾ä¸ï¼éå½ææç®å½çæ¹å¼\n$ ansible web -m file -a "path=/var/www/html state=directory owner=apache group=apache recurse=yes" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# 5.4 get_urlæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ ä¸è½½äºèç½çè½¯ä»¶å°æ¬å°\n$ ansible web -m get_url -a "url=http://192.168.99.181:12138/document/Ansible.docx dest=/root/" -i hosts\n\n# ç¤ºä¾äºï¼ ä¸è½½äºèç½æä»¶å¹¶è¿è¡mdsæ ¡éª\n$ md5sum Ansible.docx      # è·åæä»¶md5å¼\n7b1a6fe7af7252005987e16ce64e1e1a  Ansible.docx\n$ ansible web -m get_url -a "url=http://192.168.99.181:12138/document/Ansible.docx dest=/root/ checksum=md5:7b1a6fe7af7252005987e16ce64e1e1a" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# 5.5 serviceæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ å¯å¨httpdæå¡\n$ ansible web -m service -a "name=httpd state=started" -i hosts\n\n# ç¤ºä¾äºï¼ éè½½httpdæå¡\n$ ansible web -m service -a "name=httpd state=reloaded" -i hosts\n\n# ç¤ºä¾ä¸ï¼ éå¯httpdæå¡\n$ ansible web -m service -a "name=httpd state=restarted" -i hosts\n\n# ç¤ºä¾åï¼ åæ­¢httpdæå¡\n$ ansible web -m service -a "name=httpd state=stopped" -i hosts\n\n# ç¤ºä¾äºï¼ å¯å¨httpdæå¡ï¼å¹¶å å¥å¼æºèªå¯\n$ ansible web -m service -a "name=httpd state=started enabled=yes" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# 5.6 groupæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ åå»ºnewsåºæ¬ç»ï¼æå®gidä¸º9999\n$ ansible web -m group -a "name=news gid=9999 state=present"\n -i hosts\n\n# ç¤ºä¾äºï¼ åå»ºhttpç³»ç»ç»ï¼æå®gidä¸º8888\n$ ansible web -m group -a "name=http gid=8888  state=present\n system=yes" -i hosts\n\n# ç¤ºä¾ä¸ï¼ å é¤teståºæ¬ç»\n$ ansible web -m group -a "name=test state=absent" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# 5.7 useræ¨¡å\n\n# ç¤ºä¾ä¸ï¼ åå»ºjobç¨æ·ï¼uidæ¯1040ï¼ä¸»è¦ç»æ¯adm\n$ ansible web -m user -a "name=job uid=1040 group=adm" -i hosts\n\n# ç¤ºä¾äºï¼ åå»ºjohç¨æ·ï¼ç»å½shellæ¯/sbin/nologinï¼è¿½å binãsysä¸¤ä¸ªç»\n$ ansible web -m user -a "name=joh groups=bin,sys shell=/sbin/nologin" -i hosts\n\n# ç¤ºä¾ä¸ï¼ åå»ºjsmç¨æ·ï¼ä¸ºå¶æ·»å 123ä½ä¸ºç»å½å¯ç ï¼å¹¶åå»ºå®¶ç®å½\n$ ansible localhost -m debug -a "msg={{ \'123\' | password_hash(\'sha512\',\'salt\') }}"\n# è·å123å å¯åçå­ç¬¦ä¸²\n$6$salt$jkHSO0tOjmLW0S1NFlw5veSIDRAVsiQQMTrkOKy4xdCCLPNIsHhZkIRlzfzIvKyXeGdOfCBoW1wJZPLyQ9Qx/1\n\n$ ansible web -m user -a \'name=jsm password=$6$salt$jkHSO0tOjmLW0S1NFlw5veSIDRAVsiQQMTrkOKy4xdCCLPNIsHhZkIRlzfzIvKyXeGdOfCBoW1wJZPLyQ9Qx/1 create_home=yes\' -i hosts\n\n# ç¤ºä¾åï¼ ç§»é¤jobç¨æ·\n$ ansible web -m user -a "name=job state=absent remove=yes" -i hosts\n# remove=yeså é¤æ®éç¨æ·å®¶ç®å½\n\n# ç¤ºä¾äºï¼ åå»ºhttpç¨æ·ï¼å¹¶ä¸ºè¯¥ç¨æ·åå»º2048å­èçç§é¥ï¼å­æ¾å¨~/http/.ssh/id_rsa\n$ ansible web -m user -a "name=http generate_ssh_key=yes ssh_key_bits=2048 ssh_key_file=.ssh/id_rsa" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n# 5.8 cronæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ æ·»å å®æ¶ä»»å¡ï¼æ¯åéæ§è¡ä¸æ¬¡ls\n$ ansible web -m cron -a "name=job1 job=\'ls > /dev/null\'" -i hosts\n\n# ç¤ºä¾äºï¼ æ·»å å®æ¶ä»»å¡ï¼æ¯å¤©çåæ¨2ç¹ååæ¨5ç¹æ§è¡ä¸æ¬¡ls\n$ ansible web -m cron -a "name=job2 job=\'ls > /dev/null\' minute=0 hour=2,5" -i hosts\n\n# ç¤ºä¾ä¸ï¼ å³é­å®æ¶ä»»å¡ï¼ä½¿å®æ¶ä»»å¡å¤±è´¥\n$ ansible web -m cron -a "name=job2 job=\'ls > /dev/null\' minute=0 hour=2,5 disabled=yes" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# 5.9 mount\n\n# ç¯å¢åå¤ï¼\n$ ansible localhost -m yum -a "name=nfs-utils state=present" \n$ ansible localhost -m file -a "path=/ops state=directory"\n$ ansible localhost -m copy -a \'content="/ops 192.168.100.1/24(rw,sync)" dest=/etc/exports\'\n$ ansible localhost -m service -a "name=nfs state=restarted"\n\n# ç¤ºä¾ä¸ï¼ æè½½nfså­å¨å°æ¬å°ç/optç®å½ï¼å¹¶å®ç°å¼æºèªå¨æè½½\n$ ansible web -m mount -a "src=192.168.99.181:/ops path=/opt fstype=nfs opts=defaults state=mounted" -i hosts\n\n# ç¤ºä¾äºï¼ ä¸´æ¶å¸è½½nfsçæè½½ï¼ä½ä¸ä¼æ¸ç/etc/fstab\n$ ansible web -m mount -a "src=192.168.99.181:/ops path=/opt fstype=nfs opts=defaults state=unmounted" -i hosts\n\n# ç¤ºä¾ä¸ï¼ æ°¸ä¹å¸è½½nsçæè½½ï¼æ¸ç/etc/fstab\n$ ansible web -m mount -a "src=192.168.99.181:/ops path=/opt fstype=nfs opts=defaults state=absent" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# 5.10 firewalld\n\n# ç¤ºä¾ä¸ï¼ æ°¸ä¹æ¾è¡httpsçæµéï¼åªæéå¯æçæ\n$ ansible web -m firewalld -a "zone=public service=https permanent=yes state=enabled" -i hosts\n\n# ç¤ºä¾äºï¼ æ°¸ä¹æ¾è¡8081ç«¯å£çæµéï¼åªæéå¯æçæ\n$ ansible web -m firewalld -a "zone=public port=8081/tcp permanent=yes state=enabled" -i hosts\n\n# ç¤ºä¾ä¸ï¼ æ¾è¡8080-8090çææçtcpç«¯å£æµéï¼ä¸´æ¶åæ°¸ä¹é½çæ\n$ ansible web -m firewalld -a "zone=public port=8080-8090/tcp immediate=yes permanent=yes state=enabled" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# å­ãAnsible playbook\n\n# 6.1 ä»ä¹æ¯playbook\n\n * playbookï¼å®ä¹äºä¸ä¸ªææ¬æä»¶ï¼ä»¥.ymlä¸ºåç¼ç»å°¾ï¼\n * playï¼å®ä¹çæ¯ä¸»æºçè§è²ï¼\n * taskï¼å®ä¹çæ¯å·ä½æ§è¡çä»»å¡ï¼\n\næ»ç»ï¼playbookæ¯ç±ä¸ä¸ªå¤ä¸ªå¤ä¸ªplayç»æï¼ä¸ä¸ªplayå¯ä»¥åå«å¤ä¸ªtaskä»»å¡ãå¯ä»¥çè§£ä¸ºï¼ä½¿ç¨ä¸åçæ¨¡åæ¥å±åå®æä¸ä»¶äºæï¼\n\n---\n#### 6.2 Ansible playbookä¸ad-hocçå³ç³»\n\n\n * playbookæ¯å¯¹ad-hocçä¸ç§ç¼ææ¹å¼ï¼\n * playbookå¯ä»¥æä¹è¿è¡ï¼èad-hocåªè½ä¸´æ¶è¿è¡ï¼\n * playbookéåå¤æçä»»å¡ï¼èad-hocéååå¿«éç®åçä»»å¡ï¼\n * playbookè½æ§å¶ä»»å¡æ§è¡çååé¡ºåºï¼\n\n# 6.3 Ansible playbookä¹¦åæ ¼å¼\n\nplaybookæ¯ç±yamlè¯­æ³ä¹¦åï¼ç»ææ¸æ°ãå¯è¯»æ§å¼ºãæä»¥å¿é¡»ææ¡yamlåºç¡è¯­æ³ï¼\n\nè¯­æ³    æ¦è¿°\nç¼©è¿    YAMLä½¿ç¨åºå®çç¼©è¿é£æ ¼è¡¨ç¤ºå±çº§ç»æï¼æ¯ä¸ªç¼©è¿ç±ä¸¤ä¸ªç©ºæ ¼ç»æï¼ä¸è½ä½¿ç¨taé®\nåå·    ä»¥åå·ç»å°¾çé¤å¤ï¼å¶ä»ææåå·åé¢ææå¿é¡»æç©ºæ ¼\nç­æ¨ªçº¿   è¡¨ç¤ºåè¡¨é¡¹ï¼ä½¿ç¨ä¸ä¸ªç­æ¨ªæ å ä¸ä¸ªç©ºæ ¼ãå¤ä¸ªé¡¹ä½¿ç¨åæ ·çç¼©è¿çº§å«ä½ä¸ºç»ä¸åè¡¨\n\n\n# ä¸ãåé\n\n# 7.1 åéæ¦è¿°\n\nåéæä¾äºä¾¿æ·çæ¹å¼æ¥ç®¡çansibleé¡¹ç®ä¸­çå¨æå¼ï¼æ¯å¦ï¼nginx-1.12ï¼å¯è½åæä¼åå¤çä½¿ç¨è¿ä¸ªçæ¬çå¼ï¼é£ä¹å¦æå°æ­¤å¼è®¾ç½®ä¸ºåéï¼åç»­ä½¿ç¨åä¿®æ¹é½å°åå¾éå¸¸æ¹ä¾¿ãè¿æ ·å¯ä»¥ç®åé¡¹ç®çåå»ºåç»´æ¤ã\n\né£ä¹å¨ansibleä¸­å®ä¹åéåä¸ºä»¥ä¸ä¸ç§æ¹å¼ï¼\n\n * éè¿å½ä»¤è¡è¿è¡åéå®ä¹ï¼\n * å¨playæä»¶ä¸­è¿è¡å®ä¹åéï¼\n * éè¿Inventoryå¨ä¸»æºç»æåä¸ªä¸»æºä¸­è®¾ç½®åéï¼\n\nå¦æå®ä¹çåéåºç°éå¤ï¼ä¸é æå²çªï¼æä¹åï¼è°è¯´äºç®ï¼\n\n# 7.2 åéå®ä¹\n\n1ãå¨playbookçæä»¶å¼å¤´éè¿varså³é®å­è¿è¡åéå®ä¹\n\n- hosts: web\n  vars:\n    - web_packages: httpd\n    - ftp_packages: vsftpd\n\n  tasks:\n    - name: Install Rpm Packages "{{ web_packages }}" "{{ ftp_packages }}"\n      yum:\n        name:\n          - "{{ web_packages }}"\n          - "{{ ftp_packages }}"\n        state: present\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n2ãå¯ä»¥å¨playbookä¸­ä½¿ç¨vars_filesæå®æä»¶ä½ä¸ºåéæä»¶ï¼å¥½å¤å°±æ¯å¶ä»çplaybookä¹å¯ä»¥è°ç¨\n\n# 1ï¼åå¤ä¸ä¸ªåéçæä»¶ï¼å»ºè®®ä½¿ç¨ymlæ ¼å¼\n$ cat vars.yml\nweb_packages: httpd\nftp_packages: vsftpd\n\n# 2ï¼åå¤playbookè¿è¡è°ç¨\n$ cat test.yml\n- hosts: web\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: Install Rpm Packages "{{ web_packages }}" "{{ ftp_packages }}"\n      yum:\n        name:\n          - "{{ web_packages }}"\n          - "{{ ftp_packages }}"\n        state: present\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n3ãå¨Inventoryä¸»æºæ¸åä¸­å®ä¹åéï¼ä½æ¯æ³¨æï¼ä¸»æºåéä¼åçº§é«äºä¸»æºç»åé\n\n# 1ï¼å¨Inventoryä¸»æºæ¸åä¸­å¯¹ä¸»æºç»è¿è¡å®ä¹åé\n$ cat hosts\n[web]\n192.168.100.225\n192.168.100.226\n\n[web:vars]\nfilename=group_vars\n\n# 2ï¼playbookä¸­ç´æ¥è°ç¨åé\n$ cat test.yml\n- hosts: web\n  tasks:\n    - name: Create File\n      file:\n        name: /tmp/{{ filename}}\n        state: touch\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n4ãå®æ¹å»ºè®®æ¯å¨ansibleé¡¹ç®ç®å½ä¸­åå»ºä¸¤ä¸ªé¢å¤çåéç®å½ï¼åå«æ¯host_varsågroup_vars\n\n * æµè¯group_varså®ä¹åéæ¹å¼\n\n$ cat hosts\n[web]\n192.168.100.225\n192.168.100.226\n\n# 1ï¼å¨å½åçé¡¹ç®ç®å½ä¸­åå»ºä¸¤ä¸ªåéçç®å½\n$ mkdir {group,host}_vars\n\n# 2ï¼å¨group_varsç®å½ä¸­åå»ºä¸ä¸ªæä»¶ï¼æä»¶åä¸Inventoryæ¸åä¸­çä¸»æºç»åç§°è¦ä¿æä¸è´\n$ cat group_vars/web\nweb_packages: wget\nftp_packages: tree\n\n# 3ï¼ç¼åplaybookï¼åªéå¨playbookä¸­ä½¿ç¨åéå³å¯\n$ cat test.yml\n- hosts: web\n  tasks:\n    - name: Install Rpm Packages "{{ web_packages }}" "{{ ftp_packages }}"\n      yum:\n        name:\n          - "{{ web_packages }}"\n          - "{{ ftp_packages }}"\n        state: present\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næµè¯testç»è½å¦ä½¿ç¨webç»å®ä¹çåéï¼æ æ³ä½¿ç¨ï¼ä½æ¯ç³»ç»æä¾äºç¹æ®çallç»ï¼ä¹å°±æ¯è¯´group_varsç®å½ä¸åå»ºä¸ä¸ªallæä»¶ï¼å®ä¹åéå¯¹ææçä¸»æºé½çæï¼\n\n * æµè¯host_varså®ä¹åéæ¹å¼\n\n# 1ï¼å¨host_varsç®å½åå»ºä¸ä¸ªæä»¶ï¼æä»¶åä¸Inventoryæ¸åä¸­çä¸»æºåç§°è¦ä¿æä¸è´ï¼å¦ææ¯IPå°åï¼ååå»ºç¸åçIP\n$ cat hosts\n[web]\n192.168.100.225\n192.168.100.226\n\n# 2ï¼å¨host_varsç®å½ä¸­åå»ºæä»¶ï¼ç»192.168.100.225ä¸»æºå®ä¹åé\n$ cat host_vars/192.168.100.225\nweb_packages: zlib-static\nftp_packages: zmap\n\n# 3ï¼è½¬å«ä¸ä¸ªplaybookæä»¶è°ç¨hostä¸»æºåé\n$ cat test.yml\n- hosts: 192.168.100.225\n  tasks:\n    - name: Install Rpm Packages "{{ web_packages }}" "{{ ftp_packages }}"\n      yum:\n        name:\n          - "{{ web_packages }}"\n          - "{{ ftp_packages }}"\n        state: present\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n5ãéè¿å½ä»¤è¡-extra-varsæ-eå¤ç½®ç©¿é¤è®¾å®åé\n\n# 1ï¼åå¤playbookæä»¶\n$ cat test.yml\n- hosts: "{{ host }}"\n  tasks:\n    - name: Install Rpm Packages "{{ web_packages }}" "{{ ftp_packages }}"\n      yum:\n        name:\n          - "{{ web_packages }}"\n          - "{{ ftp_packages }}"\n        state: present\n\n# 2ï¼æ§è¡playbookæ¶è¿è¡åéçä¼ é\n$ ansible-playbook -i hosts test.yml -e "host=web"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n6ãåéçä¼åçº§é¡ºåºï¼\n\nå½ä»¤è¡åéââ>palyä¸­çvars_filesââ>palyä¸­çvarsââ>host_varsââ>group_vars/all\n\n# 7.3 åéæ³¨å\n\nregisterå³é®å­å¯ä»¥å°æä¸ªtaskä»»å¡ç»æå­å¨è³åéä¸­ï¼æåä½¿ç¨debugè¾åºåéåå®¹ï¼å¯ä»¥ç¨äºåç»­ææ¥æéï¼\n\n- hosts: all\n  tasks:\n    - name: system status\n      shell: netstat -lntp\n      register: System_Status\n\n    - name: System Status\n      debug: msg="{{ System_Status.stdout_lines }}"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# 7.4 factsåé\n\nAnsible factsæ¯å¨è¢«ç®¡çä¸»æºä¸éè¿ansibleèªå¨ééåç°çåéãfactsåå«æ¯å°ç¹å®çä¸»æºä¿¡æ¯ãæ¯å¦ï¼è¢«æ§ç«¯ä¸»æºçä¸»æºåãIPå°åãç³»ç»çæ¬ãCPUæ°éãåå­ç¶æãç£çç¶æç­ç­ã\n\né»è®¤æåµçfactsåéåé½å·²ç»é¢åå®ä¹å¥½äºï¼åªéè¦ééè¢«æ§ç«¯çä¿¡æ¯ï¼ç¶åä¼ éè³factsåéå³å¯ï¼\n\n $ ansible web -m setup -i hosts > facts.txt\n # è·åææçfactsåé\n\n\n1\n2\n\n\nfactsåéä½¿ç¨åºæ¯ï¼\n\n * éè¿factsåéæ£æ¥è¢«æ§ç«¯ä¸»æºç¡¬ä»¶CPUä¿¡æ¯ï¼ä»èçæä¸åçNginxéç½®æä»¶ï¼\n\n * éè¿factsåéæ£æ¥è¢«æ§ç«¯ä¸»æºåç§°ä¿¡æ¯ï¼ä»èçæä¸åçzabbixéç½®æä»¶ï¼\n\n * éè¿factsåéæ£æ¥è¢«æ§ç«¯ä¸»æºåå­ç¶æä¿¡æ¯ï¼ä»èçæä¸åçmemcachedéç½®æä»¶ï¼\n   \n   â¦â¦â¦â¦â¦â¦\n\n1ãfactsåºæ¬ç¨æ³ï¼æ¯å¦è·åè¢«æ§ç«¯çä¸»æºååIPå°åï¼ç¶åéè¿debugè¾åº\n\n- hosts: all\n  tasks:\n    - name: OutPut variables ansible facts\n      debug:\n        msg: this default IPv4 address "{{ ansible_fqdn }}" is "{{ ansible_default_ipv4.address }}"\n\n\n1\n2\n3\n4\n5\n\n\n2ãfactså¼å¯åä¼å½±åAnsibleä¸»æºçæ§è½ï¼å¦ææ²¡æééè¢«æ§ç«¯ä¸»æºéæ±å¯éæ©å³é­\n\n- hosts: web\n  gather_facts: no    # å³é­ä¿¡æ¯éé\n\n\n1\n2\n\n\n\n# å«ãAnsible Task ä»»å¡æ§å¶\n\n# 8.1 piaybookæ¡ä»¶è¯­å¥\n\nå¤æ­å¨Ansibleä»»å¡ä¸­çä½¿ç¨é¢çéå¸¸é«ï¼æ¯å¦yumæ¨¡åå¯ä»¥æ£æµè½¯ä»¶åæ¯å¦å·²ç»è¢«å®è£ï¼èå¨è¿ä¸ªè¿ç¨ä¸­æä»¬ä¸ç¨åå¤ªå¤çäººå·¥å¹²é¢ãä½æ¯ä¹æé¨åä»»å¡éè¦è¿è¡å¤æ­ã\n\n# æ¡ä¾ä¸ï¼æ ¹æ®ä¸åæä½ç³»ç»ï¼å®è£ç¸åçè½¯ä»¶å\n\n- hosts: web\n  tasks:\n    - name: Centos Install Httpd\n      yum:\n        name: httpd\n        state: present\n      when: ( ansible_distribution == "CentOS" )\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# æ¡ä¾äºï¼ä¸ºææwebä¸»æºåçæ·»å nginxä»åºï¼å¶ä½çé½è·³è¿æ·»å \n\n- hosts: all\n  tasks:\n    - name: Create YUM Repo\n      yum_repository:\n        name: ansible_nginx\n        description: ansible_test\n        baseurl: http://nginx.org/packages/centos/$releasever/$basearch/\n        enabled: yes\n        gpgcheck: no\n      when: ( ansible_fqdn is match("web*") )\n\n# å½ç¶whenä¹å¯ä»¥ä½¿ç¨andä¸oræ¹å¼\n# whenï¼ ( ansible_fqdn is match("web*") ) or\n#         ( ansible_fqdn is match("lb*") )\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# æ¡ä¾ä¸ï¼æ ¹æ®å½ä»¤æ§è¡çç»æè¿è¡å¤æ­\n\néè¿registerå°å½ä»¤æ§è¡ç»æä¿å­è³åéï¼ç¶åéè¿whenè¯­å¥è¿è¡å¤æ­\n\n- hosts: all\n  tasks:\n    - name: Check Httpd Server\n      command: systemctl is-active httpd\n      ignore_errors: yes        # å¿½ç¥éè¯¯\n      register: check_httpd\n\n    - name: Httpd Restart        # å¦æcheck_httpdæ§è¡å½ä»¤ç»æç­äº0ï¼åéå¯httpd,å¦åè·³è¿\n      service:\n        name: httpd\n        state: restarted\n      when: check_httpd.rc == 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n# 8.2 playbookå¾ªç¯è¯­å¥\n\nææ¶åæä»¬åplaybookçæ¶åä¼åç°äºå¾å¤taské½è¦éå¤å¼ç¨æä¸ªæ¨¡åï¼æ¯å¦ä¸æ¬¡å¯å¨10ä¸ªæå¡ï¼æèä¸ä¸ªæ·è´10ä¸ªæä»¶ãå¦æå®è£ä¼ ç»çåæ³æå°è¦å10æ¬¡ï¼è¿æ ·ä¼æ¾å¾playbookå¾èè¿ãå¦æä½¿ç¨å¾ªç¯çæ¹å¼æ¥ç¼åplaybokkï¼è¿æ ·å¯ä»¥åå°éå¤ä½¿ç¨æä¸ªæ¨¡åï¼\n\n# æ¡ä¾ä¸ï¼ ä½¿ç¨å¾ªç¯å¯å¨å¤ä¸ªæå¡\n\n- hosts: all\n  tasks:\n    - name: Service Start\n      service: \n        name: "{{ item }}"\n        state: started\n      with_items:\n        - httpd\n        - sshd\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# æ¡ä¾äºï¼ ä½¿ç¨å­å¸æ¹éåå»ºç¨æ·\n\n- hosts: all\n  tasks:\n    - name: Add Users\n      user: \n        name: "{{ item.name }}"\n        group: "{{item.group }}"\n        state: present\n      with_items:\n        - { name: \'test01\',group: \'bin\' }\n        - { name: \'test02\',group: \'root\' }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# æ¡ä¾ä¸ï¼ ä½¿ç¨åéå­å¸å¾ªç¯çæ¹å¼æ·è´æä»¶\n\n- hosts: all\n  tasks:\n    - name: Copy File\n      copy:\n        src: "{{ item.src }}"\n        dest: "{{ item.dest }}"\n        mode: "{{ item.mode }}"\n      with_items:\n        - { src: \'rsync.conf\' , dest: \'/tmp/rsync.conf\' , mode: 644 }\n        - { src: \'rsync.pass\' , dest: \'/tmp/rsync.pass\' , mode: 600 }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\né«çº§åæ³(åéå¥åé)ï¼\n\n- hosts: all\n  vars:\n    - Path: /tmp\n  tasks:\n    - name: Copy File\n      copy:\n        src: "{{ item.src }}"\n        dest: "{{ item.dest }}"\n        mode: "{{ item.mode }}"\n      with_items:\n        - { src: \'rsync.conf\' , dest: \'{{ Path }}/rsync.conf\' , mode: 644 }\n        - { src: \'rsync.pass\' , dest: \'{{ Path }}/rsync.pass\' , mode: 600 }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n# 8.3 playbook handlers\n\nhandlersæ¯ä¸ä¸ªè§¦åå¨ï¼ä¹æ¯ä¸ä¸ªtasksï¼åªä¸è¿æ¯ä¸ä¸ªç¹æ®çtasksï¼å®æ¯éè¦è¢«tasksè§¦åæä¼æ§è¡ãåªè¦éç½®æä»¶åçåæ´ï¼åä¼è§¦åhandlersæ§è¡éå¯æå¡æä½ï¼å¦æéç½®æä»¶ä¸åçä»»ä½ååï¼åä¸ä¼éå¯ï¼ notifyçæ§ââ>éç¥ââ>handlersè§¦å\n\n# æ¡ä¾ï¼playbookå®è£nginx\n\n- hosts: web\n  tasks:\n  - name: Instll Nginx\n    yum: \n      name: nginx\n      state: present\n\n  - name: Copy Nignx.conf\n    template:\n      src: nginx.conf.j2\n      dest: /etc/nginx/nginx.conf\n    notify: Restart Nignx Service\n\n  handlers:\n    - name: Restart Nignx Service\n      service:\n        name: nginx\n        state: restarted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nhandlersæ³¨æäºé¡¹ï¼\n\n * æ è®ºå¤å°ä¸ªtaskéç¥ç¸åçhandlersï¼handlersä»ä¼å¨æætaskç»æåæ§è¡ä¸æ¬¡ï¼\n * åªætaskåçåååæä¼éç¥handlersï¼æ²¡ææ¹ååä¸ä¼è§¦åhandlersï¼\n * ä¸è½ä½¿ç¨handlersä»£æ¿taskï¼å ä¸ºhandlersæ¯ä¸ä¸ªç¹æ®çtaskï¼\n\n# 8.4 playbook tag\n\né»è®¤æåµä¸ï¼Ansibleå¨æ§è¡ä¸ä¸ªplaybookæ¶ï¼ä¼æ§è¡playbookä¸­çå®ä¹çææä»»å¡ãAnsibleçæ ç­¾ï¼Tagsï¼åè½å¯ä»¥ç»åç¬ä»»å¡çè³æ´ä¸ªplaybookæä¸tagæ ç­¾ï¼ç¶åå©ç¨tagæ ç­¾æå®è¦è¿è¡çä¸ªå«ä»»å¡ï¼æè·³è¿ä¸ªå«çä»»å¡ï¼\n\n# æ¡ä¾ï¼\n\n- hosts: web\n  tasks:\n  - name: Instll Nginx\n    yum: \n      name: nginx\n      state: present\n    tags: install nginx            # æ·»å tagæ ç­¾\n\n  - name: Copy Nignx.conf\n    template:\n      src: nginx.conf.j2\n      dest: /etc/nginx/nginx.conf\n    notify: Restart Nignx Service\n\n  - name: Start Nginx \n    service:\n      name: nginx\n      state: started\n    tags: start nginx          # æ·»å tagæ ç­¾\n\n  handlers:\n    - name: Restart Nignx Service\n      service:\n        name: nginx\n        state: restarted\n$ ansible-playbook -i hosts test.yml  -t \'install nginx\'\n# ä»ä»æ§è¡playbookä¸­çæä¸ªtagæ ç­¾\n\n$ $ ansible-playbook -i hosts test.yml  --skip-tags \'install nginx\'\n# è·³è¿playbookä¸­çç¹å®çtagæ ç­¾\n\n$ ansible-playbook -i hosts test.yml  -t \'install nginx\' -t \'start nginx\'\n# æå®å¤ä¸ªtagæ ç­¾\n\n$ ansible-playbook -i hosts test.yml  --skip-tags \'install nginx\' --skip-tags \'start nginx\'\n# è·³è¿å¤ä¸ªtagæ ç­¾\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\n# 8.5 playbook include\n\nææ¶åç°å¤§éçplaybookåå®¹è¦éå¤ç¼åï¼ä¸tasksä¹é´è´¡å¢éç¸äºè°ç¨æè½å®æåèªè´¡å¢ãplaybookåºå¤§å°ç»´æ¤å°é¾ï¼è¿æ¯å°±éè¦ä½¿ç¨includeï¼\n\n# æ¡ä¾ï¼\n\n$ cat restart_httpd.yml \n- name: Restart Httpd Service\n  service:\n    name: httpd\n    state: restarted\n\n\n1\n2\n3\n4\n5\n\n\nA Projectçyamlæä»¶ï¼\n\n- hosts: web\n  tasks:\n    - name: A Project command\n      command: echo "A"\n    - name: Restart Httpd\n      include: restart_httpd.yml\n\n\n1\n2\n3\n4\n5\n6\n\n\nA Projectçyamlæä»¶ï¼\n\n- hosts: web\n  tasks:\n    - name: B Project command\n      command: echo "B"\n    - name: Restart Httpd\n      include: restart_httpd.yml\n\n\n1\n2\n3\n4\n5\n6\n\n\né«çº§ç¨æ³ï¼\n\nä¸æ¬¡æ§è¡çå¤ä¸ªplaybookæä»¶ï¼\n\n$ cat tasks_total.yml \n- import_playbook: test.yml\n- import_playbook: test01.yml\n\n$ ansible-playbook -i hosts  tasks_total.yml\n\n\n1\n2\n3\n4\n5\n\n\n# 8.6 ignore_errorså¿½ç¥éè¯¯\n\n- hosts: web\n  tasks:\n    - name: Command\n      command: /bin/false\n      ignore_errors: yes\n\n    - name: Create File\n      file:\n        path: /tmp/file\n        state: touch\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# 8.7 playbookéè¯¯å¤ç\n\néå¸¸æåµä¸ï¼å½taskå¤±è´¥åï¼playå°ä¼ç»æ­¢ï¼ä»»ä½å¨åé¢å·²ç»è¢«tasks notifyçhandlersé½ä¸ä¼è¢«æ§è¡ãå¦æå¨playä¸­è®¾ç½®force_handlersï¼è¢«éç¥çhandlerså°±ä¼è¢«å¼ºå¶æ§è¡ã\n\n# æ¡ä¾ä¸ï¼taskæ§è¡å¤±è´¥å¼ºå¶è°ç¨handlers\n\n- hosts: web\n  force_handlers: yes     # å¼ºå¶è°ç¨handlers\n\n  tasks:\n    - name: Touch File\n      file:\n        path: /tmp/test\n        state: touch\n      notify: Restart Httpd Service\n\n    - name: Install Packages\n      yum: \n        name: sb\n        state: present\n\n  handlers:\n    - name: Restart Httpd Service\n      service:\n        name: httpd\n        state: restarted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# æ¡ä¾äºï¼ å³é­changeçç¶æï¼ç¡®å®ä¸ä¼å¯¹è¢«æ§ç«¯ä¸»æºè¿è¡ä»»ä½çä¿®æ¹ååæ´ï¼\n\n- hosts: web\n  tasks:\n    - name: Install Httpd Server\n      yum: \n        name: httpd\n        state: present\n    - name: Service Httpd Started\n      service:\n        name: httpd\n        state: started\n    - name: Check Httpd Server\n      shell: ps aux | grep httpd\n      register: check_httpd\n      changed_when: false\n    - name: OutPut Variables\n      debug:\n        msg: "{{ check_httpd.stdout_lines }}"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# æ¡ä¾ä¸ï¼ ä½¿ç¨changed_whenæ£æ¥tasksrreä»»å¡è¿åç»æ\n\n- hosts: web\n  tasks:\n    - name: Configure Nginx Server\n      template:\n        src: nginx.conf.j2\n        dest: /etc/nginx/nginx.conf\n      notify: Restart Nginx Server\n\n    - name: Check Httpd\n      shell: /usr/sbin/nginx -t\n      register: nginx_check\n      changed_when:\n        - (nginx_check.stdout.find(\'successful\'))\n        - false\n\n    - name: Start Httpd Server\n      service:\n        name: nginx\n        state: started\n        enabled: yes\n\n    - handlers: Restart Httpd Server\n      service:\n        name: nginx\n        state: restarted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n',normalizedContent:'åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14199445.html\n\n\n# ansibleå¥é¨\n\nç®å½\n\n * ä¸ãansibleåºç¡æ¦è¿°\n   * 1.1 ä»ä¹æ¯ansible\n   * 1.2 ansible å¯ä»¥å®æåªäºåè½\n   * 1.3 ansibleç¹ç¹\n   * 1.4 ansibleçæ¶æä¸­çæ§å¶èç¹ãè¢«æ§å¶èç¹ãinventoryãad-hocãplaybookãè¿æ¥åè®®è¿äºæ¯ä»ä¹ï¼\n * äºãansibleå®è£éç½®\n   * 2.1 ansibleå®è£\n * ä¸ãansible inventory\n   * 3.1 åºæ¯ä¸ï¼åºäºå¯ç è¿æ¥\n   * 3.2 åºæ¯äºï¼åºäºç§é¥è¿æ¥\n   * 3.3 åºæ¯ä¸ï¼ä¸»æºç»ä½¿ç¨æ¹å¼\n   * 3.4 ååºæ¯ä¸ªä¸»æºç»ä¸é¢çä¸»æºæåµ\n * åãansible ad-hoc\n   * 4.1 ä»ä¹æ¯ad-hoc\n   * 4.2 ad-hocmæ¨¡å¼çä½¿ç¨åºæ¯\n   * 4.3 ad-hocæ¨¡å¼çå½ä»¤ä½¿ç¨\n   * 4.4 ä½¿ç¨ad-docæå®ä¸æ¬¡è¿ç¨å½ä»¤ï¼æ³¨æè§å¯è¿åç»æçé¢è²\n   * 4.5 ad-hocå¸¸ç¨çæ¨¡å\n   * 4.6 ä½¿ç¨è¿ç¨ä¸­éè¦åäºè§£anisble-docå¸®å©æå\n * äºãansibel æ¨¡å\n   * 5.1 yumæ¨¡å\n   * 5.2 copyæ¨¡å\n   * 5.3 fileæ¨¡å\n   * 5.4 get_urlæ¨¡å\n   * 5.5 serviceæ¨¡å\n   * 5.6 groupæ¨¡å\n   * 5.7 useræ¨¡å\n   * 5.8 cronæ¨¡å\n   * 5.9 mount\n   * 5.10 firewalld\n * å­ãansible playbook\n   * 6.1 ä»ä¹æ¯playbook\n   * 6.2 ansible playbookä¸ad-hocçå³ç³»\n   * 6.3 ansible playbookä¹¦åæ ¼å¼\n * ä¸ãåé\n   * 7.1 åéæ¦è¿°\n   * 7.2 åéå®ä¹\n   * 7.3 åéæ³¨å\n   * 7.4 factsåé\n * å«ãansible task ä»»å¡æ§å¶\n   * 8.1 piaybookæ¡ä»¶è¯­å¥\n     * æ¡ä¾ä¸ï¼æ ¹æ®ä¸åæä½ç³»ç»ï¼å®è£ç¸åçè½¯ä»¶å\n     * æ¡ä¾äºï¼ä¸ºææwebä¸»æºåçæ·»å nginxä»åºï¼å¶ä½çé½è·³è¿æ·»å \n     * æ¡ä¾ä¸ï¼æ ¹æ®å½ä»¤æ§è¡çç»æè¿è¡å¤æ­\n   * 8.2 playbookå¾ªç¯è¯­å¥\n     * æ¡ä¾ä¸ï¼ ä½¿ç¨å¾ªç¯å¯å¨å¤ä¸ªæå¡\n     * æ¡ä¾äºï¼ ä½¿ç¨å­å¸æ¹éåå»ºç¨æ·\n     * æ¡ä¾ä¸ï¼ ä½¿ç¨åéå­å¸å¾ªç¯çæ¹å¼æ·è´æä»¶\n   * 8.3 playbook handlers\n     * æ¡ä¾ï¼playbookå®è£nginx\n   * 8.4 playbook tag\n     * æ¡ä¾ï¼\n   * 8.5 playbook include\n     * æ¡ä¾ï¼\n   * 8.6 ignore_errorså¿½ç¥éè¯¯\n   * 8.7 playbookéè¯¯å¤ç\n     * æ¡ä¾ä¸ï¼taskæ§è¡å¤±è´¥å¼ºå¶è°ç¨handlers\n     * æ¡ä¾äºï¼ å³é­changeçç¶æï¼ç¡®å®ä¸ä¼å¯¹è¢«æ§ç«¯ä¸»æºè¿è¡ä»»ä½çä¿®æ¹ååæ´ï¼\n     * æ¡ä¾ä¸ï¼ ä½¿ç¨changed_whenæ£æ¥tasksrreä»»å¡è¿åç»æ\n\n\n# ä¸ãansibleåºç¡æ¦è¿°\n\n# 1.1 ä»ä¹æ¯ansible\n\nansibleæ¯ä¸ä¸ªitèªå¨åçéç½®ç®¡çå·¥å·ï¼èªå¨åä¸»è¦ä½ç°å¨ansibleéæäºä¸°å¯æ¨¡åãä¸°å¯çåè½ç»ä»¶ï¼å¯ä»¥éè¿ä¸ä¸ªå½ä»¤å®æä¸ç³»åçæä½ãè¿èåå°æä»¬éå¤æ§çå·¥ä½åç»´æ¤ææ¬ï¼ä»¥æé«å·¥ä½æçï¼\n\n# 1.2 ansible å¯ä»¥å®æåªäºåè½\n\n * æ¹éæ§è¡è¿ç¨å½ä»¤ï¼å¯ä»¥å¯¹nå¤å°ä¸»æºåæ¶è¿è¡å½ä»¤çæ§è¡ï¼\n * æ¹ééç½®è½¯ä»¶æå¡ï¼å¯ä»¥è¿è¡èªå¨åçæ¹å¼éç½®åç®¡çæå¡ï¼\n * å®ç°è½¯ä»¶å¼ååè½ï¼jumpserveråºå±ä½¿ç¨ansibleæ¥å®ç°çèªå¨åç®¡çï¼\n * ç¼æé«çº§çitä»»å¡ï¼ansibleçplaybookæ¯ä¸é¨ç¼ç¨è¯­è¨ï¼å¯ä»¥ç¨æ¥æç»ä¸å¥itæ¶æï¼\n\n# 1.3 ansibleç¹ç¹\n\n * å®¹æå­¦ä¹ ï¼æ ä»£çæ¨¡å¼ï¼ä¸åsaltstackæ¢è¦å­¦ä¹ å®¢æ·ç«¯ä¸æå¡ç«¯ï¼è¿è¦å­¦ä¹ å®¢æ·ç«¯ä¸æå¡ç«¯ä¸­é´éä¿¡åè®®ï¼\n * æä½çµæ´»ï¼ä½ç°å¨ansibleæè¾å¤çæ¨¡åï¼æä¾äºä¸°å¯çåè½ãplaybookåæä¾ç±»ä¼¼äºç¼ç¨è¯­è¨çå¤æåè½ï¼\n * ç®åå¤ç¨ï¼ä½ç°å¨ansibleä¸ä¸ªå½ä»¤å¯ä»¥å®æå¾å¤äºæï¼\n * å®å¨å¯é ï¼å ä¸ºansibleä½¿ç¨äºsshåè®®è¿è¡éä¿¡ï¼æ¢ç¨³å®ä¹å®å¨ï¼\n * ç§»æ¤æ§é«ï¼å¯ä»¥å°åå¥½çplaybookæ·è´ä»»ææºå¨è¿è¡æ§è¡ï¼\n\n# 1.4 ansibleçæ¶æä¸­çæ§å¶èç¹ãè¢«æ§å¶èç¹ãinventoryãad-hocãplaybookãè¿æ¥åè®®è¿äºæ¯ä»ä¹ï¼\n\n\n\n\n# äºãansibleå®è£éç½®\n\n# 2.1 ansibleå®è£\n\n$ wget -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\n$ yum install ansible -y\n$ ansible --version\nansible 2.9.10\n  config file = /etc/ansible/ansible.cfg\n  configured module search path = [u\'/root/.ansible/plugins/modules\', u\'/usr/share/ansible/plugins/modules\']\n  ansible python module location = /usr/lib/python2.7/site-packages/ansible\n  executable location = /usr/bin/ansible\n  python version = 2.7.5 (default, nov 20 2015, 02:00:19) [gcc 4.8.5 20150623 (red hat 4.8.5-4)]\n\n$ ansible <host-pattern> [option]\n--version: # ansibleçæ¬ä¿¡æ¯\n-vï¼æ¾ç¤ºè¯¦ç»ä¿¡æ¯\n-iï¼ä¸»æºæ¸åæä»¶è·¯å¾ï¼é»è®¤æ¯/etc/ansibel/hosts\n-mï¼ä½¿ç¨çæ¨¡åçåç§°ï¼é»è®¤ä½¿ç¨commandæ¨¡å\n-aï¼ä½¿ç¨çæ¨¡ååæ°ï¼æ¨¡åçå·ä½å·¥ä½\n-kï¼æç¤ºè¾å¥sshå¯ç ï¼èä¸ä½¿ç¨åºäºsshçç§é¥è®¤è¯\n-cï¼æ¨¡ææ§è¡æµè¯ï¼ä½ä¸ä¼ççæ§è¡\n-tï¼æå®å½ä»¤çè¶æ¶æ¶é´\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nansibleéç½®æä»¶ä¼åçº§é¡ºåºï¼\n\n * æåæ¥æ¾$ansible_configåéï¼\n * å¶æ¬¡æ¥æ¾å½åç®å½ä¸ansible.cfg\n * ç¶åæ¥æ¾ç¨æ·å®¶ç®å½ä¸ç.ansible.cfg\n * æåæ¥æ¾/etc/ansible/ansible.cfgï¼é»è®¤ï¼\n\n\n# ä¸ãansible inventory\n\ninventoryæä»¶ä¸­å¡«åéè¦è¢«ç®¡çä¸»æºä¸ä¸»æºç»ä¿¡æ¯ï¼é»è¾ä¸å®ä¹ï¼ãé»è®¤inventoryæä»¶å¨/etc/ansible/hostsãå½ç¶ä¹å¯ä»¥èªå®ä¹ï¼ç¶åä½¿ç¨-iæå®inventoryæä»¶ä½ç½®ï¼ç¤ºä¾ï¼\n\n# 3.1 åºæ¯ä¸ï¼åºäºå¯ç è¿æ¥\n\n$ cat /etc/ansible/hosts\n\n# æ¹æ³ä¸\n[webservers]\n192.168.100.225 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_pass=\'123456\'\n192.168.100.226 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_pass=\'123456\'\n\n# æ¹æ³äº\n[webservers]\nweb[1:2].lzj.com ansible_ssh_pass=\'123456\'\n\n# æ¹æ³ä¸\n[webservers]\nweb[1:2].lzj.com\n[webserversï¼vars]\nansible_ssh_pass=\'123456\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# 3.2 åºæ¯äºï¼åºäºç§é¥è¿æ¥\n\n$ ssh-keygen\n$ ssh-copy-id 192.168.100.225\n$ ssh-copy-id 192.168.100.226\n$ mkdir project1/ && cd project1/\n$ vim hosts\n[web]\n192.168.100.225\n192.168.100.226\n$ ansible web -m ping -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# 3.3 åºæ¯ä¸ï¼ä¸»æºç»ä½¿ç¨æ¹å¼\n\n[lbservers]\n192.168.100.221\n192.168.100.222\n\n[webservers]\n192.168.100.223\n192.168.100.224\n\n[servers:children]    # å®ä¹serversç»åå«ä¸¤ä¸ªå­ç»ï¼lbserversãwebserversï¼\nlbservers\nwebservers\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n# 3.4 ååºæ¯ä¸ªä¸»æºç»ä¸é¢çä¸»æºæåµ\n\n$ ansible all -i hosts --list-hosts\n  hosts (2):\n    192.168.100.225\n    192.168.100.226\n$ ansible web -i hosts --list-hosts\n  hosts (2):\n    192.168.100.225\n    192.168.100.226\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# åãansible ad-hoc\n\n# 4.1 ä»ä¹æ¯ad-hoc\n\nad-hocå°±æ¯ä¸´æ¶å½ä»¤ï¼æ§è¡å®æåå°±ç»æï¼å¹¶ä¸ä¼ä¿å­ï¼\n\n# 4.2 ad-hocmæ¨¡å¼çä½¿ç¨åºæ¯\n\næ¯å¦å¨å¤å°æºå¨ä¸æ¥çæä¸ªè¿ç¨æ¯å¦å¯å¨ï¼ææ·è´æå®æä»¶å°æ¬å°ï¼ç­ç­ï¼\n\n# 4.3 ad-hocæ¨¡å¼çå½ä»¤ä½¿ç¨\n\nå½ä»¤æ ¼å¼   ansible   zpj    -m     command   -a     \'df -h\'\næ ¼å¼è¯´æ   å½ä»¤        ä¸»æºåç§°   æå®æ¨¡å   æ¨¡ååç§°      æ¨¡åå¨ä½   å·ä½å½ä»¤\n\n# 4.4 ä½¿ç¨ad-docæå®ä¸æ¬¡è¿ç¨å½ä»¤ï¼æ³¨æè§å¯è¿åç»æçé¢è²\n\n * ç»¿è²ï¼è¡¨ç¤ºè¢«ç®¡çä¸»æºæ²¡æè¢«ä¿®æ¹ï¼\n * é»è²ï¼è¡¨ç¤ºè¢«ç®¡çç«¯ä¸»æºåç°åæ´ï¼\n * çº¢è²ï¼è¡¨ç¤ºåºç°äºæéï¼æ³¨ææ¥çæç¤ºï¼\n\n# 4.5 ad-hocå¸¸ç¨çæ¨¡å\n\ncommand            # æå®shellå½ä»¤ï¼ä¸æ¯æç®¡éç­ç¹æ®å­ç¬¦ï¼\nshell            # æ§è¡shellå½ä»¤\nscripts            # æ§è¡shellèæ¬\nyum_repository    # éç½®yumä»åº\nyum                # å®è£è½¯ä»¶\ncopy            # åæ´éç½®æä»¶\nfile            # å»ºç«ç®å½ææä»¶\nservice            # å¯å¨ãåæ­¢æå¡\nmount            # æè½½è®¾å¤\ncron            # å®æ¶ä»»å¡\nfirewalld        # é²ç«å¢\nget_url            # ä¸è½½è½¯ä»¶\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n# 4.6 ä½¿ç¨è¿ç¨ä¸­éè¦åäºè§£anisble-docå¸®å©æå\n\n$ ansible-doc -l        # æ¥çæææ¨¡åè¯´æ\n$ ansible-doc copy        # è¡¨ç¤ºæå®æ¨¡åæ¹æ³\n$ ansible-doc -s copy    # è¡¨ç¤ºæå®æ¨¡ååæ°\n\n\n1\n2\n3\n\n\n\n# äºãansibel æ¨¡å\n\n# 5.1 yumæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ å®è£å½åææ°çapacheè½¯ä»¶ï¼å¦æå­å¨åæ´æ°\n$ ansible web -m yum -a "name=httpd state=latest" -i hosts\n\n# ç¤ºä¾äºï¼ å®è£å½åææ°çapacheè½¯ä»¶ï¼éè¿epelå®è£\n$ ansible web -m yum -a "name=httpd state=present enablerepo=epel" -i hosts\n\n# ç¤ºä¾ä¸ï¼ éè¿å¬ç½urlå®è£rpmè½¯ä»¶\n$ ansible web -m yum -a "name=https://mirrors4.tuna.tsinghua.edu.cn/zabbix/zabbix/4.0/rhel/7/x86_64/zabbix-agent-4.0.0-2.el7.x86_64.rpm state=present" -i hosts\n\n# ç¤ºä¾åï¼æ´æ°ææçè½¯ä»¶åï¼ä½æé¤åkernelç¸å³ç\n$ ansible web -m yum -a "name="*" state=present exclude="kernel*" -i hosts\n\n# ç¤ºä¾äºï¼ å é¤apacheè½¯ä»¶\n$  ansible web -m yum -a "name=httpd state=absent" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# 5.2 copyæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ å°æ¬å°çhttpd.confæä»¶listen ç«¯å£ä¿®æ¹ä¸º9999ï¼ç¶åæ¨éå°è¿ç¨ä¸»æº\n$ sed -i \'s/listen 80/listen 9999/g\' httpd.conf\n$ ansible web -m copy -a "src=httpd.conf dest=/etc/httpd/conf/httpd.conf owner=root group=root mode-644" -i hosts\n\n# ç¤ºä¾äºï¼ å°æ¬å°çhttpd.confæä»¶listenç«¯å£ä¿®æ¹ä¸º9988ï¼ç¶åæ¨éå°è¿ç«¯ï¼æ£æ¥è¿ç«¯æ¯å¦å­å¨ä¸æ¬¡å¤ä»½çæä»¶\n$ sed -i \'s/listen 9999/listen 9988/g\' httpd.conf\n$ ansible web -m copy -a "src=httpd.conf dest=/etc/httpd/conf/httpd.conf owner=root group=root mode=644 backup=yes" -i hosts\n\n# ç¤ºä¾ä¸ï¼ å¾è¿ç¨çä¸»æºæä»¶åå¥åå®¹\n$ ansible web -m copy -a "content=123456........ dest=/var/www/html/index.html" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# 5.3 fileæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ åå»ºæä»¶ï¼å¹¶è®¾ç½®å±ä¸»ãå±ç»ãæé\n$ ansible web -m file -a "path=/var/www/html/t1.html state=touch owner=apache group=apache mode=644" -i hosts\n\n# ç¤ºä¾äºï¼ åå»ºç®å½ï¼å¹¶è®¾ç½®å±ä¸»ãå±ç»ãæé\n$ ansible web -m file -a "path=/var/www/html/dd state=directory owner=apache group=apache mode=755" -i hosts\n# ç¤ºä¾ä¸ï¼éå½ææç®å½çæ¹å¼\n$ ansible web -m file -a "path=/var/www/html state=directory owner=apache group=apache recurse=yes" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# 5.4 get_urlæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ ä¸è½½äºèç½çè½¯ä»¶å°æ¬å°\n$ ansible web -m get_url -a "url=http://192.168.99.181:12138/document/ansible.docx dest=/root/" -i hosts\n\n# ç¤ºä¾äºï¼ ä¸è½½äºèç½æä»¶å¹¶è¿è¡mdsæ ¡éª\n$ md5sum ansible.docx      # è·åæä»¶md5å¼\n7b1a6fe7af7252005987e16ce64e1e1a  ansible.docx\n$ ansible web -m get_url -a "url=http://192.168.99.181:12138/document/ansible.docx dest=/root/ checksum=md5:7b1a6fe7af7252005987e16ce64e1e1a" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# 5.5 serviceæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ å¯å¨httpdæå¡\n$ ansible web -m service -a "name=httpd state=started" -i hosts\n\n# ç¤ºä¾äºï¼ éè½½httpdæå¡\n$ ansible web -m service -a "name=httpd state=reloaded" -i hosts\n\n# ç¤ºä¾ä¸ï¼ éå¯httpdæå¡\n$ ansible web -m service -a "name=httpd state=restarted" -i hosts\n\n# ç¤ºä¾åï¼ åæ­¢httpdæå¡\n$ ansible web -m service -a "name=httpd state=stopped" -i hosts\n\n# ç¤ºä¾äºï¼ å¯å¨httpdæå¡ï¼å¹¶å å¥å¼æºèªå¯\n$ ansible web -m service -a "name=httpd state=started enabled=yes" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# 5.6 groupæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ åå»ºnewsåºæ¬ç»ï¼æå®gidä¸º9999\n$ ansible web -m group -a "name=news gid=9999 state=present"\n -i hosts\n\n# ç¤ºä¾äºï¼ åå»ºhttpç³»ç»ç»ï¼æå®gidä¸º8888\n$ ansible web -m group -a "name=http gid=8888  state=present\n system=yes" -i hosts\n\n# ç¤ºä¾ä¸ï¼ å é¤teståºæ¬ç»\n$ ansible web -m group -a "name=test state=absent" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# 5.7 useræ¨¡å\n\n# ç¤ºä¾ä¸ï¼ åå»ºjobç¨æ·ï¼uidæ¯1040ï¼ä¸»è¦ç»æ¯adm\n$ ansible web -m user -a "name=job uid=1040 group=adm" -i hosts\n\n# ç¤ºä¾äºï¼ åå»ºjohç¨æ·ï¼ç»å½shellæ¯/sbin/nologinï¼è¿½å binãsysä¸¤ä¸ªç»\n$ ansible web -m user -a "name=joh groups=bin,sys shell=/sbin/nologin" -i hosts\n\n# ç¤ºä¾ä¸ï¼ åå»ºjsmç¨æ·ï¼ä¸ºå¶æ·»å 123ä½ä¸ºç»å½å¯ç ï¼å¹¶åå»ºå®¶ç®å½\n$ ansible localhost -m debug -a "msg={{ \'123\' | password_hash(\'sha512\',\'salt\') }}"\n# è·å123å å¯åçå­ç¬¦ä¸²\n$6$salt$jkhso0tojmlw0s1nflw5vesidravsiqqmtrkoky4xdcclpnishhzkirlzfzivkyxegdofcbow1wjzplyq9qx/1\n\n$ ansible web -m user -a \'name=jsm password=$6$salt$jkhso0tojmlw0s1nflw5vesidravsiqqmtrkoky4xdcclpnishhzkirlzfzivkyxegdofcbow1wjzplyq9qx/1 create_home=yes\' -i hosts\n\n# ç¤ºä¾åï¼ ç§»é¤jobç¨æ·\n$ ansible web -m user -a "name=job state=absent remove=yes" -i hosts\n# remove=yeså é¤æ®éç¨æ·å®¶ç®å½\n\n# ç¤ºä¾äºï¼ åå»ºhttpç¨æ·ï¼å¹¶ä¸ºè¯¥ç¨æ·åå»º2048å­èçç§é¥ï¼å­æ¾å¨~/http/.ssh/id_rsa\n$ ansible web -m user -a "name=http generate_ssh_key=yes ssh_key_bits=2048 ssh_key_file=.ssh/id_rsa" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n# 5.8 cronæ¨¡å\n\n# ç¤ºä¾ä¸ï¼ æ·»å å®æ¶ä»»å¡ï¼æ¯åéæ§è¡ä¸æ¬¡ls\n$ ansible web -m cron -a "name=job1 job=\'ls > /dev/null\'" -i hosts\n\n# ç¤ºä¾äºï¼ æ·»å å®æ¶ä»»å¡ï¼æ¯å¤©çåæ¨2ç¹ååæ¨5ç¹æ§è¡ä¸æ¬¡ls\n$ ansible web -m cron -a "name=job2 job=\'ls > /dev/null\' minute=0 hour=2,5" -i hosts\n\n# ç¤ºä¾ä¸ï¼ å³é­å®æ¶ä»»å¡ï¼ä½¿å®æ¶ä»»å¡å¤±è´¥\n$ ansible web -m cron -a "name=job2 job=\'ls > /dev/null\' minute=0 hour=2,5 disabled=yes" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# 5.9 mount\n\n# ç¯å¢åå¤ï¼\n$ ansible localhost -m yum -a "name=nfs-utils state=present" \n$ ansible localhost -m file -a "path=/ops state=directory"\n$ ansible localhost -m copy -a \'content="/ops 192.168.100.1/24(rw,sync)" dest=/etc/exports\'\n$ ansible localhost -m service -a "name=nfs state=restarted"\n\n# ç¤ºä¾ä¸ï¼ æè½½nfså­å¨å°æ¬å°ç/optç®å½ï¼å¹¶å®ç°å¼æºèªå¨æè½½\n$ ansible web -m mount -a "src=192.168.99.181:/ops path=/opt fstype=nfs opts=defaults state=mounted" -i hosts\n\n# ç¤ºä¾äºï¼ ä¸´æ¶å¸è½½nfsçæè½½ï¼ä½ä¸ä¼æ¸ç/etc/fstab\n$ ansible web -m mount -a "src=192.168.99.181:/ops path=/opt fstype=nfs opts=defaults state=unmounted" -i hosts\n\n# ç¤ºä¾ä¸ï¼ æ°¸ä¹å¸è½½nsçæè½½ï¼æ¸ç/etc/fstab\n$ ansible web -m mount -a "src=192.168.99.181:/ops path=/opt fstype=nfs opts=defaults state=absent" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# 5.10 firewalld\n\n# ç¤ºä¾ä¸ï¼ æ°¸ä¹æ¾è¡httpsçæµéï¼åªæéå¯æçæ\n$ ansible web -m firewalld -a "zone=public service=https permanent=yes state=enabled" -i hosts\n\n# ç¤ºä¾äºï¼ æ°¸ä¹æ¾è¡8081ç«¯å£çæµéï¼åªæéå¯æçæ\n$ ansible web -m firewalld -a "zone=public port=8081/tcp permanent=yes state=enabled" -i hosts\n\n# ç¤ºä¾ä¸ï¼ æ¾è¡8080-8090çææçtcpç«¯å£æµéï¼ä¸´æ¶åæ°¸ä¹é½çæ\n$ ansible web -m firewalld -a "zone=public port=8080-8090/tcp immediate=yes permanent=yes state=enabled" -i hosts\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# å­ãansible playbook\n\n# 6.1 ä»ä¹æ¯playbook\n\n * playbookï¼å®ä¹äºä¸ä¸ªææ¬æä»¶ï¼ä»¥.ymlä¸ºåç¼ç»å°¾ï¼\n * playï¼å®ä¹çæ¯ä¸»æºçè§è²ï¼\n * taskï¼å®ä¹çæ¯å·ä½æ§è¡çä»»å¡ï¼\n\næ»ç»ï¼playbookæ¯ç±ä¸ä¸ªå¤ä¸ªå¤ä¸ªplayç»æï¼ä¸ä¸ªplayå¯ä»¥åå«å¤ä¸ªtaskä»»å¡ãå¯ä»¥çè§£ä¸ºï¼ä½¿ç¨ä¸åçæ¨¡åæ¥å±åå®æä¸ä»¶äºæï¼\n\n---\n#### 6.2 ansible playbookä¸ad-hocçå³ç³»\n\n\n * playbookæ¯å¯¹ad-hocçä¸ç§ç¼ææ¹å¼ï¼\n * playbookå¯ä»¥æä¹è¿è¡ï¼èad-hocåªè½ä¸´æ¶è¿è¡ï¼\n * playbookéåå¤æçä»»å¡ï¼èad-hocéååå¿«éç®åçä»»å¡ï¼\n * playbookè½æ§å¶ä»»å¡æ§è¡çååé¡ºåºï¼\n\n# 6.3 ansible playbookä¹¦åæ ¼å¼\n\nplaybookæ¯ç±yamlè¯­æ³ä¹¦åï¼ç»ææ¸æ°ãå¯è¯»æ§å¼ºãæä»¥å¿é¡»ææ¡yamlåºç¡è¯­æ³ï¼\n\nè¯­æ³    æ¦è¿°\nç¼©è¿    yamlä½¿ç¨åºå®çç¼©è¿é£æ ¼è¡¨ç¤ºå±çº§ç»æï¼æ¯ä¸ªç¼©è¿ç±ä¸¤ä¸ªç©ºæ ¼ç»æï¼ä¸è½ä½¿ç¨taé®\nåå·    ä»¥åå·ç»å°¾çé¤å¤ï¼å¶ä»ææåå·åé¢ææå¿é¡»æç©ºæ ¼\nç­æ¨ªçº¿   è¡¨ç¤ºåè¡¨é¡¹ï¼ä½¿ç¨ä¸ä¸ªç­æ¨ªæ å ä¸ä¸ªç©ºæ ¼ãå¤ä¸ªé¡¹ä½¿ç¨åæ ·çç¼©è¿çº§å«ä½ä¸ºç»ä¸åè¡¨\n\n\n# ä¸ãåé\n\n# 7.1 åéæ¦è¿°\n\nåéæä¾äºä¾¿æ·çæ¹å¼æ¥ç®¡çansibleé¡¹ç®ä¸­çå¨æå¼ï¼æ¯å¦ï¼nginx-1.12ï¼å¯è½åæä¼åå¤çä½¿ç¨è¿ä¸ªçæ¬çå¼ï¼é£ä¹å¦æå°æ­¤å¼è®¾ç½®ä¸ºåéï¼åç»­ä½¿ç¨åä¿®æ¹é½å°åå¾éå¸¸æ¹ä¾¿ãè¿æ ·å¯ä»¥ç®åé¡¹ç®çåå»ºåç»´æ¤ã\n\né£ä¹å¨ansibleä¸­å®ä¹åéåä¸ºä»¥ä¸ä¸ç§æ¹å¼ï¼\n\n * éè¿å½ä»¤è¡è¿è¡åéå®ä¹ï¼\n * å¨playæä»¶ä¸­è¿è¡å®ä¹åéï¼\n * éè¿inventoryå¨ä¸»æºç»æåä¸ªä¸»æºä¸­è®¾ç½®åéï¼\n\nå¦æå®ä¹çåéåºç°éå¤ï¼ä¸é æå²çªï¼æä¹åï¼è°è¯´äºç®ï¼\n\n# 7.2 åéå®ä¹\n\n1ãå¨playbookçæä»¶å¼å¤´éè¿varså³é®å­è¿è¡åéå®ä¹\n\n- hosts: web\n  vars:\n    - web_packages: httpd\n    - ftp_packages: vsftpd\n\n  tasks:\n    - name: install rpm packages "{{ web_packages }}" "{{ ftp_packages }}"\n      yum:\n        name:\n          - "{{ web_packages }}"\n          - "{{ ftp_packages }}"\n        state: present\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n2ãå¯ä»¥å¨playbookä¸­ä½¿ç¨vars_filesæå®æä»¶ä½ä¸ºåéæä»¶ï¼å¥½å¤å°±æ¯å¶ä»çplaybookä¹å¯ä»¥è°ç¨\n\n# 1ï¼åå¤ä¸ä¸ªåéçæä»¶ï¼å»ºè®®ä½¿ç¨ymlæ ¼å¼\n$ cat vars.yml\nweb_packages: httpd\nftp_packages: vsftpd\n\n# 2ï¼åå¤playbookè¿è¡è°ç¨\n$ cat test.yml\n- hosts: web\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: install rpm packages "{{ web_packages }}" "{{ ftp_packages }}"\n      yum:\n        name:\n          - "{{ web_packages }}"\n          - "{{ ftp_packages }}"\n        state: present\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n3ãå¨inventoryä¸»æºæ¸åä¸­å®ä¹åéï¼ä½æ¯æ³¨æï¼ä¸»æºåéä¼åçº§é«äºä¸»æºç»åé\n\n# 1ï¼å¨inventoryä¸»æºæ¸åä¸­å¯¹ä¸»æºç»è¿è¡å®ä¹åé\n$ cat hosts\n[web]\n192.168.100.225\n192.168.100.226\n\n[web:vars]\nfilename=group_vars\n\n# 2ï¼playbookä¸­ç´æ¥è°ç¨åé\n$ cat test.yml\n- hosts: web\n  tasks:\n    - name: create file\n      file:\n        name: /tmp/{{ filename}}\n        state: touch\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n4ãå®æ¹å»ºè®®æ¯å¨ansibleé¡¹ç®ç®å½ä¸­åå»ºä¸¤ä¸ªé¢å¤çåéç®å½ï¼åå«æ¯host_varsågroup_vars\n\n * æµè¯group_varså®ä¹åéæ¹å¼\n\n$ cat hosts\n[web]\n192.168.100.225\n192.168.100.226\n\n# 1ï¼å¨å½åçé¡¹ç®ç®å½ä¸­åå»ºä¸¤ä¸ªåéçç®å½\n$ mkdir {group,host}_vars\n\n# 2ï¼å¨group_varsç®å½ä¸­åå»ºä¸ä¸ªæä»¶ï¼æä»¶åä¸inventoryæ¸åä¸­çä¸»æºç»åç§°è¦ä¿æä¸è´\n$ cat group_vars/web\nweb_packages: wget\nftp_packages: tree\n\n# 3ï¼ç¼åplaybookï¼åªéå¨playbookä¸­ä½¿ç¨åéå³å¯\n$ cat test.yml\n- hosts: web\n  tasks:\n    - name: install rpm packages "{{ web_packages }}" "{{ ftp_packages }}"\n      yum:\n        name:\n          - "{{ web_packages }}"\n          - "{{ ftp_packages }}"\n        state: present\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næµè¯testç»è½å¦ä½¿ç¨webç»å®ä¹çåéï¼æ æ³ä½¿ç¨ï¼ä½æ¯ç³»ç»æä¾äºç¹æ®çallç»ï¼ä¹å°±æ¯è¯´group_varsç®å½ä¸åå»ºä¸ä¸ªallæä»¶ï¼å®ä¹åéå¯¹ææçä¸»æºé½çæï¼\n\n * æµè¯host_varså®ä¹åéæ¹å¼\n\n# 1ï¼å¨host_varsç®å½åå»ºä¸ä¸ªæä»¶ï¼æä»¶åä¸inventoryæ¸åä¸­çä¸»æºåç§°è¦ä¿æä¸è´ï¼å¦ææ¯ipå°åï¼ååå»ºç¸åçip\n$ cat hosts\n[web]\n192.168.100.225\n192.168.100.226\n\n# 2ï¼å¨host_varsç®å½ä¸­åå»ºæä»¶ï¼ç»192.168.100.225ä¸»æºå®ä¹åé\n$ cat host_vars/192.168.100.225\nweb_packages: zlib-static\nftp_packages: zmap\n\n# 3ï¼è½¬å«ä¸ä¸ªplaybookæä»¶è°ç¨hostä¸»æºåé\n$ cat test.yml\n- hosts: 192.168.100.225\n  tasks:\n    - name: install rpm packages "{{ web_packages }}" "{{ ftp_packages }}"\n      yum:\n        name:\n          - "{{ web_packages }}"\n          - "{{ ftp_packages }}"\n        state: present\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n5ãéè¿å½ä»¤è¡-extra-varsæ-eå¤ç½®ç©¿é¤è®¾å®åé\n\n# 1ï¼åå¤playbookæä»¶\n$ cat test.yml\n- hosts: "{{ host }}"\n  tasks:\n    - name: install rpm packages "{{ web_packages }}" "{{ ftp_packages }}"\n      yum:\n        name:\n          - "{{ web_packages }}"\n          - "{{ ftp_packages }}"\n        state: present\n\n# 2ï¼æ§è¡playbookæ¶è¿è¡åéçä¼ é\n$ ansible-playbook -i hosts test.yml -e "host=web"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n6ãåéçä¼åçº§é¡ºåºï¼\n\nå½ä»¤è¡åéââ>palyä¸­çvars_filesââ>palyä¸­çvarsââ>host_varsââ>group_vars/all\n\n# 7.3 åéæ³¨å\n\nregisterå³é®å­å¯ä»¥å°æä¸ªtaskä»»å¡ç»æå­å¨è³åéä¸­ï¼æåä½¿ç¨debugè¾åºåéåå®¹ï¼å¯ä»¥ç¨äºåç»­ææ¥æéï¼\n\n- hosts: all\n  tasks:\n    - name: system status\n      shell: netstat -lntp\n      register: system_status\n\n    - name: system status\n      debug: msg="{{ system_status.stdout_lines }}"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# 7.4 factsåé\n\nansible factsæ¯å¨è¢«ç®¡çä¸»æºä¸éè¿ansibleèªå¨ééåç°çåéãfactsåå«æ¯å°ç¹å®çä¸»æºä¿¡æ¯ãæ¯å¦ï¼è¢«æ§ç«¯ä¸»æºçä¸»æºåãipå°åãç³»ç»çæ¬ãcpuæ°éãåå­ç¶æãç£çç¶æç­ç­ã\n\né»è®¤æåµçfactsåéåé½å·²ç»é¢åå®ä¹å¥½äºï¼åªéè¦ééè¢«æ§ç«¯çä¿¡æ¯ï¼ç¶åä¼ éè³factsåéå³å¯ï¼\n\n $ ansible web -m setup -i hosts > facts.txt\n # è·åææçfactsåé\n\n\n1\n2\n\n\nfactsåéä½¿ç¨åºæ¯ï¼\n\n * éè¿factsåéæ£æ¥è¢«æ§ç«¯ä¸»æºç¡¬ä»¶cpuä¿¡æ¯ï¼ä»èçæä¸åçnginxéç½®æä»¶ï¼\n\n * éè¿factsåéæ£æ¥è¢«æ§ç«¯ä¸»æºåç§°ä¿¡æ¯ï¼ä»èçæä¸åçzabbixéç½®æä»¶ï¼\n\n * éè¿factsåéæ£æ¥è¢«æ§ç«¯ä¸»æºåå­ç¶æä¿¡æ¯ï¼ä»èçæä¸åçmemcachedéç½®æä»¶ï¼\n   \n   â¦â¦â¦â¦â¦â¦\n\n1ãfactsåºæ¬ç¨æ³ï¼æ¯å¦è·åè¢«æ§ç«¯çä¸»æºååipå°åï¼ç¶åéè¿debugè¾åº\n\n- hosts: all\n  tasks:\n    - name: output variables ansible facts\n      debug:\n        msg: this default ipv4 address "{{ ansible_fqdn }}" is "{{ ansible_default_ipv4.address }}"\n\n\n1\n2\n3\n4\n5\n\n\n2ãfactså¼å¯åä¼å½±åansibleä¸»æºçæ§è½ï¼å¦ææ²¡æééè¢«æ§ç«¯ä¸»æºéæ±å¯éæ©å³é­\n\n- hosts: web\n  gather_facts: no    # å³é­ä¿¡æ¯éé\n\n\n1\n2\n\n\n\n# å«ãansible task ä»»å¡æ§å¶\n\n# 8.1 piaybookæ¡ä»¶è¯­å¥\n\nå¤æ­å¨ansibleä»»å¡ä¸­çä½¿ç¨é¢çéå¸¸é«ï¼æ¯å¦yumæ¨¡åå¯ä»¥æ£æµè½¯ä»¶åæ¯å¦å·²ç»è¢«å®è£ï¼èå¨è¿ä¸ªè¿ç¨ä¸­æä»¬ä¸ç¨åå¤ªå¤çäººå·¥å¹²é¢ãä½æ¯ä¹æé¨åä»»å¡éè¦è¿è¡å¤æ­ã\n\n# æ¡ä¾ä¸ï¼æ ¹æ®ä¸åæä½ç³»ç»ï¼å®è£ç¸åçè½¯ä»¶å\n\n- hosts: web\n  tasks:\n    - name: centos install httpd\n      yum:\n        name: httpd\n        state: present\n      when: ( ansible_distribution == "centos" )\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# æ¡ä¾äºï¼ä¸ºææwebä¸»æºåçæ·»å nginxä»åºï¼å¶ä½çé½è·³è¿æ·»å \n\n- hosts: all\n  tasks:\n    - name: create yum repo\n      yum_repository:\n        name: ansible_nginx\n        description: ansible_test\n        baseurl: http://nginx.org/packages/centos/$releasever/$basearch/\n        enabled: yes\n        gpgcheck: no\n      when: ( ansible_fqdn is match("web*") )\n\n# å½ç¶whenä¹å¯ä»¥ä½¿ç¨andä¸oræ¹å¼\n# whenï¼ ( ansible_fqdn is match("web*") ) or\n#         ( ansible_fqdn is match("lb*") )\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# æ¡ä¾ä¸ï¼æ ¹æ®å½ä»¤æ§è¡çç»æè¿è¡å¤æ­\n\néè¿registerå°å½ä»¤æ§è¡ç»æä¿å­è³åéï¼ç¶åéè¿whenè¯­å¥è¿è¡å¤æ­\n\n- hosts: all\n  tasks:\n    - name: check httpd server\n      command: systemctl is-active httpd\n      ignore_errors: yes        # å¿½ç¥éè¯¯\n      register: check_httpd\n\n    - name: httpd restart        # å¦æcheck_httpdæ§è¡å½ä»¤ç»æç­äº0ï¼åéå¯httpd,å¦åè·³è¿\n      service:\n        name: httpd\n        state: restarted\n      when: check_httpd.rc == 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n# 8.2 playbookå¾ªç¯è¯­å¥\n\nææ¶åæä»¬åplaybookçæ¶åä¼åç°äºå¾å¤taské½è¦éå¤å¼ç¨æä¸ªæ¨¡åï¼æ¯å¦ä¸æ¬¡å¯å¨10ä¸ªæå¡ï¼æèä¸ä¸ªæ·è´10ä¸ªæä»¶ãå¦æå®è£ä¼ ç»çåæ³æå°è¦å10æ¬¡ï¼è¿æ ·ä¼æ¾å¾playbookå¾èè¿ãå¦æä½¿ç¨å¾ªç¯çæ¹å¼æ¥ç¼åplaybokkï¼è¿æ ·å¯ä»¥åå°éå¤ä½¿ç¨æä¸ªæ¨¡åï¼\n\n# æ¡ä¾ä¸ï¼ ä½¿ç¨å¾ªç¯å¯å¨å¤ä¸ªæå¡\n\n- hosts: all\n  tasks:\n    - name: service start\n      service: \n        name: "{{ item }}"\n        state: started\n      with_items:\n        - httpd\n        - sshd\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# æ¡ä¾äºï¼ ä½¿ç¨å­å¸æ¹éåå»ºç¨æ·\n\n- hosts: all\n  tasks:\n    - name: add users\n      user: \n        name: "{{ item.name }}"\n        group: "{{item.group }}"\n        state: present\n      with_items:\n        - { name: \'test01\',group: \'bin\' }\n        - { name: \'test02\',group: \'root\' }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# æ¡ä¾ä¸ï¼ ä½¿ç¨åéå­å¸å¾ªç¯çæ¹å¼æ·è´æä»¶\n\n- hosts: all\n  tasks:\n    - name: copy file\n      copy:\n        src: "{{ item.src }}"\n        dest: "{{ item.dest }}"\n        mode: "{{ item.mode }}"\n      with_items:\n        - { src: \'rsync.conf\' , dest: \'/tmp/rsync.conf\' , mode: 644 }\n        - { src: \'rsync.pass\' , dest: \'/tmp/rsync.pass\' , mode: 600 }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\né«çº§åæ³(åéå¥åé)ï¼\n\n- hosts: all\n  vars:\n    - path: /tmp\n  tasks:\n    - name: copy file\n      copy:\n        src: "{{ item.src }}"\n        dest: "{{ item.dest }}"\n        mode: "{{ item.mode }}"\n      with_items:\n        - { src: \'rsync.conf\' , dest: \'{{ path }}/rsync.conf\' , mode: 644 }\n        - { src: \'rsync.pass\' , dest: \'{{ path }}/rsync.pass\' , mode: 600 }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n# 8.3 playbook handlers\n\nhandlersæ¯ä¸ä¸ªè§¦åå¨ï¼ä¹æ¯ä¸ä¸ªtasksï¼åªä¸è¿æ¯ä¸ä¸ªç¹æ®çtasksï¼å®æ¯éè¦è¢«tasksè§¦åæä¼æ§è¡ãåªè¦éç½®æä»¶åçåæ´ï¼åä¼è§¦åhandlersæ§è¡éå¯æå¡æä½ï¼å¦æéç½®æä»¶ä¸åçä»»ä½ååï¼åä¸ä¼éå¯ï¼ notifyçæ§ââ>éç¥ââ>handlersè§¦å\n\n# æ¡ä¾ï¼playbookå®è£nginx\n\n- hosts: web\n  tasks:\n  - name: instll nginx\n    yum: \n      name: nginx\n      state: present\n\n  - name: copy nignx.conf\n    template:\n      src: nginx.conf.j2\n      dest: /etc/nginx/nginx.conf\n    notify: restart nignx service\n\n  handlers:\n    - name: restart nignx service\n      service:\n        name: nginx\n        state: restarted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nhandlersæ³¨æäºé¡¹ï¼\n\n * æ è®ºå¤å°ä¸ªtaskéç¥ç¸åçhandlersï¼handlersä»ä¼å¨æætaskç»æåæ§è¡ä¸æ¬¡ï¼\n * åªætaskåçåååæä¼éç¥handlersï¼æ²¡ææ¹ååä¸ä¼è§¦åhandlersï¼\n * ä¸è½ä½¿ç¨handlersä»£æ¿taskï¼å ä¸ºhandlersæ¯ä¸ä¸ªç¹æ®çtaskï¼\n\n# 8.4 playbook tag\n\né»è®¤æåµä¸ï¼ansibleå¨æ§è¡ä¸ä¸ªplaybookæ¶ï¼ä¼æ§è¡playbookä¸­çå®ä¹çææä»»å¡ãansibleçæ ç­¾ï¼tagsï¼åè½å¯ä»¥ç»åç¬ä»»å¡çè³æ´ä¸ªplaybookæä¸tagæ ç­¾ï¼ç¶åå©ç¨tagæ ç­¾æå®è¦è¿è¡çä¸ªå«ä»»å¡ï¼æè·³è¿ä¸ªå«çä»»å¡ï¼\n\n# æ¡ä¾ï¼\n\n- hosts: web\n  tasks:\n  - name: instll nginx\n    yum: \n      name: nginx\n      state: present\n    tags: install nginx            # æ·»å tagæ ç­¾\n\n  - name: copy nignx.conf\n    template:\n      src: nginx.conf.j2\n      dest: /etc/nginx/nginx.conf\n    notify: restart nignx service\n\n  - name: start nginx \n    service:\n      name: nginx\n      state: started\n    tags: start nginx          # æ·»å tagæ ç­¾\n\n  handlers:\n    - name: restart nignx service\n      service:\n        name: nginx\n        state: restarted\n$ ansible-playbook -i hosts test.yml  -t \'install nginx\'\n# ä»ä»æ§è¡playbookä¸­çæä¸ªtagæ ç­¾\n\n$ $ ansible-playbook -i hosts test.yml  --skip-tags \'install nginx\'\n# è·³è¿playbookä¸­çç¹å®çtagæ ç­¾\n\n$ ansible-playbook -i hosts test.yml  -t \'install nginx\' -t \'start nginx\'\n# æå®å¤ä¸ªtagæ ç­¾\n\n$ ansible-playbook -i hosts test.yml  --skip-tags \'install nginx\' --skip-tags \'start nginx\'\n# è·³è¿å¤ä¸ªtagæ ç­¾\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\n# 8.5 playbook include\n\nææ¶åç°å¤§éçplaybookåå®¹è¦éå¤ç¼åï¼ä¸tasksä¹é´è´¡å¢éç¸äºè°ç¨æè½å®æåèªè´¡å¢ãplaybookåºå¤§å°ç»´æ¤å°é¾ï¼è¿æ¯å°±éè¦ä½¿ç¨includeï¼\n\n# æ¡ä¾ï¼\n\n$ cat restart_httpd.yml \n- name: restart httpd service\n  service:\n    name: httpd\n    state: restarted\n\n\n1\n2\n3\n4\n5\n\n\na projectçyamlæä»¶ï¼\n\n- hosts: web\n  tasks:\n    - name: a project command\n      command: echo "a"\n    - name: restart httpd\n      include: restart_httpd.yml\n\n\n1\n2\n3\n4\n5\n6\n\n\na projectçyamlæä»¶ï¼\n\n- hosts: web\n  tasks:\n    - name: b project command\n      command: echo "b"\n    - name: restart httpd\n      include: restart_httpd.yml\n\n\n1\n2\n3\n4\n5\n6\n\n\né«çº§ç¨æ³ï¼\n\nä¸æ¬¡æ§è¡çå¤ä¸ªplaybookæä»¶ï¼\n\n$ cat tasks_total.yml \n- import_playbook: test.yml\n- import_playbook: test01.yml\n\n$ ansible-playbook -i hosts  tasks_total.yml\n\n\n1\n2\n3\n4\n5\n\n\n# 8.6 ignore_errorså¿½ç¥éè¯¯\n\n- hosts: web\n  tasks:\n    - name: command\n      command: /bin/false\n      ignore_errors: yes\n\n    - name: create file\n      file:\n        path: /tmp/file\n        state: touch\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# 8.7 playbookéè¯¯å¤ç\n\néå¸¸æåµä¸ï¼å½taskå¤±è´¥åï¼playå°ä¼ç»æ­¢ï¼ä»»ä½å¨åé¢å·²ç»è¢«tasks notifyçhandlersé½ä¸ä¼è¢«æ§è¡ãå¦æå¨playä¸­è®¾ç½®force_handlersï¼è¢«éç¥çhandlerså°±ä¼è¢«å¼ºå¶æ§è¡ã\n\n# æ¡ä¾ä¸ï¼taskæ§è¡å¤±è´¥å¼ºå¶è°ç¨handlers\n\n- hosts: web\n  force_handlers: yes     # å¼ºå¶è°ç¨handlers\n\n  tasks:\n    - name: touch file\n      file:\n        path: /tmp/test\n        state: touch\n      notify: restart httpd service\n\n    - name: install packages\n      yum: \n        name: sb\n        state: present\n\n  handlers:\n    - name: restart httpd service\n      service:\n        name: httpd\n        state: restarted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# æ¡ä¾äºï¼ å³é­changeçç¶æï¼ç¡®å®ä¸ä¼å¯¹è¢«æ§ç«¯ä¸»æºè¿è¡ä»»ä½çä¿®æ¹ååæ´ï¼\n\n- hosts: web\n  tasks:\n    - name: install httpd server\n      yum: \n        name: httpd\n        state: present\n    - name: service httpd started\n      service:\n        name: httpd\n        state: started\n    - name: check httpd server\n      shell: ps aux | grep httpd\n      register: check_httpd\n      changed_when: false\n    - name: output variables\n      debug:\n        msg: "{{ check_httpd.stdout_lines }}"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n# æ¡ä¾ä¸ï¼ ä½¿ç¨changed_whenæ£æ¥tasksrreä»»å¡è¿åç»æ\n\n- hosts: web\n  tasks:\n    - name: configure nginx server\n      template:\n        src: nginx.conf.j2\n        dest: /etc/nginx/nginx.conf\n      notify: restart nginx server\n\n    - name: check httpd\n      shell: /usr/sbin/nginx -t\n      register: nginx_check\n      changed_when:\n        - (nginx_check.stdout.find(\'successful\'))\n        - false\n\n    - name: start httpd server\n      service:\n        name: nginx\n        state: started\n        enabled: yes\n\n    - handlers: restart httpd server\n      service:\n        name: nginx\n        state: restarted\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n',charsets:{cjk:!0}},{title:"anisbleæ¹éå®è£node_exporter",frontmatter:{title:"anisbleæ¹éå®è£node_exporter",categories:["ç³»åä¸é¢","ansible"],tags:["ansible"],date:"2022-12-09T20:53:14.000Z",permalink:"/pages/f8f66c/",readingShow:"top",description:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14374243.html",meta:[{name:"twitter:title",content:"anisbleæ¹éå®è£node_exporter"},{name:"twitter:description",content:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14374243.html"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/02.anisble%E6%89%B9%E9%87%8F%E5%AE%89%E8%A3%85node_exporter.html"},{property:"og:type",content:"article"},{property:"og:title",content:"anisbleæ¹éå®è£node_exporter"},{property:"og:description",content:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14374243.html"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/02.anisble%E6%89%B9%E9%87%8F%E5%AE%89%E8%A3%85node_exporter.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:53:14.000Z"},{property:"article:tag",content:"ansible"},{itemprop:"name",content:"anisbleæ¹éå®è£node_exporter"},{itemprop:"description",content:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14374243.html"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/02.anisble%E6%89%B9%E9%87%8F%E5%AE%89%E8%A3%85node_exporter.html",relativePath:"01.ä¸é¢/01.ansibleç³»åæç« /02.anisbleæ¹éå®è£node_exporter.md",key:"v-3a928a43",path:"/pages/f8f66c/",headers:[{level:3,title:"ä¸ãç®å½ç»æ",slug:"ä¸ãç®å½ç»æ",normalizedTitle:"ä¸ãç®å½ç»æ",charIndex:94},{level:3,title:"äºãplaybookæä»¶",slug:"äºãplaybookæä»¶",normalizedTitle:"äºãplaybookæä»¶",charIndex:104},{level:3,title:"ä¸ãæå¡æä»¶",slug:"ä¸ãæå¡æä»¶",normalizedTitle:"ä¸ãæå¡æä»¶",charIndex:120},{level:3,title:"åãä»»å¡æä»¶",slug:"åãä»»å¡æä»¶",normalizedTitle:"åãä»»å¡æä»¶",charIndex:130}],headersStr:"ä¸ãç®å½ç»æ äºãplaybookæä»¶ ä¸ãæå¡æä»¶ åãä»»å¡æä»¶",content:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14374243.html\n\n\n# anisbleæ¹éå®è£node_exporter\n\nç®å½\n\n * ä¸ãç®å½ç»æ\n * äºãplaybookæä»¶\n * ä¸ãæå¡æä»¶\n * åãä»»å¡æä»¶\n\n\n# ä¸ãç®å½ç»æ\n\n$ tree .\n.\n|-- hosts\n|-- node_exporter\n|   |-- files\n|   |   |-- node_exporter-1.0.1.linux-amd64.tar.gz\n|   |   `-- node_exporter.service\n|   `-- tasks\n|       `-- main.yml\n`-- node_exporter.yml\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# äºãplaybookæä»¶\n\n$ cat node_exporter.yml \n#!/usr/bin/env ansible-playbook\n- hosts: all\n  remote_user: root\n  gather_facts: false\n  roles:\n  - role: node_exporter\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# ä¸ãæå¡æä»¶\n\n$ cat node_exporter/files/node_exporter.service \n[Unit]\nDescription=Prometheus node_exporter\nRequires=network.target remote-fs.target\nAfter=network.target remote-fs.target\n\n[Service]\nType=simple\nUser=root\nGroup=root\nExecStart=/usr/local/node_exporter/node_exporter --web.listen-address=0.0.0.0:9100\nExecReload=/bin/kill -HUP $MAINPID\nKillMode=process\nRestart=on-failure\nRestartSec=5s\n\n[Install]\nWantedBy=multi-user.target\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# åãä»»å¡æä»¶\n\n$ cat node_exporter/tasks/main.yml \n- name: å®è£node_exporter\n  unarchive: \n    src: node_exporter-1.0.1.linux-amd64.tar.gz\n    dest: /usr/local/\n\n- name: åå»ºè½¯é¾æ¥\n  file:\n    src: /usr/local/node_exporter-1.0.1.linux-amd64\n    dest: /usr/local/node_exporter\n    state: link\n\n- name: æ·»å node_exporteræå¡\n  copy: \n    src: node_exporter.service\n    dest: /usr/lib/systemd/system/\n\n- name: daemon-reload\n  systemd: \n    daemon_reload: yes\n\n- name: è®¾ç½®å¼æºèªå¨å¯å¨\n  systemd: \n    name: node_exporter\n    state: started\n    enabled: True\n\n- name: ç¡®å®ç«¯å£å¨çå¬\n  wait_for:\n    host: 0.0.0.0\n    port: 9100\n    delay: 2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n*************** å½ä½ åç°èªå·±çæåæä¸èµ·éå¿æ¶ï¼å°±è¯·å®éä¸æ¥å­¦ä¹ å§ï¼***************",normalizedContent:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14374243.html\n\n\n# anisbleæ¹éå®è£node_exporter\n\nç®å½\n\n * ä¸ãç®å½ç»æ\n * äºãplaybookæä»¶\n * ä¸ãæå¡æä»¶\n * åãä»»å¡æä»¶\n\n\n# ä¸ãç®å½ç»æ\n\n$ tree .\n.\n|-- hosts\n|-- node_exporter\n|   |-- files\n|   |   |-- node_exporter-1.0.1.linux-amd64.tar.gz\n|   |   `-- node_exporter.service\n|   `-- tasks\n|       `-- main.yml\n`-- node_exporter.yml\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# äºãplaybookæä»¶\n\n$ cat node_exporter.yml \n#!/usr/bin/env ansible-playbook\n- hosts: all\n  remote_user: root\n  gather_facts: false\n  roles:\n  - role: node_exporter\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# ä¸ãæå¡æä»¶\n\n$ cat node_exporter/files/node_exporter.service \n[unit]\ndescription=prometheus node_exporter\nrequires=network.target remote-fs.target\nafter=network.target remote-fs.target\n\n[service]\ntype=simple\nuser=root\ngroup=root\nexecstart=/usr/local/node_exporter/node_exporter --web.listen-address=0.0.0.0:9100\nexecreload=/bin/kill -hup $mainpid\nkillmode=process\nrestart=on-failure\nrestartsec=5s\n\n[install]\nwantedby=multi-user.target\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# åãä»»å¡æä»¶\n\n$ cat node_exporter/tasks/main.yml \n- name: å®è£node_exporter\n  unarchive: \n    src: node_exporter-1.0.1.linux-amd64.tar.gz\n    dest: /usr/local/\n\n- name: åå»ºè½¯é¾æ¥\n  file:\n    src: /usr/local/node_exporter-1.0.1.linux-amd64\n    dest: /usr/local/node_exporter\n    state: link\n\n- name: æ·»å node_exporteræå¡\n  copy: \n    src: node_exporter.service\n    dest: /usr/lib/systemd/system/\n\n- name: daemon-reload\n  systemd: \n    daemon_reload: yes\n\n- name: è®¾ç½®å¼æºèªå¨å¯å¨\n  systemd: \n    name: node_exporter\n    state: started\n    enabled: true\n\n- name: ç¡®å®ç«¯å£å¨çå¬\n  wait_for:\n    host: 0.0.0.0\n    port: 9100\n    delay: 2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n*************** å½ä½ åç°èªå·±çæåæä¸èµ·éå¿æ¶ï¼å°±è¯·å®éä¸æ¥å­¦ä¹ å§ï¼***************",charsets:{cjk:!0}},{title:"ansible-playbookä¸­çåé",frontmatter:{title:"ansible-playbookä¸­çåé",categories:["ç³»åä¸é¢","ansible"],tags:["ansible"],date:"2022-12-09T20:53:14.000Z",permalink:"/pages/d740bc/",readingShow:"top",description:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14385777.html",meta:[{name:"twitter:title",content:"ansible-playbookä¸­çåé"},{name:"twitter:description",content:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14385777.html"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/03.ansible-playbook%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ansible-playbookä¸­çåé"},{property:"og:description",content:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14385777.html"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/03.ansible-playbook%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:53:14.000Z"},{property:"article:tag",content:"ansible"},{itemprop:"name",content:"ansible-playbookä¸­çåé"},{itemprop:"description",content:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14385777.html"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/03.ansible-playbook%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F.html",relativePath:"01.ä¸é¢/01.ansibleç³»åæç« /03.ansible-playbookä¸­çåé.md",key:"v-6bdef9fc",path:"/pages/d740bc/",headers:[{level:3,title:"ä¸ãåéçä¼åçº§",slug:"ä¸ãåéçä¼åçº§",normalizedTitle:"ä¸ãåéçä¼åçº§",charIndex:90},{level:4,title:"1.1 YAMLé·é±",slug:"_1-1-yamlé·é±",normalizedTitle:"1.1 yamlé·é±",charIndex:104},{level:3,title:"äºã Ansbile-playbookåééç½®æ¹æ³",slug:"äºã-ansbile-playbookåééç½®æ¹æ³",normalizedTitle:"äºã ansbile-playbookåééç½®æ¹æ³",charIndex:118},{level:4,title:"2.1 å¨inventoryä¸»æºæ¸åæä»¶ä¸­å®ä¹åé",slug:"_2-1-å¨inventoryä¸»æºæ¸åæä»¶ä¸­å®ä¹åé",normalizedTitle:"2.1 å¨inventoryä¸»æºæ¸åæä»¶ä¸­å®ä¹åé",charIndex:149},{level:4,title:"2.2 éè¿hostvarsågroupvarsç®å½æ¥å®ä¹åé",slug:"_2-2-éè¿host-varsågroup-varsç®å½æ¥å®ä¹åé",normalizedTitle:"2.2 éè¿hostvarsågroupvarsç®å½æ¥å®ä¹åé",charIndex:null},{level:4,title:"2.3 éè¿var_fileså®ä¹åé",slug:"_2-3-éè¿var-fileså®ä¹åé",normalizedTitle:"2.3 éè¿var_fileså®ä¹åé",charIndex:219},{level:4,title:"2.4 éè¿vars_promptäº¤äºå¼ä¼ å¥åé",slug:"_2-4-éè¿vars-promptäº¤äºå¼ä¼ å¥åé",normalizedTitle:"2.4 éè¿vars_promptäº¤äºå¼ä¼ å¥åé",charIndex:244},{level:4,title:"2.5 éè¿ansible-playbookå½ä»¤è¡å®ä¹åéï¼å³åæ°ä¼ å¥åé",slug:"_2-5-éè¿ansible-playbookå½ä»¤è¡å®ä¹åé-å³åæ°ä¼ å¥åé",normalizedTitle:"2.5 éè¿ansible-playbookå½ä»¤è¡å®ä¹åéï¼å³åæ°ä¼ å¥åé",charIndex:274},{level:4,title:"2.6 å¨playbookå§æ¬ä¸­å®ä¹åé",slug:"_2-6-å¨playbookå§æ¬ä¸­å®ä¹åé",normalizedTitle:"2.6 å¨playbookå§æ¬ä¸­å®ä¹åé",charIndex:317},{level:4,title:"2.7 éè¿rolesè§è²å®ä¹åé",slug:"_2-7-éè¿rolesè§è²å®ä¹åé",normalizedTitle:"2.7 éè¿rolesè§è²å®ä¹åé",charIndex:343},{level:4,title:"2.8 ä½¿ç¨Factsè·åçä¿¡æ¯",slug:"_2-8-ä½¿ç¨factsè·åçä¿¡æ¯",normalizedTitle:"2.8 ä½¿ç¨factsè·åçä¿¡æ¯",charIndex:366},{level:4,title:"2.9 registeræ³¨ååé",slug:"_2-9-registeræ³¨ååé",normalizedTitle:"2.9 registeræ³¨ååé",charIndex:388},{level:4,title:"2.10 hostvars åé",slug:"_2-10-hostvars-åé",normalizedTitle:"2.10 hostvars åé",charIndex:410},{level:4,title:"2.11 åè¡¨åéãå¾ªç¯åéãå­å¸åé",slug:"_2-11-åè¡¨åéãå¾ªç¯åéãå­å¸åé",normalizedTitle:"2.11 åè¡¨åéãå¾ªç¯åéãå­å¸åé",charIndex:432}],headersStr:"ä¸ãåéçä¼åçº§ 1.1 YAMLé·é± äºã Ansbile-playbookåééç½®æ¹æ³ 2.1 å¨inventoryä¸»æºæ¸åæä»¶ä¸­å®ä¹åé 2.2 éè¿hostvarsågroupvarsç®å½æ¥å®ä¹åé 2.3 éè¿var_fileså®ä¹åé 2.4 éè¿vars_promptäº¤äºå¼ä¼ å¥åé 2.5 éè¿ansible-playbookå½ä»¤è¡å®ä¹åéï¼å³åæ°ä¼ å¥åé 2.6 å¨playbookå§æ¬ä¸­å®ä¹åé 2.7 éè¿rolesè§è²å®ä¹åé 2.8 ä½¿ç¨Factsè·åçä¿¡æ¯ 2.9 registeræ³¨ååé 2.10 hostvars åé 2.11 åè¡¨åéãå¾ªç¯åéãå­å¸åé",content:'åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14385777.html\n\n\n# ansible playbookä¸­çåé\n\nç®å½\n\n * ä¸ãåéçä¼åçº§\n   * 1.1 YAMLé·é±\n * äºã Ansbile-playbookåééç½®æ¹æ³\n   * 2.1 å¨inventoryä¸»æºæ¸åæä»¶ä¸­å®ä¹åé\n   * 2.2 éè¿host_varsågroup_varsç®å½æ¥å®ä¹åé\n   * 2.3 éè¿var_fileså®ä¹åé\n   * 2.4 éè¿vars_promptäº¤äºå¼ä¼ å¥åé\n   * 2.5 éè¿ansible-playbookå½ä»¤è¡å®ä¹åéï¼å³åæ°ä¼ å¥åé\n   * 2.6 å¨playbookå§æ¬ä¸­å®ä¹åé\n   * 2.7 éè¿rolesè§è²å®ä¹åé\n   * 2.8 ä½¿ç¨Factsè·åçä¿¡æ¯\n   * 2.9 registeræ³¨ååé\n   * 2.10 hostvars åé\n   * 2.11 åè¡¨åéãå¾ªç¯åéãå­å¸åé\n\n\n# ä¸ãåéçä¼åçº§\n\n * extra varsåéï¼å¨å½ä»¤è¡ä¸­ä½¿ç¨ -eï¼ï¼ä¼åçº§æé«ï¼\n * å¨inventoryä¸­å®ä¹çè¿æ¥åéï¼æ¯å¦ansible_ssh_userï¼ï¼ä¼åçº§ç¬¬äºï¼\n * å¤§å¤æ°çå¶ä»åéï¼å½ä»¤è¡è½¬æ¢ï¼playä¸­çåéï¼includeçåéï¼roleçåéç­ï¼ï¼ä¼åçº§ç¬¬ä¸ï¼\n * å¨inventoryå®ä¹çå¶ä»åéï¼ä¼åçº§ç¬¬åï¼\n * æç³»ç»åç°çfactsï¼ä¼åçº§ç¬¬äºï¼\n * "roleé»è®¤åé"ï¼è¿ä¸ªæ¯æé»è®¤çå¼ï¼å¾å®¹æä¸§å¤±ä¼åæãä¼åçº§æå°ï¼\n\nå¦å¤ï¼å¨inventoryæ¸ååè¡¨éå®ä¹çåéï¼åä¸ªä¸»æºå®ä¹çåéä¼åçº§é«äºä¸»æºç»å®ä¹çåé ç»è¿å®éªï¼ansibleä½¿ç¨inventoryå®ä¹åéçä¼åçº§é¡ºåºä»é«å°ä½ä¸ºï¼ host_varsä¸å®ä¹åé ---\x3e inventoryä¸­åä¸ªä¸»æºå®ä¹åé ---\x3e group_varsä¸å®ä¹åé ---\x3e inventoryä¸­ç»å®ä¹åé\n\n# 1.1 YAMLé·é±\n\nYAMLè¯­æ³è¦æ±å¦æå¼ä»¥{{ foo }}å¼å¤´çè¯ï¼é£ä¹å°±éè¦å°æ´è¡ç¨åå¼å·åèµ·æ¥ï¼è¿æ¯ä¸ºäºç¡®è®¤ä½ ä¸æ¯æ³å£°æä¸ä¸ªYAMLå­å¸ã å¦ä¸é¢éç½®æ¯ä¸è¡çï¼ï¼ï¼\n\n---\n- hosts: app_servers\n  vars:\n    app_path: {{ base_path }}/data/web\n\n\n1\n2\n3\n4\n\n\nåºè¯¥æ¹æä¸é¢è¿æ ·ï¼\n\n---\n- hosts: app_servers\n  vars:\n    app_path: "{{ base_path }}/data/web"\n\n\n1\n2\n3\n4\n\n\n\n# äºã Ansbile-playbookåééç½®æ¹æ³\n\n# 2.1 å¨inventoryä¸»æºæ¸åæä»¶ä¸­å®ä¹åé\n\nå¯ä»¥ç´æ¥å®ä¹å¨ä¸»æºæ¸åæä»¶/etc/ansible/hostsä¸­ï¼è¡¨æè¯¥åéåªå¯¹å¯¹åºçä¸»æºæèç»ææï¼å¯¹å¶ä½çä¸»æºåç»æ æã\n\nç¤ºä¾ï¼\n\n$ egrep -v "^#|^$" /etc/ansible/hosts \n10.4.7.101 key=20180101\n10.4.7.102 key="niubility"\n\n$ vim ansi.yml \n---\n- hosts: all\n  gather_facts: False\n  tasks:\n    - name: haha\n      debug: msg="the {{ inventory_hostname }} value is {{ key }}"\n\n# æ§è¡ç»æï¼æ³¨æinventory_hostnameä»£è¡¨inventoryåè¡¨åè¡¨éè¢«æ§èç¹çä¸»æºåï¼ï¼\n\n$ ansible-playbook ansi.yml \n\nPLAY [all] **************************************************************************************************************************************\n\nTASK [haha] *************************************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "the 10.4.7.101 value is 20180101"\n}\nok: [10.4.7.102] => {\n    "msg": "the 10.4.7.102 value is niubility"\n}\n\nPLAY RECAP **************************************************************************************************************************************\n10.4.7.101                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n10.4.7.102                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n# 2.2 éè¿host_varsågroup_varsç®å½æ¥å®ä¹åé\n\n/etc/ansible/ç®å½æ¯linuxç³»ç»ä¸ansibleé»è®¤çéç½®æä»¶ç®å½ï¼Macç³»ç»ä¸çè¯ï¼å¶é»è®¤éç½®ç®å½æ¯å¨/usr/local/etc/ansible/ï¼ï¼å¨è¯¥ç®å½ä¸åå»ºhost_varsågroup_varsä¸¤ä¸ªç®å½ç¨æ¥å­æ¾å®ä¹åéçæä»¶ã\n\néå¯¹åä¸ªä¸»æºçåé\n\n$ cat /etc/ansible/host_vars/10.4.7.101\n---\nuser: root\npass: root@123\n\n\n1\n2\n3\n4\n\n\néå¯¹testç»çåé\n\n$ cat /etc/ansible/group_vars/test\n---\nuser: work\npass: work@123\n\n\n1\n2\n3\n4\n\n\nå¨inventoryæ¸ååè¡¨æä»¶éï¼åä¸ªä¸»æºå®ä¹çåéä¼åçº§é«äºä¸»æºç»å®ä¹çåé\n\n# 2.3 éè¿var_fileså®ä¹åé\n\n$ cat vars.yml \n---\nkey: jiayou\n\n$ cat bo.yml \n---\n- hosts: all\n  gather_facts: False\n  vars_files:\n      - vars.yml\n  tasks:\n    - name: display\n      debug: msg="the {{ inventory_hostname }} valus is {{ key }}"\n\n$ ansible-playbook bo.yml\n\nPLAY [all] **************************************************************************************************************************************\n\nTASK [display] **********************************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "the 10.4.7.101 valus is jiayou"\n}\nok: [10.4.7.102] => {\n    "msg": "the 10.4.7.102 valus is jiayou"\n}\n\nPLAY RECAP **************************************************************************************************************************************\n10.4.7.101                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n10.4.7.102                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n# 2.4 éè¿vars_promptäº¤äºå¼ä¼ å¥åé\n\nå¨playbookä¸­å®ä¹vars_promptçåéååäº¤äºå¼æç¤ºä¿¡æ¯ï¼å°±å¯ä»¥å®ç°å¨è¿è¡playbookæ¶ï¼éè¿äº¤äºçä¼ å¥åéå¼ã privateå­æ®µï¼ç¨æ¥å®ä¹äº¤äºæ¶æ¯å¦åæ¾è¾å¥çå¼ï¼é»è®¤privateä¸ºyesï¼ defaultå­æ®µï¼ç¨æ¥å®ä¹åéçé»è®¤å¼ã\n\n$ cat prom.yml \n---\n- hosts: test\n  remote_user: root\n  vars_prompt:\n      - name: "var1"\n        prompt: "please input you name"\n        private: no\n      - name: "var2"\n        prompt: "please input you age"\n        private: yes\n        default: 18\n  tasks:\n      - name: display var1\n        debug: msg="your name of var1 is {{ var1 }}"\n      - name: display var2\n        debug: msg="you age of var2 is {{ var2 }}"\n\n$ ansible-playbook prom.yml \nplease input you name: lvzhenjiang    # æè¾å¥çåå®¹ä¼ éç»åévar1ãè¾å¥çå¼æ¾ç¤ºåºæ¥ï¼\nplease input you age [18]:           # playbookä¸­å®ä¹é»è®¤å¼æ¯18ï¼å¦æä¸è¾å¥ä¾¿æ¯18ï¼ä½æ¯è¾å¥çå¼ä¸æ¾ç¤ºåºæ¥ï¼æ¯å¦è¿éè¾å¥ç23\n\nPLAY [test] *************************************************************************************************************************************\n\nTASK [Gathering Facts] **************************************************************************************************************************\nok: [10.4.7.101]\n\nTASK [display var1] *****************************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "your name of var1 is lvzhenjiang"\n}\n\nTASK [display var2] *****************************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "you age of var2 is 23"\n}\n\nPLAY RECAP **************************************************************************************************************************************\n10.4.7.101                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n# 2.5 éè¿ansible-playbookå½ä»¤è¡å®ä¹åéï¼å³åæ°ä¼ å¥åé\n\né¤äºvars_promptåvars_filesï¼ä¹å¯ä»¥éè¿Ansibleå½ä»¤è¡åéåéãå¦ææ³è¦ç¼åä¸ä¸ªéç¨çåå¸playbookæ¶åç¹å«æç¨ï¼ä½ å¯ä»¥ä¼ éåºç¨ççæ¬ä»¥ä¾¿é¨ç½²ãä¾å¦ä¸é¢å½ä»¤ï¼æ³¨æï¼ --extra-vars ç¸ç­äº -eï¼\n\n$ cat exap.yml \n---\n- hosts: \'{{hosts}}\'\n  remote_user: \'{{user}}\'\n  tasks:\n    - name: "ä¸ä¸ªæµè¯"\n      debug: msg="your hosts is {{hosts}}, user is {{user}}"\n\n$  ansible-playbook exap.yml -e "hosts=test user=root" \n[WARNING]: Found variable using reserved name: hosts\n\nPLAY [test] *************************************************************************************************************************************\n\nTASK [Gathering Facts] **************************************************************************************************************************\nok: [10.4.7.101]\n\nTASK [ä¸ä¸ªæµè¯] *************************************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "your hosts is test, user is root"\n}\n\nPLAY RECAP **************************************************************************************************************************************\n10.4.7.101                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nä¹å¯ä»¥å°åæ°æ¾å¨æä»¶éé¢è¿è¡ä¼ éï¼æ³¨æå½ä»¤è¡éè¦æ¯ç¨"@æä»¶å"ï¼ï¼\n\n# åæ ·ä½¿ç¨ä¸é¢çä¾å­\n$ cat anhui.yml \n---\nhosts: test\nuser: root\n\n$ ansible-playbook exap.yml -e "@anhui.yml"\n[WARNING]: Found variable using reserved name: hosts\n\nPLAY [test] *************************************************************************************************************************************\n\nTASK [Gathering Facts] **************************************************************************************************************************\nok: [10.4.7.101]\n\nTASK [ä¸ä¸ªæµè¯] *************************************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "your hosts is test, user is root"\n}\n\nPLAY RECAP **************************************************************************************************************************************\n10.4.7.101                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n# 2.6 å¨playbookå§æ¬ä¸­å®ä¹åé\n\nå¨playbookä¸­å®ä¹åééè¦ç¨å°Ansibleçvarsæ¨¡åï¼å¯ä»¥å°ææéè¦ç¨å°çåéç»ä¸å¨varsæ¨¡åä¸å®ä¹ï¼å®ä¹æ ¼å¼éè¦éµå¾ªYAMLè¯­è¨æ ¼å¼ï¼\n\nè¯­æ³æ ¼å¼ï¼\n\nvars:\n  - var1: value1\n  - var2: value2\n  - var3: value3\n  - ....: .....\n\n\n1\n2\n3\n4\n5\n\n\nç¤ºä¾å¦ä¸ï¼\n\n$ cat playbook.yml \n---\n- hosts: test\n  remote_user: root\n  vars:\n    - dir1: /root/Ansible\n    - dir2: /root/Ansible/test1\n    - dir3: /root/Ansible/test2\n  tasks:\n    - name: Create New Folder\n      file: name={{ dir1 }} state=directory\n    - name: Create New Folder\n      file: name={{ dir2 }} state=directory\n    - name: Create New Folder\n      file: name={{ dir3 }} state=directory\n\n$ ansible-playbook playbook.yml \n\nPLAY [test] *************************************************************************************************************************************\n\nTASK [Gathering Facts] **************************************************************************************************************************\nok: [10.4.7.101]\n\nTASK [Create New Folder] ************************************************************************************************************************\nchanged: [10.4.7.101]\n\nTASK [Create New Folder] ************************************************************************************************************************\nchanged: [10.4.7.101]\n\nTASK [Create New Folder] ************************************************************************************************************************\nchanged: [10.4.7.101]\n\nPLAY RECAP **************************************************************************************************************************************\n10.4.7.101                 : ok=4    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n# 2.7 éè¿rolesè§è²å®ä¹åé\n\nå¨Ansibleçrolesä¸­å®ä¹åéï¼éè¦å°åéåå¼çé®å¼å¯¹å½¢å¼åå°rolesçvarsç®å½ä¸çmain.ymlæä»¶ä¸­ï¼åæ ·éç¨YAMLè¯­è¨æ ¼å¼ï¼æ ¼å¼å¦ä¸ï¼\n\nvar1: value1\nvar2: value2\nvar3: value3\n\n\n1\n2\n3\n\n\nä½æ¯è¯·æ³¨æï¼éè¿Roleså®ä¹çåéåªéç¨äºå½årolesã\n\n# rolesç®å½ç»æ\n$ tree .\n.\nâââ hosts\nâââ playbook.yml\nâââ test\n    âââ files\n    âââ tasks\n    â   âââ main.yml\n    âââ templates\n    âââ vars\n        âââ main.yml\n\n5 directories, 4 files\n\n$ cat test/tasks/main.yml \n- name: create directory\n  file: name={{ dir }} state=directory\n- name: Get IP Address\n  shell: echo `{{ cmd }}` >> {{ dir }}/{{ file }}\n\n$ cat test/vars/main.yml \ncmd: hostname -I\n\n$ cat playbook.yml \n---\n- hosts: test\n  remote_user: root\n  roles:\n    - test\n\n$ cat hosts \n[test]\n10.4.7.101 dir=/root/node2\n10.4.7.102 dir=/root/node1\n\n[node1]\n10.4.7.100\n\n[test:vars]\nfile=hostname.txt\n\n$ ansible-playbook -i hosts  playbook.yml \n\nPLAY [test] *************************************************************************************************************************************\n\nTASK [Gathering Facts] **************************************************************************************************************************\nok: [10.4.7.101]\nok: [10.4.7.102]\n\nTASK [test : create directory] ******************************************************************************************************************\nok: [10.4.7.101]\nok: [10.4.7.102]\n\nTASK [test : Get IP Address] ********************************************************************************************************************\nchanged: [10.4.7.102]\nchanged: [10.4.7.101]\n\nPLAY RECAP **************************************************************************************************************************************\n10.4.7.101                 : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n10.4.7.102                 : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n\n\n# 2.8 ä½¿ç¨Factsè·åçä¿¡æ¯\n\nè¿æå¶å®å°æ¹å¯ä»¥è·ååé, è¿äºåéæ¯èªå¨åç°çï¼èä¸æ¯ç¨æ·èªå·±è®¾ç½®çãFactséè¿è®¿é®è¿ç¨ç³»ç»è·åç¸åºçä¿¡æ¯ï¼ä¸ä¸ªå¾å¥½çä¾å­å°±æ¯è¿ç¨ä¸»æºçIPå°åæèæä½ç³»ç»æ¯ä»ä¹ã\n\n$ ansible test -m setup\n# ä½¿ç¨ä»¥ä¸å½ä»¤å¯ä»¥æ¥çåªäºä¿¡æ¯æ¯å¯ç¨çï¼testæ¯ä¸é¢å¨/etc/ansible/hostsåè¡¨æä»¶ä¸­éç½®çä¸»æºç¾¤ç»ï¼\n\n$ ansible test -m setup|grep "ansible_python_version"\n        "ansible_python_version": "2.7.5", \n# å¨playbookä¸­è¿æ ·å¼ç¨ä¸é¢è¢«æ§å¶ä¸»æºçpythonçæ¬: {{ ansible_python_version }}\n\n$ ansible test -m setup|grep "ansible_nodename"\n        "ansible_nodename": "template", \n# å¯ä»¥å¨playbookä¸­è¿æ ·å¼ç¨ä¸é¢è¢«æ§å¶ä¸»æºçä¸»æºå: {{ ansible_nodename }}\n\n$ ansible test -m setup | grep "ansible_hostname"\n        "ansible_hostname": "template",\n# è¢«æ§å¶ä¸»æºçä¸»æºååéè¿å¯ä»¥æ¯: {{ ansible_hostname }}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nå¦æå³é­Factsï¼å¯ä»¥å¤§å¤§æé«ansibleçæ§è¡éåº¦ ï¼å³é­æ¹æ³å¦ä¸ï¼\n\n$ cat anhui.yml\n---\n- hosts: test\n  gather_facts: no\n\n\n1\n2\n3\n4\n\n\n# 2.9 registeræ³¨ååé\n\nåéçå¦ä¸ä¸ªä¸»è¦ç¨éæ¯å¨è¿è¡å½ä»¤æ¶ï¼æå½ä»¤ç»æå­å¨å°ä¸ä¸ªåéä¸­ï¼ä¸åæ¨¡åçæ§è¡ç»ææ¯ä¸åçãè¿è¡playbookæ¶ä½¿ç¨-véé¡¹å¯ä»¥çå°å¯è½çç»æå¼ï¼ansibleæ§è¡ä»»å¡çç»æå¼å¯ä»¥ä¿å­å¨åéä¸­ï¼ä»¥ä¾¿ç¨åä½¿ç¨å®ãregisteræ¹å¼ä¸»è¦ç¨äºå¨taskä¹é´ä¼ éåéã\n\n$ cat /etc/ansible/hosts\n[test]\n10.4.7.101\n10.4.7.102\n\n$ cat register.yml\n---\n- hosts: test\n  remote_user: root\n  tasks:\n      - name: register bo_test\n        shell: hostname -I\n        register: info\n      - name: display info\n        debug: msg="this host ip is {{ info[\'stdout\'] }}"\n\n$ ansible-playbook register.yml\n\nPLAY [test] *************************************************************************************************************\n\nTASK [Gathering Facts] **************************************************************************************************\nok: [10.4.7.102]\nok: [10.4.7.101]\n\nTASK [register bo_test] *************************************************************************************************\nchanged: [10.4.7.102]\nchanged: [10.4.7.101]\n\nTASK [display info] *****************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "this host ip is 10.4.7.101 "\n}\nok: [10.4.7.102] => {\n    "msg": "this host ip is 10.4.7.102 "\n}\n\nPLAY RECAP **************************************************************************************************************\n10.4.7.101                 : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.4.7.102                 : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n# 2.10 hostvars åé\n\nè¯¥åéç¨äºå¼ç¨å¶ä»ä¸»æºä¸æ¶éçfactsä¸­çæ°æ®ï¼æèå¼ç¨å¶ä»ä¸»æºçä¸»æºåéãä¸»æºç»åéãå³ä»ä¸å°è¿ç¨ä¸»æºè·åå¦ä¸å°è¿ç¨ä¸»æºçåéã\n\n$ cat /etc/ansible/hosts\n[test]\n10.4.7.101 addr=beijing\n10.4.7.102 user=shibo age=39\n\n$ cat test.yml\n---\n- hosts: test\n  remote_user: root\n  gather_facts: False\n  tasks:\n    - name: this is test1\n      debug: msg="She is come from {{ hostvars[\'10.4.7.101\'][\'addr\'] }}"\n    - name: this is test2\n      debug: msg="I am {{ hostvars[\'10.4.7.102\'][\'user\'] }}, and age is {{ hostvars[\'10.4.7.102\'][\'age\'] }}"\n\n$ ansible-playbook test.yml\n\nPLAY [test] *************************************************************************************************************\n\nTASK [this is test1] ****************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "She is come from beijing"\n}\nok: [10.4.7.102] => {\n    "msg": "She is come from beijing"\n}\n\nTASK [this is test2] ****************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "I am shibo, and age is 39"\n}\nok: [10.4.7.102] => {\n    "msg": "I am shibo, and age is 39"\n}\n\nPLAY RECAP **************************************************************************************************************\n10.4.7.101                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.4.7.102                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n# 2.11 åè¡¨åéãå¾ªç¯åéãå­å¸åé\n\n1ï¼ansibleçåéä¸ä»å¯ä»¥æ¯åä¸ªçå¼ï¼ä¹å¯ä»¥ä¸ºåè¡¨ï¼å³ansibleä¼ åè¡¨ä½ä¸ºåé\n\n$ cat test.yml\n---\n- hosts: test\n  remote_user: root\n  gather_facts: False\n  vars:\n    - list: [1,2,3]\n  tasks:\n    - name: echo\n      debug: msg="{{ list }}"\n\n$ ansible-playbook test.yml\n\nPLAY [test] *************************************************************************************************************\n\nTASK [echo] *************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": [\n        1,\n        2,\n        3\n    ]\n}\nok: [10.4.7.102] => {\n    "msg": [\n        1,\n        2,\n        3\n    ]\n}\n\nPLAY RECAP **************************************************************************************************************\n10.4.7.101                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.4.7.102                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n2ï¼å¾ªç¯åè¡¨\n\nç»åå¾ªç¯ï¼è¿ä¸ªç¹æ§å°±åå¾å¾æç¨ï¼ä»¥åæ°ä¼ éåè¡¨ç»playbookï¼ä¸ç¨å¨playbookä¸­åºå®å¾ªç¯çæ¬¡æ°ä¸åå®¹ã\n\n$ cat test.yml\n---\n- hosts: 10.4.7.101\n  remote_user: root\n  gather_facts: False\n  vars:\n    - list: [1,2,3]\n  tasks:\n    - name: this is loop\n      debug: msg="{{ item }}"\n      with_items: \'{{list}}\'\n\n$ ansible-playbook test.yml\n\nPLAY [10.4.7.101] *******************************************************************************************************\n\nTASK [this is loop] *****************************************************************************************************\nok: [10.4.7.101] => (item=1) => {\n    "msg": 1\n}\nok: [10.4.7.101] => (item=2) => {\n    "msg": 2\n}\nok: [10.4.7.101] => (item=3) => {\n    "msg": 3\n}\n\nPLAY RECAP **************************************************************************************************************\n10.4.7.101                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n*************** å½ä½ åç°èªå·±çæåæä¸èµ·éå¿æ¶ï¼å°±è¯·å®éä¸æ¥å­¦ä¹ å§ï¼***************',normalizedContent:'åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14385777.html\n\n\n# ansible playbookä¸­çåé\n\nç®å½\n\n * ä¸ãåéçä¼åçº§\n   * 1.1 yamlé·é±\n * äºã ansbile-playbookåééç½®æ¹æ³\n   * 2.1 å¨inventoryä¸»æºæ¸åæä»¶ä¸­å®ä¹åé\n   * 2.2 éè¿host_varsågroup_varsç®å½æ¥å®ä¹åé\n   * 2.3 éè¿var_fileså®ä¹åé\n   * 2.4 éè¿vars_promptäº¤äºå¼ä¼ å¥åé\n   * 2.5 éè¿ansible-playbookå½ä»¤è¡å®ä¹åéï¼å³åæ°ä¼ å¥åé\n   * 2.6 å¨playbookå§æ¬ä¸­å®ä¹åé\n   * 2.7 éè¿rolesè§è²å®ä¹åé\n   * 2.8 ä½¿ç¨factsè·åçä¿¡æ¯\n   * 2.9 registeræ³¨ååé\n   * 2.10 hostvars åé\n   * 2.11 åè¡¨åéãå¾ªç¯åéãå­å¸åé\n\n\n# ä¸ãåéçä¼åçº§\n\n * extra varsåéï¼å¨å½ä»¤è¡ä¸­ä½¿ç¨ -eï¼ï¼ä¼åçº§æé«ï¼\n * å¨inventoryä¸­å®ä¹çè¿æ¥åéï¼æ¯å¦ansible_ssh_userï¼ï¼ä¼åçº§ç¬¬äºï¼\n * å¤§å¤æ°çå¶ä»åéï¼å½ä»¤è¡è½¬æ¢ï¼playä¸­çåéï¼includeçåéï¼roleçåéç­ï¼ï¼ä¼åçº§ç¬¬ä¸ï¼\n * å¨inventoryå®ä¹çå¶ä»åéï¼ä¼åçº§ç¬¬åï¼\n * æç³»ç»åç°çfactsï¼ä¼åçº§ç¬¬äºï¼\n * "roleé»è®¤åé"ï¼è¿ä¸ªæ¯æé»è®¤çå¼ï¼å¾å®¹æä¸§å¤±ä¼åæãä¼åçº§æå°ï¼\n\nå¦å¤ï¼å¨inventoryæ¸ååè¡¨éå®ä¹çåéï¼åä¸ªä¸»æºå®ä¹çåéä¼åçº§é«äºä¸»æºç»å®ä¹çåé ç»è¿å®éªï¼ansibleä½¿ç¨inventoryå®ä¹åéçä¼åçº§é¡ºåºä»é«å°ä½ä¸ºï¼ host_varsä¸å®ä¹åé ---\x3e inventoryä¸­åä¸ªä¸»æºå®ä¹åé ---\x3e group_varsä¸å®ä¹åé ---\x3e inventoryä¸­ç»å®ä¹åé\n\n# 1.1 yamlé·é±\n\nyamlè¯­æ³è¦æ±å¦æå¼ä»¥{{ foo }}å¼å¤´çè¯ï¼é£ä¹å°±éè¦å°æ´è¡ç¨åå¼å·åèµ·æ¥ï¼è¿æ¯ä¸ºäºç¡®è®¤ä½ ä¸æ¯æ³å£°æä¸ä¸ªyamlå­å¸ã å¦ä¸é¢éç½®æ¯ä¸è¡çï¼ï¼ï¼\n\n---\n- hosts: app_servers\n  vars:\n    app_path: {{ base_path }}/data/web\n\n\n1\n2\n3\n4\n\n\nåºè¯¥æ¹æä¸é¢è¿æ ·ï¼\n\n---\n- hosts: app_servers\n  vars:\n    app_path: "{{ base_path }}/data/web"\n\n\n1\n2\n3\n4\n\n\n\n# äºã ansbile-playbookåééç½®æ¹æ³\n\n# 2.1 å¨inventoryä¸»æºæ¸åæä»¶ä¸­å®ä¹åé\n\nå¯ä»¥ç´æ¥å®ä¹å¨ä¸»æºæ¸åæä»¶/etc/ansible/hostsä¸­ï¼è¡¨æè¯¥åéåªå¯¹å¯¹åºçä¸»æºæèç»ææï¼å¯¹å¶ä½çä¸»æºåç»æ æã\n\nç¤ºä¾ï¼\n\n$ egrep -v "^#|^$" /etc/ansible/hosts \n10.4.7.101 key=20180101\n10.4.7.102 key="niubility"\n\n$ vim ansi.yml \n---\n- hosts: all\n  gather_facts: false\n  tasks:\n    - name: haha\n      debug: msg="the {{ inventory_hostname }} value is {{ key }}"\n\n# æ§è¡ç»æï¼æ³¨æinventory_hostnameä»£è¡¨inventoryåè¡¨åè¡¨éè¢«æ§èç¹çä¸»æºåï¼ï¼\n\n$ ansible-playbook ansi.yml \n\nplay [all] **************************************************************************************************************************************\n\ntask [haha] *************************************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "the 10.4.7.101 value is 20180101"\n}\nok: [10.4.7.102] => {\n    "msg": "the 10.4.7.102 value is niubility"\n}\n\nplay recap **************************************************************************************************************************************\n10.4.7.101                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n10.4.7.102                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n# 2.2 éè¿host_varsågroup_varsç®å½æ¥å®ä¹åé\n\n/etc/ansible/ç®å½æ¯linuxç³»ç»ä¸ansibleé»è®¤çéç½®æä»¶ç®å½ï¼macç³»ç»ä¸çè¯ï¼å¶é»è®¤éç½®ç®å½æ¯å¨/usr/local/etc/ansible/ï¼ï¼å¨è¯¥ç®å½ä¸åå»ºhost_varsågroup_varsä¸¤ä¸ªç®å½ç¨æ¥å­æ¾å®ä¹åéçæä»¶ã\n\néå¯¹åä¸ªä¸»æºçåé\n\n$ cat /etc/ansible/host_vars/10.4.7.101\n---\nuser: root\npass: root@123\n\n\n1\n2\n3\n4\n\n\néå¯¹testç»çåé\n\n$ cat /etc/ansible/group_vars/test\n---\nuser: work\npass: work@123\n\n\n1\n2\n3\n4\n\n\nå¨inventoryæ¸ååè¡¨æä»¶éï¼åä¸ªä¸»æºå®ä¹çåéä¼åçº§é«äºä¸»æºç»å®ä¹çåé\n\n# 2.3 éè¿var_fileså®ä¹åé\n\n$ cat vars.yml \n---\nkey: jiayou\n\n$ cat bo.yml \n---\n- hosts: all\n  gather_facts: false\n  vars_files:\n      - vars.yml\n  tasks:\n    - name: display\n      debug: msg="the {{ inventory_hostname }} valus is {{ key }}"\n\n$ ansible-playbook bo.yml\n\nplay [all] **************************************************************************************************************************************\n\ntask [display] **********************************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "the 10.4.7.101 valus is jiayou"\n}\nok: [10.4.7.102] => {\n    "msg": "the 10.4.7.102 valus is jiayou"\n}\n\nplay recap **************************************************************************************************************************************\n10.4.7.101                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n10.4.7.102                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n# 2.4 éè¿vars_promptäº¤äºå¼ä¼ å¥åé\n\nå¨playbookä¸­å®ä¹vars_promptçåéååäº¤äºå¼æç¤ºä¿¡æ¯ï¼å°±å¯ä»¥å®ç°å¨è¿è¡playbookæ¶ï¼éè¿äº¤äºçä¼ å¥åéå¼ã privateå­æ®µï¼ç¨æ¥å®ä¹äº¤äºæ¶æ¯å¦åæ¾è¾å¥çå¼ï¼é»è®¤privateä¸ºyesï¼ defaultå­æ®µï¼ç¨æ¥å®ä¹åéçé»è®¤å¼ã\n\n$ cat prom.yml \n---\n- hosts: test\n  remote_user: root\n  vars_prompt:\n      - name: "var1"\n        prompt: "please input you name"\n        private: no\n      - name: "var2"\n        prompt: "please input you age"\n        private: yes\n        default: 18\n  tasks:\n      - name: display var1\n        debug: msg="your name of var1 is {{ var1 }}"\n      - name: display var2\n        debug: msg="you age of var2 is {{ var2 }}"\n\n$ ansible-playbook prom.yml \nplease input you name: lvzhenjiang    # æè¾å¥çåå®¹ä¼ éç»åévar1ãè¾å¥çå¼æ¾ç¤ºåºæ¥ï¼\nplease input you age [18]:           # playbookä¸­å®ä¹é»è®¤å¼æ¯18ï¼å¦æä¸è¾å¥ä¾¿æ¯18ï¼ä½æ¯è¾å¥çå¼ä¸æ¾ç¤ºåºæ¥ï¼æ¯å¦è¿éè¾å¥ç23\n\nplay [test] *************************************************************************************************************************************\n\ntask [gathering facts] **************************************************************************************************************************\nok: [10.4.7.101]\n\ntask [display var1] *****************************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "your name of var1 is lvzhenjiang"\n}\n\ntask [display var2] *****************************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "you age of var2 is 23"\n}\n\nplay recap **************************************************************************************************************************************\n10.4.7.101                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n# 2.5 éè¿ansible-playbookå½ä»¤è¡å®ä¹åéï¼å³åæ°ä¼ å¥åé\n\né¤äºvars_promptåvars_filesï¼ä¹å¯ä»¥éè¿ansibleå½ä»¤è¡åéåéãå¦ææ³è¦ç¼åä¸ä¸ªéç¨çåå¸playbookæ¶åç¹å«æç¨ï¼ä½ å¯ä»¥ä¼ éåºç¨ççæ¬ä»¥ä¾¿é¨ç½²ãä¾å¦ä¸é¢å½ä»¤ï¼æ³¨æï¼ --extra-vars ç¸ç­äº -eï¼\n\n$ cat exap.yml \n---\n- hosts: \'{{hosts}}\'\n  remote_user: \'{{user}}\'\n  tasks:\n    - name: "ä¸ä¸ªæµè¯"\n      debug: msg="your hosts is {{hosts}}, user is {{user}}"\n\n$  ansible-playbook exap.yml -e "hosts=test user=root" \n[warning]: found variable using reserved name: hosts\n\nplay [test] *************************************************************************************************************************************\n\ntask [gathering facts] **************************************************************************************************************************\nok: [10.4.7.101]\n\ntask [ä¸ä¸ªæµè¯] *************************************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "your hosts is test, user is root"\n}\n\nplay recap **************************************************************************************************************************************\n10.4.7.101                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nä¹å¯ä»¥å°åæ°æ¾å¨æä»¶éé¢è¿è¡ä¼ éï¼æ³¨æå½ä»¤è¡éè¦æ¯ç¨"@æä»¶å"ï¼ï¼\n\n# åæ ·ä½¿ç¨ä¸é¢çä¾å­\n$ cat anhui.yml \n---\nhosts: test\nuser: root\n\n$ ansible-playbook exap.yml -e "@anhui.yml"\n[warning]: found variable using reserved name: hosts\n\nplay [test] *************************************************************************************************************************************\n\ntask [gathering facts] **************************************************************************************************************************\nok: [10.4.7.101]\n\ntask [ä¸ä¸ªæµè¯] *************************************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "your hosts is test, user is root"\n}\n\nplay recap **************************************************************************************************************************************\n10.4.7.101                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n# 2.6 å¨playbookå§æ¬ä¸­å®ä¹åé\n\nå¨playbookä¸­å®ä¹åééè¦ç¨å°ansibleçvarsæ¨¡åï¼å¯ä»¥å°ææéè¦ç¨å°çåéç»ä¸å¨varsæ¨¡åä¸å®ä¹ï¼å®ä¹æ ¼å¼éè¦éµå¾ªyamlè¯­è¨æ ¼å¼ï¼\n\nè¯­æ³æ ¼å¼ï¼\n\nvars:\n  - var1: value1\n  - var2: value2\n  - var3: value3\n  - ....: .....\n\n\n1\n2\n3\n4\n5\n\n\nç¤ºä¾å¦ä¸ï¼\n\n$ cat playbook.yml \n---\n- hosts: test\n  remote_user: root\n  vars:\n    - dir1: /root/ansible\n    - dir2: /root/ansible/test1\n    - dir3: /root/ansible/test2\n  tasks:\n    - name: create new folder\n      file: name={{ dir1 }} state=directory\n    - name: create new folder\n      file: name={{ dir2 }} state=directory\n    - name: create new folder\n      file: name={{ dir3 }} state=directory\n\n$ ansible-playbook playbook.yml \n\nplay [test] *************************************************************************************************************************************\n\ntask [gathering facts] **************************************************************************************************************************\nok: [10.4.7.101]\n\ntask [create new folder] ************************************************************************************************************************\nchanged: [10.4.7.101]\n\ntask [create new folder] ************************************************************************************************************************\nchanged: [10.4.7.101]\n\ntask [create new folder] ************************************************************************************************************************\nchanged: [10.4.7.101]\n\nplay recap **************************************************************************************************************************************\n10.4.7.101                 : ok=4    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n# 2.7 éè¿rolesè§è²å®ä¹åé\n\nå¨ansibleçrolesä¸­å®ä¹åéï¼éè¦å°åéåå¼çé®å¼å¯¹å½¢å¼åå°rolesçvarsç®å½ä¸çmain.ymlæä»¶ä¸­ï¼åæ ·éç¨yamlè¯­è¨æ ¼å¼ï¼æ ¼å¼å¦ä¸ï¼\n\nvar1: value1\nvar2: value2\nvar3: value3\n\n\n1\n2\n3\n\n\nä½æ¯è¯·æ³¨æï¼éè¿roleså®ä¹çåéåªéç¨äºå½årolesã\n\n# rolesç®å½ç»æ\n$ tree .\n.\nâââ hosts\nâââ playbook.yml\nâââ test\n    âââ files\n    âââ tasks\n    â   âââ main.yml\n    âââ templates\n    âââ vars\n        âââ main.yml\n\n5 directories, 4 files\n\n$ cat test/tasks/main.yml \n- name: create directory\n  file: name={{ dir }} state=directory\n- name: get ip address\n  shell: echo `{{ cmd }}` >> {{ dir }}/{{ file }}\n\n$ cat test/vars/main.yml \ncmd: hostname -i\n\n$ cat playbook.yml \n---\n- hosts: test\n  remote_user: root\n  roles:\n    - test\n\n$ cat hosts \n[test]\n10.4.7.101 dir=/root/node2\n10.4.7.102 dir=/root/node1\n\n[node1]\n10.4.7.100\n\n[test:vars]\nfile=hostname.txt\n\n$ ansible-playbook -i hosts  playbook.yml \n\nplay [test] *************************************************************************************************************************************\n\ntask [gathering facts] **************************************************************************************************************************\nok: [10.4.7.101]\nok: [10.4.7.102]\n\ntask [test : create directory] ******************************************************************************************************************\nok: [10.4.7.101]\nok: [10.4.7.102]\n\ntask [test : get ip address] ********************************************************************************************************************\nchanged: [10.4.7.102]\nchanged: [10.4.7.101]\n\nplay recap **************************************************************************************************************************************\n10.4.7.101                 : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n10.4.7.102                 : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n\n\n# 2.8 ä½¿ç¨factsè·åçä¿¡æ¯\n\nè¿æå¶å®å°æ¹å¯ä»¥è·ååé, è¿äºåéæ¯èªå¨åç°çï¼èä¸æ¯ç¨æ·èªå·±è®¾ç½®çãfactséè¿è®¿é®è¿ç¨ç³»ç»è·åç¸åºçä¿¡æ¯ï¼ä¸ä¸ªå¾å¥½çä¾å­å°±æ¯è¿ç¨ä¸»æºçipå°åæèæä½ç³»ç»æ¯ä»ä¹ã\n\n$ ansible test -m setup\n# ä½¿ç¨ä»¥ä¸å½ä»¤å¯ä»¥æ¥çåªäºä¿¡æ¯æ¯å¯ç¨çï¼testæ¯ä¸é¢å¨/etc/ansible/hostsåè¡¨æä»¶ä¸­éç½®çä¸»æºç¾¤ç»ï¼\n\n$ ansible test -m setup|grep "ansible_python_version"\n        "ansible_python_version": "2.7.5", \n# å¨playbookä¸­è¿æ ·å¼ç¨ä¸é¢è¢«æ§å¶ä¸»æºçpythonçæ¬: {{ ansible_python_version }}\n\n$ ansible test -m setup|grep "ansible_nodename"\n        "ansible_nodename": "template", \n# å¯ä»¥å¨playbookä¸­è¿æ ·å¼ç¨ä¸é¢è¢«æ§å¶ä¸»æºçä¸»æºå: {{ ansible_nodename }}\n\n$ ansible test -m setup | grep "ansible_hostname"\n        "ansible_hostname": "template",\n# è¢«æ§å¶ä¸»æºçä¸»æºååéè¿å¯ä»¥æ¯: {{ ansible_hostname }}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nå¦æå³é­factsï¼å¯ä»¥å¤§å¤§æé«ansibleçæ§è¡éåº¦ ï¼å³é­æ¹æ³å¦ä¸ï¼\n\n$ cat anhui.yml\n---\n- hosts: test\n  gather_facts: no\n\n\n1\n2\n3\n4\n\n\n# 2.9 registeræ³¨ååé\n\nåéçå¦ä¸ä¸ªä¸»è¦ç¨éæ¯å¨è¿è¡å½ä»¤æ¶ï¼æå½ä»¤ç»æå­å¨å°ä¸ä¸ªåéä¸­ï¼ä¸åæ¨¡åçæ§è¡ç»ææ¯ä¸åçãè¿è¡playbookæ¶ä½¿ç¨-véé¡¹å¯ä»¥çå°å¯è½çç»æå¼ï¼ansibleæ§è¡ä»»å¡çç»æå¼å¯ä»¥ä¿å­å¨åéä¸­ï¼ä»¥ä¾¿ç¨åä½¿ç¨å®ãregisteræ¹å¼ä¸»è¦ç¨äºå¨taskä¹é´ä¼ éåéã\n\n$ cat /etc/ansible/hosts\n[test]\n10.4.7.101\n10.4.7.102\n\n$ cat register.yml\n---\n- hosts: test\n  remote_user: root\n  tasks:\n      - name: register bo_test\n        shell: hostname -i\n        register: info\n      - name: display info\n        debug: msg="this host ip is {{ info[\'stdout\'] }}"\n\n$ ansible-playbook register.yml\n\nplay [test] *************************************************************************************************************\n\ntask [gathering facts] **************************************************************************************************\nok: [10.4.7.102]\nok: [10.4.7.101]\n\ntask [register bo_test] *************************************************************************************************\nchanged: [10.4.7.102]\nchanged: [10.4.7.101]\n\ntask [display info] *****************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "this host ip is 10.4.7.101 "\n}\nok: [10.4.7.102] => {\n    "msg": "this host ip is 10.4.7.102 "\n}\n\nplay recap **************************************************************************************************************\n10.4.7.101                 : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.4.7.102                 : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n# 2.10 hostvars åé\n\nè¯¥åéç¨äºå¼ç¨å¶ä»ä¸»æºä¸æ¶éçfactsä¸­çæ°æ®ï¼æèå¼ç¨å¶ä»ä¸»æºçä¸»æºåéãä¸»æºç»åéãå³ä»ä¸å°è¿ç¨ä¸»æºè·åå¦ä¸å°è¿ç¨ä¸»æºçåéã\n\n$ cat /etc/ansible/hosts\n[test]\n10.4.7.101 addr=beijing\n10.4.7.102 user=shibo age=39\n\n$ cat test.yml\n---\n- hosts: test\n  remote_user: root\n  gather_facts: false\n  tasks:\n    - name: this is test1\n      debug: msg="she is come from {{ hostvars[\'10.4.7.101\'][\'addr\'] }}"\n    - name: this is test2\n      debug: msg="i am {{ hostvars[\'10.4.7.102\'][\'user\'] }}, and age is {{ hostvars[\'10.4.7.102\'][\'age\'] }}"\n\n$ ansible-playbook test.yml\n\nplay [test] *************************************************************************************************************\n\ntask [this is test1] ****************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "she is come from beijing"\n}\nok: [10.4.7.102] => {\n    "msg": "she is come from beijing"\n}\n\ntask [this is test2] ****************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": "i am shibo, and age is 39"\n}\nok: [10.4.7.102] => {\n    "msg": "i am shibo, and age is 39"\n}\n\nplay recap **************************************************************************************************************\n10.4.7.101                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.4.7.102                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n# 2.11 åè¡¨åéãå¾ªç¯åéãå­å¸åé\n\n1ï¼ansibleçåéä¸ä»å¯ä»¥æ¯åä¸ªçå¼ï¼ä¹å¯ä»¥ä¸ºåè¡¨ï¼å³ansibleä¼ åè¡¨ä½ä¸ºåé\n\n$ cat test.yml\n---\n- hosts: test\n  remote_user: root\n  gather_facts: false\n  vars:\n    - list: [1,2,3]\n  tasks:\n    - name: echo\n      debug: msg="{{ list }}"\n\n$ ansible-playbook test.yml\n\nplay [test] *************************************************************************************************************\n\ntask [echo] *************************************************************************************************************\nok: [10.4.7.101] => {\n    "msg": [\n        1,\n        2,\n        3\n    ]\n}\nok: [10.4.7.102] => {\n    "msg": [\n        1,\n        2,\n        3\n    ]\n}\n\nplay recap **************************************************************************************************************\n10.4.7.101                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.4.7.102                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n2ï¼å¾ªç¯åè¡¨\n\nç»åå¾ªç¯ï¼è¿ä¸ªç¹æ§å°±åå¾å¾æç¨ï¼ä»¥åæ°ä¼ éåè¡¨ç»playbookï¼ä¸ç¨å¨playbookä¸­åºå®å¾ªç¯çæ¬¡æ°ä¸åå®¹ã\n\n$ cat test.yml\n---\n- hosts: 10.4.7.101\n  remote_user: root\n  gather_facts: false\n  vars:\n    - list: [1,2,3]\n  tasks:\n    - name: this is loop\n      debug: msg="{{ item }}"\n      with_items: \'{{list}}\'\n\n$ ansible-playbook test.yml\n\nplay [10.4.7.101] *******************************************************************************************************\n\ntask [this is loop] *****************************************************************************************************\nok: [10.4.7.101] => (item=1) => {\n    "msg": 1\n}\nok: [10.4.7.101] => (item=2) => {\n    "msg": 2\n}\nok: [10.4.7.101] => (item=3) => {\n    "msg": 3\n}\n\nplay recap **************************************************************************************************************\n10.4.7.101                 : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n*************** å½ä½ åç°èªå·±çæåæä¸èµ·éå¿æ¶ï¼å°±è¯·å®éä¸æ¥å­¦ä¹ å§ï¼***************',charsets:{cjk:!0}},{title:"Ansibleæ§è½ä¼åââæåansibleæ§è¡æç",frontmatter:{title:"Ansibleæ§è½ä¼åââæåansibleæ§è¡æç",categories:["ansible"],tags:["ansible"],date:"2022-12-09T20:53:07.000Z",permalink:"/pages/a06506/",readingShow:"top",description:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14386197.html",meta:[{name:"twitter:title",content:"Ansibleæ§è½ä¼åââæåansibleæ§è¡æç"},{name:"twitter:description",content:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14386197.html"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/04.Ansible%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E2%80%94%E2%80%94%E6%8F%90%E5%8D%87ansible%E6%89%A7%E8%A1%8C%E6%95%88%E7%8E%87.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Ansibleæ§è½ä¼åââæåansibleæ§è¡æç"},{property:"og:description",content:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14386197.html"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/04.Ansible%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E2%80%94%E2%80%94%E6%8F%90%E5%8D%87ansible%E6%89%A7%E8%A1%8C%E6%95%88%E7%8E%87.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:53:07.000Z"},{property:"article:tag",content:"ansible"},{itemprop:"name",content:"Ansibleæ§è½ä¼åââæåansibleæ§è¡æç"},{itemprop:"description",content:"åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14386197.html"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/04.Ansible%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E2%80%94%E2%80%94%E6%8F%90%E5%8D%87ansible%E6%89%A7%E8%A1%8C%E6%95%88%E7%8E%87.html",relativePath:"01.ä¸é¢/01.ansibleç³»åæç« /04.Ansibleæ§è½ä¼åââæåansibleæ§è¡æç.md",key:"v-f0715856",path:"/pages/a06506/",headers:[{level:3,title:"ä¸ãå¼å¯SSHé¿è¿æ¥",slug:"ä¸ãå¼å¯sshé¿è¿æ¥",normalizedTitle:"ä¸ãå¼å¯sshé¿è¿æ¥",charIndex:348},{level:3,title:"ä¸ãè®¾ç½®factsç¼å­",slug:"ä¸ãè®¾ç½®factsç¼å­",normalizedTitle:"ä¸ãè®¾ç½®factsç¼å­",charIndex:426},{level:4,title:"3.1 ä½¿ç¨jsonæä»¶ç¼å­",slug:"_3-1-ä½¿ç¨jsonæä»¶ç¼å­",normalizedTitle:"3.1 ä½¿ç¨jsonæä»¶ç¼å­",charIndex:443},{level:4,title:"3.2 ä½¿ç¨rediså­å¨factsæä»¶éå®è£redisï¼è¿éè¦å®è£pythonåº",slug:"_3-2-ä½¿ç¨rediså­å¨factsæä»¶éå®è£redis-è¿éè¦å®è£pythonåº",normalizedTitle:"3.2 ä½¿ç¨rediså­å¨factsæä»¶éå®è£redisï¼è¿éè¦å®è£pythonåº",charIndex:531},{level:3,title:"åãAnsibleåæ¶äº¤äº",slug:"åãansibleåæ¶äº¤äº",normalizedTitle:"åãansibleåæ¶äº¤äº",charIndex:671},{level:3,title:"äºãAnsibleç-téé¡¹ï¼æé«ansibleæ§è¡æç",slug:"äºãansibleç-téé¡¹-æé«ansibleæ§è¡æç",normalizedTitle:"äºãansibleç-téé¡¹ï¼æé«ansibleæ§è¡æç",charIndex:756}],headersStr:"ä¸ãå¼å¯SSHé¿è¿æ¥ ä¸ãè®¾ç½®factsç¼å­ 3.1 ä½¿ç¨jsonæä»¶ç¼å­ 3.2 ä½¿ç¨rediså­å¨factsæä»¶éå®è£redisï¼è¿éè¦å®è£pythonåº åãAnsibleåæ¶äº¤äº äºãAnsibleç-téé¡¹ï¼æé«ansibleæ§è¡æç",content:'åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14386197.html\n\n# [Ansibleæ§è½ä¼åââæåansibleæ§è¡æç](https://www.cnblogs.com/lvzhenjiang/p/14386197.html)\n\n\n\nç®å½\n\n- [ä¸ãå³é­gathering factsåè½](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#ä¸ãå³é­gathering-factsåè½)\n- [äºãå¼å¯SSH pipelining](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#äºãå¼å¯ssh-pipelining)\n- [ä¸ãå¼å¯SSHé¿è¿æ¥](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#ä¸ãå¼å¯sshé¿è¿æ¥)\n- ä¸ãè®¾ç½®factsç¼å­\n  - [3.1 ä½¿ç¨jsonæä»¶ç¼å­](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#31-ä½¿ç¨jsonæä»¶ç¼å­)\n  - [3.2 ä½¿ç¨rediså­å¨factsæä»¶éå®è£redisï¼è¿éè¦å®è£pythonåº](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#32-ä½¿ç¨rediså­å¨factsæä»¶éå®è£redisï¼è¿éè¦å®è£pythonåº)\n- [åãAnsibleåæ¶äº¤äº](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#åãansibleåæ¶äº¤äº)\n- [äºãAnsibleç-téé¡¹ï¼æé«ansibleæ§è¡æç](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#äºãansibleç-téé¡¹ï¼æé«ansibleæ§è¡æç)\n\n\n\næåï¼ansibleçæ§è¡æçåsaltstack(åºäºzeromqæ¶æ¯éåçæ¹å¼)ç¸æ¯è¦æ¢çå¤çå¤ï¼ç¹å«æ¯è¢«æ§èç¹éå¾å¤§çæ¶åãä½æ¯ansibleåå±å°ç°å¨ï¼å®çæçå¾å°äºæå¤§çæ¹åãå¨è¢«æ§èç¹ä¸å¤ªå¤çæ¶åï¼é»è®¤çè®¾ç½®å·²ç»å¤å¿«ãå³ä½¿è¢«æ§èç¹æ°éå·¨å¤§çæ¶åï¼ä¹å¯ä»¥éè¿ä¸äºä¼åå»æå¤§çæé«ansibleçæ§è¡æçãæä»¥å¨ä½¿ç¨ Ansible çè¿ç¨ä¸­ï¼å½ç®¡ççæå¡å¨æ°éå¢å æ¶ï¼ä¸å¾ä¸é¢å¯¹ä¸ä¸ªæ æ³é¿åçé®é¢æ§è¡æçæ¢ï¼è¿éååºä¸äºè§£å³åæ³ã\n\n### ä¸ãå³é­gathering factsåè½\n\nå¦æè§å¯è¿ansible-playbookçæ§è¡è¿ç¨ï¼å°±ä¼åç°ansible-playbookçç¬¬1ä¸ªæ­¥éª¤æ»æ¯æ§è¡gather factsï¼ä¸è®ºä½ ææ²¡æå¨playbookè®¾å®è¿ä¸ªtasksã\nå¦æä½ ä¸éè¦è·åè¢«æ§æºå¨çfactæ°æ®çè¯ï¼å°±å¯ä»¥å³é­è·åfactæ°æ®åè½ãå³é­ä¹åï¼å¯ä»¥å å¿«ansible-playbookçæ§è¡æçï¼å°¤å¶æ¯ä½ ç®¡çå¾å¤§éçæºå¨æ¶ï¼è¿éå¸¸ææ¾ã\nå³é­è·åfactså¾ç®åï¼åªéè¦å¨playbookæä»¶ä¸­å ä¸`"gather_facts: False"` æè `"gather_facts: No"`å³å¯ï¼FalseåNoé½ä¸ºå°åä¹å¯ä»¥ï¼ã\n\n```shell\n$ cat test.yml\n- hosts: test_server\n  remote_user: root\n\n  tasks:\n    - name: this is a test\n      shell: echo "haha"\n\n\n# æ§è¡è¿ä¸ªpalyï¼ä¼åç°ç¬¬ä¸ä¸ªæ§è¡çæ¯gather factsï¼å ä¸ºé»è®¤æ¯æå¼gather factsåè½çï¼ï¼ï¼ï¼\n$ ansible-playbook test.yml\n\nPLAY [test_server] ******************************************************************************************************\n\nTASK [Gathering Facts] **************************************************************************************************\nok: [10.4.7.102]\nok: [10.4.7.101]\n\nTASK [this is a test] ***************************************************************************************************\nchanged: [10.4.7.102]\nchanged: [10.4.7.101]\n\nPLAY RECAP **************************************************************************************************************\n10.4.7.101                 : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.4.7.102                 : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n```\n\n**ç°å¨å³é­gathering factsåè½**\n\n```shell\n$ cat test.yml\n- hosts: test_server\n  remote_user: root\n  gather_facts: False\n\n  tasks:\n    - name: this is a test\n      shell: echo "haha"\n\n# åæ§è¡è¿ä¸ªplayï¼å°±ä¼åç°æ²¡æäºgathering factsæ§è¡è¿ç¨ï¼æ´ä¸ªæ§è¡éåº¦ä¹å¿«äºï¼\n$ ansible-playbook test.yml\n\nPLAY [test_server] ******************************************************************************************************\n\nTASK [this is a test] ***************************************************************************************************\nchanged: [10.4.7.102]\nchanged: [10.4.7.101]\n\nPLAY RECAP **************************************************************************************************************\n10.4.7.101                 : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.4.7.102                 : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n```\n\n### äºãå¼å¯SSH pipelining\n\npipelineæ¯opensshçä¸ä¸ªç¹æ§ï¼`ssh pipelining` æ¯ä¸ä¸ªå éAnsibleæ§è¡éåº¦çç®åæ¹æ³ã\n\nå¨ansibleæ§è¡æ¯ä¸ªä»»å¡çæ´ä¸ªæµç¨ä¸­ï¼æä¸ä¸ªè¿ç¨æ¯å°ä¸´æ¶ä»»å¡æä»¶putå°è¿ç¨çansibleå®¢æ·æºä¸ï¼ç¶åéè¿`ssh`è¿æ¥è¿å»è¿ç¨æ§è¡è¿ä¸ªä»»å¡ã\nå¦æå¼å¯äºpipeliningï¼ä¸ä¸ªä»»å¡çææå¨ä½é½å¨ä¸ä¸ª`ssh`ä¼è¯ä¸­å®æï¼ä¹ä¼çå»`sftp`å°è¿ç«¯çè¿ç¨ï¼å®ä¼ç´æ¥å°è¦æ§è¡çä»»å¡å¨`ssh`ä¼è¯ä¸­è¿è¡ã\n\nssh``pipelining é»è®¤æ¯å³é­!!!!ä¹æä»¥é»è®¤å³é­æ¯ä¸ºäºå¼å®¹ä¸åç`sudo`éç½®ï¼ä¸»è¦æ¯ requiretty éé¡¹ãå¦æä¸ä½¿ç¨`sudo`ï¼å»ºè®®å¼å¯ï¼ï¼ï¼\næå¼æ­¤éé¡¹å¯ä»¥åå°ansibleæ§è¡æ²¡æä¼ è¾æ¶`ssh`å¨è¢«æ§æºå¨ä¸æ§è¡ä»»å¡çè¿æ¥æ°ã\nä¸è¿ï¼å¦æä½¿ç¨`sudo`ï¼å¿é¡»å³é­requirettyéé¡¹ãä¿®æ¹`/etc/ansible/ansible.cfg` æä»¶å¯ä»¥å¼å¯pipelining\n\n```shell\n$ vim /etc/ansible/ansible.cfg\n........\npipelining = True\n```\n\nè¿æ ·å¼å¯äºpipeliningä¹å, ansibleæ§è¡çæ´ä¸ªæµç¨å°±å°äºä¸ä¸ªPUTèæ¬å»è¿ç¨æå¡ç«¯çæµç¨ï¼ç¶åå°±å¯ä»¥æ¹éå¯¹æºå¨æ§è¡å½ä»¤è¯ä¸ï¼å¯ä»¥ææ¾æåå°éåº¦çæåã\n\n---\n\n\nä½æ¯è¦æ³¨æçæ¯ï¼ å¦æå¨ansibleä¸­ä½¿ç¨sudoå½ä»¤çè¯(ssh user@host sudo cmd)ï¼éè¦å¨è¢«æ§èç¹ç/etc/sudoersä¸­ç¦ç¨"requiretty"!!!!\n\nä¹æä»¥è¦è®¾ç½®/etc/sudoersä¸­çrequirettyï¼æ¯å ä¸ºsshè¿ç¨æ§è¡å½ä»¤æ¶ï¼å®çç¯å¢æ¯éç»å½å¼éäº¤äºå¼shellï¼é»è®¤ä¸ä¼åéttyï¼æ²¡ættyï¼sshçsudoå°±æ æ³å³é­å¯ç åæ¾(ä½¿ç¨ "-tt"éé¡¹å¼ºå¶SSHåétty)ãæä»¥åºäºå®å¨èèï¼/etc/sudoersä¸­é»è®¤æ¯å¼å¯requirettyçï¼å®è¦æ±åªææ¥ættyçç¨æ·æè½ä½¿ç¨sudoï¼ä¹å°±æ¯è¯´sshè¿æ¥è¿å»ä¸åè®¸æ§è¡sudoã å¯ä»¥éè¿visudoç¼è¾éç½®æä»¶ï¼æ³¨éè¯¥éé¡¹æ¥ç¦ç¨å®ã\n\n$ grep requiretty /etc/sudoersãã\n# Defaults  requiretty\n\n\n1\n2\n\n\n\n# ä¸ãå¼å¯SSHé¿è¿æ¥\n\nansibleå¤©ç¶æ¯æopensshï¼é»è®¤è¿æ¥æ¹å¼ä¸ï¼å®å¯¹sshçä¾èµæ§éå¸¸å¼ºãæä»¥ä¼åsshè¿æ¥ï¼å¨ä¸å®ç¨åº¦ä¸ä¹å¨ä¼åansibleãå¶ä¸­ä¸ç¹æ¯å¼å¯sshçé¿è¿æ¥ï¼å³é¿æ¶é´ä¿æè¿æ¥ç¶æã\n\nAnsibleæ¨¡å¼æ¯ä½¿ç¨SSHåè¿ç¨ä¸»æºè¿è¡éä¿¡, æä»¥Ansibleå¯¹SSHçä¾èµæ§éå¸¸å¼º, å¨OpenSSH 5.6çæ¬ä»¥åSSHå°±æ¯æäºMultiplexingï¼å¤è·¯å¤ç¨ï¼ã æä»¥å¦æAnsibleä¸­æ§æºçSSH -Vçæ¬é«äº5.6æ¶, å°±å¯ä»¥ä½¿ç¨ControlPersistæ¥æé«sshè¿æ¥éåº¦ï¼ä»èæé«ansibleæ§è¡æçã\n\n$ cat /etc/redhat-release \nCentOS Linux release 7.6.1810 (Core) \n\n$ ssh -V\nOpenSSH_7.4p1, OpenSSL 1.0.2k-fips  26 Jan 2017\n\n$ vim /etc/ansible/ansible.cfg\n..........\nssh_args = -C -o ControlMaster=auto -o ControlPersist=5d\n# æ³¨æï¼ConrolPersist=5d, è¿ä¸ªåæ°æ¯è®¾ç½®æ´ä¸ªé¿è¿æ¥ä¿ææ¶é´ä¸º5å¤©ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå¼å¯æ­¤åæ°çsshé¿è¿æ¥åè½åï¼å¨ä¼è¯è¿æåä¼ä¸ç´å»ºç«è¿æ¥ï¼å¨netstatçç»æä¸­ä¼çå°sshè¿æ¥æ¯ä¸ç´establishedç¶æï¼ä¸éè¿SSHè¿æ¥è¿çè®¾å¤é½ä¼å¨å½åç¨æ·å®¶ç®å½ç ".ansible/cp"ç®å½ä¸çæä¸ä¸ªsocketæä»¶ï¼æ¯ä¸ªä¼è¯å¯¹åºçæä¸ä¸ªsocketæä»¶ãä¹å¯ä»¥éè¿netstatå½ä»¤æ¥ç, ä¼åç°æä¸ä¸ªESTABLISHEDç¶æçè¿æ¥ä¸ç´ä¸è¿ç¨è®¾å¤è¿è¡çTCPè¿æ¥ã\n\n$ ps -ef|grep ssh|grep ansible\nroot      26064      1  0 17:32 ?        00:00:00 ssh: /root/.ansible/cp/cb9972d2a5 [mux]\nroot      26067      1  0 17:32 ?        00:00:00 ssh: /root/.ansible/cp/baefa88ac8 [mux]\n\n$ ps -ef|grep ssh|grep /root\nroot      26064      1  0 17:32 ?        00:00:00 ssh: /root/.ansible/cp/cb9972d2a5 [mux]\nroot      26067      1  0 17:32 ?        00:00:00 ssh: /root/.ansible/cp/baefa88ac8 [mux]\n\n$ ls /root/.ansible/cp/\nbaefa88ac8  cb9972d2a5\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\néè¦æ³¨æï¼ ControlPersist ç¹æ§éè¦é«çæ¬çSSHææ¯æï¼CentOS 6é»è®¤æ¯ä¸æ¯æçï¼å¦æéè¦ä½¿ç¨ï¼éè¦èªè¡åçº§opensshï¼ç¡®ä¿SSH -Vçæ¬é«äº5.6ï¼ã ControlPersistå³æä¹åsocketï¼ä¸æ¬¡éªè¯ï¼å¤æ¬¡éä¿¡ãå¹¶ä¸åªéè¦ä¿®æ¹ ssh å®¢æ·ç«¯å°±è¡ï¼ä¹å°±æ¯ Ansible æºå¨å³å¯ã\n\n\n# ä¸ãè®¾ç½®factsç¼å­\n\nå¦æç»å¿çè¯, å°±ä¼åç°æ§è¡playbookçæ¶å, é»è®¤ç¬¬ä¸ä¸ªtaské½æ¯GATHERING FACTS, è¿ä¸ªè¿ç¨å°±æ¯Ansibleå¨æ¶éæ¯å°ä¸»æºçfactsä¿¡æ¯ã æ¹ä¾¿æä»¬å¨playbookä¸­ç´æ¥é¥®ç¨factséçä¿¡æ¯ï¼å½ç¶å¦æä½ çplaybookä¸­ä¸éè¦factsä¿¡æ¯, å¯ä»¥å¨playbookä¸­è®¾ç½®"gather_facts: False"æ¥æé«playbookæç.\n\nä½æ¯å¦ææä»¬æ¢æ³å¨æ¯æ¬¡æ§è¡playbookçæ¶åé½è½æ¶éfacts, åæ³å éè¿ä¸ªæ¶éè¿ç¨, é£ä¹å°±éè¦éç½®factsç¼å­äºã\n\n# 3.1 ä½¿ç¨jsonæä»¶ç¼å­\n\n$ vim /etc/ansible/ansible.cfg\n.........\ngathering = smart\nfact_caching_timeout = 86400\nfact_caching = jsonfile\nfact_caching_connection = /dev/shm/ansible_fact_cache\n\n# æ­£å¸¸éç½®palybookï¼ä¸éè¦å³é­gathering factsåè½\n$ cat test.yml \n---\n- hosts: 10.4.7.101\n  remote_user: root\n  vars:\n    - list: [1,2,3]\n  tasks:\n    - name: this is loop\n      debug: msg="{{ item }}"\n      with_items: \'{{list}}\'\n\næ¥çè¿ä¸ªplaybookè¿ç¨ï¼ç¨æ¶6.699sï¼ç¬¬ä¸æ¬¡å¯è½ç¨å¾®æ¢ç¹ï¼ç¼å­ä¹åï¼åé¢æ§è¡å°±å¾å¿«äºï¼\n$ time ansible-playbook test.yml \n\nPLAY [10.4.7.101] *******************************************************************************************************************************\n\nTASK [Gathering Facts] **************************************************************************************************************************\nok: [10.4.7.101]\n\nTASK [this is loop] *****************************************************************************************************************************\nok: [10.4.7.101] => (item=1) => {\n    "msg": 1\n}\nok: [10.4.7.101] => (item=2) => {\n    "msg": 2\n}\nok: [10.4.7.101] => (item=3) => {\n    "msg": 3\n}\n\nPLAY RECAP **************************************************************************************************************************************\n10.4.7.101                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n\n\nreal    0m6.699s\nuser    0m1.301s\nsys     0m0.250s\n\n# å¦æå»æä¸é¢çfactsç¼å­çåè¡éç½®ï¼åæ¬¡æ§è¡ä¸é¢çplaybokï¼åç°ç¨æ¶10så·¦å³ï¼ï¼ï¼\n\n# æ¥çç¼å­æä»¶\n$ ls /dev/shm/ansible_fact_cache/\n10.4.7.101\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n\n\n# 3.2 ä½¿ç¨rediså­å¨factsæä»¶éå®è£redisï¼è¿éè¦å®è£pythonåº\n\n$ yum install redis\n$ yum -y install epel-release\n$ yum install python-pip\n$ pip install redis\n$ vim /etc/ansible/ansible.cfg\n........\ngathering = smart\nfacts_caching_timeout = 86400      #è®¾ç½®ç¼å­è¿ææ¶é´86400ç§\nfacts_caching = redis              # ä½¿ç¨redisæè (æèä½¿ç¨memcachedï¼å³"facts_caching = memcached")\nfact_caching_connection = 127.0.0.1:6379\n#è¥redisè®¾ç½®äºå¯ç ,æ¯å¦å¯ç ä¸º"admin"ï¼åéç½®ä¿®æ¹å¦ä¸ï¼\n# fact_caching_connection = localhost:6379:0:admin\n\n$ systemctl start redis\n$ lsof -i:6379\nCOMMAND     PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nredis-ser 26593 redis    4u  IPv4 125427      0t0  TCP localhost:6379 (LISTEN)\n\n$ time ansible-playbook test.yml \n\nPLAY [10.4.7.101] *******************************************************************************************************************************\n\nTASK [Gathering Facts] **************************************************************************************************************************\nok: [10.4.7.101]\n\nTASK [this is loop] *****************************************************************************************************************************\nok: [10.4.7.101] => (item=1) => {\n    "msg": 1\n}\nok: [10.4.7.101] => (item=2) => {\n    "msg": 2\n}\nok: [10.4.7.101] => (item=3) => {\n    "msg": 3\n}\n\nPLAY RECAP **************************************************************************************************************************************\n10.4.7.101                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n\n\nreal    0m6.720s\nuser    0m1.219s\nsys        0m0.338s\n\néè¦æ³¨æï¼\nå¨ä½¿ç¨redisç¼å­åï¼å¦æåºç°å¼å¸¸ï¼è¥æªåºç°ï¼è¯·å¿½ç¥ï¼ï¼TypeError: the JSON object must be str, not \'bytes\'ã\nè§£å³åæ³ï¼\n$ find / -name ansible\n$ vim /usr/lib/python2.7/site-packages/ansible/plugins/cache/redis.py\n..........\nself._cache[key] = json.loads(value.decode(\'utf-8\'))     # ä¿®æ¹ä¸ºè¿ä¸ª\n\næ¥çrediså­å¨æåµ\n$ redis-cli\n127.0.0.1:6379> keys *\n1) "ansible_facts10.4.7.101"\n2) "ansible_cache_keys"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\næ»ä¹ï¼ä¸åç½ç»ç¯å¢ä¸çèæ¶è¯å®æ¯ä¸åçï¼ä½æ¯è®¾ç½®ç¼å­æ¯è¯å®å¯ä»¥å å¿« Ansible è¿è¡éåº¦çï¼ç¹å«æ¯ playbook çè¿è¡ã\n\n\n# åãAnsibleåæ¶äº¤äº\n\n$ vim /etc/ansible/ansible.cfg\n........\nhost_key_checking = False          # æå¼æ³¨éå³å¯\n\n# åæ¶sshçyesånoçäº¤äºï¼\n$ vim /root/.ssh/config\nUserKnownHostsFile /dev/null\nConnectTimeout 15\nStrictHostKeyChecking no\n\næèç´æ¥sshæ¶å¢å ä¸ä¸ªåæ°\n$ ssh -o StrictHostKeyChecking=no -p22 root@10.4.7.101\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# äºãAnsibleç-téé¡¹ï¼æé«ansibleæ§è¡æç\n\nansibleç"-t"æ"--tree"éé¡¹æ¯å°ansibleçæ§è¡ç»ææä¸»æºåä¿å­å¨æå®ç®å½ä¸çæä»¶ä¸­ã\n\næäºæ¶åï¼ansibleæ§è¡èµ·æ¥çéåº¦ä¼éå¸¸æ¢ï¼è¿ç§æ¢ä½ç°å¨å³ä½¿æ§è¡çæ¯ä¸ä¸ªç«å³è¿åçç®åå½ä»¤(å¦pingæ¨¡å)ï¼ä¹ä¼èæ¶å¾ä¹ï¼ä¸ä¸æ¯å ä¸ºsshè¿æ¥æ¢å¯¼è´çã å¦æä½¿ç¨-téé¡¹ï¼å°ç¬¬ä¸æ¬¡æ§è¡å¾å°çç»ææinventoryä¸­å®ä¹çä¸»æºåä¿å­å¨æä»¶ä¸­ï¼ä¸æ¬¡æ§è¡å°åä¸å°ä¸»æºæ¶éåº¦å°ä¼åå¿«å¾å¤ï¼å³ä½¿ä¹åä¸åå ä¸-téé¡¹ï¼ ä¹å¯ä»¥å¨ä¸å®æ¶é´åä¿æè¿éæ§è¡ãå³ä½¿æ§è¡éåº¦æ­£å¸¸ï¼å¦æ§è¡ä¸ä¸ªPingå½ä»¤0.7ç§å·¦å³ï¼ï¼ä½¿ç¨-téé¡¹ä¹å¯ä»¥å¨æ­¤åºç¡ä¸åå¾æ´å¿«ã\n\né¤äºä½¿ç¨-téé¡¹ï¼ä½¿ç¨éå®åå°ç»æéå®åå°æä¸ªæä»¶ä¸­ä¹æ¯ä¸æ ·çææã è¿ä¹ç®æ¯ä¸ç§ansibleæéæ¹å¼ï¼ä½å¨centos6ä¸ä½¿ç¨ä½çæ¬ansibleæ¶ï¼ææ¶ä¼åºç°æ§è¡å¾æ¢çç°è±¡ï¼ä½ä¸æ¯æ¯æ¬¡é½è¿æ ·ï¼ä¸centos7æ§è¡éåº¦æ­£å¸¸ æä»¥è¿ä¹æ¯ä¸ç§"bug"å¼é®é¢ï¼æè¿ç§æ¹å¼æ²¡æéç¨æ§ã\n\n$ time ansible test_server -m command -a "hostname"\n$ time ansible test_server -m command -a "hostname" -t /tmp/test\n\n$ ll /tmp/test/\næ»ç¨é 8\n-rw-r--r--. 1 root root 236 2æ   7 17:59 10.4.7.101\n-rw-r--r--. 1 root root 307 2æ   7 17:59 10.4.7.102\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸é¢åäºå¯¹æ¯ï¼åç°ä½¿ç¨-tæéå®åæ¹å¼ï¼å°ansibleçæ§è¡ç»ææä¸»æºåä¿å­å¨æå®ç®å½ä¸çæä»¶ä¸­ï¼ansibleæ§è¡æçä¼æææåã\n\n*************** å½ä½ åç°èªå·±çæåæä¸èµ·éå¿æ¶ï¼å°±è¯·å®éä¸æ¥å­¦ä¹ å§ï¼***************',normalizedContent:'åæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14386197.html\n\n# [ansibleæ§è½ä¼åââæåansibleæ§è¡æç](https://www.cnblogs.com/lvzhenjiang/p/14386197.html)\n\n\n\nç®å½\n\n- [ä¸ãå³é­gathering factsåè½](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#ä¸ãå³é­gathering-factsåè½)\n- [äºãå¼å¯ssh pipelining](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#äºãå¼å¯ssh-pipelining)\n- [ä¸ãå¼å¯sshé¿è¿æ¥](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#ä¸ãå¼å¯sshé¿è¿æ¥)\n- ä¸ãè®¾ç½®factsç¼å­\n  - [3.1 ä½¿ç¨jsonæä»¶ç¼å­](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#31-ä½¿ç¨jsonæä»¶ç¼å­)\n  - [3.2 ä½¿ç¨rediså­å¨factsæä»¶éå®è£redisï¼è¿éè¦å®è£pythonåº](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#32-ä½¿ç¨rediså­å¨factsæä»¶éå®è£redisï¼è¿éè¦å®è£pythonåº)\n- [åãansibleåæ¶äº¤äº](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#åãansibleåæ¶äº¤äº)\n- [äºãansibleç-téé¡¹ï¼æé«ansibleæ§è¡æç](https://www.cnblogs.com/lvzhenjiang/p/14386197.html#äºãansibleç-téé¡¹ï¼æé«ansibleæ§è¡æç)\n\n\n\næåï¼ansibleçæ§è¡æçåsaltstack(åºäºzeromqæ¶æ¯éåçæ¹å¼)ç¸æ¯è¦æ¢çå¤çå¤ï¼ç¹å«æ¯è¢«æ§èç¹éå¾å¤§çæ¶åãä½æ¯ansibleåå±å°ç°å¨ï¼å®çæçå¾å°äºæå¤§çæ¹åãå¨è¢«æ§èç¹ä¸å¤ªå¤çæ¶åï¼é»è®¤çè®¾ç½®å·²ç»å¤å¿«ãå³ä½¿è¢«æ§èç¹æ°éå·¨å¤§çæ¶åï¼ä¹å¯ä»¥éè¿ä¸äºä¼åå»æå¤§çæé«ansibleçæ§è¡æçãæä»¥å¨ä½¿ç¨ ansible çè¿ç¨ä¸­ï¼å½ç®¡ççæå¡å¨æ°éå¢å æ¶ï¼ä¸å¾ä¸é¢å¯¹ä¸ä¸ªæ æ³é¿åçé®é¢æ§è¡æçæ¢ï¼è¿éååºä¸äºè§£å³åæ³ã\n\n### ä¸ãå³é­gathering factsåè½\n\nå¦æè§å¯è¿ansible-playbookçæ§è¡è¿ç¨ï¼å°±ä¼åç°ansible-playbookçç¬¬1ä¸ªæ­¥éª¤æ»æ¯æ§è¡gather factsï¼ä¸è®ºä½ ææ²¡æå¨playbookè®¾å®è¿ä¸ªtasksã\nå¦æä½ ä¸éè¦è·åè¢«æ§æºå¨çfactæ°æ®çè¯ï¼å°±å¯ä»¥å³é­è·åfactæ°æ®åè½ãå³é­ä¹åï¼å¯ä»¥å å¿«ansible-playbookçæ§è¡æçï¼å°¤å¶æ¯ä½ ç®¡çå¾å¤§éçæºå¨æ¶ï¼è¿éå¸¸ææ¾ã\nå³é­è·åfactså¾ç®åï¼åªéè¦å¨playbookæä»¶ä¸­å ä¸`"gather_facts: false"` æè `"gather_facts: no"`å³å¯ï¼falseånoé½ä¸ºå°åä¹å¯ä»¥ï¼ã\n\n```shell\n$ cat test.yml\n- hosts: test_server\n  remote_user: root\n\n  tasks:\n    - name: this is a test\n      shell: echo "haha"\n\n\n# æ§è¡è¿ä¸ªpalyï¼ä¼åç°ç¬¬ä¸ä¸ªæ§è¡çæ¯gather factsï¼å ä¸ºé»è®¤æ¯æå¼gather factsåè½çï¼ï¼ï¼ï¼\n$ ansible-playbook test.yml\n\nplay [test_server] ******************************************************************************************************\n\ntask [gathering facts] **************************************************************************************************\nok: [10.4.7.102]\nok: [10.4.7.101]\n\ntask [this is a test] ***************************************************************************************************\nchanged: [10.4.7.102]\nchanged: [10.4.7.101]\n\nplay recap **************************************************************************************************************\n10.4.7.101                 : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.4.7.102                 : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n```\n\n**ç°å¨å³é­gathering factsåè½**\n\n```shell\n$ cat test.yml\n- hosts: test_server\n  remote_user: root\n  gather_facts: false\n\n  tasks:\n    - name: this is a test\n      shell: echo "haha"\n\n# åæ§è¡è¿ä¸ªplayï¼å°±ä¼åç°æ²¡æäºgathering factsæ§è¡è¿ç¨ï¼æ´ä¸ªæ§è¡éåº¦ä¹å¿«äºï¼\n$ ansible-playbook test.yml\n\nplay [test_server] ******************************************************************************************************\n\ntask [this is a test] ***************************************************************************************************\nchanged: [10.4.7.102]\nchanged: [10.4.7.101]\n\nplay recap **************************************************************************************************************\n10.4.7.101                 : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.4.7.102                 : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n```\n\n### äºãå¼å¯ssh pipelining\n\npipelineæ¯opensshçä¸ä¸ªç¹æ§ï¼`ssh pipelining` æ¯ä¸ä¸ªå éansibleæ§è¡éåº¦çç®åæ¹æ³ã\n\nå¨ansibleæ§è¡æ¯ä¸ªä»»å¡çæ´ä¸ªæµç¨ä¸­ï¼æä¸ä¸ªè¿ç¨æ¯å°ä¸´æ¶ä»»å¡æä»¶putå°è¿ç¨çansibleå®¢æ·æºä¸ï¼ç¶åéè¿`ssh`è¿æ¥è¿å»è¿ç¨æ§è¡è¿ä¸ªä»»å¡ã\nå¦æå¼å¯äºpipeliningï¼ä¸ä¸ªä»»å¡çææå¨ä½é½å¨ä¸ä¸ª`ssh`ä¼è¯ä¸­å®æï¼ä¹ä¼çå»`sftp`å°è¿ç«¯çè¿ç¨ï¼å®ä¼ç´æ¥å°è¦æ§è¡çä»»å¡å¨`ssh`ä¼è¯ä¸­è¿è¡ã\n\nssh``pipelining é»è®¤æ¯å³é­!!!!ä¹æä»¥é»è®¤å³é­æ¯ä¸ºäºå¼å®¹ä¸åç`sudo`éç½®ï¼ä¸»è¦æ¯ requiretty éé¡¹ãå¦æä¸ä½¿ç¨`sudo`ï¼å»ºè®®å¼å¯ï¼ï¼ï¼\næå¼æ­¤éé¡¹å¯ä»¥åå°ansibleæ§è¡æ²¡æä¼ è¾æ¶`ssh`å¨è¢«æ§æºå¨ä¸æ§è¡ä»»å¡çè¿æ¥æ°ã\nä¸è¿ï¼å¦æä½¿ç¨`sudo`ï¼å¿é¡»å³é­requirettyéé¡¹ãä¿®æ¹`/etc/ansible/ansible.cfg` æä»¶å¯ä»¥å¼å¯pipelining\n\n```shell\n$ vim /etc/ansible/ansible.cfg\n........\npipelining = true\n```\n\nè¿æ ·å¼å¯äºpipeliningä¹å, ansibleæ§è¡çæ´ä¸ªæµç¨å°±å°äºä¸ä¸ªputèæ¬å»è¿ç¨æå¡ç«¯çæµç¨ï¼ç¶åå°±å¯ä»¥æ¹éå¯¹æºå¨æ§è¡å½ä»¤è¯ä¸ï¼å¯ä»¥ææ¾æåå°éåº¦çæåã\n\n---\n\n\nä½æ¯è¦æ³¨æçæ¯ï¼ å¦æå¨ansibleä¸­ä½¿ç¨sudoå½ä»¤çè¯(ssh user@host sudo cmd)ï¼éè¦å¨è¢«æ§èç¹ç/etc/sudoersä¸­ç¦ç¨"requiretty"!!!!\n\nä¹æä»¥è¦è®¾ç½®/etc/sudoersä¸­çrequirettyï¼æ¯å ä¸ºsshè¿ç¨æ§è¡å½ä»¤æ¶ï¼å®çç¯å¢æ¯éç»å½å¼éäº¤äºå¼shellï¼é»è®¤ä¸ä¼åéttyï¼æ²¡ættyï¼sshçsudoå°±æ æ³å³é­å¯ç åæ¾(ä½¿ç¨ "-tt"éé¡¹å¼ºå¶sshåétty)ãæä»¥åºäºå®å¨èèï¼/etc/sudoersä¸­é»è®¤æ¯å¼å¯requirettyçï¼å®è¦æ±åªææ¥ættyçç¨æ·æè½ä½¿ç¨sudoï¼ä¹å°±æ¯è¯´sshè¿æ¥è¿å»ä¸åè®¸æ§è¡sudoã å¯ä»¥éè¿visudoç¼è¾éç½®æä»¶ï¼æ³¨éè¯¥éé¡¹æ¥ç¦ç¨å®ã\n\n$ grep requiretty /etc/sudoersãã\n# defaults  requiretty\n\n\n1\n2\n\n\n\n# ä¸ãå¼å¯sshé¿è¿æ¥\n\nansibleå¤©ç¶æ¯æopensshï¼é»è®¤è¿æ¥æ¹å¼ä¸ï¼å®å¯¹sshçä¾èµæ§éå¸¸å¼ºãæä»¥ä¼åsshè¿æ¥ï¼å¨ä¸å®ç¨åº¦ä¸ä¹å¨ä¼åansibleãå¶ä¸­ä¸ç¹æ¯å¼å¯sshçé¿è¿æ¥ï¼å³é¿æ¶é´ä¿æè¿æ¥ç¶æã\n\nansibleæ¨¡å¼æ¯ä½¿ç¨sshåè¿ç¨ä¸»æºè¿è¡éä¿¡, æä»¥ansibleå¯¹sshçä¾èµæ§éå¸¸å¼º, å¨openssh 5.6çæ¬ä»¥åsshå°±æ¯æäºmultiplexingï¼å¤è·¯å¤ç¨ï¼ã æä»¥å¦æansibleä¸­æ§æºçssh -vçæ¬é«äº5.6æ¶, å°±å¯ä»¥ä½¿ç¨controlpersistæ¥æé«sshè¿æ¥éåº¦ï¼ä»èæé«ansibleæ§è¡æçã\n\n$ cat /etc/redhat-release \ncentos linux release 7.6.1810 (core) \n\n$ ssh -v\nopenssh_7.4p1, openssl 1.0.2k-fips  26 jan 2017\n\n$ vim /etc/ansible/ansible.cfg\n..........\nssh_args = -c -o controlmaster=auto -o controlpersist=5d\n# æ³¨æï¼conrolpersist=5d, è¿ä¸ªåæ°æ¯è®¾ç½®æ´ä¸ªé¿è¿æ¥ä¿ææ¶é´ä¸º5å¤©ã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå¼å¯æ­¤åæ°çsshé¿è¿æ¥åè½åï¼å¨ä¼è¯è¿æåä¼ä¸ç´å»ºç«è¿æ¥ï¼å¨netstatçç»æä¸­ä¼çå°sshè¿æ¥æ¯ä¸ç´establishedç¶æï¼ä¸éè¿sshè¿æ¥è¿çè®¾å¤é½ä¼å¨å½åç¨æ·å®¶ç®å½ç ".ansible/cp"ç®å½ä¸çæä¸ä¸ªsocketæä»¶ï¼æ¯ä¸ªä¼è¯å¯¹åºçæä¸ä¸ªsocketæä»¶ãä¹å¯ä»¥éè¿netstatå½ä»¤æ¥ç, ä¼åç°æä¸ä¸ªestablishedç¶æçè¿æ¥ä¸ç´ä¸è¿ç¨è®¾å¤è¿è¡çtcpè¿æ¥ã\n\n$ ps -ef|grep ssh|grep ansible\nroot      26064      1  0 17:32 ?        00:00:00 ssh: /root/.ansible/cp/cb9972d2a5 [mux]\nroot      26067      1  0 17:32 ?        00:00:00 ssh: /root/.ansible/cp/baefa88ac8 [mux]\n\n$ ps -ef|grep ssh|grep /root\nroot      26064      1  0 17:32 ?        00:00:00 ssh: /root/.ansible/cp/cb9972d2a5 [mux]\nroot      26067      1  0 17:32 ?        00:00:00 ssh: /root/.ansible/cp/baefa88ac8 [mux]\n\n$ ls /root/.ansible/cp/\nbaefa88ac8  cb9972d2a5\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\néè¦æ³¨æï¼ controlpersist ç¹æ§éè¦é«çæ¬çsshææ¯æï¼centos 6é»è®¤æ¯ä¸æ¯æçï¼å¦æéè¦ä½¿ç¨ï¼éè¦èªè¡åçº§opensshï¼ç¡®ä¿ssh -vçæ¬é«äº5.6ï¼ã controlpersistå³æä¹åsocketï¼ä¸æ¬¡éªè¯ï¼å¤æ¬¡éä¿¡ãå¹¶ä¸åªéè¦ä¿®æ¹ ssh å®¢æ·ç«¯å°±è¡ï¼ä¹å°±æ¯ ansible æºå¨å³å¯ã\n\n\n# ä¸ãè®¾ç½®factsç¼å­\n\nå¦æç»å¿çè¯, å°±ä¼åç°æ§è¡playbookçæ¶å, é»è®¤ç¬¬ä¸ä¸ªtaské½æ¯gathering facts, è¿ä¸ªè¿ç¨å°±æ¯ansibleå¨æ¶éæ¯å°ä¸»æºçfactsä¿¡æ¯ã æ¹ä¾¿æä»¬å¨playbookä¸­ç´æ¥é¥®ç¨factséçä¿¡æ¯ï¼å½ç¶å¦æä½ çplaybookä¸­ä¸éè¦factsä¿¡æ¯, å¯ä»¥å¨playbookä¸­è®¾ç½®"gather_facts: false"æ¥æé«playbookæç.\n\nä½æ¯å¦ææä»¬æ¢æ³å¨æ¯æ¬¡æ§è¡playbookçæ¶åé½è½æ¶éfacts, åæ³å éè¿ä¸ªæ¶éè¿ç¨, é£ä¹å°±éè¦éç½®factsç¼å­äºã\n\n# 3.1 ä½¿ç¨jsonæä»¶ç¼å­\n\n$ vim /etc/ansible/ansible.cfg\n.........\ngathering = smart\nfact_caching_timeout = 86400\nfact_caching = jsonfile\nfact_caching_connection = /dev/shm/ansible_fact_cache\n\n# æ­£å¸¸éç½®palybookï¼ä¸éè¦å³é­gathering factsåè½\n$ cat test.yml \n---\n- hosts: 10.4.7.101\n  remote_user: root\n  vars:\n    - list: [1,2,3]\n  tasks:\n    - name: this is loop\n      debug: msg="{{ item }}"\n      with_items: \'{{list}}\'\n\næ¥çè¿ä¸ªplaybookè¿ç¨ï¼ç¨æ¶6.699sï¼ç¬¬ä¸æ¬¡å¯è½ç¨å¾®æ¢ç¹ï¼ç¼å­ä¹åï¼åé¢æ§è¡å°±å¾å¿«äºï¼\n$ time ansible-playbook test.yml \n\nplay [10.4.7.101] *******************************************************************************************************************************\n\ntask [gathering facts] **************************************************************************************************************************\nok: [10.4.7.101]\n\ntask [this is loop] *****************************************************************************************************************************\nok: [10.4.7.101] => (item=1) => {\n    "msg": 1\n}\nok: [10.4.7.101] => (item=2) => {\n    "msg": 2\n}\nok: [10.4.7.101] => (item=3) => {\n    "msg": 3\n}\n\nplay recap **************************************************************************************************************************************\n10.4.7.101                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n\n\nreal    0m6.699s\nuser    0m1.301s\nsys     0m0.250s\n\n# å¦æå»æä¸é¢çfactsç¼å­çåè¡éç½®ï¼åæ¬¡æ§è¡ä¸é¢çplaybokï¼åç°ç¨æ¶10så·¦å³ï¼ï¼ï¼\n\n# æ¥çç¼å­æä»¶\n$ ls /dev/shm/ansible_fact_cache/\n10.4.7.101\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n\n\n# 3.2 ä½¿ç¨rediså­å¨factsæä»¶éå®è£redisï¼è¿éè¦å®è£pythonåº\n\n$ yum install redis\n$ yum -y install epel-release\n$ yum install python-pip\n$ pip install redis\n$ vim /etc/ansible/ansible.cfg\n........\ngathering = smart\nfacts_caching_timeout = 86400      #è®¾ç½®ç¼å­è¿ææ¶é´86400ç§\nfacts_caching = redis              # ä½¿ç¨redisæè (æèä½¿ç¨memcachedï¼å³"facts_caching = memcached")\nfact_caching_connection = 127.0.0.1:6379\n#è¥redisè®¾ç½®äºå¯ç ,æ¯å¦å¯ç ä¸º"admin"ï¼åéç½®ä¿®æ¹å¦ä¸ï¼\n# fact_caching_connection = localhost:6379:0:admin\n\n$ systemctl start redis\n$ lsof -i:6379\ncommand     pid  user   fd   type device size/off node name\nredis-ser 26593 redis    4u  ipv4 125427      0t0  tcp localhost:6379 (listen)\n\n$ time ansible-playbook test.yml \n\nplay [10.4.7.101] *******************************************************************************************************************************\n\ntask [gathering facts] **************************************************************************************************************************\nok: [10.4.7.101]\n\ntask [this is loop] *****************************************************************************************************************************\nok: [10.4.7.101] => (item=1) => {\n    "msg": 1\n}\nok: [10.4.7.101] => (item=2) => {\n    "msg": 2\n}\nok: [10.4.7.101] => (item=3) => {\n    "msg": 3\n}\n\nplay recap **************************************************************************************************************************************\n10.4.7.101                 : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n\n\nreal    0m6.720s\nuser    0m1.219s\nsys        0m0.338s\n\néè¦æ³¨æï¼\nå¨ä½¿ç¨redisç¼å­åï¼å¦æåºç°å¼å¸¸ï¼è¥æªåºç°ï¼è¯·å¿½ç¥ï¼ï¼typeerror: the json object must be str, not \'bytes\'ã\nè§£å³åæ³ï¼\n$ find / -name ansible\n$ vim /usr/lib/python2.7/site-packages/ansible/plugins/cache/redis.py\n..........\nself._cache[key] = json.loads(value.decode(\'utf-8\'))     # ä¿®æ¹ä¸ºè¿ä¸ª\n\næ¥çrediså­å¨æåµ\n$ redis-cli\n127.0.0.1:6379> keys *\n1) "ansible_facts10.4.7.101"\n2) "ansible_cache_keys"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\næ»ä¹ï¼ä¸åç½ç»ç¯å¢ä¸çèæ¶è¯å®æ¯ä¸åçï¼ä½æ¯è®¾ç½®ç¼å­æ¯è¯å®å¯ä»¥å å¿« ansible è¿è¡éåº¦çï¼ç¹å«æ¯ playbook çè¿è¡ã\n\n\n# åãansibleåæ¶äº¤äº\n\n$ vim /etc/ansible/ansible.cfg\n........\nhost_key_checking = false          # æå¼æ³¨éå³å¯\n\n# åæ¶sshçyesånoçäº¤äºï¼\n$ vim /root/.ssh/config\nuserknownhostsfile /dev/null\nconnecttimeout 15\nstricthostkeychecking no\n\næèç´æ¥sshæ¶å¢å ä¸ä¸ªåæ°\n$ ssh -o stricthostkeychecking=no -p22 root@10.4.7.101\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# äºãansibleç-téé¡¹ï¼æé«ansibleæ§è¡æç\n\nansibleç"-t"æ"--tree"éé¡¹æ¯å°ansibleçæ§è¡ç»ææä¸»æºåä¿å­å¨æå®ç®å½ä¸çæä»¶ä¸­ã\n\næäºæ¶åï¼ansibleæ§è¡èµ·æ¥çéåº¦ä¼éå¸¸æ¢ï¼è¿ç§æ¢ä½ç°å¨å³ä½¿æ§è¡çæ¯ä¸ä¸ªç«å³è¿åçç®åå½ä»¤(å¦pingæ¨¡å)ï¼ä¹ä¼èæ¶å¾ä¹ï¼ä¸ä¸æ¯å ä¸ºsshè¿æ¥æ¢å¯¼è´çã å¦æä½¿ç¨-téé¡¹ï¼å°ç¬¬ä¸æ¬¡æ§è¡å¾å°çç»ææinventoryä¸­å®ä¹çä¸»æºåä¿å­å¨æä»¶ä¸­ï¼ä¸æ¬¡æ§è¡å°åä¸å°ä¸»æºæ¶éåº¦å°ä¼åå¿«å¾å¤ï¼å³ä½¿ä¹åä¸åå ä¸-téé¡¹ï¼ ä¹å¯ä»¥å¨ä¸å®æ¶é´åä¿æè¿éæ§è¡ãå³ä½¿æ§è¡éåº¦æ­£å¸¸ï¼å¦æ§è¡ä¸ä¸ªpingå½ä»¤0.7ç§å·¦å³ï¼ï¼ä½¿ç¨-téé¡¹ä¹å¯ä»¥å¨æ­¤åºç¡ä¸åå¾æ´å¿«ã\n\né¤äºä½¿ç¨-téé¡¹ï¼ä½¿ç¨éå®åå°ç»æéå®åå°æä¸ªæä»¶ä¸­ä¹æ¯ä¸æ ·çææã è¿ä¹ç®æ¯ä¸ç§ansibleæéæ¹å¼ï¼ä½å¨centos6ä¸ä½¿ç¨ä½çæ¬ansibleæ¶ï¼ææ¶ä¼åºç°æ§è¡å¾æ¢çç°è±¡ï¼ä½ä¸æ¯æ¯æ¬¡é½è¿æ ·ï¼ä¸centos7æ§è¡éåº¦æ­£å¸¸ æä»¥è¿ä¹æ¯ä¸ç§"bug"å¼é®é¢ï¼æè¿ç§æ¹å¼æ²¡æéç¨æ§ã\n\n$ time ansible test_server -m command -a "hostname"\n$ time ansible test_server -m command -a "hostname" -t /tmp/test\n\n$ ll /tmp/test/\næ»ç¨é 8\n-rw-r--r--. 1 root root 236 2æ   7 17:59 10.4.7.101\n-rw-r--r--. 1 root root 307 2æ   7 17:59 10.4.7.102\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸é¢åäºå¯¹æ¯ï¼åç°ä½¿ç¨-tæéå®åæ¹å¼ï¼å°ansibleçæ§è¡ç»ææä¸»æºåä¿å­å¨æå®ç®å½ä¸çæä»¶ä¸­ï¼ansibleæ§è¡æçä¼æææåã\n\n*************** å½ä½ åç°èªå·±çæåæä¸èµ·éå¿æ¶ï¼å°±è¯·å®éä¸æ¥å­¦ä¹ å§ï¼***************',charsets:{cjk:!0}},{title:"ansibleä¹rolesç®åä½¿ç¨",frontmatter:{title:"ansibleä¹rolesç®åä½¿ç¨",categories:["ç³»åä¸é¢","ansible"],tags:["ansible"],date:"2022-12-09T20:53:07.000Z",permalink:"/pages/847542/",readingShow:"top",description:"ç®å½",meta:[{name:"image",content:"https://gitee.com/lvzhenjiang/document/raw/master/%E5%B0%8F%E4%B9%A6%E5%8C%A0/20200322142808.png"},{name:"twitter:title",content:"ansibleä¹rolesç®åä½¿ç¨"},{name:"twitter:description",content:"ç®å½"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gitee.com/lvzhenjiang/document/raw/master/%E5%B0%8F%E4%B9%A6%E5%8C%A0/20200322142808.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/05.ansible%E4%B9%8Broles%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ansibleä¹rolesç®åä½¿ç¨"},{property:"og:description",content:"ç®å½"},{property:"og:image",content:"https://gitee.com/lvzhenjiang/document/raw/master/%E5%B0%8F%E4%B9%A6%E5%8C%A0/20200322142808.png"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/05.ansible%E4%B9%8Broles%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:53:07.000Z"},{property:"article:tag",content:"ansible"},{itemprop:"name",content:"ansibleä¹rolesç®åä½¿ç¨"},{itemprop:"description",content:"ç®å½"},{itemprop:"image",content:"https://gitee.com/lvzhenjiang/document/raw/master/%E5%B0%8F%E4%B9%A6%E5%8C%A0/20200322142808.png"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/05.ansible%E4%B9%8Broles%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8.html",relativePath:"01.ä¸é¢/01.ansibleç³»åæç« /05.ansibleä¹rolesç®åä½¿ç¨.md",key:"v-23f7a879",path:"/pages/847542/",headers:[{level:3,title:"ä¸ãrolesç®ä»",slug:"ä¸ãrolesç®ä»",normalizedTitle:"ä¸ãrolesç®ä»",charIndex:28},{level:3,title:"äºãç®åçrolesç¤ºä¾",slug:"äºãç®åçrolesç¤ºä¾",normalizedTitle:"äºãç®åçrolesç¤ºä¾",charIndex:41},{level:3,title:"ä¸ãrolesç¤ºä¾äº",slug:"ä¸ãrolesç¤ºä¾äº",normalizedTitle:"ä¸ãrolesç¤ºä¾äº",charIndex:57}],headersStr:"ä¸ãrolesç®ä» äºãç®åçrolesç¤ºä¾ ä¸ãrolesç¤ºä¾äº",content:"# ansibleä¹rolesç®åä½¿ç¨\n\nç®å½\n\n * ä¸ãrolesç®ä»\n * äºãç®åçrolesç¤ºä¾\n * ä¸ãrolesç¤ºä¾äº\n\n\n# ä¸ãrolesç®ä»\n\nå°å¤ç§ä¸åçtasksçæä»¶éä¸­å­å¨å¨æä¸ªç®å½ä¸ï¼åè¯¥ç®å½å°±æ¯è§è²ï¼è§è²ä¸è¬å­æ¾å¨/etc/ansible/roles/ç®å½ä¸ï¼å¯éè¿ansibleçéç½®æä»¶æ¥è°æ´é»è®¤çè§è²ç®å½ï¼/etc/ansible/roles/ç®å½ä¸æå¾å¤å­ç®å½ï¼å¶ä¸­æ¯ä¸ä¸ªå­ç®å½å¯¹åºä¸ä¸ªè§è²ï¼æ¯ä¸ªè§è²ä¹æèªå·±çç®å½ç»æï¼å¦å¾ï¼\n\n\n\næ¯ä¸ªè§è²çå®ä¹ï¼ä»¥ç¹å®çå±çº§ç®å½ç»æè¿è¡ç»ç»ãæ¯å¦ï¼\n\n * filesï¼å­æ¾æcopyæscriptç­æ¨¡åè°ç¨çæä»¶ï¼\n * templatesï¼å­æ¾templateæ¨¡åæ¥æ¾æéè¦çæ¨¡æ¿æä»¶çç®å½ï¼\n * tasksï¼ä»»å¡å­æ¾çç®å½ï¼\n * handlersï¼å­æ¾ç¸å³è§¦åæ§è¡å¨çç®å½ï¼\n * varsï¼åéå­æ¾çç®å½ï¼\n * metaï¼ç¨äºå­æ¾æ­¤è§è²åæ°æ®ï¼\n * defaultï¼é»è®¤åéå­æ¾çç®å½ï¼æä»¶ä¸­å®ä¹äºæ­¤è§è²ä½¿ç¨çé»è®¤åéï¼\n\nä¸è¿°ç®å½ä¸­ï¼tasksãhandlersãvarsãmetaãdefaultè³å°åºè¯¥åå«ä¸ä¸ªmain.yamlæä»¶ï¼è¯¥ç®å½ä¸ä¹å¯ç±å¶ä».yamlæä»¶ï¼ä½æ¯éè¦å¨main.ymlæä»¶ä¸­ç¨includeæä»¤å°å¶ä».ymlæä»¶åå«èµ·æ¥ã\n\n\n# äºãç®åçrolesç¤ºä¾\n\n$ mkdir roles   \n#åå»ºä¸ä¸ªç®å½ï¼åç§°ä¸ºrolesãå®æ¹æ¨èå¨/etc/ansible/roles/è¿ä¸ªç®å½ï¼ä¸è¿å¨åªéé½æ¯å¯ä»¥ç\n$ mkdir roles/nginx\n$ cd roles/nginx/\n$ mkdir tasks templates\n$ cd tasks/\n$ cat user.yaml \n- name: create user\n  user: name=nginx uid=80 group=nginx system=yes shell=/sbin/nologin\n\n$ cat group.yaml \n- name: create group\n  group: name=nginx gid=80\n$ cat yum.yaml \n- name: install package\n  yum: name=nginx\n\n$ cat templ.yaml \n- name: copy conf\n  template: src=nginx.conf.j2 dest=/etc/nginx/nginx.conf \n\n$ cat stservice.yaml \n- name: start service\n  service: name=nginx state=started enabled=yes\n\n$ cat main.yaml \n- include: group.yaml\n- include: user.yaml\n- include: yum.yaml\n- include: templ.yaml\n- include: stservice.yaml\n#å¦æéè¦è°ç¨å«çè§è²çyamlæä»¶ï¼ä¹å¯ä»¥è¿æ ·åï¼æ¯å¦ï¼- includeï¼roles/httpd/tasks/copyfile.yaml\næ³¨æï¼copyfiile.yamlæä»¶ä¸­çæºè·¯å¾å¿é¡»æ¯ç»å¯¹è·¯å¾\n\n$ ls\nnginx.conf.j2\n#è¯¥æä»¶å°±æ¯nginxçéç½®æä»¶æ¹åäºèå·²\n$ cd ../../../\n$ cat nginx.yaml \n- hosts: webservers\n  remote_user: root\n  roles:\n    - role: nginx    \n#å®ä¹äºå¤ä¸ªè§è²ï¼ä¹å¯å¨æ¥çåï¼æ¯è¡è°ç¨ä¸ä¸ªè§è²\n#ä¹å¯ä»¥å®ä¹tagsæ ç­¾ï¼æ¯å¦ï¼- { rolesï¼ httpd ï¼tagsï¼['web','httpd']}æ- { rolesï¼ httpd ï¼tagsï¼'web'  å¦æéè¦å whenè¯­å¥ï¼å¨æ­¤å¤æ·»å  }é½å¯ä»¥\n$ ls\nnginx.yaml  roles\n#ç¡®ä¿è°ç¨nginxçyamlæä»¶æ¯årolesæ¯å¨åä¸ç®å½ä¸ç\n$ tree\n.\nâââ nginx.yaml\nâââ roles\n    âââ nginx\n        âââ tasks\n        â   âââ group.yaml\n        â   âââ main.yaml\n        â   âââ reservice.yaml\n        â   âââ stservice.yaml\n        â   âââ templ.yaml\n        â   âââ user.yaml\n        â   âââ yum.yaml\n        âââ templates\n            âââ nginx.conf.j2\n#ç¡®ä¿ç®å½çå±æ¬¡æææ¯è¿æ ·ç\n$ ansible-playbook nginx.yaml \n#å¦æå®ä¹äºæ ç­¾ï¼å°±å¯å¯¹æ ç­¾è¿è¡æä½ï¼æ¯å¦ï¼webæhttpdï¼\n$ ansible webservers -m shell -a 'ss -lntp | grep nginx'\n#ç¡®è®¤è¢«æ§ç«¯çä¸»æºnginxå·²ç»å¯å¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n\n\nä¸ä¸ªç®åçnginxçroleså·²ç»ç¼åå®æäºï¼\n\n\n# ä¸ãrolesç¤ºä¾äº\n\n$ mkdir app\n$ cd app/\n$ mkdir tasks templates vars handlers files\n$ cd tasks/\n$ cat group.yaml \n- name: create group\n  group: name=apache system=yes\n$ cat user.yaml \n- name: create user\n  user: name=apache group=apache system=yes shell=/sbin/nologin\n$ cat yum.yaml \n- name: install package\n  yum: name=httpd\n$ cat templ.yaml \n- name: copy file\n  template: src=httpd.conf.j2 dest=/etc/httpd/httpd.conf\n  notify: restart service\n\n$ cat copyfile.yaml \n- name: copy config\n  copy: src=vhosts.conf dest=/etc/httpd/conf.d/ owner=apache\n$ cat start.yaml \n- name: start service\n  service: name=httpd state=started\n$ cat main.yaml \n- include: group.yaml\n- include: user.yaml\n- include: yum.yaml\n- include: templ.yaml\n- include: copyfile.yaml\n- include: start.yaml\n$ ls files/vhosts.conf \nfiles/vhosts.conf\n#ç©ºæä»¶ç¨äºæµè¯\n$ cat handlers/main.yaml \n- name: restart service\n  service: name=httpd state=restarted\n$ cat templates/httpd.conf.j2 \n#httpdçéç½®æä»¶\n$ cat vars/main.yaml \nusername: apache\ngroupname: apache\n$ tree\n.\nâââ files\nâ   âââ vhosts.conf\nâââ handlers\nâ   âââ main.yaml\nâââ tasks\nâ   âââ copyfile.yaml\nâ   âââ group.yaml\nâ   âââ main.yaml\nâ   âââ start.yaml\nâ   âââ templ.yaml\nâ   âââ user.yaml\nâ   âââ yum.yaml\nâââ templates\nâ   âââ httpd.conf.j2\nâââ vars\n    âââ main.yaml\n#ç®å½ç»æ\n$ cat httpd.yaml \n---\n- hosts: webservers\n  remote_user: root\n  roles:\n    - httpd\n$ ls\nhttpd.yaml  nginx.yaml  roles\n#ç¡®ä¿ä¸rolesç®å½å¨åä¸ç®å½ä¸\n$ ansible-playbook httpd.yaml \n$ ansible all -m shell -a 'ps -ef | grep apache'\n//æ ¹æ®éç½®æä»¶ä¸­ä¿®æ¹çåå®¹èªè¡è¿è¡ä¿®æ¹\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n\n\n*************** å½ä½ åç°èªå·±çæåæä¸èµ·éå¿æ¶ï¼å°±è¯·å®éä¸æ¥å­¦ä¹ å§ï¼***************\n\nåæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14199463.html",normalizedContent:"# ansibleä¹rolesç®åä½¿ç¨\n\nç®å½\n\n * ä¸ãrolesç®ä»\n * äºãç®åçrolesç¤ºä¾\n * ä¸ãrolesç¤ºä¾äº\n\n\n# ä¸ãrolesç®ä»\n\nå°å¤ç§ä¸åçtasksçæä»¶éä¸­å­å¨å¨æä¸ªç®å½ä¸ï¼åè¯¥ç®å½å°±æ¯è§è²ï¼è§è²ä¸è¬å­æ¾å¨/etc/ansible/roles/ç®å½ä¸ï¼å¯éè¿ansibleçéç½®æä»¶æ¥è°æ´é»è®¤çè§è²ç®å½ï¼/etc/ansible/roles/ç®å½ä¸æå¾å¤å­ç®å½ï¼å¶ä¸­æ¯ä¸ä¸ªå­ç®å½å¯¹åºä¸ä¸ªè§è²ï¼æ¯ä¸ªè§è²ä¹æèªå·±çç®å½ç»æï¼å¦å¾ï¼\n\n\n\næ¯ä¸ªè§è²çå®ä¹ï¼ä»¥ç¹å®çå±çº§ç®å½ç»æè¿è¡ç»ç»ãæ¯å¦ï¼\n\n * filesï¼å­æ¾æcopyæscriptç­æ¨¡åè°ç¨çæä»¶ï¼\n * templatesï¼å­æ¾templateæ¨¡åæ¥æ¾æéè¦çæ¨¡æ¿æä»¶çç®å½ï¼\n * tasksï¼ä»»å¡å­æ¾çç®å½ï¼\n * handlersï¼å­æ¾ç¸å³è§¦åæ§è¡å¨çç®å½ï¼\n * varsï¼åéå­æ¾çç®å½ï¼\n * metaï¼ç¨äºå­æ¾æ­¤è§è²åæ°æ®ï¼\n * defaultï¼é»è®¤åéå­æ¾çç®å½ï¼æä»¶ä¸­å®ä¹äºæ­¤è§è²ä½¿ç¨çé»è®¤åéï¼\n\nä¸è¿°ç®å½ä¸­ï¼tasksãhandlersãvarsãmetaãdefaultè³å°åºè¯¥åå«ä¸ä¸ªmain.yamlæä»¶ï¼è¯¥ç®å½ä¸ä¹å¯ç±å¶ä».yamlæä»¶ï¼ä½æ¯éè¦å¨main.ymlæä»¶ä¸­ç¨includeæä»¤å°å¶ä».ymlæä»¶åå«èµ·æ¥ã\n\n\n# äºãç®åçrolesç¤ºä¾\n\n$ mkdir roles   \n#åå»ºä¸ä¸ªç®å½ï¼åç§°ä¸ºrolesãå®æ¹æ¨èå¨/etc/ansible/roles/è¿ä¸ªç®å½ï¼ä¸è¿å¨åªéé½æ¯å¯ä»¥ç\n$ mkdir roles/nginx\n$ cd roles/nginx/\n$ mkdir tasks templates\n$ cd tasks/\n$ cat user.yaml \n- name: create user\n  user: name=nginx uid=80 group=nginx system=yes shell=/sbin/nologin\n\n$ cat group.yaml \n- name: create group\n  group: name=nginx gid=80\n$ cat yum.yaml \n- name: install package\n  yum: name=nginx\n\n$ cat templ.yaml \n- name: copy conf\n  template: src=nginx.conf.j2 dest=/etc/nginx/nginx.conf \n\n$ cat stservice.yaml \n- name: start service\n  service: name=nginx state=started enabled=yes\n\n$ cat main.yaml \n- include: group.yaml\n- include: user.yaml\n- include: yum.yaml\n- include: templ.yaml\n- include: stservice.yaml\n#å¦æéè¦è°ç¨å«çè§è²çyamlæä»¶ï¼ä¹å¯ä»¥è¿æ ·åï¼æ¯å¦ï¼- includeï¼roles/httpd/tasks/copyfile.yaml\næ³¨æï¼copyfiile.yamlæä»¶ä¸­çæºè·¯å¾å¿é¡»æ¯ç»å¯¹è·¯å¾\n\n$ ls\nnginx.conf.j2\n#è¯¥æä»¶å°±æ¯nginxçéç½®æä»¶æ¹åäºèå·²\n$ cd ../../../\n$ cat nginx.yaml \n- hosts: webservers\n  remote_user: root\n  roles:\n    - role: nginx    \n#å®ä¹äºå¤ä¸ªè§è²ï¼ä¹å¯å¨æ¥çåï¼æ¯è¡è°ç¨ä¸ä¸ªè§è²\n#ä¹å¯ä»¥å®ä¹tagsæ ç­¾ï¼æ¯å¦ï¼- { rolesï¼ httpd ï¼tagsï¼['web','httpd']}æ- { rolesï¼ httpd ï¼tagsï¼'web'  å¦æéè¦å whenè¯­å¥ï¼å¨æ­¤å¤æ·»å  }é½å¯ä»¥\n$ ls\nnginx.yaml  roles\n#ç¡®ä¿è°ç¨nginxçyamlæä»¶æ¯årolesæ¯å¨åä¸ç®å½ä¸ç\n$ tree\n.\nâââ nginx.yaml\nâââ roles\n    âââ nginx\n        âââ tasks\n        â   âââ group.yaml\n        â   âââ main.yaml\n        â   âââ reservice.yaml\n        â   âââ stservice.yaml\n        â   âââ templ.yaml\n        â   âââ user.yaml\n        â   âââ yum.yaml\n        âââ templates\n            âââ nginx.conf.j2\n#ç¡®ä¿ç®å½çå±æ¬¡æææ¯è¿æ ·ç\n$ ansible-playbook nginx.yaml \n#å¦æå®ä¹äºæ ç­¾ï¼å°±å¯å¯¹æ ç­¾è¿è¡æä½ï¼æ¯å¦ï¼webæhttpdï¼\n$ ansible webservers -m shell -a 'ss -lntp | grep nginx'\n#ç¡®è®¤è¢«æ§ç«¯çä¸»æºnginxå·²ç»å¯å¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n\n\nä¸ä¸ªç®åçnginxçroleså·²ç»ç¼åå®æäºï¼\n\n\n# ä¸ãrolesç¤ºä¾äº\n\n$ mkdir app\n$ cd app/\n$ mkdir tasks templates vars handlers files\n$ cd tasks/\n$ cat group.yaml \n- name: create group\n  group: name=apache system=yes\n$ cat user.yaml \n- name: create user\n  user: name=apache group=apache system=yes shell=/sbin/nologin\n$ cat yum.yaml \n- name: install package\n  yum: name=httpd\n$ cat templ.yaml \n- name: copy file\n  template: src=httpd.conf.j2 dest=/etc/httpd/httpd.conf\n  notify: restart service\n\n$ cat copyfile.yaml \n- name: copy config\n  copy: src=vhosts.conf dest=/etc/httpd/conf.d/ owner=apache\n$ cat start.yaml \n- name: start service\n  service: name=httpd state=started\n$ cat main.yaml \n- include: group.yaml\n- include: user.yaml\n- include: yum.yaml\n- include: templ.yaml\n- include: copyfile.yaml\n- include: start.yaml\n$ ls files/vhosts.conf \nfiles/vhosts.conf\n#ç©ºæä»¶ç¨äºæµè¯\n$ cat handlers/main.yaml \n- name: restart service\n  service: name=httpd state=restarted\n$ cat templates/httpd.conf.j2 \n#httpdçéç½®æä»¶\n$ cat vars/main.yaml \nusername: apache\ngroupname: apache\n$ tree\n.\nâââ files\nâ   âââ vhosts.conf\nâââ handlers\nâ   âââ main.yaml\nâââ tasks\nâ   âââ copyfile.yaml\nâ   âââ group.yaml\nâ   âââ main.yaml\nâ   âââ start.yaml\nâ   âââ templ.yaml\nâ   âââ user.yaml\nâ   âââ yum.yaml\nâââ templates\nâ   âââ httpd.conf.j2\nâââ vars\n    âââ main.yaml\n#ç®å½ç»æ\n$ cat httpd.yaml \n---\n- hosts: webservers\n  remote_user: root\n  roles:\n    - httpd\n$ ls\nhttpd.yaml  nginx.yaml  roles\n#ç¡®ä¿ä¸rolesç®å½å¨åä¸ç®å½ä¸\n$ ansible-playbook httpd.yaml \n$ ansible all -m shell -a 'ps -ef | grep apache'\n//æ ¹æ®éç½®æä»¶ä¸­ä¿®æ¹çåå®¹èªè¡è¿è¡ä¿®æ¹\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n\n\n*************** å½ä½ åç°èªå·±çæåæä¸èµ·éå¿æ¶ï¼å°±è¯·å®éä¸æ¥å­¦ä¹ å§ï¼***************\n\nåæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14199463.html",charsets:{cjk:!0}},{title:"ansibleä¸­templateç®åä½¿ç¨",frontmatter:{title:"ansibleä¸­templateç®åä½¿ç¨",categories:["ç³»åä¸é¢","ansible"],tags:["ansible"],date:"2022-12-09T20:53:07.000Z",permalink:"/pages/4189b8/",readingShow:"top",description:"ç®å½",meta:[{name:"twitter:title",content:"ansibleä¸­templateç®åä½¿ç¨"},{name:"twitter:description",content:"ç®å½"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/06.ansible%E4%B8%ADtemplate%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ansibleä¸­templateç®åä½¿ç¨"},{property:"og:description",content:"ç®å½"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/06.ansible%E4%B8%ADtemplate%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:53:07.000Z"},{property:"article:tag",content:"ansible"},{itemprop:"name",content:"ansibleä¸­templateç®åä½¿ç¨"},{itemprop:"description",content:"ç®å½"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/06.ansible%E4%B8%ADtemplate%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8.html",relativePath:"01.ä¸é¢/01.ansibleç³»åæç« /06.ansibleä¸­templateç®åä½¿ç¨.md",key:"v-6f8ad9d9",path:"/pages/4189b8/",headers:[{level:3,title:"ä¸ãæ¨¡æ¿ï¼templateï¼ç®ä»",slug:"ä¸ãæ¨¡æ¿-template-ç®ä»",normalizedTitle:"ä¸ãæ¨¡æ¿ï¼templateï¼ç®ä»",charIndex:31},{level:3,title:"äºãä½¿ç¨templateé¨ç½²nginx",slug:"äºãä½¿ç¨templateé¨ç½²nginx",normalizedTitle:"äºãä½¿ç¨templateé¨ç½²nginx",charIndex:51},{level:3,title:"ä¸ãplaybookä¸­whenç®åä½¿ç¨",slug:"ä¸ãplaybookä¸­whenç®åä½¿ç¨",normalizedTitle:"ä¸ãplaybookä¸­whenç®åä½¿ç¨",charIndex:74},{level:3,title:"åãplaybookä¸­with_itemsç®åä½¿ç¨",slug:"åãplaybookä¸­with-itemsç®åä½¿ç¨",normalizedTitle:"åãplaybookä¸­with_itemsç®åä½¿ç¨",charIndex:97},{level:4,title:"4.1 è¿­ä»£ï¼with_items",slug:"_4-1-è¿­ä»£-with-items",normalizedTitle:"4.1 è¿­ä»£ï¼with_items",charIndex:128},{level:4,title:"4.2 è¿­ä»£åµå¥å­åé",slug:"_4-2-è¿­ä»£åµå¥å­åé",normalizedTitle:"4.2 è¿­ä»£åµå¥å­åé",charIndex:151},{level:3,title:"äºãtemplateå¾ªç¯ç¤ºä¾",slug:"äºãtemplateå¾ªç¯ç¤ºä¾",normalizedTitle:"äºãtemplateå¾ªç¯ç¤ºä¾",charIndex:166},{level:4,title:"5.1 ç¬¬ä¸ç§åæ³",slug:"_5-1-ç¬¬ä¸ç§åæ³",normalizedTitle:"5.1 ç¬¬ä¸ç§åæ³",charIndex:186},{level:4,title:"5.2 ç¬¬äºç§åæ³",slug:"_5-2-ç¬¬äºç§åæ³",normalizedTitle:"5.2 ç¬¬äºç§åæ³",charIndex:201},{level:4,title:"5.3 ç¬¬ä¸ç§åæ³",slug:"_5-3-ç¬¬ä¸ç§åæ³",normalizedTitle:"5.3 ç¬¬ä¸ç§åæ³",charIndex:216},{level:3,title:"å­ãplaybookä¸­ifç®åä½¿ç¨",slug:"å­ãplaybookä¸­ifç®åä½¿ç¨",normalizedTitle:"å­ãplaybookä¸­ifç®åä½¿ç¨",charIndex:229}],headersStr:"ä¸ãæ¨¡æ¿ï¼templateï¼ç®ä» äºãä½¿ç¨templateé¨ç½²nginx ä¸ãplaybookä¸­whenç®åä½¿ç¨ åãplaybookä¸­with_itemsç®åä½¿ç¨ 4.1 è¿­ä»£ï¼with_items 4.2 è¿­ä»£åµå¥å­åé äºãtemplateå¾ªç¯ç¤ºä¾ 5.1 ç¬¬ä¸ç§åæ³ 5.2 ç¬¬äºç§åæ³ 5.3 ç¬¬ä¸ç§åæ³ å­ãplaybookä¸­ifç®åä½¿ç¨",content:"# ansibleä¸­templateç®åä½¿ç¨\n\nç®å½\n\n * ä¸ãæ¨¡æ¿ï¼templateï¼ç®ä»\n * äºãä½¿ç¨templateé¨ç½²nginx\n * ä¸ãplaybookä¸­whenç®åä½¿ç¨\n * åãplaybookä¸­with_itemsç®åä½¿ç¨\n   * 4.1 è¿­ä»£ï¼with_items\n   * 4.2 è¿­ä»£åµå¥å­åé\n * äºãtemplateå¾ªç¯ç¤ºä¾\n   * 5.1 ç¬¬ä¸ç§åæ³\n   * 5.2 ç¬¬äºç§åæ³\n   * 5.3 ç¬¬ä¸ç§åæ³\n * å­ãplaybookä¸­ifç®åä½¿ç¨\n\n\n# ä¸ãæ¨¡æ¿ï¼templateï¼ç®ä»\n\n * æä»¶æä»¶ï¼åµå¥æèæ¬ï¼ä½¿ç¨æ¨¡æ¿ç¼ç¨è¯­è¨ç¼åï¼ï¼\n * jinja2è¯­è¨ï¼ä½¿ç¨å­é¢éï¼æä»¥ä¸å½¢å¼ï¼\n   * å­ç¬¦ä¸²ï¼ä½¿ç¨åå¼å·æåå¼å·ï¼\n   * æ°å­ï¼æ´æ°ï¼æµ®ç¹æ°ï¼\n   * åè¡¨ï¼[ item1,item2,â¦â¦]\n   * åç»ï¼(item1,item2,â¦â¦)\n   * å­å¸ï¼{key1:value1,key2,value2,â¦â¦}\n   * å¸å°åï¼true/false\n * ç®æ¯è¿ç®ï¼+ï¼-ï¼*ï¼/ï¼//ï¼%ï¼**\n * æ¯è¾æä½ï¼==ï¼!=ï¼>ï¼>=ï¼<ï¼<=\n * é»è¾è¿ç®ï¼andï¼orï¼not\n * æµè¡¨è¾¾å¼ï¼forï¼ifï¼when\n\n\n# äºãä½¿ç¨templateé¨ç½²nginx\n\n$ ls     //å»ºè®®ï¼å®è£nginxçyamlåtemplatesç®å½å¨åä¸ç®å½ä¸\ninstall_nginx.yaml  templates\n$ cat install_nginx.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:         #åå»ºåéä¿¡æ¯\n    - http_port: 8888\n\n  tasks:\n    - name: install package\n      yum: name=nginx\n    - name: template copy\n      template: src=nginx.conf.j2 dest=/etc/nginx/nginx.conf   #ç±äºæ¨¡æ¿æä»¶å¨tmplateä¸ï¼æä»¥srcåçè·¯å¾å°±å¯ä»¥åªåéç½®æä»¶åç§°\n      notify: restart service    #å®ä¹notifyä¾¿äºä¿®æ¹æä»¶éå¯æå¡\n    - name: start service\n      service: name=nginx state=started enabled=yes\n\n  handlers:    #å®ä¹éå¯æå¡ç­ç¥\n    - name: restart service\n      service: name=nginx state=restarted\n$ ls templates/     #æ³¨ææ¨¡æ¿çæä»¶åç§°æä¸å®çè¦æ±\nnginx.conf.j2\n$ cat templates/nginx.conf.j2    #è¯¥æä»¶å°±æ¯nginxçéç½®æä»¶å¤å¶èæç\nâ¦â¦â¦â¦      #çç¥é¨ååå®¹\nworker_processes {{ ansible_processor_vcpus**2 }};    #ä½¿ç¨åéæ¯cpuæ ¸å¿æ°ç2æ¬¡æ¹\nlisten       {{ http_port }} default_server;\nlisten       [::]:{{ http_port }} default_server;\n#ä½¿ç¨playbookä¸­å®ä¹çåéä¿¡æ¯\n$ ansible-playbook install_nginx.yaml\n#è¿è¡playbookæä»¶\n$ ansible webservers -m shell -a 'rpm -q nginx'\n#nginxç¡®å®å·²ç»å®è£æå\n$ ansible webservers -m shell -a 'ss -lnt | grep 8888' \n#ç«¯å£å·²ç»æ­£å¸¸å¼å¯\n$ ansible webservers -m shell -a 'ps aux | grep nginx'\n#ç¡®è®¤å·¥ä½è¿ç¨æ°æ¯é¢æè®¾å®çå¼\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\nè³æ­¤templateæ¹éé¨ç½²nginxå·²ç»å®ç°ï¼\n\n\n# ä¸ãplaybookä¸­whenç®åä½¿ç¨\n\nwhenï¼å¯ä»¥ç®åçè§£ä¸ºä¸ä¸ªæ¡ä»¶å¤æ­ï¼ç±»ä¼¼äºshellèæ¬ä¸­çifè¯­å¥ï¼\n\nå ä¸ºansibleç®¡ççä¸»æºå¯è½ä¸æ¯ä¸ä¸ªç³»ç»çæ¬çï¼é£ä¹å°±éè¦åºå«é¨ç½²äºï¼\n\n$ ansible all -m setup -a 'filter=*distribution*'\n#æ¥çansibleé»è®¤æ¯æçåé\n$ cat install_nginx.yaml \n---\n- hosts: all     #éå¯¹ææä¸»æº\n  remote_user: root\n  vars:\n    - http_port: 8888\n\n  tasks:\n    - name: install package\n      yum: name=nginx\n    - name: template copy for centos7\n      template: src=nginx.conf7.j2 dest=/etc/nginx/nginx.conf\n      when: ansible_distribution_major_version == \"7\"    #å½æ£æµå°ç³»ç»çæ¬ä¸º7ææ§è¡æ¬æ¨¡åçæä½\n      notify: restart service\n    - name: template copy for centos6\n      template: src=nginx.conf6.j2 dest=/etc/nginx/nginx.conf\n      when: ansible_distribution_major_version == \"6\"\n      notify: restart service\n    - name: start service\n      service: name=nginx state=started enabled=yes\n\n  handlers:\n    - name: restart service\n      service: name=nginx state=restarted\n$ ls templates/   #æ³¨æä¸ä¸ªæ¯nginx6çéç½®æä»¶ï¼ä¸ä¸ªnginx7çéç½®æä»¶\nnginx.conf6.j2  nginx.conf7.j2\n$ ansible-playbook install_nginx.yaml\n#æ§è¡playbookæä»¶\n$ ansible all -m shell -a 'ss -lntp | grep nginx'\n#ç¡®è®¤centos 6ç³»ç»çnginxå·²ç»å¯å¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# åãplaybookä¸­with_itemsç®åä½¿ç¨\n\n# 4.1 è¿­ä»£ï¼with_items\n\nè¿­ä»£ï¼with_itemsï¼å½æéè¦éå¤æ§æ§è¡ä»»å¡æ¯ï¼å¯ä»¥ä½¿ç¨è¿­ä»£æºå¶ï¼\n\n * å¸¦è¿­ä»£é¡¹çå¼ç¨ï¼åºå®åéä¸ºâitemâï¼\n * å¨taskä¸­ä½¿ç¨with_itemså®ä¹éè¦è¿­ä»£çåç´ åè¡¨ï¼\n * åè¡¨æ ¼å¼ï¼\n   * å­ç¬¦ä¸²ï¼\n   * å­å¸ï¼\n\n$ cat test.yaml \n---\n- hosts: all\n  remote_user: root\n\n  tasks:\n    - name: touch some file\n      file: name=/data/{{ item }} state=touch   #æä»¶åå®ä¹ä¸ºåè¡¨åç´ \n      when: ansible_distribution_major_version == \"7\"\n      with_items:      #å®ä¹åè¡¨åç´ \n        - file1\n        - file2\n        - file3\n$ ansible-playbook test.yaml\n$ ansible all -m shell -a 'ls -l /data'\n#å½æ»¡è¶³æ¡ä»¶çä¸»æºé½åå»ºäºæä»¶\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# 4.2 è¿­ä»£åµå¥å­åé\n\n$ cat test1.yaml \n---\n- hosts: all\n  remote_user: root\n\n  tasks:\n    - name: create some group\n      group: name={{ item }}\n      with_items:\n        - g1\n        - g2\n        - g3\n    - name: create some users\n      user: name={{ item.name }} group={{ item.group }}\n      with_items:\n        - { name: 'user1', group: 'g1'}\n        - { name: 'user2', group: 'g2'}\n        - { name: 'user3', group: 'g3'}\n$ ansible-playbook test1.yaml\n$ ansible all -m shell -a 'getent group'\n$ ansible all -m shell -a 'getent passwd'\n$ ansible all -m shell -a 'id user1'\n#è¿è¡éªè¯\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# äºãtemplateå¾ªç¯ç¤ºä¾\n\n# 5.1 ç¬¬ä¸ç§åæ³\n\n$ cat test2.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:\n    ports:\n      - 81\n      - 82\n      - 83\n\n  tasks:\n    - name: copy conf\n      template: src=for2.conf.j2 dest=/data/for2.conf\n$ cat templates/for2.conf.j2 \n{% for port in ports %}\nserver {\n    listen {{ port }}\n}\n{% endfor %}\n$ ansible-playbook test2.yaml\n$ ansible webservers -m shell -a 'cat /data/for2.conf'\n#è¿è¡éªè¯\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# 5.2 ç¬¬äºç§åæ³\n\n$ cat test3.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:\n    ports:\n      - listen_port: 81\n      - listen_port: 82\n      - listen_port: 83\n\n  tasks:\n    - name: copy conf\n      template: src=for3.conf.j2 dest=/data/for3.conf\n$ cat templates/for3.conf.j2 \n{% for port in ports %}\nserver {\n    listen {{ port.listen_port }}\n}\n{% endfor %}\n$ ansible-playbook test3.yaml\n$ ansible webservers -m shell -a 'cat /data/for3.conf'\n#è¿è¡éªè¯  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# 5.3 ç¬¬ä¸ç§åæ³\n\n$ cat test4.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:\n    ports:\n      - web1:\n        port: 81\n        name: web1.lzj.com\n        rootdir: /data/web1\n      - web2:\n        port: 82\n        name: web2.lzj.com\n        rootdir: /data/web2\n      - web1:\n        port: 83\n        name: web3.lzj.com\n        rootdir: /data/web3\n\n  tasks:\n    - name: copy conf\n      template: src=for4.conf.j2 dest=/data/for4.conf\n$ cat templates/for4.conf.j2 \n{% for p in ports %}\nserver {\n    listen {{ p.port }}\n    servername {{ p.name }}\n    documentroot {{ p.rootdir }}\n}\n{% endfor %}\n$ ansible-playbook test4.yaml\n$ ansible webservers -m shell -a 'cat /data/for4.conf'\n#è¿è¡éªè¯\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\n\n# å­ãplaybookä¸­ifç®åä½¿ç¨\n\n$ cat test5.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:\n    ports:\n      - web1:\n        port: 81\n        rootdir: /data/web1\n      - web2:\n        port: 82\n        name: web2.lzj.com\n        rootdir: /data/web2\n      - web1:\n        port: 83\n        rootdir: /data/web3\n\n  tasks:\n    - name: copy conf\n      template: src=for5.conf.j2 dest=/data/for5.conf\n$ cat templates/for5.conf.j2 \n{% for p in ports %}\nserver {\n    listen {{ p.port }}\n{% if p.name is defined%}    #å¦æåç§°è¢«å®ä¹äºæç»åå­èµå¼\n    servername {{ p.name }}\n{% endif %}\n    documentroot {{ p.rootdir }}\n}\n{% endfor %}\n$ ansible-playbook test5.yaml      \n$ ansible webservers -m shell -a 'cat /data/for5.conf'\n#è¿è¡éªè¯\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\n*************** å½ä½ åç°èªå·±çæåæä¸èµ·éå¿æ¶ï¼å°±è¯·å®éä¸æ¥å­¦ä¹ å§ï¼***************\n\nåæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14199384.html",normalizedContent:"# ansibleä¸­templateç®åä½¿ç¨\n\nç®å½\n\n * ä¸ãæ¨¡æ¿ï¼templateï¼ç®ä»\n * äºãä½¿ç¨templateé¨ç½²nginx\n * ä¸ãplaybookä¸­whenç®åä½¿ç¨\n * åãplaybookä¸­with_itemsç®åä½¿ç¨\n   * 4.1 è¿­ä»£ï¼with_items\n   * 4.2 è¿­ä»£åµå¥å­åé\n * äºãtemplateå¾ªç¯ç¤ºä¾\n   * 5.1 ç¬¬ä¸ç§åæ³\n   * 5.2 ç¬¬äºç§åæ³\n   * 5.3 ç¬¬ä¸ç§åæ³\n * å­ãplaybookä¸­ifç®åä½¿ç¨\n\n\n# ä¸ãæ¨¡æ¿ï¼templateï¼ç®ä»\n\n * æä»¶æä»¶ï¼åµå¥æèæ¬ï¼ä½¿ç¨æ¨¡æ¿ç¼ç¨è¯­è¨ç¼åï¼ï¼\n * jinja2è¯­è¨ï¼ä½¿ç¨å­é¢éï¼æä»¥ä¸å½¢å¼ï¼\n   * å­ç¬¦ä¸²ï¼ä½¿ç¨åå¼å·æåå¼å·ï¼\n   * æ°å­ï¼æ´æ°ï¼æµ®ç¹æ°ï¼\n   * åè¡¨ï¼[ item1,item2,â¦â¦]\n   * åç»ï¼(item1,item2,â¦â¦)\n   * å­å¸ï¼{key1:value1,key2,value2,â¦â¦}\n   * å¸å°åï¼true/false\n * ç®æ¯è¿ç®ï¼+ï¼-ï¼*ï¼/ï¼//ï¼%ï¼**\n * æ¯è¾æä½ï¼==ï¼!=ï¼>ï¼>=ï¼<ï¼<=\n * é»è¾è¿ç®ï¼andï¼orï¼not\n * æµè¡¨è¾¾å¼ï¼forï¼ifï¼when\n\n\n# äºãä½¿ç¨templateé¨ç½²nginx\n\n$ ls     //å»ºè®®ï¼å®è£nginxçyamlåtemplatesç®å½å¨åä¸ç®å½ä¸\ninstall_nginx.yaml  templates\n$ cat install_nginx.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:         #åå»ºåéä¿¡æ¯\n    - http_port: 8888\n\n  tasks:\n    - name: install package\n      yum: name=nginx\n    - name: template copy\n      template: src=nginx.conf.j2 dest=/etc/nginx/nginx.conf   #ç±äºæ¨¡æ¿æä»¶å¨tmplateä¸ï¼æä»¥srcåçè·¯å¾å°±å¯ä»¥åªåéç½®æä»¶åç§°\n      notify: restart service    #å®ä¹notifyä¾¿äºä¿®æ¹æä»¶éå¯æå¡\n    - name: start service\n      service: name=nginx state=started enabled=yes\n\n  handlers:    #å®ä¹éå¯æå¡ç­ç¥\n    - name: restart service\n      service: name=nginx state=restarted\n$ ls templates/     #æ³¨ææ¨¡æ¿çæä»¶åç§°æä¸å®çè¦æ±\nnginx.conf.j2\n$ cat templates/nginx.conf.j2    #è¯¥æä»¶å°±æ¯nginxçéç½®æä»¶å¤å¶èæç\nâ¦â¦â¦â¦      #çç¥é¨ååå®¹\nworker_processes {{ ansible_processor_vcpus**2 }};    #ä½¿ç¨åéæ¯cpuæ ¸å¿æ°ç2æ¬¡æ¹\nlisten       {{ http_port }} default_server;\nlisten       [::]:{{ http_port }} default_server;\n#ä½¿ç¨playbookä¸­å®ä¹çåéä¿¡æ¯\n$ ansible-playbook install_nginx.yaml\n#è¿è¡playbookæä»¶\n$ ansible webservers -m shell -a 'rpm -q nginx'\n#nginxç¡®å®å·²ç»å®è£æå\n$ ansible webservers -m shell -a 'ss -lnt | grep 8888' \n#ç«¯å£å·²ç»æ­£å¸¸å¼å¯\n$ ansible webservers -m shell -a 'ps aux | grep nginx'\n#ç¡®è®¤å·¥ä½è¿ç¨æ°æ¯é¢æè®¾å®çå¼\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\nè³æ­¤templateæ¹éé¨ç½²nginxå·²ç»å®ç°ï¼\n\n\n# ä¸ãplaybookä¸­whenç®åä½¿ç¨\n\nwhenï¼å¯ä»¥ç®åçè§£ä¸ºä¸ä¸ªæ¡ä»¶å¤æ­ï¼ç±»ä¼¼äºshellèæ¬ä¸­çifè¯­å¥ï¼\n\nå ä¸ºansibleç®¡ççä¸»æºå¯è½ä¸æ¯ä¸ä¸ªç³»ç»çæ¬çï¼é£ä¹å°±éè¦åºå«é¨ç½²äºï¼\n\n$ ansible all -m setup -a 'filter=*distribution*'\n#æ¥çansibleé»è®¤æ¯æçåé\n$ cat install_nginx.yaml \n---\n- hosts: all     #éå¯¹ææä¸»æº\n  remote_user: root\n  vars:\n    - http_port: 8888\n\n  tasks:\n    - name: install package\n      yum: name=nginx\n    - name: template copy for centos7\n      template: src=nginx.conf7.j2 dest=/etc/nginx/nginx.conf\n      when: ansible_distribution_major_version == \"7\"    #å½æ£æµå°ç³»ç»çæ¬ä¸º7ææ§è¡æ¬æ¨¡åçæä½\n      notify: restart service\n    - name: template copy for centos6\n      template: src=nginx.conf6.j2 dest=/etc/nginx/nginx.conf\n      when: ansible_distribution_major_version == \"6\"\n      notify: restart service\n    - name: start service\n      service: name=nginx state=started enabled=yes\n\n  handlers:\n    - name: restart service\n      service: name=nginx state=restarted\n$ ls templates/   #æ³¨æä¸ä¸ªæ¯nginx6çéç½®æä»¶ï¼ä¸ä¸ªnginx7çéç½®æä»¶\nnginx.conf6.j2  nginx.conf7.j2\n$ ansible-playbook install_nginx.yaml\n#æ§è¡playbookæä»¶\n$ ansible all -m shell -a 'ss -lntp | grep nginx'\n#ç¡®è®¤centos 6ç³»ç»çnginxå·²ç»å¯å¨\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n\n# åãplaybookä¸­with_itemsç®åä½¿ç¨\n\n# 4.1 è¿­ä»£ï¼with_items\n\nè¿­ä»£ï¼with_itemsï¼å½æéè¦éå¤æ§æ§è¡ä»»å¡æ¯ï¼å¯ä»¥ä½¿ç¨è¿­ä»£æºå¶ï¼\n\n * å¸¦è¿­ä»£é¡¹çå¼ç¨ï¼åºå®åéä¸ºâitemâï¼\n * å¨taskä¸­ä½¿ç¨with_itemså®ä¹éè¦è¿­ä»£çåç´ åè¡¨ï¼\n * åè¡¨æ ¼å¼ï¼\n   * å­ç¬¦ä¸²ï¼\n   * å­å¸ï¼\n\n$ cat test.yaml \n---\n- hosts: all\n  remote_user: root\n\n  tasks:\n    - name: touch some file\n      file: name=/data/{{ item }} state=touch   #æä»¶åå®ä¹ä¸ºåè¡¨åç´ \n      when: ansible_distribution_major_version == \"7\"\n      with_items:      #å®ä¹åè¡¨åç´ \n        - file1\n        - file2\n        - file3\n$ ansible-playbook test.yaml\n$ ansible all -m shell -a 'ls -l /data'\n#å½æ»¡è¶³æ¡ä»¶çä¸»æºé½åå»ºäºæä»¶\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n# 4.2 è¿­ä»£åµå¥å­åé\n\n$ cat test1.yaml \n---\n- hosts: all\n  remote_user: root\n\n  tasks:\n    - name: create some group\n      group: name={{ item }}\n      with_items:\n        - g1\n        - g2\n        - g3\n    - name: create some users\n      user: name={{ item.name }} group={{ item.group }}\n      with_items:\n        - { name: 'user1', group: 'g1'}\n        - { name: 'user2', group: 'g2'}\n        - { name: 'user3', group: 'g3'}\n$ ansible-playbook test1.yaml\n$ ansible all -m shell -a 'getent group'\n$ ansible all -m shell -a 'getent passwd'\n$ ansible all -m shell -a 'id user1'\n#è¿è¡éªè¯\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\n\n# äºãtemplateå¾ªç¯ç¤ºä¾\n\n# 5.1 ç¬¬ä¸ç§åæ³\n\n$ cat test2.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:\n    ports:\n      - 81\n      - 82\n      - 83\n\n  tasks:\n    - name: copy conf\n      template: src=for2.conf.j2 dest=/data/for2.conf\n$ cat templates/for2.conf.j2 \n{% for port in ports %}\nserver {\n    listen {{ port }}\n}\n{% endfor %}\n$ ansible-playbook test2.yaml\n$ ansible webservers -m shell -a 'cat /data/for2.conf'\n#è¿è¡éªè¯\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# 5.2 ç¬¬äºç§åæ³\n\n$ cat test3.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:\n    ports:\n      - listen_port: 81\n      - listen_port: 82\n      - listen_port: 83\n\n  tasks:\n    - name: copy conf\n      template: src=for3.conf.j2 dest=/data/for3.conf\n$ cat templates/for3.conf.j2 \n{% for port in ports %}\nserver {\n    listen {{ port.listen_port }}\n}\n{% endfor %}\n$ ansible-playbook test3.yaml\n$ ansible webservers -m shell -a 'cat /data/for3.conf'\n#è¿è¡éªè¯  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# 5.3 ç¬¬ä¸ç§åæ³\n\n$ cat test4.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:\n    ports:\n      - web1:\n        port: 81\n        name: web1.lzj.com\n        rootdir: /data/web1\n      - web2:\n        port: 82\n        name: web2.lzj.com\n        rootdir: /data/web2\n      - web1:\n        port: 83\n        name: web3.lzj.com\n        rootdir: /data/web3\n\n  tasks:\n    - name: copy conf\n      template: src=for4.conf.j2 dest=/data/for4.conf\n$ cat templates/for4.conf.j2 \n{% for p in ports %}\nserver {\n    listen {{ p.port }}\n    servername {{ p.name }}\n    documentroot {{ p.rootdir }}\n}\n{% endfor %}\n$ ansible-playbook test4.yaml\n$ ansible webservers -m shell -a 'cat /data/for4.conf'\n#è¿è¡éªè¯\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\n\n# å­ãplaybookä¸­ifç®åä½¿ç¨\n\n$ cat test5.yaml \n---\n- hosts: webservers\n  remote_user: root\n  vars:\n    ports:\n      - web1:\n        port: 81\n        rootdir: /data/web1\n      - web2:\n        port: 82\n        name: web2.lzj.com\n        rootdir: /data/web2\n      - web1:\n        port: 83\n        rootdir: /data/web3\n\n  tasks:\n    - name: copy conf\n      template: src=for5.conf.j2 dest=/data/for5.conf\n$ cat templates/for5.conf.j2 \n{% for p in ports %}\nserver {\n    listen {{ p.port }}\n{% if p.name is defined%}    #å¦æåç§°è¢«å®ä¹äºæç»åå­èµå¼\n    servername {{ p.name }}\n{% endif %}\n    documentroot {{ p.rootdir }}\n}\n{% endfor %}\n$ ansible-playbook test5.yaml      \n$ ansible webservers -m shell -a 'cat /data/for5.conf'\n#è¿è¡éªè¯\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\n*************** å½ä½ åç°èªå·±çæåæä¸èµ·éå¿æ¶ï¼å°±è¯·å®éä¸æ¥å­¦ä¹ å§ï¼***************\n\nåæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14199384.html",charsets:{cjk:!0}},{title:"playbookè¯¦è§£",frontmatter:{title:"playbookè¯¦è§£",categories:["ç³»åä¸é¢","ansible"],tags:["ansible"],date:"2022-12-09T20:53:07.000Z",permalink:"/pages/14eda9/",readingShow:"top",description:"ç®å½",meta:[{name:"twitter:title",content:"playbookè¯¦è§£"},{name:"twitter:description",content:"ç®å½"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/07.Ansible%E4%B8%AD%E7%9A%84playbook%20%E8%AF%A6%E8%A7%A3.html"},{property:"og:type",content:"article"},{property:"og:title",content:"playbookè¯¦è§£"},{property:"og:description",content:"ç®å½"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/07.Ansible%E4%B8%AD%E7%9A%84playbook%20%E8%AF%A6%E8%A7%A3.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:53:07.000Z"},{property:"article:tag",content:"ansible"},{itemprop:"name",content:"playbookè¯¦è§£"},{itemprop:"description",content:"ç®å½"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/07.Ansible%E4%B8%AD%E7%9A%84playbook%20%E8%AF%A6%E8%A7%A3.html",relativePath:"01.ä¸é¢/01.ansibleç³»åæç« /07.Ansibleä¸­çplaybook è¯¦è§£.md",key:"v-0d3f68c1",path:"/pages/14eda9/",headers:[{level:3,title:"ä¸ãplaybook",slug:"ä¸ãplaybook",normalizedTitle:"ä¸ãplaybook",charIndex:33},{level:4,title:"1.1 playbookæ¯ä»ä¹",slug:"_1-1-playbookæ¯ä»ä¹",normalizedTitle:"1.1 playbookæ¯ä»ä¹",charIndex:49},{level:4,title:"1.2 playbookçè¯­æ³ç»æ",slug:"_1-2-playbookçè¯­æ³ç»æ",normalizedTitle:"1.2 playbookçè¯­æ³ç»æ",charIndex:70},{level:4,title:"1.3 éå®ä¸»æºèå´æ§è¡",slug:"_1-3-éå®ä¸»æºèå´æ§è¡",normalizedTitle:"1.3 éå®ä¸»æºèå´æ§è¡",charIndex:93},{level:4,title:"1.4 ansible-palybookçå°æå·§",slug:"_1-4-ansible-palybookçå°æå·§",normalizedTitle:"1.4 ansible-palybookçå°æå·§",charIndex:111},{level:4,title:"1.5 ansible-playbookä¸­çhandlers",slug:"_1-5-ansible-playbookä¸­çhandlers",normalizedTitle:"1.5 ansible-playbookä¸­çhandlers",charIndex:141},{level:4,title:"1.6 ä½¿ç¨handlersçæ³¨æäºé¡¹",slug:"_1-6-ä½¿ç¨handlersçæ³¨æäºé¡¹",normalizedTitle:"1.6 ä½¿ç¨handlersçæ³¨æäºé¡¹",charIndex:177},{level:3,title:"äºãåé",slug:"äºãåé",normalizedTitle:"äºãåé",charIndex:200},{level:4,title:"2.1 playbookä¸­çåé",slug:"_2-1-playbookä¸­çåé",normalizedTitle:"2.1 playbookä¸­çåé",charIndex:210},{level:4,title:"2.2 playbookä¸­ä½¿ç¨varsä»£ç åå®ä¹åé",slug:"_2-2-playbookä¸­ä½¿ç¨varsä»£ç åå®ä¹åé",normalizedTitle:"2.2 playbookä¸­ä½¿ç¨varsä»£ç åå®ä¹åé",charIndex:232},{level:4,title:"2.3 ä½¿ç¨ç¬ç«çæä»¶æ¥å®ä¹playbookåé",slug:"_2-3-ä½¿ç¨ç¬ç«çæä»¶æ¥å®ä¹playbookåé",normalizedTitle:"2.3 ä½¿ç¨ç¬ç«çæä»¶æ¥å®ä¹playbookåé",charIndex:264},{level:4,title:"2.4 inventoryæä»¶ä¸­çåé",slug:"_2-4-inventoryæä»¶ä¸­çåé",normalizedTitle:"2.4 inventoryæä»¶ä¸­çåé",charIndex:294},{level:4,title:"2.5 ä¸»æºåéåç»åé",slug:"_2-5-ä¸»æºåéåç»åé",normalizedTitle:"2.5 ä¸»æºåéåç»åé",charIndex:319},{level:4,title:"2.6 å·§ç¨ä¸»æºåéåç»åé",slug:"_2-6-å·§ç¨ä¸»æºåéåç»åé",normalizedTitle:"2.6 å·§ç¨ä¸»æºåéåç»åé",charIndex:337},{level:4,title:"2.7 æ³¨ååé",slug:"_2-7-æ³¨ååé",normalizedTitle:"2.7 æ³¨ååé",charIndex:357},{level:3,title:"ä¸ãé«é¶åé",slug:"ä¸ãé«é¶åé",normalizedTitle:"ä¸ãé«é¶åé",charIndex:369},{level:4,title:"3.1 fastsåéä¿¡æ¯",slug:"_3-1-fastsåéä¿¡æ¯",normalizedTitle:"3.1 fastsåéä¿¡æ¯",charIndex:381},{level:4,title:"3.2 æ¬å°factsåé",slug:"_3-2-æ¬å°factsåé",normalizedTitle:"3.2 æ¬å°factsåé",charIndex:400},{level:3,title:"åãif/when/whileæµç¨æ§å¶è¯­å¥",slug:"åãif-when-whileæµç¨æ§å¶è¯­å¥",normalizedTitle:"åãif/when/whileæµç¨æ§å¶è¯­å¥",charIndex:417},{level:4,title:"4.1 whenæ¡ä»¶å¤æ­",slug:"_4-1-whenæ¡ä»¶å¤æ­",normalizedTitle:"4.1 whenæ¡ä»¶å¤æ­",charIndex:444},{level:3,title:"äºãä»»å¡é´çæµç¨æ§å¶",slug:"äºãä»»å¡é´çæµç¨æ§å¶",normalizedTitle:"äºãä»»å¡é´çæµç¨æ§å¶",charIndex:460},{level:4,title:"5.1 ä»»å¡å§æ",slug:"_5-1-ä»»å¡å§æ",normalizedTitle:"5.1 ä»»å¡å§æ",charIndex:476},{level:4,title:"5.2 ä»»å¡æå",slug:"_5-2-ä»»å¡æå",normalizedTitle:"5.2 ä»»å¡æå",charIndex:490},{level:4,title:"5.3 äº¤äºå¼æç¤º",slug:"_5-3-äº¤äºå¼æç¤º",normalizedTitle:"5.3 äº¤äºå¼æç¤º",charIndex:504},{level:3,title:"å­ãtagsæ ç­¾",slug:"å­ãtagsæ ç­¾",normalizedTitle:"å­ãtagsæ ç­¾",charIndex:517},{level:3,title:"ä¸ãBlockå",slug:"ä¸ãblockå",normalizedTitle:"ä¸ãblockå",charIndex:529}],headersStr:"ä¸ãplaybook 1.1 playbookæ¯ä»ä¹ 1.2 playbookçè¯­æ³ç»æ 1.3 éå®ä¸»æºèå´æ§è¡ 1.4 ansible-palybookçå°æå·§ 1.5 ansible-playbookä¸­çhandlers 1.6 ä½¿ç¨handlersçæ³¨æäºé¡¹ äºãåé 2.1 playbookä¸­çåé 2.2 playbookä¸­ä½¿ç¨varsä»£ç åå®ä¹åé 2.3 ä½¿ç¨ç¬ç«çæä»¶æ¥å®ä¹playbookåé 2.4 inventoryæä»¶ä¸­çåé 2.5 ä¸»æºåéåç»åé 2.6 å·§ç¨ä¸»æºåéåç»åé 2.7 æ³¨ååé ä¸ãé«é¶åé 3.1 fastsåéä¿¡æ¯ 3.2 æ¬å°factsåé åãif/when/whileæµç¨æ§å¶è¯­å¥ 4.1 whenæ¡ä»¶å¤æ­ äºãä»»å¡é´çæµç¨æ§å¶ 5.1 ä»»å¡å§æ 5.2 ä»»å¡æå 5.3 äº¤äºå¼æç¤º å­ãtagsæ ç­¾ ä¸ãBlockå",content:'# Ansible ä¸­ç playbook è¯¦è§£\n\nç®å½\n\n * ä¸ãplaybook\n   * 1.1 playbookæ¯ä»ä¹\n   * 1.2 playbookçè¯­æ³ç»æ\n   * 1.3 éå®ä¸»æºèå´æ§è¡\n   * 1.4 ansible-palybookçå°æå·§\n   * 1.5 ansible-playbookä¸­çhandlers\n   * 1.6 ä½¿ç¨handlersçæ³¨æäºé¡¹\n * äºãåé\n   * 2.1 playbookä¸­çåé\n   * 2.2 playbookä¸­ä½¿ç¨varsä»£ç åå®ä¹åé\n   * 2.3 ä½¿ç¨ç¬ç«çæä»¶æ¥å®ä¹playbookåé\n   * 2.4 inventoryæä»¶ä¸­çåé\n   * 2.5 ä¸»æºåéåç»åé\n   * 2.6 å·§ç¨ä¸»æºåéåç»åé\n   * 2.7 æ³¨ååé\n * ä¸ãé«é¶åé\n   * 3.1 fastsåéä¿¡æ¯\n   * 3.2 æ¬å°factsåé\n * åãif/when/whileæµç¨æ§å¶è¯­å¥\n   * 4.1 whenæ¡ä»¶å¤æ­\n * äºãä»»å¡é´çæµç¨æ§å¶\n   * 5.1 ä»»å¡å§æ\n   * 5.2 ä»»å¡æå\n   * 5.3 äº¤äºå¼æç¤º\n * å­ãtagsæ ç­¾\n * ä¸ãBlockå\n\n\n# ä¸ãplaybook\n\n# 1.1 playbookæ¯ä»ä¹\n\næ ¹æ¬ä¸è¯´playbookåshellèæ¬æ²¡æä»»ä½çåºå«ï¼playbookå°±åshellä¸æ ·ï¼ä¹æ¯æä¸å çå½ä»¤ç»åèµ·æ¥ï¼ç¶åå å¥å¯¹åºæ¡ä»¶å¤æ­ç­ç­ï¼å¨shellèæ¬ä¸­æ¯ä¸æ¡ä¸æ¡çå½ä»¤ï¼èå¨playbookä¸­æ¯ä¸ä¸ªä¸ä¸ªçtaskä»»å¡ææï¼æ¯ä¸ªtaskä»»å¡å¯ä»¥çåshellä¸­çä¸æ¡å½ä»¤ï¼shellèæ¬ä¸è¬åªæ¯å¨å½åæå¡å¨ä¸æ§è¡ï¼èplaybookåæ¯å¨ä¸æ­¢ä¸ä¸ªæå¡å¨ä¸æ§è¡ï¼å æ­¤playbookéè¦å¨å¶ä¸­æå®è¿è¡è¯¥playbookçæå¡å¨åã\n\n# 1.2 playbookçè¯­æ³ç»æ\n\nplaybookä½¿ç¨ymlæ è®°è¯­è¨ï¼è¿æ¯ä¸ç§æ è®°è¯­è¨ï¼è¿ç§æ è®°è¯­è¨å¨æä»¶çæå¼å§éè¦ä½¿ç¨ä¸ä¸ªâ-âæ¥è¯´ææä»¶å¼å§ï¼ç¶åä½¿ç¨ç¼©è¿æ¥è¯´æä»£ç åçèå´ãä¸é¢éè¿ä¸ä¸ªç®æçå®ä¾ï¼æ¥è¯´æplaybookçè¯­æ³ã\n\n---      # æ è®°æä»¶çå¼å§\n- hosts: webservers   # æå®è¯¥playbookå¨åªä¸ªæå¡å¨ä¸æ§è¡\n  vars:         # è¡¨ç¤ºä¸é¢æ¯å®ä¹çåéï¼\n    http_port: 80    # åéçå½¢å¼ï¼key: valueï¼è¿éhttp_portæ¯åéåï¼80æ¯å¼\n    max_clients: 200\n  remote_user: root  # æå®è¿ç¨çç¨æ·åï¼è¿éç¼©è¿åvarsä¿æäºä¸è´ï¼è¯´æåéçä»£ç åå·²ç»ç»æã\n  tasks:  # ä¸é¢ææplaybookçtasksï¼æ¯ä¸ªtaské½æ - name: å¼å§ï¼nameæå®è¯¥ä»»å¡çåç§°ã\n  - name: ensure apache is at the latest version  # æå®è¯¥ä»»å¡çåç§°ã\n    yum: pkg=httpd state=latest  # yumè¯´æè¦æ¯ç¨çæ¨¡æ¿åç§°ï¼åé¢æå®å¯¹åºçåæ°ï¼è¿ä¸¤è¡ç»åèµ·æ¥å°±ç¸å½äºä¸ä¸ªshellå½ä»¤ã\n\n  - name: write the apache config file      # æ¯ä¸ªtaskä¹é´å¯ä»¥ä½¿ç¨ç©ºè¡æ¥ååºåã\n    template: src=/srv/httpd.j2 dest=/etc/httpd.conf\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\néè¦è¯´æçæ¯ç¼©è¿çæä¹åpythonä¸­ç¼©è¿çæä¹æ¯ä¸æ ·ï¼æ¯æ¥åºåä»£ç åçã\n\nä¸ä¸ªç®åçå®ä¾ï¼æ£æ¥MySQLçè¿è¡ç¶æ\n\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no   # ä¸æ¶éå¯¹åºä¸»æºçä¿¡æ¯ï¼è¿æ ·è¿è¡ä¼å¿«ç¹ã\n   tasks:\n     - name: check the mysql stauts\n       service: name=mysqld state=running\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿è¡playbookï¼\n\n$ ansible-playbook test.yml\n\nPLAY [all] ********************************************************************\n\nTASK: [check the mysql stauts] ************************************************\nok: [10.0.102.200]\nok: [10.0.102.162]\nok: [10.0.102.212]\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=1    changed=0    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=0    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=0    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# 1.3 éå®ä¸»æºèå´æ§è¡\n\nè½ç¶playbookä¸­å®ä¹äºæ§è¡çä¸»æºï¼ä½æ¯ææ¶åæä»¬å¯è½ä»æ³å¨å®ä¹çä¸»æºä¸­çé¨åæºå¨ä¸æ§è¡ï¼è¿æ¶åæä¹åï¼ä¿®æ¹playbookä¸­çhostsçèå´ï¼ä½æ¯æ¯æ¬¡æ¹åä¸»æºå°±ä¿®æ¹ä¸æ¬¡ï¼æ¯è¾éº»ç¦ï¼æä»¬å¯ä»¥ä½¿ç¨--limitåæ°ï¼æå®è¯¥playbookå¨æå®çä¸»æºä¸æ§è¡ãæä»¥ä¸inventoryæä»¶ï¼æä»¬æ³å¨dbserversä¸æ§è¡ä¸é¢æµè¯ç¨çplaybookåå®¹ã\n\n[all]\n10.0.102.212\n10.0.102.200\n10.0.102.162\n\n[dbservers]\n10.0.102.162\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸é¢æµè¯çplaybookä¸­hostså®ä¹allï¼æä»¬æ³ä»å¨dbserversä¸æ§è¡ã\n\n$ ansible-playbook test.yml --limit dbservers\n\nPLAY [all] ********************************************************************\n\nTASK: [check the mysql stauts] ************************************************\nok: [10.0.102.162]\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=1    changed=0    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ¥çå½åplaybookå¨åªäºä¸»æºä¸æ§è¡\n\n$ ansible-playbook test.yml --list-hosts\n\nplaybook: test.yml\n\n  play              # 1 (all): host count=3\n    10.0.102.162\n    10.0.102.212\n    10.0.102.200\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# 1.4 ansible-palybookçå°æå·§\n\n * --inventory=pathï¼æå®inventoryæä»¶ï¼é»è®¤æ¯å¨/etc/ansible/hostsä¸é¢ã\n * --verboseï¼æ¾ç¤ºè¯¦ç»çè¾åºï¼ä½¿ç¨-vvvvæ¾ç¤ºç²¾ç¡®å°æ¯åéçè¾åºã\n * --extra-vars=varsï¼å®ä¹å¨playbookä½¿ç¨çåéã\n * --forksï¼æå®å¹¶åççº¿ç¨æ°ï¼é»è®¤æ¯5.\n * --connection=type:æå®è¿ç¨è¿æ¥ä¸»æºçæ¹å¼ï¼é»è®¤æ¯sshï¼è®¾ç½®ä¸ºlocalæ¶ï¼ååªå¨æ¬å°æ§è¡playbookã\n * --check:æ£æµæ¨¡å¼ï¼playbookä¸­å®ä¹çææä»»å¡å°å¨æ¯å°ä¸»æºä¸æ£æµï¼ä½æ¯å¹¶ä¸æ§è¡ã\n\n# 1.5 ansible-playbookä¸­çhandlers\n\nå¨ç³»ç»ä¸­ï¼æä»¬ä¿®æ¹äºæå¡å¨çéç½®æä»¶ï¼è¿æ¶åå°±éè¦éå¯æä½æå¡ï¼å°±å¯ä»¥ä½¿ç¨å°handlersã\n\nhandlers:             # å®ä¹ä¸¤ä¸ªhandlers\n    - name: restart memcached\n      service:  name=memcached state=restarted\n    - name: restart apache\n      service: name=apache state=restarted\n\n- name: template configuration file\n  template: src=template.j2 dest=/etc/foo.conf  # ä¿®æ¹äºéç½®æä»¶ç¶åä¾æ¬¡å¯å¨memcachedåapacheæå¡ã\n  notify:        # ä½¿ç¨notifyæ¥å£°æå¼ç¨handlersã\n     - restart memcached\n     - restart apache\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n# 1.6 ä½¿ç¨handlersçæ³¨æäºé¡¹\n\n * Handlersåªæå¨å¶æå¨çä»»å¡è¢«æ§è¡æ¶ï¼æä¼è¢«è¿è¡ï¼å¦æä¸ä¸ªä»»å¡ä¸­å®ä¹äºnotifyè°ç¨Handlersï¼ä½æ¯ç±äºæ¡ä»¶å¤æ­ç­åå ï¼è¯¥ä»»å¡æªè¢«æ§è¡ï¼é£ä¹Handlersåæ ·ä¸ä¼è¢«æ§è¡ã\n * Handlersåªä¼å¨æ¯ä¸ä¸ªplayçæ«å°¾è¿è¡ä¸æ¬¡ï¼å¦ææ³å¨ä¸ä¸ªplaybookä¸­é´è¿è¡Handlersï¼åéè¦ä½¿ç¨metaæ¨¡åæ¥å®ç°ãä¾å¦ï¼-meta: flush_handlers.\n * å¦æä¸ä¸ªplayå¨è¿è¡å°è°ç¨Handlersçè¯­å¥ä¹åå¤±è´¥äºï¼é£ä¹è¿ä¸ªHandlerså°ä¸ä¼è¢«æ§è¡ãæä»¬å¯ä»¥ä½¿ç¨metaæ¨¡åç--force-handlerséé¡¹æ¥å¼ºå¶æ§è¡Handlersï¼å³ä½¿Handlersæå¨çplayä¸­éè¿è¡å¤±è´¥ä¹è½æ§è¡ã\n\n\n# äºãåé\n\nè¿ä¸ªåéæä»¬æ¥è¯´æansibleä¸­åéï¼ä¸åå«roleä¸­çåéï¼ç¨æ³ã\n\n# 2.1 playbookä¸­çåé\n\nå¨è¿è¡playbookçæ¶åä½¿ç¨--extra-varsæ¥æå®åé\n\næå¦ä¸playbookèæ¬ï¼\n\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   tasks:\n     - name: test playbook variables\n       command: echo {{ test_var }}   # æå°åºåétest_varçå¼ã\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿è¡playbookï¼\n\n$ ansible-playbook test.yml --extra-vars "test_var=test" -v    \n# å ä¸-véé¡¹ï¼ä¼æ¾ç¤ºè¯¦ç»çä¿¡æ¯\n\nPLAY [all] ********************************************************************\n\nTASK: [test playbook variables] ***********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "test"], "delta": "0:00:00.006045", "end": "2019-02-15 23:04:49.789452", "rc": 0, "start": "2019-02-15 23:04:49.783407", "stderr": "", "stdout": "test"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "test"], "delta": "0:00:00.005318", "end": "2019-02-15 23:04:52.976471", "rc": 0, "start": "2019-02-15 23:04:52.971153", "stderr": "", "stdout": "test"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "test"], "delta": "0:00:00.005082", "end": "2019-02-15 23:04:52.424959", "rc": 0, "start": "2019-02-15 23:04:52.419877", "stderr": "", "stdout": "test"}\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nä¸é¢è¯¦ç»ä¿¡æ¯çæ åè¾åºä¸ºtestï¼è¯´æåéçå¼å·²ç»ä¼ éäºã\n\n# 2.2 playbookä¸­ä½¿ç¨varsä»£ç åå®ä¹åé\n\n$ cat test.yml\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   vars:                  # å¨è¿éä½¿ç¨äºvarsä»£ç åæ¥å®ä¹åé\n       test_var: Hello World\n   tasks:\n     - name: test playbook variables\n       command: echo {{ test_var }}\n\n$ ansible-playbook test.yml  -v\n\nPLAY [all] ********************************************************************\n\nTASK: [test playbook variables] ***********************************************\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "Hello", "World"], "delta": "0:00:00.004940", "end": "2019-02-15 23:20:06.541672", "rc": 0, "start": "2019-02-15 23:20:06.536732", "stderr": "", "stdout": "Hello World"}\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "Hello", "World"], "delta": "0:00:00.004843", "end": "2019-02-15 23:20:03.957950", "rc": 0, "start": "2019-02-15 23:20:03.953107", "stderr": "", "stdout": "Hello World"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "Hello", "World"], "delta": "0:00:00.004219", "end": "2019-02-15 23:20:07.166900", "rc": 0, "start": "2019-02-15 23:20:07.162681", "stderr": "", "stdout": "Hello World"}\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n# 2.3 ä½¿ç¨ç¬ç«çæä»¶æ¥å®ä¹playbookåé\n\nplaybookçåå®¹ï¼\n\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   vars_files:       # è¿éä½¿ç¨äºvars_filesæ¥å¼å¥åéæä»¶\n     - vars.yml\n   tasks:\n     - name: test playbook variables\n       command: echo {{ test_var }}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nåéæä»¶çå®ä¹ï¼\n\n$ cat vars.yml\n---\n  test_var: Hello World\n\n\n1\n2\n3\n\n\næ§è¡çç»æï¼\n\n$ ansible-playbook test.yml  -v\n\nPLAY [all] ********************************************************************\n\nTASK: [test playbook variables] ***********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "Hello", "World"], "delta": "0:00:00.005198", "end": "2019-02-15 23:23:16.397557", "rc": 0, "start": "2019-02-15 23:23:16.392359", "stderr": "", "stdout": "Hello World"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "Hello", "World"], "delta": "0:00:00.004359", "end": "2019-02-15 23:23:19.629804", "rc": 0, "start": "2019-02-15 23:23:19.625445", "stderr": "", "stdout": "Hello World"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "Hello", "World"], "delta": "0:00:01.006185", "end": "2019-02-15 23:23:20.039320", "rc": 0, "start": "2019-02-15 23:23:19.033135", "stderr": "", "stdout": "Hello World"}\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# 2.4 inventoryæä»¶ä¸­çåé\n\nå¨ansibleä¸­ï¼inventoryæä»¶éå¸¸æ¯æansibleçä¸»æºåç»å®ä¹æä»¶hostsãå¨hostsæä»¶ä¸­ï¼åéä¼è¢«å®ä¹å¨ä¸»æºååé¢æç»åçä¸æ¹ã\n\nä¸ºç¹å®çä¸»æºå®ä¹åéï¼åéåè·å¨å¯¹åºä¸»æºçåè¾¹ã\n\ninventoryæä»¶å¦ä¸ï¼\n\n$ cat /etc/ansible/hosts\n[all]\n10.0.102.212 test_var=212\n10.0.102.200 test_var=200\n10.0.102.162 test_var=162\n# ä¸ºä¸ä¸ªä¸»æºå®ä¹äºååçåéï¼ä½æ¯åéå¼å´ä¸ä¸æ ·ã\n\n\n1\n2\n3\n4\n5\n6\n\n\nplaybookçåå®¹å¦ä¸ï¼\n\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   tasks:\n     - name: test playbook variables\n       command: echo {{ test_var }}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næ§è¡è¿ä¸ªplaybookï¼ç»æå¦ä¸ï¼å¯¹åºçä¸»æºæ¾ç¤ºäºåèªå¯¹åºçåéå¼ï¼ï¼\n\n$ ansible-playbook test.yml -v\n\nPLAY [all] ********************************************************************\n\nTASK: [test playbook variables] ***********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "212"], "delta": "0:00:00.004399", "end": "2019-02-15 23:31:20.648111", "rc": 0, "start": "2019-02-15 23:31:20.643712", "stderr": "", "stdout": "212"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "200"], "delta": "0:00:00.005932", "end": "2019-02-15 23:31:23.873082", "rc": 0, "start": "2019-02-15 23:31:23.867150", "stderr": "", "stdout": "200"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "162"], "delta": "0:00:00.006723", "end": "2019-02-15 23:31:23.287861", "rc": 0, "start": "2019-02-15 23:31:23.281138", "stderr": "", "stdout": "162"}\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nç»ä¸»æºç»å®ä¹åéï¼ä½ç¨èå´ä¸ºæ´ä¸ªä¸»æºç»ã\n\n$ cat /etc/ansible/hosts\n[all]\n10.0.102.212\n10.0.102.200\n10.0.102.162\n\n\n[all:vars]                            #ç»ä¸»æºç»å®ä¹åé\ntest_var=Hello World\n\n$ ansible-playbook test.yml -v\n\nPLAY [all] ********************************************************************\n\nTASK: [test playbook variables] ***********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "Hello", "World"], "delta": "0:00:00.003923", "end": "2019-02-15 23:37:29.322158", "rc": 0, "start": "2019-02-15 23:37:29.318235", "stderr": "", "stdout": "Hello World"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "Hello", "World"], "delta": "0:00:00.004161", "end": "2019-02-15 23:37:32.548947", "rc": 0, "start": "2019-02-15 23:37:32.544786", "stderr": "", "stdout": "Hello World"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "Hello", "World"], "delta": "0:00:00.006090", "end": "2019-02-15 23:37:32.005067", "rc": 0, "start": "2019-02-15 23:37:31.998977", "stderr": "", "stdout": "Hello World"}\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåæ³ä¸ä¸ï¼è¿ç§æ¹æ³å®ä¹åéè½ç¶ç®åç´è§ï¼ä½æ¯è¥æ¯åéç¹å«å¤çæåµä¸ï¼ä¼æä¹æ ·ï¼ç¹å«æ¯ç»å¯¹åºçä¸»æºå®ä¹åéï¼è¥æ¯åéå¤ªå¤ï¼åç®¡çèµ·æ¥ä¼å¾ä¸æ¹ä¾¿çï¼å æ­¤å¼å¥äºä¸»æºåéåç»åéã\n\n# 2.5 ä¸»æºåéåç»åé\n\ninventoryæä»¶ä»ç¶ä½¿ç¨ä¸é¢çæä»¶ï¼\n\nå¨æ§è¡ansbileå½ä»¤æ¶ï¼ansibleé»è®¤ä¼ä»/etc/ansible/host_vars/å/etc/amsible/group_vars/ä¸¤ä¸ªç®å½ä¸è¯»ååéå®ä¹ï¼å¦æ/etc/ansibleä¸é¢æ²¡æè¿ä¸¤ä¸ªç®å½ï¼å¯ä»¥ç´æ¥æå¨åå»ºï¼å¹¶ä¸å¯ä»¥å¨è¿ä¸¤ä¸ªç®å½ä¸­åå»ºä¸hostsï¼è¿éæ¯æinventoryæä»¶ï¼æä»¶ä¸­ä¸»æºåæç»åååçæä»¶æ¥å®ä¹åéã\n\nåæ¥çä¸»æºåé\n\n$ tree /etc/ansible/\n.\nâââ group_vars\nâââ hosts\nâââ host_vars                 # å®ä¹ä¸ä¸»æºåååçæä»¶\n    âââ 10.0.102.162\n    âââ 10.0.102.200\n    âââ 10.0.102.212\n\n2 directories, 4 files\n\n# æä»¶ä¸­çåå®¹å¦ä¸ï¼\n$ cat host_vars/10.0.102.162\n---\ntest_var: 162\n$ cat host_vars/10.0.102.200\n---\n  test_var: 200\n$ cat host_vars/10.0.102.212\n---\n  test_var: 212\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nplaybookçåå®¹å¦ä¸ï¼æ§è¡ç»æå¦ä¸ï¼\n\n$ cat test.yml\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   tasks:\n     - name: test playbook variables\n       command: echo {{ test_var }}\n\n$ ansible-playbook test.yml -v\n\nPLAY [all] ********************************************************************\n\nTASK: [test playbook variables] ***********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "212"], "delta": "0:00:00.003767", "end": "2019-02-15 23:55:58.595282", "rc": 0, "start": "2019-02-15 23:55:58.591515", "stderr": "", "stdout": "212"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "162"], "delta": "0:00:00.006254", "end": "2019-02-15 23:56:01.235307", "rc": 0, "start": "2019-02-15 23:56:01.229053", "stderr": "", "stdout": "162"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "200"], "delta": "0:00:01.004509", "end": "2019-02-15 23:56:02.775410", "rc": 0, "start": "2019-02-15 23:56:01.770901", "stderr": "", "stdout": "200"}\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nåæ¥è¯´æä¸ä¸ä¸»æºç»åéï¼\n\nåå»ºä¸ç»åååçæä»¶ï¼\n\n$ tree\n.\nâââ group_vars\nâ   âââ all               #åå»ºä¸ç»åååçæä»¶\nâââ hosts\nâââ host_vars\n    âââ 10.0.102.162\n    âââ 10.0.102.200\n    âââ 10.0.102.212\n\n2 directories, 5 files\n\n$ cat group_vars/all\n---\n  test_group_var: from group\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\næ§è¡ç»æå¦ä¸ï¼\n\n$ cat test.yml\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   tasks:\n     - name: test the host variables\n       command: echo {{ test_var }}\n\n     - name: test host group variables           #åå¥æµè¯ç»åéçtask\n       command: echo {{ test_group_var }}\n$ ansible-playbook test.yml -v\n\nPLAY [all] ********************************************************************\n\nTASK: [test the host variables] ***********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "212"], "delta": "0:00:00.004613", "end": "2019-02-15 23:59:23.227722", "rc": 0, "start": "2019-02-15 23:59:23.223109", "stderr": "", "stdout": "212"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "200"], "delta": "0:00:00.006490", "end": "2019-02-15 23:59:26.422682", "rc": 0, "start": "2019-02-15 23:59:26.416192", "stderr": "", "stdout": "200"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "162"], "delta": "0:00:00.004709", "end": "2019-02-15 23:59:25.812786", "rc": 0, "start": "2019-02-15 23:59:25.808077", "stderr": "", "stdout": "162"}\n\nTASK: [test host group variables] *********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "from", "group"], "delta": "0:00:00.003759", "end": "2019-02-15 23:59:23.519180", "rc": 0, "start": "2019-02-15 23:59:23.515421", "stderr": "", "stdout": "from group"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "from", "group"], "delta": "0:00:00.003748", "end": "2019-02-15 23:59:26.109337", "rc": 0, "start": "2019-02-15 23:59:26.105589", "stderr": "", "stdout": "from group"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "from", "group"], "delta": "0:00:00.004339", "end": "2019-02-15 23:59:26.724525", "rc": 0, "start": "2019-02-15 23:59:26.720186", "stderr": "", "stdout": "from group"}\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=2    changed=2    unreachable=0    failed=0\n10.0.102.200               : ok=2    changed=2    unreachable=0    failed=0\n10.0.102.212               : ok=2    changed=2    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n# 2.6 å·§ç¨ä¸»æºåéåç»åé\n\nææ¶åå¨æ§è¡ansbileä»»å¡æ¶ï¼å¯è½éè¦ä»ä¸å°è¿ç¨ä¸»æºä¸è·åå¦ä¸å°è¿ç¨ä¸»æºçåéä¿¡æ¯ï¼è¿æ¶åå¯ä»¥ä½¿ç¨hostvarsåéï¼è¿ä¸ªåéåå«äºæå®ä¸»æºä¸æå®ä¹çææåéã\n\nè­¬å¦ï¼è¥æ¯æ³è·åhost1ä¸åéadmin_userçåå®¹ï¼å¨ä»»æä¸»æºä¸ç´æ¥ä¸ä½¿ç¨ä¸é¢ä»£ç å³å¯ã\n\n{{  hostvars[\'host1\'][\'admin_user\']}}\n\n\n1\n\n\nansibleæä¾äºä¸äºéå¸¸æç¨çåç½®åéï¼å ä¸ªå¸¸ç¨çå¦ä¸ï¼\n\n * grorpsï¼åå«äºææhostsæä»¶éçä¸»æºç»çä¸ä¸ªåè¡¨ã\n * group_names: åå«äºå½åä¸»æºæå¨çææä¸»æºç»åçä¸ä¸ªåè¡¨ã\n * inventory_hostname: éè¿hostsæä»¶å®ä¹çä¸»æºåãï¼ä¸ansible_homeæä¹ä¸åï¼\n * inventory_hostname_shortï¼åéinventory_hostnameçç¬¬ä¸é¨åãè­¬å¦inventory_hostnameçå¼ä¸ºbooks.ansible.comï¼é£ä¹inventory_hostname_shortçå¼å°±æ¯booksã\n * play_hosts: å°æ§è¡å½åä»»å¡çææä¸»æº\n\n# 2.7 æ³¨ååé\n\næ³¨ååéï¼å¶å®å°±æ¯å°æä½ç»æï¼åæ¬æ åè¾åºåæ åéè¯¯è¾åºï¼ä¿å­å°åéä¸­ï¼ç¶ååæ ¹æ®è¿ä¸ªåéçåå®¹æ¥å³å®ä¸ä¸æ­¥çæä½ï¼å¨è¿ä¸ªè¿ç¨ä¸­ç¨æ¥ä¿å­æä½ç»æçåéå°±å«æ³¨ååéã\n\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   tasks:\n     - name: test the register variables\n       shell: uptime\n       register: results     # ä½¿ç¨å³é®å­registerå£°ææ³¨ååéï¼ä¸é¢uptimeå½ä»¤äº§ççç»æï¼å­å¥å°resultsä¸­ãç»ææ¯å­å¸å½¢å¼ã\n\n     - name: print the register result\n       debug: msg="{{ results.stdout }}"   # ä½¿ç¨debugæ¨¡åï¼æå°åºä¸é¢å½ä»¤çè¾åºç»æã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nä¸é¢çplaybookæ§è¡ç»æå¦ä¸ï¼\n\n$ ansible-playbook test.yml\n\nPLAY [all] ********************************************************************\n\nTASK: [test the register variables] *******************************************\nchanged: [10.0.102.212]\nchanged: [10.0.102.200]\nchanged: [10.0.102.162]\n\nTASK: [print the register result] *********************************************\nok: [10.0.102.212] => {\n    "msg": " 00:18:01 up 3 days,  2:56,  3 users,  load average: 0.02, 0.03, 0.05"          #msgçç»æå°±æ¯æ³¨ååéçæ åè¾åº\n}\nok: [10.0.102.200] => {\n    "msg": " 00:18:04 up 4 days,  7:45,  3 users,  load average: 0.03, 0.06, 0.05"\n}\nok: [10.0.102.162] => {\n    "msg": " 00:18:04 up 4 days,  7:45,  3 users,  load average: 0.01, 0.02, 0.05"\n}\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=2    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=2    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=2    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nä¸ä¸ªæ³¨ååééå¸¸ä¼æä»¥ä¸4ä¸ªå±æ§ï¼\n\n * changedï¼ä»»å¡æ¯å¦å¯¹è¿ç¨ä¸»æºé æçåæ´ã\n * deltaï¼ä»»å¡è¿è¡æç¨çæ¶é´ã\n * stdoutï¼æ­£å¸¸çè¾åºä¿¡æ¯ã\n * stderrï¼éè¯¯ä¿¡æ¯ã\n\n\n# ä¸ãé«é¶åé\n\nå¯¹äºæ®éåéï¼å¨ansibleå½ä»¤è¡è®¾å®çï¼å¨hostsæä»¶ä¸­å®ä¹çï¼æèå¨playbookä¸­å®ä¹çç­ï¼è¿äºé½æ¯æ®éåéï¼å¨å¼ç¨æ¶ï¼å¯ä»¥ä½¿ç¨ä½¿ç¨{{ variable }}çå½¢å¼ãansibleæ¯ç¨pythonè¯­è¨åçï¼å æ­¤ä¹æ¯æä¸ç§å«ååè¡¨çåéï¼å½¢å¼å¦ä¸ï¼\n\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   vars:\n      var_list:     # æ³¨æå½¢å¼ï¼å®ä¹äºvar_liståè¡¨ï¼åå¼æ¹æ³ååè¡¨åå¼ä¸æ ·ï¼ä¸æ¨èä½¿ç¨jinja2çæ¹æ³åå¼ã\n          - one\n          - two\n          - three\n   tasks:\n     - name: test the list variables\n       shell: echo {{ var_list[0] }}   # ååè¡¨ä¸­çç¬¬ä¸ä¸ªå­ï¼ä¹å°±æ¯one\n       register: results\n\n     - name: print the register result\n       debug: msg="{{ results.stdout }}"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\næ§è¡ç»æå¦ä¸ï¼\n\n$ ansible-playbook test.yml\n\nPLAY [all] ********************************************************************\n\nTASK: [test the list variables] ***********************************************\nchanged: [10.0.102.212]\nchanged: [10.0.102.200]\nchanged: [10.0.102.162]\n\nTASK: [print the register result] *********************************************\nok: [10.0.102.212] => {\n    "msg": "one"\n}\nok: [10.0.102.200] => {\n    "msg": "one"\n}\nok: [10.0.102.162] => {\n    "msg": "one"\n}\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=2    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=2    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=2    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n# 3.1 fastsåéä¿¡æ¯\n\nå¨ä¸é¢çæµè¯ä¸­ï¼æä»¬çplaybooké½æ§è¡äºä¸æ¡å½ä»¤å«gater_facts:noï¼å å¥äºè¿æ¡å½ä»¤åï¼playbookèæ¬çæ§è¡éåº¦ä¼å¿«å¾å¤ï¼è¿æ¯å ä¸ºé»è®¤æåµä¸ï¼ansibleæ¯ä¼ææºè¿ç¨æå¡å¨çä¸»æºä¿¡æ¯ï¼è¿äºä¿¡æ¯åå«äºæå¡å¨çä¸äºåºæ¬è®¾ç½®ã\n\nGATHERING FACTS ***************************************************************\nok: [10.0.102.200]\nok: [10.0.102.212]\nok: [10.0.102.162]\n\n\n1\n2\n3\n4\n\n\næ¶éçä¸»æºä¿¡æ¯å¯ä»¥ä½¿ç¨setupæ¨¡åæ¥çï¼ä¸ä¸ªä¸»æºçæ¶éä¿¡æ¯å¦ä¸ï¼\n\nansible 10.0.102.162 -m setup\n10.0.102.162 | success >> {\n    "ansible_facts": {\n        "ansible_all_ipv4_addresses": [\n            "10.0.102.162"\n        ],\n        "ansible_all_ipv6_addresses": [\n            "fe80::1392:ecd3:5adf:c3ae"\n        ],\n        "ansible_architecture": "x86_64",\n        "ansible_bios_date": "04/01/2014",\n        "ansible_bios_version": "1.9.1-5.el7.centos",\n        "ansible_cmdline": {\n            "BOOT_IMAGE": "/vmlinuz-3.10.0-514.el7.x86_64",\n            "LANG": "en_US.UTF-8",\n            "crashkernel": "auto",\n            "quiet": true,\n            "rd.lvm.lv": "cl/swap",\n            "rhgb": true,\n            "ro": true,\n            "root": "/dev/mapper/cl-root"\n        },\n        "ansible_date_time": {\n            "date": "2019-02-16",\n            "day": "16",\n            "epoch": "1550248590",\n            "hour": "00",\n            "iso8601": "2019-02-15T16:36:30Z",\n            "iso8601_micro": "2019-02-15T16:36:30.311222Z",\n            "minute": "36",\n            "month": "02",\n            "second": "30",\n            "time": "00:36:30",\n            "tz": "CST",\n            "tz_offset": "+0800",\n            "weekday": "Saturday",\n            "year": "2019"\n        },\n        "ansible_default_ipv4": {\n            "address": "10.0.102.162",\n            "alias": "eth0",\n            "gateway": "10.0.100.1",\n            "interface": "eth0",\n            "macaddress": "fa:0a:e3:54:a6:00",\n            "mtu": 1500,\n            "netmask": "255.255.252.0",\n            "network": "10.0.100.0",\n            "type": "ether"\n        },\n        "ansible_default_ipv6": {},\n        "ansible_devices": {\n            "sr0": {\n                "holders": [],\n                "host": "IDE interface: Intel Corporation 82371SB PIIX3 IDE [Natoma/Triton II]",\n                "model": "QEMU DVD-ROM",\n                "partitions": {},\n                "removable": "1",\n                "rotational": "1",\n                "scheduler_mode": "cfq",\n                "sectors": "2097151",\n                "sectorsize": "512",\n                "size": "1024.00 MB",\n                "support_discard": "0",\n                "vendor": "QEMU"\n            },\n            "vda": {\n                "holders": [],\n                "host": "SCSI storage controller: Red Hat, Inc Virtio block device",\n                "model": null,\n                "partitions": {\n                    "vda1": {\n                        "sectors": "2097152",\n                        "sectorsize": 512,\n                        "size": "1.00 GB",\n                        "start": "2048"\n                    },\n                    "vda2": {\n                        "sectors": "81786880",\n                        "sectorsize": 512,\n                        "size": "39.00 GB",\n                        "start": "2099200"\n                    }\n                },\n                "removable": "0",\n                "rotational": "1",\n                "scheduler_mode": "",\n                "sectors": "83886080",\n                "sectorsize": "512",\n                "size": "40.00 GB",\n                "support_discard": "0",\n                "vendor": "0x1af4"\n            }\n        },\n        "ansible_distribution": "CentOS",\n        "ansible_distribution_major_version": "7",\n        "ansible_distribution_release": "Core",\n        "ansible_distribution_version": "7.3.1611",\n        "ansible_domain": "",\n        "ansible_env": {\n            "HOME": "/root",\n            "LANG": "en_US.UTF-8",\n            "LC_CTYPE": "en_US.UTF-8",\n            "LESSOPEN": "||/usr/bin/lesspipe.sh %s",\n            "LOGNAME": "root",\n            "LS_COLORS": "rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;36:*.au=01;36:*.flac=01;36:*.mid=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:*.xspf=01;36:",\n            "MAIL": "/var/mail/root",\n            "PATH": "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin",\n            "PWD": "/root",\n            "SELINUX_LEVEL_REQUESTED": "",\n            "SELINUX_ROLE_REQUESTED": "",\n            "SELINUX_USE_CURRENT_RANGE": "",\n            "SHELL": "/bin/bash",\n            "SHLVL": "2",\n            "SSH_CLIENT": "10.0.102.204 4242 22",\n            "SSH_CONNECTION": "10.0.102.204 4242 10.0.102.162 22",\n            "SSH_TTY": "/dev/pts/1",\n            "TERM": "xterm",\n            "USER": "root",\n            "XDG_RUNTIME_DIR": "/run/user/0",\n            "XDG_SESSION_ID": "168",\n            "_": "/usr/bin/python"\n        },\n        "ansible_eth0": {\n            "active": true,\n            "device": "eth0",\n            "ipv4": {\n                "address": "10.0.102.162",\n                "netmask": "255.255.252.0",\n                "network": "10.0.100.0"\n            },\n            "ipv6": [\n                {\n                    "address": "fe80::1392:ecd3:5adf:c3ae",\n                    "prefix": "64",\n                    "scope": "link"\n                }\n            ],\n            "macaddress": "fa:0a:e3:54:a6:00",\n            "module": "virtio_net",\n            "mtu": 1500,\n            "promisc": false,\n            "type": "ether"\n        },\n        "ansible_form_factor": "Other",\n        "ansible_fqdn": "docker4",\n        "ansible_hostname": "docker4",\n        "ansible_interfaces": [\n            "lo",\n            "eth0"\n        ],\n        "ansible_kernel": "3.10.0-514.el7.x86_64",\n        "ansible_lo": {\n            "active": true,\n            "device": "lo",\n            "ipv4": {\n                "address": "127.0.0.1",\n                "netmask": "255.0.0.0",\n                "network": "127.0.0.0"\n            },\n            "ipv6": [\n                {\n                    "address": "::1",\n                    "prefix": "128",\n                    "scope": "host"\n                }\n            ],\n            "mtu": 65536,\n            "promisc": false,\n            "type": "loopback"\n        },\n        "ansible_machine": "x86_64",\n        "ansible_memfree_mb": 881,\n        "ansible_memtotal_mb": 1839,\n        "ansible_mounts": [\n            {\n                "device": "/dev/mapper/cl-root",\n                "fstype": "xfs",\n                "mount": "/",\n                "options": "rw,seclabel,relatime,attr2,inode64,noquota",\n                "size_available": 34615087104,\n                "size_total": 39700664320\n            },\n            {\n                "device": "/dev/vda1",\n                "fstype": "xfs",\n                "mount": "/boot",\n                "options": "rw,seclabel,relatime,attr2,inode64,noquota",\n                "size_available": 918556672,\n                "size_total": 1063256064\n            }\n        ],\n        "ansible_nodename": "docker4",\n        "ansible_os_family": "RedHat",\n        "ansible_pkg_mgr": "yum",\n        "ansible_processor": [\n            "QEMU Virtual CPU version 2.5+",\n            "QEMU Virtual CPU version 2.5+"\n        ],\n        "ansible_processor_cores": 2,\n        "ansible_processor_count": 1,\n        "ansible_processor_threads_per_core": 1,\n        "ansible_processor_vcpus": 2,\n        "ansible_product_name": "KVM",\n        "ansible_product_serial": "NA",\n        "ansible_product_uuid": "E5E1D5E6-1A4D-4E0D-98C3-B8AD422B10CC",\n        "ansible_product_version": "RHEL 7.3.0 PC (i440FX + PIIX, 1996)",\n        "ansible_python_version": "2.7.5",\n        "ansible_selinux": {\n            "config_mode": "enforcing",\n            "mode": "enforcing",\n            "policyvers": 28,\n            "status": "enabled",\n            "type": "targeted"\n        },\n        "ansible_ssh_host_key_ecdsa_public": "AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEp5iF/lAqB9Q9FNKfnsi3mLJSVvvooVhRRcuGTBHEJs+TaM36oBaIr764IX1zdn2sWFLdYgmcuaAeiPu3fK+UU=",\n        "ansible_ssh_host_key_rsa_public": "AAAAB3NzaC1yc2EAAAADAQABAAABAQC6yHI2+V64EMW3jDISBrzKmWurP7uF4IqemJgowpqC3mVlFsPOSqerDoJN9hE34fViXcbLUj9wIi0kc3QzxxNwTefwJCdPSL17ns9eIEDKJqrHswts7OXYC1948bdyhyGnaW57BEfVUJ+Vt8OI1JSKkKsi3aCumaZDz9tNGCVYiqW4PMUQFaT/yEnPqKhSp8mDX/SL/unpVsctB0w37o38ZVApKPaNkHW25uiwroStLGqY4VgoZHTqHUdvqk4EZQOD0+JmBcYKVj2ABBl1sMiH8mmrc2W2Gi0gJx31Ky/t5SWQtXTdMRB3D7N9yRd1pPcnh0zebS/OPnX4G5UWX/aP",\n        "ansible_swapfree_mb": 0,\n        "ansible_swaptotal_mb": 0,\n        "ansible_system": "Linux",\n        "ansible_system_vendor": "Red Hat",\n        "ansible_user_id": "root",\n        "ansible_userspace_architecture": "x86_64",\n        "ansible_userspace_bits": "64",\n        "ansible_virtualization_role": "guest",\n        "ansible_virtualization_type": "kvm",\n        "module_setup": true\n    },\n    "changed": false\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n\n\nå¨å®éåºç¨ä¸­ï¼è¿ç¨çæ¯è¾å¤çfactsåéæansible_os_familyï¼ansible_hostnameç­ï¼è¿äºåééå¸¸ä¼è¢«æ¿æ¥ä½ä¸ºwhenæ¡ä»¶è¯­å¥çå¤æ­æ¡ä»¶ï¼æ¥å³å®ä¸ä¸æ­¥çæä½ãä¸ä¸ªç®åçå®ä¾ï¼\n\n---\n - hosts: all\n   remote_user: root\n   tasks:\n     - name: test the list variables\n       shell: echo {{ ansible_os_family }}\n       register: results\n\n     - name: print the register result\n       debug: msg="{{ results.stdout }}"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ§è¡ç»æå¦ä¸ï¼\n\nansible-playbook test.yml\n\nPLAY [all] ********************************************************************\n\nGATHERING FACTS ***************************************************************\nok: [10.0.102.162]\nok: [10.0.102.212]\nok: [10.0.102.200]\n\nTASK: [test the list variables] ***********************************************\nchanged: [10.0.102.162]\nchanged: [10.0.102.212]\nchanged: [10.0.102.200]\n\nTASK: [print the register result] *********************************************\nok: [10.0.102.212] => {\n    "msg": "RedHat"                   #å¯¹åºåéçç»æ\n}\nok: [10.0.102.200] => {\n    "msg": "RedHat"\n}\nok: [10.0.102.162] => {\n    "msg": "RedHat"\n}\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=3    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=3    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=3    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n# 3.2 æ¬å°factsåé\n\næä»¬å¯ä»¥èªå·±å®ä¹factsåéï¼æè¿ä¸ªåéåå¥ä¸ä¸ªä»¥.factç»å°¾çæä»¶ä¸­ï¼è¿ä¸ªæä»¶å¯ä»¥æ¯jsonæä»¶æiniæä»¶ï¼æèæ¯ä¸ä¸ªå¯ä»¥è¿åjsonä»£ç çå¯æ§è¡æä»¶ãç¶åå°å¶æ¾å¨è¿ç¨ä¸»æºç/etc/ansible/facts.dæä»¶å¤¹ä¸­ï¼ansibleå¨æ§è¡çä»»å¡æ¶ä¼èªå¨å°è¿ä¸ªæä»¶å¤¹ä¸­è¯»ååéçä¿¡æ¯ã\n\nå¨è¿ç¨ä¸»æºä¸åå¦ä¸æä½ï¼\n\n# èªå®ä¹factä¿¡æ¯\n$ mkdir -p /etc/ansible/facts.d && cd /etc/ansible/facts.d\n$ cat test.fact\n[test_fact]\nadmin=hongkong\n\n\n1\n2\n3\n4\n5\n\n\nç¶ååansibleä¸»æºä¸è·åèªå®ä¹çä¿¡æ¯ã\n\n$ ansible 10.0.102.162 -m setup -a "filter=ansible_local"\n10.0.102.162 | success >> {\n    "ansible_facts": {\n        "ansible_local": {\n            "test": {\n                "test_fact": {\n                    "admin": "hongkong"\n                }\n            }\n        }\n    },\n    "changed": false\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# åãif/when/whileæµç¨æ§å¶è¯­å¥\n\næ¡ä»¶å¤æ­å¨ansibleä»»å¡ä¸­çä½¿ç¨é¢çéå¸¸é«ãæä»¬å¯ä»¥æ ¹æ®ä¸äºæ¡ä»¶çä¸ä¸æ ·æ§è¡ä¸åçtaskã\n\n# 4.1 whenæ¡ä»¶å¤æ­\n\nå¾å¤ä»»å¡åªæå¨ç¹å®æ¡ä»¶ä¸æè½æ§è¡ï¼è¿å°±æ¯whenè¯­å¥åæ¥ä½ç¨çå°æ¹ã\n\nä¸ä¸ªç®åçå®ä¾ï¼å³é­æipå°åä¸º10.0.102.162æå¡å¨ä¸çmysqlæå¡ï¼å¦ä¸ï¼\n\n[root@test2 playbook]# cat test.yml\n---\n - hosts: all\n   remote_user: root\n   tasks:\n     - name: shut down the db server\n       service: name=mysqld state=stopped\n       when: ansible_eth0.ipv4.address  == "10.0.102.162"  # è¿éä½¿ç¨äºwhenæ¡ä»¶è¯­å¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ§è¡çç»æå¦ä¸ï¼\n\n$ ansible-playbook test.yml\n\nPLAY [all] ********************************************************************\n\nGATHERING FACTS ***************************************************************\nok: [10.0.102.212]\nok: [10.0.102.200]\nok: [10.0.102.162]\n\nTASK: [shut down the db server] ***********************************************\nskipping: [10.0.102.200]\nskipping: [10.0.102.212]\nchanged: [10.0.102.162]                      #162çæå¡ç¶æå·²ç»æ¹å\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=2    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=0    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=0    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè¿ä¸ªå°±æ¯whenæ¡ä»¶è¯­å¥çç¨æ³å¾ç®åãéè¦æ³¨æwhenè¯­å¥çä½ç¨äºpalyçä½ç¨æ¶é´ï¼å½whençæ¡ä»¶æ»¡è¶³æ¶ï¼ç¶åæä¼æ§è¡playä¸­çä»»å¡ãansibleè¿æä¾äºå¦å¤ä¸¤ä¸ªä¸whenç¸å³çè¯­å¥changed_whenåfailed_whenæ¡ä»¶å¤æ­ã\n\n\n# äºãä»»å¡é´çæµç¨æ§å¶\n\n# 5.1 ä»»å¡å§æ\n\né»è®¤æåµä¸ï¼ansibleææä»»å¡é½æ¯å¨æä»¬æå®çæºå¨ä¸é¢è¿è¡çï¼å½å¨ä¸ä¸ªç¬ç«çéç¾¤ç¯å¢éç½®æ¶ï¼è¿å¹¶æ²¡æä»ä¹é®é¢ãèå¨æäºæåµä¸ï¼æ¯å¦ç»æå°æå¡å¨åééç¥æèåçæ§æå¡å¨ä¸­æ·»å è¢«çæ§çä¸»æºï¼è¿ä¸ªæ¶åä»»å¡å°±éè¦å¨ç¹å®çä¸»æºä¸è¿è¡ï¼èéä¸å¼å§æå®çææä¸»æºï¼æ­¤æ¶å°±éè¦ansibleçå§æä»»å¡ã\n\nä½¿ç¨delegate_toå³é®å­å¯ä»¥éç½®ä»»å¡å¨æå®çæå¡å¨ä¸æ§è¡ï¼èå¶ä»ä»»å¡è¿æ¯å¨hostså³é®å­éç½®çæææºå¨ä¸æ§è¡ï¼å½å°äºè¿ä¸ªå³é®å­æå¨çä»»å¡æ¶ï¼å°±ä½¿ç¨å§æçæºå¨è¿è¡ã\n\næ¥çMySQLæ¯å¦å¨è¿è¡ç¶æï¼å æ­¤å¨æ£æ¥ä¹åé¦åå³æ162ä¸çmysqlæå¡ãï¼ä¸ºäºæ¹ä¾¿æ¥çç¶æï¼\n\n---\n - hosts: all\n   remote_user: root\n   tasks:\n     - name: stop the db server\n       service: name=mysqld state=stopped\n       delegate_to: 10.0.102.162       # è¿éä½¿ç¨äºå§æï¼ä»å³é­162è¿å°æå¡å¨ä¸ï¼è¿ä¸ªplayä»å¨162è¿å°æå¡å¨ä¸æ§è¡ã\n\n     - name: check mysql status\n       service: name=mysqld state=running\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nè¿éå§ææ¯å¨æå®çæºå¨ä¸æ§è¡ï¼è¥æ¯æ³å¨æ¬å°æå¡å¨ä¸æ§è¡ï¼å¯ä»¥æipå°åæ¢ä¸º127.0.0.1å³å¯ãä¹å¯ä»¥ä½¿ç¨local_actionæ¹æ³ã\n\n---\n - hosts: all\n   remote_user: root\n   tasks:\n     - name: create the test file\n       local_action: shell touch test1111 # å¨æ¬å°åå»ºä¸ä¸ªæµè¯æä»¶\n\n\n     - name: check mysql status\n       service: name=mysqld state=running\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nç»æå¦ä¸ï¼\n\n$ ansible-playbook test.yml\n\nPLAY [all] ********************************************************************\n\nGATHERING FACTS ***************************************************************\nok: [10.0.102.212]\nok: [10.0.102.200]\nok: [10.0.102.162]\n\nTASK: [create the test file] **************************************************\nchanged: [10.0.102.212 -> 127.0.0.1]\nchanged: [10.0.102.200 -> 127.0.0.1]\nchanged: [10.0.102.162 -> 127.0.0.1]\n\nTASK: [check mysql status] ****************************************************\nok: [10.0.102.200]\nok: [10.0.102.212]\nok: [10.0.102.162]\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=3    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=3    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=3    changed=1    unreachable=0    failed=0\n\n$ ls                     # é»è®¤ä¼å¨å½åç®å½åå»ºå¯¹åºçæä»¶\ntest1111  test.yml  vars.yml\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\n# 5.2 ä»»å¡æå\n\næäºæåµä¸ï¼ä¸äºä»»å¡çè¿è¡éè¦ç­å¾ä¸äºç¶æçæ¢å¤ï¼æ¯å¦æä¸å°ä¸»æºæèåºç¨ååéå¯ï¼æä»¬éè¦ç­å¾å®ä¸é¢çæä¸ªç«¯å£å¼å¯ï¼æ­¤æ¶æä»¬å°±ä¸å¾ä¸å°æ­£å¨è¿è¡çä»»å¡æåï¼ç´å°å¶ç¶ææ»¡è¶³æä»¬çéæ±ã\n\nä¸ä¸ä¸ªå®ä¾ï¼\n\n- name: wait for webserver to start\n   local_action:\n        module: wait_for\n        host: webserver1\n        port: 80\n        delay: 10\n        timeout: 300\n        state: startted\n# è¿ä¸ªå®ä¾ä¸­ï¼è¿ä¸ªä»»å¡å°ä¼æ¯10sæ£æ¥ä¸æ¬¡ä¸»æºwebserver1ä¸é¢ç80ç«¯å£æ¯å¦å¼å¯ï¼å¦æè¶è¿äº300såå¤±è´¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# 5.3 äº¤äºå¼æç¤º\n\nå¨å°æ°æåµä¸ï¼ansibleä»»å¡è¿è¡çè¿ç¨ä¸­éè¦ç¨æ·è¾å¥ä¸äºæ°æ®ï¼è¿äºæ°æ®è¦ä¹æ¯è¾ç§å¯ä¸æ¹ä¾¿ï¼æèæ°æ®æ¯å¨æçï¼ä¸åçç¨æ·æä¸åçéæ±ï¼æ¯å¦è¾å¥ç¨æ·èªå·±çè´¦æ·åå¯ç æèè¾å¥ä¸åççæ¬å·ä¼è§¦åä¸åçåç»­æä½ç­ãansibleçvars_promptå³é®å­å°±æ¯ç¨æ¥å¤çä¸è¿°è¿ç§ä¸ç¨æ·äº¤äºçæåµçãä¸é¢æ¯ä¸ä¸ªç®åçå®ä¾ã\n\n---\n - hosts: all\n   remote_user: root\n   vars_prompt:\n      - name: share_user\n        prompt: "what is your network username?"\n        private: no\n\n      - name: share_pass\n        prompt: "what is your network password"\n        private: no\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nç¶åæ§è¡ä¸é¢çplaybookï¼å ä¸ºæä»¬åªæ¯æµè¯ï¼åªéè¦å¨ä¸å°æºå¨ä¸æ§è¡ï¼å æ­¤å å¥äº--limitåæ°ã\n\n$ ansible-playbook test.yml --limit 10.0.102.162\nwhat is your network username?: test        # éè¦æå¨äº¤äºè¾å¥\nwhat is your network password: 123456       # æå¨è¾å¥\n\nPLAY [all] ********************************************************************\n\nGATHERING FACTS ***************************************************************\nok: [10.0.102.162]\n\nPLAY RECAP ********************************************************************\n10.0.102.162               : ok=1    changed=0    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næå¨è¾å¥çåéå¼ï¼å¨åé¢çplayä¸­ä»ç¶å¯ä»¥ç¨{{ var_name }}çå½¢å¼è°ç¨ã\n\nå³é®å­vars_promptå ä¸ªå¸¸ç¨çéé¡¹æ»ç»å¦ä¸ï¼\n\n * privateï¼é»è®¤å¼ä¸ºyesï¼è¡¨ç¤ºç¨æ·è¾å¥çå¼å¨å½ä»¤è¡ä¸å¯è§ï¼å°å¼è®¾ä¸ºnoæ¶ï¼ç¨æ·è¾å¥å¯è§ã\n * defaultï¼ä¸ºåéè®¾ç½®é»è®¤å¼ï¼ä»¥èçç¨æ·è¾å¥æ¶é´ã\n * confirmï¼ç¹å«éåè¾å¥å¯ç çæåµï¼å¦æå°å¶è®¾ç½®ä¸ºyesï¼åä¼è¦æ±ç¨æ·è¾å¥ä¸¤æ¬¡ï¼ä»¥å¢å è¾å¥çå®å¨æ§ã\n\n\n# å­ãtagsæ ç­¾\n\né»è®¤æåµä¸ï¼ansibleå¨æ§è¡ä¸ä¸ªplaybookæ¶ï¼ä¼æ§è¡playbookä¸­å®ä¹çææä»»å¡ãansibleçæ ç­¾åè½å¯ä»¥ç»è§è²ï¼æä»¶ï¼åç¬çä»»å¡çè³æ´ä¸ªplaybookæä¸æ ç­¾ï¼ç¶åå©ç¨è¿äºæ ç­¾æ¥æå®è¦è¿è¡playbookä¸­çä¸ªå«ä»»å¡ï¼æä¸æ§è¡æå®çä»»å¡ï¼å¹¶ä¸å®çè¯­æ³éå¸¸ç®åã\n\néè¿ä¸æ®µä»£ç æ¥è¯´ætagsçç¨æ³ï¼\n\n---\n# å¯ä»¥ç»æ´ä¸ªplaybookçææä»»å¡æä¸ä¸ªæ ç­¾ã\n  - hosts: all\n    tags: deploy\n    roles:\n     # ç»è§è²æçæ ç­¾å°ä¼åºç¨ä¸è§è²ä¸ææçä»»å¡ã\n       - {role: tomcat, tags : ["tomcat", "app"]}        # ä¸ä¸ªå¯¹è±¡æ·»å å¤ä¸ªtagçåæ³ä¹ä¸\n    tasks:\n       - name: Notify on completion\n         local_action:\n            module: osx_say\n            msg: "{{inventory_hostname}} is finished"\n            voice: Zarvox\n         tags:      # ä¸ä¸ªå¯¹è±¡æ·»å å¤ä¸ªtagåæ³ä¹äº\n            - notifications\n            - say\n       - include: foo.yml\n         tags:ãfoo\n\n# ç¼©è¿å¯è½ä¸å¤ªå¯¹\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nå°ä¸è¿°ä»£ç ä¿å­ï¼å¯ä»¥éè¿ä»¥ä¸å½ä»¤æ¥åªæ§è¡Notify on completionä»»å¡ã\n\n$ ansible-playbook test.yml --tags "say"\n\n\n1\n\n\nå¦ææ³å¿½ç¥ææä¸ªä»»å¡ï¼å¯ä»¥ä½¿ç¨--skip-tagså³é®å­æå®ã\n\n\n# ä¸ãBlockå\n\nansibleä»2.0.0çæ¬å¼å§å¼å¥äºååè½ãååè½å¯ä»¥å°ä»»å¡è¿è¡åç»ï¼å¹¶ä¸å¯ä»¥å¨åçº§å«ä¸åºç¨ä»»å¡åéãåæ¶ï¼ååè½è¿å¯ä»¥ä½¿ç¨ç±»ä¼¼äºå¶ä»ç¼ç¨è¯­è¨å¤çå¼å¸¸é£æ ·çæ¹æ³ï¼æ¥å¤çååé¨çä»»å¡å¼å¸¸ã\n\n---\n - hosts: all\n   remote_user: root\n\n   tasks:\n     - block:\n          - yum: name=httpd state=present\n          - service: name=httpd state=started enabled=no\n       when:  ansible_eth0.ipv4.address  == "10.0.102.162"\n\n     - block:\n          - yum: name=nginx state=present\n          - service: name=nginx state=started enabled=no\n       when:  ansible_eth0.ipv4.address  == "10.0.102.200"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nè¿è¡ç»æå¦ä¸ï¼\n\n$ ansible-playbook -i hosts test.yml\n\nPLAY [all] **************************************************************************************************************************************************************************************\n\nTASK [Gathering Facts] **************************************************************************************************************************************************************************\nok: [10.0.102.162]\nok: [10.0.102.200]\n\nTASK [yum] **************************************************************************************************************************************************************************************\nskipping: [10.0.102.200]          # å ä¸ºå¨inventoryæä»¶ä¸­æ³¨éäºè¿ä¸å°æå¡å¨ï¼å æ­¤è¿éå¿½ç¥äºã\nok: [10.0.102.162]\n\nTASK [service] **********************************************************************************************************************************************************************************\nskipping: [10.0.102.200]\nchanged: [10.0.102.162]\n\nTASK [yum] **************************************************************************************************************************************************************************************\nskipping: [10.0.102.162]\nok: [10.0.102.200]\n\nTASK [service] **********************************************************************************************************************************************************************************\nskipping: [10.0.102.162]\nchanged: [10.0.102.200]\n\nPLAY RECAP **************************************************************************************************************************************************************************************\n10.0.102.162               : ok=3    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=3    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\nä¸é¢çplaybookåä¹åçå¹¶æ²¡æä»ä¹ä¸åï¼åªæ¯åå¦äºblockä¹åï¼ä»£ç æ´å®¹ææ¥çã\n\nååè½å¯ä»¥ç¨æ¥å¤çä»»å¡çå¼å¸¸ãæ¯å¦ä¸ä¸ªansibleä»»å¡æ¶çæ§ä¸ä¸ªå¹¶ä¸å¤ªéè¦çåºç¨ï¼è¿ä¸ªåºç¨çæ­£å¸¸è¿è¡ä¸å¦å¯¹åç»­çä»»å¡å¹¶ä¸äº§çå½±åï¼è¿æ¶åæä»¬å°±å¯ä»¥éè¿ååè½æ¥å¤çè¿ä¸ªåºç¨çæ¥éãå¦ä¸ä»£ç ï¼\n\ntasks:\n   - block:\n        - name: shell script to connect the app ti a mointoring service.\n          script: mointoring-connect.sh\n          rescue:\n             - name:åªæèæ¬æ¥éæ¶ææ§è¡\nãããããããã debugï¼msg="There was an error in the block"\n          always:\n             - name: æ è®ºç»æå¦ä½é½æ§è¡\n               debug: msg="This always executes"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå½åä¸­ä»»æä»»å¡åºéæ¶ï¼rescueå³é®å­å¯¹åºçä»£ç åå°±ä¼è¢«æ§è¡ï¼èalwayså³é®å­å¯¹åºçä»£ç åæ è®ºå¦ä½é½ä¼è¢«æ§è¡ã\n\n*************** å½ä½ åç°èªå·±çæåæä¸èµ·éå¿æ¶ï¼å°±è¯·å®éä¸æ¥å­¦ä¹ å§ï¼***************\n\nåæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14198755.html',normalizedContent:'# ansible ä¸­ç playbook è¯¦è§£\n\nç®å½\n\n * ä¸ãplaybook\n   * 1.1 playbookæ¯ä»ä¹\n   * 1.2 playbookçè¯­æ³ç»æ\n   * 1.3 éå®ä¸»æºèå´æ§è¡\n   * 1.4 ansible-palybookçå°æå·§\n   * 1.5 ansible-playbookä¸­çhandlers\n   * 1.6 ä½¿ç¨handlersçæ³¨æäºé¡¹\n * äºãåé\n   * 2.1 playbookä¸­çåé\n   * 2.2 playbookä¸­ä½¿ç¨varsä»£ç åå®ä¹åé\n   * 2.3 ä½¿ç¨ç¬ç«çæä»¶æ¥å®ä¹playbookåé\n   * 2.4 inventoryæä»¶ä¸­çåé\n   * 2.5 ä¸»æºåéåç»åé\n   * 2.6 å·§ç¨ä¸»æºåéåç»åé\n   * 2.7 æ³¨ååé\n * ä¸ãé«é¶åé\n   * 3.1 fastsåéä¿¡æ¯\n   * 3.2 æ¬å°factsåé\n * åãif/when/whileæµç¨æ§å¶è¯­å¥\n   * 4.1 whenæ¡ä»¶å¤æ­\n * äºãä»»å¡é´çæµç¨æ§å¶\n   * 5.1 ä»»å¡å§æ\n   * 5.2 ä»»å¡æå\n   * 5.3 äº¤äºå¼æç¤º\n * å­ãtagsæ ç­¾\n * ä¸ãblockå\n\n\n# ä¸ãplaybook\n\n# 1.1 playbookæ¯ä»ä¹\n\næ ¹æ¬ä¸è¯´playbookåshellèæ¬æ²¡æä»»ä½çåºå«ï¼playbookå°±åshellä¸æ ·ï¼ä¹æ¯æä¸å çå½ä»¤ç»åèµ·æ¥ï¼ç¶åå å¥å¯¹åºæ¡ä»¶å¤æ­ç­ç­ï¼å¨shellèæ¬ä¸­æ¯ä¸æ¡ä¸æ¡çå½ä»¤ï¼èå¨playbookä¸­æ¯ä¸ä¸ªä¸ä¸ªçtaskä»»å¡ææï¼æ¯ä¸ªtaskä»»å¡å¯ä»¥çåshellä¸­çä¸æ¡å½ä»¤ï¼shellèæ¬ä¸è¬åªæ¯å¨å½åæå¡å¨ä¸æ§è¡ï¼èplaybookåæ¯å¨ä¸æ­¢ä¸ä¸ªæå¡å¨ä¸æ§è¡ï¼å æ­¤playbookéè¦å¨å¶ä¸­æå®è¿è¡è¯¥playbookçæå¡å¨åã\n\n# 1.2 playbookçè¯­æ³ç»æ\n\nplaybookä½¿ç¨ymlæ è®°è¯­è¨ï¼è¿æ¯ä¸ç§æ è®°è¯­è¨ï¼è¿ç§æ è®°è¯­è¨å¨æä»¶çæå¼å§éè¦ä½¿ç¨ä¸ä¸ªâ-âæ¥è¯´ææä»¶å¼å§ï¼ç¶åä½¿ç¨ç¼©è¿æ¥è¯´æä»£ç åçèå´ãä¸é¢éè¿ä¸ä¸ªç®æçå®ä¾ï¼æ¥è¯´æplaybookçè¯­æ³ã\n\n---      # æ è®°æä»¶çå¼å§\n- hosts: webservers   # æå®è¯¥playbookå¨åªä¸ªæå¡å¨ä¸æ§è¡\n  vars:         # è¡¨ç¤ºä¸é¢æ¯å®ä¹çåéï¼\n    http_port: 80    # åéçå½¢å¼ï¼key: valueï¼è¿éhttp_portæ¯åéåï¼80æ¯å¼\n    max_clients: 200\n  remote_user: root  # æå®è¿ç¨çç¨æ·åï¼è¿éç¼©è¿åvarsä¿æäºä¸è´ï¼è¯´æåéçä»£ç åå·²ç»ç»æã\n  tasks:  # ä¸é¢ææplaybookçtasksï¼æ¯ä¸ªtaské½æ - name: å¼å§ï¼nameæå®è¯¥ä»»å¡çåç§°ã\n  - name: ensure apache is at the latest version  # æå®è¯¥ä»»å¡çåç§°ã\n    yum: pkg=httpd state=latest  # yumè¯´æè¦æ¯ç¨çæ¨¡æ¿åç§°ï¼åé¢æå®å¯¹åºçåæ°ï¼è¿ä¸¤è¡ç»åèµ·æ¥å°±ç¸å½äºä¸ä¸ªshellå½ä»¤ã\n\n  - name: write the apache config file      # æ¯ä¸ªtaskä¹é´å¯ä»¥ä½¿ç¨ç©ºè¡æ¥ååºåã\n    template: src=/srv/httpd.j2 dest=/etc/httpd.conf\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\néè¦è¯´æçæ¯ç¼©è¿çæä¹åpythonä¸­ç¼©è¿çæä¹æ¯ä¸æ ·ï¼æ¯æ¥åºåä»£ç åçã\n\nä¸ä¸ªç®åçå®ä¾ï¼æ£æ¥mysqlçè¿è¡ç¶æ\n\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no   # ä¸æ¶éå¯¹åºä¸»æºçä¿¡æ¯ï¼è¿æ ·è¿è¡ä¼å¿«ç¹ã\n   tasks:\n     - name: check the mysql stauts\n       service: name=mysqld state=running\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿è¡playbookï¼\n\n$ ansible-playbook test.yml\n\nplay [all] ********************************************************************\n\ntask: [check the mysql stauts] ************************************************\nok: [10.0.102.200]\nok: [10.0.102.162]\nok: [10.0.102.212]\n\nplay recap ********************************************************************\n10.0.102.162               : ok=1    changed=0    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=0    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=0    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# 1.3 éå®ä¸»æºèå´æ§è¡\n\nè½ç¶playbookä¸­å®ä¹äºæ§è¡çä¸»æºï¼ä½æ¯ææ¶åæä»¬å¯è½ä»æ³å¨å®ä¹çä¸»æºä¸­çé¨åæºå¨ä¸æ§è¡ï¼è¿æ¶åæä¹åï¼ä¿®æ¹playbookä¸­çhostsçèå´ï¼ä½æ¯æ¯æ¬¡æ¹åä¸»æºå°±ä¿®æ¹ä¸æ¬¡ï¼æ¯è¾éº»ç¦ï¼æä»¬å¯ä»¥ä½¿ç¨--limitåæ°ï¼æå®è¯¥playbookå¨æå®çä¸»æºä¸æ§è¡ãæä»¥ä¸inventoryæä»¶ï¼æä»¬æ³å¨dbserversä¸æ§è¡ä¸é¢æµè¯ç¨çplaybookåå®¹ã\n\n[all]\n10.0.102.212\n10.0.102.200\n10.0.102.162\n\n[dbservers]\n10.0.102.162\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸é¢æµè¯çplaybookä¸­hostså®ä¹allï¼æä»¬æ³ä»å¨dbserversä¸æ§è¡ã\n\n$ ansible-playbook test.yml --limit dbservers\n\nplay [all] ********************************************************************\n\ntask: [check the mysql stauts] ************************************************\nok: [10.0.102.162]\n\nplay recap ********************************************************************\n10.0.102.162               : ok=1    changed=0    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ¥çå½åplaybookå¨åªäºä¸»æºä¸æ§è¡\n\n$ ansible-playbook test.yml --list-hosts\n\nplaybook: test.yml\n\n  play              # 1 (all): host count=3\n    10.0.102.162\n    10.0.102.212\n    10.0.102.200\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# 1.4 ansible-palybookçå°æå·§\n\n * --inventory=pathï¼æå®inventoryæä»¶ï¼é»è®¤æ¯å¨/etc/ansible/hostsä¸é¢ã\n * --verboseï¼æ¾ç¤ºè¯¦ç»çè¾åºï¼ä½¿ç¨-vvvvæ¾ç¤ºç²¾ç¡®å°æ¯åéçè¾åºã\n * --extra-vars=varsï¼å®ä¹å¨playbookä½¿ç¨çåéã\n * --forksï¼æå®å¹¶åççº¿ç¨æ°ï¼é»è®¤æ¯5.\n * --connection=type:æå®è¿ç¨è¿æ¥ä¸»æºçæ¹å¼ï¼é»è®¤æ¯sshï¼è®¾ç½®ä¸ºlocalæ¶ï¼ååªå¨æ¬å°æ§è¡playbookã\n * --check:æ£æµæ¨¡å¼ï¼playbookä¸­å®ä¹çææä»»å¡å°å¨æ¯å°ä¸»æºä¸æ£æµï¼ä½æ¯å¹¶ä¸æ§è¡ã\n\n# 1.5 ansible-playbookä¸­çhandlers\n\nå¨ç³»ç»ä¸­ï¼æä»¬ä¿®æ¹äºæå¡å¨çéç½®æä»¶ï¼è¿æ¶åå°±éè¦éå¯æä½æå¡ï¼å°±å¯ä»¥ä½¿ç¨å°handlersã\n\nhandlers:             # å®ä¹ä¸¤ä¸ªhandlers\n    - name: restart memcached\n      service:  name=memcached state=restarted\n    - name: restart apache\n      service: name=apache state=restarted\n\n- name: template configuration file\n  template: src=template.j2 dest=/etc/foo.conf  # ä¿®æ¹äºéç½®æä»¶ç¶åä¾æ¬¡å¯å¨memcachedåapacheæå¡ã\n  notify:        # ä½¿ç¨notifyæ¥å£°æå¼ç¨handlersã\n     - restart memcached\n     - restart apache\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n# 1.6 ä½¿ç¨handlersçæ³¨æäºé¡¹\n\n * handlersåªæå¨å¶æå¨çä»»å¡è¢«æ§è¡æ¶ï¼æä¼è¢«è¿è¡ï¼å¦æä¸ä¸ªä»»å¡ä¸­å®ä¹äºnotifyè°ç¨handlersï¼ä½æ¯ç±äºæ¡ä»¶å¤æ­ç­åå ï¼è¯¥ä»»å¡æªè¢«æ§è¡ï¼é£ä¹handlersåæ ·ä¸ä¼è¢«æ§è¡ã\n * handlersåªä¼å¨æ¯ä¸ä¸ªplayçæ«å°¾è¿è¡ä¸æ¬¡ï¼å¦ææ³å¨ä¸ä¸ªplaybookä¸­é´è¿è¡handlersï¼åéè¦ä½¿ç¨metaæ¨¡åæ¥å®ç°ãä¾å¦ï¼-meta: flush_handlers.\n * å¦æä¸ä¸ªplayå¨è¿è¡å°è°ç¨handlersçè¯­å¥ä¹åå¤±è´¥äºï¼é£ä¹è¿ä¸ªhandlerså°ä¸ä¼è¢«æ§è¡ãæä»¬å¯ä»¥ä½¿ç¨metaæ¨¡åç--force-handlerséé¡¹æ¥å¼ºå¶æ§è¡handlersï¼å³ä½¿handlersæå¨çplayä¸­éè¿è¡å¤±è´¥ä¹è½æ§è¡ã\n\n\n# äºãåé\n\nè¿ä¸ªåéæä»¬æ¥è¯´æansibleä¸­åéï¼ä¸åå«roleä¸­çåéï¼ç¨æ³ã\n\n# 2.1 playbookä¸­çåé\n\nå¨è¿è¡playbookçæ¶åä½¿ç¨--extra-varsæ¥æå®åé\n\næå¦ä¸playbookèæ¬ï¼\n\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   tasks:\n     - name: test playbook variables\n       command: echo {{ test_var }}   # æå°åºåétest_varçå¼ã\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nè¿è¡playbookï¼\n\n$ ansible-playbook test.yml --extra-vars "test_var=test" -v    \n# å ä¸-véé¡¹ï¼ä¼æ¾ç¤ºè¯¦ç»çä¿¡æ¯\n\nplay [all] ********************************************************************\n\ntask: [test playbook variables] ***********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "test"], "delta": "0:00:00.006045", "end": "2019-02-15 23:04:49.789452", "rc": 0, "start": "2019-02-15 23:04:49.783407", "stderr": "", "stdout": "test"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "test"], "delta": "0:00:00.005318", "end": "2019-02-15 23:04:52.976471", "rc": 0, "start": "2019-02-15 23:04:52.971153", "stderr": "", "stdout": "test"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "test"], "delta": "0:00:00.005082", "end": "2019-02-15 23:04:52.424959", "rc": 0, "start": "2019-02-15 23:04:52.419877", "stderr": "", "stdout": "test"}\n\nplay recap ********************************************************************\n10.0.102.162               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nä¸é¢è¯¦ç»ä¿¡æ¯çæ åè¾åºä¸ºtestï¼è¯´æåéçå¼å·²ç»ä¼ éäºã\n\n# 2.2 playbookä¸­ä½¿ç¨varsä»£ç åå®ä¹åé\n\n$ cat test.yml\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   vars:                  # å¨è¿éä½¿ç¨äºvarsä»£ç åæ¥å®ä¹åé\n       test_var: hello world\n   tasks:\n     - name: test playbook variables\n       command: echo {{ test_var }}\n\n$ ansible-playbook test.yml  -v\n\nplay [all] ********************************************************************\n\ntask: [test playbook variables] ***********************************************\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "hello", "world"], "delta": "0:00:00.004940", "end": "2019-02-15 23:20:06.541672", "rc": 0, "start": "2019-02-15 23:20:06.536732", "stderr": "", "stdout": "hello world"}\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "hello", "world"], "delta": "0:00:00.004843", "end": "2019-02-15 23:20:03.957950", "rc": 0, "start": "2019-02-15 23:20:03.953107", "stderr": "", "stdout": "hello world"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "hello", "world"], "delta": "0:00:00.004219", "end": "2019-02-15 23:20:07.166900", "rc": 0, "start": "2019-02-15 23:20:07.162681", "stderr": "", "stdout": "hello world"}\n\nplay recap ********************************************************************\n10.0.102.162               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n# 2.3 ä½¿ç¨ç¬ç«çæä»¶æ¥å®ä¹playbookåé\n\nplaybookçåå®¹ï¼\n\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   vars_files:       # è¿éä½¿ç¨äºvars_filesæ¥å¼å¥åéæä»¶\n     - vars.yml\n   tasks:\n     - name: test playbook variables\n       command: echo {{ test_var }}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nåéæä»¶çå®ä¹ï¼\n\n$ cat vars.yml\n---\n  test_var: hello world\n\n\n1\n2\n3\n\n\næ§è¡çç»æï¼\n\n$ ansible-playbook test.yml  -v\n\nplay [all] ********************************************************************\n\ntask: [test playbook variables] ***********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "hello", "world"], "delta": "0:00:00.005198", "end": "2019-02-15 23:23:16.397557", "rc": 0, "start": "2019-02-15 23:23:16.392359", "stderr": "", "stdout": "hello world"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "hello", "world"], "delta": "0:00:00.004359", "end": "2019-02-15 23:23:19.629804", "rc": 0, "start": "2019-02-15 23:23:19.625445", "stderr": "", "stdout": "hello world"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "hello", "world"], "delta": "0:00:01.006185", "end": "2019-02-15 23:23:20.039320", "rc": 0, "start": "2019-02-15 23:23:19.033135", "stderr": "", "stdout": "hello world"}\n\nplay recap ********************************************************************\n10.0.102.162               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# 2.4 inventoryæä»¶ä¸­çåé\n\nå¨ansibleä¸­ï¼inventoryæä»¶éå¸¸æ¯æansibleçä¸»æºåç»å®ä¹æä»¶hostsãå¨hostsæä»¶ä¸­ï¼åéä¼è¢«å®ä¹å¨ä¸»æºååé¢æç»åçä¸æ¹ã\n\nä¸ºç¹å®çä¸»æºå®ä¹åéï¼åéåè·å¨å¯¹åºä¸»æºçåè¾¹ã\n\ninventoryæä»¶å¦ä¸ï¼\n\n$ cat /etc/ansible/hosts\n[all]\n10.0.102.212 test_var=212\n10.0.102.200 test_var=200\n10.0.102.162 test_var=162\n# ä¸ºä¸ä¸ªä¸»æºå®ä¹äºååçåéï¼ä½æ¯åéå¼å´ä¸ä¸æ ·ã\n\n\n1\n2\n3\n4\n5\n6\n\n\nplaybookçåå®¹å¦ä¸ï¼\n\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   tasks:\n     - name: test playbook variables\n       command: echo {{ test_var }}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næ§è¡è¿ä¸ªplaybookï¼ç»æå¦ä¸ï¼å¯¹åºçä¸»æºæ¾ç¤ºäºåèªå¯¹åºçåéå¼ï¼ï¼\n\n$ ansible-playbook test.yml -v\n\nplay [all] ********************************************************************\n\ntask: [test playbook variables] ***********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "212"], "delta": "0:00:00.004399", "end": "2019-02-15 23:31:20.648111", "rc": 0, "start": "2019-02-15 23:31:20.643712", "stderr": "", "stdout": "212"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "200"], "delta": "0:00:00.005932", "end": "2019-02-15 23:31:23.873082", "rc": 0, "start": "2019-02-15 23:31:23.867150", "stderr": "", "stdout": "200"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "162"], "delta": "0:00:00.006723", "end": "2019-02-15 23:31:23.287861", "rc": 0, "start": "2019-02-15 23:31:23.281138", "stderr": "", "stdout": "162"}\n\nplay recap ********************************************************************\n10.0.102.162               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nç»ä¸»æºç»å®ä¹åéï¼ä½ç¨èå´ä¸ºæ´ä¸ªä¸»æºç»ã\n\n$ cat /etc/ansible/hosts\n[all]\n10.0.102.212\n10.0.102.200\n10.0.102.162\n\n\n[all:vars]                            #ç»ä¸»æºç»å®ä¹åé\ntest_var=hello world\n\n$ ansible-playbook test.yml -v\n\nplay [all] ********************************************************************\n\ntask: [test playbook variables] ***********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "hello", "world"], "delta": "0:00:00.003923", "end": "2019-02-15 23:37:29.322158", "rc": 0, "start": "2019-02-15 23:37:29.318235", "stderr": "", "stdout": "hello world"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "hello", "world"], "delta": "0:00:00.004161", "end": "2019-02-15 23:37:32.548947", "rc": 0, "start": "2019-02-15 23:37:32.544786", "stderr": "", "stdout": "hello world"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "hello", "world"], "delta": "0:00:00.006090", "end": "2019-02-15 23:37:32.005067", "rc": 0, "start": "2019-02-15 23:37:31.998977", "stderr": "", "stdout": "hello world"}\n\nplay recap ********************************************************************\n10.0.102.162               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nåæ³ä¸ä¸ï¼è¿ç§æ¹æ³å®ä¹åéè½ç¶ç®åç´è§ï¼ä½æ¯è¥æ¯åéç¹å«å¤çæåµä¸ï¼ä¼æä¹æ ·ï¼ç¹å«æ¯ç»å¯¹åºçä¸»æºå®ä¹åéï¼è¥æ¯åéå¤ªå¤ï¼åç®¡çèµ·æ¥ä¼å¾ä¸æ¹ä¾¿çï¼å æ­¤å¼å¥äºä¸»æºåéåç»åéã\n\n# 2.5 ä¸»æºåéåç»åé\n\ninventoryæä»¶ä»ç¶ä½¿ç¨ä¸é¢çæä»¶ï¼\n\nå¨æ§è¡ansbileå½ä»¤æ¶ï¼ansibleé»è®¤ä¼ä»/etc/ansible/host_vars/å/etc/amsible/group_vars/ä¸¤ä¸ªç®å½ä¸è¯»ååéå®ä¹ï¼å¦æ/etc/ansibleä¸é¢æ²¡æè¿ä¸¤ä¸ªç®å½ï¼å¯ä»¥ç´æ¥æå¨åå»ºï¼å¹¶ä¸å¯ä»¥å¨è¿ä¸¤ä¸ªç®å½ä¸­åå»ºä¸hostsï¼è¿éæ¯æinventoryæä»¶ï¼æä»¶ä¸­ä¸»æºåæç»åååçæä»¶æ¥å®ä¹åéã\n\nåæ¥çä¸»æºåé\n\n$ tree /etc/ansible/\n.\nâââ group_vars\nâââ hosts\nâââ host_vars                 # å®ä¹ä¸ä¸»æºåååçæä»¶\n    âââ 10.0.102.162\n    âââ 10.0.102.200\n    âââ 10.0.102.212\n\n2 directories, 4 files\n\n# æä»¶ä¸­çåå®¹å¦ä¸ï¼\n$ cat host_vars/10.0.102.162\n---\ntest_var: 162\n$ cat host_vars/10.0.102.200\n---\n  test_var: 200\n$ cat host_vars/10.0.102.212\n---\n  test_var: 212\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nplaybookçåå®¹å¦ä¸ï¼æ§è¡ç»æå¦ä¸ï¼\n\n$ cat test.yml\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   tasks:\n     - name: test playbook variables\n       command: echo {{ test_var }}\n\n$ ansible-playbook test.yml -v\n\nplay [all] ********************************************************************\n\ntask: [test playbook variables] ***********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "212"], "delta": "0:00:00.003767", "end": "2019-02-15 23:55:58.595282", "rc": 0, "start": "2019-02-15 23:55:58.591515", "stderr": "", "stdout": "212"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "162"], "delta": "0:00:00.006254", "end": "2019-02-15 23:56:01.235307", "rc": 0, "start": "2019-02-15 23:56:01.229053", "stderr": "", "stdout": "162"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "200"], "delta": "0:00:01.004509", "end": "2019-02-15 23:56:02.775410", "rc": 0, "start": "2019-02-15 23:56:01.770901", "stderr": "", "stdout": "200"}\n\nplay recap ********************************************************************\n10.0.102.162               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nåæ¥è¯´æä¸ä¸ä¸»æºç»åéï¼\n\nåå»ºä¸ç»åååçæä»¶ï¼\n\n$ tree\n.\nâââ group_vars\nâ   âââ all               #åå»ºä¸ç»åååçæä»¶\nâââ hosts\nâââ host_vars\n    âââ 10.0.102.162\n    âââ 10.0.102.200\n    âââ 10.0.102.212\n\n2 directories, 5 files\n\n$ cat group_vars/all\n---\n  test_group_var: from group\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\næ§è¡ç»æå¦ä¸ï¼\n\n$ cat test.yml\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   tasks:\n     - name: test the host variables\n       command: echo {{ test_var }}\n\n     - name: test host group variables           #åå¥æµè¯ç»åéçtask\n       command: echo {{ test_group_var }}\n$ ansible-playbook test.yml -v\n\nplay [all] ********************************************************************\n\ntask: [test the host variables] ***********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "212"], "delta": "0:00:00.004613", "end": "2019-02-15 23:59:23.227722", "rc": 0, "start": "2019-02-15 23:59:23.223109", "stderr": "", "stdout": "212"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "200"], "delta": "0:00:00.006490", "end": "2019-02-15 23:59:26.422682", "rc": 0, "start": "2019-02-15 23:59:26.416192", "stderr": "", "stdout": "200"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "162"], "delta": "0:00:00.004709", "end": "2019-02-15 23:59:25.812786", "rc": 0, "start": "2019-02-15 23:59:25.808077", "stderr": "", "stdout": "162"}\n\ntask: [test host group variables] *********************************************\nchanged: [10.0.102.212] => {"changed": true, "cmd": ["echo", "from", "group"], "delta": "0:00:00.003759", "end": "2019-02-15 23:59:23.519180", "rc": 0, "start": "2019-02-15 23:59:23.515421", "stderr": "", "stdout": "from group"}\nchanged: [10.0.102.162] => {"changed": true, "cmd": ["echo", "from", "group"], "delta": "0:00:00.003748", "end": "2019-02-15 23:59:26.109337", "rc": 0, "start": "2019-02-15 23:59:26.105589", "stderr": "", "stdout": "from group"}\nchanged: [10.0.102.200] => {"changed": true, "cmd": ["echo", "from", "group"], "delta": "0:00:00.004339", "end": "2019-02-15 23:59:26.724525", "rc": 0, "start": "2019-02-15 23:59:26.720186", "stderr": "", "stdout": "from group"}\n\nplay recap ********************************************************************\n10.0.102.162               : ok=2    changed=2    unreachable=0    failed=0\n10.0.102.200               : ok=2    changed=2    unreachable=0    failed=0\n10.0.102.212               : ok=2    changed=2    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n# 2.6 å·§ç¨ä¸»æºåéåç»åé\n\nææ¶åå¨æ§è¡ansbileä»»å¡æ¶ï¼å¯è½éè¦ä»ä¸å°è¿ç¨ä¸»æºä¸è·åå¦ä¸å°è¿ç¨ä¸»æºçåéä¿¡æ¯ï¼è¿æ¶åå¯ä»¥ä½¿ç¨hostvarsåéï¼è¿ä¸ªåéåå«äºæå®ä¸»æºä¸æå®ä¹çææåéã\n\nè­¬å¦ï¼è¥æ¯æ³è·åhost1ä¸åéadmin_userçåå®¹ï¼å¨ä»»æä¸»æºä¸ç´æ¥ä¸ä½¿ç¨ä¸é¢ä»£ç å³å¯ã\n\n{{  hostvars[\'host1\'][\'admin_user\']}}\n\n\n1\n\n\nansibleæä¾äºä¸äºéå¸¸æç¨çåç½®åéï¼å ä¸ªå¸¸ç¨çå¦ä¸ï¼\n\n * grorpsï¼åå«äºææhostsæä»¶éçä¸»æºç»çä¸ä¸ªåè¡¨ã\n * group_names: åå«äºå½åä¸»æºæå¨çææä¸»æºç»åçä¸ä¸ªåè¡¨ã\n * inventory_hostname: éè¿hostsæä»¶å®ä¹çä¸»æºåãï¼ä¸ansible_homeæä¹ä¸åï¼\n * inventory_hostname_shortï¼åéinventory_hostnameçç¬¬ä¸é¨åãè­¬å¦inventory_hostnameçå¼ä¸ºbooks.ansible.comï¼é£ä¹inventory_hostname_shortçå¼å°±æ¯booksã\n * play_hosts: å°æ§è¡å½åä»»å¡çææä¸»æº\n\n# 2.7 æ³¨ååé\n\næ³¨ååéï¼å¶å®å°±æ¯å°æä½ç»æï¼åæ¬æ åè¾åºåæ åéè¯¯è¾åºï¼ä¿å­å°åéä¸­ï¼ç¶ååæ ¹æ®è¿ä¸ªåéçåå®¹æ¥å³å®ä¸ä¸æ­¥çæä½ï¼å¨è¿ä¸ªè¿ç¨ä¸­ç¨æ¥ä¿å­æä½ç»æçåéå°±å«æ³¨ååéã\n\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   tasks:\n     - name: test the register variables\n       shell: uptime\n       register: results     # ä½¿ç¨å³é®å­registerå£°ææ³¨ååéï¼ä¸é¢uptimeå½ä»¤äº§ççç»æï¼å­å¥å°resultsä¸­ãç»ææ¯å­å¸å½¢å¼ã\n\n     - name: print the register result\n       debug: msg="{{ results.stdout }}"   # ä½¿ç¨debugæ¨¡åï¼æå°åºä¸é¢å½ä»¤çè¾åºç»æã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nä¸é¢çplaybookæ§è¡ç»æå¦ä¸ï¼\n\n$ ansible-playbook test.yml\n\nplay [all] ********************************************************************\n\ntask: [test the register variables] *******************************************\nchanged: [10.0.102.212]\nchanged: [10.0.102.200]\nchanged: [10.0.102.162]\n\ntask: [print the register result] *********************************************\nok: [10.0.102.212] => {\n    "msg": " 00:18:01 up 3 days,  2:56,  3 users,  load average: 0.02, 0.03, 0.05"          #msgçç»æå°±æ¯æ³¨ååéçæ åè¾åº\n}\nok: [10.0.102.200] => {\n    "msg": " 00:18:04 up 4 days,  7:45,  3 users,  load average: 0.03, 0.06, 0.05"\n}\nok: [10.0.102.162] => {\n    "msg": " 00:18:04 up 4 days,  7:45,  3 users,  load average: 0.01, 0.02, 0.05"\n}\n\nplay recap ********************************************************************\n10.0.102.162               : ok=2    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=2    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=2    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nä¸ä¸ªæ³¨ååééå¸¸ä¼æä»¥ä¸4ä¸ªå±æ§ï¼\n\n * changedï¼ä»»å¡æ¯å¦å¯¹è¿ç¨ä¸»æºé æçåæ´ã\n * deltaï¼ä»»å¡è¿è¡æç¨çæ¶é´ã\n * stdoutï¼æ­£å¸¸çè¾åºä¿¡æ¯ã\n * stderrï¼éè¯¯ä¿¡æ¯ã\n\n\n# ä¸ãé«é¶åé\n\nå¯¹äºæ®éåéï¼å¨ansibleå½ä»¤è¡è®¾å®çï¼å¨hostsæä»¶ä¸­å®ä¹çï¼æèå¨playbookä¸­å®ä¹çç­ï¼è¿äºé½æ¯æ®éåéï¼å¨å¼ç¨æ¶ï¼å¯ä»¥ä½¿ç¨ä½¿ç¨{{ variable }}çå½¢å¼ãansibleæ¯ç¨pythonè¯­è¨åçï¼å æ­¤ä¹æ¯æä¸ç§å«ååè¡¨çåéï¼å½¢å¼å¦ä¸ï¼\n\n---\n - hosts: all\n   remote_user: root\n   gather_facts: no\n   vars:\n      var_list:     # æ³¨æå½¢å¼ï¼å®ä¹äºvar_liståè¡¨ï¼åå¼æ¹æ³ååè¡¨åå¼ä¸æ ·ï¼ä¸æ¨èä½¿ç¨jinja2çæ¹æ³åå¼ã\n          - one\n          - two\n          - three\n   tasks:\n     - name: test the list variables\n       shell: echo {{ var_list[0] }}   # ååè¡¨ä¸­çç¬¬ä¸ä¸ªå­ï¼ä¹å°±æ¯one\n       register: results\n\n     - name: print the register result\n       debug: msg="{{ results.stdout }}"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\næ§è¡ç»æå¦ä¸ï¼\n\n$ ansible-playbook test.yml\n\nplay [all] ********************************************************************\n\ntask: [test the list variables] ***********************************************\nchanged: [10.0.102.212]\nchanged: [10.0.102.200]\nchanged: [10.0.102.162]\n\ntask: [print the register result] *********************************************\nok: [10.0.102.212] => {\n    "msg": "one"\n}\nok: [10.0.102.200] => {\n    "msg": "one"\n}\nok: [10.0.102.162] => {\n    "msg": "one"\n}\n\nplay recap ********************************************************************\n10.0.102.162               : ok=2    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=2    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=2    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n# 3.1 fastsåéä¿¡æ¯\n\nå¨ä¸é¢çæµè¯ä¸­ï¼æä»¬çplaybooké½æ§è¡äºä¸æ¡å½ä»¤å«gater_facts:noï¼å å¥äºè¿æ¡å½ä»¤åï¼playbookèæ¬çæ§è¡éåº¦ä¼å¿«å¾å¤ï¼è¿æ¯å ä¸ºé»è®¤æåµä¸ï¼ansibleæ¯ä¼ææºè¿ç¨æå¡å¨çä¸»æºä¿¡æ¯ï¼è¿äºä¿¡æ¯åå«äºæå¡å¨çä¸äºåºæ¬è®¾ç½®ã\n\ngathering facts ***************************************************************\nok: [10.0.102.200]\nok: [10.0.102.212]\nok: [10.0.102.162]\n\n\n1\n2\n3\n4\n\n\næ¶éçä¸»æºä¿¡æ¯å¯ä»¥ä½¿ç¨setupæ¨¡åæ¥çï¼ä¸ä¸ªä¸»æºçæ¶éä¿¡æ¯å¦ä¸ï¼\n\nansible 10.0.102.162 -m setup\n10.0.102.162 | success >> {\n    "ansible_facts": {\n        "ansible_all_ipv4_addresses": [\n            "10.0.102.162"\n        ],\n        "ansible_all_ipv6_addresses": [\n            "fe80::1392:ecd3:5adf:c3ae"\n        ],\n        "ansible_architecture": "x86_64",\n        "ansible_bios_date": "04/01/2014",\n        "ansible_bios_version": "1.9.1-5.el7.centos",\n        "ansible_cmdline": {\n            "boot_image": "/vmlinuz-3.10.0-514.el7.x86_64",\n            "lang": "en_us.utf-8",\n            "crashkernel": "auto",\n            "quiet": true,\n            "rd.lvm.lv": "cl/swap",\n            "rhgb": true,\n            "ro": true,\n            "root": "/dev/mapper/cl-root"\n        },\n        "ansible_date_time": {\n            "date": "2019-02-16",\n            "day": "16",\n            "epoch": "1550248590",\n            "hour": "00",\n            "iso8601": "2019-02-15t16:36:30z",\n            "iso8601_micro": "2019-02-15t16:36:30.311222z",\n            "minute": "36",\n            "month": "02",\n            "second": "30",\n            "time": "00:36:30",\n            "tz": "cst",\n            "tz_offset": "+0800",\n            "weekday": "saturday",\n            "year": "2019"\n        },\n        "ansible_default_ipv4": {\n            "address": "10.0.102.162",\n            "alias": "eth0",\n            "gateway": "10.0.100.1",\n            "interface": "eth0",\n            "macaddress": "fa:0a:e3:54:a6:00",\n            "mtu": 1500,\n            "netmask": "255.255.252.0",\n            "network": "10.0.100.0",\n            "type": "ether"\n        },\n        "ansible_default_ipv6": {},\n        "ansible_devices": {\n            "sr0": {\n                "holders": [],\n                "host": "ide interface: intel corporation 82371sb piix3 ide [natoma/triton ii]",\n                "model": "qemu dvd-rom",\n                "partitions": {},\n                "removable": "1",\n                "rotational": "1",\n                "scheduler_mode": "cfq",\n                "sectors": "2097151",\n                "sectorsize": "512",\n                "size": "1024.00 mb",\n                "support_discard": "0",\n                "vendor": "qemu"\n            },\n            "vda": {\n                "holders": [],\n                "host": "scsi storage controller: red hat, inc virtio block device",\n                "model": null,\n                "partitions": {\n                    "vda1": {\n                        "sectors": "2097152",\n                        "sectorsize": 512,\n                        "size": "1.00 gb",\n                        "start": "2048"\n                    },\n                    "vda2": {\n                        "sectors": "81786880",\n                        "sectorsize": 512,\n                        "size": "39.00 gb",\n                        "start": "2099200"\n                    }\n                },\n                "removable": "0",\n                "rotational": "1",\n                "scheduler_mode": "",\n                "sectors": "83886080",\n                "sectorsize": "512",\n                "size": "40.00 gb",\n                "support_discard": "0",\n                "vendor": "0x1af4"\n            }\n        },\n        "ansible_distribution": "centos",\n        "ansible_distribution_major_version": "7",\n        "ansible_distribution_release": "core",\n        "ansible_distribution_version": "7.3.1611",\n        "ansible_domain": "",\n        "ansible_env": {\n            "home": "/root",\n            "lang": "en_us.utf-8",\n            "lc_ctype": "en_us.utf-8",\n            "lessopen": "||/usr/bin/lesspipe.sh %s",\n            "logname": "root",\n            "ls_colors": "rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;36:*.au=01;36:*.flac=01;36:*.mid=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:*.xspf=01;36:",\n            "mail": "/var/mail/root",\n            "path": "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin",\n            "pwd": "/root",\n            "selinux_level_requested": "",\n            "selinux_role_requested": "",\n            "selinux_use_current_range": "",\n            "shell": "/bin/bash",\n            "shlvl": "2",\n            "ssh_client": "10.0.102.204 4242 22",\n            "ssh_connection": "10.0.102.204 4242 10.0.102.162 22",\n            "ssh_tty": "/dev/pts/1",\n            "term": "xterm",\n            "user": "root",\n            "xdg_runtime_dir": "/run/user/0",\n            "xdg_session_id": "168",\n            "_": "/usr/bin/python"\n        },\n        "ansible_eth0": {\n            "active": true,\n            "device": "eth0",\n            "ipv4": {\n                "address": "10.0.102.162",\n                "netmask": "255.255.252.0",\n                "network": "10.0.100.0"\n            },\n            "ipv6": [\n                {\n                    "address": "fe80::1392:ecd3:5adf:c3ae",\n                    "prefix": "64",\n                    "scope": "link"\n                }\n            ],\n            "macaddress": "fa:0a:e3:54:a6:00",\n            "module": "virtio_net",\n            "mtu": 1500,\n            "promisc": false,\n            "type": "ether"\n        },\n        "ansible_form_factor": "other",\n        "ansible_fqdn": "docker4",\n        "ansible_hostname": "docker4",\n        "ansible_interfaces": [\n            "lo",\n            "eth0"\n        ],\n        "ansible_kernel": "3.10.0-514.el7.x86_64",\n        "ansible_lo": {\n            "active": true,\n            "device": "lo",\n            "ipv4": {\n                "address": "127.0.0.1",\n                "netmask": "255.0.0.0",\n                "network": "127.0.0.0"\n            },\n            "ipv6": [\n                {\n                    "address": "::1",\n                    "prefix": "128",\n                    "scope": "host"\n                }\n            ],\n            "mtu": 65536,\n            "promisc": false,\n            "type": "loopback"\n        },\n        "ansible_machine": "x86_64",\n        "ansible_memfree_mb": 881,\n        "ansible_memtotal_mb": 1839,\n        "ansible_mounts": [\n            {\n                "device": "/dev/mapper/cl-root",\n                "fstype": "xfs",\n                "mount": "/",\n                "options": "rw,seclabel,relatime,attr2,inode64,noquota",\n                "size_available": 34615087104,\n                "size_total": 39700664320\n            },\n            {\n                "device": "/dev/vda1",\n                "fstype": "xfs",\n                "mount": "/boot",\n                "options": "rw,seclabel,relatime,attr2,inode64,noquota",\n                "size_available": 918556672,\n                "size_total": 1063256064\n            }\n        ],\n        "ansible_nodename": "docker4",\n        "ansible_os_family": "redhat",\n        "ansible_pkg_mgr": "yum",\n        "ansible_processor": [\n            "qemu virtual cpu version 2.5+",\n            "qemu virtual cpu version 2.5+"\n        ],\n        "ansible_processor_cores": 2,\n        "ansible_processor_count": 1,\n        "ansible_processor_threads_per_core": 1,\n        "ansible_processor_vcpus": 2,\n        "ansible_product_name": "kvm",\n        "ansible_product_serial": "na",\n        "ansible_product_uuid": "e5e1d5e6-1a4d-4e0d-98c3-b8ad422b10cc",\n        "ansible_product_version": "rhel 7.3.0 pc (i440fx + piix, 1996)",\n        "ansible_python_version": "2.7.5",\n        "ansible_selinux": {\n            "config_mode": "enforcing",\n            "mode": "enforcing",\n            "policyvers": 28,\n            "status": "enabled",\n            "type": "targeted"\n        },\n        "ansible_ssh_host_key_ecdsa_public": "aaaae2vjzhnhlxnoytitbmlzdhayntyaaaaibmlzdhayntyaaabbbep5if/laqb9q9fnkfnsi3mljsvvvoovhrrcugtbhejs+tam36obair764ix1zdn2swfldygmcuaaeipu3fk+uu=",\n        "ansible_ssh_host_key_rsa_public": "aaaab3nzac1yc2eaaaadaqabaaabaqc6yhi2+v64emw3jdisbrzkmwurp7uf4iqemjgowpqc3mvlfsposqerdojn9he34fvixcbluj9wii0kc3qzxxnwtefwjcdpsl17ns9eiedkjqrhswts7oxyc1948bdyhygnaw57befvuj+vt8oi1jskkksi3acumazdz9tngcvyiqw4pmuqfat/yenpqkhsp8mdx/sl/unpvsctb0w37o38zvapkpankhw25uiwrostlgqy4vgozhtqhudvqk4ezqod0+jmbcykvj2abbl1smih8mmrc2w2gi0gjx31ky/t5swqtxtdmrb3d7n9yrd1ppcnh0zebs/opnx4g5uwx/ap",\n        "ansible_swapfree_mb": 0,\n        "ansible_swaptotal_mb": 0,\n        "ansible_system": "linux",\n        "ansible_system_vendor": "red hat",\n        "ansible_user_id": "root",\n        "ansible_userspace_architecture": "x86_64",\n        "ansible_userspace_bits": "64",\n        "ansible_virtualization_role": "guest",\n        "ansible_virtualization_type": "kvm",\n        "module_setup": true\n    },\n    "changed": false\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n\n\nå¨å®éåºç¨ä¸­ï¼è¿ç¨çæ¯è¾å¤çfactsåéæansible_os_familyï¼ansible_hostnameç­ï¼è¿äºåééå¸¸ä¼è¢«æ¿æ¥ä½ä¸ºwhenæ¡ä»¶è¯­å¥çå¤æ­æ¡ä»¶ï¼æ¥å³å®ä¸ä¸æ­¥çæä½ãä¸ä¸ªç®åçå®ä¾ï¼\n\n---\n - hosts: all\n   remote_user: root\n   tasks:\n     - name: test the list variables\n       shell: echo {{ ansible_os_family }}\n       register: results\n\n     - name: print the register result\n       debug: msg="{{ results.stdout }}"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ§è¡ç»æå¦ä¸ï¼\n\nansible-playbook test.yml\n\nplay [all] ********************************************************************\n\ngathering facts ***************************************************************\nok: [10.0.102.162]\nok: [10.0.102.212]\nok: [10.0.102.200]\n\ntask: [test the list variables] ***********************************************\nchanged: [10.0.102.162]\nchanged: [10.0.102.212]\nchanged: [10.0.102.200]\n\ntask: [print the register result] *********************************************\nok: [10.0.102.212] => {\n    "msg": "redhat"                   #å¯¹åºåéçç»æ\n}\nok: [10.0.102.200] => {\n    "msg": "redhat"\n}\nok: [10.0.102.162] => {\n    "msg": "redhat"\n}\n\nplay recap ********************************************************************\n10.0.102.162               : ok=3    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=3    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=3    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n# 3.2 æ¬å°factsåé\n\næä»¬å¯ä»¥èªå·±å®ä¹factsåéï¼æè¿ä¸ªåéåå¥ä¸ä¸ªä»¥.factç»å°¾çæä»¶ä¸­ï¼è¿ä¸ªæä»¶å¯ä»¥æ¯jsonæä»¶æiniæä»¶ï¼æèæ¯ä¸ä¸ªå¯ä»¥è¿åjsonä»£ç çå¯æ§è¡æä»¶ãç¶åå°å¶æ¾å¨è¿ç¨ä¸»æºç/etc/ansible/facts.dæä»¶å¤¹ä¸­ï¼ansibleå¨æ§è¡çä»»å¡æ¶ä¼èªå¨å°è¿ä¸ªæä»¶å¤¹ä¸­è¯»ååéçä¿¡æ¯ã\n\nå¨è¿ç¨ä¸»æºä¸åå¦ä¸æä½ï¼\n\n# èªå®ä¹factä¿¡æ¯\n$ mkdir -p /etc/ansible/facts.d && cd /etc/ansible/facts.d\n$ cat test.fact\n[test_fact]\nadmin=hongkong\n\n\n1\n2\n3\n4\n5\n\n\nç¶ååansibleä¸»æºä¸è·åèªå®ä¹çä¿¡æ¯ã\n\n$ ansible 10.0.102.162 -m setup -a "filter=ansible_local"\n10.0.102.162 | success >> {\n    "ansible_facts": {\n        "ansible_local": {\n            "test": {\n                "test_fact": {\n                    "admin": "hongkong"\n                }\n            }\n        }\n    },\n    "changed": false\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# åãif/when/whileæµç¨æ§å¶è¯­å¥\n\næ¡ä»¶å¤æ­å¨ansibleä»»å¡ä¸­çä½¿ç¨é¢çéå¸¸é«ãæä»¬å¯ä»¥æ ¹æ®ä¸äºæ¡ä»¶çä¸ä¸æ ·æ§è¡ä¸åçtaskã\n\n# 4.1 whenæ¡ä»¶å¤æ­\n\nå¾å¤ä»»å¡åªæå¨ç¹å®æ¡ä»¶ä¸æè½æ§è¡ï¼è¿å°±æ¯whenè¯­å¥åæ¥ä½ç¨çå°æ¹ã\n\nä¸ä¸ªç®åçå®ä¾ï¼å³é­æipå°åä¸º10.0.102.162æå¡å¨ä¸çmysqlæå¡ï¼å¦ä¸ï¼\n\n[root@test2 playbook]# cat test.yml\n---\n - hosts: all\n   remote_user: root\n   tasks:\n     - name: shut down the db server\n       service: name=mysqld state=stopped\n       when: ansible_eth0.ipv4.address  == "10.0.102.162"  # è¿éä½¿ç¨äºwhenæ¡ä»¶è¯­å¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ§è¡çç»æå¦ä¸ï¼\n\n$ ansible-playbook test.yml\n\nplay [all] ********************************************************************\n\ngathering facts ***************************************************************\nok: [10.0.102.212]\nok: [10.0.102.200]\nok: [10.0.102.162]\n\ntask: [shut down the db server] ***********************************************\nskipping: [10.0.102.200]\nskipping: [10.0.102.212]\nchanged: [10.0.102.162]                      #162çæå¡ç¶æå·²ç»æ¹å\n\nplay recap ********************************************************************\n10.0.102.162               : ok=2    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=1    changed=0    unreachable=0    failed=0\n10.0.102.212               : ok=1    changed=0    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè¿ä¸ªå°±æ¯whenæ¡ä»¶è¯­å¥çç¨æ³å¾ç®åãéè¦æ³¨æwhenè¯­å¥çä½ç¨äºpalyçä½ç¨æ¶é´ï¼å½whençæ¡ä»¶æ»¡è¶³æ¶ï¼ç¶åæä¼æ§è¡playä¸­çä»»å¡ãansibleè¿æä¾äºå¦å¤ä¸¤ä¸ªä¸whenç¸å³çè¯­å¥changed_whenåfailed_whenæ¡ä»¶å¤æ­ã\n\n\n# äºãä»»å¡é´çæµç¨æ§å¶\n\n# 5.1 ä»»å¡å§æ\n\né»è®¤æåµä¸ï¼ansibleææä»»å¡é½æ¯å¨æä»¬æå®çæºå¨ä¸é¢è¿è¡çï¼å½å¨ä¸ä¸ªç¬ç«çéç¾¤ç¯å¢éç½®æ¶ï¼è¿å¹¶æ²¡æä»ä¹é®é¢ãèå¨æäºæåµä¸ï¼æ¯å¦ç»æå°æå¡å¨åééç¥æèåçæ§æå¡å¨ä¸­æ·»å è¢«çæ§çä¸»æºï¼è¿ä¸ªæ¶åä»»å¡å°±éè¦å¨ç¹å®çä¸»æºä¸è¿è¡ï¼èéä¸å¼å§æå®çææä¸»æºï¼æ­¤æ¶å°±éè¦ansibleçå§æä»»å¡ã\n\nä½¿ç¨delegate_toå³é®å­å¯ä»¥éç½®ä»»å¡å¨æå®çæå¡å¨ä¸æ§è¡ï¼èå¶ä»ä»»å¡è¿æ¯å¨hostså³é®å­éç½®çæææºå¨ä¸æ§è¡ï¼å½å°äºè¿ä¸ªå³é®å­æå¨çä»»å¡æ¶ï¼å°±ä½¿ç¨å§æçæºå¨è¿è¡ã\n\næ¥çmysqlæ¯å¦å¨è¿è¡ç¶æï¼å æ­¤å¨æ£æ¥ä¹åé¦åå³æ162ä¸çmysqlæå¡ãï¼ä¸ºäºæ¹ä¾¿æ¥çç¶æï¼\n\n---\n - hosts: all\n   remote_user: root\n   tasks:\n     - name: stop the db server\n       service: name=mysqld state=stopped\n       delegate_to: 10.0.102.162       # è¿éä½¿ç¨äºå§æï¼ä»å³é­162è¿å°æå¡å¨ä¸ï¼è¿ä¸ªplayä»å¨162è¿å°æå¡å¨ä¸æ§è¡ã\n\n     - name: check mysql status\n       service: name=mysqld state=running\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nè¿éå§ææ¯å¨æå®çæºå¨ä¸æ§è¡ï¼è¥æ¯æ³å¨æ¬å°æå¡å¨ä¸æ§è¡ï¼å¯ä»¥æipå°åæ¢ä¸º127.0.0.1å³å¯ãä¹å¯ä»¥ä½¿ç¨local_actionæ¹æ³ã\n\n---\n - hosts: all\n   remote_user: root\n   tasks:\n     - name: create the test file\n       local_action: shell touch test1111 # å¨æ¬å°åå»ºä¸ä¸ªæµè¯æä»¶\n\n\n     - name: check mysql status\n       service: name=mysqld state=running\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nç»æå¦ä¸ï¼\n\n$ ansible-playbook test.yml\n\nplay [all] ********************************************************************\n\ngathering facts ***************************************************************\nok: [10.0.102.212]\nok: [10.0.102.200]\nok: [10.0.102.162]\n\ntask: [create the test file] **************************************************\nchanged: [10.0.102.212 -> 127.0.0.1]\nchanged: [10.0.102.200 -> 127.0.0.1]\nchanged: [10.0.102.162 -> 127.0.0.1]\n\ntask: [check mysql status] ****************************************************\nok: [10.0.102.200]\nok: [10.0.102.212]\nok: [10.0.102.162]\n\nplay recap ********************************************************************\n10.0.102.162               : ok=3    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=3    changed=1    unreachable=0    failed=0\n10.0.102.212               : ok=3    changed=1    unreachable=0    failed=0\n\n$ ls                     # é»è®¤ä¼å¨å½åç®å½åå»ºå¯¹åºçæä»¶\ntest1111  test.yml  vars.yml\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\n# 5.2 ä»»å¡æå\n\næäºæåµä¸ï¼ä¸äºä»»å¡çè¿è¡éè¦ç­å¾ä¸äºç¶æçæ¢å¤ï¼æ¯å¦æä¸å°ä¸»æºæèåºç¨ååéå¯ï¼æä»¬éè¦ç­å¾å®ä¸é¢çæä¸ªç«¯å£å¼å¯ï¼æ­¤æ¶æä»¬å°±ä¸å¾ä¸å°æ­£å¨è¿è¡çä»»å¡æåï¼ç´å°å¶ç¶ææ»¡è¶³æä»¬çéæ±ã\n\nä¸ä¸ä¸ªå®ä¾ï¼\n\n- name: wait for webserver to start\n   local_action:\n        module: wait_for\n        host: webserver1\n        port: 80\n        delay: 10\n        timeout: 300\n        state: startted\n# è¿ä¸ªå®ä¾ä¸­ï¼è¿ä¸ªä»»å¡å°ä¼æ¯10sæ£æ¥ä¸æ¬¡ä¸»æºwebserver1ä¸é¢ç80ç«¯å£æ¯å¦å¼å¯ï¼å¦æè¶è¿äº300såå¤±è´¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# 5.3 äº¤äºå¼æç¤º\n\nå¨å°æ°æåµä¸ï¼ansibleä»»å¡è¿è¡çè¿ç¨ä¸­éè¦ç¨æ·è¾å¥ä¸äºæ°æ®ï¼è¿äºæ°æ®è¦ä¹æ¯è¾ç§å¯ä¸æ¹ä¾¿ï¼æèæ°æ®æ¯å¨æçï¼ä¸åçç¨æ·æä¸åçéæ±ï¼æ¯å¦è¾å¥ç¨æ·èªå·±çè´¦æ·åå¯ç æèè¾å¥ä¸åççæ¬å·ä¼è§¦åä¸åçåç»­æä½ç­ãansibleçvars_promptå³é®å­å°±æ¯ç¨æ¥å¤çä¸è¿°è¿ç§ä¸ç¨æ·äº¤äºçæåµçãä¸é¢æ¯ä¸ä¸ªç®åçå®ä¾ã\n\n---\n - hosts: all\n   remote_user: root\n   vars_prompt:\n      - name: share_user\n        prompt: "what is your network username?"\n        private: no\n\n      - name: share_pass\n        prompt: "what is your network password"\n        private: no\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nç¶åæ§è¡ä¸é¢çplaybookï¼å ä¸ºæä»¬åªæ¯æµè¯ï¼åªéè¦å¨ä¸å°æºå¨ä¸æ§è¡ï¼å æ­¤å å¥äº--limitåæ°ã\n\n$ ansible-playbook test.yml --limit 10.0.102.162\nwhat is your network username?: test        # éè¦æå¨äº¤äºè¾å¥\nwhat is your network password: 123456       # æå¨è¾å¥\n\nplay [all] ********************************************************************\n\ngathering facts ***************************************************************\nok: [10.0.102.162]\n\nplay recap ********************************************************************\n10.0.102.162               : ok=1    changed=0    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næå¨è¾å¥çåéå¼ï¼å¨åé¢çplayä¸­ä»ç¶å¯ä»¥ç¨{{ var_name }}çå½¢å¼è°ç¨ã\n\nå³é®å­vars_promptå ä¸ªå¸¸ç¨çéé¡¹æ»ç»å¦ä¸ï¼\n\n * privateï¼é»è®¤å¼ä¸ºyesï¼è¡¨ç¤ºç¨æ·è¾å¥çå¼å¨å½ä»¤è¡ä¸å¯è§ï¼å°å¼è®¾ä¸ºnoæ¶ï¼ç¨æ·è¾å¥å¯è§ã\n * defaultï¼ä¸ºåéè®¾ç½®é»è®¤å¼ï¼ä»¥èçç¨æ·è¾å¥æ¶é´ã\n * confirmï¼ç¹å«éåè¾å¥å¯ç çæåµï¼å¦æå°å¶è®¾ç½®ä¸ºyesï¼åä¼è¦æ±ç¨æ·è¾å¥ä¸¤æ¬¡ï¼ä»¥å¢å è¾å¥çå®å¨æ§ã\n\n\n# å­ãtagsæ ç­¾\n\né»è®¤æåµä¸ï¼ansibleå¨æ§è¡ä¸ä¸ªplaybookæ¶ï¼ä¼æ§è¡playbookä¸­å®ä¹çææä»»å¡ãansibleçæ ç­¾åè½å¯ä»¥ç»è§è²ï¼æä»¶ï¼åç¬çä»»å¡çè³æ´ä¸ªplaybookæä¸æ ç­¾ï¼ç¶åå©ç¨è¿äºæ ç­¾æ¥æå®è¦è¿è¡playbookä¸­çä¸ªå«ä»»å¡ï¼æä¸æ§è¡æå®çä»»å¡ï¼å¹¶ä¸å®çè¯­æ³éå¸¸ç®åã\n\néè¿ä¸æ®µä»£ç æ¥è¯´ætagsçç¨æ³ï¼\n\n---\n# å¯ä»¥ç»æ´ä¸ªplaybookçææä»»å¡æä¸ä¸ªæ ç­¾ã\n  - hosts: all\n    tags: deploy\n    roles:\n     # ç»è§è²æçæ ç­¾å°ä¼åºç¨ä¸è§è²ä¸ææçä»»å¡ã\n       - {role: tomcat, tags : ["tomcat", "app"]}        # ä¸ä¸ªå¯¹è±¡æ·»å å¤ä¸ªtagçåæ³ä¹ä¸\n    tasks:\n       - name: notify on completion\n         local_action:\n            module: osx_say\n            msg: "{{inventory_hostname}} is finished"\n            voice: zarvox\n         tags:      # ä¸ä¸ªå¯¹è±¡æ·»å å¤ä¸ªtagåæ³ä¹äº\n            - notifications\n            - say\n       - include: foo.yml\n         tags:ãfoo\n\n# ç¼©è¿å¯è½ä¸å¤ªå¯¹\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nå°ä¸è¿°ä»£ç ä¿å­ï¼å¯ä»¥éè¿ä»¥ä¸å½ä»¤æ¥åªæ§è¡notify on completionä»»å¡ã\n\n$ ansible-playbook test.yml --tags "say"\n\n\n1\n\n\nå¦ææ³å¿½ç¥ææä¸ªä»»å¡ï¼å¯ä»¥ä½¿ç¨--skip-tagså³é®å­æå®ã\n\n\n# ä¸ãblockå\n\nansibleä»2.0.0çæ¬å¼å§å¼å¥äºååè½ãååè½å¯ä»¥å°ä»»å¡è¿è¡åç»ï¼å¹¶ä¸å¯ä»¥å¨åçº§å«ä¸åºç¨ä»»å¡åéãåæ¶ï¼ååè½è¿å¯ä»¥ä½¿ç¨ç±»ä¼¼äºå¶ä»ç¼ç¨è¯­è¨å¤çå¼å¸¸é£æ ·çæ¹æ³ï¼æ¥å¤çååé¨çä»»å¡å¼å¸¸ã\n\n---\n - hosts: all\n   remote_user: root\n\n   tasks:\n     - block:\n          - yum: name=httpd state=present\n          - service: name=httpd state=started enabled=no\n       when:  ansible_eth0.ipv4.address  == "10.0.102.162"\n\n     - block:\n          - yum: name=nginx state=present\n          - service: name=nginx state=started enabled=no\n       when:  ansible_eth0.ipv4.address  == "10.0.102.200"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nè¿è¡ç»æå¦ä¸ï¼\n\n$ ansible-playbook -i hosts test.yml\n\nplay [all] **************************************************************************************************************************************************************************************\n\ntask [gathering facts] **************************************************************************************************************************************************************************\nok: [10.0.102.162]\nok: [10.0.102.200]\n\ntask [yum] **************************************************************************************************************************************************************************************\nskipping: [10.0.102.200]          # å ä¸ºå¨inventoryæä»¶ä¸­æ³¨éäºè¿ä¸å°æå¡å¨ï¼å æ­¤è¿éå¿½ç¥äºã\nok: [10.0.102.162]\n\ntask [service] **********************************************************************************************************************************************************************************\nskipping: [10.0.102.200]\nchanged: [10.0.102.162]\n\ntask [yum] **************************************************************************************************************************************************************************************\nskipping: [10.0.102.162]\nok: [10.0.102.200]\n\ntask [service] **********************************************************************************************************************************************************************************\nskipping: [10.0.102.162]\nchanged: [10.0.102.200]\n\nplay recap **************************************************************************************************************************************************************************************\n10.0.102.162               : ok=3    changed=1    unreachable=0    failed=0\n10.0.102.200               : ok=3    changed=1    unreachable=0    failed=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\nä¸é¢çplaybookåä¹åçå¹¶æ²¡æä»ä¹ä¸åï¼åªæ¯åå¦äºblockä¹åï¼ä»£ç æ´å®¹ææ¥çã\n\nååè½å¯ä»¥ç¨æ¥å¤çä»»å¡çå¼å¸¸ãæ¯å¦ä¸ä¸ªansibleä»»å¡æ¶çæ§ä¸ä¸ªå¹¶ä¸å¤ªéè¦çåºç¨ï¼è¿ä¸ªåºç¨çæ­£å¸¸è¿è¡ä¸å¦å¯¹åç»­çä»»å¡å¹¶ä¸äº§çå½±åï¼è¿æ¶åæä»¬å°±å¯ä»¥éè¿ååè½æ¥å¤çè¿ä¸ªåºç¨çæ¥éãå¦ä¸ä»£ç ï¼\n\ntasks:\n   - block:\n        - name: shell script to connect the app ti a mointoring service.\n          script: mointoring-connect.sh\n          rescue:\n             - name:åªæèæ¬æ¥éæ¶ææ§è¡\nãããããããã debugï¼msg="there was an error in the block"\n          always:\n             - name: æ è®ºç»æå¦ä½é½æ§è¡\n               debug: msg="this always executes"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nå½åä¸­ä»»æä»»å¡åºéæ¶ï¼rescueå³é®å­å¯¹åºçä»£ç åå°±ä¼è¢«æ§è¡ï¼èalwayså³é®å­å¯¹åºçä»£ç åæ è®ºå¦ä½é½ä¼è¢«æ§è¡ã\n\n*************** å½ä½ åç°èªå·±çæåæä¸èµ·éå¿æ¶ï¼å°±è¯·å®éä¸æ¥å­¦ä¹ å§ï¼***************\n\nåæé¾æ¥ï¼https://www.cnblogs.com/lvzhenjiang/p/14198755.html',charsets:{cjk:!0}},{title:"ansible-playbookç¼æä½¿ç¨tips",frontmatter:{title:"ansible-playbookç¼æä½¿ç¨tips",date:"2023-01-11T15:06:48.000Z",permalink:"/pages/7eca6b/",categories:["ä¸é¢","ansibleç³»åæç« "],tags:[null],readingShow:"top",description:"å¨æ¥å¸¸éç½®ç¼æè¿ç¨ä¸­ï¼æä»¬ç»å¸¸éè¦ç¨å°ä¸äºåç½®çåéæ¥è¿è¡ä¸äºå¤æ­æèéç½®çå·¥ä½ï¼è¿éæ´çä¸äºå¸¸ç¨çåéï¼ä»¥ä¾¿äºä½¿ç¨æ¥éã",meta:[{name:"twitter:title",content:"ansible-playbookç¼æä½¿ç¨tips"},{name:"twitter:description",content:"å¨æ¥å¸¸éç½®ç¼æè¿ç¨ä¸­ï¼æä»¬ç»å¸¸éè¦ç¨å°ä¸äºåç½®çåéæ¥è¿è¡ä¸äºå¤æ­æèéç½®çå·¥ä½ï¼è¿éæ´çä¸äºå¸¸ç¨çåéï¼ä»¥ä¾¿äºä½¿ç¨æ¥éã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/08.ansible-playbook%E7%BC%96%E6%8E%92%E4%BD%BF%E7%94%A8tips.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ansible-playbookç¼æä½¿ç¨tips"},{property:"og:description",content:"å¨æ¥å¸¸éç½®ç¼æè¿ç¨ä¸­ï¼æä»¬ç»å¸¸éè¦ç¨å°ä¸äºåç½®çåéæ¥è¿è¡ä¸äºå¤æ­æèéç½®çå·¥ä½ï¼è¿éæ´çä¸äºå¸¸ç¨çåéï¼ä»¥ä¾¿äºä½¿ç¨æ¥éã"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/08.ansible-playbook%E7%BC%96%E6%8E%92%E4%BD%BF%E7%94%A8tips.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-11T15:06:48.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ansible-playbookç¼æä½¿ç¨tips"},{itemprop:"description",content:"å¨æ¥å¸¸éç½®ç¼æè¿ç¨ä¸­ï¼æä»¬ç»å¸¸éè¦ç¨å°ä¸äºåç½®çåéæ¥è¿è¡ä¸äºå¤æ­æèéç½®çå·¥ä½ï¼è¿éæ´çä¸äºå¸¸ç¨çåéï¼ä»¥ä¾¿äºä½¿ç¨æ¥éã"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/08.ansible-playbook%E7%BC%96%E6%8E%92%E4%BD%BF%E7%94%A8tips.html",relativePath:"01.ä¸é¢/01.ansibleç³»åæç« /08.ansible-playbookç¼æä½¿ç¨tips.md",key:"v-d692e0c2",path:"/pages/7eca6b/",headers:[{level:2,title:"å¸¸ç¨åé",slug:"å¸¸ç¨åé",normalizedTitle:"å¸¸ç¨åé",charIndex:2},{level:2,title:"1ï¼å¤æ­éè¯¯",slug:"_1-å¤æ­éè¯¯",normalizedTitle:"1ï¼å¤æ­éè¯¯",charIndex:198},{level:2,title:"2ï¼åªè·ä¸æ¬¡",slug:"_2-åªè·ä¸æ¬¡",normalizedTitle:"2ï¼åªè·ä¸æ¬¡",charIndex:3504},{level:2,title:"3ï¼æ»å¨æ´æ°",slug:"_3-æ»å¨æ´æ°",normalizedTitle:"3ï¼æ»å¨æ´æ°",charIndex:5393},{level:2,title:"4ï¼æå°å¤è¡",slug:"_4-æå°å¤è¡",normalizedTitle:"4ï¼æå°å¤è¡",charIndex:10210},{level:2,title:"åªåæ­¥è¿ç¨ç®å½æ²¡æçæä»¶",slug:"åªåæ­¥è¿ç¨ç®å½æ²¡æçæä»¶",normalizedTitle:"åªåæ­¥è¿ç¨ç®å½æ²¡æçæä»¶",charIndex:13211}],headersStr:"å¸¸ç¨åé 1ï¼å¤æ­éè¯¯ 2ï¼åªè·ä¸æ¬¡ 3ï¼æ»å¨æ´æ° 4ï¼æå°å¤è¡ åªåæ­¥è¿ç¨ç®å½æ²¡æçæä»¶",content:'# å¸¸ç¨åé\n\nå¨æ¥å¸¸éç½®ç¼æè¿ç¨ä¸­ï¼æä»¬ç»å¸¸éè¦ç¨å°ä¸äºåç½®çåéæ¥è¿è¡ä¸äºå¤æ­æèéç½®çå·¥ä½ï¼è¿éæ´çä¸äºå¸¸ç¨çåéï¼ä»¥ä¾¿äºä½¿ç¨æ¥éã\n\n * é¨ç½²å®¢æ·ç«¯ä¸»æºåï¼ansible_hostname\n * é¨ç½²å®¢æ·ç«¯ä¸»æº IPï¼ansible_default_ipv4.address\n * é¨ç½²å®¢æ·ç«¯ä¸»æºè¯¦ç»ä¿¡æ¯ï¼hostvarsï¼è¿åä¸»æºè¯¦ç»ä¿¡æ¯ï¼å¯ä»¥éè¿ç¹æä½å®ä½å·ä½éè¦çåå®¹ã\n\n\n# 1ï¼å¤æ­éè¯¯\n\nææ¶åæä»¬å¨é¨ç½²æå¡çæ¶åï¼ä¼éå¯¹ä¸äºæå¡ç¶æè¿è¡æ£æµï¼ä»èä¾æ®æ£æµç»ææ¥å¤æ­æ¯å¦å°ä¸»æºæ¾åå°è´è½½åè¡¨å½ä¸­ï¼è¿éä¸¾ä¸ä¸ª web æ£æµçä¾å­ï¼é¦åéè¿ NGINX å®ä¹äºä¸ä¸ªè¿åå¼ï¼\n\n$ curl localhost/get_info\n{"status":"success","result":"hello world!"}\n\n\n1\n2\n\n\nç¶åå®ä¹å§æ¬å¦ä¸ï¼\n\n$ cat site.yaml\n---\n  - hosts: localhost\n    tasks:\n      - uri:\n          url: "http://localhost/get_info"\n          method: GET\n        register: webpage\n        failed_when: webpage.status != 200\n      - debug:\n          var: webpage\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nè¿éä½¿ç¨æ¬æºè¿è¡éªè¯æ­¤ç±»åè½ï¼ç´æ¥éè¿å¦ä¸å½ä»¤å³å¯è¿è¡ï¼\n\n$ ansible-playbook site.yaml\n[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match \'all\'\nPLAY [localhost] ********************************************************************************************************************************************************************\nTASK [Gathering Facts] **************************************************************************************************************************************************************\nok: [localhost]\nTASK [uri] **************************************************************************************************************************************************************************\nok: [localhost]\nTASK [debug] ************************************************************************************************************************************************************************\nok: [localhost] => {\n    "webpage": {\n        "changed": false,\n        "connection": "close",\n        "content_length": "44",\n        "content_type": "application/json",\n        "cookies": {},\n        "cookies_string": "",\n        "date": "Tue, 02 Jun 2020 06:30:53 GMT",\n        "elapsed": 0,\n        "failed": false,\n        "failed_when_result": false,\n        "json": {\n            "result": "hello world!",\n            "status": "success"\n        },\n        "msg": "OK (44 bytes)",\n        "redirected": false,\n        "server": "openresty",\n        "status": 200,\n        "url": "http://localhost/get_info"\n    }\n}\nPLAY RECAP **************************************************************************************************************************************************************************\nlocalhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nä¸è¾¹éè¿è¾åºçç¶æç è¿è¡å¤æ­ï¼é¤æ­¤ä¹å¤ï¼è¿å¯ä»¥éè¿è¾åºå½ä¸­çå·ä½åå®¹å¹éæ¥è¿è¡å¤æ­ï¼æ¯å¦ä¸è¾¹åå®¹å½ä¸­ï¼æä»¬çå°å¯¹åºç json å­æ®µéè¾åºçè¿ååå®¹ï¼ä¹å¯ä»¥æ ¹æ®å·ä½åå®¹æ¥è¿è¡å¤æ­ï¼æ­¤æ¶è°æ´å§æ¬åå®¹å¦ä¸ï¼\n\n---\n  - hosts: localhost\n    tasks:\n      - uri:\n          url: "http://localhost/get_info"\n          method: GET\n        register: webpage\n        failed_when: webpage.status != 200\n      - fail:\n          msg: "check status field"\n        when: "\'hello\' not in webpage.json.result"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nwebpage.json.resultå¯ä»¥å°è¿åçåå®¹å®ä½å°ç¸åºä½ç½®ï¼ç¶ååè¿è¡å¤æ­ï¼å½ç¶ä¸å°æ¶åä¹å¯ä»¥ç¨å¦ä¸æ¹å¼å¤æ­ï¼\n\n---\n  - hosts: localhost\n    tasks:\n      - uri:\n          url: "http://localhost/get_info"\n          method: GET\n          return_content: yes\n        register: webpage\n        failed_when: webpage.status != 200\n      - fail:\n          msg: "check status field"\n        when: "\'hello\' not in webpage.content"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¤äºä¸ä¸ªåæ°Â return_content: yesï¼ ä½éè¦æ³¨æçä¸ä¸ªå°æ¹æ¯ï¼webpage.contentä¸­ç json å­æ®µæ¯æ æ³å±å¼çã\n\n\n# 2ï¼åªè·ä¸æ¬¡\n\nrun_once: true\n\næä¸äºå¨åè¡¨ä¸­çä»»å¡ï¼åªéè¦è·ä¸æ¬¡å°±å¥½ï¼æ¯å¦ä¸çº¿é¨ç½²å§æ¬ä¸­ï¼åå¸åè¡¨å¯è½æ 10 å°ï¼é£ä¹å¦ä¸æ­¥éª¤ä¸­ï¼ä¸äºå°æ¹å°±ä¸éè¦æ§è¡ 10 æ¬¡äºï¼æ¯å¦çæçæ¬å·ä»¥ååæ­¥å°æ¬å°çä¸¤ä¸ªæ­¥éª¤ã\n\n---\n- name: "åå»ºè¿ç¨ä¸»æºä¸ççæ¬ç®å½"\n  file: path=/release/{{project}}/{{_version}} state=directory\n  tags: deploy\n- name: "å°ä»£ç åæ­¥å°è¿ç¨ä¸»æºçæ¬ç®å½"\n  synchronize:\n    src: /{{WORKSPACE}}/\n    dest: /release/{{project}}/{{_version}}/\n    delete: yes\n  tags: deploy\n- name: "å°é¡¹ç®é¨ç½²å°çäº§ç®å½"\n  file: path=/data/www/{{project}} state=link src=/release/{{project}}/{{_version}}\n  tags: deploy\n- name: "ä½¿çæ¬ç®å½ä¿æäºä¸ªçæ¬åå²"\n  script: chdir=/release/{{project}} keepfive.sh\n  tags: deploy\n- name: "çæè¿ç¨çæ¬å·"\n  shell: "ls /release/{{project}} > /release/{{project}}.log"\n  tags: deploy\n- name: "åæ­¥çæ¬å·å°æ¬å°"\n  synchronize: "src=/release/{{project}}.log dest=/root/.jenkins/version/{{JOB_NAME}}.log mode=pull"\n  tags: deploy\n- name: "æ§è¡èªç±èæ¬"\n  script: chdir=/release/{{project}} free.sh\n  tags: deploy\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\néè¿æ·»å Â run_once: trueå¯ä»¥å®ä¹å¯¹åºçä»»å¡åªæ§è¡ä¸æ¬¡ï¼\n\n---\n- name: "åå»ºè¿ç¨ä¸»æºä¸ççæ¬ç®å½"\n  file: path=/release/{{project}}/{{_version}} state=directory\n  tags: deploy\n- name: "å°ä»£ç åæ­¥å°è¿ç¨ä¸»æºçæ¬ç®å½"\n  synchronize:\n    src: /{{WORKSPACE}}/\n    dest: /release/{{project}}/{{_version}}/\n    delete: yes\n  tags: deploy\n- name: "å°é¡¹ç®é¨ç½²å°çäº§ç®å½"\n  file: path=/data/www/{{project}} state=link src=/release/{{project}}/{{_version}}\n  tags: deploy\n- name: "ä½¿çæ¬ç®å½ä¿æäºä¸ªçæ¬åå²"\n  script: chdir=/release/{{project}} keepfive.sh\n  tags: deploy\n- name: "çæè¿ç¨çæ¬å·"\n  shell: "ls /release/{{project}} > /release/{{project}}.log"\n  run_once: true\n  tags: deploy\n- name: "åæ­¥çæ¬å·å°æ¬å°"\n  synchronize: "src=/release/{{project}}.log dest=/root/.jenkins/version/{{JOB_NAME}}.log mode=pull"\n  run_once: true\n  tags: deploy\n- name: "æ§è¡èªç±èæ¬"\n  script: chdir=/release/{{project}} free.sh\n  tags: deploy\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\nè¿æ ·å³ä¾¿æ¯åå¸äº 10 å°æºå¨ï¼é£ä¹çæ¬å·è¿ä¸¤æ­¥ä¹å°±åªæ§è¡ä¸æ¬¡ã\n\n\n# 3ï¼æ»å¨æ´æ°\n\nansible é»è®¤æåµä¸ï¼æ§è¡å§æ¬æ¶æ¯ä»å§æ¬è§åº¦åºåï¼æ¯ä¸ªä»»å¡å¨ä¸»æºåè¡¨ä¸­éä¸æ§è¡ï¼ææ¶åæä»¬åå¸ä¸äºæå¡ï¼éè¦ä¸å°ä¸å°ä»è´è½½ä¸­æåºé¨ç½²ï¼ç¶åæ¾åå»ï¼è¿ä¸ªæ¶åï¼èµ°é»è®¤çæ¹åå°±ä¸å¤ªåéäºãç¨å¦ä¸ä¸ä¸ªç®åä¾å­æ¥è¯´æï¼\n\n$ cat site.yml\n---\n  - hosts: remote\n    tasks:\n      - debug:\n          msg: "this is task a"\n      - debug:\n          msg: "this is task b"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ§è¡å¦ä¸å§æ¬çè¾åºï¼\n\nansible-playbook -i test_hosts s.yaml\nPLAY [remote] ***********************************************************************************************************************************************************************\nTASK [Gathering Facts] **************************************************************************************************************************************************************\nok: [10.3.22.90]\nok: [10.3.22.87]\nTASK [debug] ************************************************************************************************************************************************************************\nok: [10.3.22.90] => {\n    "msg": "this is task a"\n}\nok: [10.3.22.87] => {\n    "msg": "this is task a"\n}\nTASK [debug] ************************************************************************************************************************************************************************\nok: [10.3.22.90] => {\n    "msg": "this is task b"\n}\nok: [10.3.22.87] => {\n    "msg": "this is task b"\n}\nPLAY RECAP **************************************************************************************************************************************************************************\n10.3.22.87                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.3.22.90                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nå¯ä»¥çå°ä¸¤ä¸ªä»»å¡è¢«åå¼ï¼å¨ä¸¤å°ä¸»æºä¸åå«æ¥æ§è¡ã\n\nansible ä¸­çÂ serialå°±æ¯ç¨æ¥æ§å¶ä»»å¡æ§è¡æ°éçåæ°ï¼ä¸é¢çåºæ¯ï¼æä»¬å¯ä»¥æå¯¹åºå¼è®¾ä¸º 1ï¼å§æ¬å°±ä¼æ¯å°ä¸»æºéä¸æ§è¡äºã\n\n---\n  - hosts: remote\n    serial: 1\n    tasks:\n      - debug:\n          msg: "this is task a"\n      - debug:\n          msg: "this is task b"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ§è¡ç»æå¦ä¸ï¼\n\nansible-playbook -i test_hosts s.yaml\nPLAY [remote] ***********************************************************************************************************************************************************************\nTASK [Gathering Facts] **************************************************************************************************************************************************************\nok: [10.3.22.90]\nTASK [debug] ************************************************************************************************************************************************************************\nok: [10.3.22.90] => {\n    "msg": "this is task a"\n}\nTASK [debug] ************************************************************************************************************************************************************************\nok: [10.3.22.90] => {\n    "msg": "this is task b"\n}\nPLAY [remote] ***********************************************************************************************************************************************************************\nTASK [Gathering Facts] **************************************************************************************************************************************************************\nok: [10.3.22.87]\nTASK [debug] ************************************************************************************************************************************************************************\nok: [10.3.22.87] => {\n    "msg": "this is task a"\n}\nTASK [debug] ************************************************************************************************************************************************************************\nok: [10.3.22.87] => {\n    "msg": "this is task b"\n}\nPLAY RECAP **************************************************************************************************************************************************************************\n10.3.22.87                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.3.22.90                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\nç»æä¸ä¸è¾¹çä¸å¯¹æ¯å°±å¾å®¹æçè§£è¿ä¸ªåæ°çå«ä¹äºã\n\né¤äºå®ä¹Â serial: 1ï¼å½ç¶è¿å¯ä»¥å®ä¹æ´å¤ï¼æ¯å¦ä¸»æºåè¡¨æ 30 å°ï¼æä»¬å¯ä»¥å®ä¹Â serial: 5ï¼å°±åæ 5 å° 5 å°æ§è¡äºã\n\nå¨å®éåºç¨ä¸­ï¼æäºä¸»æºæ§è¡å¤±è´¥ï¼åªä¼ä¸­æ­å½æ¬¡æå»ºï¼ä½ä¸å½±åå¶ä»ä¸»æºå¾åæ§è¡ï¼è¿å¯¹æä»¬æ¥è¯´å¹¶ä¸å®å¨ï¼å ä¸ºè¿å¯è½ä¼è®©æ²¡æèµ°å®åå¸æµç¨çä¸»æºæ¾åå°è´è½½åè¡¨ä¸­ï¼å æ­¤ï¼å¸¸å¸¸è¿æä¸ä¸ªæ­éä½¿ç¨çåæ°æ¯ï¼max_fail_percentageï¼è¡¨ç¤ºå½æå¤§å¤±è´¥ä¸»æºçæ¯ä¾è¾¾å°å¤å°æ¶ï¼ansible å°±è®©æ´ä¸ª play å¤±è´¥ã\n\n---\n  - hosts: remote\n    serial: 1\n    max_fail_percentage: 25\n    tasks:\n      - debug:\n          msg: "this is task a"\n      - debug:\n          msg: "this is task b"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n25 æ¯ä¸ä¸ªæ¯ä¾æ°æ®ï¼è¡¨ç¤ºæå»ºåè¡¨ä¸­ï¼å¦ææååä¹ä¸çå¤±è´¥ï¼åä¼éåºæå»ºï¼å¦ææä»¬å¸æä¸æå¤±è´¥å°±éåºï¼åå¯ä»¥å°ä¹è®¾ä¸º 0ã\n\næ³¨æï¼å½serial: 1æ¶ï¼å°±ä¸å¿åç¨Â run_once: trueï¼å ä¸ºè¿ç§å®ä¹æ¯æ æä¹çã\n\n\n# 4ï¼æå°å¤è¡\n\nææ¶åæä»¬å¨è¿è¡å®ä¸äºä»»å¡ä¹åï¼å¸æè½å¤æ¹éæå°ä¸äºåå®¹è¿ååºæ¥ï¼æ­¤æ¶å¯ä»¥ä½¿ç¨å¦ä¸æ¹å¼è¿è¡æå°ï¼\n\n$ cat test.yaml\n---\n- hosts: localhost\n  connection: local\n  vars:\n    msg: |\n       lookupd-tcp\n        {{ node1 }}:4160\n        {{ node2 }}:4160\n        {{ node3 }}:4160\n        lookupd-http\n        {{ node1 }}:4161\n        {{ node2 }}:4161\n        {{ node3 }}:4161\n        data-tcp\n        {{ node1 }}:41501\n        {{ node1 }}:41502\n        {{ node2 }}:41501\n        {{ node2 }}:41502\n        {{ node3 }}:41501\n        {{ node3 }}:41502\n        data-http\n        {{ node1 }}:41511\n        {{ node1 }}:41512\n        {{ node2 }}:41511\n        {{ node2 }}:41512\n        {{ node3 }}:41511\n        {{ node3 }}:41512\n  tasks:\n    - name: test\n      debug:\n        msg: "{{ msg.split(\'\\n\') }}"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\nç¶åè¿è¡çä¸ï¼\n\n$ansible-playbook test.yaml -e "node1=10.3.0.0 node2=10.0.0.1 node3=10.0.0.2"\n[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match \'all\'\nPLAY [localhost] ***************************************************************************************************************************************************************************************************************************************************************\nTASK [Gathering Facts] *********************************************************************************************************************************************************************************************************************************************************\nok: [localhost]\nTASK [test] ********************************************************************************************************************************************************************************************************************************************************************\nok: [localhost] => {\n    "msg": [\n        "lookupd-tcp",\n        " 10.3.0.0:4160",\n        " 10.0.0.1:4160",\n        " 10.0.0.2:4160",\n        " lookupd-http",\n        " 10.3.0.0:4161",\n        " 10.0.0.1:4161",\n        " 10.0.0.2:4161",\n        " data-tcp",\n        " 10.3.0.0:41501",\n        " 10.3.0.0:41502",\n        " 10.0.0.1:41501",\n        " 10.0.0.1:41502",\n        " 10.0.0.2:41501",\n        " 10.0.0.2:41502",\n        " data-http",\n        " 10.3.0.0:41511",\n        " 10.3.0.0:41512",\n        " 10.0.0.1:41511",\n        " 10.0.0.1:41512",\n        " 10.0.0.2:41511",\n        " 10.0.0.2:41512",\n        ""\n    ]\n}\nPLAY RECAP *********************************************************************************************************************************************************************************************************************************************************************\nlocalhost                  : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n\n# åªåæ­¥è¿ç¨ç®å½æ²¡æçæä»¶\n\nå¨Nginxå¯¹æ¥consulçåºæ¯ä¸­ï¼upsyncçdumpæä»¶ä¸è¬åªéè¦ç¬¬ä¸æ¬¡åæ­¥ä¸å»ï¼èåå°±ä¸éè¦ååæ­¥ï¼è¿ä¸ªæ¶åå¯ä»¥ç¨rsyncçåæ°æ¥å®ç°ï¼\n\n- name: sync the upsync config\n  synchronize:\n    src: /data/.jenkins/jobs/ops-prod/jobs/ops-nginx-config/workspace/prod-nginx/upsync/\n    dest: /etc/nginx/upsync/\n    mode: push\n    rsync_opts: "--ignore-existing"\n    delete: yes\n    rsync_timeout: 30\n  tags:\n    - prod-nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n--ignore-existingå¼å¾æ¯è·³è¿æ´æ°å·²å­å¨äºDSTçæä»¶ã\n\nåæé¾æ¥ï¼https://wiki.eryajf.net/pages/5173.html',normalizedContent:'# å¸¸ç¨åé\n\nå¨æ¥å¸¸éç½®ç¼æè¿ç¨ä¸­ï¼æä»¬ç»å¸¸éè¦ç¨å°ä¸äºåç½®çåéæ¥è¿è¡ä¸äºå¤æ­æèéç½®çå·¥ä½ï¼è¿éæ´çä¸äºå¸¸ç¨çåéï¼ä»¥ä¾¿äºä½¿ç¨æ¥éã\n\n * é¨ç½²å®¢æ·ç«¯ä¸»æºåï¼ansible_hostname\n * é¨ç½²å®¢æ·ç«¯ä¸»æº ipï¼ansible_default_ipv4.address\n * é¨ç½²å®¢æ·ç«¯ä¸»æºè¯¦ç»ä¿¡æ¯ï¼hostvarsï¼è¿åä¸»æºè¯¦ç»ä¿¡æ¯ï¼å¯ä»¥éè¿ç¹æä½å®ä½å·ä½éè¦çåå®¹ã\n\n\n# 1ï¼å¤æ­éè¯¯\n\nææ¶åæä»¬å¨é¨ç½²æå¡çæ¶åï¼ä¼éå¯¹ä¸äºæå¡ç¶æè¿è¡æ£æµï¼ä»èä¾æ®æ£æµç»ææ¥å¤æ­æ¯å¦å°ä¸»æºæ¾åå°è´è½½åè¡¨å½ä¸­ï¼è¿éä¸¾ä¸ä¸ª web æ£æµçä¾å­ï¼é¦åéè¿ nginx å®ä¹äºä¸ä¸ªè¿åå¼ï¼\n\n$ curl localhost/get_info\n{"status":"success","result":"hello world!"}\n\n\n1\n2\n\n\nç¶åå®ä¹å§æ¬å¦ä¸ï¼\n\n$ cat site.yaml\n---\n  - hosts: localhost\n    tasks:\n      - uri:\n          url: "http://localhost/get_info"\n          method: get\n        register: webpage\n        failed_when: webpage.status != 200\n      - debug:\n          var: webpage\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nè¿éä½¿ç¨æ¬æºè¿è¡éªè¯æ­¤ç±»åè½ï¼ç´æ¥éè¿å¦ä¸å½ä»¤å³å¯è¿è¡ï¼\n\n$ ansible-playbook site.yaml\n[warning]: provided hosts list is empty, only localhost is available. note that the implicit localhost does not match \'all\'\nplay [localhost] ********************************************************************************************************************************************************************\ntask [gathering facts] **************************************************************************************************************************************************************\nok: [localhost]\ntask [uri] **************************************************************************************************************************************************************************\nok: [localhost]\ntask [debug] ************************************************************************************************************************************************************************\nok: [localhost] => {\n    "webpage": {\n        "changed": false,\n        "connection": "close",\n        "content_length": "44",\n        "content_type": "application/json",\n        "cookies": {},\n        "cookies_string": "",\n        "date": "tue, 02 jun 2020 06:30:53 gmt",\n        "elapsed": 0,\n        "failed": false,\n        "failed_when_result": false,\n        "json": {\n            "result": "hello world!",\n            "status": "success"\n        },\n        "msg": "ok (44 bytes)",\n        "redirected": false,\n        "server": "openresty",\n        "status": 200,\n        "url": "http://localhost/get_info"\n    }\n}\nplay recap **************************************************************************************************************************************************************************\nlocalhost                  : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nä¸è¾¹éè¿è¾åºçç¶æç è¿è¡å¤æ­ï¼é¤æ­¤ä¹å¤ï¼è¿å¯ä»¥éè¿è¾åºå½ä¸­çå·ä½åå®¹å¹éæ¥è¿è¡å¤æ­ï¼æ¯å¦ä¸è¾¹åå®¹å½ä¸­ï¼æä»¬çå°å¯¹åºç json å­æ®µéè¾åºçè¿ååå®¹ï¼ä¹å¯ä»¥æ ¹æ®å·ä½åå®¹æ¥è¿è¡å¤æ­ï¼æ­¤æ¶è°æ´å§æ¬åå®¹å¦ä¸ï¼\n\n---\n  - hosts: localhost\n    tasks:\n      - uri:\n          url: "http://localhost/get_info"\n          method: get\n        register: webpage\n        failed_when: webpage.status != 200\n      - fail:\n          msg: "check status field"\n        when: "\'hello\' not in webpage.json.result"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nwebpage.json.resultå¯ä»¥å°è¿åçåå®¹å®ä½å°ç¸åºä½ç½®ï¼ç¶ååè¿è¡å¤æ­ï¼å½ç¶ä¸å°æ¶åä¹å¯ä»¥ç¨å¦ä¸æ¹å¼å¤æ­ï¼\n\n---\n  - hosts: localhost\n    tasks:\n      - uri:\n          url: "http://localhost/get_info"\n          method: get\n          return_content: yes\n        register: webpage\n        failed_when: webpage.status != 200\n      - fail:\n          msg: "check status field"\n        when: "\'hello\' not in webpage.content"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¤äºä¸ä¸ªåæ°Â return_content: yesï¼ ä½éè¦æ³¨æçä¸ä¸ªå°æ¹æ¯ï¼webpage.contentä¸­ç json å­æ®µæ¯æ æ³å±å¼çã\n\n\n# 2ï¼åªè·ä¸æ¬¡\n\nrun_once: true\n\næä¸äºå¨åè¡¨ä¸­çä»»å¡ï¼åªéè¦è·ä¸æ¬¡å°±å¥½ï¼æ¯å¦ä¸çº¿é¨ç½²å§æ¬ä¸­ï¼åå¸åè¡¨å¯è½æ 10 å°ï¼é£ä¹å¦ä¸æ­¥éª¤ä¸­ï¼ä¸äºå°æ¹å°±ä¸éè¦æ§è¡ 10 æ¬¡äºï¼æ¯å¦çæçæ¬å·ä»¥ååæ­¥å°æ¬å°çä¸¤ä¸ªæ­¥éª¤ã\n\n---\n- name: "åå»ºè¿ç¨ä¸»æºä¸ççæ¬ç®å½"\n  file: path=/release/{{project}}/{{_version}} state=directory\n  tags: deploy\n- name: "å°ä»£ç åæ­¥å°è¿ç¨ä¸»æºçæ¬ç®å½"\n  synchronize:\n    src: /{{workspace}}/\n    dest: /release/{{project}}/{{_version}}/\n    delete: yes\n  tags: deploy\n- name: "å°é¡¹ç®é¨ç½²å°çäº§ç®å½"\n  file: path=/data/www/{{project}} state=link src=/release/{{project}}/{{_version}}\n  tags: deploy\n- name: "ä½¿çæ¬ç®å½ä¿æäºä¸ªçæ¬åå²"\n  script: chdir=/release/{{project}} keepfive.sh\n  tags: deploy\n- name: "çæè¿ç¨çæ¬å·"\n  shell: "ls /release/{{project}} > /release/{{project}}.log"\n  tags: deploy\n- name: "åæ­¥çæ¬å·å°æ¬å°"\n  synchronize: "src=/release/{{project}}.log dest=/root/.jenkins/version/{{job_name}}.log mode=pull"\n  tags: deploy\n- name: "æ§è¡èªç±èæ¬"\n  script: chdir=/release/{{project}} free.sh\n  tags: deploy\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\néè¿æ·»å Â run_once: trueå¯ä»¥å®ä¹å¯¹åºçä»»å¡åªæ§è¡ä¸æ¬¡ï¼\n\n---\n- name: "åå»ºè¿ç¨ä¸»æºä¸ççæ¬ç®å½"\n  file: path=/release/{{project}}/{{_version}} state=directory\n  tags: deploy\n- name: "å°ä»£ç åæ­¥å°è¿ç¨ä¸»æºçæ¬ç®å½"\n  synchronize:\n    src: /{{workspace}}/\n    dest: /release/{{project}}/{{_version}}/\n    delete: yes\n  tags: deploy\n- name: "å°é¡¹ç®é¨ç½²å°çäº§ç®å½"\n  file: path=/data/www/{{project}} state=link src=/release/{{project}}/{{_version}}\n  tags: deploy\n- name: "ä½¿çæ¬ç®å½ä¿æäºä¸ªçæ¬åå²"\n  script: chdir=/release/{{project}} keepfive.sh\n  tags: deploy\n- name: "çæè¿ç¨çæ¬å·"\n  shell: "ls /release/{{project}} > /release/{{project}}.log"\n  run_once: true\n  tags: deploy\n- name: "åæ­¥çæ¬å·å°æ¬å°"\n  synchronize: "src=/release/{{project}}.log dest=/root/.jenkins/version/{{job_name}}.log mode=pull"\n  run_once: true\n  tags: deploy\n- name: "æ§è¡èªç±èæ¬"\n  script: chdir=/release/{{project}} free.sh\n  tags: deploy\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\nè¿æ ·å³ä¾¿æ¯åå¸äº 10 å°æºå¨ï¼é£ä¹çæ¬å·è¿ä¸¤æ­¥ä¹å°±åªæ§è¡ä¸æ¬¡ã\n\n\n# 3ï¼æ»å¨æ´æ°\n\nansible é»è®¤æåµä¸ï¼æ§è¡å§æ¬æ¶æ¯ä»å§æ¬è§åº¦åºåï¼æ¯ä¸ªä»»å¡å¨ä¸»æºåè¡¨ä¸­éä¸æ§è¡ï¼ææ¶åæä»¬åå¸ä¸äºæå¡ï¼éè¦ä¸å°ä¸å°ä»è´è½½ä¸­æåºé¨ç½²ï¼ç¶åæ¾åå»ï¼è¿ä¸ªæ¶åï¼èµ°é»è®¤çæ¹åå°±ä¸å¤ªåéäºãç¨å¦ä¸ä¸ä¸ªç®åä¾å­æ¥è¯´æï¼\n\n$ cat site.yml\n---\n  - hosts: remote\n    tasks:\n      - debug:\n          msg: "this is task a"\n      - debug:\n          msg: "this is task b"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ§è¡å¦ä¸å§æ¬çè¾åºï¼\n\nansible-playbook -i test_hosts s.yaml\nplay [remote] ***********************************************************************************************************************************************************************\ntask [gathering facts] **************************************************************************************************************************************************************\nok: [10.3.22.90]\nok: [10.3.22.87]\ntask [debug] ************************************************************************************************************************************************************************\nok: [10.3.22.90] => {\n    "msg": "this is task a"\n}\nok: [10.3.22.87] => {\n    "msg": "this is task a"\n}\ntask [debug] ************************************************************************************************************************************************************************\nok: [10.3.22.90] => {\n    "msg": "this is task b"\n}\nok: [10.3.22.87] => {\n    "msg": "this is task b"\n}\nplay recap **************************************************************************************************************************************************************************\n10.3.22.87                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.3.22.90                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nå¯ä»¥çå°ä¸¤ä¸ªä»»å¡è¢«åå¼ï¼å¨ä¸¤å°ä¸»æºä¸åå«æ¥æ§è¡ã\n\nansible ä¸­çÂ serialå°±æ¯ç¨æ¥æ§å¶ä»»å¡æ§è¡æ°éçåæ°ï¼ä¸é¢çåºæ¯ï¼æä»¬å¯ä»¥æå¯¹åºå¼è®¾ä¸º 1ï¼å§æ¬å°±ä¼æ¯å°ä¸»æºéä¸æ§è¡äºã\n\n---\n  - hosts: remote\n    serial: 1\n    tasks:\n      - debug:\n          msg: "this is task a"\n      - debug:\n          msg: "this is task b"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næ§è¡ç»æå¦ä¸ï¼\n\nansible-playbook -i test_hosts s.yaml\nplay [remote] ***********************************************************************************************************************************************************************\ntask [gathering facts] **************************************************************************************************************************************************************\nok: [10.3.22.90]\ntask [debug] ************************************************************************************************************************************************************************\nok: [10.3.22.90] => {\n    "msg": "this is task a"\n}\ntask [debug] ************************************************************************************************************************************************************************\nok: [10.3.22.90] => {\n    "msg": "this is task b"\n}\nplay [remote] ***********************************************************************************************************************************************************************\ntask [gathering facts] **************************************************************************************************************************************************************\nok: [10.3.22.87]\ntask [debug] ************************************************************************************************************************************************************************\nok: [10.3.22.87] => {\n    "msg": "this is task a"\n}\ntask [debug] ************************************************************************************************************************************************************************\nok: [10.3.22.87] => {\n    "msg": "this is task b"\n}\nplay recap **************************************************************************************************************************************************************************\n10.3.22.87                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n10.3.22.90                 : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\nç»æä¸ä¸è¾¹çä¸å¯¹æ¯å°±å¾å®¹æçè§£è¿ä¸ªåæ°çå«ä¹äºã\n\né¤äºå®ä¹Â serial: 1ï¼å½ç¶è¿å¯ä»¥å®ä¹æ´å¤ï¼æ¯å¦ä¸»æºåè¡¨æ 30 å°ï¼æä»¬å¯ä»¥å®ä¹Â serial: 5ï¼å°±åæ 5 å° 5 å°æ§è¡äºã\n\nå¨å®éåºç¨ä¸­ï¼æäºä¸»æºæ§è¡å¤±è´¥ï¼åªä¼ä¸­æ­å½æ¬¡æå»ºï¼ä½ä¸å½±åå¶ä»ä¸»æºå¾åæ§è¡ï¼è¿å¯¹æä»¬æ¥è¯´å¹¶ä¸å®å¨ï¼å ä¸ºè¿å¯è½ä¼è®©æ²¡æèµ°å®åå¸æµç¨çä¸»æºæ¾åå°è´è½½åè¡¨ä¸­ï¼å æ­¤ï¼å¸¸å¸¸è¿æä¸ä¸ªæ­éä½¿ç¨çåæ°æ¯ï¼max_fail_percentageï¼è¡¨ç¤ºå½æå¤§å¤±è´¥ä¸»æºçæ¯ä¾è¾¾å°å¤å°æ¶ï¼ansible å°±è®©æ´ä¸ª play å¤±è´¥ã\n\n---\n  - hosts: remote\n    serial: 1\n    max_fail_percentage: 25\n    tasks:\n      - debug:\n          msg: "this is task a"\n      - debug:\n          msg: "this is task b"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n25 æ¯ä¸ä¸ªæ¯ä¾æ°æ®ï¼è¡¨ç¤ºæå»ºåè¡¨ä¸­ï¼å¦ææååä¹ä¸çå¤±è´¥ï¼åä¼éåºæå»ºï¼å¦ææä»¬å¸æä¸æå¤±è´¥å°±éåºï¼åå¯ä»¥å°ä¹è®¾ä¸º 0ã\n\næ³¨æï¼å½serial: 1æ¶ï¼å°±ä¸å¿åç¨Â run_once: trueï¼å ä¸ºè¿ç§å®ä¹æ¯æ æä¹çã\n\n\n# 4ï¼æå°å¤è¡\n\nææ¶åæä»¬å¨è¿è¡å®ä¸äºä»»å¡ä¹åï¼å¸æè½å¤æ¹éæå°ä¸äºåå®¹è¿ååºæ¥ï¼æ­¤æ¶å¯ä»¥ä½¿ç¨å¦ä¸æ¹å¼è¿è¡æå°ï¼\n\n$ cat test.yaml\n---\n- hosts: localhost\n  connection: local\n  vars:\n    msg: |\n       lookupd-tcp\n        {{ node1 }}:4160\n        {{ node2 }}:4160\n        {{ node3 }}:4160\n        lookupd-http\n        {{ node1 }}:4161\n        {{ node2 }}:4161\n        {{ node3 }}:4161\n        data-tcp\n        {{ node1 }}:41501\n        {{ node1 }}:41502\n        {{ node2 }}:41501\n        {{ node2 }}:41502\n        {{ node3 }}:41501\n        {{ node3 }}:41502\n        data-http\n        {{ node1 }}:41511\n        {{ node1 }}:41512\n        {{ node2 }}:41511\n        {{ node2 }}:41512\n        {{ node3 }}:41511\n        {{ node3 }}:41512\n  tasks:\n    - name: test\n      debug:\n        msg: "{{ msg.split(\'\\n\') }}"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\nç¶åè¿è¡çä¸ï¼\n\n$ansible-playbook test.yaml -e "node1=10.3.0.0 node2=10.0.0.1 node3=10.0.0.2"\n[warning]: provided hosts list is empty, only localhost is available. note that the implicit localhost does not match \'all\'\nplay [localhost] ***************************************************************************************************************************************************************************************************************************************************************\ntask [gathering facts] *********************************************************************************************************************************************************************************************************************************************************\nok: [localhost]\ntask [test] ********************************************************************************************************************************************************************************************************************************************************************\nok: [localhost] => {\n    "msg": [\n        "lookupd-tcp",\n        " 10.3.0.0:4160",\n        " 10.0.0.1:4160",\n        " 10.0.0.2:4160",\n        " lookupd-http",\n        " 10.3.0.0:4161",\n        " 10.0.0.1:4161",\n        " 10.0.0.2:4161",\n        " data-tcp",\n        " 10.3.0.0:41501",\n        " 10.3.0.0:41502",\n        " 10.0.0.1:41501",\n        " 10.0.0.1:41502",\n        " 10.0.0.2:41501",\n        " 10.0.0.2:41502",\n        " data-http",\n        " 10.3.0.0:41511",\n        " 10.3.0.0:41512",\n        " 10.0.0.1:41511",\n        " 10.0.0.1:41512",\n        " 10.0.0.2:41511",\n        " 10.0.0.2:41512",\n        ""\n    ]\n}\nplay recap *********************************************************************************************************************************************************************************************************************************************************************\nlocalhost                  : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\n\n# åªåæ­¥è¿ç¨ç®å½æ²¡æçæä»¶\n\nå¨nginxå¯¹æ¥consulçåºæ¯ä¸­ï¼upsyncçdumpæä»¶ä¸è¬åªéè¦ç¬¬ä¸æ¬¡åæ­¥ä¸å»ï¼èåå°±ä¸éè¦ååæ­¥ï¼è¿ä¸ªæ¶åå¯ä»¥ç¨rsyncçåæ°æ¥å®ç°ï¼\n\n- name: sync the upsync config\n  synchronize:\n    src: /data/.jenkins/jobs/ops-prod/jobs/ops-nginx-config/workspace/prod-nginx/upsync/\n    dest: /etc/nginx/upsync/\n    mode: push\n    rsync_opts: "--ignore-existing"\n    delete: yes\n    rsync_timeout: 30\n  tags:\n    - prod-nginx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n--ignore-existingå¼å¾æ¯è·³è¿æ´æ°å·²å­å¨äºdstçæä»¶ã\n\nåæé¾æ¥ï¼https://wiki.eryajf.net/pages/5173.html',charsets:{cjk:!0}},{title:"ansibleä¼ç§æ¡ä¾",frontmatter:{title:"ansibleä¼ç§æ¡ä¾",date:"2023-01-29T15:16:58.000Z",permalink:"/pages/4fbba1/",categories:["ä¸é¢","ansibleç³»åæç« "],tags:[null],readingShow:"top",description:"command: /sbin/swapoff -a\n  when:\n    swapon.stdout\n  ignore_errors: yes\n`",meta:[{name:"twitter:title",content:"ansibleä¼ç§æ¡ä¾"},{name:"twitter:description",content:"command: /sbin/swapoff -a\n  when:\n    swapon.stdout\n  ignore_errors: yes\n`"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/09.ansible%E4%BC%98%E7%A7%80%E6%A1%88%E4%BE%8B.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ansibleä¼ç§æ¡ä¾"},{property:"og:description",content:"command: /sbin/swapoff -a\n  when:\n    swapon.stdout\n  ignore_errors: yes\n`"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/09.ansible%E4%BC%98%E7%A7%80%E6%A1%88%E4%BE%8B.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-29T15:16:58.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ansibleä¼ç§æ¡ä¾"},{itemprop:"description",content:"command: /sbin/swapoff -a\n  when:\n    swapon.stdout\n  ignore_errors: yes\n`"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/01.ansible%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0/09.ansible%E4%BC%98%E7%A7%80%E6%A1%88%E4%BE%8B.html",relativePath:"01.ä¸é¢/01.ansibleç³»åæç« /09.ansibleä¼ç§æ¡ä¾.md",key:"v-4e6cb445",path:"/pages/4fbba1/",headers:[{level:4,title:"ä¼åçåæ¶äº¤æ¢ååº",slug:"ä¼åçåæ¶äº¤æ¢ååº",normalizedTitle:"ä¼åçåæ¶äº¤æ¢ååº",charIndex:2}],headersStr:"ä¼åçåæ¶äº¤æ¢ååº",content:'# ä¼åçåæ¶äº¤æ¢ååº\n\n- name: Remove swapfile from /etc/fstab\n  mount:\n    name: "{{ item }"\n    fstype: swap\n    state: absent\n  with_items:\n    - swap\n    - none\n- name: check swap\n  command: /sbin/swapon -s\n  register: swapon\n  changed_when: no\n- name: Disable swap\n  command: /sbin/swapoff -a\n  when:\n    - swapon.stdout\n  ignore_errors: yes\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n- name: shutdown  get the status of swap\n  shell: grep swap /etc/fstab l grep -c "#\n  register: swap\n  ignore errors: yes\n  tags: swap\n- name: shutdown  swapoff -a\n  shell: swapoff -a\n  when: swap.stdout == "0"\n  ignore errors: yes\n  tags: swap\n- name: shutdown | æ³¨é/etc/fstab/swap é£ä¸è¡\n  replace: dest=/etc/fstab regexp=\'(.*) swap(\\s+) swap\' replace=\'f  swap\\2swap\'\n  when: swap.stdout == "0"\n  ignore errors: yes\n  tags: swap\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n',normalizedContent:'# ä¼åçåæ¶äº¤æ¢ååº\n\n- name: remove swapfile from /etc/fstab\n  mount:\n    name: "{{ item }"\n    fstype: swap\n    state: absent\n  with_items:\n    - swap\n    - none\n- name: check swap\n  command: /sbin/swapon -s\n  register: swapon\n  changed_when: no\n- name: disable swap\n  command: /sbin/swapoff -a\n  when:\n    - swapon.stdout\n  ignore_errors: yes\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n- name: shutdown  get the status of swap\n  shell: grep swap /etc/fstab l grep -c "#\n  register: swap\n  ignore errors: yes\n  tags: swap\n- name: shutdown  swapoff -a\n  shell: swapoff -a\n  when: swap.stdout == "0"\n  ignore errors: yes\n  tags: swap\n- name: shutdown | æ³¨é/etc/fstab/swap é£ä¸è¡\n  replace: dest=/etc/fstab regexp=\'(.*) swap(\\s+) swap\' replace=\'f  swap\\2swap\'\n  when: swap.stdout == "0"\n  ignore errors: yes\n  tags: swap\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n',charsets:{cjk:!0}},{title:"å¿«éé¨ç½²k8séç¾¤",frontmatter:{title:"å¿«éé¨ç½²k8séç¾¤",categories:["k8s"],tags:["k8s"],date:"2022-12-09T20:51:06.000Z",permalink:"/pages/fc6bfb/",readingShow:"top",description:"kubeadmæ¯å®æ¹ç¤¾åºæ¨åºçä¸ä¸ªç¨äºå¿«éé¨ç½²kuberneteséç¾¤çå·¥å·ã",meta:[{name:"twitter:title",content:"å¿«éé¨ç½²k8séç¾¤"},{name:"twitter:description",content:"kubeadmæ¯å®æ¹ç¤¾åºæ¨åºçä¸ä¸ªç¨äºå¿«éé¨ç½²kuberneteséç¾¤çå·¥å·ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/02.k8s/01.%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2k8s%E9%9B%86%E7%BE%A4.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å¿«éé¨ç½²k8séç¾¤"},{property:"og:description",content:"kubeadmæ¯å®æ¹ç¤¾åºæ¨åºçä¸ä¸ªç¨äºå¿«éé¨ç½²kuberneteséç¾¤çå·¥å·ã"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/02.k8s/01.%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2k8s%E9%9B%86%E7%BE%A4.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:51:06.000Z"},{property:"article:tag",content:"k8s"},{itemprop:"name",content:"å¿«éé¨ç½²k8séç¾¤"},{itemprop:"description",content:"kubeadmæ¯å®æ¹ç¤¾åºæ¨åºçä¸ä¸ªç¨äºå¿«éé¨ç½²kuberneteséç¾¤çå·¥å·ã"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/02.k8s/01.%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2k8s%E9%9B%86%E7%BE%A4.html",relativePath:"01.ä¸é¢/02.k8s/01.å¿«éé¨ç½²k8séç¾¤.md",key:"v-12346ac4",path:"/pages/fc6bfb/",headers:[{level:2,title:"1. å®è£è¦æ±",slug:"_1-å®è£è¦æ±",normalizedTitle:"1. å®è£è¦æ±",charIndex:181},{level:2,title:"2. åå¤ç¯å¢",slug:"_2-åå¤ç¯å¢",normalizedTitle:"2. åå¤ç¯å¢",charIndex:355},{level:2,title:"3. ææèç¹å®è£Docker/kubeadm/kubelet",slug:"_3-ææèç¹å®è£docker-kubeadm-kubelet",normalizedTitle:"3. ææèç¹å®è£docker/kubeadm/kubelet",charIndex:1060},{level:3,title:"3.1 å®è£Docker",slug:"_3-1-å®è£docker",normalizedTitle:"3.1 å®è£docker",charIndex:1140},{level:3,title:"3.2 æ·»å é¿éäºYUMè½¯ä»¶æº",slug:"_3-2-æ·»å é¿éäºyumè½¯ä»¶æº",normalizedTitle:"3.2 æ·»å é¿éäºyumè½¯ä»¶æº",charIndex:1538},{level:3,title:"3.3 å®è£kubeadmï¼kubeletåkubectl",slug:"_3-3-å®è£kubeadm-kubeletåkubectl",normalizedTitle:"3.3 å®è£kubeadmï¼kubeletåkubectl",charIndex:1894},{level:2,title:"4. é¨ç½²Kubernetes Master",slug:"_4-é¨ç½²kubernetes-master",normalizedTitle:"4. é¨ç½²kubernetes master",charIndex:2040},{level:2,title:"5. å å¥Kubernetes Node",slug:"_5-å å¥kubernetes-node",normalizedTitle:"5. å å¥kubernetes node",charIndex:2524},{level:2,title:"6. é¨ç½²CNIç½ç»æä»¶",slug:"_6-é¨ç½²cniç½ç»æä»¶",normalizedTitle:"6. é¨ç½²cniç½ç»æä»¶",charIndex:2891},{level:2,title:"7. æµè¯kuberneteséç¾¤",slug:"_7-æµè¯kuberneteséç¾¤",normalizedTitle:"7. æµè¯kuberneteséç¾¤",charIndex:3254}],headersStr:"1. å®è£è¦æ± 2. åå¤ç¯å¢ 3. ææèç¹å®è£Docker/kubeadm/kubelet 3.1 å®è£Docker 3.2 æ·»å é¿éäºYUMè½¯ä»¶æº 3.3 å®è£kubeadmï¼kubeletåkubectl 4. é¨ç½²Kubernetes Master 5. å å¥Kubernetes Node 6. é¨ç½²CNIç½ç»æä»¶ 7. æµè¯kuberneteséç¾¤",content:"# å¿«éé¨ç½²k8séç¾¤\n\nkubeadmæ¯å®æ¹ç¤¾åºæ¨åºçä¸ä¸ªç¨äºå¿«éé¨ç½²kuberneteséç¾¤çå·¥å·ã\n\nè¿ä¸ªå·¥å·è½éè¿ä¸¤æ¡æä»¤å®æä¸ä¸ªkuberneteséç¾¤çé¨ç½²ï¼\n\n# åå»ºä¸ä¸ª Master èç¹\n\n$ kubeadm init\n\n# å°ä¸ä¸ª Node èç¹å å¥å°å½åéç¾¤ä¸­\n\n$ kubeadm join <Masterèç¹çIPåç«¯å£ >\n\n\n# 1. å®è£è¦æ±\n\nå¨å¼å§ä¹åï¼é¨ç½²Kuberneteséç¾¤æºå¨éè¦æ»¡è¶³ä»¥ä¸å ä¸ªæ¡ä»¶ï¼\n\n * ä¸å°æå¤å°æºå¨ï¼æä½ç³»ç» CentOS7.x-86_x64\n * ç¡¬ä»¶éç½®ï¼2GBææ´å¤RAMï¼2ä¸ªCPUææ´å¤CPUï¼ç¡¬ç30GBææ´å¤\n * å¯ä»¥è®¿é®å¤ç½ï¼éè¦æåéåï¼å¦ææå¡å¨ä¸è½ä¸ç½ï¼éè¦æåä¸è½½éåå¹¶å¯¼å¥èç¹\n * ç¦æ­¢swapååº\n\n\n# 2. åå¤ç¯å¢\n\nè§è²       IP\nmaster   192.168.1.11\nnode1    192.168.1.12\nnode2    192.168.1.13\n\n# å³é­é²ç«å¢\n\nsystemctl stop firewalld\n\nsystemctl disable firewalld\n\n# å³é­selinux\n\nsed -i 's/enforcing/disabled/' /etc/selinux/config # æ°¸ä¹\n\nsetenforce 0 # ä¸´æ¶\n\n# å³é­swap\n\nswapoff -a # ä¸´æ¶\n\nsed -ri 's/.swap./#&/' /etc/fstab # æ°¸ä¹\n\n# æ ¹æ®è§åè®¾ç½®ä¸»æºå\n\nhostnamectl set-hostname\n\n# å¨masteræ·»å hosts\n\ncat >> /etc/hosts << EOF\n\n192.168.44.146 k8smaster\n\n192.168.44.145 k8snode1\n\n192.168.44.144 k8snode2\n\nEOF\n\n# å°æ¡¥æ¥çIPv4æµéä¼ éå°iptablesçé¾\n\ncat > /etc/sysctl.d/k8s.conf << EOF\n\nnet.bridge.bridge-nf-call-ip6tables = 1\n\nnet.bridge.bridge-nf-call-iptables = 1\n\nEOF\n\nsysctl --system # çæ\n\n# æ¶é´åæ­¥\n\nyum install ntpdate -y\n\nntpdate time.windows.com\n\n\n# 3. ææèç¹å®è£Docker/kubeadm/kubelet\n\nKubernetesé»è®¤CRIï¼å®¹å¨è¿è¡æ¶ï¼ä¸ºDockerï¼å æ­¤åå®è£Dockerã\n\n\n# 3.1 å®è£Docker\n\n$ wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo\n\n$ yum -y install docker-ce-18.06.1.ce-3.el7\n\n$ systemctl enable docker && systemctl start docker\n\n$ docker --version\n\nDocker version 18.06.1-ce, build e68fc7a\n\n$ cat > /etc/docker/daemon.json << EOF\n\n{\n\n\"registry-mirrors\": [\"https://b9pmyelo.mirror.aliyuncs.com\"]\n\n}\n\nEOF\n\n\n# 3.2 æ·»å é¿éäºYUMè½¯ä»¶æº\n\n$ cat > /etc/yum.repos.d/kubernetes.repo << EOF\n\n[kubernetes]\n\nname=Kubernetes\n\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\n\nenabled=1\n\ngpgcheck=0\n\nrepo_gpgcheck=0\n\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\n\nEOF\n\n\n# 3.3 å®è£kubeadmï¼kubeletåkubectl\n\nç±äºçæ¬æ´æ°é¢ç¹ï¼è¿éæå®çæ¬å·é¨ç½²ï¼\n\n$ yum install -y kubelet-1.18.0 kubeadm-1.18.0 kubectl-1.18.0\n\n$ systemctl enable kubelet\n\n\n# 4. é¨ç½²Kubernetes Master\n\nå¨192.168.1.11ï¼Masterï¼æ§è¡ã\n\n$ kubeadm init \\\n\n--apiserver-advertise-address=192.168.31.61 \\\n\n--image-repository registry.aliyuncs.com/google_containers \\\n\n--kubernetes-version v1.18.0 \\\n\n--service-cidr=10.96.0.0/12 \\\n\n--pod-network-cidr=10.244.0.0/16\n\nç±äºé»è®¤æåéåå°åk8s.gcr.ioå½åæ æ³è®¿é®ï¼è¿éæå®é¿éäºéåä»åºå°åã\n\nä½¿ç¨kubectlå·¥å·ï¼\n\nmkdir -p $HOME/.kube\n\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n\nsudo chown $(id -u)ð(id -g) $HOME/.kube/config\n\n$ kubectl get nodes\n\n\n# 5. å å¥Kubernetes Node\n\nå¨192.168.1.12/13ï¼Nodeï¼æ§è¡ã\n\nåéç¾¤æ·»å æ°èç¹ï¼æ§è¡å¨kubeadm initè¾åºçkubeadm joinå½ä»¤ï¼\n\n$ kubeadm join 192.168.1.11:6443 --token esce21.q6hetwm8si29qxwn \\\n\n--discovery-token-ca-cert-hash sha256:00603a05805807501d7181c3d60b478788408cfe6cedefedb1f97569708be9c5\n\né»è®¤tokenæææä¸º24å°æ¶ï¼å½è¿æä¹åï¼è¯¥tokenå°±ä¸å¯ç¨äºãè¿æ¶å°±éè¦éæ°åå»ºtokenï¼æä½å¦ä¸ï¼\n\nkubeadm token create --print-join-command\n\n\n# 6. é¨ç½²CNIç½ç»æä»¶\n\nwget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n\né»è®¤éåå°åæ æ³è®¿é®ï¼sedå½ä»¤ä¿®æ¹ä¸ºdocker hubéåä»åºã\n\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n\nkubectl get pods -n kube-system\n\nNAME READY STATUS RESTARTS AGE\n\nkube-flannel-ds-amd64-2pc95 1/1 Running 0 72s\n\n\n# 7. æµè¯kuberneteséç¾¤\n\nå¨Kuberneteséç¾¤ä¸­åå»ºä¸ä¸ªpodï¼éªè¯æ¯å¦æ­£å¸¸è¿è¡ï¼\n\n$ kubectl create deployment nginx --image=nginx\n\n$ kubectl expose deployment nginx --port=80 --type=NodePort\n\n$ kubectl get pod,svc\n\nè®¿é®å°åï¼http://NodeIP:Port",normalizedContent:"# å¿«éé¨ç½²k8séç¾¤\n\nkubeadmæ¯å®æ¹ç¤¾åºæ¨åºçä¸ä¸ªç¨äºå¿«éé¨ç½²kuberneteséç¾¤çå·¥å·ã\n\nè¿ä¸ªå·¥å·è½éè¿ä¸¤æ¡æä»¤å®æä¸ä¸ªkuberneteséç¾¤çé¨ç½²ï¼\n\n# åå»ºä¸ä¸ª master èç¹\n\n$ kubeadm init\n\n# å°ä¸ä¸ª node èç¹å å¥å°å½åéç¾¤ä¸­\n\n$ kubeadm join <masterèç¹çipåç«¯å£ >\n\n\n# 1. å®è£è¦æ±\n\nå¨å¼å§ä¹åï¼é¨ç½²kuberneteséç¾¤æºå¨éè¦æ»¡è¶³ä»¥ä¸å ä¸ªæ¡ä»¶ï¼\n\n * ä¸å°æå¤å°æºå¨ï¼æä½ç³»ç» centos7.x-86_x64\n * ç¡¬ä»¶éç½®ï¼2gbææ´å¤ramï¼2ä¸ªcpuææ´å¤cpuï¼ç¡¬ç30gbææ´å¤\n * å¯ä»¥è®¿é®å¤ç½ï¼éè¦æåéåï¼å¦ææå¡å¨ä¸è½ä¸ç½ï¼éè¦æåä¸è½½éåå¹¶å¯¼å¥èç¹\n * ç¦æ­¢swapååº\n\n\n# 2. åå¤ç¯å¢\n\nè§è²       ip\nmaster   192.168.1.11\nnode1    192.168.1.12\nnode2    192.168.1.13\n\n# å³é­é²ç«å¢\n\nsystemctl stop firewalld\n\nsystemctl disable firewalld\n\n# å³é­selinux\n\nsed -i 's/enforcing/disabled/' /etc/selinux/config # æ°¸ä¹\n\nsetenforce 0 # ä¸´æ¶\n\n# å³é­swap\n\nswapoff -a # ä¸´æ¶\n\nsed -ri 's/.swap./#&/' /etc/fstab # æ°¸ä¹\n\n# æ ¹æ®è§åè®¾ç½®ä¸»æºå\n\nhostnamectl set-hostname\n\n# å¨masteræ·»å hosts\n\ncat >> /etc/hosts << eof\n\n192.168.44.146 k8smaster\n\n192.168.44.145 k8snode1\n\n192.168.44.144 k8snode2\n\neof\n\n# å°æ¡¥æ¥çipv4æµéä¼ éå°iptablesçé¾\n\ncat > /etc/sysctl.d/k8s.conf << eof\n\nnet.bridge.bridge-nf-call-ip6tables = 1\n\nnet.bridge.bridge-nf-call-iptables = 1\n\neof\n\nsysctl --system # çæ\n\n# æ¶é´åæ­¥\n\nyum install ntpdate -y\n\nntpdate time.windows.com\n\n\n# 3. ææèç¹å®è£docker/kubeadm/kubelet\n\nkubernetesé»è®¤criï¼å®¹å¨è¿è¡æ¶ï¼ä¸ºdockerï¼å æ­¤åå®è£dockerã\n\n\n# 3.1 å®è£docker\n\n$ wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -o /etc/yum.repos.d/docker-ce.repo\n\n$ yum -y install docker-ce-18.06.1.ce-3.el7\n\n$ systemctl enable docker && systemctl start docker\n\n$ docker --version\n\ndocker version 18.06.1-ce, build e68fc7a\n\n$ cat > /etc/docker/daemon.json << eof\n\n{\n\n\"registry-mirrors\": [\"https://b9pmyelo.mirror.aliyuncs.com\"]\n\n}\n\neof\n\n\n# 3.2 æ·»å é¿éäºyumè½¯ä»¶æº\n\n$ cat > /etc/yum.repos.d/kubernetes.repo << eof\n\n[kubernetes]\n\nname=kubernetes\n\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\n\nenabled=1\n\ngpgcheck=0\n\nrepo_gpgcheck=0\n\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\n\neof\n\n\n# 3.3 å®è£kubeadmï¼kubeletåkubectl\n\nç±äºçæ¬æ´æ°é¢ç¹ï¼è¿éæå®çæ¬å·é¨ç½²ï¼\n\n$ yum install -y kubelet-1.18.0 kubeadm-1.18.0 kubectl-1.18.0\n\n$ systemctl enable kubelet\n\n\n# 4. é¨ç½²kubernetes master\n\nå¨192.168.1.11ï¼masterï¼æ§è¡ã\n\n$ kubeadm init \\\n\n--apiserver-advertise-address=192.168.31.61 \\\n\n--image-repository registry.aliyuncs.com/google_containers \\\n\n--kubernetes-version v1.18.0 \\\n\n--service-cidr=10.96.0.0/12 \\\n\n--pod-network-cidr=10.244.0.0/16\n\nç±äºé»è®¤æåéåå°åk8s.gcr.ioå½åæ æ³è®¿é®ï¼è¿éæå®é¿éäºéåä»åºå°åã\n\nä½¿ç¨kubectlå·¥å·ï¼\n\nmkdir -p $home/.kube\n\nsudo cp -i /etc/kubernetes/admin.conf $home/.kube/config\n\nsudo chown $(id -u)ð(id -g) $home/.kube/config\n\n$ kubectl get nodes\n\n\n# 5. å å¥kubernetes node\n\nå¨192.168.1.12/13ï¼nodeï¼æ§è¡ã\n\nåéç¾¤æ·»å æ°èç¹ï¼æ§è¡å¨kubeadm initè¾åºçkubeadm joinå½ä»¤ï¼\n\n$ kubeadm join 192.168.1.11:6443 --token esce21.q6hetwm8si29qxwn \\\n\n--discovery-token-ca-cert-hash sha256:00603a05805807501d7181c3d60b478788408cfe6cedefedb1f97569708be9c5\n\né»è®¤tokenæææä¸º24å°æ¶ï¼å½è¿æä¹åï¼è¯¥tokenå°±ä¸å¯ç¨äºãè¿æ¶å°±éè¦éæ°åå»ºtokenï¼æä½å¦ä¸ï¼\n\nkubeadm token create --print-join-command\n\n\n# 6. é¨ç½²cniç½ç»æä»¶\n\nwget https://raw.githubusercontent.com/coreos/flannel/master/documentation/kube-flannel.yml\n\né»è®¤éåå°åæ æ³è®¿é®ï¼sedå½ä»¤ä¿®æ¹ä¸ºdocker hubéåä»åºã\n\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/documentation/kube-flannel.yml\n\nkubectl get pods -n kube-system\n\nname ready status restarts age\n\nkube-flannel-ds-amd64-2pc95 1/1 running 0 72s\n\n\n# 7. æµè¯kuberneteséç¾¤\n\nå¨kuberneteséç¾¤ä¸­åå»ºä¸ä¸ªpodï¼éªè¯æ¯å¦æ­£å¸¸è¿è¡ï¼\n\n$ kubectl create deployment nginx --image=nginx\n\n$ kubectl expose deployment nginx --port=80 --type=nodeport\n\n$ kubectl get pod,svc\n\nè®¿é®å°åï¼http://nodeip:port",charsets:{cjk:!0}},{title:"elkå®è£",frontmatter:{title:"elkå®è£",categories:"elk",tags:["elk"],date:"2022-12-09T20:50:18.000Z",permalink:"/pages/98c9f5/",readingShow:"top",description:"elasticsearch å®ç½ä¸è½½å°åï¼\nhttps://www.elastic.co/cn/downloads/elasticsearch\nelasticsearch åå²çæ¬ä¸è½½å°åï¼\n https://www.elastic.co/cn/downloads/past-releases#elasticsearch",meta:[{name:"twitter:title",content:"elkå®è£"},{name:"twitter:description",content:"elasticsearch å®ç½ä¸è½½å°åï¼\nhttps://www.elastic.co/cn/downloads/elasticsearch\nelasticsearch åå²çæ¬ä¸è½½å°åï¼\n https://www.elastic.co/cn/downloads/past-releases#elasticsearch"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/03.elk/01.elk%E5%AE%89%E8%A3%85.html"},{property:"og:type",content:"article"},{property:"og:title",content:"elkå®è£"},{property:"og:description",content:"elasticsearch å®ç½ä¸è½½å°åï¼\nhttps://www.elastic.co/cn/downloads/elasticsearch\nelasticsearch åå²çæ¬ä¸è½½å°åï¼\n https://www.elastic.co/cn/downloads/past-releases#elasticsearch"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/03.elk/01.elk%E5%AE%89%E8%A3%85.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:50:18.000Z"},{property:"article:tag",content:"elk"},{itemprop:"name",content:"elkå®è£"},{itemprop:"description",content:"elasticsearch å®ç½ä¸è½½å°åï¼\nhttps://www.elastic.co/cn/downloads/elasticsearch\nelasticsearch åå²çæ¬ä¸è½½å°åï¼\n https://www.elastic.co/cn/downloads/past-releases#elasticsearch"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/03.elk/01.elk%E5%AE%89%E8%A3%85.html",relativePath:"01.ä¸é¢/03.elk/01.elkå®è£.md",key:"v-5a9f7a7c",path:"/pages/98c9f5/",headers:[{level:2,title:"ELKæå¡é¨ç½²",slug:"elkæå¡é¨ç½²",normalizedTitle:"elkæå¡é¨ç½²",charIndex:2},{level:3,title:"å®ç½ä¸è½½å¯¹åºçæ¬çäºè¿å¶åç¼©å",slug:"å®ç½ä¸è½½å¯¹åºçæ¬çäºè¿å¶åç¼©å",normalizedTitle:"å®ç½ä¸è½½å¯¹åºçæ¬çäºè¿å¶åç¼©å",charIndex:14},{level:3,title:"è§£åãåå¤å·¥ä½ãå¯å¨ELK",slug:"è§£åãåå¤å·¥ä½ãå¯å¨elk",normalizedTitle:"è§£åãåå¤å·¥ä½ãå¯å¨elk",charIndex:504}],headersStr:"ELKæå¡é¨ç½² å®ç½ä¸è½½å¯¹åºçæ¬çäºè¿å¶åç¼©å è§£åãåå¤å·¥ä½ãå¯å¨ELK",content:'# ELKæå¡é¨ç½²\n\n\n# å®ç½ä¸è½½å¯¹åºçæ¬çäºè¿å¶åç¼©å\n\nelasticsearch å®ç½ä¸è½½å°åï¼ https://www.elastic.co/cn/downloads/elasticsearch elasticsearch åå²çæ¬ä¸è½½å°åï¼ https://www.elastic.co/cn/downloads/past-releases#elasticsearch\n\nkinbana å®ç½ä¸è½½å°åï¼ https://www.elastic.co/cn/downloads/kibana kinbana åå²çæ¬ä¸è½½å°åï¼ https://www.elastic.co/cn/downloads/past-releases#kibana\n\nlogstash å®ç½ä¸è½½å°åï¼ https://www.elastic.co/cn/downloads/logstash logstash åå²çæ¬ä¸è½½å°åï¼ https://www.elastic.co/cn/downloads/past-releases\n\n----------------------------------------\n\n\n# è§£åãåå¤å·¥ä½ãå¯å¨ELK\n\nelasticsearch.tar.gzæä»¶è§£å\n\ntar -zxvf å°±å¯ä»¥å¦ å¤ªåºç¡çåºè¯å½ä»¤å°±ä¸ç½åå¦ï¼ä¸»è¦æ¯æå ä¸ªå³é®çç»èçç¹ æ¯å¦elasticsearché¨ç½²çæ¶åéè¦æ³¨æï¼\n\n 1. ä½¿ç¨æ®éç¨æ·\n 2. å¼å¯max_map_count\n 3. è®¾ç½®å¯¹åºæ®éç¨æ·limit.conf\n 4. useradd -d /data/es es &&echo es | passwd --stdin es\n 5. echo "vm.max_map_count=655360" >> /etc/sysctl.conf\n 6. echo "es soft nofile 655350" >> /etc/security/limits.conf && echo "es hard nofile 655350" >> /etc/security/limits.conf sysctl -p å·æ°ä¸ä¸å¦å¶çæ\n\nç¶ååå¤ä¸ªå¯¹åºçjdkéç½®ä¸ªå¨å±çç¯å¢åéï¼\n\n> JAVA_HOME=/opt/jdk1.8.0_65 PATH=$JAVA_HOME/bin:$PATH CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar è¿½å è³ç³»ç»ç¯å¢åéæä»¶å°¾é¨å³å¯æèæ®éç¨æ·ç /etc/profile .bash_profile .bashrc ç¶åç»å·æ°ä¸ä¸ç¯å¢åéæèexitéåºç¨æ·éæ°ç»å½å³å¯å·æ° ç»å½æ®éç¨æ·è®°å¾å¸¦ä¸æ è¡¨ç¤ºå¸¦çæ®éç¨æ·çç¯å¢åéå¢ su - es source /etc/profile å½æä½¿ç¨elasticsearch-no-jdk-7.9.6.tar.gzçæ¬åæ¶,å¯å¨æç¤ºè¦æ¾æ¬å°æ®éç¨æ·å®¶ç®å½ä¸é¢çjava ä¾å¦ä¸é¢çesç¨æ· elasticä¸ºè§£åå /data/es/elastic/jdk/bin/java éç½®äºå¨å±çç¯å¢åé æå®ç®å½çopt jdk javaé½ä¸è¡è¿è¦å»æ¾ä¸é¢ç®å½çjava æ­¤æ¶æä»¬å¯ä»¥æå¾çä»ç´æ¥æ ¹æ®å¯å¨logéè¯¯ä¿¡æ¯è§£å³å³å¯å¦ ä½¿ç¨âå°å¤§æâç´æ¥è½¯è¿æ¥å°è¿å»å°±å¥½å¦ å½ç¶åæå¯¹åºçelasticè§£ååç®å½è¦åå»ºå¯¹åºçlogæç¤ºçè·¯å²ç®å½ ä¸ç¶è½¯è¿æ¥æ¾ä¸å°ä¸ä¸å±ç®å½æ æ³åå»ºå mkdir -p /data/es/elastic/jdk/bin/ ln -sf /opt/jdk/java/bin/java /data/es/elastic/jdk/bin/\n\nç¶åéç½®æ¹å§æ¹å§ä¿®æ¹ä¿®æ¹elasticsearch.ymlæä»¶\n\n> cat elasticsearch/config/elasticsearch.yml cluster.name: pengge #bootstrap.mlockall: true thread_pool.search.size: 10 thread_pool.search.queue_size: 3000 thread_pool.bulk.size: 5 thread_pool.bulk.queue_size: 2000 thread_pool.index.size: 5 thread_pool.index.queue_size: 1500 node.name: node-pengge cluster.initial_master_nodes: ["node-pengge"] path.data: /data/es/elastic/data path.logs: /data/elastic/logs network.host: 192.168.108.8 http.port: 9200 transport.tcp.port: 9300 transport.tcp.compress: false discovery.zen.ping.unicast.hosts: ["192.168.108.8", "192.168.108.9", "192.168.108.10"]\n\nç¶åå°±å¯ä»¥å¯å¨esèç¹å¦ï¼ä¸é¢å®ä¾ymléç½®æä»¶æ¯éç½®çä¸èç¹éç¾¤ï¼å¤èç¹éç¾¤ä¹æ¯ä¸æ ·çéçéå·æ·»å éç¾¤èç¹ipå³å¯å¦ï¼ç®ç®ååé¨ç½²é£æ¯ååçè½»æ¾å¦ ./elasticsearch &> esstart.log & && tail -f esstart.log ç´æ¥shæè./å¯å¨äºè¿å¶èæ¬&>å°å±å¹æ åæ­£ç¡®éè¯¯è¾åºè¾åºè³æ¬å°ç®å½çesstart.logå½åçå¯å¨æ¥å¿æä»¶åï¼åæ¶ä½¿ç¨tail -f è§å¯esæå¡å¯å¨æåµå³å¯\n\nä¸é¢éä¸ä¸äºåºç¡çesæ¥è¯¢è¯­å¥ï¼ å½ä»¤è¡getæ¹å¼æ¥è¯¢ï¼penggeä¸ºç¤ºä¾ç´¢å¼åç§°\n\n> curl 192.168.108.8:9200/_cat/indices curl 192.168.108.8:9200/_cat/health curl 192.168.108.8:9200/_cat/nodes curl 192.168.108.8:9200/_cat/shards curl 192.168.108.8:9200/_cat/allocation curl 192.168.108.8:9200/pengge/_count curl 192.168.108.8:9200/pengge/_search kibanaé¡µé¢æ¹å¼æ¥è¯¢ï¼ GET _cat/indices GET _cat/health GET _cat/nodes GET _cat/shards GET _cat/allocation GET /pengge/_count GET /pengge/_search\n\nå é¤ç´¢å¼\nDELETE pengge*\nå é¤ç´¢å¼åçæå®å­æ®µï¼ä¸å®æ³¨æå é¤å­æ®µæ¯è¿ä¸ªå¨ä½åæ°å¦ï¼_update_by_query\nå é¤å­æ®µï¼@timestamp\nPOST /pengge/_update_by_query\n{\n "script": {\n "inline": "ctx._source.remove(\'@timestamp\')",\n "lang": "painless"\n },\n "query": {\n "bool": {\n "must": [\n {\n "exists": {\n "field": "@timestamp"\n }\n }\n ]\n }\n }\n}\n\n\n***è³æ­¤elasticsearchæå¡å°±ç®ç®ååçå¯å¨æåå¦ ***\n\nè³äºkibanaãlogstashä¸æ ·çéçç®åè§£å./å¯å¨å³å¯å¦ ä¸å¨åºè¯åè¿°å¦ ç®åéç½®ä¸ªes 9200è¯»åçèç¹å°±å¯ä»¥äºå¦ä¸ï¼\n\n[root@zabbix config]# egrep -v "#|^$" kibana.yml\nserver.port: 5601\nserver.host: "192.168.108.143"\nelasticsearch.hosts: ["http://192.168.108.9:9200"]\n\n./kibana &> start.log & && tail -f start.log\n\n\nlogstashçè¯ä¸»è¦å°±æ¯ä¸ºäºéå¯¹logæ¥å¿æä»¶æètxt csvç­æºæ°æ®æä»¶è¿è¡æ´çæ±æ»åå²æ¨éç»esä»èå¨kibanaå±ç¤ºï¼ç»èä¸è¥¿ä¸ç¯æç« è¿è¡è®²è§£ï¼æ¬æåå®¹å°±ç®ç®ååååé¨ç½²å¯å¨å®äºå¦ logstashéç½®çjob confæä»¶å¯ä»¥ä½¿ç¨-tåæ°ç®åéç½®çå­æ®µè¯­æ³æ¯å¦æ­£ç¡®å¦ä¸ï¼\n\n[root@zabbix bin]# ./logstash -f job/csv-es-debug.conf -t\nSending Logstash logs to /data/kinbana/logstash7.8.1/logstash-7.8.1/logs which is now configured via log4j2.properties\n[2021-03-09T15:24:03,282][WARN ][logstash.config.source.multilocal] Ignoring the \'pipelines.yml\' file because modules or command line options are specified\n[2021-03-09T15:24:05,485][INFO ][org.reflections.Reflections] Reflections took 46 ms to scan 1 urls, producing 21 keys and 41 values\nConfiguration OK\n[2021-03-09T15:24:06,291][INFO ][logstash.runner ] Using config.test_and_exit mode. Config Validation Result: OK. Exiting Logstash\n\n\nå®äºå°±å¯ä»¥-fæå® & æ¾å¥åå°è¿è¡è¿è¡ä½¿ç¨å¯ç±çlogstashå¦~\n\n----------------------------------------',normalizedContent:'# elkæå¡é¨ç½²\n\n\n# å®ç½ä¸è½½å¯¹åºçæ¬çäºè¿å¶åç¼©å\n\nelasticsearch å®ç½ä¸è½½å°åï¼ https://www.elastic.co/cn/downloads/elasticsearch elasticsearch åå²çæ¬ä¸è½½å°åï¼ https://www.elastic.co/cn/downloads/past-releases#elasticsearch\n\nkinbana å®ç½ä¸è½½å°åï¼ https://www.elastic.co/cn/downloads/kibana kinbana åå²çæ¬ä¸è½½å°åï¼ https://www.elastic.co/cn/downloads/past-releases#kibana\n\nlogstash å®ç½ä¸è½½å°åï¼ https://www.elastic.co/cn/downloads/logstash logstash åå²çæ¬ä¸è½½å°åï¼ https://www.elastic.co/cn/downloads/past-releases\n\n----------------------------------------\n\n\n# è§£åãåå¤å·¥ä½ãå¯å¨elk\n\nelasticsearch.tar.gzæä»¶è§£å\n\ntar -zxvf å°±å¯ä»¥å¦ å¤ªåºç¡çåºè¯å½ä»¤å°±ä¸ç½åå¦ï¼ä¸»è¦æ¯æå ä¸ªå³é®çç»èçç¹ æ¯å¦elasticsearché¨ç½²çæ¶åéè¦æ³¨æï¼\n\n 1. ä½¿ç¨æ®éç¨æ·\n 2. å¼å¯max_map_count\n 3. è®¾ç½®å¯¹åºæ®éç¨æ·limit.conf\n 4. useradd -d /data/es es &&echo es | passwd --stdin es\n 5. echo "vm.max_map_count=655360" >> /etc/sysctl.conf\n 6. echo "es soft nofile 655350" >> /etc/security/limits.conf && echo "es hard nofile 655350" >> /etc/security/limits.conf sysctl -p å·æ°ä¸ä¸å¦å¶çæ\n\nç¶ååå¤ä¸ªå¯¹åºçjdkéç½®ä¸ªå¨å±çç¯å¢åéï¼\n\n> java_home=/opt/jdk1.8.0_65 path=$java_home/bin:$path classpath=.:$java_home/lib/dt.jar:$java_home/lib/tools.jar è¿½å è³ç³»ç»ç¯å¢åéæä»¶å°¾é¨å³å¯æèæ®éç¨æ·ç /etc/profile .bash_profile .bashrc ç¶åç»å·æ°ä¸ä¸ç¯å¢åéæèexitéåºç¨æ·éæ°ç»å½å³å¯å·æ° ç»å½æ®éç¨æ·è®°å¾å¸¦ä¸æ è¡¨ç¤ºå¸¦çæ®éç¨æ·çç¯å¢åéå¢ su - es source /etc/profile å½æä½¿ç¨elasticsearch-no-jdk-7.9.6.tar.gzçæ¬åæ¶,å¯å¨æç¤ºè¦æ¾æ¬å°æ®éç¨æ·å®¶ç®å½ä¸é¢çjava ä¾å¦ä¸é¢çesç¨æ· elasticä¸ºè§£åå /data/es/elastic/jdk/bin/java éç½®äºå¨å±çç¯å¢åé æå®ç®å½çopt jdk javaé½ä¸è¡è¿è¦å»æ¾ä¸é¢ç®å½çjava æ­¤æ¶æä»¬å¯ä»¥æå¾çä»ç´æ¥æ ¹æ®å¯å¨logéè¯¯ä¿¡æ¯è§£å³å³å¯å¦ ä½¿ç¨âå°å¤§æâç´æ¥è½¯è¿æ¥å°è¿å»å°±å¥½å¦ å½ç¶åæå¯¹åºçelasticè§£ååç®å½è¦åå»ºå¯¹åºçlogæç¤ºçè·¯å²ç®å½ ä¸ç¶è½¯è¿æ¥æ¾ä¸å°ä¸ä¸å±ç®å½æ æ³åå»ºå mkdir -p /data/es/elastic/jdk/bin/ ln -sf /opt/jdk/java/bin/java /data/es/elastic/jdk/bin/\n\nç¶åéç½®æ¹å§æ¹å§ä¿®æ¹ä¿®æ¹elasticsearch.ymlæä»¶\n\n> cat elasticsearch/config/elasticsearch.yml cluster.name: pengge #bootstrap.mlockall: true thread_pool.search.size: 10 thread_pool.search.queue_size: 3000 thread_pool.bulk.size: 5 thread_pool.bulk.queue_size: 2000 thread_pool.index.size: 5 thread_pool.index.queue_size: 1500 node.name: node-pengge cluster.initial_master_nodes: ["node-pengge"] path.data: /data/es/elastic/data path.logs: /data/elastic/logs network.host: 192.168.108.8 http.port: 9200 transport.tcp.port: 9300 transport.tcp.compress: false discovery.zen.ping.unicast.hosts: ["192.168.108.8", "192.168.108.9", "192.168.108.10"]\n\nç¶åå°±å¯ä»¥å¯å¨esèç¹å¦ï¼ä¸é¢å®ä¾ymléç½®æä»¶æ¯éç½®çä¸èç¹éç¾¤ï¼å¤èç¹éç¾¤ä¹æ¯ä¸æ ·çéçéå·æ·»å éç¾¤èç¹ipå³å¯å¦ï¼ç®ç®ååé¨ç½²é£æ¯ååçè½»æ¾å¦ ./elasticsearch &> esstart.log & && tail -f esstart.log ç´æ¥shæè./å¯å¨äºè¿å¶èæ¬&>å°å±å¹æ åæ­£ç¡®éè¯¯è¾åºè¾åºè³æ¬å°ç®å½çesstart.logå½åçå¯å¨æ¥å¿æä»¶åï¼åæ¶ä½¿ç¨tail -f è§å¯esæå¡å¯å¨æåµå³å¯\n\nä¸é¢éä¸ä¸äºåºç¡çesæ¥è¯¢è¯­å¥ï¼ å½ä»¤è¡getæ¹å¼æ¥è¯¢ï¼penggeä¸ºç¤ºä¾ç´¢å¼åç§°\n\n> curl 192.168.108.8:9200/_cat/indices curl 192.168.108.8:9200/_cat/health curl 192.168.108.8:9200/_cat/nodes curl 192.168.108.8:9200/_cat/shards curl 192.168.108.8:9200/_cat/allocation curl 192.168.108.8:9200/pengge/_count curl 192.168.108.8:9200/pengge/_search kibanaé¡µé¢æ¹å¼æ¥è¯¢ï¼ get _cat/indices get _cat/health get _cat/nodes get _cat/shards get _cat/allocation get /pengge/_count get /pengge/_search\n\nå é¤ç´¢å¼\ndelete pengge*\nå é¤ç´¢å¼åçæå®å­æ®µï¼ä¸å®æ³¨æå é¤å­æ®µæ¯è¿ä¸ªå¨ä½åæ°å¦ï¼_update_by_query\nå é¤å­æ®µï¼@timestamp\npost /pengge/_update_by_query\n{\n "script": {\n "inline": "ctx._source.remove(\'@timestamp\')",\n "lang": "painless"\n },\n "query": {\n "bool": {\n "must": [\n {\n "exists": {\n "field": "@timestamp"\n }\n }\n ]\n }\n }\n}\n\n\n***è³æ­¤elasticsearchæå¡å°±ç®ç®ååçå¯å¨æåå¦ ***\n\nè³äºkibanaãlogstashä¸æ ·çéçç®åè§£å./å¯å¨å³å¯å¦ ä¸å¨åºè¯åè¿°å¦ ç®åéç½®ä¸ªes 9200è¯»åçèç¹å°±å¯ä»¥äºå¦ä¸ï¼\n\n[root@zabbix config]# egrep -v "#|^$" kibana.yml\nserver.port: 5601\nserver.host: "192.168.108.143"\nelasticsearch.hosts: ["http://192.168.108.9:9200"]\n\n./kibana &> start.log & && tail -f start.log\n\n\nlogstashçè¯ä¸»è¦å°±æ¯ä¸ºäºéå¯¹logæ¥å¿æä»¶æètxt csvç­æºæ°æ®æä»¶è¿è¡æ´çæ±æ»åå²æ¨éç»esä»èå¨kibanaå±ç¤ºï¼ç»èä¸è¥¿ä¸ç¯æç« è¿è¡è®²è§£ï¼æ¬æåå®¹å°±ç®ç®ååååé¨ç½²å¯å¨å®äºå¦ logstashéç½®çjob confæä»¶å¯ä»¥ä½¿ç¨-tåæ°ç®åéç½®çå­æ®µè¯­æ³æ¯å¦æ­£ç¡®å¦ä¸ï¼\n\n[root@zabbix bin]# ./logstash -f job/csv-es-debug.conf -t\nsending logstash logs to /data/kinbana/logstash7.8.1/logstash-7.8.1/logs which is now configured via log4j2.properties\n[2021-03-09t15:24:03,282][warn ][logstash.config.source.multilocal] ignoring the \'pipelines.yml\' file because modules or command line options are specified\n[2021-03-09t15:24:05,485][info ][org.reflections.reflections] reflections took 46 ms to scan 1 urls, producing 21 keys and 41 values\nconfiguration ok\n[2021-03-09t15:24:06,291][info ][logstash.runner ] using config.test_and_exit mode. config validation result: ok. exiting logstash\n\n\nå®äºå°±å¯ä»¥-fæå® & æ¾å¥åå°è¿è¡è¿è¡ä½¿ç¨å¯ç±çlogstashå¦~\n\n----------------------------------------',charsets:{cjk:!0}},{title:"docker-composeå®è£elk",frontmatter:{title:"docker-composeå®è£elk",date:"2023-01-13T16:45:28.000Z",permalink:"/pages/bbe108/",categories:["ä¸é¢","elk"],tags:[null],readingShow:"top",description:'version: "3"\nservices:\n  es-master:\n    container_name: es-master\n    hostname: es-master\n    image: elasticsearch:7.12.1\n    restart: always\n    ports:\n      9200:9200\n      9300:9300\n    volumes:\n      ./elasticsearch/master/conf/es-master.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      /data/elk/es-master/data:/usr/share/elasticsearch/data\n      /data/elk/es-master/logs:/usr/share/elasticsearch/logs\n      /etc/localtime:/etc/localtime\n      ./elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12\n    environment:\n      "ESJAVAOPTS=-Xms1024m -Xmx1024m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1',meta:[{name:"twitter:title",content:"docker-composeå®è£elk"},{name:"twitter:description",content:'version: "3"\nservices:\n  es-master:\n    container_name: es-master\n    hostname: es-master\n    image: elasticsearch:7.12.1\n    restart: always\n    ports:\n      9200:9200\n      9300:9300\n    volumes:\n      ./elasticsearch/master/conf/es-master.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      /data/elk/es-master/data:/usr/share/elasticsearch/data\n      /data/elk/es-master/logs:/usr/share/elasticsearch/logs\n      /etc/localtime:/etc/localtime\n      ./elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12\n    environment:\n      "ESJAVAOPTS=-Xms1024m -Xmx1024m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1'},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/03.elk/02.docker-compose%E5%AE%89%E8%A3%85elk.html"},{property:"og:type",content:"article"},{property:"og:title",content:"docker-composeå®è£elk"},{property:"og:description",content:'version: "3"\nservices:\n  es-master:\n    container_name: es-master\n    hostname: es-master\n    image: elasticsearch:7.12.1\n    restart: always\n    ports:\n      9200:9200\n      9300:9300\n    volumes:\n      ./elasticsearch/master/conf/es-master.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      /data/elk/es-master/data:/usr/share/elasticsearch/data\n      /data/elk/es-master/logs:/usr/share/elasticsearch/logs\n      /etc/localtime:/etc/localtime\n      ./elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12\n    environment:\n      "ESJAVAOPTS=-Xms1024m -Xmx1024m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1'},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/03.elk/02.docker-compose%E5%AE%89%E8%A3%85elk.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-13T16:45:28.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"docker-composeå®è£elk"},{itemprop:"description",content:'version: "3"\nservices:\n  es-master:\n    container_name: es-master\n    hostname: es-master\n    image: elasticsearch:7.12.1\n    restart: always\n    ports:\n      9200:9200\n      9300:9300\n    volumes:\n      ./elasticsearch/master/conf/es-master.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      /data/elk/es-master/data:/usr/share/elasticsearch/data\n      /data/elk/es-master/logs:/usr/share/elasticsearch/logs\n      /etc/localtime:/etc/localtime\n      ./elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12\n    environment:\n      "ESJAVAOPTS=-Xms1024m -Xmx1024m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1'}]},regularPath:"/01.%E4%B8%93%E9%A2%98/03.elk/02.docker-compose%E5%AE%89%E8%A3%85elk.html",relativePath:"01.ä¸é¢/03.elk/02.docker-composeå®è£elk.md",key:"v-4b66e9c6",path:"/pages/bbe108/",headers:[{level:3,title:"å®è£æä»¶",slug:"å®è£æä»¶",normalizedTitle:"å®è£æä»¶",charIndex:2}],headersStr:"å®è£æä»¶",content:'# å®è£æä»¶\n\nversion: "3"\nservices:\n  es-master:\n    container_name: es-master\n    hostname: es-master\n    image: elasticsearch:7.12.1\n    restart: always\n    ports:\n      - 9200:9200\n      - 9300:9300\n    volumes:\n      - ./elasticsearch/master/conf/es-master.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      - /data/elk/es-master/data:/usr/share/elasticsearch/data\n      - /data/elk/es-master/logs:/usr/share/elasticsearch/logs\n      - /etc/localtime:/etc/localtime\n      - ./elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12\n    environment:\n      - "ES_JAVA_OPTS=-Xms1024m -Xmx1024m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n\n  es-slave1:\n    container_name: es-slave1\n    image: elasticsearch:7.12.1\n    restart: always\n    ports:\n      - 9201:9200\n      #- 9301:9300\n    volumes:\n      - ./elasticsearch/slave1/conf/es-slave1.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      - /data/elk/es-slave1/data:/usr/share/elasticsearch/data\n      - /data/elk/es-slave1/logs:/usr/share/elasticsearch/logs\n      - /etc/localtime:/etc/localtime\n      - ./elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12\n    environment:\n      - "ES_JAVA_OPTS=-Xms1024m -Xmx1024m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n\n  es-slave2:\n    container_name: es-slave2\n    image: elasticsearch:7.12.1\n    restart: always\n    ports:\n      - 9202:9200\n      #- 9302:9300\n    volumes:\n      - ./elasticsearch/slave2/conf/es-slave2.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      - /data/elk/es-slave2/data:/usr/share/elasticsearch/data\n      - /data/elk/es-slave2/logs:/usr/share/elasticsearch/logs\n      - /etc/localtime:/etc/localtime\n      - ./elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12\n    environment:\n      - "ES_JAVA_OPTS=-Xms1024m -Xmx1024m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n\n  kibana:\n    container_name: kibana\n    hostname: kibana\n    image: kibana:7.12.1\n    restart: always\n    ports:\n      - 5601:5601\n    volumes:\n      - ./kibana/conf/kibana.yml:/usr/share/kibana/config/kibana.yml\n      - /etc/localtime:/etc/localtime\n    environment:\n      - elasticsearch.hosts=http://es-master:9200\n    depends_on:\n      - es-master\n      - es-slave1\n      - es-slave2\n  logstash:\n    container_name: logstash\n    hostname: logstash\n    image: logstash:7.12.1\n    command: logstash -f ./conf/logstash-kafka.conf\n    restart: always\n    volumes:\n      # æ å°å°å®¹å¨ä¸­\n      - ./logstash/conf/logstash-kafka.conf:/usr/share/logstash/conf/logstash-kafka.conf\n      - ./logstash/ssl:/usr/share/logstash/ssl\n      - ./logstash/template:/template\n    environment:\n      - elasticsearch.hosts=http://es-master:9200\n      - /etc/localtime:/etc/localtime\n      # è§£å³logstashçæ§è¿æ¥æ¥é\n      - xpack.monitoring.elasticsearch.hosts=http://es-master:9200\n      - xpack.monitoring.elasticsearch.username="logstash_system"\n      - xpack.monitoring.elasticsearch.password="xxx"\n    ports:\n      - 5044:5044\n    depends_on:\n      - es-master\n      - es-slave1\n      - es-slave2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n',normalizedContent:'# å®è£æä»¶\n\nversion: "3"\nservices:\n  es-master:\n    container_name: es-master\n    hostname: es-master\n    image: elasticsearch:7.12.1\n    restart: always\n    ports:\n      - 9200:9200\n      - 9300:9300\n    volumes:\n      - ./elasticsearch/master/conf/es-master.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      - /data/elk/es-master/data:/usr/share/elasticsearch/data\n      - /data/elk/es-master/logs:/usr/share/elasticsearch/logs\n      - /etc/localtime:/etc/localtime\n      - ./elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12\n    environment:\n      - "es_java_opts=-xms1024m -xmx1024m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n\n  es-slave1:\n    container_name: es-slave1\n    image: elasticsearch:7.12.1\n    restart: always\n    ports:\n      - 9201:9200\n      #- 9301:9300\n    volumes:\n      - ./elasticsearch/slave1/conf/es-slave1.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      - /data/elk/es-slave1/data:/usr/share/elasticsearch/data\n      - /data/elk/es-slave1/logs:/usr/share/elasticsearch/logs\n      - /etc/localtime:/etc/localtime\n      - ./elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12\n    environment:\n      - "es_java_opts=-xms1024m -xmx1024m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n\n  es-slave2:\n    container_name: es-slave2\n    image: elasticsearch:7.12.1\n    restart: always\n    ports:\n      - 9202:9200\n      #- 9302:9300\n    volumes:\n      - ./elasticsearch/slave2/conf/es-slave2.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n      - /data/elk/es-slave2/data:/usr/share/elasticsearch/data\n      - /data/elk/es-slave2/logs:/usr/share/elasticsearch/logs\n      - /etc/localtime:/etc/localtime\n      - ./elastic-certificates.p12:/usr/share/elasticsearch/config/elastic-certificates.p12\n    environment:\n      - "es_java_opts=-xms1024m -xmx1024m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n\n  kibana:\n    container_name: kibana\n    hostname: kibana\n    image: kibana:7.12.1\n    restart: always\n    ports:\n      - 5601:5601\n    volumes:\n      - ./kibana/conf/kibana.yml:/usr/share/kibana/config/kibana.yml\n      - /etc/localtime:/etc/localtime\n    environment:\n      - elasticsearch.hosts=http://es-master:9200\n    depends_on:\n      - es-master\n      - es-slave1\n      - es-slave2\n  logstash:\n    container_name: logstash\n    hostname: logstash\n    image: logstash:7.12.1\n    command: logstash -f ./conf/logstash-kafka.conf\n    restart: always\n    volumes:\n      # æ å°å°å®¹å¨ä¸­\n      - ./logstash/conf/logstash-kafka.conf:/usr/share/logstash/conf/logstash-kafka.conf\n      - ./logstash/ssl:/usr/share/logstash/ssl\n      - ./logstash/template:/template\n    environment:\n      - elasticsearch.hosts=http://es-master:9200\n      - /etc/localtime:/etc/localtime\n      # è§£å³logstashçæ§è¿æ¥æ¥é\n      - xpack.monitoring.elasticsearch.hosts=http://es-master:9200\n      - xpack.monitoring.elasticsearch.username="logstash_system"\n      - xpack.monitoring.elasticsearch.password="xxx"\n    ports:\n      - 5044:5044\n    depends_on:\n      - es-master\n      - es-slave1\n      - es-slave2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n',charsets:{cjk:!0}},{title:"filebeat-logç¸å³éç½®æå",frontmatter:{title:"filebeat-logç¸å³éç½®æå",date:"2023-02-23T09:01:59.000Z",permalink:"/pages/ed9e8d/",categories:["ä¸é¢","elk"],tags:[null],readingShow:"top",description:"æ¬æä¸»è¦ä»ç» Filebeat 7.5 çæ¬ä¸­ Log ç¸å³çåä¸ªéç½®é¡¹çå«ä¹ä»¥åå¶åºç¨åºæ¯ã",meta:[{name:"twitter:title",content:"filebeat-logç¸å³éç½®æå"},{name:"twitter:description",content:"æ¬æä¸»è¦ä»ç» Filebeat 7.5 çæ¬ä¸­ Log ç¸å³çåä¸ªéç½®é¡¹çå«ä¹ä»¥åå¶åºç¨åºæ¯ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/03.elk/03.filebeat-log%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97.html"},{property:"og:type",content:"article"},{property:"og:title",content:"filebeat-logç¸å³éç½®æå"},{property:"og:description",content:"æ¬æä¸»è¦ä»ç» Filebeat 7.5 çæ¬ä¸­ Log ç¸å³çåä¸ªéç½®é¡¹çå«ä¹ä»¥åå¶åºç¨åºæ¯ã"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/03.elk/03.filebeat-log%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-23T09:01:59.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"filebeat-logç¸å³éç½®æå"},{itemprop:"description",content:"æ¬æä¸»è¦ä»ç» Filebeat 7.5 çæ¬ä¸­ Log ç¸å³çåä¸ªéç½®é¡¹çå«ä¹ä»¥åå¶åºç¨åºæ¯ã"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/03.elk/03.filebeat-log%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97.html",relativePath:"01.ä¸é¢/03.elk/03.filebeat-logç¸å³éç½®æå.md",key:"v-dd6a2a08",path:"/pages/ed9e8d/",headers:[{level:2,title:"paths",slug:"paths",normalizedTitle:"paths",charIndex:85},{level:3,title:"Glob æ¨¡å¼",slug:"glob-æ¨¡å¼",normalizedTitle:"glob æ¨¡å¼",charIndex:468},{level:3,title:"éå½ç Glob æ¨¡å¼",slug:"éå½ç-glob-æ¨¡å¼",normalizedTitle:"éå½ç glob æ¨¡å¼",charIndex:833},{level:2,title:"recursive_glob.enabled:",slug:"recursive-glob-enabled",normalizedTitle:"recursive_glob.enabled:",charIndex:1481},{level:2,title:"exclude_lines",slug:"exclude-lines",normalizedTitle:"exclude_lines",charIndex:1577},{level:2,title:"include_lines",slug:"include-lines",normalizedTitle:"include_lines",charIndex:1717},{level:2,title:"exclude_files",slug:"exclude-files",normalizedTitle:"exclude_files",charIndex:2411},{level:2,title:"harvesterbuffersize",slug:"harvester-buffer-size",normalizedTitle:"harvesterbuffersize",charIndex:null},{level:2,title:"max_bytes",slug:"max-bytes",normalizedTitle:"max_bytes",charIndex:2744},{level:2,title:"multiline",slug:"multiline",normalizedTitle:"multiline",charIndex:2822},{level:2,title:"ignore_older",slug:"ignore-older",normalizedTitle:"ignore_older",charIndex:3160},{level:2,title:"close_* ç³»å",slug:"close-ç³»å",normalizedTitle:"close_* ç³»å",charIndex:3629},{level:2,title:"clean_* ç³»å",slug:"clean-ç³»å",normalizedTitle:"clean_* ç³»å",charIndex:4314},{level:2,title:"scan_frequency",slug:"scan-frequency",normalizedTitle:"scan_frequency",charIndex:4564},{level:2,title:"scan.sort å scan.order",slug:"scan-sort-å-scan-order",normalizedTitle:"scan.sort å scan.order",charIndex:4649},{level:2,title:"tail_files",slug:"tail-files",normalizedTitle:"tail_files",charIndex:4840},{level:2,title:"harvester_limit",slug:"harvester-limit",normalizedTitle:"harvester_limit",charIndex:5109},{level:2,title:"symlinks",slug:"symlinks",normalizedTitle:"symlinks",charIndex:5384},{level:2,title:"backoff ç¸å³éç½®",slug:"backoff-ç¸å³éç½®",normalizedTitle:"backoff ç¸å³éç½®",charIndex:5431},{level:2,title:"queue ç¸å³éç½®",slug:"queue-ç¸å³éç½®",normalizedTitle:"queue ç¸å³éç½®",charIndex:6431},{level:2,title:"registry ç¸å³éç½®",slug:"registry-ç¸å³éç½®",normalizedTitle:"registry ç¸å³éç½®",charIndex:6922},{level:2,title:"æ¥å¿ç¸å³éç½®",slug:"æ¥å¿ç¸å³éç½®",normalizedTitle:"æ¥å¿ç¸å³éç½®",charIndex:7316},{level:2,title:"ä½¿ç¨ç¯å¢åé",slug:"ä½¿ç¨ç¯å¢åé",normalizedTitle:"ä½¿ç¨ç¯å¢åé",charIndex:8949}],headersStr:"paths Glob æ¨¡å¼ éå½ç Glob æ¨¡å¼ recursive_glob.enabled: exclude_lines include_lines exclude_files harvesterbuffersize max_bytes multiline ignore_older close_* ç³»å clean_* ç³»å scan_frequency scan.sort å scan.order tail_files harvester_limit symlinks backoff ç¸å³éç½® queue ç¸å³éç½® registry ç¸å³éç½® æ¥å¿ç¸å³éç½® ä½¿ç¨ç¯å¢åé",content:"æ¬æä¸»è¦ä»ç» Filebeat 7.5 çæ¬ä¸­ Log ç¸å³çåä¸ªéç½®é¡¹çå«ä¹ä»¥åå¶åºç¨åºæ¯ã\n\nä¸è¬æåµä¸ï¼æä»¬ä½¿ç¨ log input çæ¹å¼å¦ä¸ï¼åªéè¦æå®ä¸ç³»å paths å³å¯ã\n\nfilebeat.inputs:\n- type: log\n  paths:\n    - /var/log/messages\n    - /var/log/*.log\n\n\n1\n2\n3\n4\n5\n\n\nä½å¶å®é¤äºåºæ¬ç paths éç½®å¤ï¼log input è¿æå¤§æ¦åå ä¸ªéç½®é¡¹éè¦æä»¬å³æ³¨ã\n\nè¿äºéç½®é¡¹æå¤æå°é½ä¼å½±åå° Filebeat çä½¿ç¨æ¹å¼ä»¥åæ§è½ãè½ç¶å¶é»è®¤å¼åºæ¬è¶³å¤æ¥å¸¸ä½¿ç¨ï¼ä½æ¯è¿æ¯éè¦æ·±å»çè§£æ¯ä¸ªéç½®é¡¹èåçå«ä¹ï¼è¿æ ·æè½å¤å¯¹å¶å®å¨ææ§ã\n\nåæ¶ï¼å¨ filebeat çæ¥å¸¸çº¿ä¸è¿ç»´ä¸­ï¼ä¹ä¼æ¶åå°è¿äºéç½®åæ°çè°èã\n\n\n# log input éç½®\n\n\n# paths\n\næä»¬å¯ä»¥æå®ä¸ç³»åç paths ä½ä¸ºä¿¡æ¯è¾å¥æºï¼å¨æå® path çæ¶åï¼æ³¨æä»¥ä¸è§åï¼\n\n 1. æå®çè·¯å¾å¿é¡»æ¯æä»¶ï¼ä¸è½æ¯ç®å½ã\n 2. æ¯æ Glob æ¨¡å¼ã\n 3. é»è®¤æ¯æéå½è·¯å¾ï¼å¦Â /**/Â å½¢å¼ï¼Filebeat å°ä¼å±å¼ 8 å±åµå¥ç®å½ã\n\n\n# Glob æ¨¡å¼\n\nGlob æ¨¡å¼æ¯æééç¬¦å¹éï¼ç®åæ¯æçè¯­æ³æï¼\n\nééç¬¦     è§£é            ç¤ºä¾            å¹é\n*       å¹éä»»ææ°ç®çä»»æå­ç¬¦   La*           Law, Lawyer\n?       å¹éä»»æçåå­ç¬¦      ?at           Cat, cat, Bat or bat\n[abc]   å¹éä¸ä¸ªå¨ä¸­æ¬å·çå­ç¬¦   [CB]at        Cat or Bat\n[a-z]   å¹éä¸ä¸ªæå®èå´çå­ç¬¦   Letter[0-9]   Letter0, Letter1, Letter2 up to Letter9\n\n\n# éå½ç Glob æ¨¡å¼\n\næ­¤å¤ï¼filebeat å¯¹ä¼ ç»ç Glob æ¨¡å¼è¿è¡äºæ©å±ï¼æ¯æç¨æ·æå®Â /**/Â æ¨¡å¼çè·¯å¾ï¼filebeat å¯ä»¥å°å¶å±å¼ä¸º 8 å±ç Glob è·¯å¾ã\n\nä¾å¦ï¼åå¦æå®äºÂ /home/data/**/my*.log, filebeat å°ä¼æÂ /**/Â ç¿»è¯æ 8 å±çå­ç®å½ï¼å¦ä¸ï¼\n\n/home/data/my*.log\n/home/data/*/my*.log\n/home/data/*/*/my*.log\n/home/data/*/*/*/my*.log\n/home/data/*/*/*/*/my*.log\n/home/data/*/*/*/*/*/my*.log\n/home/data/*/*/*/*/*/*/my*.log\n/home/data/*/*/*/*/*/*/*/my*.log\n/home/data/*/*/*/*/*/*/*/*/my*.log\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå ä¸ä¸å¸¦å­ç®å½ç Glob è·¯å¾ï¼ä¸å±ä¼æ 8 æ¡ Glob è·¯å¾ãè¿äºè·¯å¾é½ä¼ä½ä¸º input çè¾å¥æºè·¯å¾è¿è¡æç´¢ã\n\nä½æ¯å¨ä½¿ç¨çæ¶åéè¦æ³¨æï¼\n\n 1. filebeat å±å¼ä¸º 8 å±å­ç®å½çè§åï¼æ¯ç´æ¥ hardcode å¨ä»£ç ä¸­çï¼æ æ³éè¿éç½®ä¿®æ¹å¹éå±æ°\n 2. åªæ¯æåçº¯çÂ /**/Â æ¨¡å¼ï¼å¯¹äºÂ /data**/Â æ¨¡å¼ä¸æ¯æ\n 3. éå½æ¨¡å¼é»è®¤å¼å¯ï¼å¯éè¿Â recursive_glob.enabledÂ éç½®é¡¹å³é­\n\n\n# recursive_glob.enabled:\n\næ¯å¦å¼å¯éå½ç Glob æ¨¡å¼ï¼é»è®¤ä¸º trueã\n\n##encoding\n\næå®æ¥å¿ç¼ç ï¼é»è®¤æ¯ plainãå³ ASCII æ¨¡å¼\n\n\n# exclude_lines\n\nå¯æå®å¤ä¸ªæ­£åè¡¨è¾¾å¼ï¼æ¥å»é¤æäºä¸éè¦ä¸æ¥çè¡ãä¾å¦ï¼\n\nfilebeat.inputs:\n- type: log\n  ...\n  exclude_lines: ['^DBG']\n\n\n1\n2\n3\n4\n\n\nè¯¥éç½®å°ä¼å»é¤ä»¥Â DBGÂ å¼å¤´çè¡ã\n\n\n# include_lines\n\nå¯æå®å¤é¡¹æ­£åè¡¨è¾¾å¼ï¼æ¥ä»ä¸æ¥å¹éçè¡ãä¾å¦ï¼\n\nfilebeat.inputs:\n- type: log\n  ...\n  include_lines: ['^ERR', '^WARN']\n\n\n1\n2\n3\n4\n\n\nè¯¥éç½®å°ä¼ä»ä¸æ¥ä»¥Â ERRÂ åÂ WARNÂ å¼å¤´çè¡ã\n\né®é¢æ¥äºï¼å¦æåæ¶æå®äº exclude_lines å include_lines ä¼æä¹å¤çï¼\n\nå¯¹äºè¿ç§æåµï¼Filebeat å°ä¼åæ ¡éª include_linesï¼åæ ¡éª exclude_linesï¼å¶ä»£ç å®ç°å¦ä¸ï¼\n\nfunc (h *Harvester) shouldExportLine(line string) bool {\n    if len(h.config.IncludeLines) > 0 {\n        if !harvester.MatchAny(h.config.IncludeLines, line) {\n            // drop line\n            return false\n        }\n    }\n    if len(h.config.ExcludeLines) > 0 {\n        if harvester.MatchAny(h.config.ExcludeLines, line) {\n            return false\n        }\n    }\n\n    return true\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# exclude_files\n\nå¯æå®å¤ä¸ªæ­£åè¡¨è¾¾å¼ï¼å¹éå°çæä»¶åå°ä¸ä¼è¢«å¤çã\n\nä¾å¦:\n\nexclude_files: ['.gz$']\n\n\n1\n\n\nè¿ééè¦æ³¨æçæ¯ï¼ä¸ç®¡æ¯ exclude_filesï¼è¿æ¯ exclude_linesãinclude_lines, å£°ææ­£åçæ¶åï¼æå¥½ä½¿ç¨åå¼å·å¼ç¨æ­£åè¡¨è¾¾å¼ï¼ä¸è¦ç¨åå¼å·ãå¦å yaml ä¼æ¥è½¬ä¹é®é¢\n\n\n# harvester_buffer_size\n\nè¯»æä»¶æ¶ç buffer å¤§å°ï¼æç»ä¼åºç¨å¨ golang çÂ File.ReadÂ å½æ°ä¸é¢ã\n\nfunc (f *File) Read(b []byte) (n int, err error)\n\n\n1\n\n\né»è®¤æ¯ 16384ãå³ 16kã\n\n\n# max_bytes\n\nè¡¨ç¤ºä¸æ¡ log æ¶æ¯çæå¤§ bytes æ°ç®ãè¶è¿è¿ä¸ªå¤§å°ï¼å©ä½å°±ä¼è¢«æªæ­ã\né»è®¤å¼ä¸º 10485760(å³ 10MB)ã\n\n\n# multiline\n\nmultiline æ¯ä¸ºäºè§£å³éè¦å¤è¡èåå¨ä¸èµ·åéçæåµï¼ä¾å¦ Java Stack Traces ä¿¡æ¯ç­ã\nè½ç¶ filebeat é»è®¤ä¸å¼å¯ multilineï¼ä½æ¯å®æ¹çéç½®æä»¶ç»äºä¸ä¸ªä¾å­ï¼å¯ä»¥æ¯æ Java Stack Traces æèæ¯ C è¯­è¨å¼çæ¢è¡è¿ç»­ç¬¦Â \\, å¯å¨Â Examples of multiline configurationÂ ä¸­æ¥çã\n\nç±äºå¤§é¨ååºæ¯ä¸æ¶å multilineï¼æ¬æä¸åè¿è¡æ·±å¥è®¨è®ºãå³äº multiline éç½®çè¯¦ç»èµæå¯æ¥çå®æ¹ææ¡£ï¼\nhttps://www.elastic.co/guide/en/beats/filebeat/7.5/multiline-examples.html\n\n\n# ignore_older\n\nignore_older è¡¨ç¤ºå¯¹äºæè¿ä¿®æ¹æ¶é´è·ç¦»å½åæ¶é´å·²ç»è¶è¿æä¸ªæ¶é¿çæä»¶ï¼å°±ææ¶ä¸è¿è¡å¤çãé»è®¤å¼ä¸º 0ï¼è¡¨ç¤ºç¦ç¨è¯¥åè½ã\n\næ³¨æï¼ignore_older åªæ¯ææ¶ä¸å¤çè¯¥æä»¶ï¼å¹¶ä¸ä¼å¨ Registrar ä¸­æ¹åè¯¥æä»¶çç¶æã\n\nå¶ä»£ç å®ç°å¦ä¸ï¼\n\nfunc (p *Input) isIgnoreOlder(state file.State) bool {\n    // ignore_older is disable\n    if p.config.IgnoreOlder == 0 {\n        return false\n    }\n\n    modTime := state.Fileinfo.ModTime()\n    if time.Since(modTime) > p.config.IgnoreOlder {\n        return true\n    }\n\n    return false\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# close_* ç³»å\n\nlog input ä¸­æä¸ç³»åä»¥ close_å¼å¤´éç½®ï¼è¿äºéç½®å³å®äº Harvester ä½æ¶ç»æå¯¹æä»¶çè¯»åã\n\n 1. close_eof\n    å¦æè¯»åå°äº EOF(å³æä»¶æ«å°¾)ï¼æ¯å¦è¦ç»æè¯»åãå¦æä¸º trueï¼åè¯»åå°æä»¶æ«å°¾å°±ç»æè¯»åï¼å¦å Harvester å°ä¼ç»§ç»­å·¥ä½ãé»è®¤åªä¸º falseã\n 2. close_inactive\n    å¦æéç½®äº close_eof ä¸º falseï¼å Harvester å³ä½¿è¯»åå°äºæä»¶æ«å°¾ä¹ä¸ä¼ç»æ­¢ãclose_inactive å³å®äºæé¿æ²¡æè¯»å°æ°æ¶æ¯çæ¶é¿ï¼é»è®¤ä¸º 5m(å³äºåé)ãå¦æè¶è¿äº close_inactive è§å®çæ¶é´ä¾ç¶æ²¡ææ°æ¶æ¯ï¼å Harvester éåºã\n 3. close_timeout\n    å³å®äºä¸ä¸ª Harvester çæé¿å·¥ä½æ¶é´ï¼å¦æ Harvester å·¥ä½äºä¸æ®µæ¶é´åä¾ç¶æ²¡æåæ­¢ï¼åå¼ºè¡åæ­¢ Harvesterãé»è®¤ä¸º 0ï¼è¡¨ç¤ºä¸å¼ºè¡åæ­¢ Harvesterã\n 4. close_renamed\n    æä»¶æ´åæ¶æ¯å¦éåºï¼é»è®¤ä¸º falseãæä»¶æ´åä¸è¬åçå¨æ¥å¿è½®æ¿çåºæ¯ä¸ã\n 5. close_removed\n    è¡¨ç¤ºå½æä»¶è¢«å é¤æ¶ Harvester æ¯å¦è¦ç»§ç»­ãé»è®¤ä¸º trueï¼è¡¨ç¤ºå½æä»¶è¢«å é¤æ¶ï¼Harvester å³å»åæ­¢å·¥ä½ã\n\nä¸è¿å³ä½¿ Harvester å³é­äºä¹å³ç³»ä¸å¤§ãå ä¸ºæ ¹æ® filebeat ä¼å®æ¶æ«ææä»¶ï¼å¦æå³é­ååæäºæ°å¢åå®¹ï¼filebeat ä¾ç¶æ¯å¯ä»¥æ£æ¥åºæ¥çã\n\n\n# clean_* ç³»å\n\nclean_å¼å¤´çä¸ç³»åéç½®ç¨æ¥æ¸ç Registrar ä¸­çæä»¶ç¶æï¼åæ¶ä¹å¯ä»¥èµ·å°åå° Registrar æä»¶å¤§å°ãé²æ­¢ inode å¤ç¨ç­ä½ç¨ã\n\n 1. clean_inactive\n    è¡¨ç¤ºä¸ä¸ªæ¶é´æ®µãç¨äºç§»é¤å·²ç»ä¸é¿æ®µæ¶é´æ²¡ææ°äº§çåå®¹çæ¥å¿æä»¶ï¼é»è®¤ä¸º 0ï¼è¡¨ç¤ºç¦ç¨è¯¥åè½ã\n\n 2. clean_removed\n    å¨ Registrar ä¸­ç§»é¤é£äºå·²ç»ä¸å­å¨çæä»¶ãé»è®¤ä¸º trueï¼è¡¨ç¤ºå½æä»¶ä¸å­å¨æ¶ï¼åä» Registrar ä¸­ç§»é¤ã\n\n\n# scan_frequency\n\nä»£è¡¨ input çæ«æé¢çï¼é»è®¤ä¸º 10sã\ninput ä¼æç§æ­¤é¢çï¼å¯å¨å®æ¶å¨å®æ¶æ«æè·¯å¾ï¼ä»¥åç°æ°æä»¶åæä»¶çæ¹å¨æåµã\n\n\n# scan.sort å scan.order\n\nè¿ä¸¤ä¸ªéç½®é¡¹éè¦æ¾å¨ä¸èµ·è®²ã\nscan.sortÂ å¯åçå¼ä¸º: modtime å filenameãé»è®¤å¼ä¸ºç©ºï¼ä¸è¿è¡æåºã\nscan.orderÂ å¯åçå¼ä¸ºï¼asc å descãé»è®¤å¼ä¸º ascãscan.orderÂ ä»å¨Â scan.sortÂ éç©ºæ¶çæã\n\néè¦æ³¨æçæ¯ï¼è¯¥åè½ç®åä¸ºå®éªåè½ï¼å¯è½ä¼å¨ä»¥åçæ¬ç§»é¤ã\n\n\n# tail_files\n\né»è®¤æåµä¸ï¼Harvester å¤çæä»¶æ¶ï¼ä¼æä»¶å¤´å¼å§è¯»åæä»¶ãå¼å¯æ­¤åè½åï¼filebeat å°ç´æ¥ä¼ææä»¶ç offset ç½®å°æ«å°¾ï¼ä»æä»¶æ«å°¾çå¬æ¶æ¯ãé»è®¤å¼æ¯ falseã\n\næ³¨æï¼ å¼å¯äº tail_files, åæææä»¶ä¸­çå½ååå®¹å°ä¸ä¼è¢«ä¸æ¥ï¼åªææ°äº§çæ¶æ¯æ¶æä¼ä¸æ¥ã\n\nå¨çå®çå®ç°ä¸­ï¼tail_files è¢«å½åÂ ignore_older=1nsÂ å¤çãå æ­¤ï¼å¨å¯å¨çæ¶åï¼åªè¦æ¯æ°æä»¶ï¼éé¢çåå®¹é½ä¼è¢«å¿½ç¥ï¼ç´æ¥æ offset ç½®ä¸ºæä»¶æ«å°¾ã\n\næä»¥ä½¿ç¨è¯¥éç½®é¡¹æ¶åä¸è¦è°¨æï¼\n\n\n# harvester_limit\n\nharvester_limit å³å®äºä¸ä¸ª input æå¤åæ¶æå¤å°ä¸ª harvester å¯å¨ãé»è®¤ä¸º 0ï¼ä»£è¡¨ä¸å¯¹ harvester ä¸ªæ°è¿è¡éå¶ã\nå¨ä½¿ç¨æ¶è¦æ³¨æä¸¤ç¹ï¼\n\n 1. å¦æä¸ä¸ªæä»¶å¯¹åºç harvester å¨æ¬è½®æ«ææ¶æ²¡è½å¯å¨ï¼é£ä¼å¨ä¸æ¬¡æ«ææ¶ï¼æå¶ä»æä»¶ç harvester å®å¨éåºæ¶ï¼è¯¥æä»¶ç harvester æè½å¯å¨ã\n 2. harvester_limit ä»å¯¹éå¯¹éç½®ç input è¿è¡äºéå¶ï¼å¤ä¸ª input ä¹é´ç harvester_limit äºä¸å½±åã\n\n\n# symlinks\n\nä»£è¡¨æ¯å¦è¦å¯¹ç¬¦å·é¾æ¥è¿è¡å¤çï¼é»è®¤å¼ä¸º falseï¼ä»£è¡¨ä¸å¤çã\n\n\n# backoff ç¸å³éç½®\n\næä»¬ä¸æè®²å°Â close_eofÂ éé¡¹ï¼å½è¯»åå° eof æ¶ï¼ä¸ close_eof ä¸º falseï¼å Harvester è¿ä¼ä¸ç´å°è¯è¯»åæä»¶ã\n\nå¨è¿ç§æåµä¸ï¼Harvester ç»§ç»­è¯»åä¹åï¼å¶å® filebeat è¿ä¼ç­å¾ä¸æ®µæ¶é´ãç­å¾çæ¶é¿å°±æ¯ç±Â backoffãbackoff_factorÂ åÂ max_backoffÂ ä¸ä¸ªéç½®é¡¹å±åå³å®ã\n\nå¯¹åºçä»£ç å®ç°ä¸ºï¼\n\nfunc (f *Log) wait() {\n    // Wait before trying to read file again. File reached EOF.\n    select {\n    case <-f.done:\n        return\n    case <-time.After(f.backoff):\n    }\n\n    // Increment backoff up to maxBackoff\n    if f.backoff < f.config.MaxBackoff {\n        f.backoff = f.backoff * time.Duration(f.config.BackoffFactor)\n        if f.backoff > f.config.MaxBackoff {\n            f.backoff = f.config.MaxBackoff\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¶ä¸­ï¼backoffÂ é»è®¤å¼ä¸º 1s,Â backoff_factorÂ é»è®¤å¼ä¸º 2ï¼max_backoffÂ é»è®¤å¼ä¸º 10sã\n\nè¯¥éç½®é¡¹æå³çï¼å¦æè¯»å° EOFï¼å filebeat å°ä¼ç­å¾ä¸æ®µæ¶é´åå»è¯»æä»¶ã\nç­å¾æ¶é´å¼å§ä¸º 1sï¼å¦æä¸ç´æ¯ EOFï¼åä¼éæ¸å¢å¤§ç­å¾æ¶é´ï¼æ¯æ¬¡çç­å¾æ¶é´æ¯åä¸æ¬¡çä¸¤åï¼ä¸ä¸æ¬¡æé¿ç­å¾ 10sã\n\nåç»åÂ close_inactiveÂ éé¡¹ï¼å¦æç­å¾æ¶é´è¶è¿äºé»è®¤å¼ 5 åéï¼å Harvester ç»æã\n\næ­¤å¤ï¼å¦æç­å¾çæ¶åæä»¶åè¿½å äºæ°çæ°æ®ï¼å backoff å°ä¼éæ°ç½®ä¸ºåå§å¼ã\n\n\n# å¨å±éç½®\n\né¤äº log input ç¸å³çå±æ§å¤ï¼æä¸äºå¨å±å±æ§ä¹éè¦æä»¬æ³¨æã\n\n\n# queue ç¸å³éç½®\n\nfilebeat ä¼å° event ææ¶å­æ¾å¨ queue éé¢ãfilebeat ç queue ç®åæ mem å spool ä¸¤ç§å®ç°ï¼é»è®¤æ¯ memã\næ¬æåªä»ç»ä¸ mem çç¸å³éç½®é¡¹ã\n\nqueue:\n  mem:\n    events: 4096\n    flush.min_events: 2048\n    flush.timeout: 1s\n\n\n1\n2\n3\n4\n5\n\n\nevents ä»£è¡¨ queue æå¤è½å¤æ¿è½½ç event çä¸ªæ°ãå¦æä¸ªæ°è¾¾å°æå¤§å¼ï¼å input å°ä¸è½åå queue ä¸­æå¥æ°æ®ï¼ç´è³ output å°æ°æ®æ¶è´¹ã\n\nflush.min_eventsÂ ä»£è¡¨åªæ queue éé¢çæ°æ®å°è¾¾äºæå®ä¸ªæ°ï¼æå°æ°æ®åéç» outputãè®¾ä¸º 0 ä»£è¡¨ç´æ¥åéç» outputï¼ä¸è¿è¡ç­å¾ãé»è®¤å¼æ¯2048ã\n\nflush.timeoutÂ ä»£è¡¨å®æ¶å·æ° event å° output ä¸­ï¼å³ä½¿å¶ä¸ªæ°æ²¡æè¾¾å°Â flush.min_eventsãè¯¥éç½®é¡¹åªä¼å¨Â flush.min_eventsÂ å¤§äº 0 æ¶çæã\n\n\n# registry ç¸å³éç½®\n\n 1. filebeat.registry.path\n    å®å¶ registry æä»¶çç®å½ï¼é»è®¤å¼æ¯Â registryã\n\næ³¨æï¼è¿éæå®çåªæ¯ registry çç®å½ï¼æç»ç registry æä»¶çè·¯å¾ä¼æ¯è¿æ ·:\n\n${filebeat.registry.path}/filebeat/data.json\n\n\n1\n\n\n 2. filebeat.registry.flush\n    å° registry æä»¶åå®¹å®æ¶å·æ°å°ç£çä¸­ãé»è®¤ä¸º 0sï¼ä»£è¡¨æ¯æ¬¡æ´æ°æ¶ç´æ¥åæä»¶ã\n    éç½®äºè¯¥éé¡¹å¯ä»¥æé«äº filebeat çæ§è½ï¼é¿åé¢ç¹åç£çï¼ä½æ¯ä¹å¢å äºä¸å®æ°æ®ä¸¢å¤±çé£é©ã\n\n 3. filebeat.registry.file_permissions\n    é»è®¤ä¸º 0600ï¼å³åªææ¥æèå¯ä»¥è¯»åè¯¥ç¨æ·, å¶ä»ç¨æ·ä¸å¯ä»¥ä¿®æ¹ã\n\n\n# æ¥å¿ç¸å³éç½®\n\nfilebeat å¯ä»¥å¯¹è¾åºæ¥å¿çè¿è¡ç¸å³éç½®ï¼filebeat æä¾äºå¦ä¸æ¥å¿ç¸å³çéç½®:\n\nlogging.level: info # æ¥å¿è¾åºçæå°çº§å«\nlogging.selectors: [] # è¿æ»¤å¨ï¼ç¨æ·å¯å¨ logp.NewLogger æ¶æå®\nlogging.to_stderr: false # å°æ¥å¿è¾åºå° stderr\nlogging.to_syslog: false # å°æ¥å¿è¾åºå° syslog (ä¸»è¦ç¨äº unix)\nlogging.to_eventlog: false # å°æ¥å¿è¾åºå° windows ç event log\nlogging.to_files: true # å°æ¥å¿è¾åºå°æä»¶ä¸­\nlogging.files:\n    path: ${filebeat_bin_path}/logs/ # æ¥å¿ç®å½\n    name: filebeat  # æä»¶å filebeat filebeat.1 filebeat.2\n    rotateonstartup: true # å¨ filebeat å¯å¨æ¶è¿è¡æ¥å¿è½®æ¿\n    rotateeverybytes: 10485760 # = 10MB æ¥å¿è½®æ¿çé»è®¤å¼\n    keepfiles: 7 # æ¥å¿ä¿çä¸ªæ°\n    permissions: 0600 # æ¥å¿æé\n    interval: 0 # æ¥å¿è½®æ¿\nlogging.metrics.enabled: true\nlogging.metrics.period: 30s\nlogging.json: false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nfilebeat å¯ä»¥éæ©å°æ¥å¿è¾åºå°è®¸å¤å°æ¹ï¼å¨çº¿ä¸è¿è¥æ¶æä»¬å¸¸å¸¸ä¼å°æ¥å¿è¾åºå°æä»¶, æä»¥æ¥ä¸æ¥è®²ä¸æä»¶ç¸å³çéç½®ã\n\næä»¬å¯ä»¥éç½®æ¥å¿æä»¶çæå¨ç®å½ä»¥åæä»¶åï¼åå«å¯¹åºÂ logging.files.pathÂ åÂ logging.files.nameã\né»è®¤æåµä¸ï¼æ¥å¿çè¾åºç®å½æ¯å¨ filebeat ç bin æä»¶æå¨ç®å½ä¸ç logs æä»¶ã\n\nfilebeat ä¼è¿è¡æ¥å¿è½®æ¿ï¼ä¸è¬æåµä¸ï¼å¸¸è§çæ¥å¿è½®æ¿è§åææå¤§å°åææ¶é´ï¼filebeat ä¸¤ç§è§ååæ¯æã\nå¶ä¸­:\n\n 1. rotateeverybytesÂ å³å®äºæ¥å¿æä»¶çæå¤§å¼ï¼å¦ææ¥å¿æä»¶è¶è¿äºè¯¥å¼ï¼å°åçæ¥å¿è½®æ¿ï¼é»è®¤å¼ä¸º 10MBã\n 2. rotateonstartupÂ æ¯è¯´ææ¯å¦å¨æ¯æ¬¡å¯å¨æ¶é½è¿è¡ä¸æ¬¡æ¥å¿è½®æ¿ï¼è¿æ ·çè¯ï¼æ¯æ¬¡å¯å¨çæ¥å¿é½ä¼ä»ä¸ä¸ªæ°æä»¶å¼å§ãé»è®¤ä¸º true\n\nææä»¶å¤§å°è¿è¡è½®æ¿åï¼æ¥å¿æä»¶åå°ä¼åæ filebeatãfilebeat.1ãfilebeat.2 è¿ç§æ ¼å¼ï¼åç¼è¶å¤§æä»¶è¶æ§ã\n\nfilebeat ä¹æ¯æææ¶é´è¿è¡è½®æ¿ï¼å¯ä»¥éç½®Â logging.filesÂ ä¸ç interval å±æ§ï¼æ¯ææç§ç§ãåéãå°æ¶ãå¨ãæãå¹´è¿è¡è½®æ¿ï¼å¯¹åºå¼ä¸ºÂ 1s,1m,Â 1h,Â 24h,Â 7*24h,Â 30*24h, åÂ 365*24hãå½ç¶ï¼æå°å¼æ¯ 1sã\n\næç§æ¶é´è¿è¡è½®æ¿æ¶ï¼æ¶é´å°ä¼ä»¥è¿å­ç¬¦è¿è¡åå², ä¾å¦ï¼æç§ 1 å°æ¶è¿è¡è½®æ¿çè¯ï¼æä»¶æ ¼å¼ä¸ºï¼filebeat-2019-11-28-15ãfilebeat ç®åè¿ä¸æ¯ææ¥ææ ¼å¼çèªå®ä¹ã\n\nåæ¶ï¼æä»¬ä¹å¯ä»¥æå®æ¥å¿çä¿çç­ç¥ï¼ç®ååªè½éè¿è®¾ç½®Â keepfilesÂ æ¥å³å®ä¿çæ¥å¿çä¸ªæ°ã\n\nå¨æ¥å¿éé¢è¿æÂ logging.metricsÂ ç¸å³éç½®ï¼filebeat ä¼å®æ¶è¾åºä¸äºå½åçè¿è¡ææ ï¼ä¾å¦è¾åºä¸å½å ack æåçæ°ç®ãå½åçåå­å ç¨æåµç­ï¼\n\n * logging.metrics.enabledÂ å³å®æ¯å¦å¼å¯ææ æé\n * logging.metrics.periodÂ å³å®ææ è¾åºçé´é\n\n\n# ä½¿ç¨ç¯å¢åé\n\næä»¬å¯ä»¥å¨ä½¿ç¨éç½®æä»¶ä¸­ç´æ¥ä½¿ç¨ç¯å¢åéï¼ä½¿ç¨æ¹å¼å¦ä¸:\n\nfields:\n    env: ${ENV_NAME}\n\n\n1\n2\n\n\næä»¬å¯ä»¥ç´æ¥ç¨Â ${ENV_NAME}Â æ¥å¼ç¨ç³»ç»çç¯å¢åéã\né¤äºç´æ¥å¼ç¨å¤ï¼filebeat è¿æä¾äºä¸¤ä¸ªè¡¨è¾¾å¼éåä½¿ç¨:\n\n 1. ${VAR:default_value}ãå¦ææ²¡æç¯å¢åéÂ VAR, åä½¿ç¨é»è®¤å¼ default_value\n 2. ${VAR:?error_text}ãå¦ææ²¡æç¯å¢åéÂ VARï¼åæ¾ç¤ºéè¯¯æç¤ºÂ error_text\n\nfilebeat ä¹æ¯æå¨å¯å¨æ¶æå®å½ä»¤è¡åæ°æ¥æä¾ç¯å¢åé:Â -E name=${NAME}\n\n#ç¸å³éè¯»\n\n * Elastic-Filebeat å®ç°åæ\n\n\n# åè\n\n * https://www.elastic.co/guide/en/beats/filebeat/7.5/filebeat-input-log.html\n * https://github.com/elastic/beats/blob/7.5/filebeat/filebeat.reference.yml\n * https://en.wikipedia.org/wiki/Glob_(programming)\n * Use environment variables in the configuration | Filebeat Reference [8.6] | Elastic\n\nåæé¾æ¥ï¼Â https://www.cyhone.com/articles/usage-of-filebeat-log-config/",normalizedContent:"æ¬æä¸»è¦ä»ç» filebeat 7.5 çæ¬ä¸­ log ç¸å³çåä¸ªéç½®é¡¹çå«ä¹ä»¥åå¶åºç¨åºæ¯ã\n\nä¸è¬æåµä¸ï¼æä»¬ä½¿ç¨ log input çæ¹å¼å¦ä¸ï¼åªéè¦æå®ä¸ç³»å paths å³å¯ã\n\nfilebeat.inputs:\n- type: log\n  paths:\n    - /var/log/messages\n    - /var/log/*.log\n\n\n1\n2\n3\n4\n5\n\n\nä½å¶å®é¤äºåºæ¬ç paths éç½®å¤ï¼log input è¿æå¤§æ¦åå ä¸ªéç½®é¡¹éè¦æä»¬å³æ³¨ã\n\nè¿äºéç½®é¡¹æå¤æå°é½ä¼å½±åå° filebeat çä½¿ç¨æ¹å¼ä»¥åæ§è½ãè½ç¶å¶é»è®¤å¼åºæ¬è¶³å¤æ¥å¸¸ä½¿ç¨ï¼ä½æ¯è¿æ¯éè¦æ·±å»çè§£æ¯ä¸ªéç½®é¡¹èåçå«ä¹ï¼è¿æ ·æè½å¤å¯¹å¶å®å¨ææ§ã\n\nåæ¶ï¼å¨ filebeat çæ¥å¸¸çº¿ä¸è¿ç»´ä¸­ï¼ä¹ä¼æ¶åå°è¿äºéç½®åæ°çè°èã\n\n\n# log input éç½®\n\n\n# paths\n\næä»¬å¯ä»¥æå®ä¸ç³»åç paths ä½ä¸ºä¿¡æ¯è¾å¥æºï¼å¨æå® path çæ¶åï¼æ³¨æä»¥ä¸è§åï¼\n\n 1. æå®çè·¯å¾å¿é¡»æ¯æä»¶ï¼ä¸è½æ¯ç®å½ã\n 2. æ¯æ glob æ¨¡å¼ã\n 3. é»è®¤æ¯æéå½è·¯å¾ï¼å¦Â /**/Â å½¢å¼ï¼filebeat å°ä¼å±å¼ 8 å±åµå¥ç®å½ã\n\n\n# glob æ¨¡å¼\n\nglob æ¨¡å¼æ¯æééç¬¦å¹éï¼ç®åæ¯æçè¯­æ³æï¼\n\nééç¬¦     è§£é            ç¤ºä¾            å¹é\n*       å¹éä»»ææ°ç®çä»»æå­ç¬¦   la*           law, lawyer\n?       å¹éä»»æçåå­ç¬¦      ?at           cat, cat, bat or bat\n[abc]   å¹éä¸ä¸ªå¨ä¸­æ¬å·çå­ç¬¦   [cb]at        cat or bat\n[a-z]   å¹éä¸ä¸ªæå®èå´çå­ç¬¦   letter[0-9]   letter0, letter1, letter2 up to letter9\n\n\n# éå½ç glob æ¨¡å¼\n\næ­¤å¤ï¼filebeat å¯¹ä¼ ç»ç glob æ¨¡å¼è¿è¡äºæ©å±ï¼æ¯æç¨æ·æå®Â /**/Â æ¨¡å¼çè·¯å¾ï¼filebeat å¯ä»¥å°å¶å±å¼ä¸º 8 å±ç glob è·¯å¾ã\n\nä¾å¦ï¼åå¦æå®äºÂ /home/data/**/my*.log, filebeat å°ä¼æÂ /**/Â ç¿»è¯æ 8 å±çå­ç®å½ï¼å¦ä¸ï¼\n\n/home/data/my*.log\n/home/data/*/my*.log\n/home/data/*/*/my*.log\n/home/data/*/*/*/my*.log\n/home/data/*/*/*/*/my*.log\n/home/data/*/*/*/*/*/my*.log\n/home/data/*/*/*/*/*/*/my*.log\n/home/data/*/*/*/*/*/*/*/my*.log\n/home/data/*/*/*/*/*/*/*/*/my*.log\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå ä¸ä¸å¸¦å­ç®å½ç glob è·¯å¾ï¼ä¸å±ä¼æ 8 æ¡ glob è·¯å¾ãè¿äºè·¯å¾é½ä¼ä½ä¸º input çè¾å¥æºè·¯å¾è¿è¡æç´¢ã\n\nä½æ¯å¨ä½¿ç¨çæ¶åéè¦æ³¨æï¼\n\n 1. filebeat å±å¼ä¸º 8 å±å­ç®å½çè§åï¼æ¯ç´æ¥ hardcode å¨ä»£ç ä¸­çï¼æ æ³éè¿éç½®ä¿®æ¹å¹éå±æ°\n 2. åªæ¯æåçº¯çÂ /**/Â æ¨¡å¼ï¼å¯¹äºÂ /data**/Â æ¨¡å¼ä¸æ¯æ\n 3. éå½æ¨¡å¼é»è®¤å¼å¯ï¼å¯éè¿Â recursive_glob.enabledÂ éç½®é¡¹å³é­\n\n\n# recursive_glob.enabled:\n\næ¯å¦å¼å¯éå½ç glob æ¨¡å¼ï¼é»è®¤ä¸º trueã\n\n##encoding\n\næå®æ¥å¿ç¼ç ï¼é»è®¤æ¯ plainãå³ ascii æ¨¡å¼\n\n\n# exclude_lines\n\nå¯æå®å¤ä¸ªæ­£åè¡¨è¾¾å¼ï¼æ¥å»é¤æäºä¸éè¦ä¸æ¥çè¡ãä¾å¦ï¼\n\nfilebeat.inputs:\n- type: log\n  ...\n  exclude_lines: ['^dbg']\n\n\n1\n2\n3\n4\n\n\nè¯¥éç½®å°ä¼å»é¤ä»¥Â dbgÂ å¼å¤´çè¡ã\n\n\n# include_lines\n\nå¯æå®å¤é¡¹æ­£åè¡¨è¾¾å¼ï¼æ¥ä»ä¸æ¥å¹éçè¡ãä¾å¦ï¼\n\nfilebeat.inputs:\n- type: log\n  ...\n  include_lines: ['^err', '^warn']\n\n\n1\n2\n3\n4\n\n\nè¯¥éç½®å°ä¼ä»ä¸æ¥ä»¥Â errÂ åÂ warnÂ å¼å¤´çè¡ã\n\né®é¢æ¥äºï¼å¦æåæ¶æå®äº exclude_lines å include_lines ä¼æä¹å¤çï¼\n\nå¯¹äºè¿ç§æåµï¼filebeat å°ä¼åæ ¡éª include_linesï¼åæ ¡éª exclude_linesï¼å¶ä»£ç å®ç°å¦ä¸ï¼\n\nfunc (h *harvester) shouldexportline(line string) bool {\n    if len(h.config.includelines) > 0 {\n        if !harvester.matchany(h.config.includelines, line) {\n            // drop line\n            return false\n        }\n    }\n    if len(h.config.excludelines) > 0 {\n        if harvester.matchany(h.config.excludelines, line) {\n            return false\n        }\n    }\n\n    return true\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# exclude_files\n\nå¯æå®å¤ä¸ªæ­£åè¡¨è¾¾å¼ï¼å¹éå°çæä»¶åå°ä¸ä¼è¢«å¤çã\n\nä¾å¦:\n\nexclude_files: ['.gz$']\n\n\n1\n\n\nè¿ééè¦æ³¨æçæ¯ï¼ä¸ç®¡æ¯ exclude_filesï¼è¿æ¯ exclude_linesãinclude_lines, å£°ææ­£åçæ¶åï¼æå¥½ä½¿ç¨åå¼å·å¼ç¨æ­£åè¡¨è¾¾å¼ï¼ä¸è¦ç¨åå¼å·ãå¦å yaml ä¼æ¥è½¬ä¹é®é¢\n\n\n# harvester_buffer_size\n\nè¯»æä»¶æ¶ç buffer å¤§å°ï¼æç»ä¼åºç¨å¨ golang çÂ file.readÂ å½æ°ä¸é¢ã\n\nfunc (f *file) read(b []byte) (n int, err error)\n\n\n1\n\n\né»è®¤æ¯ 16384ãå³ 16kã\n\n\n# max_bytes\n\nè¡¨ç¤ºä¸æ¡ log æ¶æ¯çæå¤§ bytes æ°ç®ãè¶è¿è¿ä¸ªå¤§å°ï¼å©ä½å°±ä¼è¢«æªæ­ã\né»è®¤å¼ä¸º 10485760(å³ 10mb)ã\n\n\n# multiline\n\nmultiline æ¯ä¸ºäºè§£å³éè¦å¤è¡èåå¨ä¸èµ·åéçæåµï¼ä¾å¦ java stack traces ä¿¡æ¯ç­ã\nè½ç¶ filebeat é»è®¤ä¸å¼å¯ multilineï¼ä½æ¯å®æ¹çéç½®æä»¶ç»äºä¸ä¸ªä¾å­ï¼å¯ä»¥æ¯æ java stack traces æèæ¯ c è¯­è¨å¼çæ¢è¡è¿ç»­ç¬¦Â \\, å¯å¨Â examples of multiline configurationÂ ä¸­æ¥çã\n\nç±äºå¤§é¨ååºæ¯ä¸æ¶å multilineï¼æ¬æä¸åè¿è¡æ·±å¥è®¨è®ºãå³äº multiline éç½®çè¯¦ç»èµæå¯æ¥çå®æ¹ææ¡£ï¼\nhttps://www.elastic.co/guide/en/beats/filebeat/7.5/multiline-examples.html\n\n\n# ignore_older\n\nignore_older è¡¨ç¤ºå¯¹äºæè¿ä¿®æ¹æ¶é´è·ç¦»å½åæ¶é´å·²ç»è¶è¿æä¸ªæ¶é¿çæä»¶ï¼å°±ææ¶ä¸è¿è¡å¤çãé»è®¤å¼ä¸º 0ï¼è¡¨ç¤ºç¦ç¨è¯¥åè½ã\n\næ³¨æï¼ignore_older åªæ¯ææ¶ä¸å¤çè¯¥æä»¶ï¼å¹¶ä¸ä¼å¨ registrar ä¸­æ¹åè¯¥æä»¶çç¶æã\n\nå¶ä»£ç å®ç°å¦ä¸ï¼\n\nfunc (p *input) isignoreolder(state file.state) bool {\n    // ignore_older is disable\n    if p.config.ignoreolder == 0 {\n        return false\n    }\n\n    modtime := state.fileinfo.modtime()\n    if time.since(modtime) > p.config.ignoreolder {\n        return true\n    }\n\n    return false\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# close_* ç³»å\n\nlog input ä¸­æä¸ç³»åä»¥ close_å¼å¤´éç½®ï¼è¿äºéç½®å³å®äº harvester ä½æ¶ç»æå¯¹æä»¶çè¯»åã\n\n 1. close_eof\n    å¦æè¯»åå°äº eof(å³æä»¶æ«å°¾)ï¼æ¯å¦è¦ç»æè¯»åãå¦æä¸º trueï¼åè¯»åå°æä»¶æ«å°¾å°±ç»æè¯»åï¼å¦å harvester å°ä¼ç»§ç»­å·¥ä½ãé»è®¤åªä¸º falseã\n 2. close_inactive\n    å¦æéç½®äº close_eof ä¸º falseï¼å harvester å³ä½¿è¯»åå°äºæä»¶æ«å°¾ä¹ä¸ä¼ç»æ­¢ãclose_inactive å³å®äºæé¿æ²¡æè¯»å°æ°æ¶æ¯çæ¶é¿ï¼é»è®¤ä¸º 5m(å³äºåé)ãå¦æè¶è¿äº close_inactive è§å®çæ¶é´ä¾ç¶æ²¡ææ°æ¶æ¯ï¼å harvester éåºã\n 3. close_timeout\n    å³å®äºä¸ä¸ª harvester çæé¿å·¥ä½æ¶é´ï¼å¦æ harvester å·¥ä½äºä¸æ®µæ¶é´åä¾ç¶æ²¡æåæ­¢ï¼åå¼ºè¡åæ­¢ harvesterãé»è®¤ä¸º 0ï¼è¡¨ç¤ºä¸å¼ºè¡åæ­¢ harvesterã\n 4. close_renamed\n    æä»¶æ´åæ¶æ¯å¦éåºï¼é»è®¤ä¸º falseãæä»¶æ´åä¸è¬åçå¨æ¥å¿è½®æ¿çåºæ¯ä¸ã\n 5. close_removed\n    è¡¨ç¤ºå½æä»¶è¢«å é¤æ¶ harvester æ¯å¦è¦ç»§ç»­ãé»è®¤ä¸º trueï¼è¡¨ç¤ºå½æä»¶è¢«å é¤æ¶ï¼harvester å³å»åæ­¢å·¥ä½ã\n\nä¸è¿å³ä½¿ harvester å³é­äºä¹å³ç³»ä¸å¤§ãå ä¸ºæ ¹æ® filebeat ä¼å®æ¶æ«ææä»¶ï¼å¦æå³é­ååæäºæ°å¢åå®¹ï¼filebeat ä¾ç¶æ¯å¯ä»¥æ£æ¥åºæ¥çã\n\n\n# clean_* ç³»å\n\nclean_å¼å¤´çä¸ç³»åéç½®ç¨æ¥æ¸ç registrar ä¸­çæä»¶ç¶æï¼åæ¶ä¹å¯ä»¥èµ·å°åå° registrar æä»¶å¤§å°ãé²æ­¢ inode å¤ç¨ç­ä½ç¨ã\n\n 1. clean_inactive\n    è¡¨ç¤ºä¸ä¸ªæ¶é´æ®µãç¨äºç§»é¤å·²ç»ä¸é¿æ®µæ¶é´æ²¡ææ°äº§çåå®¹çæ¥å¿æä»¶ï¼é»è®¤ä¸º 0ï¼è¡¨ç¤ºç¦ç¨è¯¥åè½ã\n\n 2. clean_removed\n    å¨ registrar ä¸­ç§»é¤é£äºå·²ç»ä¸å­å¨çæä»¶ãé»è®¤ä¸º trueï¼è¡¨ç¤ºå½æä»¶ä¸å­å¨æ¶ï¼åä» registrar ä¸­ç§»é¤ã\n\n\n# scan_frequency\n\nä»£è¡¨ input çæ«æé¢çï¼é»è®¤ä¸º 10sã\ninput ä¼æç§æ­¤é¢çï¼å¯å¨å®æ¶å¨å®æ¶æ«æè·¯å¾ï¼ä»¥åç°æ°æä»¶åæä»¶çæ¹å¨æåµã\n\n\n# scan.sort å scan.order\n\nè¿ä¸¤ä¸ªéç½®é¡¹éè¦æ¾å¨ä¸èµ·è®²ã\nscan.sortÂ å¯åçå¼ä¸º: modtime å filenameãé»è®¤å¼ä¸ºç©ºï¼ä¸è¿è¡æåºã\nscan.orderÂ å¯åçå¼ä¸ºï¼asc å descãé»è®¤å¼ä¸º ascãscan.orderÂ ä»å¨Â scan.sortÂ éç©ºæ¶çæã\n\néè¦æ³¨æçæ¯ï¼è¯¥åè½ç®åä¸ºå®éªåè½ï¼å¯è½ä¼å¨ä»¥åçæ¬ç§»é¤ã\n\n\n# tail_files\n\né»è®¤æåµä¸ï¼harvester å¤çæä»¶æ¶ï¼ä¼æä»¶å¤´å¼å§è¯»åæä»¶ãå¼å¯æ­¤åè½åï¼filebeat å°ç´æ¥ä¼ææä»¶ç offset ç½®å°æ«å°¾ï¼ä»æä»¶æ«å°¾çå¬æ¶æ¯ãé»è®¤å¼æ¯ falseã\n\næ³¨æï¼ å¼å¯äº tail_files, åæææä»¶ä¸­çå½ååå®¹å°ä¸ä¼è¢«ä¸æ¥ï¼åªææ°äº§çæ¶æ¯æ¶æä¼ä¸æ¥ã\n\nå¨çå®çå®ç°ä¸­ï¼tail_files è¢«å½åÂ ignore_older=1nsÂ å¤çãå æ­¤ï¼å¨å¯å¨çæ¶åï¼åªè¦æ¯æ°æä»¶ï¼éé¢çåå®¹é½ä¼è¢«å¿½ç¥ï¼ç´æ¥æ offset ç½®ä¸ºæä»¶æ«å°¾ã\n\næä»¥ä½¿ç¨è¯¥éç½®é¡¹æ¶åä¸è¦è°¨æï¼\n\n\n# harvester_limit\n\nharvester_limit å³å®äºä¸ä¸ª input æå¤åæ¶æå¤å°ä¸ª harvester å¯å¨ãé»è®¤ä¸º 0ï¼ä»£è¡¨ä¸å¯¹ harvester ä¸ªæ°è¿è¡éå¶ã\nå¨ä½¿ç¨æ¶è¦æ³¨æä¸¤ç¹ï¼\n\n 1. å¦æä¸ä¸ªæä»¶å¯¹åºç harvester å¨æ¬è½®æ«ææ¶æ²¡è½å¯å¨ï¼é£ä¼å¨ä¸æ¬¡æ«ææ¶ï¼æå¶ä»æä»¶ç harvester å®å¨éåºæ¶ï¼è¯¥æä»¶ç harvester æè½å¯å¨ã\n 2. harvester_limit ä»å¯¹éå¯¹éç½®ç input è¿è¡äºéå¶ï¼å¤ä¸ª input ä¹é´ç harvester_limit äºä¸å½±åã\n\n\n# symlinks\n\nä»£è¡¨æ¯å¦è¦å¯¹ç¬¦å·é¾æ¥è¿è¡å¤çï¼é»è®¤å¼ä¸º falseï¼ä»£è¡¨ä¸å¤çã\n\n\n# backoff ç¸å³éç½®\n\næä»¬ä¸æè®²å°Â close_eofÂ éé¡¹ï¼å½è¯»åå° eof æ¶ï¼ä¸ close_eof ä¸º falseï¼å harvester è¿ä¼ä¸ç´å°è¯è¯»åæä»¶ã\n\nå¨è¿ç§æåµä¸ï¼harvester ç»§ç»­è¯»åä¹åï¼å¶å® filebeat è¿ä¼ç­å¾ä¸æ®µæ¶é´ãç­å¾çæ¶é¿å°±æ¯ç±Â backoffãbackoff_factorÂ åÂ max_backoffÂ ä¸ä¸ªéç½®é¡¹å±åå³å®ã\n\nå¯¹åºçä»£ç å®ç°ä¸ºï¼\n\nfunc (f *log) wait() {\n    // wait before trying to read file again. file reached eof.\n    select {\n    case <-f.done:\n        return\n    case <-time.after(f.backoff):\n    }\n\n    // increment backoff up to maxbackoff\n    if f.backoff < f.config.maxbackoff {\n        f.backoff = f.backoff * time.duration(f.config.backofffactor)\n        if f.backoff > f.config.maxbackoff {\n            f.backoff = f.config.maxbackoff\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nå¶ä¸­ï¼backoffÂ é»è®¤å¼ä¸º 1s,Â backoff_factorÂ é»è®¤å¼ä¸º 2ï¼max_backoffÂ é»è®¤å¼ä¸º 10sã\n\nè¯¥éç½®é¡¹æå³çï¼å¦æè¯»å° eofï¼å filebeat å°ä¼ç­å¾ä¸æ®µæ¶é´åå»è¯»æä»¶ã\nç­å¾æ¶é´å¼å§ä¸º 1sï¼å¦æä¸ç´æ¯ eofï¼åä¼éæ¸å¢å¤§ç­å¾æ¶é´ï¼æ¯æ¬¡çç­å¾æ¶é´æ¯åä¸æ¬¡çä¸¤åï¼ä¸ä¸æ¬¡æé¿ç­å¾ 10sã\n\nåç»åÂ close_inactiveÂ éé¡¹ï¼å¦æç­å¾æ¶é´è¶è¿äºé»è®¤å¼ 5 åéï¼å harvester ç»æã\n\næ­¤å¤ï¼å¦æç­å¾çæ¶åæä»¶åè¿½å äºæ°çæ°æ®ï¼å backoff å°ä¼éæ°ç½®ä¸ºåå§å¼ã\n\n\n# å¨å±éç½®\n\né¤äº log input ç¸å³çå±æ§å¤ï¼æä¸äºå¨å±å±æ§ä¹éè¦æä»¬æ³¨æã\n\n\n# queue ç¸å³éç½®\n\nfilebeat ä¼å° event ææ¶å­æ¾å¨ queue éé¢ãfilebeat ç queue ç®åæ mem å spool ä¸¤ç§å®ç°ï¼é»è®¤æ¯ memã\næ¬æåªä»ç»ä¸ mem çç¸å³éç½®é¡¹ã\n\nqueue:\n  mem:\n    events: 4096\n    flush.min_events: 2048\n    flush.timeout: 1s\n\n\n1\n2\n3\n4\n5\n\n\nevents ä»£è¡¨ queue æå¤è½å¤æ¿è½½ç event çä¸ªæ°ãå¦æä¸ªæ°è¾¾å°æå¤§å¼ï¼å input å°ä¸è½åå queue ä¸­æå¥æ°æ®ï¼ç´è³ output å°æ°æ®æ¶è´¹ã\n\nflush.min_eventsÂ ä»£è¡¨åªæ queue éé¢çæ°æ®å°è¾¾äºæå®ä¸ªæ°ï¼æå°æ°æ®åéç» outputãè®¾ä¸º 0 ä»£è¡¨ç´æ¥åéç» outputï¼ä¸è¿è¡ç­å¾ãé»è®¤å¼æ¯2048ã\n\nflush.timeoutÂ ä»£è¡¨å®æ¶å·æ° event å° output ä¸­ï¼å³ä½¿å¶ä¸ªæ°æ²¡æè¾¾å°Â flush.min_eventsãè¯¥éç½®é¡¹åªä¼å¨Â flush.min_eventsÂ å¤§äº 0 æ¶çæã\n\n\n# registry ç¸å³éç½®\n\n 1. filebeat.registry.path\n    å®å¶ registry æä»¶çç®å½ï¼é»è®¤å¼æ¯Â registryã\n\næ³¨æï¼è¿éæå®çåªæ¯ registry çç®å½ï¼æç»ç registry æä»¶çè·¯å¾ä¼æ¯è¿æ ·:\n\n${filebeat.registry.path}/filebeat/data.json\n\n\n1\n\n\n 2. filebeat.registry.flush\n    å° registry æä»¶åå®¹å®æ¶å·æ°å°ç£çä¸­ãé»è®¤ä¸º 0sï¼ä»£è¡¨æ¯æ¬¡æ´æ°æ¶ç´æ¥åæä»¶ã\n    éç½®äºè¯¥éé¡¹å¯ä»¥æé«äº filebeat çæ§è½ï¼é¿åé¢ç¹åç£çï¼ä½æ¯ä¹å¢å äºä¸å®æ°æ®ä¸¢å¤±çé£é©ã\n\n 3. filebeat.registry.file_permissions\n    é»è®¤ä¸º 0600ï¼å³åªææ¥æèå¯ä»¥è¯»åè¯¥ç¨æ·, å¶ä»ç¨æ·ä¸å¯ä»¥ä¿®æ¹ã\n\n\n# æ¥å¿ç¸å³éç½®\n\nfilebeat å¯ä»¥å¯¹è¾åºæ¥å¿çè¿è¡ç¸å³éç½®ï¼filebeat æä¾äºå¦ä¸æ¥å¿ç¸å³çéç½®:\n\nlogging.level: info # æ¥å¿è¾åºçæå°çº§å«\nlogging.selectors: [] # è¿æ»¤å¨ï¼ç¨æ·å¯å¨ logp.newlogger æ¶æå®\nlogging.to_stderr: false # å°æ¥å¿è¾åºå° stderr\nlogging.to_syslog: false # å°æ¥å¿è¾åºå° syslog (ä¸»è¦ç¨äº unix)\nlogging.to_eventlog: false # å°æ¥å¿è¾åºå° windows ç event log\nlogging.to_files: true # å°æ¥å¿è¾åºå°æä»¶ä¸­\nlogging.files:\n    path: ${filebeat_bin_path}/logs/ # æ¥å¿ç®å½\n    name: filebeat  # æä»¶å filebeat filebeat.1 filebeat.2\n    rotateonstartup: true # å¨ filebeat å¯å¨æ¶è¿è¡æ¥å¿è½®æ¿\n    rotateeverybytes: 10485760 # = 10mb æ¥å¿è½®æ¿çé»è®¤å¼\n    keepfiles: 7 # æ¥å¿ä¿çä¸ªæ°\n    permissions: 0600 # æ¥å¿æé\n    interval: 0 # æ¥å¿è½®æ¿\nlogging.metrics.enabled: true\nlogging.metrics.period: 30s\nlogging.json: false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nfilebeat å¯ä»¥éæ©å°æ¥å¿è¾åºå°è®¸å¤å°æ¹ï¼å¨çº¿ä¸è¿è¥æ¶æä»¬å¸¸å¸¸ä¼å°æ¥å¿è¾åºå°æä»¶, æä»¥æ¥ä¸æ¥è®²ä¸æä»¶ç¸å³çéç½®ã\n\næä»¬å¯ä»¥éç½®æ¥å¿æä»¶çæå¨ç®å½ä»¥åæä»¶åï¼åå«å¯¹åºÂ logging.files.pathÂ åÂ logging.files.nameã\né»è®¤æåµä¸ï¼æ¥å¿çè¾åºç®å½æ¯å¨ filebeat ç bin æä»¶æå¨ç®å½ä¸ç logs æä»¶ã\n\nfilebeat ä¼è¿è¡æ¥å¿è½®æ¿ï¼ä¸è¬æåµä¸ï¼å¸¸è§çæ¥å¿è½®æ¿è§åææå¤§å°åææ¶é´ï¼filebeat ä¸¤ç§è§ååæ¯æã\nå¶ä¸­:\n\n 1. rotateeverybytesÂ å³å®äºæ¥å¿æä»¶çæå¤§å¼ï¼å¦ææ¥å¿æä»¶è¶è¿äºè¯¥å¼ï¼å°åçæ¥å¿è½®æ¿ï¼é»è®¤å¼ä¸º 10mbã\n 2. rotateonstartupÂ æ¯è¯´ææ¯å¦å¨æ¯æ¬¡å¯å¨æ¶é½è¿è¡ä¸æ¬¡æ¥å¿è½®æ¿ï¼è¿æ ·çè¯ï¼æ¯æ¬¡å¯å¨çæ¥å¿é½ä¼ä»ä¸ä¸ªæ°æä»¶å¼å§ãé»è®¤ä¸º true\n\nææä»¶å¤§å°è¿è¡è½®æ¿åï¼æ¥å¿æä»¶åå°ä¼åæ filebeatãfilebeat.1ãfilebeat.2 è¿ç§æ ¼å¼ï¼åç¼è¶å¤§æä»¶è¶æ§ã\n\nfilebeat ä¹æ¯æææ¶é´è¿è¡è½®æ¿ï¼å¯ä»¥éç½®Â logging.filesÂ ä¸ç interval å±æ§ï¼æ¯ææç§ç§ãåéãå°æ¶ãå¨ãæãå¹´è¿è¡è½®æ¿ï¼å¯¹åºå¼ä¸ºÂ 1s,1m,Â 1h,Â 24h,Â 7*24h,Â 30*24h, åÂ 365*24hãå½ç¶ï¼æå°å¼æ¯ 1sã\n\næç§æ¶é´è¿è¡è½®æ¿æ¶ï¼æ¶é´å°ä¼ä»¥è¿å­ç¬¦è¿è¡åå², ä¾å¦ï¼æç§ 1 å°æ¶è¿è¡è½®æ¿çè¯ï¼æä»¶æ ¼å¼ä¸ºï¼filebeat-2019-11-28-15ãfilebeat ç®åè¿ä¸æ¯ææ¥ææ ¼å¼çèªå®ä¹ã\n\nåæ¶ï¼æä»¬ä¹å¯ä»¥æå®æ¥å¿çä¿çç­ç¥ï¼ç®ååªè½éè¿è®¾ç½®Â keepfilesÂ æ¥å³å®ä¿çæ¥å¿çä¸ªæ°ã\n\nå¨æ¥å¿éé¢è¿æÂ logging.metricsÂ ç¸å³éç½®ï¼filebeat ä¼å®æ¶è¾åºä¸äºå½åçè¿è¡ææ ï¼ä¾å¦è¾åºä¸å½å ack æåçæ°ç®ãå½åçåå­å ç¨æåµç­ï¼\n\n * logging.metrics.enabledÂ å³å®æ¯å¦å¼å¯ææ æé\n * logging.metrics.periodÂ å³å®ææ è¾åºçé´é\n\n\n# ä½¿ç¨ç¯å¢åé\n\næä»¬å¯ä»¥å¨ä½¿ç¨éç½®æä»¶ä¸­ç´æ¥ä½¿ç¨ç¯å¢åéï¼ä½¿ç¨æ¹å¼å¦ä¸:\n\nfields:\n    env: ${env_name}\n\n\n1\n2\n\n\næä»¬å¯ä»¥ç´æ¥ç¨Â ${env_name}Â æ¥å¼ç¨ç³»ç»çç¯å¢åéã\né¤äºç´æ¥å¼ç¨å¤ï¼filebeat è¿æä¾äºä¸¤ä¸ªè¡¨è¾¾å¼éåä½¿ç¨:\n\n 1. ${var:default_value}ãå¦ææ²¡æç¯å¢åéÂ var, åä½¿ç¨é»è®¤å¼ default_value\n 2. ${var:?error_text}ãå¦ææ²¡æç¯å¢åéÂ varï¼åæ¾ç¤ºéè¯¯æç¤ºÂ error_text\n\nfilebeat ä¹æ¯æå¨å¯å¨æ¶æå®å½ä»¤è¡åæ°æ¥æä¾ç¯å¢åé:Â -e name=${name}\n\n#ç¸å³éè¯»\n\n * elastic-filebeat å®ç°åæ\n\n\n# åè\n\n * https://www.elastic.co/guide/en/beats/filebeat/7.5/filebeat-input-log.html\n * https://github.com/elastic/beats/blob/7.5/filebeat/filebeat.reference.yml\n * https://en.wikipedia.org/wiki/glob_(programming)\n * use environment variables in the configuration | filebeat reference [8.6] | elastic\n\nåæé¾æ¥ï¼Â https://www.cyhone.com/articles/usage-of-filebeat-log-config/",charsets:{cjk:!0}},{title:"jenkinså®¹å¨å®è£",frontmatter:{title:"jenkinså®¹å¨å®è£",date:"2022-12-15T14:01:31.000Z",permalink:"/pages/ce2b89/",categories:["ä¸é¢","jenkins"],tags:[null],readingShow:"top",description:"FROM jenkins/jenkins:2.332.3",meta:[{name:"twitter:title",content:"jenkinså®¹å¨å®è£"},{name:"twitter:description",content:"FROM jenkins/jenkins:2.332.3"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/04.jenkins/01.jenkins%E5%AE%B9%E5%99%A8%E5%AE%89%E8%A3%85.html"},{property:"og:type",content:"article"},{property:"og:title",content:"jenkinså®¹å¨å®è£"},{property:"og:description",content:"FROM jenkins/jenkins:2.332.3"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/04.jenkins/01.jenkins%E5%AE%B9%E5%99%A8%E5%AE%89%E8%A3%85.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:01:31.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"jenkinså®¹å¨å®è£"},{itemprop:"description",content:"FROM jenkins/jenkins:2.332.3"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/04.jenkins/01.jenkins%E5%AE%B9%E5%99%A8%E5%AE%89%E8%A3%85.html",relativePath:"01.ä¸é¢/04.jenkins/01.jenkinså®¹å¨å®è£.md",key:"v-b8800ef2",path:"/pages/ce2b89/",headersStr:null,content:"# å®è£çdockerfile\n\nFROM jenkins/jenkins:2.332.3\n\nUSER root\nRUN echo '' > /etc/apt/sources.list \\\n&& echo \"deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye main contrib non-free\" > /etc/apt/sources.list \\\n&& echo \"deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-updates main contrib non-free\" >> /etc/apt/sources.list \\\n&& echo \"deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-backports main contrib non-free\" >> /etc/apt/sources.list \\\n&& echo \"deb http://mirrors.tuna.tsinghua.edu.cn/debian-security bullseye-security main contrib non-free\" >> /etc/apt/sources.list \\\n&& apt update \\\n&& apt install sudo -y \\\n&& apt install vim -y \\\n&& apt install sshpass -y \\\n&& apt install python -y \\\n&& sed -i '27a\\jenkins ALL=(ALL)       NOPASSWD:ALL' /etc/sudoers\nUSER jenkins\nENV LANG C.UTF-8\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# docker-composeæä»¶\n\nversion: '3'\nservices:\n  jenkins:\n    image: di.zzppjj.top/library/jenkins:v6\n    container_name: jenkins\n    restart: always\n    ports:\n      - '8000:8080'\n      - '50000:50000'\n    environment:\n      JAVA_OPTS: -Duser.timezone=Asia/Shanghai\n    extra_hosts:\n      - \"di.zzppjj.top:172.16.30.215\"\n    volumes:\n      - /data/jenkins/jenkins_home:/var/jenkins_home\n      - /etc/localtime:/etc/localtime:ro\n      - /var/run/docker.sock:/var/run/docker.sock\n      - /usr/bin/docker:/usr/bin/docker  \n      - /data:/data\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n",normalizedContent:"# å®è£çdockerfile\n\nfrom jenkins/jenkins:2.332.3\n\nuser root\nrun echo '' > /etc/apt/sources.list \\\n&& echo \"deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye main contrib non-free\" > /etc/apt/sources.list \\\n&& echo \"deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-updates main contrib non-free\" >> /etc/apt/sources.list \\\n&& echo \"deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-backports main contrib non-free\" >> /etc/apt/sources.list \\\n&& echo \"deb http://mirrors.tuna.tsinghua.edu.cn/debian-security bullseye-security main contrib non-free\" >> /etc/apt/sources.list \\\n&& apt update \\\n&& apt install sudo -y \\\n&& apt install vim -y \\\n&& apt install sshpass -y \\\n&& apt install python -y \\\n&& sed -i '27a\\jenkins all=(all)       nopasswd:all' /etc/sudoers\nuser jenkins\nenv lang c.utf-8\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# docker-composeæä»¶\n\nversion: '3'\nservices:\n  jenkins:\n    image: di.zzppjj.top/library/jenkins:v6\n    container_name: jenkins\n    restart: always\n    ports:\n      - '8000:8080'\n      - '50000:50000'\n    environment:\n      java_opts: -duser.timezone=asia/shanghai\n    extra_hosts:\n      - \"di.zzppjj.top:172.16.30.215\"\n    volumes:\n      - /data/jenkins/jenkins_home:/var/jenkins_home\n      - /etc/localtime:/etc/localtime:ro\n      - /var/run/docker.sock:/var/run/docker.sock\n      - /usr/bin/docker:/usr/bin/docker  \n      - /data:/data\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n",charsets:{cjk:!0}},{title:"jenkinsæµæ°´çº¿é¨ç½²",frontmatter:{title:"jenkinsæµæ°´çº¿é¨ç½²",date:"2023-01-06T14:41:01.000Z",permalink:"/pages/a9ff44/",categories:["ä¸é¢","jenkins"],tags:[null],readingShow:"top",description:"tar -zcf scrmwebphp_business.tar.gz $(ls php.sh | grep -vE \"bizshow|cms\")\n                        tar -zcf scrmwebphp_bizshow.tar.gz $(ls php.sh | grep \"bizshow\")\n                        tar -zcf scrmwebphp_cms.tar.gz $(ls php.sh | grep \"cms\")\n                        '''\n                    }catch(exc) {\n                        env.Reason = \"æåæä»¶åºé\"\n                        throw(exc)\n                    }\n                }\n            }\n        }\n        stage('æ·è´') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'cp_business'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasfronted.yml', sudoUser: null, tags: 'cp'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'cp_go'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend01.yml', sudoUser: null, tags: 'cp-saas-backend01'\n            }\n        }\n        stage('é¨ç½²goæå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'scrm_go'\n            }\n        }\n        stage('é¨ç½²webphpbusinessæå¡') {\n            parallel{\n                stage('é¨ç½²backendæå¡') {\n                    steps {\n                        ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'scrmwebphp_business'\n                    }\n                }\n                stage('é¨ç½²backend01æå¡') {\n                    steps {\n                        ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend01.yml', sudoUser: null, tags: 'scrm_backend01'\n                    }\n                }\n            }\n        }\n        // stage('é¨ç½²webphpbusinessæå¡') {\n        //     steps {\n        //         ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'scrmwebphp_business'\n        //         ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend01.yml', sudoUser: null, tags: 'scrm_backend01'\n        //     }\n        // }\n        stage('é¨ç½²web_adminæå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasfronted.yml', sudoUser: null, tags: 'scrmwebadmin'\n            }\n        }\n        stage('é¨ç½²web_h5æå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasfronted.yml', sudoUser: null, tags: 'scrmwebh5'\n            }\n        }",meta:[{name:"twitter:title",content:"jenkinsæµæ°´çº¿é¨ç½²"},{name:"twitter:description",content:"tar -zcf scrmwebphp_business.tar.gz $(ls php.sh | grep -vE \"bizshow|cms\")\n                        tar -zcf scrmwebphp_bizshow.tar.gz $(ls php.sh | grep \"bizshow\")\n                        tar -zcf scrmwebphp_cms.tar.gz $(ls php.sh | grep \"cms\")\n                        '''\n                    }catch(exc) {\n                        env.Reason = \"æåæä»¶åºé\"\n                        throw(exc)\n                    }\n                }\n            }\n        }\n        stage('æ·è´') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'cp_business'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasfronted.yml', sudoUser: null, tags: 'cp'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'cp_go'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend01.yml', sudoUser: null, tags: 'cp-saas-backend01'\n            }\n        }\n        stage('é¨ç½²goæå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'scrm_go'\n            }\n        }\n        stage('é¨ç½²webphpbusinessæå¡') {\n            parallel{\n                stage('é¨ç½²backendæå¡') {\n                    steps {\n                        ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'scrmwebphp_business'\n                    }\n                }\n                stage('é¨ç½²backend01æå¡') {\n                    steps {\n                        ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend01.yml', sudoUser: null, tags: 'scrm_backend01'\n                    }\n                }\n            }\n        }\n        // stage('é¨ç½²webphpbusinessæå¡') {\n        //     steps {\n        //         ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'scrmwebphp_business'\n        //         ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend01.yml', sudoUser: null, tags: 'scrm_backend01'\n        //     }\n        // }\n        stage('é¨ç½²web_adminæå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasfronted.yml', sudoUser: null, tags: 'scrmwebadmin'\n            }\n        }\n        stage('é¨ç½²web_h5æå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasfronted.yml', sudoUser: null, tags: 'scrmwebh5'\n            }\n        }"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/04.jenkins/02.jenkins%E6%B5%81%E6%B0%B4%E7%BA%BF%E9%83%A8%E7%BD%B2.html"},{property:"og:type",content:"article"},{property:"og:title",content:"jenkinsæµæ°´çº¿é¨ç½²"},{property:"og:description",content:"tar -zcf scrmwebphp_business.tar.gz $(ls php.sh | grep -vE \"bizshow|cms\")\n                        tar -zcf scrmwebphp_bizshow.tar.gz $(ls php.sh | grep \"bizshow\")\n                        tar -zcf scrmwebphp_cms.tar.gz $(ls php.sh | grep \"cms\")\n                        '''\n                    }catch(exc) {\n                        env.Reason = \"æåæä»¶åºé\"\n                        throw(exc)\n                    }\n                }\n            }\n        }\n        stage('æ·è´') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'cp_business'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasfronted.yml', sudoUser: null, tags: 'cp'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'cp_go'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend01.yml', sudoUser: null, tags: 'cp-saas-backend01'\n            }\n        }\n        stage('é¨ç½²goæå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'scrm_go'\n            }\n        }\n        stage('é¨ç½²webphpbusinessæå¡') {\n            parallel{\n                stage('é¨ç½²backendæå¡') {\n                    steps {\n                        ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'scrmwebphp_business'\n                    }\n                }\n                stage('é¨ç½²backend01æå¡') {\n                    steps {\n                        ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend01.yml', sudoUser: null, tags: 'scrm_backend01'\n                    }\n                }\n            }\n        }\n        // stage('é¨ç½²webphpbusinessæå¡') {\n        //     steps {\n        //         ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'scrmwebphp_business'\n        //         ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend01.yml', sudoUser: null, tags: 'scrm_backend01'\n        //     }\n        // }\n        stage('é¨ç½²web_adminæå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasfronted.yml', sudoUser: null, tags: 'scrmwebadmin'\n            }\n        }\n        stage('é¨ç½²web_h5æå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasfronted.yml', sudoUser: null, tags: 'scrmwebh5'\n            }\n        }"},{property:"og:url",content:"https://blog.zzppjj.top/01.%E4%B8%93%E9%A2%98/04.jenkins/02.jenkins%E6%B5%81%E6%B0%B4%E7%BA%BF%E9%83%A8%E7%BD%B2.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-06T14:41:01.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"jenkinsæµæ°´çº¿é¨ç½²"},{itemprop:"description",content:"tar -zcf scrmwebphp_business.tar.gz $(ls php.sh | grep -vE \"bizshow|cms\")\n                        tar -zcf scrmwebphp_bizshow.tar.gz $(ls php.sh | grep \"bizshow\")\n                        tar -zcf scrmwebphp_cms.tar.gz $(ls php.sh | grep \"cms\")\n                        '''\n                    }catch(exc) {\n                        env.Reason = \"æåæä»¶åºé\"\n                        throw(exc)\n                    }\n                }\n            }\n        }\n        stage('æ·è´') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'cp_business'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasfronted.yml', sudoUser: null, tags: 'cp'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'cp_go'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend01.yml', sudoUser: null, tags: 'cp-saas-backend01'\n            }\n        }\n        stage('é¨ç½²goæå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'scrm_go'\n            }\n        }\n        stage('é¨ç½²webphpbusinessæå¡') {\n            parallel{\n                stage('é¨ç½²backendæå¡') {\n                    steps {\n                        ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'scrmwebphp_business'\n                    }\n                }\n                stage('é¨ç½²backend01æå¡') {\n                    steps {\n                        ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend01.yml', sudoUser: null, tags: 'scrm_backend01'\n                    }\n                }\n            }\n        }\n        // stage('é¨ç½²webphpbusinessæå¡') {\n        //     steps {\n        //         ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend.yml', sudoUser: null, tags: 'scrmwebphp_business'\n        //         ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasbackend01.yml', sudoUser: null, tags: 'scrm_backend01'\n        //     }\n        // }\n        stage('é¨ç½²web_adminæå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasfronted.yml', sudoUser: null, tags: 'scrmwebadmin'\n            }\n        }\n        stage('é¨ç½²web_h5æå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploypro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkinshome/ansible/hosts', playbook: '/var/jenkinshome/ansible/saas/saasfronted.yml', sudoUser: null, tags: 'scrmwebh5'\n            }\n        }"}]},regularPath:"/01.%E4%B8%93%E9%A2%98/04.jenkins/02.jenkins%E6%B5%81%E6%B0%B4%E7%BA%BF%E9%83%A8%E7%BD%B2.html",relativePath:"01.ä¸é¢/04.jenkins/02.jenkinsæµæ°´çº¿é¨ç½².md",key:"v-9066c126",path:"/pages/a9ff44/",headers:[{level:4,title:"jenkinsfileæä»¶",slug:"jenkinsfileæä»¶",normalizedTitle:"jenkinsfileæä»¶",charIndex:2},{level:4,title:"ansible-playbookå§æ¬",slug:"ansible-playbookå§æ¬",normalizedTitle:"ansible-playbookå§æ¬",charIndex:10701}],headersStr:"jenkinsfileæä»¶ ansible-playbookå§æ¬",content:"# jenkinsfileæä»¶\n\npipeline {\n    agent any\n    environment {       \n        DB_SYS_PASSWORD=credentials('saas_pro_dbpasswd')\n        DATABASE_PWD=credentials('saas_pro_dbpasswd')\n        REDIS_PWD=credentials('saas_pro_redisspwd')\n        VUE_CATEGORY_ID='8'\n        PRODUCT_CATEGORY_YUN='8'\n        PRODUCT_CATEGORY='5,6'\n    }\n    parameters {\n        string(name: 'version_number', defaultValue: '', description: '')\n        string(name: 'product_code', defaultValue: 'saas', description: '')\n        string(name: 'DATABASE_USER', defaultValue: 'saas_user', description: '')\n        string(name: 'DATABASE_HOST', defaultValue: 'tcp://xx:3306', description: '')\n        string(name: 'REDIS_HOST', defaultValue: 'xx:6379', description: '')\n        choice choices: ['å¦', 'æ¯'], description: 'bizshowåcmsæ¯å¦é¨ç½²', name: 'bizshow_cms_deploy'\n    }\n    stages {\n        stage('æåèæ¬') {\n            steps {\n                dir(\"/var/jenkins_home/script\"){\n                    script {\n                        try {\n                            checkout(\n                                [$class: 'GitSCM', doGenerateSubmoduleConfigurations: false, submoduleCfg: [], extensions: [[$class: 'CloneOption', depth: 1, noTags: false, reference: '', shallow: true]],\n                                branches: [[name: \"master\"]],userRemoteConfigs: [[url: \"ssh://git@xx:2224/rdito/yw_db.git\"]]]\n                            )\n                        }catch(exc) {\n                            env.REASON = \"æåèæ¬åºé\"\n                            throw(exc)\n                        }\n                    }\n                }\n            }\n        }\n        stage('æåansibleå§æ¬') {\n            steps {\n                dir(\"/var/jenkins_home/ansible\"){\n                    script {\n                        try {\n                            checkout(\n                                [$class: 'GitSCM', doGenerateSubmoduleConfigurations: false, submoduleCfg: [], extensions: [[$class: 'CloneOption', depth: 1, noTags: false, reference: '', shallow: true]],\n                                branches: [[name: \"master\"]],userRemoteConfigs: [[url: \"ssh://git@xx:2224/rdito/ansible.git\"]]]\n                            )\n                        }catch(exc) {\n                            env.REASON = \"æåansibleå§æ¬åºé\"\n                            throw(exc)\n                        }\n                    }\n                }\n            }\n        }\n        stage('çæé¨ç½²æä»¶') {\n            steps {\n                sh label: '', script: '/var/jenkins_home/script/saas/php_deploy1.sh scrm.web_php_business'\n                sh label: '', script: '/var/jenkins_home/script/saas/go_deploy.sh'\n                sh label: '', script: '/var/jenkins_home/script/saas/h5_deploy.sh scrm.web_admin'\n                sh label: '', script: '/var/jenkins_home/script/saas/h5_deploy.sh scrm.web_h5'\n                sh label: '', script: '/var/jenkins_home/script/saas/h5_deploy.sh web_h5_bizshow'\n                sh label: '', script: '/var/jenkins_home/script/saas/php_deploy1.sh web_php_bizshow'\n                sh label: '', script: '/var/jenkins_home/script/saas/php_deploy1.sh web_php_cms'\n            }\n        }\n        stage('æå') {\n            steps {\n                script{\n                    try{\n                        sh '''        \n                        cd \"$WORKSPACE\"\n                        chmod +x *.sh\n                        tar -zcf scrm_web_php_business.tar.gz $(ls *php*.sh | grep -vE \"bizshow|cms\")\n                        tar -zcf scrm_web_php_bizshow.tar.gz $(ls *php*.sh | grep \"bizshow\")\n                        tar -zcf scrm_web_php_cms.tar.gz $(ls *php*.sh | grep \"cms\")\n                        '''\n                    }catch(exc) {\n                        env.Reason = \"æåæä»¶åºé\"\n                        throw(exc)\n                    }\n                }\n            }\n        }\n        stage('æ·è´') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend.yml', sudoUser: null, tags: 'cp_business'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_fronted.yml', sudoUser: null, tags: 'cp'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend.yml', sudoUser: null, tags: 'cp_go'               \n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend01.yml', sudoUser: null, tags: 'cp-saas-backend01'\n            }\n        }\n        stage('é¨ç½²goæå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend.yml', sudoUser: null, tags: 'scrm_go'\n            }\n        }\n        stage('é¨ç½²web_php_businessæå¡') {\n            parallel{\n                stage('é¨ç½²backendæå¡') {\n                    steps {\n                        ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend.yml', sudoUser: null, tags: 'scrm_web_php_business'\n                    }\n                }\n                stage('é¨ç½²backend01æå¡') {\n                    steps {\n                        ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend01.yml', sudoUser: null, tags: 'scrm_backend01'\n                    }\n                }                \n            }\n        }\n        // stage('é¨ç½²web_php_businessæå¡') {\n        //     steps {\n        //         ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend.yml', sudoUser: null, tags: 'scrm_web_php_business'\n        //         ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend01.yml', sudoUser: null, tags: 'scrm_backend01'\n        //     }\n        // }\n        stage('é¨ç½²web_adminæå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_fronted.yml', sudoUser: null, tags: 'scrm_web_admin'\n            }\n        }\n        stage('é¨ç½²web_h5æå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_fronted.yml', sudoUser: null, tags: 'scrm_web_h5'\n            }\n        }\n\n        stage('é¨ç½²web_h5_bizshowæå¡') {\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_fronted.yml', sudoUser: null, tags: 'scrm_web_h5_bizshow'\n            }\n        }\n\n        stage('é¨ç½²web_php_bizshowæå¡') {\n            when {\n                expression { params.bizshow_cms_deploy == 'æ¯'}\n            }\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend_bizshow.yml', sudoUser: null, tags: 'cp_bizshow'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend_bizshow.yml', sudoUser: null, tags: 'scrm_web_php_bizshow'\n            }\n        }\n\n        stage('é¨ç½²web_php_cmsæå¡') {\n            when {\n                expression { params.bizshow_cms_deploy == 'æ¯'}\n            }\n            steps {\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend_cms.yml', sudoUser: null, tags: 'cp_cms'\n                ansiblePlaybook become: true, becomeUser: 'admin', credentialsId: 'deploy_pro', extras: '--extra-vars \"WORKSPACE=${WORKSPACE}\"', disableHostKeyChecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend_cms.yml', sudoUser: null, tags: 'scrm_web_php_cms'\n            }\n        }\n\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n\n\n# ansible-playbookå§æ¬\n\n---\n- hosts: saas_dev\n  remote_user: admin\n  gather_facts: false\n  become: yes\n  vars:\n    filename: /var/jenkins_home/workspace/saas/scrm.web_php_bizshow/*php*.sh\n    filename1: /var/jenkins_home/workspace/saas/scrm.web_php_cms/*php*.sh\n  tasks:\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°testæå¡å¨ä¸\"\n      copy:\n        src: \"{{ item }}\"\n        dest: \"/opt/apps/saas_docker/scrm_web_php_bizshow/\"\n        owner: admin\n        group: admin\n        mode: 0755\n      with_fileglob:\n        - \"{{ filename }}\"\n      tags:\n        - cp_bizshow\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°testæå¡å¨ä¸\"\n      copy:\n        src: \"{{ item }}\"\n        dest: \"/opt/apps/saas_docker/scrm_web_php_cms/\"\n        owner: admin\n        group: admin\n        mode: 0755\n      with_fileglob:\n        - \"{{ filename1 }}\"\n      tags:\n        - cp_cms\n    - name: \"åå»ºè¿ç¨ä¸»æºä¸çé¨ç½²ç®å½\"\n      file: path=/opt/apps/saas_docker/{{sub_dir}} state=directory\n      tags: create_dir\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°web_php_businessæå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - {src: \"/var/jenkins_home/workspace/saas/scrm.web_php_business/web_php_business.sh\",dest: \"/opt/apps/saas_docker/scrm_web_php_business/\"}\n      tags:\n        - cp_php_business\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°web_adminæå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - {src: \"/var/jenkins_home/workspace/saas/scrm.web_admin/web_admin.sh\",dest: \"/opt/apps/saas_docker/scrm_web_admin/\"}\n      tags:\n        - cp_web_admin\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°devæå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - {src: \"/var/jenkins_home/workspace/saas/scrm.web_h5/web_h5.sh\",dest: \"/opt/apps/saas_docker/scrm_web_h5/\"}\n      tags:\n        - cp_web_h5\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°devæå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - {src: \"/var/jenkins_home/workspace/saas/scrm.web_h5_bizshow/h5_bizshow_deploy.sh\",dest: \"/opt/apps/saas_docker/scrm_web_h5_bizshow/\"}\n      tags:\n        - cp_web_h5_bizshow\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°devæå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - {src: \"/var/jenkins_home/workspace/saas/scrm.web_php_bizshow/php_bizshow_deploy.sh\",dest: \"/opt/apps/saas_docker/scrm_web_php_bizshow/\"}\n      tags:\n        - cp_php_bizshow\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°devæå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - { src: \"/var/jenkins_home/workspace/saas/scrm.web_php_cms/php_cms_deploy.sh\",dest: \"/opt/apps/saas_docker/scrm_web_php_cms/\" }\n      tags:\n        - cp_php_cms\n    - name: \"Execute the scrm_web_php_business script\"\n      shell: cd /opt/apps/saas_docker/scrm_web_php_business && ./web_php_business.sh\n      tags:\n        - scrm_web_php_business\n    - name: \"Execute the scrm_web_php_bizshow script\"\n      shell: cd /opt/apps/saas_docker/scrm_web_php_bizshow && ./php_bizshow_deploy.sh\n      tags:\n        - scrm_web_php_bizshow\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°saas-backend01æå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - {src: \"{{ WORKSPACE }}/scrm_web_php_GAOYINIBM.sh\",dest: \"/opt/apps/saas_docker/scrm_web_php_GAOYINIBM/\"}\n      tags:\n        - cp-saas-backend01\n    - name: \"Execute the script\"\n      shell: |\n        /home/admin/script/init.sh stop \n        cd /opt/apps/saas_docker/scrm_web_php_GAOYINIBM && chmod +x scrm_web_php_GAOYINIBM.sh && ./scrm_web_php_GAOYINIBM.sh\n        /home/admin/script/init.sh start\n      tags:\n        - scrm_backend01\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n",normalizedContent:"# jenkinsfileæä»¶\n\npipeline {\n    agent any\n    environment {       \n        db_sys_password=credentials('saas_pro_dbpasswd')\n        database_pwd=credentials('saas_pro_dbpasswd')\n        redis_pwd=credentials('saas_pro_redisspwd')\n        vue_category_id='8'\n        product_category_yun='8'\n        product_category='5,6'\n    }\n    parameters {\n        string(name: 'version_number', defaultvalue: '', description: '')\n        string(name: 'product_code', defaultvalue: 'saas', description: '')\n        string(name: 'database_user', defaultvalue: 'saas_user', description: '')\n        string(name: 'database_host', defaultvalue: 'tcp://xx:3306', description: '')\n        string(name: 'redis_host', defaultvalue: 'xx:6379', description: '')\n        choice choices: ['å¦', 'æ¯'], description: 'bizshowåcmsæ¯å¦é¨ç½²', name: 'bizshow_cms_deploy'\n    }\n    stages {\n        stage('æåèæ¬') {\n            steps {\n                dir(\"/var/jenkins_home/script\"){\n                    script {\n                        try {\n                            checkout(\n                                [$class: 'gitscm', dogeneratesubmoduleconfigurations: false, submodulecfg: [], extensions: [[$class: 'cloneoption', depth: 1, notags: false, reference: '', shallow: true]],\n                                branches: [[name: \"master\"]],userremoteconfigs: [[url: \"ssh://git@xx:2224/rdito/yw_db.git\"]]]\n                            )\n                        }catch(exc) {\n                            env.reason = \"æåèæ¬åºé\"\n                            throw(exc)\n                        }\n                    }\n                }\n            }\n        }\n        stage('æåansibleå§æ¬') {\n            steps {\n                dir(\"/var/jenkins_home/ansible\"){\n                    script {\n                        try {\n                            checkout(\n                                [$class: 'gitscm', dogeneratesubmoduleconfigurations: false, submodulecfg: [], extensions: [[$class: 'cloneoption', depth: 1, notags: false, reference: '', shallow: true]],\n                                branches: [[name: \"master\"]],userremoteconfigs: [[url: \"ssh://git@xx:2224/rdito/ansible.git\"]]]\n                            )\n                        }catch(exc) {\n                            env.reason = \"æåansibleå§æ¬åºé\"\n                            throw(exc)\n                        }\n                    }\n                }\n            }\n        }\n        stage('çæé¨ç½²æä»¶') {\n            steps {\n                sh label: '', script: '/var/jenkins_home/script/saas/php_deploy1.sh scrm.web_php_business'\n                sh label: '', script: '/var/jenkins_home/script/saas/go_deploy.sh'\n                sh label: '', script: '/var/jenkins_home/script/saas/h5_deploy.sh scrm.web_admin'\n                sh label: '', script: '/var/jenkins_home/script/saas/h5_deploy.sh scrm.web_h5'\n                sh label: '', script: '/var/jenkins_home/script/saas/h5_deploy.sh web_h5_bizshow'\n                sh label: '', script: '/var/jenkins_home/script/saas/php_deploy1.sh web_php_bizshow'\n                sh label: '', script: '/var/jenkins_home/script/saas/php_deploy1.sh web_php_cms'\n            }\n        }\n        stage('æå') {\n            steps {\n                script{\n                    try{\n                        sh '''        \n                        cd \"$workspace\"\n                        chmod +x *.sh\n                        tar -zcf scrm_web_php_business.tar.gz $(ls *php*.sh | grep -ve \"bizshow|cms\")\n                        tar -zcf scrm_web_php_bizshow.tar.gz $(ls *php*.sh | grep \"bizshow\")\n                        tar -zcf scrm_web_php_cms.tar.gz $(ls *php*.sh | grep \"cms\")\n                        '''\n                    }catch(exc) {\n                        env.reason = \"æåæä»¶åºé\"\n                        throw(exc)\n                    }\n                }\n            }\n        }\n        stage('æ·è´') {\n            steps {\n                ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend.yml', sudouser: null, tags: 'cp_business'\n                ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_fronted.yml', sudouser: null, tags: 'cp'\n                ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend.yml', sudouser: null, tags: 'cp_go'               \n                ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend01.yml', sudouser: null, tags: 'cp-saas-backend01'\n            }\n        }\n        stage('é¨ç½²goæå¡') {\n            steps {\n                ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend.yml', sudouser: null, tags: 'scrm_go'\n            }\n        }\n        stage('é¨ç½²web_php_businessæå¡') {\n            parallel{\n                stage('é¨ç½²backendæå¡') {\n                    steps {\n                        ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend.yml', sudouser: null, tags: 'scrm_web_php_business'\n                    }\n                }\n                stage('é¨ç½²backend01æå¡') {\n                    steps {\n                        ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend01.yml', sudouser: null, tags: 'scrm_backend01'\n                    }\n                }                \n            }\n        }\n        // stage('é¨ç½²web_php_businessæå¡') {\n        //     steps {\n        //         ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend.yml', sudouser: null, tags: 'scrm_web_php_business'\n        //         ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend01.yml', sudouser: null, tags: 'scrm_backend01'\n        //     }\n        // }\n        stage('é¨ç½²web_adminæå¡') {\n            steps {\n                ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_fronted.yml', sudouser: null, tags: 'scrm_web_admin'\n            }\n        }\n        stage('é¨ç½²web_h5æå¡') {\n            steps {\n                ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_fronted.yml', sudouser: null, tags: 'scrm_web_h5'\n            }\n        }\n\n        stage('é¨ç½²web_h5_bizshowæå¡') {\n            steps {\n                ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_fronted.yml', sudouser: null, tags: 'scrm_web_h5_bizshow'\n            }\n        }\n\n        stage('é¨ç½²web_php_bizshowæå¡') {\n            when {\n                expression { params.bizshow_cms_deploy == 'æ¯'}\n            }\n            steps {\n                ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend_bizshow.yml', sudouser: null, tags: 'cp_bizshow'\n                ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend_bizshow.yml', sudouser: null, tags: 'scrm_web_php_bizshow'\n            }\n        }\n\n        stage('é¨ç½²web_php_cmsæå¡') {\n            when {\n                expression { params.bizshow_cms_deploy == 'æ¯'}\n            }\n            steps {\n                ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend_cms.yml', sudouser: null, tags: 'cp_cms'\n                ansibleplaybook become: true, becomeuser: 'admin', credentialsid: 'deploy_pro', extras: '--extra-vars \"workspace=${workspace}\"', disablehostkeychecking: true, inventory: '/var/jenkins_home/ansible/hosts', playbook: '/var/jenkins_home/ansible/saas/saas_backend_cms.yml', sudouser: null, tags: 'scrm_web_php_cms'\n            }\n        }\n\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n\n\n# ansible-playbookå§æ¬\n\n---\n- hosts: saas_dev\n  remote_user: admin\n  gather_facts: false\n  become: yes\n  vars:\n    filename: /var/jenkins_home/workspace/saas/scrm.web_php_bizshow/*php*.sh\n    filename1: /var/jenkins_home/workspace/saas/scrm.web_php_cms/*php*.sh\n  tasks:\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°testæå¡å¨ä¸\"\n      copy:\n        src: \"{{ item }}\"\n        dest: \"/opt/apps/saas_docker/scrm_web_php_bizshow/\"\n        owner: admin\n        group: admin\n        mode: 0755\n      with_fileglob:\n        - \"{{ filename }}\"\n      tags:\n        - cp_bizshow\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°testæå¡å¨ä¸\"\n      copy:\n        src: \"{{ item }}\"\n        dest: \"/opt/apps/saas_docker/scrm_web_php_cms/\"\n        owner: admin\n        group: admin\n        mode: 0755\n      with_fileglob:\n        - \"{{ filename1 }}\"\n      tags:\n        - cp_cms\n    - name: \"åå»ºè¿ç¨ä¸»æºä¸çé¨ç½²ç®å½\"\n      file: path=/opt/apps/saas_docker/{{sub_dir}} state=directory\n      tags: create_dir\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°web_php_businessæå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - {src: \"/var/jenkins_home/workspace/saas/scrm.web_php_business/web_php_business.sh\",dest: \"/opt/apps/saas_docker/scrm_web_php_business/\"}\n      tags:\n        - cp_php_business\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°web_adminæå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - {src: \"/var/jenkins_home/workspace/saas/scrm.web_admin/web_admin.sh\",dest: \"/opt/apps/saas_docker/scrm_web_admin/\"}\n      tags:\n        - cp_web_admin\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°devæå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - {src: \"/var/jenkins_home/workspace/saas/scrm.web_h5/web_h5.sh\",dest: \"/opt/apps/saas_docker/scrm_web_h5/\"}\n      tags:\n        - cp_web_h5\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°devæå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - {src: \"/var/jenkins_home/workspace/saas/scrm.web_h5_bizshow/h5_bizshow_deploy.sh\",dest: \"/opt/apps/saas_docker/scrm_web_h5_bizshow/\"}\n      tags:\n        - cp_web_h5_bizshow\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°devæå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - {src: \"/var/jenkins_home/workspace/saas/scrm.web_php_bizshow/php_bizshow_deploy.sh\",dest: \"/opt/apps/saas_docker/scrm_web_php_bizshow/\"}\n      tags:\n        - cp_php_bizshow\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°devæå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - { src: \"/var/jenkins_home/workspace/saas/scrm.web_php_cms/php_cms_deploy.sh\",dest: \"/opt/apps/saas_docker/scrm_web_php_cms/\" }\n      tags:\n        - cp_php_cms\n    - name: \"execute the scrm_web_php_business script\"\n      shell: cd /opt/apps/saas_docker/scrm_web_php_business && ./web_php_business.sh\n      tags:\n        - scrm_web_php_business\n    - name: \"execute the scrm_web_php_bizshow script\"\n      shell: cd /opt/apps/saas_docker/scrm_web_php_bizshow && ./php_bizshow_deploy.sh\n      tags:\n        - scrm_web_php_bizshow\n    - name: \"å¤å¶ä¸»æºä¸çæä»¶å°saas-backend01æå¡å¨ä¸\"\n      copy:\n        src: \"{{item.src}}\"\n        dest: \"{{item.dest}}\"\n        owner: admin\n        group: admin\n        mode: 0700\n      with_items:\n        - {src: \"{{ workspace }}/scrm_web_php_gaoyinibm.sh\",dest: \"/opt/apps/saas_docker/scrm_web_php_gaoyinibm/\"}\n      tags:\n        - cp-saas-backend01\n    - name: \"execute the script\"\n      shell: |\n        /home/admin/script/init.sh stop \n        cd /opt/apps/saas_docker/scrm_web_php_gaoyinibm && chmod +x scrm_web_php_gaoyinibm.sh && ./scrm_web_php_gaoyinibm.sh\n        /home/admin/script/init.sh start\n      tags:\n        - scrm_backend01\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n",charsets:{cjk:!0}},{title:"å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯",frontmatter:{title:"å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯",date:"2020-01-06T14:28:22.000Z",categories:"éç¬",tags:["é¢è¯é¢é"],permalink:"/pages/0cd089/",readingShow:"top",description:"å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯â¦ ",meta:[{name:"twitter:title",content:"å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯"},{name:"twitter:description",content:"å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯â¦ "},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/02.%E5%A6%82%E6%9E%9C%E9%9D%A2%E8%AF%95%E6%97%B6%E5%A4%A7%E5%AE%B6%E9%83%BD%E8%AF%B4%E7%9C%9F%E8%AF%9D.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯"},{property:"og:description",content:"å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯â¦ "},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/02.%E5%A6%82%E6%9E%9C%E9%9D%A2%E8%AF%95%E6%97%B6%E5%A4%A7%E5%AE%B6%E9%83%BD%E8%AF%B4%E7%9C%9F%E8%AF%9D.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2020-01-06T14:28:22.000Z"},{property:"article:tag",content:"é¢è¯é¢é"},{itemprop:"name",content:"å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯"},{itemprop:"description",content:"å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯â¦ "}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/02.%E5%A6%82%E6%9E%9C%E9%9D%A2%E8%AF%95%E6%97%B6%E5%A4%A7%E5%AE%B6%E9%83%BD%E8%AF%B4%E7%9C%9F%E8%AF%9D.html",relativePath:"02.çæ´»/01.éç¬/02.å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯.md",key:"v-5aabcc3a",path:"/pages/0cd089/",headersStr:null,content:"**å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯â¦ **\n\n**é¢è¯å®ï¼**ä½ å¥½ï¼è¿æ¯ä½ é¢è¯çç¬¬ä¸å®¶å¬å¸åï¼\n\n**ç¨åºåå°çï¼**å½ç¶ä¸æ¯å¦ï¼é¢äº30å¤å®¶ï¼é½ä¸è¦æã\n\n**é¢è¯å®ï¼**å¦å¦å¦ï¼æ²¡äºï¼æä»¬é¢è¯äº50å¤ä¸ªï¼1ä¸ªé½ä¸æ¿ææ¥å¢ãä½ ç®åä¸åç5å¹´Javaå¼åç»éªâ¦\n\n**ç¨åºåå°çï¼**å¤§å­¦ç¼ç¨è®¾è®¡ä¹ç®è¿å»äºï¼å¨é åå­¦æåæ°´ï¼å®éä¸å·¥ä½ä¸å°3å¹´â¦\n\n**é¢è¯å®ï¼**æ¾åä¸ä¸»å¯¼åä¸çº§ä»¥ä¸ç¨æ·çä¸­å¤§åé¡¹ç®ç åâ¦\n\n**ç¨åºåå°çï¼**ä¹åå¬å¸è´è´£ä¸ä¸ªæ¿åºå¤åé¡¹ç®ï¼ææäºä¸ä¸ç¹å¿æè§â¦\n\n**é¢è¯å®ï¼**ç²¾éJAVA/JavaScriptï¼çç»ææ¡IOï¼å¤çº¿ç¨ãéåç­åºç¡ç±»åºï¼çæå¸¸è§è®¾è®¡æ¨¡å¼ï¼çædubboä»¥ådubboçæå¡æ²»çï¼ç²¾éSpringãMyBatisç­æµè¡å¼æºæ¡æ¶ï¼æé«å¹¶åé«æµéäºèç½åå¸å¼å¼åç»éªï¼çææ°æ®åºåçåå¸¸ç¨æ§è½ä¼åææ¯â¦\n\n**ç¨åºåå°çï¼**é½æ¯å¹çï¼ç¥éä¸ç¹å¿ï¼ä¹å°±æ§è½ä¼åç¨å¾®äºè§£ç¹å¿ã\n\n**é¢è¯å®ï¼**é£å°±å¥½ï¼åæä¸è·³ï¼è¿äºä½ è¦æ¯é½ç²¾éï¼æä»¬è¯å®è¦ä¸èµ·ï¼\n\næä»¬å¬å¸æè¿æç®åä¸ªçµåappé¡¹ç®ï¼ç±»ä¼¼æ·å®é£ç§ï¼é£ä½ å°±è®²è®²æ§è½ä¼åç¸å³å§ã\n\n**ç¨åºåå°çï¼**æ§è½ä¼åæ¶åå°çæ¯æ¹æ¹é¢é¢ï¼ä»åºç¡ä»£ç æ§è½ä¼åï¼å°JVMæ·±åº¦è°ä¼ãè®¾è®¡æ¨¡å¼ä¼åï¼åå°æ°æ®åºè°ä¼ãå¹¶åç¼ç¨æ§è½ä¼åï¼è¿äºæè½ç¶æ²¡ç¨è¿ï¼ä½æ¯é½å¬è¿ï¼å·¥ä½ä¸­ä¸è¾¹ç¾åº¦ï¼ä¸è¾¹Googleï¼å¤§é½å¯ä»¥è§£å³çï¼\n\n**é¢è¯å®ï¼**å¤çå¤çgoodåï¼ï¼ï¼é£è°è°èªèµï¼ä½ ææèªèµ\n\næ¯å¤å°ï¼\n\n**ç¨åºåå°çï¼**æææèªèµåç25Kï¼ä½7Kä¹å¯ä»¥å¹²ï¼å°±æ¯ä¼å·æãé±å¤ç¹ï¼å¹²æ´»å°±å¤å¿«ç¹ï¼\n\n**é¢è¯å®ï¼**Hmmmï¼æä»¬åçæ¯15~30Kï¼å®éä¸æå¤åªç»å°10Kï¼æ¢ç¶ä½ æ°´å¹³æéï¼é£æå°±å¤§æ¹ç¹ç»å°8Kï¼ä½æ¯è¦ç»å¸¸å ç­å¦ï¼\n\n**ç¨åºåå°çï¼**å¯ä»¥çï¼åæ­£å ç­æä¹æ¯æ¸é±¼ï¼\n\n**é¢è¯å®ï¼**è¡å§ï¼æå¤©å°±æ¥ä¸ç­å§ï¼\n\n**ç¨åºåå°çï¼**å¥½åï¼",normalizedContent:"**å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯â¦ **\n\n**é¢è¯å®ï¼**ä½ å¥½ï¼è¿æ¯ä½ é¢è¯çç¬¬ä¸å®¶å¬å¸åï¼\n\n**ç¨åºåå°çï¼**å½ç¶ä¸æ¯å¦ï¼é¢äº30å¤å®¶ï¼é½ä¸è¦æã\n\n**é¢è¯å®ï¼**å¦å¦å¦ï¼æ²¡äºï¼æä»¬é¢è¯äº50å¤ä¸ªï¼1ä¸ªé½ä¸æ¿ææ¥å¢ãä½ ç®åä¸åç5å¹´javaå¼åç»éªâ¦\n\n**ç¨åºåå°çï¼**å¤§å­¦ç¼ç¨è®¾è®¡ä¹ç®è¿å»äºï¼å¨é åå­¦æåæ°´ï¼å®éä¸å·¥ä½ä¸å°3å¹´â¦\n\n**é¢è¯å®ï¼**æ¾åä¸ä¸»å¯¼åä¸çº§ä»¥ä¸ç¨æ·çä¸­å¤§åé¡¹ç®ç åâ¦\n\n**ç¨åºåå°çï¼**ä¹åå¬å¸è´è´£ä¸ä¸ªæ¿åºå¤åé¡¹ç®ï¼ææäºä¸ä¸ç¹å¿æè§â¦\n\n**é¢è¯å®ï¼**ç²¾éjava/javascriptï¼çç»ææ¡ioï¼å¤çº¿ç¨ãéåç­åºç¡ç±»åºï¼çæå¸¸è§è®¾è®¡æ¨¡å¼ï¼çædubboä»¥ådubboçæå¡æ²»çï¼ç²¾éspringãmybatisç­æµè¡å¼æºæ¡æ¶ï¼æé«å¹¶åé«æµéäºèç½åå¸å¼å¼åç»éªï¼çææ°æ®åºåçåå¸¸ç¨æ§è½ä¼åææ¯â¦\n\n**ç¨åºåå°çï¼**é½æ¯å¹çï¼ç¥éä¸ç¹å¿ï¼ä¹å°±æ§è½ä¼åç¨å¾®äºè§£ç¹å¿ã\n\n**é¢è¯å®ï¼**é£å°±å¥½ï¼åæä¸è·³ï¼è¿äºä½ è¦æ¯é½ç²¾éï¼æä»¬è¯å®è¦ä¸èµ·ï¼\n\næä»¬å¬å¸æè¿æç®åä¸ªçµåappé¡¹ç®ï¼ç±»ä¼¼æ·å®é£ç§ï¼é£ä½ å°±è®²è®²æ§è½ä¼åç¸å³å§ã\n\n**ç¨åºåå°çï¼**æ§è½ä¼åæ¶åå°çæ¯æ¹æ¹é¢é¢ï¼ä»åºç¡ä»£ç æ§è½ä¼åï¼å°jvmæ·±åº¦è°ä¼ãè®¾è®¡æ¨¡å¼ä¼åï¼åå°æ°æ®åºè°ä¼ãå¹¶åç¼ç¨æ§è½ä¼åï¼è¿äºæè½ç¶æ²¡ç¨è¿ï¼ä½æ¯é½å¬è¿ï¼å·¥ä½ä¸­ä¸è¾¹ç¾åº¦ï¼ä¸è¾¹googleï¼å¤§é½å¯ä»¥è§£å³çï¼\n\n**é¢è¯å®ï¼**å¤çå¤çgoodåï¼ï¼ï¼é£è°è°èªèµï¼ä½ ææèªèµ\n\næ¯å¤å°ï¼\n\n**ç¨åºåå°çï¼**æææèªèµåç25kï¼ä½7kä¹å¯ä»¥å¹²ï¼å°±æ¯ä¼å·æãé±å¤ç¹ï¼å¹²æ´»å°±å¤å¿«ç¹ï¼\n\n**é¢è¯å®ï¼**hmmmï¼æä»¬åçæ¯15~30kï¼å®éä¸æå¤åªç»å°10kï¼æ¢ç¶ä½ æ°´å¹³æéï¼é£æå°±å¤§æ¹ç¹ç»å°8kï¼ä½æ¯è¦ç»å¸¸å ç­å¦ï¼\n\n**ç¨åºåå°çï¼**å¯ä»¥çï¼åæ­£å ç­æä¹æ¯æ¸é±¼ï¼\n\n**é¢è¯å®ï¼**è¡å§ï¼æå¤©å°±æ¥ä¸ç­å§ï¼\n\n**ç¨åºåå°çï¼**å¥½åï¼",charsets:{cjk:!0}},{title:"ç·äººå¿æºæççä¹å¤§è¡¨ç°",frontmatter:{title:"ç·äººå¿æºæççä¹å¤§è¡¨ç°",categories:"éç¬",tags:["éç¬"],date:"2022-12-09T20:46:02.000Z",permalink:"/pages/aa6ada/",readingShow:"top",description:"æå½ãå©å§»æ³ãè§å®ï¼ç»å©å¹´é¾ï¼ç·ä¸å¾æ©äº22å¨å²ï¼å¥³ä¸å¾æ©äº20å¨å²ã",meta:[{name:"twitter:title",content:"ç·äººå¿æºæççä¹å¤§è¡¨ç°"},{name:"twitter:description",content:"æå½ãå©å§»æ³ãè§å®ï¼ç»å©å¹´é¾ï¼ç·ä¸å¾æ©äº22å¨å²ï¼å¥³ä¸å¾æ©äº20å¨å²ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/01.%E7%94%B7%E4%BA%BA%E5%BF%83%E6%99%BA%E6%88%90%E7%86%9F%E7%9A%84%E4%B9%9D%E5%A4%A7%E8%A1%A8%E7%8E%B0.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ç·äººå¿æºæççä¹å¤§è¡¨ç°"},{property:"og:description",content:"æå½ãå©å§»æ³ãè§å®ï¼ç»å©å¹´é¾ï¼ç·ä¸å¾æ©äº22å¨å²ï¼å¥³ä¸å¾æ©äº20å¨å²ã"},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/01.%E7%94%B7%E4%BA%BA%E5%BF%83%E6%99%BA%E6%88%90%E7%86%9F%E7%9A%84%E4%B9%9D%E5%A4%A7%E8%A1%A8%E7%8E%B0.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:46:02.000Z"},{property:"article:tag",content:"éç¬"},{itemprop:"name",content:"ç·äººå¿æºæççä¹å¤§è¡¨ç°"},{itemprop:"description",content:"æå½ãå©å§»æ³ãè§å®ï¼ç»å©å¹´é¾ï¼ç·ä¸å¾æ©äº22å¨å²ï¼å¥³ä¸å¾æ©äº20å¨å²ã"}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/01.%E7%94%B7%E4%BA%BA%E5%BF%83%E6%99%BA%E6%88%90%E7%86%9F%E7%9A%84%E4%B9%9D%E5%A4%A7%E8%A1%A8%E7%8E%B0.html",relativePath:"02.çæ´»/01.éç¬/01.ç·äººå¿æºæççä¹å¤§è¡¨ç°.md",key:"v-099c9ca4",path:"/pages/aa6ada/",headersStr:null,content:"æå½ãå©å§»æ³ãè§å®ï¼ç»å©å¹´é¾ï¼ç·ä¸å¾æ©äº22å¨å²ï¼å¥³ä¸å¾æ©äº20å¨å²ã\n\nå¾å¤ç½åä¼è°ä¾ï¼è¯´è¿æ¯å ä¸ºï¼ç·äººæ®éè¦æ¯å¥³äººææçï¼æå¨ç½ä¸ä¹æç´¢äºä¸äºç¸å³çèµæï¼å¹¶æ²¡ææ¾å°æå¨çä¿¡æ¯æ¥æºæ¸ éï¼ä»¥è¯ææ­¤è§ç¹çæå¨æ§ã\n\nä¸ä¸ªç·äººçæçä¸å¦ï¼åè¦çå¶å¿æºæ¯å¦æçï¼é£ä¹ï¼ç·äººå¿æºæççè¡¨ç°æåªäºå¢ï¼\n\n1ãå»ºç«åå\n\nä¸è®ºæ¯å¨å·¥ä½ä¸­ï¼è¿æ¯å¨çæ´»ä¸­ï¼åææ¯å¨ä¸¤ä¸ªäººçç­æä¸­ï¼é½è½å»ºç«èªå·±çååãååè½è®©æä»¬å¨ä¸æ®µæç±è¿ç¨ä¸­ï¼æ´æ¸æ°å°æ¿æèµ·å¯¹å¦ä¸æ¹çç±ï¼åæ¶ï¼åè½ä¿è¯èªå·±çç¬ç«æ§ã\n\n2ãé»è¾è½å\n\næåºæ¬çåè¾¨æ¯éå¯¹éãç¤¾ä¼ä¸­çé»ç½ç°çé»è¾æç»´è½åãå¶å®ï¼ç®åç¤¾ä¼ä¸­çå¤§å¤æ°äººï¼é½æ¯æ¯è¾ç¼ºä¹é»è¾æç»´è½åçï¼å¾å¤äººè¯è¯´äºå¾å¤ï¼ä½æ¯ï¼è¿æ¯æä¸æ¸æ¥TAæ³è¦è¡¨è¾¾ä»ä¹ï¼è¯´è¯æ²¡æä¸»æ¬¡ä¹åçäººï¼éå¤å¯è§ã\n\næ´ä¸¥éç¹æ¥è¯´ï¼éå°ä»ä¹äºä»¶ï¼ææ¯å¬å°ä»ä¹äºä»¶ï¼å°±ä¼ç«å³ä¸ç»è®ºï¼èä¸æ¿æå¨å¨å¤§èï¼çæ§å°æèæèï¼åå³å®èªå·±çä¸ä¸æ­¥è¦æä¹èµ°ãæä»¥ï¼é»è¾è½åï¼æ¯ä¸ä¸ªç·äººå¿æºæçå¾éè¦çä¸ç¹è¡¨ç°ã\n\n3ãçæ·¡æäºäºçè½å\n\néå°ä¸äºè®©èªå·±ä¸å¼å¿çäºï¼ææ¯éå°ä¸äºè·èªå·±æ³æ³ç¸åçäººï¼å°±æ³çä¸å®è¦è®©TAäººçæ³æ³è½¬åï¼è·èªå·±çæ³æ³ä¸æ ·ãç»å¸¸æ§å°æ³çå¦ä½å»æ¹åå«äººçæ³æ³ï¼è¿æ¯ç·äººå¿æºä¸æççè¡¨ç°ä¹ä¸ã\n\nè¦ç¥éï¼ä¸çä¸çäººåç§åæ ·ï¼äººæé¾åçä¸ä»¶äºå°±æ¯ï¼å»æ¹åTAäººçæ³æ³ãå°±ç®æ¯ä¸å¸ï¼è³ä»ä¹æ²¡è½å®æè¿é¡¹ä¼ä¸ï¼ä½ åè°ä½è½è¡ï¼\n\n4ãä¸åä¸äº¢\n\nå½å«äººèµç¾èªå·±çæ¶åï¼èªå·±ä»ç¶ç¥éèªå·±çè½åè¾¹çå¨åªéï¼ä¸é«å²ï¼ä¸ä½ä½ï¼è¿è½å¾ä½è°å°åºå¯¹ãå½å«äººæ¶ææå»æ¶ï¼ä¹è½åå°ä¸èªåï¼ç¸ä¿¡èªå·±ã\n\nå½èªå·±å¤±è´¥æ¶ï¼è½å¤çæ§å°å¦ç¶é¢å¯¹ï¼å¹¶ä»å¤±è´¥ä¸­å¸åæè®­ï¼ä¸ºä¸ä¸æ¬¡å¯èªååå¤ï¼èä¸æ¯å¤±è´¥äºå°±ä»æ­¤ä¸è¹¶ä¸æ¯ã\n\n5ãæå¾è§å\n\nä¸åç²ç®å°çæ´»ãå·¥ä½ãå­¦ä¹ ï¼æå¾ç»èªå·±åç¸åºçè§åï¼å¹¶ä¸ï¼ä¸¥æ ¼è¦æ±èªå·±å»æ§è¡èªå·±å¶å®çè§åã\n\n6ãæ¶é´æ¯å½\n\næå¾çææ¶é´ï¼æç½æ¶é´çéè¦æ§ï¼æ¶é´å¯¹äºæä»¬æ¯äººé½ä¸æ ·çå¬å¹³ãä¸è®ºæ¯å¯äººè¿æ¯ç©·äººï¼æ¯å¤©é½æ¯24å°æ¶ï¼å³é®çæä»¬æ¯ä¸ªäººå¦ä½å»ä½¿ç¨æ¶é´ã\n\n7ãæ§å¶æç»ª\n\nè¿ä¸ç¹æç¥éå¾é¾ï¼ä¸è®ºæ¯å å²çå­©å­ï¼è¿æ¯å åå²çèäººï¼å§ç»é½ä¼ææç»ªï¼ä½æ¯å¿æºæççç·äººï¼ä¼æå¾æ´å¥½å°å»æ§å¶èªå·±çæç»ªï¼èä¸æ¯åªé¡¾çåæ³æç»ªã\n\n8ãçè§£ç¶æ¯\n\nç¶æ¯çå å¨ï¼å¨ç¶æ¯ä¸è¾çæ¥ï¼å°±æ¯å¯¹æä»¬çç±ï¼ä½æ¯ï¼å¯¹äºæä»¬çæ¥ï¼æ»ä¼è§å¾å¾åæãä½æ¯ï¼å½ä½ è½æ¢ä½æèï¼ææ¯ä½ æä¸å¤©ä¸ºäººç¶æ¯çæ¶åï¼æ­¤ææ­¤æ¯ä½ ä¼æä¹åï¼å°±è½å¯¹ç¶æ¯å¤ç¹çè§£äºã\n\n9ãåèªå·±\n\nåçæ­£çèªå·±ï¼ä¸ç¨å¤ªå»æå³æ³¨å«äººçå¾èªå·±çç¼åï¼å ä¸ºï¼ä½ ççæ´»ä¸æ¯å«äººç»çï¼é£ä¹ï¼ä½ åä¸ºä½è¦é£ä¹å¨æå«äººå¦ä½çå¾ä½ å¢ã\n\nä¸­å½äººæåæ¬¢å¹²çä¸ä»¶äºå°±æ¯âç®¡å«äººâï¼ä½æ¯ï¼è¿äºäººå¶å®æ²¡ææç½ä¸ç¹ï¼å«äººçå³å®ï¼ä¹åäº§ççåæï¼åªæå½äºäººèªå·±æ¿æï¼èé£äºâç®¡å«äººâçäººå´ä¸æ¿æä»»ä½é£é©ï¼è¿é¾éä¸æ¯å¾æé®é¢åï¼",normalizedContent:"æå½ãå©å§»æ³ãè§å®ï¼ç»å©å¹´é¾ï¼ç·ä¸å¾æ©äº22å¨å²ï¼å¥³ä¸å¾æ©äº20å¨å²ã\n\nå¾å¤ç½åä¼è°ä¾ï¼è¯´è¿æ¯å ä¸ºï¼ç·äººæ®éè¦æ¯å¥³äººææçï¼æå¨ç½ä¸ä¹æç´¢äºä¸äºç¸å³çèµæï¼å¹¶æ²¡ææ¾å°æå¨çä¿¡æ¯æ¥æºæ¸ éï¼ä»¥è¯ææ­¤è§ç¹çæå¨æ§ã\n\nä¸ä¸ªç·äººçæçä¸å¦ï¼åè¦çå¶å¿æºæ¯å¦æçï¼é£ä¹ï¼ç·äººå¿æºæççè¡¨ç°æåªäºå¢ï¼\n\n1ãå»ºç«åå\n\nä¸è®ºæ¯å¨å·¥ä½ä¸­ï¼è¿æ¯å¨çæ´»ä¸­ï¼åææ¯å¨ä¸¤ä¸ªäººçç­æä¸­ï¼é½è½å»ºç«èªå·±çååãååè½è®©æä»¬å¨ä¸æ®µæç±è¿ç¨ä¸­ï¼æ´æ¸æ°å°æ¿æèµ·å¯¹å¦ä¸æ¹çç±ï¼åæ¶ï¼åè½ä¿è¯èªå·±çç¬ç«æ§ã\n\n2ãé»è¾è½å\n\næåºæ¬çåè¾¨æ¯éå¯¹éãç¤¾ä¼ä¸­çé»ç½ç°çé»è¾æç»´è½åãå¶å®ï¼ç®åç¤¾ä¼ä¸­çå¤§å¤æ°äººï¼é½æ¯æ¯è¾ç¼ºä¹é»è¾æç»´è½åçï¼å¾å¤äººè¯è¯´äºå¾å¤ï¼ä½æ¯ï¼è¿æ¯æä¸æ¸æ¥taæ³è¦è¡¨è¾¾ä»ä¹ï¼è¯´è¯æ²¡æä¸»æ¬¡ä¹åçäººï¼éå¤å¯è§ã\n\næ´ä¸¥éç¹æ¥è¯´ï¼éå°ä»ä¹äºä»¶ï¼ææ¯å¬å°ä»ä¹äºä»¶ï¼å°±ä¼ç«å³ä¸ç»è®ºï¼èä¸æ¿æå¨å¨å¤§èï¼çæ§å°æèæèï¼åå³å®èªå·±çä¸ä¸æ­¥è¦æä¹èµ°ãæä»¥ï¼é»è¾è½åï¼æ¯ä¸ä¸ªç·äººå¿æºæçå¾éè¦çä¸ç¹è¡¨ç°ã\n\n3ãçæ·¡æäºäºçè½å\n\néå°ä¸äºè®©èªå·±ä¸å¼å¿çäºï¼ææ¯éå°ä¸äºè·èªå·±æ³æ³ç¸åçäººï¼å°±æ³çä¸å®è¦è®©taäººçæ³æ³è½¬åï¼è·èªå·±çæ³æ³ä¸æ ·ãç»å¸¸æ§å°æ³çå¦ä½å»æ¹åå«äººçæ³æ³ï¼è¿æ¯ç·äººå¿æºä¸æççè¡¨ç°ä¹ä¸ã\n\nè¦ç¥éï¼ä¸çä¸çäººåç§åæ ·ï¼äººæé¾åçä¸ä»¶äºå°±æ¯ï¼å»æ¹åtaäººçæ³æ³ãå°±ç®æ¯ä¸å¸ï¼è³ä»ä¹æ²¡è½å®æè¿é¡¹ä¼ä¸ï¼ä½ åè°ä½è½è¡ï¼\n\n4ãä¸åä¸äº¢\n\nå½å«äººèµç¾èªå·±çæ¶åï¼èªå·±ä»ç¶ç¥éèªå·±çè½åè¾¹çå¨åªéï¼ä¸é«å²ï¼ä¸ä½ä½ï¼è¿è½å¾ä½è°å°åºå¯¹ãå½å«äººæ¶ææå»æ¶ï¼ä¹è½åå°ä¸èªåï¼ç¸ä¿¡èªå·±ã\n\nå½èªå·±å¤±è´¥æ¶ï¼è½å¤çæ§å°å¦ç¶é¢å¯¹ï¼å¹¶ä»å¤±è´¥ä¸­å¸åæè®­ï¼ä¸ºä¸ä¸æ¬¡å¯èªååå¤ï¼èä¸æ¯å¤±è´¥äºå°±ä»æ­¤ä¸è¹¶ä¸æ¯ã\n\n5ãæå¾è§å\n\nä¸åç²ç®å°çæ´»ãå·¥ä½ãå­¦ä¹ ï¼æå¾ç»èªå·±åç¸åºçè§åï¼å¹¶ä¸ï¼ä¸¥æ ¼è¦æ±èªå·±å»æ§è¡èªå·±å¶å®çè§åã\n\n6ãæ¶é´æ¯å½\n\næå¾çææ¶é´ï¼æç½æ¶é´çéè¦æ§ï¼æ¶é´å¯¹äºæä»¬æ¯äººé½ä¸æ ·çå¬å¹³ãä¸è®ºæ¯å¯äººè¿æ¯ç©·äººï¼æ¯å¤©é½æ¯24å°æ¶ï¼å³é®çæä»¬æ¯ä¸ªäººå¦ä½å»ä½¿ç¨æ¶é´ã\n\n7ãæ§å¶æç»ª\n\nè¿ä¸ç¹æç¥éå¾é¾ï¼ä¸è®ºæ¯å å²çå­©å­ï¼è¿æ¯å åå²çèäººï¼å§ç»é½ä¼ææç»ªï¼ä½æ¯å¿æºæççç·äººï¼ä¼æå¾æ´å¥½å°å»æ§å¶èªå·±çæç»ªï¼èä¸æ¯åªé¡¾çåæ³æç»ªã\n\n8ãçè§£ç¶æ¯\n\nç¶æ¯çå å¨ï¼å¨ç¶æ¯ä¸è¾çæ¥ï¼å°±æ¯å¯¹æä»¬çç±ï¼ä½æ¯ï¼å¯¹äºæä»¬çæ¥ï¼æ»ä¼è§å¾å¾åæãä½æ¯ï¼å½ä½ è½æ¢ä½æèï¼ææ¯ä½ æä¸å¤©ä¸ºäººç¶æ¯çæ¶åï¼æ­¤ææ­¤æ¯ä½ ä¼æä¹åï¼å°±è½å¯¹ç¶æ¯å¤ç¹çè§£äºã\n\n9ãåèªå·±\n\nåçæ­£çèªå·±ï¼ä¸ç¨å¤ªå»æå³æ³¨å«äººçå¾èªå·±çç¼åï¼å ä¸ºï¼ä½ ççæ´»ä¸æ¯å«äººç»çï¼é£ä¹ï¼ä½ åä¸ºä½è¦é£ä¹å¨æå«äººå¦ä½çå¾ä½ å¢ã\n\nä¸­å½äººæåæ¬¢å¹²çä¸ä»¶äºå°±æ¯âç®¡å«äººâï¼ä½æ¯ï¼è¿äºäººå¶å®æ²¡ææç½ä¸ç¹ï¼å«äººçå³å®ï¼ä¹åäº§ççåæï¼åªæå½äºäººèªå·±æ¿æï¼èé£äºâç®¡å«äººâçäººå´ä¸æ¿æä»»ä½é£é©ï¼è¿é¾éä¸æ¯å¾æé®é¢åï¼",charsets:{cjk:!0}},{title:"è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç",frontmatter:{title:"è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç",date:"2023-02-23T12:14:52.000Z",permalink:"/pages/7b0831/",categories:["çæ´»","éç¬"],tags:[null],readingShow:"top",description:"ä¸ãæ·±å»",meta:[{name:"twitter:title",content:"è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç"},{name:"twitter:description",content:"ä¸ãæ·±å»"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/03.%E8%BF%99%E5%9B%9B%E4%B8%AA%E6%95%85%E4%BA%8B%E5%B0%8F%E6%AE%B5%EF%BC%8C%E5%A4%9F%E4%BD%A0%E5%8F%97%E7%94%A8%E4%B8%80%E7%94%9F.html"},{property:"og:type",content:"article"},{property:"og:title",content:"è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç"},{property:"og:description",content:"ä¸ãæ·±å»"},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/03.%E8%BF%99%E5%9B%9B%E4%B8%AA%E6%95%85%E4%BA%8B%E5%B0%8F%E6%AE%B5%EF%BC%8C%E5%A4%9F%E4%BD%A0%E5%8F%97%E7%94%A8%E4%B8%80%E7%94%9F.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-23T12:14:52.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç"},{itemprop:"description",content:"ä¸ãæ·±å»"}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/03.%E8%BF%99%E5%9B%9B%E4%B8%AA%E6%95%85%E4%BA%8B%E5%B0%8F%E6%AE%B5%EF%BC%8C%E5%A4%9F%E4%BD%A0%E5%8F%97%E7%94%A8%E4%B8%80%E7%94%9F.html",relativePath:"02.çæ´»/01.éç¬/03.è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç.md",key:"v-5436895e",path:"/pages/7b0831/",headersStr:null,content:"# è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç\n\nä¸ãæ·±å»\n\nååå¨çµæ¢¯é´çè§ä¸å°å­©å¿å¨åéªç³ï¼åºäºå³å¿ï¼é¡ºå£åè¯ä»ï¼âè¿ä¹åçå¤©ï¼ä¼ååèº« Â Â Â Â Â Â Â Â ä½çï¼âã\n\nå°å­©åè¯æï¼ä»çå¥¶å¥¶æ´»äº103å²ã\n\næé®ï¼âåéªç³åçï¼â\n\nä»è¯´ï¼âä¸æ¯ï¼æå¥¶å¥¶ä»æ¥ä¸ç®¡é²äºï¼â\n\nå¤ä¹æ·±å»ï¼ç°å¨ç»äºç¥éèªå·±ä¸ºä»ä¹è¡°èå¾è¿ä¹å¿«äºï¼\n\nçæå¿æçâ¦â¦\n\näºãå¿ç´¯\n\nç°å¨éªå­çå¤ï¼åååçå°æ°é»éè¯´å¨æ·å­æ¬¾æ¶å¤±ï¼å åä¸ä¸ç¿¼èé£ã\n\nææ¥å¿éªèªè¡è½¦å°é¶è¡ï¼èµ¶ç´§æå¡è¾å¯ç æ¥çã\n\nè¿å¥½ï¼8åé±è¿å¨ï¼è¿ææ¾äºä¸å£æ°ã\n\næ¥æ­»æäºï¼\n\nä»¥ååä¹ä¸çæ°é»äºï¼å¿å¥½ç´¯ï¼\n\nèµ°åºé¶è¡ï¼å¿æ´ç´¯äºï¼8åé±è¿å¨ï¼èªè¡è½¦å´ä¸è§äºâ¦\n\nä¸ãå«æ¥\n\nå¤§å¦æ©ä¸å»å¹¿åºæ£æ­¥ï¼çå°æä¸ªèå¤´æ¿çæµ·ç»µç¬å¨å°ä¸åå¤§å­ï¼å¿ä¸ä½åä¸å»çã\n\nèå¤´çäºå¤§å¦ä¸ç¼ï¼æç¬åäºä¸ªâæ»âå­ã\n\nå¤§å¦å¿æ³ï¼çä¸ä¸è³äºåï¼â¦â¦\n\nèå¤´åçå¤§å¦ä¸ç¼ï¼ååä¸ªâæ»âã\n\nå¤§å¦åä¹å¿ä¸ä½äºï¼ä¸å»ä¸èå°èå¤´è¸¢åå¨å°â¦â¦\n\nè­¦å¯æ¥äºé®ååäºï¼èå¤´å§å±å°è¯´ï¼\n\nâæå°±æ³åå¥âæ»æ»é¿æ±ä¸éæ°´âï¼ååå¤´ä¸¤ä¸ªå­ï¼å°±è¢«è¿ä¸ªç¥ç»çè¸¹åäºâã\n\næä»¥åï¼æåä»¬ï¼å¡äºå«æ¥ï¼\n\nåãå¿çç¹\n\nä¸ä¸ªå§å¨ä¸äºé«éï¼è§èªå·±çåº§ä½ä¸åçä¸ç·å£«ã\n\nå¥¹æ ¸å¯¹èªå·±çç¥¨ï¼å®¢æ°å°è¯´ï¼âåçï¼æ¨åéä½ç½®äºå§ï¼â\n\nç·å£«æ¿åºç¥¨ï¼å¤§å£°å·å·ï¼âçæ¸æ¥ç¹ï¼è¿æ¯æçåº§ä½ï¼ä½ çäºç¼åï¼ï¼â\n\nå¥³å­©ä»ç»çäºä»çç¥¨ï¼ä¸ååå£°ï¼é»é»å°ç«å¨ä»çèº«æã\n\nä¸ä¼å¿ç«è½¦å¼å¨äºï¼å¥³å­©ä½å¤´è½»è½»å°å¯¹ç·å£«è¯´ï¼âåçï¼æ¨æ²¡åéä½ï¼ä½æ¨åéäºè½¦ï¼è¿ Â Â Â Â Â Â Â Â æ¯å¼å¾ä¸æµ·çï¼ä½ çè½¦ç¥¨æ¯å»åå°æ»¨çãâ\n\næä¸ç§å¿è®©ï¼å«åè®©ä½ åæé½æ¥ä¸åï¼å¦æåå«è½è§£å³é®é¢ï¼é©´æ©å°±ç»æ²»äºä¸çã",normalizedContent:"# è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç\n\nä¸ãæ·±å»\n\nååå¨çµæ¢¯é´çè§ä¸å°å­©å¿å¨åéªç³ï¼åºäºå³å¿ï¼é¡ºå£åè¯ä»ï¼âè¿ä¹åçå¤©ï¼ä¼ååèº« Â Â Â Â Â Â Â Â ä½çï¼âã\n\nå°å­©åè¯æï¼ä»çå¥¶å¥¶æ´»äº103å²ã\n\næé®ï¼âåéªç³åçï¼â\n\nä»è¯´ï¼âä¸æ¯ï¼æå¥¶å¥¶ä»æ¥ä¸ç®¡é²äºï¼â\n\nå¤ä¹æ·±å»ï¼ç°å¨ç»äºç¥éèªå·±ä¸ºä»ä¹è¡°èå¾è¿ä¹å¿«äºï¼\n\nçæå¿æçâ¦â¦\n\näºãå¿ç´¯\n\nç°å¨éªå­çå¤ï¼åååçå°æ°é»éè¯´å¨æ·å­æ¬¾æ¶å¤±ï¼å åä¸ä¸ç¿¼èé£ã\n\nææ¥å¿éªèªè¡è½¦å°é¶è¡ï¼èµ¶ç´§æå¡è¾å¯ç æ¥çã\n\nè¿å¥½ï¼8åé±è¿å¨ï¼è¿ææ¾äºä¸å£æ°ã\n\næ¥æ­»æäºï¼\n\nä»¥ååä¹ä¸çæ°é»äºï¼å¿å¥½ç´¯ï¼\n\nèµ°åºé¶è¡ï¼å¿æ´ç´¯äºï¼8åé±è¿å¨ï¼èªè¡è½¦å´ä¸è§äºâ¦\n\nä¸ãå«æ¥\n\nå¤§å¦æ©ä¸å»å¹¿åºæ£æ­¥ï¼çå°æä¸ªèå¤´æ¿çæµ·ç»µç¬å¨å°ä¸åå¤§å­ï¼å¿ä¸ä½åä¸å»çã\n\nèå¤´çäºå¤§å¦ä¸ç¼ï¼æç¬åäºä¸ªâæ»âå­ã\n\nå¤§å¦å¿æ³ï¼çä¸ä¸è³äºåï¼â¦â¦\n\nèå¤´åçå¤§å¦ä¸ç¼ï¼ååä¸ªâæ»âã\n\nå¤§å¦åä¹å¿ä¸ä½äºï¼ä¸å»ä¸èå°èå¤´è¸¢åå¨å°â¦â¦\n\nè­¦å¯æ¥äºé®ååäºï¼èå¤´å§å±å°è¯´ï¼\n\nâæå°±æ³åå¥âæ»æ»é¿æ±ä¸éæ°´âï¼ååå¤´ä¸¤ä¸ªå­ï¼å°±è¢«è¿ä¸ªç¥ç»çè¸¹åäºâã\n\næä»¥åï¼æåä»¬ï¼å¡äºå«æ¥ï¼\n\nåãå¿çç¹\n\nä¸ä¸ªå§å¨ä¸äºé«éï¼è§èªå·±çåº§ä½ä¸åçä¸ç·å£«ã\n\nå¥¹æ ¸å¯¹èªå·±çç¥¨ï¼å®¢æ°å°è¯´ï¼âåçï¼æ¨åéä½ç½®äºå§ï¼â\n\nç·å£«æ¿åºç¥¨ï¼å¤§å£°å·å·ï¼âçæ¸æ¥ç¹ï¼è¿æ¯æçåº§ä½ï¼ä½ çäºç¼åï¼ï¼â\n\nå¥³å­©ä»ç»çäºä»çç¥¨ï¼ä¸ååå£°ï¼é»é»å°ç«å¨ä»çèº«æã\n\nä¸ä¼å¿ç«è½¦å¼å¨äºï¼å¥³å­©ä½å¤´è½»è½»å°å¯¹ç·å£«è¯´ï¼âåçï¼æ¨æ²¡åéä½ï¼ä½æ¨åéäºè½¦ï¼è¿ Â Â Â Â Â Â Â Â æ¯å¼å¾ä¸æµ·çï¼ä½ çè½¦ç¥¨æ¯å»åå°æ»¨çãâ\n\næä¸ç§å¿è®©ï¼å«åè®©ä½ åæé½æ¥ä¸åï¼å¦æåå«è½è§£å³é®é¢ï¼é©´æ©å°±ç»æ²»äºä¸çã",charsets:{cjk:!0}},{title:"å°è¯´æ´»çæå½",frontmatter:{title:"å°è¯´æ´»çæå½",date:"2023-02-24T16:40:24.000Z",permalink:"/pages/e7e74b/",categories:["çæ´»","éç¬"],tags:[null],readingShow:"top",description:"è¦ï¼æ¯çæ´»çå¸¸æ é£ä¸å¤©ï¼èç½å­éé¿å¤§çå¾ç¦è´µç¬¬ä¸æ¬¡æèµ·ææï¼ç¬¬ä¸æ¬¡æ¥åæ­¥è¡æ°åéï¼ç¨ååå¨é¨ç¥äº§å¾æ¥çéé±ï¼ è¿æ¸äºæ¬ ä¸çèµåºã æ²éçææå°ä»çè©èåå¾è¡èæ¨¡ç³ãè¿æ¯ç¦è´µç¬¬ä¸æ¬¡å°å°çæ´»çè¦ã å´ä¸ç¥éï¼å¨ä»¥åçååå¹´éï¼æ¯ä¸å¤©é½æ¯ä»å¤©æ´è¦ã",meta:[{name:"twitter:title",content:"å°è¯´æ´»çæå½"},{name:"twitter:description",content:"è¦ï¼æ¯çæ´»çå¸¸æ é£ä¸å¤©ï¼èç½å­éé¿å¤§çå¾ç¦è´µç¬¬ä¸æ¬¡æèµ·ææï¼ç¬¬ä¸æ¬¡æ¥åæ­¥è¡æ°åéï¼ç¨ååå¨é¨ç¥äº§å¾æ¥çéé±ï¼ è¿æ¸äºæ¬ ä¸çèµåºã æ²éçææå°ä»çè©èåå¾è¡èæ¨¡ç³ãè¿æ¯ç¦è´µç¬¬ä¸æ¬¡å°å°çæ´»çè¦ã å´ä¸ç¥éï¼å¨ä»¥åçååå¹´éï¼æ¯ä¸å¤©é½æ¯ä»å¤©æ´è¦ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/04.%E5%B0%8F%E8%AF%B4%E6%B4%BB%E7%9D%80%E6%91%98%E5%BD%95.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å°è¯´æ´»çæå½"},{property:"og:description",content:"è¦ï¼æ¯çæ´»çå¸¸æ é£ä¸å¤©ï¼èç½å­éé¿å¤§çå¾ç¦è´µç¬¬ä¸æ¬¡æèµ·ææï¼ç¬¬ä¸æ¬¡æ¥åæ­¥è¡æ°åéï¼ç¨ååå¨é¨ç¥äº§å¾æ¥çéé±ï¼ è¿æ¸äºæ¬ ä¸çèµåºã æ²éçææå°ä»çè©èåå¾è¡èæ¨¡ç³ãè¿æ¯ç¦è´µç¬¬ä¸æ¬¡å°å°çæ´»çè¦ã å´ä¸ç¥éï¼å¨ä»¥åçååå¹´éï¼æ¯ä¸å¤©é½æ¯ä»å¤©æ´è¦ã"},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/04.%E5%B0%8F%E8%AF%B4%E6%B4%BB%E7%9D%80%E6%91%98%E5%BD%95.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-24T16:40:24.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"å°è¯´æ´»çæå½"},{itemprop:"description",content:"è¦ï¼æ¯çæ´»çå¸¸æ é£ä¸å¤©ï¼èç½å­éé¿å¤§çå¾ç¦è´µç¬¬ä¸æ¬¡æèµ·ææï¼ç¬¬ä¸æ¬¡æ¥åæ­¥è¡æ°åéï¼ç¨ååå¨é¨ç¥äº§å¾æ¥çéé±ï¼ è¿æ¸äºæ¬ ä¸çèµåºã æ²éçææå°ä»çè©èåå¾è¡èæ¨¡ç³ãè¿æ¯ç¦è´µç¬¬ä¸æ¬¡å°å°çæ´»çè¦ã å´ä¸ç¥éï¼å¨ä»¥åçååå¹´éï¼æ¯ä¸å¤©é½æ¯ä»å¤©æ´è¦ã"}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/04.%E5%B0%8F%E8%AF%B4%E6%B4%BB%E7%9D%80%E6%91%98%E5%BD%95.html",relativePath:"02.çæ´»/01.éç¬/04.å°è¯´æ´»çæå½.md",key:"v-5cac2a3b",path:"/pages/e7e74b/",headers:[{level:3,title:"ãæ´»çã-æå½",slug:"ãæ´»çã-æå½-2",normalizedTitle:"ãæ´»çã-æå½",charIndex:2}],headersStr:"ãæ´»çã-æå½",content:"# ãæ´»çã-æå½\n\n\n# ãæ´»çã-æå½\n\n * äººæ¯ä¸ºæ´»çæ¬èº«èæ´»ççï¼èä¸æ¯ä¸ºæ´»çä¹å¤çä»»ä½äºç©ææ´»çã\n * ååå©ç¦ï¼æ¯æä»¬è¡èµ°ä¸ä¿çå¥å±ï¼å´ä¸æ¯æ¡æ¢çå½çæ·éã\n * è°é¾å°è¦ï¼æ¯æ¯ä¸ªäººæé¿å¿ç»çä¿®è¡ï¼èä¸æ¯åæ²¡å¸æçæ¶æµªã\n\nè¦ï¼æ¯çæ´»çå¸¸æ é£ä¸å¤©ï¼èç½å­éé¿å¤§çå¾ç¦è´µç¬¬ä¸æ¬¡æèµ·ææï¼ç¬¬ä¸æ¬¡æ¥åæ­¥è¡æ°åéï¼ç¨ååå¨é¨ç¥äº§å¾æ¥çéé±ï¼ è¿æ¸äºæ¬ ä¸çèµåºã æ²éçææå°ä»çè©èåå¾è¡èæ¨¡ç³ãè¿æ¯ç¦è´µç¬¬ä¸æ¬¡å°å°çæ´»çè¦ã å´ä¸ç¥éï¼å¨ä»¥åçååå¹´éï¼æ¯ä¸å¤©é½æ¯ä»å¤©æ´è¦ã\n\nèç¶è¢«ä»çèåè¡å¾æ´»æ´»æ°æ­»ã æå­çå¦»å­å®¶çè¢«å¤±æçå²³ç¶å¼ºè¡æ¥èµ°ã åªå©ä¸å¹´è¿çæ¯äº²ãå¹¼å°çå¥³å¿ï¼åç¦è´µä¸èµ·ç¼©å¨ç ´æ§çèèå±éç¸ä¾ä¸ºå½ã ä¸ºäºå»æ´»èªå·±åå®¶äººï¼ç¦è´µåªå¾åèµ·é¢é¢ï¼èµ°è¿æ¾ç»å±äºèªå·±çå¤§å®é¢ï¼å¤®æ±ä¹°èµ°èªå®¶å¨é¨ç¥äº§çå°ä¸»é¾äºç§ç»ä»äºäº©å°ã ä»ç¬¨æçè·çå¶ä»ä½æ·å­¦ä¹ èå°ãæ­ç§ï¼æ¯å¤©é½ç´¯å¾ç­ç²åç«­ã ç´å°å®¶çäº§å­åä»å¨å®¶å½æ¥ï¼åä¸å¤«ä¸èµ·å³ä½ï¼æè®©ç¦è´µç¨ç¨ç¼äºä¸å£æ°ã\n\nå¯è¿æ®µæ¶é´çè°è¦æ¥å­ï¼å·²ç»ä¸¥éæå®³äºç¦è´µæ¯äº²çå¥åº·ã ç¼çå»å°å¤ä¼äºå¤§åè¾å­çæ¯äº²ï¼è¢«ççæç£¨å°çè¦ä¸å ªï¼ç¦è´µèµ¶ç´§è¿åæ¾å»çã å´ä¸æï¼æ°å¥½èµ¶ä¸åéå¨æå£®ä¸ãç¦è´µè¢«è£¹æçä¸è·¯è¿èµ°ãè¿ä¸èµ°ï¼å°±æ¯ä¸¤å¹´ã ä¸¤å¹´éï¼ç¦è´µæ æ¶æ å»ä¸çµæçæ¯äº²ççæï¼å®¶äººçå®å±ï¼æ¯ä¸å¤©ï¼å¿éé½å¦æ²¹çç«ç§ã å¯ä»å´ä¸æ¢ç§éãå ä¸ºåè¡çèåµè¯´ï¼éå°±æå³çæ­»å¾æ´å¿«ãèä¸å³ä½¿éç¦»äºè¿æ¯éä¼ï¼è¿ä¼è¢«ä¸ä¸æ¯éä¼æèµ°ã å¥½å¨ï¼ç»åè¿æ æ°æ¬¡æç«çº·é£ççæ­»ä¸çº¿ï¼ç¦è´µè¿æ¯æ´»äºä¸æ¥ï¼æ´»çç­å°è¿æ¯éä¼æºè´¥æéã ä»æ¥æ¥å¿å¿èµ¶åå®¶ä¸­ï¼å´åç°æ¯äº²æ©å°±çæ­»ï¼å¦»å­ææ´ä¸å ªãæ¾ç»ä¼¶ä¿çå¥³å¿ï¼åå¾åèååã\n\nè¦é¾å¦æ½®æ°´è¬å¼å¸èè³ï¼ä¸æ³¢æªå¹³ä¸æ³¢åèµ·ã åæäºæ¯ä¸ªäººçäººçï¼æ»æé®é¢å±åºä¸ç©·ï¼æ»æé¾å¤è®©äººä¸å ªéè´ã\n\næäººæåºèæ ¸å·²ç»è¿«å¨çç«ï¼é¾ç¼ çå®¢æ·è¿å¨ç¾è¬åé¾ã æäººèµ·æ©è´ªé»åå¤å¼èï¼ä¾ç¶åä¸å¤æ¿è´·ãè½¦è´·åå­©å­é«æçè¡¥ä¹ è´¹ã æäººæ¯å¤©å¨996éç­ç²åç«­ï¼å¨35å²å±æºçé´å½±ä¸å¦å±¥èå°ã æäººç¼åè¿å²æéå¥½ï¼å¯åªè¦åºç°ä¸ä¸ç¹æå¤ï¼å°±è½è®©çæ´»åå´©ç¦»æã å¼ ç±ç²è¯´ï¼å¨è¿ä¸ªåæªéç¦»çäººé´ï¼æ²¡æè°å¯ä»¥å°æ¥å­è¿å¾è¡äºæµæ°´ã èº«ä¸ºæå¹´äººï¼è°ä¸æ¯ä¸è¾¹å¨æ·±å¤éå´©æºï¼ä¸è¾¹å¨å¤ªé³åèµ·åï¼å¬ç´§çå³ç»§ç»­æ­»æã\n\næï¼æ¯çå½çæ°è ç¦è´µè¢«æå£®ä¸çé£ä¸¤å¹´ï¼æåçç¬çå°±æ¯å®¶çã å¥¹æ æ°æ¬¡è¿åæå¬ä¸å¤«çä¸è½ï¼å´ä¸æ¬¡åä¸æ¬¡å¤±æèå½ã æ²¡äººç¥éç¦è´µçä¸è½ï¼çè³æ²¡äººç¥éç¦è´µç°å¨æ¯çæ¯æ­»ã å¯å³ä½¿æé¾çæ¥å­ï¼å®¶çä¹æ²¡ææ³è¿ç¦»å¼å¾å®¶ã è¿ä¸ªåºèº«å¯è£å®¶åº­ï¼åå«å¥å¯è´µäººå®¶çå¥³å­¦çï¼è±ä¸äºåç¾çæè¢ï¼æ¢ä¸äºç²å¸è¡£è¡«ã å¥¹ç¨ä¸åæ²¡æ²¾è¿é³æ¥æ°´çæå¼±åæï¼æ¯æ¥ææç¹éçåæ´»ï¼è°é¾å°å°å¿å¥³ææ¯é¿å¤§ï¼ä¸ºå©å©å»èéç»ã ç­å°ç¦è´µåæ¥çæ¶åï¼è¿ä¸ªå®¶è½ç¶ç ´è´¥ï¼å´è¿æäº²äººå¨å®åã å¯¹äºæ¸¸å­èè¨ï¼è¿å°±æ¯æå¤§çå®æ°ã\n\nåæ¥ä»¥åï¼ç¦è´µå®ä¸å¿æ¥ä¸å®¶äººä¸èµ·è¸è¸å®å®è¿æ¥å­ã å¯æ è®ºç¦è´µåå®¶çå¦ä½æ¼å½å³ä½ï¼æ è®ºå¥³å¿å¤éåå¿å­æåºå¦ä½è´´å¿æäºï¼ç°éçé£ç¹æ´»è®¡ä¹å¡«ä¸é¥±å¨å®¶äººçèå­ã ç¼è§çæåºå·²ç»å°äºä¸å­¦çå¹´çºªï¼å®¶éè¿åä¸åºä¸å­¦çå­¦è´¹ï¼ç¦è´µåå®¶çå¿çæå¤ééç»å«äººå½å¥³å¿ã æ¯å¤©çµè æèï¼æå¿åèååçå¥³å¿å¨å«äººå®¶åäºæ¬ºè´ãå¯å½æ³å®¶çå¤éå·è·åæ¥åï¼ç¦è´µåæ¯æå¨ï¼åè¦ç¡¬èµ·å¿è ï¼æå¥³å¿éäºåå»ã æäºçå¤éæ²¡æå­é¹ãå¥¹è½ç¶æ æ¯èä¸å¾ç¶æ¯ï¼èä¸å¾å¼å¼ï¼è¿æ¯ä¹ä¹çµçç¶äº²çæï¼èµ°äºåå éè·¯èµ¶ååéã ä¸´å«çæ¶åï¼å¥¹ç¨å°åçæå°ï¼ææ¸çç¶äº²çè¸åºãè¿ä»½æµæµçä¾æï¼ä¸ä¸å­æå¨äºç¦è´µã ä»è½¬èº«èèµ·å¥³å¿ï¼ä¸æ­¥æ­¥åå°ç ´è´¥å´æ¸©æçå®¶ä¸­ï¼åå®å°å¯¹å®¶çè¯´ï¼âå°±æ¯å¨å®¶é½é¥¿æ­»ï¼ä¹ä¸æå¤ééèµ°ãâ æ¯åï¼å°±ç®çæ´»åé¾ï¼åªè¦æå®¶äººå¨ä¸èµ·ï¼åæä»ä¹åå¿æ¯è¿ä¸å»çå¢ã å°±ç®äººçåè¦ï¼åªè¦æå®¶äººéªä¼´ï¼æ»è½å¨æç»å¾®å¤æåå°æ¸©æã\n\nä¹è®¸æ¯æ·±å¤å°å®¶æ¶ï¼åç°å¦»å­å¨ä¿æ¸©æ¡¶éçäºä¸ç¢ç­æ±¤ã ä¹è®¸æ¯ç­ç²åç«­æ¶ï¼å­©å­éä¸ä¸ä¸ªæ²¾æ»¡å£æ°´çäº²å»ã ä¹è®¸æ¯å¨å¿å°æå¤©é»å°æ¶ï¼å¾®ä¿¡éééèººçæ¯äº²åæ¥çé®åã ä¹è®¸æ¯å°äºèµ°ææ è·¯çæ¶åï¼ç¶äº²è½»è½»ææè©èï¼âæ¾å¿ï¼ææãâ å³ä½¿è¿åéååè½»å¾®ï¼åªæè½æä¾çæ¯æå¾®ä¸è¶³éã å¯åªè¦æè¿ä»½æ¸©æï¼å°±è¶³ä»¥æ°èæ´ä¸ªçå½ã åªè¦æå®¶äººç«å¨èº«åï¼æä»¬çäººçå°±è¿æéè·¯ã\n\næ´»çå¾é¾ï¼ä½ç¬è¿å»å°±æå¸æ ææ®µæ¶é´ï¼ç¦è´µè§å¾çæ´»å¼å§æäºç¼å¤´ã å¤éå·²ç»é¿å¤§ï¼æ¯æ¥æ£çå·¥åå¯ä»¥å»æ´»èªå·±ã æåºä¸è¾¹è¯»ä¹¦ï¼ä¸è¾¹æ¾ç¾ï¼ç»å°±åºä¸åé£æ¯è¿ï¼å¨å­¦æ ¡çè¿å¨ä¼ä¸æ¿äºç¬¬ä¸åã å®¶çä¾ç¶è´¤æ è½å¹²ï¼å°ææå®¶äººç§é¡¾å°å¦¥å¦¥å¸å¸ãç¦è´µèªå·±ä¹å¨å°éè¸è¸å®å®è¦å¹²ã æ¥å­ä¾æ§ç©·å°æ½¦åï¼å¯æ¯ä¸å¤©é½çæºååã å¯å¨ä»æåå¾æªæ¥çæ¶åï¼å½è¿çç¬çç ¸ç­äºææå¸æã\n\næåºå·²ç»ä¸å°å°å­¦äºå¹´çº§ï¼ç¼ççå°±è½åå®¶æ£å·¥åãå´å¨ä¸åºç®è¡ä¸­ï¼è¢«æ½å¹²è¡å½åºæ¨æ­»ã å¤éå¹¸è¿å°æ¾äºä¸ªç¥å·ç¥ç­çä¸å¤«ï¼å¥½å®¹æè¿äºå å¤©åç¾çæ¥å­ï¼å°±å ä¸ºé¾äº§å¤§åºè¡èæ­»ã ä¸§å­ä¸§å¥³çæ²çåå®äºæ¬å°±æ£çå¤å¹´çå®¶çãå¥³å¿æ­»åä¸ä¸ªæï¼å¥¹ä¹ææäººå¯°ã ä¸´æ­»åï¼å¥¹å±æç¦è´µï¼âä½ è¿å¾å¥½å¥½æ´»ä¸å»ï¼è¿æè¦æ ¹åäºåãâ å¯å½è¿çæ®é·è¶ä¹æ³è±¡ãæ²¡è¿å å¹´ï¼å¥³å©¿äºååå¤å­è¦æ ¹ååå æå¤èº«äº¡ã å¨æ¬åºè¯¥å¿å­ç»èçå¹´é¾ï¼ç¦è´µå¤±å»äºææçäº²äººï¼ææçä¾é ï¼ææçææã è¿æ¶çèæ±ï¼å·²ç»è¦å¾è¿å¹æ¯é½åä¸åºæ¥äºã\n\nä»å¨æä¸æ¾äºååé±ãåªæ³ç­èªå·±æ­»åï¼æ¶å°¸çäººè½çå¨é±çä»½ä¸ï¼æèªå·±åå®¶äººè¬å¨ä¸èµ·ã å´æ²¡æ³å°ï¼è½ç¶è°å¸¸å¸¸ç¼ï¼ç¼çè¶æ¥è¶è±ï¼ä»è¿æ¯ä¸å¤©å¤©æ´»äºä¸æ¥ã æå¤ä¸å¤´çé±çæ¶åï¼ç¦è´µå»ä¹°äºä¸å¤´åèªå·±ä¸æ ·èççãä¸äººä¸çï¼æ¯å¤©è¯´è¯´è¯ï¼èèå°ï¼å½¼æ­¤ç¸ä¾ä¸ºå½ã ä¹è®¸ä»ä¸ä¿çè§åº¦çï¼ç¦è´µçè¿ä¸çæ´»å¾æ¢æ²æ¨åå¤±è´¥ã\n\nå ä¸ºå°å¹´èåï¼ä»æ©æ©è´¥åäºææçå®¶ä¸ï¼æ²¡è½åç¶äº²çææé£æ ·åå®èç¥ã å ä¸ºä¸­å¹´æå®¶ï¼ä»æ²¡æåä¸åå½åµçæ¥çé£æ ·ï¼éæ©éè§£æ¾ååä¸ï¼ä¹éå¤±äºèµ°ä¸ä»éçæºä¼ã å ä¸ºå½è¿ä¸æµï¼ä»å¤±å»äºææçäº²äººï¼åªè½å­¤ç¬å°ç­å¾èå»ã å¯æ¯ç«ç¦è´µè¿æ´»çã æ¯èµ·è°å¤ºäºä»ç°äº§çé¾äºãæ¾ç»æ¥é£å¾æè¿çæ¥çæ´»å¾é½é¿ä¹ã è¿å°±æ¯äººçæå¤§çæ¶è·ãå ä¸ºåªæçå½ï¼ææ¯ä¸çä¸ç¬ä¸æ äºçç¨ç¼ºåã çéäºäººççç¦è´µï¼ææ¯ä¸å¤©é½æ´»å¾æå¶è®¤çã ç§å°çæ¶åï¼ä»æ³å°½åæ³é¼èèµ·èççå¿æ°ãåå®¶çè·¯ä¸ï¼ä»çæ­å£°å¨ç°åä¸å¦æé£è¬é£æ¬ã è¿ä¸ªèäººçå½è¿ï¼æææ¯ä¸ä¸çå¤§å¤æ°äººé½æ²è¦ãå´æ´»æäºæ¯å¤§å¤æ°äººï¼é½æäº®çæ ·å­ã è¿å°±æ¯çå½ççç¸ï¼ä½ æä¹æ³ï¼å°±ä¼æä¹æ´»ã\n\néæ©å­æ³£åä¼¤ï¼æ³¨å®å°ä¸è·¯ç°æã éæ©ææ¬åä¸ï¼å°±ç®é£é¨å¦æ¦ï¼ä¹è½å¾æåå¼æ»¡ç®æåã çæ´»å¾é¾ï¼æ´»çæ´é¾ã å¯åªè¦è¯ç¨åæåï¼è¿äººé´ç»ç©¶å¼å¾å¸æã",normalizedContent:"# ãæ´»çã-æå½\n\n\n# ãæ´»çã-æå½\n\n * äººæ¯ä¸ºæ´»çæ¬èº«èæ´»ççï¼èä¸æ¯ä¸ºæ´»çä¹å¤çä»»ä½äºç©ææ´»çã\n * ååå©ç¦ï¼æ¯æä»¬è¡èµ°ä¸ä¿çå¥å±ï¼å´ä¸æ¯æ¡æ¢çå½çæ·éã\n * è°é¾å°è¦ï¼æ¯æ¯ä¸ªäººæé¿å¿ç»çä¿®è¡ï¼èä¸æ¯åæ²¡å¸æçæ¶æµªã\n\nè¦ï¼æ¯çæ´»çå¸¸æ é£ä¸å¤©ï¼èç½å­éé¿å¤§çå¾ç¦è´µç¬¬ä¸æ¬¡æèµ·ææï¼ç¬¬ä¸æ¬¡æ¥åæ­¥è¡æ°åéï¼ç¨ååå¨é¨ç¥äº§å¾æ¥çéé±ï¼ è¿æ¸äºæ¬ ä¸çèµåºã æ²éçææå°ä»çè©èåå¾è¡èæ¨¡ç³ãè¿æ¯ç¦è´µç¬¬ä¸æ¬¡å°å°çæ´»çè¦ã å´ä¸ç¥éï¼å¨ä»¥åçååå¹´éï¼æ¯ä¸å¤©é½æ¯ä»å¤©æ´è¦ã\n\nèç¶è¢«ä»çèåè¡å¾æ´»æ´»æ°æ­»ã æå­çå¦»å­å®¶çè¢«å¤±æçå²³ç¶å¼ºè¡æ¥èµ°ã åªå©ä¸å¹´è¿çæ¯äº²ãå¹¼å°çå¥³å¿ï¼åç¦è´µä¸èµ·ç¼©å¨ç ´æ§çèèå±éç¸ä¾ä¸ºå½ã ä¸ºäºå»æ´»èªå·±åå®¶äººï¼ç¦è´µåªå¾åèµ·é¢é¢ï¼èµ°è¿æ¾ç»å±äºèªå·±çå¤§å®é¢ï¼å¤®æ±ä¹°èµ°èªå®¶å¨é¨ç¥äº§çå°ä¸»é¾äºç§ç»ä»äºäº©å°ã ä»ç¬¨æçè·çå¶ä»ä½æ·å­¦ä¹ èå°ãæ­ç§ï¼æ¯å¤©é½ç´¯å¾ç­ç²åç«­ã ç´å°å®¶çäº§å­åä»å¨å®¶å½æ¥ï¼åä¸å¤«ä¸èµ·å³ä½ï¼æè®©ç¦è´µç¨ç¨ç¼äºä¸å£æ°ã\n\nå¯è¿æ®µæ¶é´çè°è¦æ¥å­ï¼å·²ç»ä¸¥éæå®³äºç¦è´µæ¯äº²çå¥åº·ã ç¼çå»å°å¤ä¼äºå¤§åè¾å­çæ¯äº²ï¼è¢«ççæç£¨å°çè¦ä¸å ªï¼ç¦è´µèµ¶ç´§è¿åæ¾å»çã å´ä¸æï¼æ°å¥½èµ¶ä¸åéå¨æå£®ä¸ãç¦è´µè¢«è£¹æçä¸è·¯è¿èµ°ãè¿ä¸èµ°ï¼å°±æ¯ä¸¤å¹´ã ä¸¤å¹´éï¼ç¦è´µæ æ¶æ å»ä¸çµæçæ¯äº²ççæï¼å®¶äººçå®å±ï¼æ¯ä¸å¤©ï¼å¿éé½å¦æ²¹çç«ç§ã å¯ä»å´ä¸æ¢ç§éãå ä¸ºåè¡çèåµè¯´ï¼éå°±æå³çæ­»å¾æ´å¿«ãèä¸å³ä½¿éç¦»äºè¿æ¯éä¼ï¼è¿ä¼è¢«ä¸ä¸æ¯éä¼æèµ°ã å¥½å¨ï¼ç»åè¿æ æ°æ¬¡æç«çº·é£ççæ­»ä¸çº¿ï¼ç¦è´µè¿æ¯æ´»äºä¸æ¥ï¼æ´»çç­å°è¿æ¯éä¼æºè´¥æéã ä»æ¥æ¥å¿å¿èµ¶åå®¶ä¸­ï¼å´åç°æ¯äº²æ©å°±çæ­»ï¼å¦»å­ææ´ä¸å ªãæ¾ç»ä¼¶ä¿çå¥³å¿ï¼åå¾åèååã\n\nè¦é¾å¦æ½®æ°´è¬å¼å¸èè³ï¼ä¸æ³¢æªå¹³ä¸æ³¢åèµ·ã åæäºæ¯ä¸ªäººçäººçï¼æ»æé®é¢å±åºä¸ç©·ï¼æ»æé¾å¤è®©äººä¸å ªéè´ã\n\næäººæåºèæ ¸å·²ç»è¿«å¨çç«ï¼é¾ç¼ çå®¢æ·è¿å¨ç¾è¬åé¾ã æäººèµ·æ©è´ªé»åå¤å¼èï¼ä¾ç¶åä¸å¤æ¿è´·ãè½¦è´·åå­©å­é«æçè¡¥ä¹ è´¹ã æäººæ¯å¤©å¨996éç­ç²åç«­ï¼å¨35å²å±æºçé´å½±ä¸å¦å±¥èå°ã æäººç¼åè¿å²æéå¥½ï¼å¯åªè¦åºç°ä¸ä¸ç¹æå¤ï¼å°±è½è®©çæ´»åå´©ç¦»æã å¼ ç±ç²è¯´ï¼å¨è¿ä¸ªåæªéç¦»çäººé´ï¼æ²¡æè°å¯ä»¥å°æ¥å­è¿å¾è¡äºæµæ°´ã èº«ä¸ºæå¹´äººï¼è°ä¸æ¯ä¸è¾¹å¨æ·±å¤éå´©æºï¼ä¸è¾¹å¨å¤ªé³åèµ·åï¼å¬ç´§çå³ç»§ç»­æ­»æã\n\næï¼æ¯çå½çæ°è ç¦è´µè¢«æå£®ä¸çé£ä¸¤å¹´ï¼æåçç¬çå°±æ¯å®¶çã å¥¹æ æ°æ¬¡è¿åæå¬ä¸å¤«çä¸è½ï¼å´ä¸æ¬¡åä¸æ¬¡å¤±æèå½ã æ²¡äººç¥éç¦è´µçä¸è½ï¼çè³æ²¡äººç¥éç¦è´µç°å¨æ¯çæ¯æ­»ã å¯å³ä½¿æé¾çæ¥å­ï¼å®¶çä¹æ²¡ææ³è¿ç¦»å¼å¾å®¶ã è¿ä¸ªåºèº«å¯è£å®¶åº­ï¼åå«å¥å¯è´µäººå®¶çå¥³å­¦çï¼è±ä¸äºåç¾çæè¢ï¼æ¢ä¸äºç²å¸è¡£è¡«ã å¥¹ç¨ä¸åæ²¡æ²¾è¿é³æ¥æ°´çæå¼±åæï¼æ¯æ¥ææç¹éçåæ´»ï¼è°é¾å°å°å¿å¥³ææ¯é¿å¤§ï¼ä¸ºå©å©å»èéç»ã ç­å°ç¦è´µåæ¥çæ¶åï¼è¿ä¸ªå®¶è½ç¶ç ´è´¥ï¼å´è¿æäº²äººå¨å®åã å¯¹äºæ¸¸å­èè¨ï¼è¿å°±æ¯æå¤§çå®æ°ã\n\nåæ¥ä»¥åï¼ç¦è´µå®ä¸å¿æ¥ä¸å®¶äººä¸èµ·è¸è¸å®å®è¿æ¥å­ã å¯æ è®ºç¦è´µåå®¶çå¦ä½æ¼å½å³ä½ï¼æ è®ºå¥³å¿å¤éåå¿å­æåºå¦ä½è´´å¿æäºï¼ç°éçé£ç¹æ´»è®¡ä¹å¡«ä¸é¥±å¨å®¶äººçèå­ã ç¼è§çæåºå·²ç»å°äºä¸å­¦çå¹´çºªï¼å®¶éè¿åä¸åºä¸å­¦çå­¦è´¹ï¼ç¦è´µåå®¶çå¿çæå¤ééç»å«äººå½å¥³å¿ã æ¯å¤©çµè æèï¼æå¿åèååçå¥³å¿å¨å«äººå®¶åäºæ¬ºè´ãå¯å½æ³å®¶çå¤éå·è·åæ¥åï¼ç¦è´µåæ¯æå¨ï¼åè¦ç¡¬èµ·å¿è ï¼æå¥³å¿éäºåå»ã æäºçå¤éæ²¡æå­é¹ãå¥¹è½ç¶æ æ¯èä¸å¾ç¶æ¯ï¼èä¸å¾å¼å¼ï¼è¿æ¯ä¹ä¹çµçç¶äº²çæï¼èµ°äºåå éè·¯èµ¶ååéã ä¸´å«çæ¶åï¼å¥¹ç¨å°åçæå°ï¼ææ¸çç¶äº²çè¸åºãè¿ä»½æµæµçä¾æï¼ä¸ä¸å­æå¨äºç¦è´µã ä»è½¬èº«èèµ·å¥³å¿ï¼ä¸æ­¥æ­¥åå°ç ´è´¥å´æ¸©æçå®¶ä¸­ï¼åå®å°å¯¹å®¶çè¯´ï¼âå°±æ¯å¨å®¶é½é¥¿æ­»ï¼ä¹ä¸æå¤ééèµ°ãâ æ¯åï¼å°±ç®çæ´»åé¾ï¼åªè¦æå®¶äººå¨ä¸èµ·ï¼åæä»ä¹åå¿æ¯è¿ä¸å»çå¢ã å°±ç®äººçåè¦ï¼åªè¦æå®¶äººéªä¼´ï¼æ»è½å¨æç»å¾®å¤æåå°æ¸©æã\n\nä¹è®¸æ¯æ·±å¤å°å®¶æ¶ï¼åç°å¦»å­å¨ä¿æ¸©æ¡¶éçäºä¸ç¢ç­æ±¤ã ä¹è®¸æ¯ç­ç²åç«­æ¶ï¼å­©å­éä¸ä¸ä¸ªæ²¾æ»¡å£æ°´çäº²å»ã ä¹è®¸æ¯å¨å¿å°æå¤©é»å°æ¶ï¼å¾®ä¿¡éééèººçæ¯äº²åæ¥çé®åã ä¹è®¸æ¯å°äºèµ°ææ è·¯çæ¶åï¼ç¶äº²è½»è½»ææè©èï¼âæ¾å¿ï¼ææãâ å³ä½¿è¿åéååè½»å¾®ï¼åªæè½æä¾çæ¯æå¾®ä¸è¶³éã å¯åªè¦æè¿ä»½æ¸©æï¼å°±è¶³ä»¥æ°èæ´ä¸ªçå½ã åªè¦æå®¶äººç«å¨èº«åï¼æä»¬çäººçå°±è¿æéè·¯ã\n\næ´»çå¾é¾ï¼ä½ç¬è¿å»å°±æå¸æ ææ®µæ¶é´ï¼ç¦è´µè§å¾çæ´»å¼å§æäºç¼å¤´ã å¤éå·²ç»é¿å¤§ï¼æ¯æ¥æ£çå·¥åå¯ä»¥å»æ´»èªå·±ã æåºä¸è¾¹è¯»ä¹¦ï¼ä¸è¾¹æ¾ç¾ï¼ç»å°±åºä¸åé£æ¯è¿ï¼å¨å­¦æ ¡çè¿å¨ä¼ä¸æ¿äºç¬¬ä¸åã å®¶çä¾ç¶è´¤æ è½å¹²ï¼å°ææå®¶äººç§é¡¾å°å¦¥å¦¥å¸å¸ãç¦è´µèªå·±ä¹å¨å°éè¸è¸å®å®è¦å¹²ã æ¥å­ä¾æ§ç©·å°æ½¦åï¼å¯æ¯ä¸å¤©é½çæºååã å¯å¨ä»æåå¾æªæ¥çæ¶åï¼å½è¿çç¬çç ¸ç­äºææå¸æã\n\næåºå·²ç»ä¸å°å°å­¦äºå¹´çº§ï¼ç¼ççå°±è½åå®¶æ£å·¥åãå´å¨ä¸åºç®è¡ä¸­ï¼è¢«æ½å¹²è¡å½åºæ¨æ­»ã å¤éå¹¸è¿å°æ¾äºä¸ªç¥å·ç¥ç­çä¸å¤«ï¼å¥½å®¹æè¿äºå å¤©åç¾çæ¥å­ï¼å°±å ä¸ºé¾äº§å¤§åºè¡èæ­»ã ä¸§å­ä¸§å¥³çæ²çåå®äºæ¬å°±æ£çå¤å¹´çå®¶çãå¥³å¿æ­»åä¸ä¸ªæï¼å¥¹ä¹ææäººå¯°ã ä¸´æ­»åï¼å¥¹å±æç¦è´µï¼âä½ è¿å¾å¥½å¥½æ´»ä¸å»ï¼è¿æè¦æ ¹åäºåãâ å¯å½è¿çæ®é·è¶ä¹æ³è±¡ãæ²¡è¿å å¹´ï¼å¥³å©¿äºååå¤å­è¦æ ¹ååå æå¤èº«äº¡ã å¨æ¬åºè¯¥å¿å­ç»èçå¹´é¾ï¼ç¦è´µå¤±å»äºææçäº²äººï¼ææçä¾é ï¼ææçææã è¿æ¶çèæ±ï¼å·²ç»è¦å¾è¿å¹æ¯é½åä¸åºæ¥äºã\n\nä»å¨æä¸æ¾äºååé±ãåªæ³ç­èªå·±æ­»åï¼æ¶å°¸çäººè½çå¨é±çä»½ä¸ï¼æèªå·±åå®¶äººè¬å¨ä¸èµ·ã å´æ²¡æ³å°ï¼è½ç¶è°å¸¸å¸¸ç¼ï¼ç¼çè¶æ¥è¶è±ï¼ä»è¿æ¯ä¸å¤©å¤©æ´»äºä¸æ¥ã æå¤ä¸å¤´çé±çæ¶åï¼ç¦è´µå»ä¹°äºä¸å¤´åèªå·±ä¸æ ·èççãä¸äººä¸çï¼æ¯å¤©è¯´è¯´è¯ï¼èèå°ï¼å½¼æ­¤ç¸ä¾ä¸ºå½ã ä¹è®¸ä»ä¸ä¿çè§åº¦çï¼ç¦è´µçè¿ä¸çæ´»å¾æ¢æ²æ¨åå¤±è´¥ã\n\nå ä¸ºå°å¹´èåï¼ä»æ©æ©è´¥åäºææçå®¶ä¸ï¼æ²¡è½åç¶äº²çææé£æ ·åå®èç¥ã å ä¸ºä¸­å¹´æå®¶ï¼ä»æ²¡æåä¸åå½åµçæ¥çé£æ ·ï¼éæ©éè§£æ¾ååä¸ï¼ä¹éå¤±äºèµ°ä¸ä»éçæºä¼ã å ä¸ºå½è¿ä¸æµï¼ä»å¤±å»äºææçäº²äººï¼åªè½å­¤ç¬å°ç­å¾èå»ã å¯æ¯ç«ç¦è´µè¿æ´»çã æ¯èµ·è°å¤ºäºä»ç°äº§çé¾äºãæ¾ç»æ¥é£å¾æè¿çæ¥çæ´»å¾é½é¿ä¹ã è¿å°±æ¯äººçæå¤§çæ¶è·ãå ä¸ºåªæçå½ï¼ææ¯ä¸çä¸ç¬ä¸æ äºçç¨ç¼ºåã çéäºäººççç¦è´µï¼ææ¯ä¸å¤©é½æ´»å¾æå¶è®¤çã ç§å°çæ¶åï¼ä»æ³å°½åæ³é¼èèµ·èççå¿æ°ãåå®¶çè·¯ä¸ï¼ä»çæ­å£°å¨ç°åä¸å¦æé£è¬é£æ¬ã è¿ä¸ªèäººçå½è¿ï¼æææ¯ä¸ä¸çå¤§å¤æ°äººé½æ²è¦ãå´æ´»æäºæ¯å¤§å¤æ°äººï¼é½æäº®çæ ·å­ã è¿å°±æ¯çå½ççç¸ï¼ä½ æä¹æ³ï¼å°±ä¼æä¹æ´»ã\n\néæ©å­æ³£åä¼¤ï¼æ³¨å®å°ä¸è·¯ç°æã éæ©ææ¬åä¸ï¼å°±ç®é£é¨å¦æ¦ï¼ä¹è½å¾æåå¼æ»¡ç®æåã çæ´»å¾é¾ï¼æ´»çæ´é¾ã å¯åªè¦è¯ç¨åæåï¼è¿äººé´ç»ç©¶å¼å¾å¸æã",charsets:{cjk:!0}},{title:"äººçæ ¼è¨",frontmatter:{title:"äººçæ ¼è¨",date:"2023-02-24T16:42:33.000Z",permalink:"/pages/58b3c0/",categories:["çæ´»","éç¬"],tags:[null],readingShow:"top",description:"",meta:[{name:"twitter:title",content:"äººçæ ¼è¨"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/05.%E4%BA%BA%E7%94%9F%E6%A0%BC%E8%A8%80.html"},{property:"og:type",content:"article"},{property:"og:title",content:"äººçæ ¼è¨"},{property:"og:description",content:""},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/05.%E4%BA%BA%E7%94%9F%E6%A0%BC%E8%A8%80.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-24T16:42:33.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"äººçæ ¼è¨"},{itemprop:"description",content:""}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/01.%E9%9A%8F%E7%AC%94/05.%E4%BA%BA%E7%94%9F%E6%A0%BC%E8%A8%80.html",relativePath:"02.çæ´»/01.éç¬/05.äººçæ ¼è¨.md",key:"v-228a9bce",path:"/pages/58b3c0/",headersStr:null,content:"è«æ³æ¡å¨ãä¸çãéåéï¼ âçæ´»ä¸å¯è½åä½ æ³è±¡å¾é£ä¹å¥½ï¼ ä½ä¹ä¸ä¼åä½ æ³è±¡å¾é£ä¹ç³ã ææ¶ï¼æä»¬å¯è½èå¼±å¾ä¸å¥è¯å°±æ³ªæµæ»¡é¢ï¼ ææ¶ï¼ä¹åç°èªå·±å¬ççèµ°äºå¾é¿çè·¯ãâ äººççåºï¼å°±å¨è¿éï¼ çæçä¸è¯èµ°çï¼ åæ¯ä½ æä¸çæçä¸è¥¿ã",normalizedContent:"è«æ³æ¡å¨ãä¸çãéåéï¼ âçæ´»ä¸å¯è½åä½ æ³è±¡å¾é£ä¹å¥½ï¼ ä½ä¹ä¸ä¼åä½ æ³è±¡å¾é£ä¹ç³ã ææ¶ï¼æä»¬å¯è½èå¼±å¾ä¸å¥è¯å°±æ³ªæµæ»¡é¢ï¼ ææ¶ï¼ä¹åç°èªå·±å¬ççèµ°äºå¾é¿çè·¯ãâ äººççåºï¼å°±å¨è¿éï¼ çæçä¸è¯èµ°çï¼ åæ¯ä½ æä¸çæçä¸è¥¿ã",charsets:{cjk:!0}},{title:"è¿ç»´10éåºç¡é¢è¯é¢",frontmatter:{title:"è¿ç»´10éåºç¡é¢è¯é¢",date:"2020-01-13T14:28:22.000Z",categories:["é¢è¯"],tags:["é¢è¯é¢é"],permalink:"/pages/f6c9c9/",readingShow:"top",description:"ååä»£çãè´è½½åè¡¡",meta:[{name:"image",content:"https://i.loli.net/2020/06/14/BywTI6QVEYtHr9v.png"},{name:"twitter:title",content:"è¿ç»´10éåºç¡é¢è¯é¢"},{name:"twitter:description",content:"ååä»£çãè´è½½åè¡¡"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://i.loli.net/2020/06/14/BywTI6QVEYtHr9v.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/02.%E9%9D%A2%E8%AF%95/01.%E8%BF%90%E7%BB%B410%E9%81%93%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98.html"},{property:"og:type",content:"article"},{property:"og:title",content:"è¿ç»´10éåºç¡é¢è¯é¢"},{property:"og:description",content:"ååä»£çãè´è½½åè¡¡"},{property:"og:image",content:"https://i.loli.net/2020/06/14/BywTI6QVEYtHr9v.png"},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/02.%E9%9D%A2%E8%AF%95/01.%E8%BF%90%E7%BB%B410%E9%81%93%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2020-01-13T14:28:22.000Z"},{property:"article:tag",content:"é¢è¯é¢é"},{itemprop:"name",content:"è¿ç»´10éåºç¡é¢è¯é¢"},{itemprop:"description",content:"ååä»£çãè´è½½åè¡¡"},{itemprop:"image",content:"https://i.loli.net/2020/06/14/BywTI6QVEYtHr9v.png"}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/02.%E9%9D%A2%E8%AF%95/01.%E8%BF%90%E7%BB%B410%E9%81%93%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98.html",relativePath:"02.çæ´»/02.é¢è¯/01.è¿ç»´10éåºç¡é¢è¯é¢.md",key:"v-4c3a43d2",path:"/pages/f6c9c9/",headers:[{level:2,title:"1.dateå½ä»¤è·åæ¨å¤©æ¶é´",slug:"_1-dateå½ä»¤è·åæ¨å¤©æ¶é´",normalizedTitle:"1.dateå½ä»¤è·åæ¨å¤©æ¶é´",charIndex:2},{level:2,title:"2.nginxç¨è¿åªäºæ¨¡åï¼ååä»£çãè´è½½åè¡¡å¦ä½éç½®",slug:"_2-nginxç¨è¿åªäºæ¨¡å-ååä»£çãè´è½½åè¡¡å¦ä½éç½®",normalizedTitle:"2.nginxç¨è¿åªäºæ¨¡åï¼ååä»£çãè´è½½åè¡¡å¦ä½éç½®",charIndex:56},{level:2,title:"3.å®è£centosç³»ç»åä¼ååªäºä¼åï¼è¯·ä¸¾ä¾è¯´æ",slug:"_3-å®è£centosç³»ç»åä¼ååªäºä¼å-è¯·ä¸¾ä¾è¯´æ",normalizedTitle:"3.å®è£centosç³»ç»åä¼ååªäºä¼åï¼è¯·ä¸¾ä¾è¯´æ",charIndex:463},{level:2,title:"4.ææ¶å»æµéè¶è¿éå¼ï¼è¯¥å¦ä½åºå¯¹",slug:"_4-ææ¶å»æµéè¶è¿éå¼-è¯¥å¦ä½åºå¯¹",normalizedTitle:"4.ææ¶å»æµéè¶è¿éå¼ï¼è¯¥å¦ä½åºå¯¹",charIndex:733},{level:2,title:"5.ç±äºç£çç©ºé´ç´§å¼ ç°å¨è¦æ±åªè½ä¿çæè¿7å¤©çè®¿é®æ¥å¿ï¼è¯·é®å¦ä½è§£å³ï¼è¯·ç»",slug:"_5-ç±äºç£çç©ºé´ç´§å¼ ç°å¨è¦æ±åªè½ä¿çæè¿7å¤©çè®¿é®æ¥å¿-è¯·é®å¦ä½è§£å³-è¯·ç»",normalizedTitle:"5.ç±äºç£çç©ºé´ç´§å¼ ç°å¨è¦æ±åªè½ä¿çæè¿7å¤©çè®¿é®æ¥å¿ï¼è¯·é®å¦ä½è§£å³ï¼è¯·ç»",charIndex:1145},{level:2,title:"6.æ¯å¤©æä¸12ç¹ï¼æåç«ç¹ç®å½/var/www/html å¤ä»½å°/dataç®å½ä¸",slug:"_6-æ¯å¤©æä¸12ç¹-æåç«ç¹ç®å½-var-www-html-å¤ä»½å°-dataç®å½ä¸",normalizedTitle:"6.æ¯å¤©æä¸12ç¹ï¼æåç«ç¹ç®å½/var/www/html å¤ä»½å°/dataç®å½ä¸",charIndex:1322},{level:2,title:"7.åä¸ä¸ªèæ¬ï¼å®ç°å¤æ­192.168.1.0/24ç½ç»éï¼å½åå¨çº¿çipæåªäºï¼è½pingéåè®¤ä¸ºå¨çº¿",slug:"_7-åä¸ä¸ªèæ¬-å®ç°å¤æ­192-168-1-0-24ç½ç»é-å½åå¨çº¿çipæåªäº-è½pingéåè®¤ä¸ºå¨çº¿",normalizedTitle:"7.åä¸ä¸ªèæ¬ï¼å®ç°å¤æ­192.168.1.0/24ç½ç»éï¼å½åå¨çº¿çipæåªäºï¼è½pingéåè®¤ä¸ºå¨çº¿",charIndex:1432},{level:2,title:"#!/bin/bash",slug:"bin-bash",normalizedTitle:"#!/bin/bash",charIndex:1489},{level:2,title:"8.ç»è®¡åºnginxçaccess.logä¸­æ¯ä¸ªæ¥å£çååºç æåµï¼urlä¸ºç¬¬5åï¼ååºç ä¸ºç¬¬6åï¼åéç¬¦ä¸ºâ|â",slug:"_8-ç»è®¡åºnginxçaccess-logä¸­æ¯ä¸ªæ¥å£çååºç æåµ-urlä¸ºç¬¬5å-ååºç ä¸ºç¬¬6å-åéç¬¦ä¸º",normalizedTitle:"8.ç»è®¡åºnginxçaccess.logä¸­æ¯ä¸ªæ¥å£çååºç æåµï¼urlä¸ºç¬¬5åï¼ååºç ä¸ºç¬¬6åï¼åéç¬¦ä¸ºâ|â",charIndex:1753},{level:2,title:"9.å¦ä½æ¥çhttpçå¹¶åè¯·æ±æ°ä¸å¶tcpè¿æ¥ç¶æï¼",slug:"_9-å¦ä½æ¥çhttpçå¹¶åè¯·æ±æ°ä¸å¶tcpè¿æ¥ç¶æ",normalizedTitle:"9.å¦ä½æ¥çhttpçå¹¶åè¯·æ±æ°ä¸å¶tcpè¿æ¥ç¶æï¼",charIndex:1856},{level:2,title:"10.è¯´è¯´tcp/ipçä¸å±æ¨¡å",slug:"_10-è¯´è¯´tcp-ipçä¸å±æ¨¡å",normalizedTitle:"10.è¯´è¯´tcp/ipçä¸å±æ¨¡å",charIndex:1974}],headersStr:"1.dateå½ä»¤è·åæ¨å¤©æ¶é´ 2.nginxç¨è¿åªäºæ¨¡åï¼ååä»£çãè´è½½åè¡¡å¦ä½éç½® 3.å®è£centosç³»ç»åä¼ååªäºä¼åï¼è¯·ä¸¾ä¾è¯´æ 4.ææ¶å»æµéè¶è¿éå¼ï¼è¯¥å¦ä½åºå¯¹ 5.ç±äºç£çç©ºé´ç´§å¼ ç°å¨è¦æ±åªè½ä¿çæè¿7å¤©çè®¿é®æ¥å¿ï¼è¯·é®å¦ä½è§£å³ï¼è¯·ç» 6.æ¯å¤©æä¸12ç¹ï¼æåç«ç¹ç®å½/var/www/html å¤ä»½å°/dataç®å½ä¸ 7.åä¸ä¸ªèæ¬ï¼å®ç°å¤æ­192.168.1.0/24ç½ç»éï¼å½åå¨çº¿çipæåªäºï¼è½pingéåè®¤ä¸ºå¨çº¿ #!/bin/bash 8.ç»è®¡åºnginxçaccess.logä¸­æ¯ä¸ªæ¥å£çååºç æåµï¼urlä¸ºç¬¬5åï¼ååºç ä¸ºç¬¬6åï¼åéç¬¦ä¸ºâ|â 9.å¦ä½æ¥çhttpçå¹¶åè¯·æ±æ°ä¸å¶tcpè¿æ¥ç¶æï¼ 10.è¯´è¯´tcp/ipçä¸å±æ¨¡å",content:'# 1.dateå½ä»¤è·åæ¨å¤©æ¶é´\n\ndate -d"1 day ago" +"%F %H:%M:%S"\n\n\n# 2.nginxç¨è¿åªäºæ¨¡åï¼ååä»£çãè´è½½åè¡¡å¦ä½éç½®\n\nååä»£çãè´è½½åè¡¡\n\nååä»£çéç½®\n\nserver{\n\nlisten 80;\n\nserver_name www.baidu.com;\n\nroot /var/log/www;\n\nlocation / {\n\nproxy_pass htttp://localhost:8089;\n\n}\n\n}\n\nè´è½½åè¡¡\n\nupstream www.baidu.com {\n\nip_hash;\n\nserver 192.168.1.10:8080;\n\nserver 192.168.1.11:8081;\n\n}\n\nserver{\n\nlisten 80;\n\nserver_name www.baidu.com;\n\nlocation / {\n\nproxy_pass http://www.baidu.com;\n\nindex index.html index.htm;\n\n}\n\n}\n\n\n# 3.å®è£centosç³»ç»åä¼ååªäºä¼åï¼è¯·ä¸¾ä¾è¯´æ\n\nä¿®æ¹ipå°åãç½å³ãä¸»æºåãDNSç­\n\nå³é­selinuxï¼æ¸ç©ºiptables\n\næ·»å æ®éç¨æ·å¹¶è¿è¡sudoææç®¡ç\n\næ´æ°yumæºåå¿è¦è½¯ä»¶å®è£\n\nå®æ¶èªå¨æ´æ°æå¡å¨æ¶é´\n\nç²¾ç®å¼æºèªå¯å¨æå¡\n\nå®æ¶èªå¨æ¸ç/var/spool/clientmqueue/ç®å½åå¾æä»¶ï¼æ¾ç½®inodeèç¹è¢«å æ»¡\n\nåæ´é»è®¤çsshæå¡ç«¯å£ï¼ç¦æ­¢rootç¨æ·è¿ç¨è¿æ¥\n\néå®å³é®æä»¶ç³»ç»\n\nè°æ´æä»¶æè¿°ç¬¦å¤§å°\n\nè°æ´å­ç¬¦éï¼ä½¿å¶æ¯æä¸­æ\n\nå»é¤ç³»ç»ååæ ¸çæ¬ç»å½åçå±å¹æ¾ç¤º\n\nåæ ¸åæ°ä¼å\n\n\n# 4.ææ¶å»æµéè¶è¿éå¼ï¼è¯¥å¦ä½åºå¯¹\n\n1ãä¸å¯é¢æµæµéï¼ç½ç«è¢«æ¶æå·éï¼CDNåæºæåæ°æ®ï¼åä½ä¸å¡å¹³å°è°åå¹³å°æ°æ®ç­ï¼\n\n2ãå¯é¢æµæµéï¼çªç¶çåçç¤¾ä¼ç­ç¹ï¼è¥éæ´»å¨çå®£ä¼ ï¼ï¼\n\nä¸ç®¡æ¯å¯é¢æµæµéè¿æ¯ä¸å¯é¢æµæµéé½ä¼è¡¨ç°å¨å¸¦å®½åç½ç«æ´ä½æ¶æçåºå¯¹æ¹æ¡\n\nå¦æç±äºå¸¦å®½åå å¼èµ·ï¼ç±äºç½ç«çå¹¶åéå¤ªé«ï¼è¾¾å°æå¡å¨çååæéï¼å¯¼è´æå¡å¨å®æºï¼è¿æ¶éè¦åä¸´æ¶ç³è¯·å å¤§å¸¦å®½ï¼ç¶åè´è½½åè¡¡åæµã\n\nå¦æç±äºå¤ç½è¯·æ±æ°æ®åºï¼å¯¼è´æ°æ®åºé¢ç¹è¯»åï¼æ°æ®åºå¤çè½åä½ï¼å¯¼è´å¤§éè¯·æ±ç§¯åï¼å¦ææ¯è¿ç§æåµï¼å°±éè¦ä¼åSQLï¼å­å¨è¿ç¨ç­ï¼å¦ææ¯è¯·æ±è¿å¤§ï¼å°±è¦èèåéç¾¤ç­ã\n\nå¯é¢æµæµéçæ´å¢ä¹ä¼ææ¢ç½é¡µçæå¼éåº¦ï¼çè³å¯¼è´ç½ç«æå¡å¨å®æºãè¦åºå¯¹æ­£å¸¸æµéæ´å¢ï¼å¨æµéé«å³°æå°æ¥ä¹åå°±å¯ä»¥éå½çè°æ´ï¼ä¸è¬éå¯¹åºç¨æå¡å¨çè°æ´å¯ä»¥é²æ­¢åç¹ï¼è´è½½åè¡¡ï¼é«å¯ç¨ï¼å¢å åç«¯webåºç¨æå¡å¨æ°éï¼æ°æ®åºè¯»ååç¦»ï¼æåºæè¡¨ç­ï¼é²æ­¢æµéæ´å¢å¯¼è´æå¡å¨ææ\n\n\n# 5.ç±äºç£çç©ºé´ç´§å¼ ç°å¨è¦æ±åªè½ä¿çæè¿7å¤©çè®¿é®æ¥å¿ï¼è¯·é®å¦ä½è§£å³ï¼è¯·ç»\n\nåºè§£å³åæ³æèéç½®æå¤çå½ä»¤\n\ndate=date +%F_%T_%A\n\ncp ./access.log ./bak/access_"$date".log\n\nfind ./bak/ -name *.log -type f -mtime +7 -exec rm {};\n\n\n# 6.æ¯å¤©æä¸12ç¹ï¼æåç«ç¹ç®å½/var/www/html å¤ä»½å°/dataç®å½ä¸\n\n00 00 * * * /usr/bin/tar -zvcf /data/html.tar.gz /var/www/html\n\n\n# 7.åä¸ä¸ªèæ¬ï¼å®ç°å¤æ­192.168.1.0/24ç½ç»éï¼å½åå¨çº¿çipæåªäºï¼è½pingéåè®¤ä¸ºå¨çº¿\n\n\n# #!/bin/bash\n\nfor ip in {1..255}\n\ndo\n\nping -c3 192.168.1.$ip\n\nif [ $? -ne 0 ]\n\nthen echo "the host is 192.168.1.$ip up" >> ./up.list\n\nelse echo "the host is 192.168.1.$ip down" >> ./down.list\n\nfi\n\ndone\n\næè\n\nyum install nmap -y\n\nnmap -sP 192.168.1.0/24 > ./upip\n\n\n# 8.ç»è®¡åºnginxçaccess.logä¸­æ¯ä¸ªæ¥å£çååºç æåµï¼urlä¸ºç¬¬5åï¼ååºç ä¸ºç¬¬6åï¼åéç¬¦ä¸ºâ|â\n\ncat access.log | awk -F \'|\' \'{print $6}\'\n\n\n# 9.å¦ä½æ¥çhttpçå¹¶åè¯·æ±æ°ä¸å¶tcpè¿æ¥ç¶æï¼\n\nå¹¶ånetstat -na | grep ESTABLIS | wc -l\n\ntcpæ°netstat -an|grep ":80 "ï½grep -v grep|wc -l\n\n\n# 10.è¯´è¯´tcp/ipçä¸å±æ¨¡å\n\n',normalizedContent:'# 1.dateå½ä»¤è·åæ¨å¤©æ¶é´\n\ndate -d"1 day ago" +"%f %h:%m:%s"\n\n\n# 2.nginxç¨è¿åªäºæ¨¡åï¼ååä»£çãè´è½½åè¡¡å¦ä½éç½®\n\nååä»£çãè´è½½åè¡¡\n\nååä»£çéç½®\n\nserver{\n\nlisten 80;\n\nserver_name www.baidu.com;\n\nroot /var/log/www;\n\nlocation / {\n\nproxy_pass htttp://localhost:8089;\n\n}\n\n}\n\nè´è½½åè¡¡\n\nupstream www.baidu.com {\n\nip_hash;\n\nserver 192.168.1.10:8080;\n\nserver 192.168.1.11:8081;\n\n}\n\nserver{\n\nlisten 80;\n\nserver_name www.baidu.com;\n\nlocation / {\n\nproxy_pass http://www.baidu.com;\n\nindex index.html index.htm;\n\n}\n\n}\n\n\n# 3.å®è£centosç³»ç»åä¼ååªäºä¼åï¼è¯·ä¸¾ä¾è¯´æ\n\nä¿®æ¹ipå°åãç½å³ãä¸»æºåãdnsç­\n\nå³é­selinuxï¼æ¸ç©ºiptables\n\næ·»å æ®éç¨æ·å¹¶è¿è¡sudoææç®¡ç\n\næ´æ°yumæºåå¿è¦è½¯ä»¶å®è£\n\nå®æ¶èªå¨æ´æ°æå¡å¨æ¶é´\n\nç²¾ç®å¼æºèªå¯å¨æå¡\n\nå®æ¶èªå¨æ¸ç/var/spool/clientmqueue/ç®å½åå¾æä»¶ï¼æ¾ç½®inodeèç¹è¢«å æ»¡\n\nåæ´é»è®¤çsshæå¡ç«¯å£ï¼ç¦æ­¢rootç¨æ·è¿ç¨è¿æ¥\n\néå®å³é®æä»¶ç³»ç»\n\nè°æ´æä»¶æè¿°ç¬¦å¤§å°\n\nè°æ´å­ç¬¦éï¼ä½¿å¶æ¯æä¸­æ\n\nå»é¤ç³»ç»ååæ ¸çæ¬ç»å½åçå±å¹æ¾ç¤º\n\nåæ ¸åæ°ä¼å\n\n\n# 4.ææ¶å»æµéè¶è¿éå¼ï¼è¯¥å¦ä½åºå¯¹\n\n1ãä¸å¯é¢æµæµéï¼ç½ç«è¢«æ¶æå·éï¼cdnåæºæåæ°æ®ï¼åä½ä¸å¡å¹³å°è°åå¹³å°æ°æ®ç­ï¼\n\n2ãå¯é¢æµæµéï¼çªç¶çåçç¤¾ä¼ç­ç¹ï¼è¥éæ´»å¨çå®£ä¼ ï¼ï¼\n\nä¸ç®¡æ¯å¯é¢æµæµéè¿æ¯ä¸å¯é¢æµæµéé½ä¼è¡¨ç°å¨å¸¦å®½åç½ç«æ´ä½æ¶æçåºå¯¹æ¹æ¡\n\nå¦æç±äºå¸¦å®½åå å¼èµ·ï¼ç±äºç½ç«çå¹¶åéå¤ªé«ï¼è¾¾å°æå¡å¨çååæéï¼å¯¼è´æå¡å¨å®æºï¼è¿æ¶éè¦åä¸´æ¶ç³è¯·å å¤§å¸¦å®½ï¼ç¶åè´è½½åè¡¡åæµã\n\nå¦æç±äºå¤ç½è¯·æ±æ°æ®åºï¼å¯¼è´æ°æ®åºé¢ç¹è¯»åï¼æ°æ®åºå¤çè½åä½ï¼å¯¼è´å¤§éè¯·æ±ç§¯åï¼å¦ææ¯è¿ç§æåµï¼å°±éè¦ä¼åsqlï¼å­å¨è¿ç¨ç­ï¼å¦ææ¯è¯·æ±è¿å¤§ï¼å°±è¦èèåéç¾¤ç­ã\n\nå¯é¢æµæµéçæ´å¢ä¹ä¼ææ¢ç½é¡µçæå¼éåº¦ï¼çè³å¯¼è´ç½ç«æå¡å¨å®æºãè¦åºå¯¹æ­£å¸¸æµéæ´å¢ï¼å¨æµéé«å³°æå°æ¥ä¹åå°±å¯ä»¥éå½çè°æ´ï¼ä¸è¬éå¯¹åºç¨æå¡å¨çè°æ´å¯ä»¥é²æ­¢åç¹ï¼è´è½½åè¡¡ï¼é«å¯ç¨ï¼å¢å åç«¯webåºç¨æå¡å¨æ°éï¼æ°æ®åºè¯»ååç¦»ï¼æåºæè¡¨ç­ï¼é²æ­¢æµéæ´å¢å¯¼è´æå¡å¨ææ\n\n\n# 5.ç±äºç£çç©ºé´ç´§å¼ ç°å¨è¦æ±åªè½ä¿çæè¿7å¤©çè®¿é®æ¥å¿ï¼è¯·é®å¦ä½è§£å³ï¼è¯·ç»\n\nåºè§£å³åæ³æèéç½®æå¤çå½ä»¤\n\ndate=date +%f_%t_%a\n\ncp ./access.log ./bak/access_"$date".log\n\nfind ./bak/ -name *.log -type f -mtime +7 -exec rm {};\n\n\n# 6.æ¯å¤©æä¸12ç¹ï¼æåç«ç¹ç®å½/var/www/html å¤ä»½å°/dataç®å½ä¸\n\n00 00 * * * /usr/bin/tar -zvcf /data/html.tar.gz /var/www/html\n\n\n# 7.åä¸ä¸ªèæ¬ï¼å®ç°å¤æ­192.168.1.0/24ç½ç»éï¼å½åå¨çº¿çipæåªäºï¼è½pingéåè®¤ä¸ºå¨çº¿\n\n\n# #!/bin/bash\n\nfor ip in {1..255}\n\ndo\n\nping -c3 192.168.1.$ip\n\nif [ $? -ne 0 ]\n\nthen echo "the host is 192.168.1.$ip up" >> ./up.list\n\nelse echo "the host is 192.168.1.$ip down" >> ./down.list\n\nfi\n\ndone\n\næè\n\nyum install nmap -y\n\nnmap -sp 192.168.1.0/24 > ./upip\n\n\n# 8.ç»è®¡åºnginxçaccess.logä¸­æ¯ä¸ªæ¥å£çååºç æåµï¼urlä¸ºç¬¬5åï¼ååºç ä¸ºç¬¬6åï¼åéç¬¦ä¸ºâ|â\n\ncat access.log | awk -f \'|\' \'{print $6}\'\n\n\n# 9.å¦ä½æ¥çhttpçå¹¶åè¯·æ±æ°ä¸å¶tcpè¿æ¥ç¶æï¼\n\nå¹¶ånetstat -na | grep establis | wc -l\n\ntcpæ°netstat -an|grep ":80 "ï½grep -v grep|wc -l\n\n\n# 10.è¯´è¯´tcp/ipçä¸å±æ¨¡å\n\n',charsets:{cjk:!0}},{title:"httpç¶æç ",frontmatter:{title:"httpç¶æç ",date:"2020-01-06T14:28:22.000Z",categories:"ææ¯",tags:["é¢è¯é¢é"],permalink:"/pages/a2e381/",readingShow:"top",description:"ååºä»¥ä¸httpç¶æç çå«ä¹",meta:[{name:"twitter:title",content:"httpç¶æç "},{name:"twitter:description",content:"ååºä»¥ä¸httpç¶æç çå«ä¹"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/02.%E9%9D%A2%E8%AF%95/02.http%E7%8A%B6%E6%80%81%E7%A0%81.html"},{property:"og:type",content:"article"},{property:"og:title",content:"httpç¶æç "},{property:"og:description",content:"ååºä»¥ä¸httpç¶æç çå«ä¹"},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/02.%E9%9D%A2%E8%AF%95/02.http%E7%8A%B6%E6%80%81%E7%A0%81.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2020-01-06T14:28:22.000Z"},{property:"article:tag",content:"é¢è¯é¢é"},{itemprop:"name",content:"httpç¶æç "},{itemprop:"description",content:"ååºä»¥ä¸httpç¶æç çå«ä¹"}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/02.%E9%9D%A2%E8%AF%95/02.http%E7%8A%B6%E6%80%81%E7%A0%81.html",relativePath:"02.çæ´»/02.é¢è¯/02.httpç¶æç .md",key:"v-765df57e",path:"/pages/a2e381/",headersStr:null,content:"ååºä»¥ä¸httpç¶æç çå«ä¹\n\n301/302/304/400/403/404/405/500/503/504\n\n301 Moved Permanently è¯·æ±çç½é¡µå·²æ°¸ä¹ç§»å¨å°æ°ä½ç½®ã\n\n302 Found ä¸´æ¶æ§éå®åã\n\n304 Not Modified èªä»ä¸æ¬¡è¯·æ±åï¼è¯·æ±çç½é¡µæªä¿®æ¹è¿\n\n400 Bad Request æå¡å¨æ æ³çè§£è¯·æ±çæ ¼å¼ï¼å®¢æ·ç«¯ä¸åºå½å°è¯åæ¬¡ä½¿ç¨ç¸åçåå®¹åèµ·è¯·æ±ã\n\n403 Forbidden ç¦æ­¢è®¿é®\n\n404 Not Found æ¾ä¸å°å¦ä½ä¸ URI ç¸å¹éçèµæº\n\n500 Internal Server Error æå¸¸è§çæå¡å¨ç«¯éè¯¯ã\n\n503 Service Unavailable æå¡å¨ç«¯ææ¶æ æ³å¤çè¯·æ±ï¼å¯è½æ¯è¿è½½æç»´æ¤ï¼ã",normalizedContent:"ååºä»¥ä¸httpç¶æç çå«ä¹\n\n301/302/304/400/403/404/405/500/503/504\n\n301 moved permanently è¯·æ±çç½é¡µå·²æ°¸ä¹ç§»å¨å°æ°ä½ç½®ã\n\n302 found ä¸´æ¶æ§éå®åã\n\n304 not modified èªä»ä¸æ¬¡è¯·æ±åï¼è¯·æ±çç½é¡µæªä¿®æ¹è¿\n\n400 bad request æå¡å¨æ æ³çè§£è¯·æ±çæ ¼å¼ï¼å®¢æ·ç«¯ä¸åºå½å°è¯åæ¬¡ä½¿ç¨ç¸åçåå®¹åèµ·è¯·æ±ã\n\n403 forbidden ç¦æ­¢è®¿é®\n\n404 not found æ¾ä¸å°å¦ä½ä¸ uri ç¸å¹éçèµæº\n\n500 internal server error æå¸¸è§çæå¡å¨ç«¯éè¯¯ã\n\n503 service unavailable æå¡å¨ç«¯ææ¶æ æ³å¤çè¯·æ±ï¼å¯è½æ¯è¿è½½æç»´æ¤ï¼ã",charsets:{cjk:!0}},{title:"é«çº§è¿ç»´å·¥ç¨éè¦ææ¡çæè½",frontmatter:{title:"é«çº§è¿ç»´å·¥ç¨éè¦ææ¡çæè½",date:"2022-12-15T10:29:16.000Z",permalink:"/pages/9245d9/",categories:["ä¸é¢","é¢è¯"],tags:[null],readingShow:"top",description:"æ³æä¸ºåæ ¼è¿ç»´å·¥ç¨å¸ï¼Linuxè¿ç»´é«çº§å·¥ç¨å¸è¦ææ¡ä»¥ä¸æè½ï¼",meta:[{name:"twitter:title",content:"é«çº§è¿ç»´å·¥ç¨éè¦ææ¡çæè½"},{name:"twitter:description",content:"æ³æä¸ºåæ ¼è¿ç»´å·¥ç¨å¸ï¼Linuxè¿ç»´é«çº§å·¥ç¨å¸è¦ææ¡ä»¥ä¸æè½ï¼"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/02.%E9%9D%A2%E8%AF%95/03.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E9%9C%80%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E6%8A%80%E8%83%BD.html"},{property:"og:type",content:"article"},{property:"og:title",content:"é«çº§è¿ç»´å·¥ç¨éè¦ææ¡çæè½"},{property:"og:description",content:"æ³æä¸ºåæ ¼è¿ç»´å·¥ç¨å¸ï¼Linuxè¿ç»´é«çº§å·¥ç¨å¸è¦ææ¡ä»¥ä¸æè½ï¼"},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/02.%E9%9D%A2%E8%AF%95/03.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E9%9C%80%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E6%8A%80%E8%83%BD.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T10:29:16.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"é«çº§è¿ç»´å·¥ç¨éè¦ææ¡çæè½"},{itemprop:"description",content:"æ³æä¸ºåæ ¼è¿ç»´å·¥ç¨å¸ï¼Linuxè¿ç»´é«çº§å·¥ç¨å¸è¦ææ¡ä»¥ä¸æè½ï¼"}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/02.%E9%9D%A2%E8%AF%95/03.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4%E5%B7%A5%E7%A8%8B%E9%9C%80%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E6%8A%80%E8%83%BD.html",relativePath:"02.çæ´»/02.é¢è¯/03.é«çº§è¿ç»´å·¥ç¨éè¦ææ¡çæè½.md",key:"v-e52dd084",path:"/pages/9245d9/",headersStr:null,content:"# linuxè¿ç»´é«çº§å·¥ç¨è¦ææ¡çæè½\n\næ³æä¸ºåæ ¼è¿ç»´å·¥ç¨å¸ï¼Linuxè¿ç»´é«çº§å·¥ç¨å¸è¦ææ¡ä»¥ä¸æè½ï¼\n\n1ãLinux ç³»ç»åºç¡â¼é¨-Linuxçåºç¡ç¥è¯åå®¹ï¼åå½ä»¤ä½¿ç¨ï¼ä»¥åç¨æ·åæéç­æ ¸â¼¼ç¥è¯ç¹\n\n2ãLinux ç³»ç»ç®¡çåè¿é¶-Linuxä»è¿ç¨ãèµæºãä»»å¡ãâ½ä»¶ãè½¯ä»¶åãç£çç­ç®¡çâ½æ³\n\n3ãLinux ä¼ä¸å¸¸ç¨æå¡-ä¼ä¸çº§å¸¸ç¨æå¡å¦DNSãFTPãHttpãmail\n\n4ãLinux ä¼ä¸çº§å®å¨åçåé²èæå·§ä»¥åç½ç»åå®å¨-Linuxå®å¨æ¶æãå®å¨å¨èæ¨¡åãä»¥åå å¯ãè§£å¯ç­åçï¼å¸¸è§æ»å»åé²èâ¼¿æ®µ\n\n5ãShell ç¼ç¨â¼é¨åè¿é¶-Shellèæ¬åºæ¬ç¨æ³ä»¥åè¿é¶ï¼ä»åºç¡å°ç²¾éï¼éè¦å­¦ä¹ ä¸äºä¼ä¸çº§å¸¸è§èæ¬ç¨æ³\n\n6ãMySQL åºç¨åçåç®¡çâ¼é¨-Mysqlå®è£ãç®¡çãææãå¢å æ¹æ¥\n\n7ãhttp æå¡ä»£çç¼å­å é-http â¾¼çº§åè®®åºç¨ãç¼å­ãwebæå¡nginx\n\n8ãä¼ä¸çº§è´è½½éç¾¤-ä¼ä¸çº§4å±è´è½½åè¡¡LVSãå7å±è´è½½åè¡¡nginxä»¥åhaproxyçåºç¨\n\n9ãä¼ä¸çº§â¾¼å¯ç¨éç¾¤-â¾¼å¯ç¨éç¾¤åçï¼å®ç°ä»¥keepalivedä¸ºæ ¸â¼¼çâ¾¼å¯ç¨éç¾¤ï¼ä»¥åä¸»ä»é«å¯ç¨ãåä¸»\n\n10ãè¿ç»´çæ§zabbix-ä¼ä¸çº§çæ§ä½ç³»ä»¥åzabbixæµâ¾å¼æºçæ§ç³»ç»çåç¨åæ¶æ\n\n11ãäºè®¡ç®è¿ç»´èªå¨å-ansibleãpuppetç­è¿ç»´èªå¨åè§£å³æ¹æ¡\n\n12ãWEB æå¡ä½ç³»æ¶æ-WEBæå¡ä½ç³»æ¶æï¼JSPä½ç³»ãtomcatãCDNãç¼å­åçãåæµãè¯ä¼°\n\n13ãâ¼¤åäºèâ½¹éç¾¤æ¶æåå®æâ½æ¡-LBéç¾¤ï¼nginxãHaproxyãLVS HAéç¾¤ãå¨éåç¦»\n\n14ãMySQL DBA å®ææè½åä¼å-æ°æ®åºåæ°ä¼åãååºåè¡¨ãå¤ä»½æ¹æ¡ãæ°æ®æ¢å¤ç­ç¥ãä¸»ä»å¤å¶ãè¯»ååç¦»ãè¿æ¥æ± åshardingææ¯ãMHAç­\n\n15ãä¼ä¸çº§äºè®¡ç®Openstack-KeystoneãGlanceãNovaæ ¸â¼¼ç»ä»¶ãç½ç»æ¨¡åãåå­å¨æå¡ç­\n\n16ãä¼ä¸çº§â¼¤æ°æ®Hadoop è¿ç»´å®æ-åå¼æ°æ®åºHBaseåºç¡åçãå®è£éç½®åå¶åºâ½¤ãZookeeperéç¾¤æå»ºãhadoopå®ç°Namenodeâ¾¼å¯â½¤\n\n17ãä¼ä¸çº§èæåKVM å®æ-KVMç¯å¢ï¼KVMçå®è£ãéç½®ååºâ½¤\n\n18ãNoSQL ä¼ä¸çº§åºç¨-Nosql åºç¨ï¼å¦redisãMongoDB å¤å¶ãéç¾¤ç­â¾¼çº§åºç¨\n\n19ãä¼ä¸çº§æ¥å¿æ¶éç³»ç»ELK å®æ-æµ·éæ°æ®æ¥å¿æ¶éç³»ç»Elasticsearch+Logstash+kibana åºç¨\n\n20ãå¯æç»­åéæ-Jenkins+githubä¼ä¸çº§åºç¨\n\n21ãèæåå®¹å¨Docker-Linux è½»éèæåDocker ï¼Docker çåçåå®è£ï¼éç½®ä»¥ååºç¨\n\n22ãä¼ä¸çº§K8Så®æ-ç»ä»¶åè½ãå®è£ãéç½®ãä¼ä¸çº§åºç¨åºæ¯åå¸¸è§æéåæ\n\n23ãLinux ç³»ç»è°ä¼å®æ-ä»åå­ãCPUãè¿ç¨è°åº¦ãç£çIOãâ½¹ç»åæ°ç­å¨é¢è®²è§£Linuxç³»ç»è°ä¼\n\n24ãPython ç¼ç¨åºç¡â¼é¨-pythonå®è£ãé»è¾å¤æ­ãæ¨¡åä½¿ç¨ç­\n\n25ãä¸ªäººç»¼åè½åæå-è¡¨è¾¾è½åãå¢éåä½è½åãæ§è¡è½åãèä»»åç­\n\nä»¥ä¸25æ¡æè½ï¼æ¯ä¸æ¡å¤§æ¦ä»·å¼2Kï¼ä½ çå·¥èµå¤å°ï¼å¨è¿ä¸ªè¡ä¸ï¼å°±åå³äºä½ ä¼å¤å°ãè¦æ³æ£é±ï¼ä½ è¦åå¼é±ã åæé¾æ¥ï¼https://blog.csdn.net/chj_1224365967/article/details/107537182",normalizedContent:"# linuxè¿ç»´é«çº§å·¥ç¨è¦ææ¡çæè½\n\næ³æä¸ºåæ ¼è¿ç»´å·¥ç¨å¸ï¼linuxè¿ç»´é«çº§å·¥ç¨å¸è¦ææ¡ä»¥ä¸æè½ï¼\n\n1ãlinux ç³»ç»åºç¡â¼é¨-linuxçåºç¡ç¥è¯åå®¹ï¼åå½ä»¤ä½¿ç¨ï¼ä»¥åç¨æ·åæéç­æ ¸â¼¼ç¥è¯ç¹\n\n2ãlinux ç³»ç»ç®¡çåè¿é¶-linuxä»è¿ç¨ãèµæºãä»»å¡ãâ½ä»¶ãè½¯ä»¶åãç£çç­ç®¡çâ½æ³\n\n3ãlinux ä¼ä¸å¸¸ç¨æå¡-ä¼ä¸çº§å¸¸ç¨æå¡å¦dnsãftpãhttpãmail\n\n4ãlinux ä¼ä¸çº§å®å¨åçåé²èæå·§ä»¥åç½ç»åå®å¨-linuxå®å¨æ¶æãå®å¨å¨èæ¨¡åãä»¥åå å¯ãè§£å¯ç­åçï¼å¸¸è§æ»å»åé²èâ¼¿æ®µ\n\n5ãshell ç¼ç¨â¼é¨åè¿é¶-shellèæ¬åºæ¬ç¨æ³ä»¥åè¿é¶ï¼ä»åºç¡å°ç²¾éï¼éè¦å­¦ä¹ ä¸äºä¼ä¸çº§å¸¸è§èæ¬ç¨æ³\n\n6ãmysql åºç¨åçåç®¡çâ¼é¨-mysqlå®è£ãç®¡çãææãå¢å æ¹æ¥\n\n7ãhttp æå¡ä»£çç¼å­å é-http â¾¼çº§åè®®åºç¨ãç¼å­ãwebæå¡nginx\n\n8ãä¼ä¸çº§è´è½½éç¾¤-ä¼ä¸çº§4å±è´è½½åè¡¡lvsãå7å±è´è½½åè¡¡nginxä»¥åhaproxyçåºç¨\n\n9ãä¼ä¸çº§â¾¼å¯ç¨éç¾¤-â¾¼å¯ç¨éç¾¤åçï¼å®ç°ä»¥keepalivedä¸ºæ ¸â¼¼çâ¾¼å¯ç¨éç¾¤ï¼ä»¥åä¸»ä»é«å¯ç¨ãåä¸»\n\n10ãè¿ç»´çæ§zabbix-ä¼ä¸çº§çæ§ä½ç³»ä»¥åzabbixæµâ¾å¼æºçæ§ç³»ç»çåç¨åæ¶æ\n\n11ãäºè®¡ç®è¿ç»´èªå¨å-ansibleãpuppetç­è¿ç»´èªå¨åè§£å³æ¹æ¡\n\n12ãweb æå¡ä½ç³»æ¶æ-webæå¡ä½ç³»æ¶æï¼jspä½ç³»ãtomcatãcdnãç¼å­åçãåæµãè¯ä¼°\n\n13ãâ¼¤åäºèâ½¹éç¾¤æ¶æåå®æâ½æ¡-lbéç¾¤ï¼nginxãhaproxyãlvs haéç¾¤ãå¨éåç¦»\n\n14ãmysql dba å®ææè½åä¼å-æ°æ®åºåæ°ä¼åãååºåè¡¨ãå¤ä»½æ¹æ¡ãæ°æ®æ¢å¤ç­ç¥ãä¸»ä»å¤å¶ãè¯»ååç¦»ãè¿æ¥æ± åshardingææ¯ãmhaç­\n\n15ãä¼ä¸çº§äºè®¡ç®openstack-keystoneãglanceãnovaæ ¸â¼¼ç»ä»¶ãç½ç»æ¨¡åãåå­å¨æå¡ç­\n\n16ãä¼ä¸çº§â¼¤æ°æ®hadoop è¿ç»´å®æ-åå¼æ°æ®åºhbaseåºç¡åçãå®è£éç½®åå¶åºâ½¤ãzookeeperéç¾¤æå»ºãhadoopå®ç°namenodeâ¾¼å¯â½¤\n\n17ãä¼ä¸çº§èæåkvm å®æ-kvmç¯å¢ï¼kvmçå®è£ãéç½®ååºâ½¤\n\n18ãnosql ä¼ä¸çº§åºç¨-nosql åºç¨ï¼å¦redisãmongodb å¤å¶ãéç¾¤ç­â¾¼çº§åºç¨\n\n19ãä¼ä¸çº§æ¥å¿æ¶éç³»ç»elk å®æ-æµ·éæ°æ®æ¥å¿æ¶éç³»ç»elasticsearch+logstash+kibana åºç¨\n\n20ãå¯æç»­åéæ-jenkins+githubä¼ä¸çº§åºç¨\n\n21ãèæåå®¹å¨docker-linux è½»éèæådocker ï¼docker çåçåå®è£ï¼éç½®ä»¥ååºç¨\n\n22ãä¼ä¸çº§k8så®æ-ç»ä»¶åè½ãå®è£ãéç½®ãä¼ä¸çº§åºç¨åºæ¯åå¸¸è§æéåæ\n\n23ãlinux ç³»ç»è°ä¼å®æ-ä»åå­ãcpuãè¿ç¨è°åº¦ãç£çioãâ½¹ç»åæ°ç­å¨é¢è®²è§£linuxç³»ç»è°ä¼\n\n24ãpython ç¼ç¨åºç¡â¼é¨-pythonå®è£ãé»è¾å¤æ­ãæ¨¡åä½¿ç¨ç­\n\n25ãä¸ªäººç»¼åè½åæå-è¡¨è¾¾è½åãå¢éåä½è½åãæ§è¡è½åãèä»»åç­\n\nä»¥ä¸25æ¡æè½ï¼æ¯ä¸æ¡å¤§æ¦ä»·å¼2kï¼ä½ çå·¥èµå¤å°ï¼å¨è¿ä¸ªè¡ä¸ï¼å°±åå³äºä½ ä¼å¤å°ãè¦æ³æ£é±ï¼ä½ è¦åå¼é±ã åæé¾æ¥ï¼https://blog.csdn.net/chj_1224365967/article/details/107537182",charsets:{cjk:!0}},{title:"ä¼ä¸çº§openvpnæ­å»º",frontmatter:{title:"ä¼ä¸çº§openvpnæ­å»º",date:"2022-12-15T19:13:50.000Z",permalink:"/pages/45fa3c/",categories:["è¿ç»´","vpn"],tags:[null],readingShow:"top",description:"OpenVPNæ¯ä¸ä¸ªç¨äºåå»ºèæä¸ç¨ç½ç»å å¯ééçè½¯ä»¶åï¼ææ©ç±James Yonanç¼åãOpenVPNåè®¸åå»ºçVPNä½¿ç¨å¬å¼å¯é¥ãçµå­è¯ä¹¦ãæèç¨æ·åï¼å¯ç æ¥è¿è¡èº«ä»½éªè¯ã\n> å®å¤§éä½¿ç¨äºOpenSSLå å¯åºä¸­çSSLv3/TLSv1åè®®å½æ°åºã\n> ç®åOpenVPNè½å¨SolarisãLinuxãOpenBSDãFreeBSDãNetBSDãMac OS Xä¸Microsoft Windowsä»¥åAndroidãiOSãMacOS(2020å¹´å®æ¹æ¨åºMacå®¢æ·ç«¯)ä¸è¿è¡ï¼å¹¶åå«äºè®¸å¤å®å¨æ§çåè½ãå®å¹¶ä¸æ¯ä¸ä¸ªåºäºWebçVPNè½¯ä»¶ï¼ä¹ä¸ä¸IPsecåå¶ä»VPNè½¯\n> OpenVPN2.0åå¼å¥äºç¨æ·å/å£ä»¤ç»åçèº«ä»½éªè¯æ¹å¼ï¼å®å¯ä»¥çç¥å®¢æ·ç«¯è¯ä¹¦ï¼ä½æ¯ä»æä¸ä»½æå¡å¨è¯ä¹¦éè¦è¢«ç¨ä½å å¯ã OpenVPNææçéä¿¡é½åºäºä¸ä¸ªåä¸çIPç«¯å£ï¼ é»è®¤ä¸æ¨èä½¿ç¨UDPåè®®éè®¯ï¼åæ¶TCPä¹è¢«æ¯æãOpenVPNè¿æ¥è½éè¿å¤§å¤æ°çä»£çæå¡å¨ï¼å¹¶ä¸è½å¤å¨NATçç¯å¢ä¸­å¾å¥½å°å·¥ä½ãæå¡ç«¯å·æåå®¢ æ·ç«¯âæ¨éâæäºç½ç»éç½®ä¿¡æ¯çåè½ï¼è¿äºä¿¡æ¯åæ¬ï¼IPå°åãè·¯ç±è®¾ç½®ç­ã\n> OpenVPNæä¾äºä¸¤ç§èæç½ç»æ¥å£ï¼éç¨Tun/Tapé©±å¨ï¼éè¿å®ä»¬ï¼ å¯ä»¥å»ºç«ä¸å±IPé§éï¼æèèæäºå±ä»¥å¤ªç½ï¼åèå¯ä»¥ä¼ éä»»ä½ç±»åçäºå±ä»¥å¤ªç½ç»æ°æ®ãä¼ éçæ°æ®å¯éè¿LZOç®æ³åç¼©ãå¨éæ©åè®®æ¶åï¼éè¦æ³¨æ2ä¸ªå å¯é§éä¹é´çç½ç»ç¶åµï¼å¦æé«å»¶è¿æèä¸¢åè¾å¤çæåµä¸ï¼è¯·éæ©TCPåè®®ä½ä¸ºåºå±åè®®ï¼UDPåè®®ç±äºå­å¨æ è¿æ¥åéä¼ æºå¶ï¼å¯¼è´è¦é§éä¸å±çåè®®è¿è¡éä¼ ï¼æçéå¸¸ä½ä¸ã\n> VPNçä¸»è¦ä½ç¨æ¯å¨å±åç½å¤é¨æ¶ä¹å¯ä»¥è®¿é®å±åç½çèµæºï¼æ¯å¦å¬å¸åç½æè®¸å¤èµæºåªè½å¬å¸åç½è®¿é®ï¼èæä»¬å¤æ´¾åºå·®åå·¥è¿æ³è®¿é®å¬å¸åç½èµæº[å¦:GitLab/æµè¯åº/å¶ä»æµè¯ç¯å¢æ¥å£]å°±éè¦éè¿è¿æ¥å¬å¸å¬ç½åºå£æ´é²VPNæ¥å®ç°ã\n>\n> ç±äºä¼æå¨ç¥çåå ï¼å ç§ç®åçVPNåè®®æ¯å¦L2TP/IPsecåPPTPåè®®å¨å¤§éå°åºå·²ç»è¢«å¹²æ°çåºæ¬æ æ³æ­£å¸¸ä½¿ç¨äºãå æ­¤ä¹å°±SSL VPNè¿å¯ä»¥ä½¿ç¨ãSSL VPNæéå¸¸å¤ç§ï¼ä½å¾å¤é½æ¯åä¸è½¯ä»¶ï¼ä¸å¼æºä¹ä¸éåä¸ªäººæ­å»ºãèOpenVPNæ¯ä¸æ¬¾å¼æºçSSL VPNï¼å¯ä»¥å¾å®¹ææ¾å°æ­å»ºçæ¹æ³ï¼éå¸¸ç¬¦åæä»¬çè¦æ±ã",meta:[{name:"twitter:title",content:"ä¼ä¸çº§openvpnæ­å»º"},{name:"twitter:description",content:"OpenVPNæ¯ä¸ä¸ªç¨äºåå»ºèæä¸ç¨ç½ç»å å¯ééçè½¯ä»¶åï¼ææ©ç±James Yonanç¼åãOpenVPNåè®¸åå»ºçVPNä½¿ç¨å¬å¼å¯é¥ãçµå­è¯ä¹¦ãæèç¨æ·åï¼å¯ç æ¥è¿è¡èº«ä»½éªè¯ã\n> å®å¤§éä½¿ç¨äºOpenSSLå å¯åºä¸­çSSLv3/TLSv1åè®®å½æ°åºã\n> ç®åOpenVPNè½å¨SolarisãLinuxãOpenBSDãFreeBSDãNetBSDãMac OS Xä¸Microsoft Windowsä»¥åAndroidãiOSãMacOS(2020å¹´å®æ¹æ¨åºMacå®¢æ·ç«¯)ä¸è¿è¡ï¼å¹¶åå«äºè®¸å¤å®å¨æ§çåè½ãå®å¹¶ä¸æ¯ä¸ä¸ªåºäºWebçVPNè½¯ä»¶ï¼ä¹ä¸ä¸IPsecåå¶ä»VPNè½¯\n> OpenVPN2.0åå¼å¥äºç¨æ·å/å£ä»¤ç»åçèº«ä»½éªè¯æ¹å¼ï¼å®å¯ä»¥çç¥å®¢æ·ç«¯è¯ä¹¦ï¼ä½æ¯ä»æä¸ä»½æå¡å¨è¯ä¹¦éè¦è¢«ç¨ä½å å¯ã OpenVPNææçéä¿¡é½åºäºä¸ä¸ªåä¸çIPç«¯å£ï¼ é»è®¤ä¸æ¨èä½¿ç¨UDPåè®®éè®¯ï¼åæ¶TCPä¹è¢«æ¯æãOpenVPNè¿æ¥è½éè¿å¤§å¤æ°çä»£çæå¡å¨ï¼å¹¶ä¸è½å¤å¨NATçç¯å¢ä¸­å¾å¥½å°å·¥ä½ãæå¡ç«¯å·æåå®¢ æ·ç«¯âæ¨éâæäºç½ç»éç½®ä¿¡æ¯çåè½ï¼è¿äºä¿¡æ¯åæ¬ï¼IPå°åãè·¯ç±è®¾ç½®ç­ã\n> OpenVPNæä¾äºä¸¤ç§èæç½ç»æ¥å£ï¼éç¨Tun/Tapé©±å¨ï¼éè¿å®ä»¬ï¼ å¯ä»¥å»ºç«ä¸å±IPé§éï¼æèèæäºå±ä»¥å¤ªç½ï¼åèå¯ä»¥ä¼ éä»»ä½ç±»åçäºå±ä»¥å¤ªç½ç»æ°æ®ãä¼ éçæ°æ®å¯éè¿LZOç®æ³åç¼©ãå¨éæ©åè®®æ¶åï¼éè¦æ³¨æ2ä¸ªå å¯é§éä¹é´çç½ç»ç¶åµï¼å¦æé«å»¶è¿æèä¸¢åè¾å¤çæåµä¸ï¼è¯·éæ©TCPåè®®ä½ä¸ºåºå±åè®®ï¼UDPåè®®ç±äºå­å¨æ è¿æ¥åéä¼ æºå¶ï¼å¯¼è´è¦é§éä¸å±çåè®®è¿è¡éä¼ ï¼æçéå¸¸ä½ä¸ã\n> VPNçä¸»è¦ä½ç¨æ¯å¨å±åç½å¤é¨æ¶ä¹å¯ä»¥è®¿é®å±åç½çèµæºï¼æ¯å¦å¬å¸åç½æè®¸å¤èµæºåªè½å¬å¸åç½è®¿é®ï¼èæä»¬å¤æ´¾åºå·®åå·¥è¿æ³è®¿é®å¬å¸åç½èµæº[å¦:GitLab/æµè¯åº/å¶ä»æµè¯ç¯å¢æ¥å£]å°±éè¦éè¿è¿æ¥å¬å¸å¬ç½åºå£æ´é²VPNæ¥å®ç°ã\n>\n> ç±äºä¼æå¨ç¥çåå ï¼å ç§ç®åçVPNåè®®æ¯å¦L2TP/IPsecåPPTPåè®®å¨å¤§éå°åºå·²ç»è¢«å¹²æ°çåºæ¬æ æ³æ­£å¸¸ä½¿ç¨äºãå æ­¤ä¹å°±SSL VPNè¿å¯ä»¥ä½¿ç¨ãSSL VPNæéå¸¸å¤ç§ï¼ä½å¾å¤é½æ¯åä¸è½¯ä»¶ï¼ä¸å¼æºä¹ä¸éåä¸ªäººæ­å»ºãèOpenVPNæ¯ä¸æ¬¾å¼æºçSSL VPNï¼å¯ä»¥å¾å®¹ææ¾å°æ­å»ºçæ¹æ³ï¼éå¸¸ç¬¦åæä»¬çè¦æ±ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/01.vpn/01.%E4%BC%81%E4%B8%9A%E7%BA%A7openvpn%E6%90%AD%E5%BB%BA.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ä¼ä¸çº§openvpnæ­å»º"},{property:"og:description",content:"OpenVPNæ¯ä¸ä¸ªç¨äºåå»ºèæä¸ç¨ç½ç»å å¯ééçè½¯ä»¶åï¼ææ©ç±James Yonanç¼åãOpenVPNåè®¸åå»ºçVPNä½¿ç¨å¬å¼å¯é¥ãçµå­è¯ä¹¦ãæèç¨æ·åï¼å¯ç æ¥è¿è¡èº«ä»½éªè¯ã\n> å®å¤§éä½¿ç¨äºOpenSSLå å¯åºä¸­çSSLv3/TLSv1åè®®å½æ°åºã\n> ç®åOpenVPNè½å¨SolarisãLinuxãOpenBSDãFreeBSDãNetBSDãMac OS Xä¸Microsoft Windowsä»¥åAndroidãiOSãMacOS(2020å¹´å®æ¹æ¨åºMacå®¢æ·ç«¯)ä¸è¿è¡ï¼å¹¶åå«äºè®¸å¤å®å¨æ§çåè½ãå®å¹¶ä¸æ¯ä¸ä¸ªåºäºWebçVPNè½¯ä»¶ï¼ä¹ä¸ä¸IPsecåå¶ä»VPNè½¯\n> OpenVPN2.0åå¼å¥äºç¨æ·å/å£ä»¤ç»åçèº«ä»½éªè¯æ¹å¼ï¼å®å¯ä»¥çç¥å®¢æ·ç«¯è¯ä¹¦ï¼ä½æ¯ä»æä¸ä»½æå¡å¨è¯ä¹¦éè¦è¢«ç¨ä½å å¯ã OpenVPNææçéä¿¡é½åºäºä¸ä¸ªåä¸çIPç«¯å£ï¼ é»è®¤ä¸æ¨èä½¿ç¨UDPåè®®éè®¯ï¼åæ¶TCPä¹è¢«æ¯æãOpenVPNè¿æ¥è½éè¿å¤§å¤æ°çä»£çæå¡å¨ï¼å¹¶ä¸è½å¤å¨NATçç¯å¢ä¸­å¾å¥½å°å·¥ä½ãæå¡ç«¯å·æåå®¢ æ·ç«¯âæ¨éâæäºç½ç»éç½®ä¿¡æ¯çåè½ï¼è¿äºä¿¡æ¯åæ¬ï¼IPå°åãè·¯ç±è®¾ç½®ç­ã\n> OpenVPNæä¾äºä¸¤ç§èæç½ç»æ¥å£ï¼éç¨Tun/Tapé©±å¨ï¼éè¿å®ä»¬ï¼ å¯ä»¥å»ºç«ä¸å±IPé§éï¼æèèæäºå±ä»¥å¤ªç½ï¼åèå¯ä»¥ä¼ éä»»ä½ç±»åçäºå±ä»¥å¤ªç½ç»æ°æ®ãä¼ éçæ°æ®å¯éè¿LZOç®æ³åç¼©ãå¨éæ©åè®®æ¶åï¼éè¦æ³¨æ2ä¸ªå å¯é§éä¹é´çç½ç»ç¶åµï¼å¦æé«å»¶è¿æèä¸¢åè¾å¤çæåµä¸ï¼è¯·éæ©TCPåè®®ä½ä¸ºåºå±åè®®ï¼UDPåè®®ç±äºå­å¨æ è¿æ¥åéä¼ æºå¶ï¼å¯¼è´è¦é§éä¸å±çåè®®è¿è¡éä¼ ï¼æçéå¸¸ä½ä¸ã\n> VPNçä¸»è¦ä½ç¨æ¯å¨å±åç½å¤é¨æ¶ä¹å¯ä»¥è®¿é®å±åç½çèµæºï¼æ¯å¦å¬å¸åç½æè®¸å¤èµæºåªè½å¬å¸åç½è®¿é®ï¼èæä»¬å¤æ´¾åºå·®åå·¥è¿æ³è®¿é®å¬å¸åç½èµæº[å¦:GitLab/æµè¯åº/å¶ä»æµè¯ç¯å¢æ¥å£]å°±éè¦éè¿è¿æ¥å¬å¸å¬ç½åºå£æ´é²VPNæ¥å®ç°ã\n>\n> ç±äºä¼æå¨ç¥çåå ï¼å ç§ç®åçVPNåè®®æ¯å¦L2TP/IPsecåPPTPåè®®å¨å¤§éå°åºå·²ç»è¢«å¹²æ°çåºæ¬æ æ³æ­£å¸¸ä½¿ç¨äºãå æ­¤ä¹å°±SSL VPNè¿å¯ä»¥ä½¿ç¨ãSSL VPNæéå¸¸å¤ç§ï¼ä½å¾å¤é½æ¯åä¸è½¯ä»¶ï¼ä¸å¼æºä¹ä¸éåä¸ªäººæ­å»ºãèOpenVPNæ¯ä¸æ¬¾å¼æºçSSL VPNï¼å¯ä»¥å¾å®¹ææ¾å°æ­å»ºçæ¹æ³ï¼éå¸¸ç¬¦åæä»¬çè¦æ±ã"},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/01.vpn/01.%E4%BC%81%E4%B8%9A%E7%BA%A7openvpn%E6%90%AD%E5%BB%BA.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T19:13:50.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ä¼ä¸çº§openvpnæ­å»º"},{itemprop:"description",content:"OpenVPNæ¯ä¸ä¸ªç¨äºåå»ºèæä¸ç¨ç½ç»å å¯ééçè½¯ä»¶åï¼ææ©ç±James Yonanç¼åãOpenVPNåè®¸åå»ºçVPNä½¿ç¨å¬å¼å¯é¥ãçµå­è¯ä¹¦ãæèç¨æ·åï¼å¯ç æ¥è¿è¡èº«ä»½éªè¯ã\n> å®å¤§éä½¿ç¨äºOpenSSLå å¯åºä¸­çSSLv3/TLSv1åè®®å½æ°åºã\n> ç®åOpenVPNè½å¨SolarisãLinuxãOpenBSDãFreeBSDãNetBSDãMac OS Xä¸Microsoft Windowsä»¥åAndroidãiOSãMacOS(2020å¹´å®æ¹æ¨åºMacå®¢æ·ç«¯)ä¸è¿è¡ï¼å¹¶åå«äºè®¸å¤å®å¨æ§çåè½ãå®å¹¶ä¸æ¯ä¸ä¸ªåºäºWebçVPNè½¯ä»¶ï¼ä¹ä¸ä¸IPsecåå¶ä»VPNè½¯\n> OpenVPN2.0åå¼å¥äºç¨æ·å/å£ä»¤ç»åçèº«ä»½éªè¯æ¹å¼ï¼å®å¯ä»¥çç¥å®¢æ·ç«¯è¯ä¹¦ï¼ä½æ¯ä»æä¸ä»½æå¡å¨è¯ä¹¦éè¦è¢«ç¨ä½å å¯ã OpenVPNææçéä¿¡é½åºäºä¸ä¸ªåä¸çIPç«¯å£ï¼ é»è®¤ä¸æ¨èä½¿ç¨UDPåè®®éè®¯ï¼åæ¶TCPä¹è¢«æ¯æãOpenVPNè¿æ¥è½éè¿å¤§å¤æ°çä»£çæå¡å¨ï¼å¹¶ä¸è½å¤å¨NATçç¯å¢ä¸­å¾å¥½å°å·¥ä½ãæå¡ç«¯å·æåå®¢ æ·ç«¯âæ¨éâæäºç½ç»éç½®ä¿¡æ¯çåè½ï¼è¿äºä¿¡æ¯åæ¬ï¼IPå°åãè·¯ç±è®¾ç½®ç­ã\n> OpenVPNæä¾äºä¸¤ç§èæç½ç»æ¥å£ï¼éç¨Tun/Tapé©±å¨ï¼éè¿å®ä»¬ï¼ å¯ä»¥å»ºç«ä¸å±IPé§éï¼æèèæäºå±ä»¥å¤ªç½ï¼åèå¯ä»¥ä¼ éä»»ä½ç±»åçäºå±ä»¥å¤ªç½ç»æ°æ®ãä¼ éçæ°æ®å¯éè¿LZOç®æ³åç¼©ãå¨éæ©åè®®æ¶åï¼éè¦æ³¨æ2ä¸ªå å¯é§éä¹é´çç½ç»ç¶åµï¼å¦æé«å»¶è¿æèä¸¢åè¾å¤çæåµä¸ï¼è¯·éæ©TCPåè®®ä½ä¸ºåºå±åè®®ï¼UDPåè®®ç±äºå­å¨æ è¿æ¥åéä¼ æºå¶ï¼å¯¼è´è¦é§éä¸å±çåè®®è¿è¡éä¼ ï¼æçéå¸¸ä½ä¸ã\n> VPNçä¸»è¦ä½ç¨æ¯å¨å±åç½å¤é¨æ¶ä¹å¯ä»¥è®¿é®å±åç½çèµæºï¼æ¯å¦å¬å¸åç½æè®¸å¤èµæºåªè½å¬å¸åç½è®¿é®ï¼èæä»¬å¤æ´¾åºå·®åå·¥è¿æ³è®¿é®å¬å¸åç½èµæº[å¦:GitLab/æµè¯åº/å¶ä»æµè¯ç¯å¢æ¥å£]å°±éè¦éè¿è¿æ¥å¬å¸å¬ç½åºå£æ´é²VPNæ¥å®ç°ã\n>\n> ç±äºä¼æå¨ç¥çåå ï¼å ç§ç®åçVPNåè®®æ¯å¦L2TP/IPsecåPPTPåè®®å¨å¤§éå°åºå·²ç»è¢«å¹²æ°çåºæ¬æ æ³æ­£å¸¸ä½¿ç¨äºãå æ­¤ä¹å°±SSL VPNè¿å¯ä»¥ä½¿ç¨ãSSL VPNæéå¸¸å¤ç§ï¼ä½å¾å¤é½æ¯åä¸è½¯ä»¶ï¼ä¸å¼æºä¹ä¸éåä¸ªäººæ­å»ºãèOpenVPNæ¯ä¸æ¬¾å¼æºçSSL VPNï¼å¯ä»¥å¾å®¹ææ¾å°æ­å»ºçæ¹æ³ï¼éå¸¸ç¬¦åæä»¬çè¦æ±ã"}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/01.vpn/01.%E4%BC%81%E4%B8%9A%E7%BA%A7openvpn%E6%90%AD%E5%BB%BA.html",relativePath:"02.çæ´»/03.å·¥å·/01.vpn/01.ä¼ä¸çº§openvpnæ­å»º.md",key:"v-e2ff91da",path:"/pages/45fa3c/",headers:[{level:2,title:"åºäºè´¦å·å¯ç çæ­å»º",slug:"åºäºè´¦å·å¯ç çæ­å»º",normalizedTitle:"åºäºè´¦å·å¯ç çæ­å»º",charIndex:974},{level:4,title:"å®è£ä¾èµ",slug:"å®è£ä¾èµ",normalizedTitle:"å®è£ä¾èµ",charIndex:987},{level:4,title:"å®è£ç®å½",slug:"å®è£ç®å½",normalizedTitle:"å®è£ç®å½",charIndex:1097},{level:4,title:"å®è£easy-rsaå¹¶çæç¸å³è¯ä¹¦",slug:"å®è£easy-rsaå¹¶çæç¸å³è¯ä¹¦",normalizedTitle:"å®è£easy-rsaå¹¶çæç¸å³è¯ä¹¦",charIndex:1127},{level:4,title:"çæç¸å³è¯ä¹¦",slug:"çæç¸å³è¯ä¹¦",normalizedTitle:"çæç¸å³è¯ä¹¦",charIndex:1138},{level:4,title:"åå¤opensslç¸å³æä»¶",slug:"åå¤opensslç¸å³æä»¶",normalizedTitle:"åå¤opensslç¸å³æä»¶",charIndex:1477},{level:4,title:"ç¼è¾è¯ä¹¦åºæ¬ä¿¡æ¯",slug:"ç¼è¾è¯ä¹¦åºæ¬ä¿¡æ¯",normalizedTitle:"ç¼è¾è¯ä¹¦åºæ¬ä¿¡æ¯",charIndex:1536},{level:4,title:"çææå¡å¨ç«¯ç§é¥",slug:"çææå¡å¨ç«¯ç§é¥",normalizedTitle:"çææå¡å¨ç«¯ç§é¥",charIndex:1805},{level:4,title:"çæå®¢æ·ç«¯è¯ä¹¦",slug:"çæå®¢æ·ç«¯è¯ä¹¦",normalizedTitle:"çæå®¢æ·ç«¯è¯ä¹¦",charIndex:1849},{level:4,title:"åå»ºè¿ªè²Â·èµ«å°æ¼å¯é¥",slug:"åå»ºè¿ªè²Â·èµ«å°æ¼å¯é¥",normalizedTitle:"åå»ºè¿ªè²Â·èµ«å°æ¼å¯é¥",charIndex:1885},{level:4,title:"æ¥ççæçææè¯ä¹¦",slug:"æ¥ççæçææè¯ä¹¦",normalizedTitle:"æ¥ççæçææè¯ä¹¦",charIndex:1916},{level:4,title:"å®è£openvpn",slug:"å®è£openvpn",normalizedTitle:"å®è£openvpn",charIndex:2191},{level:4,title:"éç½®openvpn",slug:"éç½®openvpn",normalizedTitle:"éç½®openvpn",charIndex:2776},{level:4,title:"çæta.keyæä»¶ï¼é²DDosæ»å»ãudpæ·¹æ²¡ç­æ¶ææ»å»ï¼",slug:"çæta-keyæä»¶-é²ddosæ»å»ãudpæ·¹æ²¡ç­æ¶ææ»å»",normalizedTitle:"çæta.keyæä»¶ï¼é²ddosæ»å»ãudpæ·¹æ²¡ç­æ¶ææ»å»ï¼",charIndex:2923},{level:4,title:"å°ç­¾åçæçCAè¯ä¹¦ç§é¥åæå¡ç«¯è¯ä¹¦ç§é¥æ·è´å°è¯ä¹¦ç®å½ä¸­",slug:"å°ç­¾åçæçcaè¯ä¹¦ç§é¥åæå¡ç«¯è¯ä¹¦ç§é¥æ·è´å°è¯ä¹¦ç®å½ä¸­",normalizedTitle:"å°ç­¾åçæçcaè¯ä¹¦ç§é¥åæå¡ç«¯è¯ä¹¦ç§é¥æ·è´å°è¯ä¹¦ç®å½ä¸­",charIndex:3072},{level:4,title:"æ·è´éç½®æä»¶æ¨¡æ¿",slug:"æ·è´éç½®æä»¶æ¨¡æ¿",normalizedTitle:"æ·è´éç½®æä»¶æ¨¡æ¿",charIndex:3545},{level:4,title:"æ·è´éç½®æä»¶æ¨¡æ¿",slug:"æ·è´éç½®æä»¶æ¨¡æ¿-2",normalizedTitle:"æ·è´éç½®æä»¶æ¨¡æ¿",charIndex:3545},{level:4,title:"ç¼è¾openvpnéç½®æä»¶",slug:"ç¼è¾openvpnéç½®æä»¶",normalizedTitle:"ç¼è¾openvpnéç½®æä»¶",charIndex:3723},{level:4,title:"centos7æ·»å é²ç«å¢æ¹å¼è®¿é®åé¨ç½ç»",slug:"centos7æ·»å é²ç«å¢æ¹å¼è®¿é®åé¨ç½ç»",normalizedTitle:"centos7æ·»å é²ç«å¢æ¹å¼è®¿é®åé¨ç½ç»",charIndex:4635},{level:4,title:"iptableséç½®é²ç«å¢æ¹å¼è®¿é®åé¨ç½ç»",slug:"iptableséç½®é²ç«å¢æ¹å¼è®¿é®åé¨ç½ç»",normalizedTitle:"iptableséç½®é²ç«å¢æ¹å¼è®¿é®åé¨ç½ç»",charIndex:4887},{level:4,title:"ä¸ä¼ å¯ç éªè¯èæ¬",slug:"ä¸ä¼ å¯ç éªè¯èæ¬",normalizedTitle:"ä¸ä¼ å¯ç éªè¯èæ¬",charIndex:5263},{level:4,title:"éç½®systemdå¯å¨èæ¬",slug:"éç½®systemdå¯å¨èæ¬",normalizedTitle:"éç½®systemdå¯å¨èæ¬",charIndex:6575},{level:4,title:"å¼å¯åæ ¸è·¯ç±è½¬ååè½",slug:"å¼å¯åæ ¸è·¯ç±è½¬ååè½",normalizedTitle:"å¼å¯åæ ¸è·¯ç±è½¬ååè½",charIndex:8472},{level:4,title:"å®è£openvpnå®¢æ·ç«¯",slug:"å®è£openvpnå®¢æ·ç«¯",normalizedTitle:"å®è£openvpnå®¢æ·ç«¯",charIndex:8560},{level:4,title:"å®¢æ·ç«¯éç½®",slug:"å®¢æ·ç«¯éç½®",normalizedTitle:"å®¢æ·ç«¯éç½®",charIndex:9155}],headersStr:"åºäºè´¦å·å¯ç çæ­å»º å®è£ä¾èµ å®è£ç®å½ å®è£easy-rsaå¹¶çæç¸å³è¯ä¹¦ çæç¸å³è¯ä¹¦ åå¤opensslç¸å³æä»¶ ç¼è¾è¯ä¹¦åºæ¬ä¿¡æ¯ çææå¡å¨ç«¯ç§é¥ çæå®¢æ·ç«¯è¯ä¹¦ åå»ºè¿ªè²Â·èµ«å°æ¼å¯é¥ æ¥ççæçææè¯ä¹¦ å®è£openvpn éç½®openvpn çæta.keyæä»¶ï¼é²DDosæ»å»ãudpæ·¹æ²¡ç­æ¶ææ»å»ï¼ å°ç­¾åçæçCAè¯ä¹¦ç§é¥åæå¡ç«¯è¯ä¹¦ç§é¥æ·è´å°è¯ä¹¦ç®å½ä¸­ æ·è´éç½®æä»¶æ¨¡æ¿ æ·è´éç½®æä»¶æ¨¡æ¿ ç¼è¾openvpnéç½®æä»¶ centos7æ·»å é²ç«å¢æ¹å¼è®¿é®åé¨ç½ç» iptableséç½®é²ç«å¢æ¹å¼è®¿é®åé¨ç½ç» ä¸ä¼ å¯ç éªè¯èæ¬ éç½®systemdå¯å¨èæ¬ å¼å¯åæ ¸è·¯ç±è½¬ååè½ å®è£openvpnå®¢æ·ç«¯ å®¢æ·ç«¯éç½®",content:'# ä¼ä¸çº§openvpnæ­å»º\n\n> OpenVPNæ¯ä¸ä¸ªç¨äºåå»ºèæä¸ç¨ç½ç»å å¯ééçè½¯ä»¶åï¼ææ©ç±James Yonanç¼åãOpenVPNåè®¸åå»ºçVPNä½¿ç¨å¬å¼å¯é¥ãçµå­è¯ä¹¦ãæèç¨æ·åï¼å¯ç æ¥è¿è¡èº«ä»½éªè¯ã å®å¤§éä½¿ç¨äºOpenSSLå å¯åºä¸­çSSLv3/TLSv1åè®®å½æ°åºã ç®åOpenVPNè½å¨SolarisãLinuxãOpenBSDãFreeBSDãNetBSDãMac OS Xä¸Microsoft Windowsä»¥åAndroidãiOSãMacOS(2020å¹´å®æ¹æ¨åºMacå®¢æ·ç«¯)ä¸è¿è¡ï¼å¹¶åå«äºè®¸å¤å®å¨æ§çåè½ãå®å¹¶ä¸æ¯ä¸ä¸ªåºäºWebçVPNè½¯ä»¶ï¼ä¹ä¸ä¸IPsecåå¶ä»VPNè½¯ OpenVPN2.0åå¼å¥äºç¨æ·å/å£ä»¤ç»åçèº«ä»½éªè¯æ¹å¼ï¼å®å¯ä»¥çç¥å®¢æ·ç«¯è¯ä¹¦ï¼ä½æ¯ä»æä¸ä»½æå¡å¨è¯ä¹¦éè¦è¢«ç¨ä½å å¯ã OpenVPNææçéä¿¡é½åºäºä¸ä¸ªåä¸çIPç«¯å£ï¼ é»è®¤ä¸æ¨èä½¿ç¨UDPåè®®éè®¯ï¼åæ¶TCPä¹è¢«æ¯æãOpenVPNè¿æ¥è½éè¿å¤§å¤æ°çä»£çæå¡å¨ï¼å¹¶ä¸è½å¤å¨NATçç¯å¢ä¸­å¾å¥½å°å·¥ä½ãæå¡ç«¯å·æåå®¢ æ·ç«¯âæ¨éâæäºç½ç»éç½®ä¿¡æ¯çåè½ï¼è¿äºä¿¡æ¯åæ¬ï¼IPå°åãè·¯ç±è®¾ç½®ç­ã OpenVPNæä¾äºä¸¤ç§èæç½ç»æ¥å£ï¼éç¨Tun/Tapé©±å¨ï¼éè¿å®ä»¬ï¼ å¯ä»¥å»ºç«ä¸å±IPé§éï¼æèèæäºå±ä»¥å¤ªç½ï¼åèå¯ä»¥ä¼ éä»»ä½ç±»åçäºå±ä»¥å¤ªç½ç»æ°æ®ãä¼ éçæ°æ®å¯éè¿LZOç®æ³åç¼©ãå¨éæ©åè®®æ¶åï¼éè¦æ³¨æ2ä¸ªå å¯é§éä¹é´çç½ç»ç¶åµï¼å¦æé«å»¶è¿æèä¸¢åè¾å¤çæåµä¸ï¼è¯·éæ©TCPåè®®ä½ä¸ºåºå±åè®®ï¼UDPåè®®ç±äºå­å¨æ è¿æ¥åéä¼ æºå¶ï¼å¯¼è´è¦é§éä¸å±çåè®®è¿è¡éä¼ ï¼æçéå¸¸ä½ä¸ã VPNçä¸»è¦ä½ç¨æ¯å¨å±åç½å¤é¨æ¶ä¹å¯ä»¥è®¿é®å±åç½çèµæºï¼æ¯å¦å¬å¸åç½æè®¸å¤èµæºåªè½å¬å¸åç½è®¿é®ï¼èæä»¬å¤æ´¾åºå·®åå·¥è¿æ³è®¿é®å¬å¸åç½èµæº[å¦:GitLab/æµè¯åº/å¶ä»æµè¯ç¯å¢æ¥å£]å°±éè¦éè¿è¿æ¥å¬å¸å¬ç½åºå£æ´é²VPNæ¥å®ç°ã\n> \n> ç±äºä¼æå¨ç¥çåå ï¼å ç§ç®åçVPNåè®®æ¯å¦L2TP/IPsecåPPTPåè®®å¨å¤§éå°åºå·²ç»è¢«å¹²æ°çåºæ¬æ æ³æ­£å¸¸ä½¿ç¨äºãå æ­¤ä¹å°±SSL VPNè¿å¯ä»¥ä½¿ç¨ãSSL VPNæéå¸¸å¤ç§ï¼ä½å¾å¤é½æ¯åä¸è½¯ä»¶ï¼ä¸å¼æºä¹ä¸éåä¸ªäººæ­å»ºãèOpenVPNæ¯ä¸æ¬¾å¼æºçSSL VPNï¼å¯ä»¥å¾å®¹ææ¾å°æ­å»ºçæ¹æ³ï¼éå¸¸ç¬¦åæä»¬çè¦æ±ã\n\n\n# åºäºè´¦å·å¯ç çæ­å»º\n\n# å®è£ä¾èµ\n\nyum install -y openssl openssl-devel lzo lzo-devel pam pam-devel automake pkgconfig gcc gcc-c++\n\n\n1\n\n\n# å®è£ç®å½\n\nmkdir /opt/apps\n\n\n1\n\n\n# å®è£easy-rsaå¹¶çæç¸å³è¯ä¹¦\n\neasy-rsa ä¸è½½å°åï¼https://codeload.github.com/OpenVPN/easy-rsa-old/zip/master\n\nunzip easy-rsa-old-master.zip\n[root@host-172-16-30-22 easy-rsa-old-master]# ls\nconfigure.ac  COPYING  COPYRIGHT.GPL  distro  doc  easy-rsa  Makefile.am\n\n\n1\n2\n3\n\n\n# çæç¸å³è¯ä¹¦\n\n[root@host-172-16-30-22 2.0]# cd /opt/apps/easy-rsa-old-master/easy-rsa/2.0\n\n\n1\n\n\n# åå¤opensslç¸å³æä»¶\n\nln -s openssl-1.0.0.cnf openssl.cnf\n\n\n1\n\n\n# ç¼è¾è¯ä¹¦åºæ¬ä¿¡æ¯\n\n[root@host-172-16-30-22 2.0]# pwd\n/opt/apps/easy-rsa-old-master/easy-rsa/2.0\nvim vars\nexport KEY_COUNTRY="CN"\nexport KEY_PROVINCE="sz"\nexport KEY_CITY="shenzhen"\nexport KEY_ORG="1quant"\nexport KEY_EMAIL="xxx@1quant.com"\n. vars #çæç¯å¢åé\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# çææå¡å¨ç«¯ç§é¥\n\n./build-key-server server\n\n\n1\n\n\n# çæå®¢æ·ç«¯è¯ä¹¦\n\n./build-key client\n\n\n1\n\n\n# åå»ºè¿ªè²Â·èµ«å°æ¼å¯é¥\n\n./build-dh\n\n\n1\n\n\n# æ¥ççæçææè¯ä¹¦\n\n[root@host-172-16-30-22 keys]# ls\n01.pem  ca.crt  client.crt  client.key  index.txt       index.txt.attr.old  serial      server.crt  server.key\n02.pem  ca.key  client.csr  dh2048.pem  index.txt.attr  index.txt.old       serial.old  server.csr  ta.key\n\n\n1\n2\n3\n\n\n# å®è£openvpn\n\nä¸è½½å°åï¼https://openvpn.net/community-downloads/ï¼å¯è½éè¦ç¿»å¢ï¼\n\n tar -xf openvpn-2.5.8.tar.gz\n cd /opt/apps/openvpn-2.5.8\n ./configure --prefix=/opt/apps/openvpn && make && make install\n [root@host-172-16-30-22 apps]# ll\ntotal 1904\ndrwxr-xr-x  5 root  root     4096 Jan 23  2018 easy-rsa-old-master\n-rw-------  1 root  root    59661 Dec 27 12:30 easy-rsa-old-master-1.zip\ndrwxr-xr-x  7 root  root     4096 Dec 27 14:37 openvpn\ndrwxrwxr-x 12 admin admin    4096 Dec 27 14:02 openvpn-2.5.8\n-rw-------  1 root  root  1875551 Dec 27 11:37 openvpn-2.5.8.tar.gz\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# éç½®openvpn\n\néç½® OpenVPN æå¡ç«¯\nåå»ºéç½®æä»¶ç®å½åè¯ä¹¦ç®å½ï¼\nmkdir -p /etc/openvpn        # openvpn éç½®æä»¶è·¯å¾\nmkdir -p /etc/openvpn/pki    # openvpn è¯ä¹¦å­æ¾ä½ç½®\n\n\n1\n2\n3\n4\n\n\n# çæta.keyæä»¶ï¼é²DDosæ»å»ãudpæ·¹æ²¡ç­æ¶ææ»å»ï¼\n\ncd /opt/apps/easy-rsa-old-master/easy-rsa/2.0/keys\n/opt/apps/openvpn/sbin/openvpn --genkey --secret ta.key\n\n\n1\n2\n\n\n# å°ç­¾åçæçCAè¯ä¹¦ç§é¥åæå¡ç«¯è¯ä¹¦ç§é¥æ·è´å°è¯ä¹¦ç®å½ä¸­\n\ncp {ca.crt,ca.key,dh2048.pem,server.crt,server.key,ta.key} /etc/openvpn/pki/\n[root@host-172-16-30-22 pki]# ll\ntotal 32\n-rw-r--r-- 1 root root 2419 Dec 27 14:15 ca.crt\n-rw------- 1 root root 3268 Dec 27 14:15 ca.key\n-rw-r--r-- 1 root root  424 Dec 27 14:15 dh2048.pem\n-rw-r--r-- 1 root root 8203 Dec 27 14:15 server.crt\n-rw------- 1 root root 3272 Dec 27 14:15 server.key\n-rw------- 1 root root  636 Dec 27 14:15 ta.key\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# æ·è´éç½®æä»¶æ¨¡æ¿\n\ncp openvpn-2.5.8/sample/sample-config-files/server.conf /etc/openvpn/\n\n\n1\n\n\n# æ·è´éç½®æä»¶æ¨¡æ¿\n\ncp openvpn-2.5.8/sample/sample-config-files/server.conf /etc/openvpn\n\n\n\n1\n2\n\n\n# ç¼è¾openvpnéç½®æä»¶\n\nlocal 0.0.0.0\nport 8888\nproto tcp\ndev tun\nca /etc/openvpn/pki/ca.crt\ncert /etc/openvpn/pki/server.crt\nkey /etc/openvpn/pki/server.key  # This file should be kept secret\ndh /etc/openvpn/pki/dh2048.pem\nserver 10.8.0.0 255.255.255.0\npush "dhcp-option DNS 114.114.114.114"\npush "dhcp-option DNS 8.8.8.8"\npush "route 172.16.30.0 255.255.255.0"\npush "route 172.16.60.253 255.255.255.0"\nifconfig-pool-persist ipp.txt\nclient-to-client\nkeepalive 10 120\ntls-auth /etc/openvpn/pki/ta.key 0 # This file is secret\ncipher AES-256-CBC\ncomp-lzo\nuser nobody\ngroup nobody\nauth-user-pass-verify /etc/openvpn/checkpsw.sh via-env\nscript-security 3\nverify-client-cert none\nusername-as-common-name\npersist-key\npersist-tun\nstatus /var/log/openvpn-status.log\nlog         /var/log/openvpn.log\nlog-append  /var/log/openvpn.log\nverb 3\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n# centos7æ·»å é²ç«å¢æ¹å¼è®¿é®åé¨ç½ç»\n\n#å¨æå¡ç«¯å¼å¯é²ç«å¢ï¼æ¾è¡openvpnæå¡ï¼å¹¶ä¸å¼å¯masqueradeã\n#ä¼ç¹ï¼åªéå¨OpenVPNæå¡ç«¯éç½®é²ç«å¢è§åï¼åé¨ç½ç»ä¸»æºæ ééç½®\nsystemctl start firewalld\nfirewall-cmd --add-masquerade --permanent\nfirewall-cmd --add-service=openvpn --permanent\nfirewall-cmd --reload\n\n\n1\n2\n3\n4\n5\n6\n\n\n# iptableséç½®é²ç«å¢æ¹å¼è®¿é®åé¨ç½ç»\n\niptables -t nat -A POSTROUTING -s 10.10.10.0/24 -o eth0 -j MASQUERADE\nä¹å¯ä»¥è¿æ ·åï¼æ·»å  iptables è½¬åè§åï¼å¯¹æææºå°åï¼openvpnä¸ºå®¢æ·ç«¯åéçå°åï¼ä¸º 10.10.10.0/24 çæ°æ®åè½¬ååè¿è¡æºå°åè½¬æ¢ï¼ä¼ªè£æ openvpn æå¡å¨åç½å°å x.x.x.xï¼ è¿æ · VPN å®¢æ·ç«¯å°±å¯ä»¥è®¿é®æå¡å¨åç½çå¶ä»æºå¨äºã\n\niptables -A POSTROUTING -s 10.10.10.0/24 -j SNAT --to-source 192.168.1.160\niptables -I INPUT -p tcp -m tcp --dport 8888 -j ACCEPT\n\n\n1\n2\n3\n4\n5\n\n\n# ä¸ä¼ å¯ç éªè¯èæ¬\n\n[root@host-172-16-30-22 openvpn]# ll\ntotal 28\n-rwxr-xr-x 1 root root   901 Dec 27 14:36 checkpsw.sh\n-rw------- 1 root root     0 Dec 27 14:40 ipp.txt\ndrwxr-xr-x 2 root root  4096 Dec 27 14:15 pki\n-rw-r--r-- 1 root root    22 Dec 27 14:37 psw-file\n-rw-r--r-- 1 root root   807 Dec 28 11:42 server.conf\ncat checkpsw.sh\n#!/bin/sh\n###########################################################\nPASSFILE="/etc/openvpn/psw-file"\nLOG_FILE="/opt/apps/openvpn/logs/openvpn-password.log"\nTIME_STAMP=`date "+%Y-%m-%d %T"`\n###########################################################\nif [ ! -r "${PASSFILE}" ]; then\necho "${TIME_STAMP}: Could not open password file \\"${PASSFILE}\\" for reading." >> ${LOG_FILE}\nexit 1\nfi\nCORRECT_PASSWORD=`awk \'!/^;/&&!/^#/&&$1=="\'${username}\'"{print $2;exit}\' ${PASSFILE}`\nif [ "${CORRECT_PASSWORD}" = "" ]; then\necho "${TIME_STAMP}: User does not exist: username=\\"${username}\\", password=\\"${password}\\"." >> ${LOG_FILE}\nexit 1\nfi\nif [ "${password}" = "${CORRECT_PASSWORD}" ]; then\necho "${TIME_STAMP}: Successful authentication: username=\\"${username}\\"." >> ${LOG_FILE}\nexit 0\nfi\necho "${TIME_STAMP}: Incorrect password: username=\\"${username}\\", password=\\"${password}\\"." >> ${LOG_FILE}\nexit 1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n# éç½®systemdå¯å¨èæ¬\n\n[root@host-172-16-30-22 openvpn]# cat /usr/lib/systemd/system/openvpn.service\n[Unit]\nDescription=openvpn\nAfter=network.target\n[Service]\nEnvironmentFile=-/etc/openvpn/openvpn\nExecStart=/opt/apps/openvpn/sbin/openvpn --config /etc/openvpn/server.conf\nRestart=on-failure\nType=simple\nLimitNOFILE=65536\n[Install]\nWantedBy=multi-user.target\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n[root@host-172-16-30-22 openvpn]# systemctl status openvpn\nâ openvpn.service - openvpn\n   Loaded: loaded (/usr/lib/systemd/system/openvpn.service; disabled; vendor preset: disabled)\n   Active: active (running) since Wed 2022-12-28 11:43:13 CST; 6min ago\n Main PID: 10319 (openvpn)\n    Tasks: 1\n   Memory: 1004.0K\n   CGroup: /system.slice/openvpn.service\n           ââ10319 /opt/apps/openvpn/sbin/openvpn --config /etc/openvpn/server.conf\n\nDec 28 11:43:13 host-172-16-30-22 systemd[1]: Stopped openvpn.\nDec 28 11:43:13 host-172-16-30-22 systemd[1]: Started openvpn.\nDec 28 11:43:13 host-172-16-30-22 openvpn[10319]: 2022-12-28 11:43:13 WARNING: Compression for receiving enabled. Compression has been used in the past to break encryption. Sent packets are not compressed unless "allow-comp...yes" is also set.\nHint: Some lines were ellipsized, use -l to show in full.\n[root@host-172-16-30-22 openvpn]# netstat -tunlp\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      911/sshd            \ntcp        0      0 0.0.0.0:8888            0.0.0.0:*               LISTEN      10319/openvpn       \ntcp6       0      0 :::22                   :::*                    LISTEN      911/sshd            \nudp        0      0 0.0.0.0:68              0.0.0.0:*                           593/dhclient\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n# å¼å¯åæ ¸è·¯ç±è½¬ååè½\n\nvim /etc/sysctl.conf\næ·»å å¦ä¸åå®¹\nnet.ipv4.ip_forward = 1\nsysctl -p\n\n\n1\n2\n3\n4\n\n\n# å®è£openvpnå®¢æ·ç«¯\n\nwindowsålinuxä¸è½½å°åï¼https://openvpn.net/community-downloads/ï¼å¯è½éè¦ç¿»å¢ï¼\n\n 1. å®è£æååï¼æå¼åºç¨ï¼éæ©å¯¼å¥éç½®ãå¯¼å¥client.ovpnæä»¶\n\n 2. å¯¼å¥æååï¼éæ©è¿æ¥å³å¯\n\nmacoså®è£åï¼Tunnelblick_3.7.8_build_5180.dmg\n\n 1. ä¸è½½å®è£MacOSå®¢æ·ç«¯Â https://tunnelblick.net/downloads.htmlÂ éæ©Stableç¨³å®ç Tunnelblick 3.7.8\n\n 2. å®è£æåå åå»client.ovpnï¼éä»¶ï¼\n\n 3. éæ©è¿æ¥client å¼¹çªæ¾ç¤ºconnected åè¿æ¥æå\n\nAndroidç³»ç» å®è£åï¼openvpn-connect-3-0-5.apk\n\n 1. ä¸è½½å®è£å®¢æ·ç«¯Â https://openvpn-connect.en.uptodown.com/androidÂ éæ©ææ°çæ¬\n\n 2. å®è£æååãç¹å»client.ovpn, éæ©ä½¿ç¨openVPN connect æå¼\n\n 3. è¿å¥app, ç¹å»è¿æ¥å³å¯\n\nioså®¢æ·ç«¯\n\n1.å½åapp storeå±è½äºopenvpn clientï¼ææ¶ä¸æ¯æ\n\n2.å½å¤app storeä¸è½½åå¯¼å¥openvpn clientå³å¯\n\n# å®¢æ·ç«¯éç½®\n\nwindowså®¢æ·ç«¯éç½®\n\nclient\ndev tun\nproto tcp\nremote 220.231.216.147 8888\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\nca ca.crt\ntls-auth ta.key 1\ncipher AES-256-CBC\ncomp-lzo\nverb 3\nauth-user-pass\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nappç«¯éç½®\n\næ³¨æï¼APPç«¯éç½®å¨windwosä¸»æºéç½®è¦æ³¨ææä»¶æ ¼å¼ï¼ä¸ç¶ä¼æ¥éline is too long\n\nclient\ndev tun\nproto tcp\nremote 220.231.216.147 8888 tcp-client\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\ncipher AES-256-CBC\ncomp-lzo\nverb 3\n<ca>\n-----BEGIN CERTIFICATE-----\nxxx\n-----END CERTIFICATE-----\n\n</ca>\n\nkey-direction 1\n\n<tls-auth>\n#\n# 2048 bit OpenVPN static key\n#\n-----BEGIN OpenVPN Static key V1-----\nxxxx\n-----END OpenVPN Static key V1-----\n\n</tls-auth>\nauth-user-pass\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n',normalizedContent:'# ä¼ä¸çº§openvpnæ­å»º\n\n> openvpnæ¯ä¸ä¸ªç¨äºåå»ºèæä¸ç¨ç½ç»å å¯ééçè½¯ä»¶åï¼ææ©ç±james yonanç¼åãopenvpnåè®¸åå»ºçvpnä½¿ç¨å¬å¼å¯é¥ãçµå­è¯ä¹¦ãæèç¨æ·åï¼å¯ç æ¥è¿è¡èº«ä»½éªè¯ã å®å¤§éä½¿ç¨äºopensslå å¯åºä¸­çsslv3/tlsv1åè®®å½æ°åºã ç®åopenvpnè½å¨solarisãlinuxãopenbsdãfreebsdãnetbsdãmac os xä¸microsoft windowsä»¥åandroidãiosãmacos(2020å¹´å®æ¹æ¨åºmacå®¢æ·ç«¯)ä¸è¿è¡ï¼å¹¶åå«äºè®¸å¤å®å¨æ§çåè½ãå®å¹¶ä¸æ¯ä¸ä¸ªåºäºwebçvpnè½¯ä»¶ï¼ä¹ä¸ä¸ipsecåå¶ä»vpnè½¯ openvpn2.0åå¼å¥äºç¨æ·å/å£ä»¤ç»åçèº«ä»½éªè¯æ¹å¼ï¼å®å¯ä»¥çç¥å®¢æ·ç«¯è¯ä¹¦ï¼ä½æ¯ä»æä¸ä»½æå¡å¨è¯ä¹¦éè¦è¢«ç¨ä½å å¯ã openvpnææçéä¿¡é½åºäºä¸ä¸ªåä¸çipç«¯å£ï¼ é»è®¤ä¸æ¨èä½¿ç¨udpåè®®éè®¯ï¼åæ¶tcpä¹è¢«æ¯æãopenvpnè¿æ¥è½éè¿å¤§å¤æ°çä»£çæå¡å¨ï¼å¹¶ä¸è½å¤å¨natçç¯å¢ä¸­å¾å¥½å°å·¥ä½ãæå¡ç«¯å·æåå®¢ æ·ç«¯âæ¨éâæäºç½ç»éç½®ä¿¡æ¯çåè½ï¼è¿äºä¿¡æ¯åæ¬ï¼ipå°åãè·¯ç±è®¾ç½®ç­ã openvpnæä¾äºä¸¤ç§èæç½ç»æ¥å£ï¼éç¨tun/tapé©±å¨ï¼éè¿å®ä»¬ï¼ å¯ä»¥å»ºç«ä¸å±ipé§éï¼æèèæäºå±ä»¥å¤ªç½ï¼åèå¯ä»¥ä¼ éä»»ä½ç±»åçäºå±ä»¥å¤ªç½ç»æ°æ®ãä¼ éçæ°æ®å¯éè¿lzoç®æ³åç¼©ãå¨éæ©åè®®æ¶åï¼éè¦æ³¨æ2ä¸ªå å¯é§éä¹é´çç½ç»ç¶åµï¼å¦æé«å»¶è¿æèä¸¢åè¾å¤çæåµä¸ï¼è¯·éæ©tcpåè®®ä½ä¸ºåºå±åè®®ï¼udpåè®®ç±äºå­å¨æ è¿æ¥åéä¼ æºå¶ï¼å¯¼è´è¦é§éä¸å±çåè®®è¿è¡éä¼ ï¼æçéå¸¸ä½ä¸ã vpnçä¸»è¦ä½ç¨æ¯å¨å±åç½å¤é¨æ¶ä¹å¯ä»¥è®¿é®å±åç½çèµæºï¼æ¯å¦å¬å¸åç½æè®¸å¤èµæºåªè½å¬å¸åç½è®¿é®ï¼èæä»¬å¤æ´¾åºå·®åå·¥è¿æ³è®¿é®å¬å¸åç½èµæº[å¦:gitlab/æµè¯åº/å¶ä»æµè¯ç¯å¢æ¥å£]å°±éè¦éè¿è¿æ¥å¬å¸å¬ç½åºå£æ´é²vpnæ¥å®ç°ã\n> \n> ç±äºä¼æå¨ç¥çåå ï¼å ç§ç®åçvpnåè®®æ¯å¦l2tp/ipsecåpptpåè®®å¨å¤§éå°åºå·²ç»è¢«å¹²æ°çåºæ¬æ æ³æ­£å¸¸ä½¿ç¨äºãå æ­¤ä¹å°±ssl vpnè¿å¯ä»¥ä½¿ç¨ãssl vpnæéå¸¸å¤ç§ï¼ä½å¾å¤é½æ¯åä¸è½¯ä»¶ï¼ä¸å¼æºä¹ä¸éåä¸ªäººæ­å»ºãèopenvpnæ¯ä¸æ¬¾å¼æºçssl vpnï¼å¯ä»¥å¾å®¹ææ¾å°æ­å»ºçæ¹æ³ï¼éå¸¸ç¬¦åæä»¬çè¦æ±ã\n\n\n# åºäºè´¦å·å¯ç çæ­å»º\n\n# å®è£ä¾èµ\n\nyum install -y openssl openssl-devel lzo lzo-devel pam pam-devel automake pkgconfig gcc gcc-c++\n\n\n1\n\n\n# å®è£ç®å½\n\nmkdir /opt/apps\n\n\n1\n\n\n# å®è£easy-rsaå¹¶çæç¸å³è¯ä¹¦\n\neasy-rsa ä¸è½½å°åï¼https://codeload.github.com/openvpn/easy-rsa-old/zip/master\n\nunzip easy-rsa-old-master.zip\n[root@host-172-16-30-22 easy-rsa-old-master]# ls\nconfigure.ac  copying  copyright.gpl  distro  doc  easy-rsa  makefile.am\n\n\n1\n2\n3\n\n\n# çæç¸å³è¯ä¹¦\n\n[root@host-172-16-30-22 2.0]# cd /opt/apps/easy-rsa-old-master/easy-rsa/2.0\n\n\n1\n\n\n# åå¤opensslç¸å³æä»¶\n\nln -s openssl-1.0.0.cnf openssl.cnf\n\n\n1\n\n\n# ç¼è¾è¯ä¹¦åºæ¬ä¿¡æ¯\n\n[root@host-172-16-30-22 2.0]# pwd\n/opt/apps/easy-rsa-old-master/easy-rsa/2.0\nvim vars\nexport key_country="cn"\nexport key_province="sz"\nexport key_city="shenzhen"\nexport key_org="1quant"\nexport key_email="xxx@1quant.com"\n. vars #çæç¯å¢åé\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# çææå¡å¨ç«¯ç§é¥\n\n./build-key-server server\n\n\n1\n\n\n# çæå®¢æ·ç«¯è¯ä¹¦\n\n./build-key client\n\n\n1\n\n\n# åå»ºè¿ªè²Â·èµ«å°æ¼å¯é¥\n\n./build-dh\n\n\n1\n\n\n# æ¥ççæçææè¯ä¹¦\n\n[root@host-172-16-30-22 keys]# ls\n01.pem  ca.crt  client.crt  client.key  index.txt       index.txt.attr.old  serial      server.crt  server.key\n02.pem  ca.key  client.csr  dh2048.pem  index.txt.attr  index.txt.old       serial.old  server.csr  ta.key\n\n\n1\n2\n3\n\n\n# å®è£openvpn\n\nä¸è½½å°åï¼https://openvpn.net/community-downloads/ï¼å¯è½éè¦ç¿»å¢ï¼\n\n tar -xf openvpn-2.5.8.tar.gz\n cd /opt/apps/openvpn-2.5.8\n ./configure --prefix=/opt/apps/openvpn && make && make install\n [root@host-172-16-30-22 apps]# ll\ntotal 1904\ndrwxr-xr-x  5 root  root     4096 jan 23  2018 easy-rsa-old-master\n-rw-------  1 root  root    59661 dec 27 12:30 easy-rsa-old-master-1.zip\ndrwxr-xr-x  7 root  root     4096 dec 27 14:37 openvpn\ndrwxrwxr-x 12 admin admin    4096 dec 27 14:02 openvpn-2.5.8\n-rw-------  1 root  root  1875551 dec 27 11:37 openvpn-2.5.8.tar.gz\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n# éç½®openvpn\n\néç½® openvpn æå¡ç«¯\nåå»ºéç½®æä»¶ç®å½åè¯ä¹¦ç®å½ï¼\nmkdir -p /etc/openvpn        # openvpn éç½®æä»¶è·¯å¾\nmkdir -p /etc/openvpn/pki    # openvpn è¯ä¹¦å­æ¾ä½ç½®\n\n\n1\n2\n3\n4\n\n\n# çæta.keyæä»¶ï¼é²ddosæ»å»ãudpæ·¹æ²¡ç­æ¶ææ»å»ï¼\n\ncd /opt/apps/easy-rsa-old-master/easy-rsa/2.0/keys\n/opt/apps/openvpn/sbin/openvpn --genkey --secret ta.key\n\n\n1\n2\n\n\n# å°ç­¾åçæçcaè¯ä¹¦ç§é¥åæå¡ç«¯è¯ä¹¦ç§é¥æ·è´å°è¯ä¹¦ç®å½ä¸­\n\ncp {ca.crt,ca.key,dh2048.pem,server.crt,server.key,ta.key} /etc/openvpn/pki/\n[root@host-172-16-30-22 pki]# ll\ntotal 32\n-rw-r--r-- 1 root root 2419 dec 27 14:15 ca.crt\n-rw------- 1 root root 3268 dec 27 14:15 ca.key\n-rw-r--r-- 1 root root  424 dec 27 14:15 dh2048.pem\n-rw-r--r-- 1 root root 8203 dec 27 14:15 server.crt\n-rw------- 1 root root 3272 dec 27 14:15 server.key\n-rw------- 1 root root  636 dec 27 14:15 ta.key\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# æ·è´éç½®æä»¶æ¨¡æ¿\n\ncp openvpn-2.5.8/sample/sample-config-files/server.conf /etc/openvpn/\n\n\n1\n\n\n# æ·è´éç½®æä»¶æ¨¡æ¿\n\ncp openvpn-2.5.8/sample/sample-config-files/server.conf /etc/openvpn\n\n\n\n1\n2\n\n\n# ç¼è¾openvpnéç½®æä»¶\n\nlocal 0.0.0.0\nport 8888\nproto tcp\ndev tun\nca /etc/openvpn/pki/ca.crt\ncert /etc/openvpn/pki/server.crt\nkey /etc/openvpn/pki/server.key  # this file should be kept secret\ndh /etc/openvpn/pki/dh2048.pem\nserver 10.8.0.0 255.255.255.0\npush "dhcp-option dns 114.114.114.114"\npush "dhcp-option dns 8.8.8.8"\npush "route 172.16.30.0 255.255.255.0"\npush "route 172.16.60.253 255.255.255.0"\nifconfig-pool-persist ipp.txt\nclient-to-client\nkeepalive 10 120\ntls-auth /etc/openvpn/pki/ta.key 0 # this file is secret\ncipher aes-256-cbc\ncomp-lzo\nuser nobody\ngroup nobody\nauth-user-pass-verify /etc/openvpn/checkpsw.sh via-env\nscript-security 3\nverify-client-cert none\nusername-as-common-name\npersist-key\npersist-tun\nstatus /var/log/openvpn-status.log\nlog         /var/log/openvpn.log\nlog-append  /var/log/openvpn.log\nverb 3\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n# centos7æ·»å é²ç«å¢æ¹å¼è®¿é®åé¨ç½ç»\n\n#å¨æå¡ç«¯å¼å¯é²ç«å¢ï¼æ¾è¡openvpnæå¡ï¼å¹¶ä¸å¼å¯masqueradeã\n#ä¼ç¹ï¼åªéå¨openvpnæå¡ç«¯éç½®é²ç«å¢è§åï¼åé¨ç½ç»ä¸»æºæ ééç½®\nsystemctl start firewalld\nfirewall-cmd --add-masquerade --permanent\nfirewall-cmd --add-service=openvpn --permanent\nfirewall-cmd --reload\n\n\n1\n2\n3\n4\n5\n6\n\n\n# iptableséç½®é²ç«å¢æ¹å¼è®¿é®åé¨ç½ç»\n\niptables -t nat -a postrouting -s 10.10.10.0/24 -o eth0 -j masquerade\nä¹å¯ä»¥è¿æ ·åï¼æ·»å  iptables è½¬åè§åï¼å¯¹æææºå°åï¼openvpnä¸ºå®¢æ·ç«¯åéçå°åï¼ä¸º 10.10.10.0/24 çæ°æ®åè½¬ååè¿è¡æºå°åè½¬æ¢ï¼ä¼ªè£æ openvpn æå¡å¨åç½å°å x.x.x.xï¼ è¿æ · vpn å®¢æ·ç«¯å°±å¯ä»¥è®¿é®æå¡å¨åç½çå¶ä»æºå¨äºã\n\niptables -a postrouting -s 10.10.10.0/24 -j snat --to-source 192.168.1.160\niptables -i input -p tcp -m tcp --dport 8888 -j accept\n\n\n1\n2\n3\n4\n5\n\n\n# ä¸ä¼ å¯ç éªè¯èæ¬\n\n[root@host-172-16-30-22 openvpn]# ll\ntotal 28\n-rwxr-xr-x 1 root root   901 dec 27 14:36 checkpsw.sh\n-rw------- 1 root root     0 dec 27 14:40 ipp.txt\ndrwxr-xr-x 2 root root  4096 dec 27 14:15 pki\n-rw-r--r-- 1 root root    22 dec 27 14:37 psw-file\n-rw-r--r-- 1 root root   807 dec 28 11:42 server.conf\ncat checkpsw.sh\n#!/bin/sh\n###########################################################\npassfile="/etc/openvpn/psw-file"\nlog_file="/opt/apps/openvpn/logs/openvpn-password.log"\ntime_stamp=`date "+%y-%m-%d %t"`\n###########################################################\nif [ ! -r "${passfile}" ]; then\necho "${time_stamp}: could not open password file \\"${passfile}\\" for reading." >> ${log_file}\nexit 1\nfi\ncorrect_password=`awk \'!/^;/&&!/^#/&&$1=="\'${username}\'"{print $2;exit}\' ${passfile}`\nif [ "${correct_password}" = "" ]; then\necho "${time_stamp}: user does not exist: username=\\"${username}\\", password=\\"${password}\\"." >> ${log_file}\nexit 1\nfi\nif [ "${password}" = "${correct_password}" ]; then\necho "${time_stamp}: successful authentication: username=\\"${username}\\"." >> ${log_file}\nexit 0\nfi\necho "${time_stamp}: incorrect password: username=\\"${username}\\", password=\\"${password}\\"." >> ${log_file}\nexit 1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n# éç½®systemdå¯å¨èæ¬\n\n[root@host-172-16-30-22 openvpn]# cat /usr/lib/systemd/system/openvpn.service\n[unit]\ndescription=openvpn\nafter=network.target\n[service]\nenvironmentfile=-/etc/openvpn/openvpn\nexecstart=/opt/apps/openvpn/sbin/openvpn --config /etc/openvpn/server.conf\nrestart=on-failure\ntype=simple\nlimitnofile=65536\n[install]\nwantedby=multi-user.target\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n[root@host-172-16-30-22 openvpn]# systemctl status openvpn\nâ openvpn.service - openvpn\n   loaded: loaded (/usr/lib/systemd/system/openvpn.service; disabled; vendor preset: disabled)\n   active: active (running) since wed 2022-12-28 11:43:13 cst; 6min ago\n main pid: 10319 (openvpn)\n    tasks: 1\n   memory: 1004.0k\n   cgroup: /system.slice/openvpn.service\n           ââ10319 /opt/apps/openvpn/sbin/openvpn --config /etc/openvpn/server.conf\n\ndec 28 11:43:13 host-172-16-30-22 systemd[1]: stopped openvpn.\ndec 28 11:43:13 host-172-16-30-22 systemd[1]: started openvpn.\ndec 28 11:43:13 host-172-16-30-22 openvpn[10319]: 2022-12-28 11:43:13 warning: compression for receiving enabled. compression has been used in the past to break encryption. sent packets are not compressed unless "allow-comp...yes" is also set.\nhint: some lines were ellipsized, use -l to show in full.\n[root@host-172-16-30-22 openvpn]# netstat -tunlp\nactive internet connections (only servers)\nproto recv-q send-q local address           foreign address         state       pid/program name    \ntcp        0      0 0.0.0.0:22              0.0.0.0:*               listen      911/sshd            \ntcp        0      0 0.0.0.0:8888            0.0.0.0:*               listen      10319/openvpn       \ntcp6       0      0 :::22                   :::*                    listen      911/sshd            \nudp        0      0 0.0.0.0:68              0.0.0.0:*                           593/dhclient\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n# å¼å¯åæ ¸è·¯ç±è½¬ååè½\n\nvim /etc/sysctl.conf\næ·»å å¦ä¸åå®¹\nnet.ipv4.ip_forward = 1\nsysctl -p\n\n\n1\n2\n3\n4\n\n\n# å®è£openvpnå®¢æ·ç«¯\n\nwindowsålinuxä¸è½½å°åï¼https://openvpn.net/community-downloads/ï¼å¯è½éè¦ç¿»å¢ï¼\n\n 1. å®è£æååï¼æå¼åºç¨ï¼éæ©å¯¼å¥éç½®ãå¯¼å¥client.ovpnæä»¶\n\n 2. å¯¼å¥æååï¼éæ©è¿æ¥å³å¯\n\nmacoså®è£åï¼tunnelblick_3.7.8_build_5180.dmg\n\n 1. ä¸è½½å®è£macoså®¢æ·ç«¯Â https://tunnelblick.net/downloads.htmlÂ éæ©stableç¨³å®ç tunnelblick 3.7.8\n\n 2. å®è£æåå åå»client.ovpnï¼éä»¶ï¼\n\n 3. éæ©è¿æ¥client å¼¹çªæ¾ç¤ºconnected åè¿æ¥æå\n\nandroidç³»ç» å®è£åï¼openvpn-connect-3-0-5.apk\n\n 1. ä¸è½½å®è£å®¢æ·ç«¯Â https://openvpn-connect.en.uptodown.com/androidÂ éæ©ææ°çæ¬\n\n 2. å®è£æååãç¹å»client.ovpn, éæ©ä½¿ç¨openvpn connect æå¼\n\n 3. è¿å¥app, ç¹å»è¿æ¥å³å¯\n\nioså®¢æ·ç«¯\n\n1.å½åapp storeå±è½äºopenvpn clientï¼ææ¶ä¸æ¯æ\n\n2.å½å¤app storeä¸è½½åå¯¼å¥openvpn clientå³å¯\n\n# å®¢æ·ç«¯éç½®\n\nwindowså®¢æ·ç«¯éç½®\n\nclient\ndev tun\nproto tcp\nremote 220.231.216.147 8888\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\nca ca.crt\ntls-auth ta.key 1\ncipher aes-256-cbc\ncomp-lzo\nverb 3\nauth-user-pass\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nappç«¯éç½®\n\næ³¨æï¼appç«¯éç½®å¨windwosä¸»æºéç½®è¦æ³¨ææä»¶æ ¼å¼ï¼ä¸ç¶ä¼æ¥éline is too long\n\nclient\ndev tun\nproto tcp\nremote 220.231.216.147 8888 tcp-client\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\ncipher aes-256-cbc\ncomp-lzo\nverb 3\n<ca>\n-----begin certificate-----\nxxx\n-----end certificate-----\n\n</ca>\n\nkey-direction 1\n\n<tls-auth>\n#\n# 2048 bit openvpn static key\n#\n-----begin openvpn static key v1-----\nxxxx\n-----end openvpn static key v1-----\n\n</tls-auth>\nauth-user-pass\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n',charsets:{cjk:!0}},{title:"å®ç°V2Rayéè¿CloudFlareèªéIPå é",frontmatter:{title:"å®ç°V2Rayéè¿CloudFlareèªéIPå é",date:"2022-12-15T19:05:28.000Z",permalink:"/pages/e9bb88/",categories:["è¿ç»´","ç¿»å¢æç¨"],tags:[null],readingShow:"top",description:"åè¨ï¼",meta:[{name:"image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/20221212j30ij0mk75k.jpeg"},{name:"twitter:title",content:"å®ç°V2Rayéè¿CloudFlareèªéIPå é"},{name:"twitter:description",content:"åè¨ï¼"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/20221212j30ij0mk75k.jpeg"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/02.%E7%BF%BB%E5%A2%99%E6%95%99%E7%A8%8B/01.%E5%AE%9E%E7%8E%B0V2Ray%E9%80%9A%E8%BF%87CloudFlare%E8%87%AA%E9%80%89IP%E5%8A%A0%E9%80%9F.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å®ç°V2Rayéè¿CloudFlareèªéIPå é"},{property:"og:description",content:"åè¨ï¼"},{property:"og:image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/20221212j30ij0mk75k.jpeg"},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/02.%E7%BF%BB%E5%A2%99%E6%95%99%E7%A8%8B/01.%E5%AE%9E%E7%8E%B0V2Ray%E9%80%9A%E8%BF%87CloudFlare%E8%87%AA%E9%80%89IP%E5%8A%A0%E9%80%9F.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T19:05:28.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"å®ç°V2Rayéè¿CloudFlareèªéIPå é"},{itemprop:"description",content:"åè¨ï¼"},{itemprop:"image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/20221212j30ij0mk75k.jpeg"}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/02.%E7%BF%BB%E5%A2%99%E6%95%99%E7%A8%8B/01.%E5%AE%9E%E7%8E%B0V2Ray%E9%80%9A%E8%BF%87CloudFlare%E8%87%AA%E9%80%89IP%E5%8A%A0%E9%80%9F.html",relativePath:"02.çæ´»/03.å·¥å·/02.ç¿»å¢æç¨/01.å®ç°V2Rayéè¿CloudFlareèªéIPå é.md",key:"v-df98990e",path:"/pages/e9bb88/",headersStr:null,content:"åè¨ï¼\n\næ éä½¿ç¨DNSpodåèç²¾çµç­å·¥å·ï¼å®ç°èªéIPãæ¬æV2rayå®è£ä½¿ç¨v2-uiï¼å¸¦æwebé¢æ¿ä¸å®¹æåºéã\n\nä¸ãåå¤\n\næ³¨åCloudFlareè´¦å·\n\nè´­ä¹°é¡¶çº§åå\n\nVPS\n\näºãå®è£v2-ui\n\nå¯åèä½èåå®¢æç¨ï¼https://blog.sprov.xyz/2019/08/03/v2-ui/\n\nä¸é®å®è£ï¼bash <(curl -Ls https://blog.sprov.xyz/v2-ui.sh)\n\nä¸ãç³è¯·SSLè¯ä¹¦\n\nç´æ¥æç´¢FreeSSLç³è¯·åè´¹SSLè¯ä¹¦å¤§ææç¨\n\nä¹å¯åèv2-uiä½èæç¨ï¼å¨ FreeSSL ä¸ä¸ºä½ çååç³è¯·åè´¹ SSL è¯ä¹¦\n\nåãä½¿ç¨v2-uiéç½®V2ray\n\næå¼v2-uié¢æ¿ï¼http://æå¡å¨IP:65432\n\né»è®¤ç¨æ·åå¯ç ï¼admin\n\næ·»å è´¦å·ï¼\n\nåæ°è®¾ç½®ï¼ï¼ç«¯å£å¡«å443ï¼å¾ä¸çº¢å­åéäºï¼\n\n\n\näºãéç½®ClouFlare\n\nåå°ååæ·»å å°CloudFlareï¼ç¹å»æ¥æ¾æç¨\n\næ·»å DNSè§£æï¼\n\n\n\n\n\nå­ãéæ©éåèªå·±çIP\n\nä½¿ç¨æ¥æ¾éåèªå·±å½åç½ç»ç¯å¢çä¼éCloudflare Anycast IPå·¥å·ï¼better-cloudflare-ip\n\nä¸ãâ²â²â²éç¹ï¼éç½®V2rayå®¢æ·ç«¯\n\nè¿éä»¥çµèçä¸ºä¾ï¼å¶ä»çæ¬è®¾ç½®æ¹æ³ç¸å\n\nåå°ä¹åå¨v2-uiä¸åå»ºçè´¦å·å¯¼å¥V2rayå®¢æ·ç«¯ï¼\n\n\n\n\n\nä¿®æ¹éç½®ï¼\n\nè¿éç´æ¥å°éåºæ¥çIPå¡«å¥æå¡å¨å°åä¸­ï¼æå¡å¨å°åå¡«å¥ä¼ªè£ååä¸­è¾¾å°æµéèµ°èªéIPçææï¼èä¸éè¦èç²¾çµç­å·¥å·ã\n\n\n\nå°æå·§\n\nå¯ä»¥ç´æ¥å°èªéIPéè¿DNSè§£æè®°å½å°ä¸ä¸ªäºçº§ååï¼å°äºçº§ååç´æ¥å¡«å¥V2rayå®¢æ·ç«¯æå¡å¨å°åä¸­ï¼ä¹å°±æ¯å¡«åèªéIPçä½ç½®ãå¯¹äºå¤ä¸ªç¨æ·å°±å¯ä»¥ç´æ¥æ´æ¹DNSè§£æè¾¾å°æ´æ¹ææèªéIPçææãå¦ä¸å¾ï¼\n\n\n\n\n\nåæé¾æ¥ï¼\n\nhttps://blog.52learn.top/index.php/archives/16/\n\n----------------------------------------\n\nä½¿ç¨æ¥æ¾éåèªå·±å½åç½ç»ç¯å¢çä¼éCloudflare Anycast IP\n\nhttps://github.com/XIU2/CloudflareSpeedTest/releases\n\nç¾åº¦ç½çæä»¶cloudflareST",normalizedContent:"åè¨ï¼\n\næ éä½¿ç¨dnspodåèç²¾çµç­å·¥å·ï¼å®ç°èªéipãæ¬æv2rayå®è£ä½¿ç¨v2-uiï¼å¸¦æwebé¢æ¿ä¸å®¹æåºéã\n\nä¸ãåå¤\n\næ³¨åcloudflareè´¦å·\n\nè´­ä¹°é¡¶çº§åå\n\nvps\n\näºãå®è£v2-ui\n\nå¯åèä½èåå®¢æç¨ï¼https://blog.sprov.xyz/2019/08/03/v2-ui/\n\nä¸é®å®è£ï¼bash <(curl -ls https://blog.sprov.xyz/v2-ui.sh)\n\nä¸ãç³è¯·sslè¯ä¹¦\n\nç´æ¥æç´¢freesslç³è¯·åè´¹sslè¯ä¹¦å¤§ææç¨\n\nä¹å¯åèv2-uiä½èæç¨ï¼å¨ freessl ä¸ä¸ºä½ çååç³è¯·åè´¹ ssl è¯ä¹¦\n\nåãä½¿ç¨v2-uiéç½®v2ray\n\næå¼v2-uié¢æ¿ï¼http://æå¡å¨ip:65432\n\né»è®¤ç¨æ·åå¯ç ï¼admin\n\næ·»å è´¦å·ï¼\n\nåæ°è®¾ç½®ï¼ï¼ç«¯å£å¡«å443ï¼å¾ä¸çº¢å­åéäºï¼\n\n\n\näºãéç½®clouflare\n\nåå°ååæ·»å å°cloudflareï¼ç¹å»æ¥æ¾æç¨\n\næ·»å dnsè§£æï¼\n\n\n\n\n\nå­ãéæ©éåèªå·±çip\n\nä½¿ç¨æ¥æ¾éåèªå·±å½åç½ç»ç¯å¢çä¼écloudflare anycast ipå·¥å·ï¼better-cloudflare-ip\n\nä¸ãâ²â²â²éç¹ï¼éç½®v2rayå®¢æ·ç«¯\n\nè¿éä»¥çµèçä¸ºä¾ï¼å¶ä»çæ¬è®¾ç½®æ¹æ³ç¸å\n\nåå°ä¹åå¨v2-uiä¸åå»ºçè´¦å·å¯¼å¥v2rayå®¢æ·ç«¯ï¼\n\n\n\n\n\nä¿®æ¹éç½®ï¼\n\nè¿éç´æ¥å°éåºæ¥çipå¡«å¥æå¡å¨å°åä¸­ï¼æå¡å¨å°åå¡«å¥ä¼ªè£ååä¸­è¾¾å°æµéèµ°èªéipçææï¼èä¸éè¦èç²¾çµç­å·¥å·ã\n\n\n\nå°æå·§\n\nå¯ä»¥ç´æ¥å°èªéipéè¿dnsè§£æè®°å½å°ä¸ä¸ªäºçº§ååï¼å°äºçº§ååç´æ¥å¡«å¥v2rayå®¢æ·ç«¯æå¡å¨å°åä¸­ï¼ä¹å°±æ¯å¡«åèªéipçä½ç½®ãå¯¹äºå¤ä¸ªç¨æ·å°±å¯ä»¥ç´æ¥æ´æ¹dnsè§£æè¾¾å°æ´æ¹ææèªéipçææãå¦ä¸å¾ï¼\n\n\n\n\n\nåæé¾æ¥ï¼\n\nhttps://blog.52learn.top/index.php/archives/16/\n\n----------------------------------------\n\nä½¿ç¨æ¥æ¾éåèªå·±å½åç½ç»ç¯å¢çä¼écloudflare anycast ip\n\nhttps://github.com/xiu2/cloudflarespeedtest/releases\n\nç¾åº¦ç½çæä»¶cloudflarest",charsets:{cjk:!0}},{title:"macçµèå¸¸ç¨è½¯ä»¶",frontmatter:{title:"macçµèå¸¸ç¨è½¯ä»¶",date:"2022-12-15T14:59:50.000Z",permalink:"/pages/4ad301/",categories:["çæ´»","å·¥å·"],tags:[null],readingShow:"top",description:"ä»»å¡ï¼notion",meta:[{name:"twitter:title",content:"macçµèå¸¸ç¨è½¯ä»¶"},{name:"twitter:description",content:"ä»»å¡ï¼notion"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/03.mac%E7%94%B5%E8%84%91%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6.html"},{property:"og:type",content:"article"},{property:"og:title",content:"macçµèå¸¸ç¨è½¯ä»¶"},{property:"og:description",content:"ä»»å¡ï¼notion"},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/03.mac%E7%94%B5%E8%84%91%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T14:59:50.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"macçµèå¸¸ç¨è½¯ä»¶"},{itemprop:"description",content:"ä»»å¡ï¼notion"}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/03.mac%E7%94%B5%E8%84%91%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6.html",relativePath:"02.çæ´»/03.å·¥å·/03.macçµèå¸¸ç¨è½¯ä»¶.md",key:"v-303fed36",path:"/pages/4ad301/",headers:[{level:2,title:"macçµèå¸¸ç¨è½¯ä»¶",slug:"macçµèå¸¸ç¨è½¯ä»¶",normalizedTitle:"macçµèå¸¸ç¨è½¯ä»¶",charIndex:2}],headersStr:"macçµèå¸¸ç¨è½¯ä»¶",content:"# macçµèå¸¸ç¨è½¯ä»¶\n\nä»»å¡ï¼notion\n\nç¬è®°ï¼notability\n\npythonå¼åï¼vscode\n\nè¿ç¨windowsçµèï¼micrsoft remote desktop beta\n\nè¿ç¨ssh linuxæå¡å¨ï¼termius beta",normalizedContent:"# macçµèå¸¸ç¨è½¯ä»¶\n\nä»»å¡ï¼notion\n\nç¬è®°ï¼notability\n\npythonå¼åï¼vscode\n\nè¿ç¨windowsçµèï¼micrsoft remote desktop beta\n\nè¿ç¨ssh linuxæå¡å¨ï¼termius beta",charsets:{cjk:!0}},{title:"å·¥å·é¾æ¥",frontmatter:{title:"å·¥å·é¾æ¥",date:"2022-12-16T14:39:26.000Z",permalink:"/pages/8994e9/",categories:["çæ´»","å·¥å·"],tags:[null],readingShow:"top",description:"",meta:[{name:"twitter:title",content:"å·¥å·é¾æ¥"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/04.%E4%B8%AA%E4%BA%BA%E5%B7%A5%E5%85%B7%E9%93%BE%E6%8E%A5.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å·¥å·é¾æ¥"},{property:"og:description",content:""},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/04.%E4%B8%AA%E4%BA%BA%E5%B7%A5%E5%85%B7%E9%93%BE%E6%8E%A5.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-16T14:39:26.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"å·¥å·é¾æ¥"},{itemprop:"description",content:""}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/04.%E4%B8%AA%E4%BA%BA%E5%B7%A5%E5%85%B7%E9%93%BE%E6%8E%A5.html",relativePath:"02.çæ´»/03.å·¥å·/04.ä¸ªäººå·¥å·é¾æ¥.md",key:"v-e138df4c",path:"/pages/8994e9/",headers:[{level:3,title:"å¾çå·¥å·",slug:"å¾çå·¥å·",normalizedTitle:"å¾çå·¥å·",charIndex:12}],headersStr:"å¾çå·¥å·",content:"# ä¸ªäººæ¶èå¤¹\n\n\n# å¾çå·¥å·\n\n * å¨çº¿å¾çåç¼© - docsmall å¨çº¿å¾çåç¼©å·¥å·,å¨çº¿å¾çåç¼©è½¯ä»¶\n\n * ",normalizedContent:"# ä¸ªäººæ¶èå¤¹\n\n\n# å¾çå·¥å·\n\n * å¨çº¿å¾çåç¼© - docsmall å¨çº¿å¾çåç¼©å·¥å·,å¨çº¿å¾çåç¼©è½¯ä»¶\n\n * ",charsets:{cjk:!0}},{title:"vuepresséç½®artalk",frontmatter:{title:"vuepresséç½®artalk",date:"2023-01-11T14:19:31.000Z",permalink:"/pages/468f43/",categories:["çæ´»","å·¥å·"],tags:[null],readingShow:"top",description:"ArtalkÂ æ¯ä¸æ¬¾è½»éãå®å¨ãæä¸æçèªæç®¡è¯è®ºç³»ç»ã",meta:[{name:"twitter:title",content:"vuepresséç½®artalk"},{name:"twitter:description",content:"ArtalkÂ æ¯ä¸æ¬¾è½»éãå®å¨ãæä¸æçèªæç®¡è¯è®ºç³»ç»ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/05.vuepress%E9%85%8D%E7%BD%AEartalk.html"},{property:"og:type",content:"article"},{property:"og:title",content:"vuepresséç½®artalk"},{property:"og:description",content:"ArtalkÂ æ¯ä¸æ¬¾è½»éãå®å¨ãæä¸æçèªæç®¡è¯è®ºç³»ç»ã"},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/05.vuepress%E9%85%8D%E7%BD%AEartalk.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-11T14:19:31.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"vuepresséç½®artalk"},{itemprop:"description",content:"ArtalkÂ æ¯ä¸æ¬¾è½»éãå®å¨ãæä¸æçèªæç®¡è¯è®ºç³»ç»ã"}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/05.vuepress%E9%85%8D%E7%BD%AEartalk.html",relativePath:"02.çæ´»/03.å·¥å·/05.vuepresséç½®artalk.md",key:"v-19ff8e6a",path:"/pages/468f43/",headers:[{level:4,title:"é¨ç½²",slug:"é¨ç½²",normalizedTitle:"é¨ç½²",charIndex:119},{level:4,title:"vuepress éç½®artalk",slug:"vuepress-éç½®artalk",normalizedTitle:"vuepress éç½®artalk",charIndex:376},{level:3,title:"å®è£ä¾èµ",slug:"å®è£ä¾èµ",normalizedTitle:"å®è£ä¾èµ",charIndex:398},{level:3,title:"æ°å»ºArtalk.vueç»ä»¶",slug:"æ°å»ºartalk-vueç»ä»¶",normalizedTitle:"æ°å»ºartalk.vueç»ä»¶",charIndex:432},{level:4,title:"è®¾ç½®è¯è®ºé¡µé¢",slug:"è®¾ç½®è¯è®ºé¡µé¢",normalizedTitle:"è®¾ç½®è¯è®ºé¡µé¢",charIndex:1389}],headersStr:"é¨ç½² vuepress éç½®artalk å®è£ä¾èµ æ°å»ºArtalk.vueç»ä»¶ è®¾ç½®è¯è®ºé¡µé¢",content:'ArtalkÂ æ¯ä¸æ¬¾è½»éãå®å¨ãæä¸æçèªæç®¡è¯è®ºç³»ç»ã\n\nåç«¯å¼å¥æ¹å¼åèhttps://artalk.js.org/guide/backend/fe-control.html\n\næç¤ºï¼æ³¨æéç½®artalkçCORSç­å®å¨æªæ½ã\n\n# é¨ç½²\n\nå¯åèhttps://artalk.js.org/guide/backend/install.html\n\ndocker-compose.yaml\n\nversion: "3"\nservices:\n  artalk:\n    container_name: artalk\n    image: artalk/artalk-go\n    ports:\n      - 23366:23366\n    volumes:\n      - xxx/data:/data\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# vuepress éç½®artalk\n\n\n# å®è£ä¾èµ\n\nyarn add artalk -S\n\n\n1\n\n\n\n# æ°å»ºArtalk.vueç»ä»¶\n\næçvuepressä½¿ç¨çæ¯vdoingä¸»é¢ï¼vuepressçæ¬æ¯1.xxx\n\nå¨vdoing/componentsä¸æ°å»ºArtalk.vueï¼\n\n<template>\n  <div>\n    \x3c!-- èªå®ä¹è¯è®º --\x3e\n    <h2 id="commentArea">è¯è®º</h2>\n    <div id="Comments"></div>\n  </div>\n</template>\n\n<script>\nimport "artalk/dist/Artalk.css";\n\nexport default {\n  mounted() {\n    if (typeof window != "undefined") {\n      // åå§åArtalk\n      this.initArtalk();\n    }\n  },\n  methods: {\n    initArtalk() {\n      const ArtalkComponent = () => ({\n        component: import("artalk"),\n      });\n\n      ArtalkComponent().component.then(function (result) {\n        const Artalk = result.default;\n\n        new Artalk({\n          el: "#Comments",\n          pageKey: "", // é¡µé¢é¾æ¥\n          pageTitle: "", // é¡µé¢æ é¢\n          server: "https://talk.xuqilong.top", // åç«¯å°å\n          site: "ç¨åºå Life",\n        });\n      });\n    },\n  },\n};\n<\/script>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n# è®¾ç½®è¯è®ºé¡µé¢\n\nç¶åå¨æéé¡µé¢æ·»å artalkè¯è®ºç»ä»¶ã ä¾å¦ï¼å¨vdoing/components/Page.vueä¸éç½®è¯è®ºï¼\n\n          <Content class="theme-vdoing-content" />\n          \x3c!-- èªå®ä¹è¯è®º --\x3e\n          <Artalk />\n        </div>\n        <slot name="bottom" v-if="isShowSlotB" />\n        <PageEdit />\n\n\n1\n2\n3\n4\n5\n6\n\n\nåæé¾æ¥ï¼https://xuqilong.top/pages/783df7/#%E6%96%B0%E5%BB%BAartalk-vue%E7%BB%84%E4%BB%B6',normalizedContent:'artalkÂ æ¯ä¸æ¬¾è½»éãå®å¨ãæä¸æçèªæç®¡è¯è®ºç³»ç»ã\n\nåç«¯å¼å¥æ¹å¼åèhttps://artalk.js.org/guide/backend/fe-control.html\n\næç¤ºï¼æ³¨æéç½®artalkçcorsç­å®å¨æªæ½ã\n\n# é¨ç½²\n\nå¯åèhttps://artalk.js.org/guide/backend/install.html\n\ndocker-compose.yaml\n\nversion: "3"\nservices:\n  artalk:\n    container_name: artalk\n    image: artalk/artalk-go\n    ports:\n      - 23366:23366\n    volumes:\n      - xxx/data:/data\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# vuepress éç½®artalk\n\n\n# å®è£ä¾èµ\n\nyarn add artalk -s\n\n\n1\n\n\n\n# æ°å»ºartalk.vueç»ä»¶\n\næçvuepressä½¿ç¨çæ¯vdoingä¸»é¢ï¼vuepressçæ¬æ¯1.xxx\n\nå¨vdoing/componentsä¸æ°å»ºartalk.vueï¼\n\n<template>\n  <div>\n    \x3c!-- èªå®ä¹è¯è®º --\x3e\n    <h2 id="commentarea">è¯è®º</h2>\n    <div id="comments"></div>\n  </div>\n</template>\n\n<script>\nimport "artalk/dist/artalk.css";\n\nexport default {\n  mounted() {\n    if (typeof window != "undefined") {\n      // åå§åartalk\n      this.initartalk();\n    }\n  },\n  methods: {\n    initartalk() {\n      const artalkcomponent = () => ({\n        component: import("artalk"),\n      });\n\n      artalkcomponent().component.then(function (result) {\n        const artalk = result.default;\n\n        new artalk({\n          el: "#comments",\n          pagekey: "", // é¡µé¢é¾æ¥\n          pagetitle: "", // é¡µé¢æ é¢\n          server: "https://talk.xuqilong.top", // åç«¯å°å\n          site: "ç¨åºå life",\n        });\n      });\n    },\n  },\n};\n<\/script>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n\n\n# è®¾ç½®è¯è®ºé¡µé¢\n\nç¶åå¨æéé¡µé¢æ·»å artalkè¯è®ºç»ä»¶ã ä¾å¦ï¼å¨vdoing/components/page.vueä¸éç½®è¯è®ºï¼\n\n          <content class="theme-vdoing-content" />\n          \x3c!-- èªå®ä¹è¯è®º --\x3e\n          <artalk />\n        </div>\n        <slot name="bottom" v-if="isshowslotb" />\n        <pageedit />\n\n\n1\n2\n3\n4\n5\n6\n\n\nåæé¾æ¥ï¼https://xuqilong.top/pages/783df7/#%e6%96%b0%e5%bb%baartalk-vue%e7%bb%84%e4%bb%b6',charsets:{cjk:!0}},{title:"windowsç®å½å®æ¶åæ­¥å·¥å·",frontmatter:{title:"windowsç®å½å®æ¶åæ­¥å·¥å·",date:"2022-12-15T15:00:54.000Z",permalink:"/pages/112008/",categories:["çæ´»","å·¥å·"],tags:[null],readingShow:"top",description:"https://freefilesync.org/",meta:[{name:"twitter:title",content:"windowsç®å½å®æ¶åæ­¥å·¥å·"},{name:"twitter:description",content:"https://freefilesync.org/"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/06.windows%E7%9B%AE%E5%BD%95%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7.html"},{property:"og:type",content:"article"},{property:"og:title",content:"windowsç®å½å®æ¶åæ­¥å·¥å·"},{property:"og:description",content:"https://freefilesync.org/"},{property:"og:url",content:"https://blog.zzppjj.top/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/06.windows%E7%9B%AE%E5%BD%95%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T15:00:54.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"windowsç®å½å®æ¶åæ­¥å·¥å·"},{itemprop:"description",content:"https://freefilesync.org/"}]},regularPath:"/02.%E7%94%9F%E6%B4%BB/03.%E5%B7%A5%E5%85%B7/06.windows%E7%9B%AE%E5%BD%95%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E5%B7%A5%E5%85%B7.html",relativePath:"02.çæ´»/03.å·¥å·/06.windowsç®å½å®æ¶åæ­¥å·¥å·.md",key:"v-24ef5f44",path:"/pages/112008/",headers:[{level:2,title:"windowsç®å½å®æ¶åæ­¥å·¥å·",slug:"windowsç®å½å®æ¶åæ­¥å·¥å·",normalizedTitle:"windowsç®å½å®æ¶åæ­¥å·¥å·",charIndex:2}],headersStr:"windowsç®å½å®æ¶åæ­¥å·¥å·",content:"# windowsç®å½å®æ¶åæ­¥å·¥å·\n\nhttps://freefilesync.org/\n\nDsynchronize",normalizedContent:"# windowsç®å½å®æ¶åæ­¥å·¥å·\n\nhttps://freefilesync.org/\n\ndsynchronize",charsets:{cjk:!0}},{title:"çæ§ç®å½ææä»¶åå",frontmatter:{title:"çæ§ç®å½ææä»¶åå",date:"2022-12-13T18:01:34.000Z",permalink:"/pages/f8da74/",categories:["ç¼ç¨","python"],tags:[null],readingShow:"top",description:"Watchdogçä¸­æçâçé¨çâï¼æä¿æ¤çææãææ©å¼å¥Watchdogæ¯å¨åçæºç³»ç»ä¸­ï¼ç±äºåçæºçå·¥ä½ç¯å¢å®¹æåå°å¤çç£åºçå¹²æ°ï¼å¯¼è´ç¨åºâè·é£âï¼é ææ´ä¸ªç³»ç»æ æ³æ­£å¸¸å·¥ä½ï¼å æ­¤ï¼å¼å¥äºä¸ä¸ªâçé¨çâï¼å¯¹åçæºçè¿è¡ç¶æè¿è¡å®æ¶çæµï¼éå¯¹è¿è¡æéåä¸äºä¿æ¤å¤çï¼è­¬å¦è®©ç³»ç»éå¯ãè¿ç§Watchdogå±äºç¡¬ä»¶å±é¢ï¼å¿é¡»æç¡¬ä»¶çµè·¯çæ¯æã\n>\n> Linuxä¹å¼å¥äºWatchdogï¼å¨Linuxåæ ¸ä¸ï¼å½Watchdogå¯å¨åï¼ä¾¿è®¾å®äºä¸ä¸ªå®æ¶å¨ï¼å¦æå¨è¶æ¶æ¶é´åæ²¡æå¯¹/dev/Watchdogè¿è¡åæä½ï¼åä¼å¯¼è´ç³»ç»éå¯ãéè¿å®æ¶å¨å®ç°çWatchdogå±äºè½¯ä»¶å±é¢ã",meta:[{name:"twitter:title",content:"çæ§ç®å½ææä»¶åå"},{name:"twitter:description",content:"Watchdogçä¸­æçâçé¨çâï¼æä¿æ¤çææãææ©å¼å¥Watchdogæ¯å¨åçæºç³»ç»ä¸­ï¼ç±äºåçæºçå·¥ä½ç¯å¢å®¹æåå°å¤çç£åºçå¹²æ°ï¼å¯¼è´ç¨åºâè·é£âï¼é ææ´ä¸ªç³»ç»æ æ³æ­£å¸¸å·¥ä½ï¼å æ­¤ï¼å¼å¥äºä¸ä¸ªâçé¨çâï¼å¯¹åçæºçè¿è¡ç¶æè¿è¡å®æ¶çæµï¼éå¯¹è¿è¡æéåä¸äºä¿æ¤å¤çï¼è­¬å¦è®©ç³»ç»éå¯ãè¿ç§Watchdogå±äºç¡¬ä»¶å±é¢ï¼å¿é¡»æç¡¬ä»¶çµè·¯çæ¯æã\n>\n> Linuxä¹å¼å¥äºWatchdogï¼å¨Linuxåæ ¸ä¸ï¼å½Watchdogå¯å¨åï¼ä¾¿è®¾å®äºä¸ä¸ªå®æ¶å¨ï¼å¦æå¨è¶æ¶æ¶é´åæ²¡æå¯¹/dev/Watchdogè¿è¡åæä½ï¼åä¼å¯¼è´ç³»ç»éå¯ãéè¿å®æ¶å¨å®ç°çWatchdogå±äºè½¯ä»¶å±é¢ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/01.python/01.%E7%9B%91%E6%8E%A7%E7%9B%AE%E5%BD%95%E6%88%96%E6%96%87%E4%BB%B6%E5%8F%98%E5%8C%96.html"},{property:"og:type",content:"article"},{property:"og:title",content:"çæ§ç®å½ææä»¶åå"},{property:"og:description",content:"Watchdogçä¸­æçâçé¨çâï¼æä¿æ¤çææãææ©å¼å¥Watchdogæ¯å¨åçæºç³»ç»ä¸­ï¼ç±äºåçæºçå·¥ä½ç¯å¢å®¹æåå°å¤çç£åºçå¹²æ°ï¼å¯¼è´ç¨åºâè·é£âï¼é ææ´ä¸ªç³»ç»æ æ³æ­£å¸¸å·¥ä½ï¼å æ­¤ï¼å¼å¥äºä¸ä¸ªâçé¨çâï¼å¯¹åçæºçè¿è¡ç¶æè¿è¡å®æ¶çæµï¼éå¯¹è¿è¡æéåä¸äºä¿æ¤å¤çï¼è­¬å¦è®©ç³»ç»éå¯ãè¿ç§Watchdogå±äºç¡¬ä»¶å±é¢ï¼å¿é¡»æç¡¬ä»¶çµè·¯çæ¯æã\n>\n> Linuxä¹å¼å¥äºWatchdogï¼å¨Linuxåæ ¸ä¸ï¼å½Watchdogå¯å¨åï¼ä¾¿è®¾å®äºä¸ä¸ªå®æ¶å¨ï¼å¦æå¨è¶æ¶æ¶é´åæ²¡æå¯¹/dev/Watchdogè¿è¡åæä½ï¼åä¼å¯¼è´ç³»ç»éå¯ãéè¿å®æ¶å¨å®ç°çWatchdogå±äºè½¯ä»¶å±é¢ã"},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/01.python/01.%E7%9B%91%E6%8E%A7%E7%9B%AE%E5%BD%95%E6%88%96%E6%96%87%E4%BB%B6%E5%8F%98%E5%8C%96.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-13T18:01:34.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"çæ§ç®å½ææä»¶åå"},{itemprop:"description",content:"Watchdogçä¸­æçâçé¨çâï¼æä¿æ¤çææãææ©å¼å¥Watchdogæ¯å¨åçæºç³»ç»ä¸­ï¼ç±äºåçæºçå·¥ä½ç¯å¢å®¹æåå°å¤çç£åºçå¹²æ°ï¼å¯¼è´ç¨åºâè·é£âï¼é ææ´ä¸ªç³»ç»æ æ³æ­£å¸¸å·¥ä½ï¼å æ­¤ï¼å¼å¥äºä¸ä¸ªâçé¨çâï¼å¯¹åçæºçè¿è¡ç¶æè¿è¡å®æ¶çæµï¼éå¯¹è¿è¡æéåä¸äºä¿æ¤å¤çï¼è­¬å¦è®©ç³»ç»éå¯ãè¿ç§Watchdogå±äºç¡¬ä»¶å±é¢ï¼å¿é¡»æç¡¬ä»¶çµè·¯çæ¯æã\n>\n> Linuxä¹å¼å¥äºWatchdogï¼å¨Linuxåæ ¸ä¸ï¼å½Watchdogå¯å¨åï¼ä¾¿è®¾å®äºä¸ä¸ªå®æ¶å¨ï¼å¦æå¨è¶æ¶æ¶é´åæ²¡æå¯¹/dev/Watchdogè¿è¡åæä½ï¼åä¼å¯¼è´ç³»ç»éå¯ãéè¿å®æ¶å¨å®ç°çWatchdogå±äºè½¯ä»¶å±é¢ã"}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/01.python/01.%E7%9B%91%E6%8E%A7%E7%9B%AE%E5%BD%95%E6%88%96%E6%96%87%E4%BB%B6%E5%8F%98%E5%8C%96.html",relativePath:"03.ç¼ç¨/01.python/01.çæ§ç®å½ææä»¶åå.md",key:"v-403a5ccb",path:"/pages/f8da74/",headers:[{level:2,title:"watchdogä»ç»",slug:"watchdogä»ç»",normalizedTitle:"watchdogä»ç»",charIndex:2},{level:2,title:"ç¤ºä¾",slug:"ç¤ºä¾",normalizedTitle:"ç¤ºä¾",charIndex:310}],headersStr:"watchdogä»ç» ç¤ºä¾",content:'# watchdogä»ç»\n\n> Watchdogçä¸­æçâçé¨çâï¼æä¿æ¤çææãææ©å¼å¥Watchdogæ¯å¨åçæºç³»ç»ä¸­ï¼ç±äºåçæºçå·¥ä½ç¯å¢å®¹æåå°å¤çç£åºçå¹²æ°ï¼å¯¼è´ç¨åºâè·é£âï¼é ææ´ä¸ªç³»ç»æ æ³æ­£å¸¸å·¥ä½ï¼å æ­¤ï¼å¼å¥äºä¸ä¸ªâçé¨çâï¼å¯¹åçæºçè¿è¡ç¶æè¿è¡å®æ¶çæµï¼éå¯¹è¿è¡æéåä¸äºä¿æ¤å¤çï¼è­¬å¦è®©ç³»ç»éå¯ãè¿ç§Watchdogå±äºç¡¬ä»¶å±é¢ï¼å¿é¡»æç¡¬ä»¶çµè·¯çæ¯æã\n> \n> Linuxä¹å¼å¥äºWatchdogï¼å¨Linuxåæ ¸ä¸ï¼å½Watchdogå¯å¨åï¼ä¾¿è®¾å®äºä¸ä¸ªå®æ¶å¨ï¼å¦æå¨è¶æ¶æ¶é´åæ²¡æå¯¹/dev/Watchdogè¿è¡åæä½ï¼åä¼å¯¼è´ç³»ç»éå¯ãéè¿å®æ¶å¨å®ç°çWatchdogå±äºè½¯ä»¶å±é¢ã\n\n\n# ç¤ºä¾\n\nfrom watchdog.observers import Observer\nfrom watchdog.events import *\nimport time\n\nclass FileEventHandler(FileSystemEventHandler):\n def __init__(self):\n  FileSystemEventHandler.__init__(self)\n\n def on_moved(self, event):\n  if event.is_directory:\n   print("directory moved from {0} to {1}".format(event.src_path,event.dest_path))\n  else:\n   print("file moved from {0} to {1}".format(event.src_path,event.dest_path))\n\n def on_created(self, event):\n  if event.is_directory:\n   print("directory created:{0}".format(event.src_path))\n  else:\n   print("file created:{0}".format(event.src_path))\n\n def on_deleted(self, event):\n  if event.is_directory:\n   print("directory deleted:{0}".format(event.src_path))\n  else:\n   print("file deleted:{0}".format(event.src_path))\n\n def on_modified(self, event):\n  if event.is_directory:\n   print("directory modified:{0}".format(event.src_path))\n  else:\n   print("file modified:{0}".format(event.src_path))\n\nif __name__ == "__main__":\n observer = Observer()\n event_handler = FileEventHandler()\n observer.schedule(event_handler,r"D:\\code\\dingshirenwu",True)\n observer.start()\n try:\n  while True:\n   time.sleep(1)\n except KeyboardInterrupt:\n  observer.stop()\n observer.join()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n',normalizedContent:'# watchdogä»ç»\n\n> watchdogçä¸­æçâçé¨çâï¼æä¿æ¤çææãææ©å¼å¥watchdogæ¯å¨åçæºç³»ç»ä¸­ï¼ç±äºåçæºçå·¥ä½ç¯å¢å®¹æåå°å¤çç£åºçå¹²æ°ï¼å¯¼è´ç¨åºâè·é£âï¼é ææ´ä¸ªç³»ç»æ æ³æ­£å¸¸å·¥ä½ï¼å æ­¤ï¼å¼å¥äºä¸ä¸ªâçé¨çâï¼å¯¹åçæºçè¿è¡ç¶æè¿è¡å®æ¶çæµï¼éå¯¹è¿è¡æéåä¸äºä¿æ¤å¤çï¼è­¬å¦è®©ç³»ç»éå¯ãè¿ç§watchdogå±äºç¡¬ä»¶å±é¢ï¼å¿é¡»æç¡¬ä»¶çµè·¯çæ¯æã\n> \n> linuxä¹å¼å¥äºwatchdogï¼å¨linuxåæ ¸ä¸ï¼å½watchdogå¯å¨åï¼ä¾¿è®¾å®äºä¸ä¸ªå®æ¶å¨ï¼å¦æå¨è¶æ¶æ¶é´åæ²¡æå¯¹/dev/watchdogè¿è¡åæä½ï¼åä¼å¯¼è´ç³»ç»éå¯ãéè¿å®æ¶å¨å®ç°çwatchdogå±äºè½¯ä»¶å±é¢ã\n\n\n# ç¤ºä¾\n\nfrom watchdog.observers import observer\nfrom watchdog.events import *\nimport time\n\nclass fileeventhandler(filesystemeventhandler):\n def __init__(self):\n  filesystemeventhandler.__init__(self)\n\n def on_moved(self, event):\n  if event.is_directory:\n   print("directory moved from {0} to {1}".format(event.src_path,event.dest_path))\n  else:\n   print("file moved from {0} to {1}".format(event.src_path,event.dest_path))\n\n def on_created(self, event):\n  if event.is_directory:\n   print("directory created:{0}".format(event.src_path))\n  else:\n   print("file created:{0}".format(event.src_path))\n\n def on_deleted(self, event):\n  if event.is_directory:\n   print("directory deleted:{0}".format(event.src_path))\n  else:\n   print("file deleted:{0}".format(event.src_path))\n\n def on_modified(self, event):\n  if event.is_directory:\n   print("directory modified:{0}".format(event.src_path))\n  else:\n   print("file modified:{0}".format(event.src_path))\n\nif __name__ == "__main__":\n observer = observer()\n event_handler = fileeventhandler()\n observer.schedule(event_handler,r"d:\\code\\dingshirenwu",true)\n observer.start()\n try:\n  while true:\n   time.sleep(1)\n except keyboardinterrupt:\n  observer.stop()\n observer.join()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n',charsets:{cjk:!0}},{title:"æ¹éæ´æ¹æä»¶",frontmatter:{title:"æ¹éæ´æ¹æä»¶",date:"2022-12-13T18:01:34.000Z",permalink:"/pages/f659cd/",categories:["ç¼ç¨","python"],tags:[null],readingShow:"top",description:"import os\ngodir = os.listdir('F:\\ckaè®¤è¯\\oldboy_go')",meta:[{name:"twitter:title",content:"æ¹éæ´æ¹æä»¶"},{name:"twitter:description",content:"import os\ngodir = os.listdir('F:\\ckaè®¤è¯\\oldboy_go')"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/01.python/02.%E6%89%B9%E9%87%8F%E6%9B%B4%E6%94%B9%E6%96%87%E4%BB%B6.html"},{property:"og:type",content:"article"},{property:"og:title",content:"æ¹éæ´æ¹æä»¶"},{property:"og:description",content:"import os\ngodir = os.listdir('F:\\ckaè®¤è¯\\oldboy_go')"},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/01.python/02.%E6%89%B9%E9%87%8F%E6%9B%B4%E6%94%B9%E6%96%87%E4%BB%B6.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-13T18:01:34.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"æ¹éæ´æ¹æä»¶"},{itemprop:"description",content:"import os\ngodir = os.listdir('F:\\ckaè®¤è¯\\oldboy_go')"}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/01.python/02.%E6%89%B9%E9%87%8F%E6%9B%B4%E6%94%B9%E6%96%87%E4%BB%B6.html",relativePath:"03.ç¼ç¨/01.python/02.æ¹éæ´æ¹æä»¶.md",key:"v-0542148a",path:"/pages/f659cd/",headers:[{level:2,title:"ä»£ç ç¤ºä¾",slug:"ä»£ç ç¤ºä¾",normalizedTitle:"ä»£ç ç¤ºä¾",charIndex:2}],headersStr:"ä»£ç ç¤ºä¾",content:"# ä»£ç ç¤ºä¾\n\nimport os\ngodir = os.listdir('F:\\ckaè®¤è¯\\oldboy_go')\n\nfor i in godir :\n\n    print(i)\n    if i.count('æ¨±è±è®ºå') :\n        filename = i.split('ãæ¨±è±è®ºå www.sakuraaaa.comã',1)[1]\n        print(filename)\n        oldname = 'F:/ckaè®¤è¯/oldboy_go/'+i\n        newname =  'F:/ckaè®¤è¯/oldboy_go/'+filename\n        os.rename(oldname,newname )\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n",normalizedContent:"# ä»£ç ç¤ºä¾\n\nimport os\ngodir = os.listdir('f:\\ckaè®¤è¯\\oldboy_go')\n\nfor i in godir :\n\n    print(i)\n    if i.count('æ¨±è±è®ºå') :\n        filename = i.split('ãæ¨±è±è®ºå www.sakuraaaa.comã',1)[1]\n        print(filename)\n        oldname = 'f:/ckaè®¤è¯/oldboy_go/'+i\n        newname =  'f:/ckaè®¤è¯/oldboy_go/'+filename\n        os.rename(oldname,newname )\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n",charsets:{cjk:!0}},{title:"pythonå¼ç¨æ°æ®åº",frontmatter:{title:"pythonå¼ç¨æ°æ®åº",date:"2022-12-13T18:35:51.000Z",permalink:"/pages/a109ec/",categories:["ç¼ç¨","python"],tags:[null],readingShow:"top",description:"headers = {'Content-Type':'application/json;charset=UTF-8'}\n    send_data = json.dumps(data).encode('utf-8')\n    ret = requests.post(url=dingdingurl,data=senddata,headers=headers)",meta:[{name:"twitter:title",content:"pythonå¼ç¨æ°æ®åº"},{name:"twitter:description",content:"headers = {'Content-Type':'application/json;charset=UTF-8'}\n    send_data = json.dumps(data).encode('utf-8')\n    ret = requests.post(url=dingdingurl,data=senddata,headers=headers)"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/01.python/03.python%E5%BC%95%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93.html"},{property:"og:type",content:"article"},{property:"og:title",content:"pythonå¼ç¨æ°æ®åº"},{property:"og:description",content:"headers = {'Content-Type':'application/json;charset=UTF-8'}\n    send_data = json.dumps(data).encode('utf-8')\n    ret = requests.post(url=dingdingurl,data=senddata,headers=headers)"},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/01.python/03.python%E5%BC%95%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-13T18:35:51.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"pythonå¼ç¨æ°æ®åº"},{itemprop:"description",content:"headers = {'Content-Type':'application/json;charset=UTF-8'}\n    send_data = json.dumps(data).encode('utf-8')\n    ret = requests.post(url=dingdingurl,data=senddata,headers=headers)"}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/01.python/03.python%E5%BC%95%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93.html",relativePath:"03.ç¼ç¨/01.python/03.pythonå¼ç¨æ°æ®åº.md",key:"v-7246ae2c",path:"/pages/a109ec/",headers:[{level:2,title:"pythonå¼ç¨æ°æ®åºä¸¤ç§æ¹å¼",slug:"pythonå¼ç¨æ°æ®åºä¸¤ç§æ¹å¼",normalizedTitle:"pythonå¼ç¨æ°æ®åºä¸¤ç§æ¹å¼",charIndex:2},{level:4,title:"æ¹å¼ä¸",slug:"æ¹å¼ä¸",normalizedTitle:"æ¹å¼ä¸",charIndex:21},{level:4,title:"æ¹å¼äº",slug:"æ¹å¼äº",normalizedTitle:"æ¹å¼äº",charIndex:1301}],headersStr:"pythonå¼ç¨æ°æ®åºä¸¤ç§æ¹å¼ æ¹å¼ä¸ æ¹å¼äº",content:'# pythonå¼ç¨æ°æ®åºä¸¤ç§æ¹å¼\n\n# æ¹å¼ä¸\n\n# -*- coding: UTF-8 -*-\nimport pymysql\nimport requests\nimport json\n#å»ºç«è¿æ¥\nconn = pymysql.connect(host=\'##\', port=3306, database=\'##\', user=\'##\', password=\'####\')\n#æ¿å°æ¸¸æ \ncursor = conn.cursor()\n#æ§è¡sqlè¯­å¥\nsql = "SELECT * FROM bh_job_exec WHERE job_cde=\'company\' AND exec_status=\'SUCCESS\' AND JSON_UNQUOTE(JSON_EXTRACT(exec_param, \'$.businessDate\')) = DATE_SUB(CURDATE(),INTERVAL 1 DAY);"\n# print(sql)\ndef sendDing(msg):\n    dingding_url=\'https://oapi.dingtalk.com/robot/send?access_token=xxxxx\'\n    data = {"msgtype": "text","text": {"content": "åè­¦:"+str(msg)}}\n    headers = {\'Content-Type\':\'application/json;charset=UTF-8\'}\n    send_data = json.dumps(data).encode(\'utf-8\')\n    ret = requests.post(url=dingding_url,data=send_data,headers=headers)\n\n\ntry:\n    row = cursor.execute(sql)\n    # print(row)\n    # Pythonæ¥è¯¢Mysqlä½¿ç¨ fetchone() æ¹æ³è·ååæ¡æ°æ®, ä½¿ç¨fetchall() æ¹æ³è·åå¤æ¡æ°æ®ã\n    data=cursor.fetchone()\n    #print(data)\n    #è¿è¡å¤æ­\n    if data:\n        #print("GFSSç»ç®æå")\n        sendDing("GFSSç»ç®æå")\n    else:\n        #print("GFSSç»ç®å¤±è´¥")\n        sendDing("GFSSç»ç®å¤±è´¥")\nexcept:\n    print("Error: unable to fetch data")\nfinally:\n    cursor.close()\n    #å³é­æ°æ®åº\n    conn.close()\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n\n\n# æ¹å¼äº\n\n#!/usr/bin/python3\n# -*- coding: utf-8 -*-\nimport pymysql\nimport pickle\nimport os.path,sys\nimport urllib.request\nimport urllib.parse\nimport json\nding_url = "https://oapi.dingtalk.com/robot/send?access_token=xxxx" \ndef get_tabcol_current():\n    tabcol_dic = {}\n    ## ç®æ åºçä¿¡æ¯\n    db = pymysql.connect(host=\'xxx\',\n                         port=13306,\n                         user=\'xx\',\n                         password=\'xx\',\n                         database=\'xxx\')\n    cursor = db.cursor()\n \n    sql = "SELECT * FROM `terminal_session` WHERE date_end is Null"\n \n    cursor.execute(sql)\n    results = cursor.fetchall()\n    for row in results:\n      if row[1] in tabcol_dic:\n          tabcol_dic[row[1]].append(row[2])\n      else:\n          tabcol_dic[row[1]]=[row[2]]\n    cursor.close()\n    db.close()\n    # print(tabcol_dic) \n    return tabcol_dic\n    \ndef send_msg_by_ding(message):\n    header = {\n        "Content-Type": "application/json"\n    }\n    data = {\n        "msgtype": "text", \n        "text": {"content": message}\n    }\n    send_data = json.dumps(data).encode(\'utf-8\')\n    req = urllib.request.Request(ding_url, data=send_data, headers=header, method=\'POST\')\n    ret = urllib.request.urlopen(req)\n    if ret.status != 200:\n        print("send message error!")\ndef main():    \n    ret = get_tabcol_current()\n    # print(ret)\n    add_dic = ret\n    # add_dic = list(ret.values())\n    # del_dic = list(ret.keys())\n    message = "å ¡åæºåè­¦ï¼\\n"\n    if add_dic:\n        for (tab,cols) in add_dic.items():\n            cols.sort()\n            message = message + tab + " ç»å½äº: " + \', \'.join(cols) + "\\n"\n    if add_dic:\n        send_msg_by_ding(message)\n    # print(del_dic)\n    # print(1111)\nif __name__ == \'__main__\':\n    main()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n',normalizedContent:'# pythonå¼ç¨æ°æ®åºä¸¤ç§æ¹å¼\n\n# æ¹å¼ä¸\n\n# -*- coding: utf-8 -*-\nimport pymysql\nimport requests\nimport json\n#å»ºç«è¿æ¥\nconn = pymysql.connect(host=\'##\', port=3306, database=\'##\', user=\'##\', password=\'####\')\n#æ¿å°æ¸¸æ \ncursor = conn.cursor()\n#æ§è¡sqlè¯­å¥\nsql = "select * from bh_job_exec where job_cde=\'company\' and exec_status=\'success\' and json_unquote(json_extract(exec_param, \'$.businessdate\')) = date_sub(curdate(),interval 1 day);"\n# print(sql)\ndef sendding(msg):\n    dingding_url=\'https://oapi.dingtalk.com/robot/send?access_token=xxxxx\'\n    data = {"msgtype": "text","text": {"content": "åè­¦:"+str(msg)}}\n    headers = {\'content-type\':\'application/json;charset=utf-8\'}\n    send_data = json.dumps(data).encode(\'utf-8\')\n    ret = requests.post(url=dingding_url,data=send_data,headers=headers)\n\n\ntry:\n    row = cursor.execute(sql)\n    # print(row)\n    # pythonæ¥è¯¢mysqlä½¿ç¨ fetchone() æ¹æ³è·ååæ¡æ°æ®, ä½¿ç¨fetchall() æ¹æ³è·åå¤æ¡æ°æ®ã\n    data=cursor.fetchone()\n    #print(data)\n    #è¿è¡å¤æ­\n    if data:\n        #print("gfssç»ç®æå")\n        sendding("gfssç»ç®æå")\n    else:\n        #print("gfssç»ç®å¤±è´¥")\n        sendding("gfssç»ç®å¤±è´¥")\nexcept:\n    print("error: unable to fetch data")\nfinally:\n    cursor.close()\n    #å³é­æ°æ®åº\n    conn.close()\n\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n\n\n# æ¹å¼äº\n\n#!/usr/bin/python3\n# -*- coding: utf-8 -*-\nimport pymysql\nimport pickle\nimport os.path,sys\nimport urllib.request\nimport urllib.parse\nimport json\nding_url = "https://oapi.dingtalk.com/robot/send?access_token=xxxx" \ndef get_tabcol_current():\n    tabcol_dic = {}\n    ## ç®æ åºçä¿¡æ¯\n    db = pymysql.connect(host=\'xxx\',\n                         port=13306,\n                         user=\'xx\',\n                         password=\'xx\',\n                         database=\'xxx\')\n    cursor = db.cursor()\n \n    sql = "select * from `terminal_session` where date_end is null"\n \n    cursor.execute(sql)\n    results = cursor.fetchall()\n    for row in results:\n      if row[1] in tabcol_dic:\n          tabcol_dic[row[1]].append(row[2])\n      else:\n          tabcol_dic[row[1]]=[row[2]]\n    cursor.close()\n    db.close()\n    # print(tabcol_dic) \n    return tabcol_dic\n    \ndef send_msg_by_ding(message):\n    header = {\n        "content-type": "application/json"\n    }\n    data = {\n        "msgtype": "text", \n        "text": {"content": message}\n    }\n    send_data = json.dumps(data).encode(\'utf-8\')\n    req = urllib.request.request(ding_url, data=send_data, headers=header, method=\'post\')\n    ret = urllib.request.urlopen(req)\n    if ret.status != 200:\n        print("send message error!")\ndef main():    \n    ret = get_tabcol_current()\n    # print(ret)\n    add_dic = ret\n    # add_dic = list(ret.values())\n    # del_dic = list(ret.keys())\n    message = "å ¡åæºåè­¦ï¼\\n"\n    if add_dic:\n        for (tab,cols) in add_dic.items():\n            cols.sort()\n            message = message + tab + " ç»å½äº: " + \', \'.join(cols) + "\\n"\n    if add_dic:\n        send_msg_by_ding(message)\n    # print(del_dic)\n    # print(1111)\nif __name__ == \'__main__\':\n    main()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n',charsets:{cjk:!0}},{title:"python3ç»é²ç«å¢æ·»å æ¾è¡",frontmatter:{title:"python3ç»é²ç«å¢æ·»å æ¾è¡",date:"2022-12-14T14:51:21.000Z",permalink:"/pages/457fb7/",categories:["ç¼ç¨","python"],tags:[null],readingShow:"top",description:"èæ¬å¦ä¸",meta:[{name:"twitter:title",content:"python3ç»é²ç«å¢æ·»å æ¾è¡"},{name:"twitter:description",content:"èæ¬å¦ä¸"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/01.python/04.python3%E7%BB%99%E9%98%B2%E7%81%AB%E5%A2%99%E6%B7%BB%E5%8A%A0%E6%94%BE%E8%A1%8C.html"},{property:"og:type",content:"article"},{property:"og:title",content:"python3ç»é²ç«å¢æ·»å æ¾è¡"},{property:"og:description",content:"èæ¬å¦ä¸"},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/01.python/04.python3%E7%BB%99%E9%98%B2%E7%81%AB%E5%A2%99%E6%B7%BB%E5%8A%A0%E6%94%BE%E8%A1%8C.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-14T14:51:21.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"python3ç»é²ç«å¢æ·»å æ¾è¡"},{itemprop:"description",content:"èæ¬å¦ä¸"}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/01.python/04.python3%E7%BB%99%E9%98%B2%E7%81%AB%E5%A2%99%E6%B7%BB%E5%8A%A0%E6%94%BE%E8%A1%8C.html",relativePath:"03.ç¼ç¨/01.python/04.python3ç»é²ç«å¢æ·»å æ¾è¡.md",key:"v-0580956a",path:"/pages/457fb7/",headersStr:null,content:"> èæ¬å¦ä¸\n\nfrom http.server import BaseHTTPRequestHandler\nfrom urllib import parse\nimport subprocess\n\nclass GetHandler(BaseHTTPRequestHandler):\n\n    secret_key = r'Hi93d4cfa5863770f9a0c87d8,b85a4ebc7'\n    #secret_key = r'4AULgSBxBESAt3IaItH6C227ik4,fW5o6xr+1!7CfjJSCTf$5jxV)+w7iImrx@'\n    #secret_key = r'4AULgSBxBESAt3IaItH6C227ik4,fW5o6xr+1!7CfjJSCTf$5jxV)+w7iImrx@'\n    #commands = \"iptables -A INPUT -s {}/32 -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT && service iptables save\"\n    commands = r\"\"\"firewall-cmd --add-rich-rule=\"rule family=\"ipv4\" source address=\"{}\" port port=\"3306\" protocol=\"tcp\" accept\" --zone=public --permanent && firew\nall-cmd --reload \"\"\"\n    def process_command(self,client_ip):\n        commands = self.commands.format(client_ip)\n        try:\n            process_result = subprocess.run(commands,stdout=subprocess.PIPE, shell=True, check=True)\n            re_stdout = ''\n            re_stderr = ''\n            if process_result.stdout:\n                re_stdout = str(process_result.stdout,encoding='utf-8')\n            if process_result.stderr:\n                re_stderr = str(process_result.stderr,encoding='utf-8')\n            return (re_stdout, re_stderr)\n        except subprocess.CalledProcessError as e:\n            return \"Process Command Error.\"\n\n        #return subprocess.run(self.commands)\n\n    def do_GET(self):\n       # parsed_path = parse.urlparse(self.path)\n        #parsed_header = parse.urlparse(self.headers)\n        client_ip = self.address_string()\n        #client_ip = self.headers['X-Real-IP']\n        client_request_path = self.path[1:]\n        if client_request_path != self.secret_key:\n            self.send_error(403)\n\n        r_result = self.process_command(client_ip)\n        message = ''.join(r_result)\n        self.send_response(200)\n        self.send_header('Content-Type',\n                         'text/plain; charset=utf-8')\n        self.end_headers()\n        self.wfile.write(message.encode('utf-8'))\n\nif __name__ == '__main__':\n    from http.server import HTTPServer\n    server = HTTPServer(('0.0.0.0', 29999), GetHandler)\n    print('Starting server, use <Ctrl-C> to stop')\n    server.serve_forever()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n",normalizedContent:"> èæ¬å¦ä¸\n\nfrom http.server import basehttprequesthandler\nfrom urllib import parse\nimport subprocess\n\nclass gethandler(basehttprequesthandler):\n\n    secret_key = r'hi93d4cfa5863770f9a0c87d8,b85a4ebc7'\n    #secret_key = r'4aulgsbxbesat3iaith6c227ik4,fw5o6xr+1!7cfjjsctf$5jxv)+w7iimrx@'\n    #secret_key = r'4aulgsbxbesat3iaith6c227ik4,fw5o6xr+1!7cfjjsctf$5jxv)+w7iimrx@'\n    #commands = \"iptables -a input -s {}/32 -p tcp -m state --state new -m tcp --dport 443 -j accept && service iptables save\"\n    commands = r\"\"\"firewall-cmd --add-rich-rule=\"rule family=\"ipv4\" source address=\"{}\" port port=\"3306\" protocol=\"tcp\" accept\" --zone=public --permanent && firew\nall-cmd --reload \"\"\"\n    def process_command(self,client_ip):\n        commands = self.commands.format(client_ip)\n        try:\n            process_result = subprocess.run(commands,stdout=subprocess.pipe, shell=true, check=true)\n            re_stdout = ''\n            re_stderr = ''\n            if process_result.stdout:\n                re_stdout = str(process_result.stdout,encoding='utf-8')\n            if process_result.stderr:\n                re_stderr = str(process_result.stderr,encoding='utf-8')\n            return (re_stdout, re_stderr)\n        except subprocess.calledprocesserror as e:\n            return \"process command error.\"\n\n        #return subprocess.run(self.commands)\n\n    def do_get(self):\n       # parsed_path = parse.urlparse(self.path)\n        #parsed_header = parse.urlparse(self.headers)\n        client_ip = self.address_string()\n        #client_ip = self.headers['x-real-ip']\n        client_request_path = self.path[1:]\n        if client_request_path != self.secret_key:\n            self.send_error(403)\n\n        r_result = self.process_command(client_ip)\n        message = ''.join(r_result)\n        self.send_response(200)\n        self.send_header('content-type',\n                         'text/plain; charset=utf-8')\n        self.end_headers()\n        self.wfile.write(message.encode('utf-8'))\n\nif __name__ == '__main__':\n    from http.server import httpserver\n    server = httpserver(('0.0.0.0', 29999), gethandler)\n    print('starting server, use <ctrl-c> to stop')\n    server.serve_forever()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n",charsets:{cjk:!0}},{title:"pythonçæé¨ç½²èæ¬",frontmatter:{title:"pythonçæé¨ç½²èæ¬",date:"2023-01-06T11:10:56.000Z",permalink:"/pages/d0fcb5/",categories:["ç¼ç¨","python"],tags:[null],readingShow:"top",description:"#!/usr/bin/env python\ncoding=utf-8\n    import os\n    import sys",meta:[{name:"twitter:title",content:"pythonçæé¨ç½²èæ¬"},{name:"twitter:description",content:"#!/usr/bin/env python\ncoding=utf-8\n    import os\n    import sys"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/01.python/05.python%E7%94%9F%E6%88%90%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC.html"},{property:"og:type",content:"article"},{property:"og:title",content:"pythonçæé¨ç½²èæ¬"},{property:"og:description",content:"#!/usr/bin/env python\ncoding=utf-8\n    import os\n    import sys"},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/01.python/05.python%E7%94%9F%E6%88%90%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-06T11:10:56.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"pythonçæé¨ç½²èæ¬"},{itemprop:"description",content:"#!/usr/bin/env python\ncoding=utf-8\n    import os\n    import sys"}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/01.python/05.python%E7%94%9F%E6%88%90%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC.html",relativePath:"03.ç¼ç¨/01.python/05.pythonçæé¨ç½²èæ¬.md",key:"v-71ab6464",path:"/pages/d0fcb5/",headersStr:null,content:'#!/usr/bin/env python\n# coding=utf-8\nimport os\nimport sys\n\nappYml = \'\'\'#!/bin/bash\n\nymlName1="docker-compose.yml"\nbuild_compose_yml(){\ncat>"${ymlName1}"<<EOF\nversion: "3"\nservices:\n  gateway:\n    image: xxx/ait0/gm_subscribe:\\${TAG}\n    container_name: "gm_subscribe"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    environment:\n      MQ_URL: ${MQ_URL}\n      GM_ADDRESS: ${GM_ADDRESS}\n      GM_TOKEN: ${GM_TOKEN}\n      GM_SYMBOLS: ${GM_SYMBOLS}\n      USE_FAKE: ${USE_FAKE}\n    entrypoint: python3 ./gm_subscribe.py\n\nnetworks:\n  network:\n    driver: bridge\n\nEOF\n}\n\n\'\'\'\naitoolsappYml = \'\'\'#!/bin/bash\n\nymlName1="docker-compose.yml"\nbuild_compose_yml(){\ncat>"${ymlName1}"<<EOF\nversion: "3"\nservices:\n  gateway:\n    image: xxx/ait0/python_aitools:%s\n    container_name: "python_aitools"\n    restart: always\n    volumes:\n      - ./config.json:/app/config/config.json\n    networks:\n      - network\n\nnetworks:\n  network:\n    driver: bridge\n\nEOF\n}\n\n\'\'\'\naitoolsEnvScript = \'\'\'\nenvName1="config.json"\nbuild_env(){\ncat>"${envName1}"<<EOF\n{\n  "mysql_param": {\n    "quote_db":{\n      "host": "172.16.30.194",\n      "port": 13307,\n      "user": "dev",\n      "passwd": "dev_pwd",\n      "db": "quote"\n    },\n    "sync_db":{\n      "host": "172.16.30.221",\n      "port": 13306,\n      "user": "root",\n      "passwd": "xxx",\n      "db": "quote_test"\n    },\n    "nano_db":{\n      "host": "xxx",\n      "port": 3306,\n      "user": "readonly",\n      "passwd": "xxxx",\n      "db": "marketdata"\n    },\n    "ait0_db":{\n      "host": "172.16.30.194",\n      "port": 13307,\n      "user": "dev",\n      "passwd": "dev_pwd",\n      "db": "ai_server"\n    }\n  },\n\n  "process_threads": 4,\n  "timer_param": {\n    "gm_stock_time": "15:30",\n    "gm_future_time": "16:30",\n    "nano_time": "09:30",\n    "code_time": "08:30",\n    "price_time": 5\n  },\n  "redis_param": {\n    "host": "172.16.30.194",\n    "port": 16379,\n    "password": "xxx"\n  },\n  "check_code_count" : [\n    {\n        "exchange": "SZSE",\n        "min_count": 2000\n    },\n    {\n        "exchange": "SHSE",\n        "min_count": 2000\n    }\n  ],\n  "check_price": [\n    {\n      "exchange": "SZSE",\n      "symbol": "000001"\n    },\n    {\n      "exchange": "SHSE",\n      "symbol": "600000"\n    }\n  ],\n  "other_param" : {\n    "ding_token": "xxx",\n    "quote_url": "http://172.16.30.194:8888/",\n    "quant_token":"xxxx",\n    "quant_addr": "127.0.0.1:7001"\n   }\n}\n\nEOF\n}\n\'\'\'\nEnvScript = \'\'\'\nenvName1=".env"\nbuild_env(){\ncat>"${envName1}"<<EOF\nTAG=%s\nMQ_URL=%s\nGM_ADDRESS=%s\nGM_TOKEN=%s\nGM_SYMBOLS=%s\nUSE_FAKE=%s\nEOF\n}\n\n\'\'\'\n\naitoolsrunScript = \'\'\'\nbuild_deploy(){\n    docker-compose up -d\n}\n\ninit(){\n    docker-compose down -v\n    docker rmi xxx/ait0/python_aitools:%s\n}\n\nmain(){\n    init\n\n    build_compose_yml\n\n    build_env\n    build_deploy\n}\n\nmain\n\'\'\'\n\n\n\nrunScript = \'\'\'\nbuild_deploy(){\n    docker-compose up -d\n}\n\ninit(){\n    docker-compose down -v\n    docker rmi xxx/ait0/gm_subscribe:%s\n}\n\nmain(){\n    init\n\n    build_compose_yml\n\n    build_env\n    build_deploy\n}\n\nmain\n\'\'\'\n\n\ndef ait0_python_deploy():\n    env_dist = os.environ\n    MQ_URL = env_dist.get("MQ_URL", "amqp://guest:guest@172.16.50.24:15672/quote?heartbeat=0")\n    GM_ADDRESS = env_dist.get("GM_ADDRESS", "172.16.50.23:7001")\n    GM_TOKEN = env_dist.get("GM_TOKEN", "xxx")\n    GM_SYMBOLS = env_dist.get("GM_SYMBOLS", "SZSE.300890,SZSE.300409,SHSE.688700,SHSE.603738,SHSE.688689,SHSE.688668,SZSE.300428,SZSE.002011,SZSE.300416,SZSE.300065,SZSE.300447,SZSE.002897,SZSE.002837,SZSE.300648,SZSE.002518,SHSE.603912,SZSE.002567,SHSE.688556,SHSE.603396,SHSE.603477,SHSE.603596,SZSE.002906,SZSE.002466,SHSE.600563,SZSE.002484,SZSE.002812,SZSE.300274,SZSE.300316,SHSE.688598,SHSE.603806,SHSE.605117,SHSE.603606,SZSE.300850,SZSE.002531,SZSE.300327,SZSE.300633,SZSE.002335,SHSE.601636,SZSE.000959,SZSE.000932,SHSE.600782,SHSE.600985,SHSE.600188,SHSE.601088,SHSE.601600,SZSE.000807,SHSE.601899,SHSE.600362,SZSE.002714,SZSE.000977,SHSE.600845,SZSE.002271,SHSE.603208,SZSE.002572,SZSE.000400,SZSE.002028,SZSE.000733,SHSE.600765,SZSE.002179,SZSE.300394,SZSE.300504,SHSE.600702,SHSE.603198,SHSE.603589,SHSE.600559,SHSE.600197,SHSE.601800,SHSE.601669,SHSE.600426,SHSE.600309,SHSE.600230,SZSE.002241,SZSE.000672,SHSE.600585")\n    USE_FAKE = env_dist.get("USE_FAKE", "0")\n    version = env_dist["version_number"]\n\n    # æ¿æ¢å­ç¬¦ä¸².\n    yml = appYml\n    env1 = EnvScript % (version, MQ_URL, GM_ADDRESS, GM_TOKEN, GM_SYMBOLS, USE_FAKE)\n    run1 = runScript % (version)\n    script = yml + env1 + run1\n\n    # çæèæ¬æä»¶.\n    fp = open("ait0_python.sh", "w")\n    fp.write(script)\n    fp.close()\n\ndef aitools_python_deploy():\n    env_dist = os.environ\n    # MQ_URL = env_dist.get("MQ_URL", "amqp://guest:guest@172.16.50.24:15672/quote?heartbeat=0")\n    # GM_ADDRESS = env_dist.get("GM_ADDRESS", "172.16.50.23:7001")\n    # GM_TOKEN = env_dist.get("GM_TOKEN", "xxx")\n    # GM_SYMBOLS = env_dist.get("GM_SYMBOLS", "SZSE.300890,SZSE.300409,SHSE.688700,SHSE.603738,SHSE.688689,SHSE.688668,SZSE.300428,SZSE.002011,SZSE.300416,SZSE.300065,SZSE.300447,SZSE.002897,SZSE.002837,SZSE.300648,SZSE.002518,SHSE.603912,SZSE.002567,SHSE.688556,SHSE.603396,SHSE.603477,SHSE.603596,SZSE.002906,SZSE.002466,SHSE.600563,SZSE.002484,SZSE.002812,SZSE.300274,SZSE.300316,SHSE.688598,SHSE.603806,SHSE.605117,SHSE.603606,SZSE.300850,SZSE.002531,SZSE.300327,SZSE.300633,SZSE.002335,SHSE.601636,SZSE.000959,SZSE.000932,SHSE.600782,SHSE.600985,SHSE.600188,SHSE.601088,SHSE.601600,SZSE.000807,SHSE.601899,SHSE.600362,SZSE.002714,SZSE.000977,SHSE.600845,SZSE.002271,SHSE.603208,SZSE.002572,SZSE.000400,SZSE.002028,SZSE.000733,SHSE.600765,SZSE.002179,SZSE.300394,SZSE.300504,SHSE.600702,SHSE.603198,SHSE.603589,SHSE.600559,SHSE.600197,SHSE.601800,SHSE.601669,SHSE.600426,SHSE.600309,SHSE.600230,SZSE.002241,SZSE.000672,SHSE.600585")\n    # USE_FAKE = env_dist.get("USE_FAKE", "0")\n    version = env_dist["version_number"]\n\n    # æ¿æ¢å­ç¬¦ä¸².\n    yml = aitoolsappYml % (version)\n    env1 = aitoolsEnvScript\n    run1 = aitoolsrunScript % (version)\n    script = yml + env1 + run1\n\n    # çæèæ¬æä»¶.\n    fp = open("aitools_python.sh", "w")\n    fp.write(script)\n    fp.close()\n\n\nif __name__ == "__main__":\n    param = sys.argv[1]\n    names = param.split(".")\n    n = names[len(names)-1]\n    if n == "ait0_python":\n        ait0_python_deploy()\n    elif n == "aitools":\n        aitools_python_deploy()\n    else:\n        print param\n\n\n#!/usr/bin/env python\n# coding=utf-8\n\nimport os\n\nyml = \'\'\'#!/bin/bash\n\nymlName="docker-compose.yml"\nbuild_compose_yml(){\ncat>"${ymlName}"<<EOF\nversion: "3"\nservices:\n  gateway:\n    image: xxx/quote/gateway:\\${TAG}\n    container_name: "gateway"\n    restart: always\n    ports:\n      - 8888:8888\n      - 39101:9101\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    depends_on:\n      - query\n    environment:\n      QUERY_ADDRESS: \\${QUERY_ADDRESS}\n      TRACING_URL: \\${TRACING_URL}\n      TRACING_SAMPLER: \\${TRACING_SAMPLER}\n      QUERY_TABLES_ADDRESS: \\${QUERY_TABLES_ADDRESS}\n  query:\n    image: xxx/quote/query:\\${TAG}\n    container_name: "query"\n    restart: always\n    ports:\n      - 39102:9102\n      - 8081:8081\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    environment:\n      MARKET_TYPE: \\${MARKET_TYPE}\n      MYSQL_SOURCE: \\${MYSQL_SOURCE}\n      REDIS_ADDRESS: \\${REDIS_ADDRESS}\n      REDIS_PASS: \\${REDIS_PASS}\n      TRACING_URL: \\${TRACING_URL}\n      TRACING_SAMPLER: \\${TRACING_SAMPLER}\n\n  storage:\n    image: xxx/quote/storage:\\${TAG}\n    container_name: "storage"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    environment:\n      MYSQL_SOURCE: \\${MYSQL_SOURCE}\n      STORAGE_MODE: \\${STORAGE_MODE}\n      REDIS_ADDRESS: \\${REDIS_ADDRESS}\n      REDIS_PASS: \\${REDIS_PASS}\n      RABBIT_ADDRESS: \\${RABBIT_ADDRESS}\n      PROC_THREADS: \\${PROC_THREADS}\n      TICKS_WRITE_FLAG: \\${TICKS_WRITE_FLAG}\n      TICK_SAVE_SYMBOLS: \\${TICK_SAVE_SYMBOLS}\n      STORAGE_SERVICE_NAME: \\${STORAGE_SERVICE_NAME}\n      STORAGE_SERVICE_PORT: \\${STORAGE_SERVICE_PORT}\n      STORAGE_LOG_PATH: \\${STORAGE_LOG_PATH}\n  probe:\n    image: xxx/probe/probe:v0.7.0\n    container_name: "probe"\n    restart: always\n    networks:\n      - network\n    ports:\n      - 15888:5888\n    command:\n      - -http=gateway:8888,storage:10001\n      - -grpc=query.rpc:query:8081\n  gm:\n    image: xxx/quote/gm:\\${TAG}\n    container_name: "gm"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    ports:\n      - 9159:9159\n    networks:\n      - network\n    environment:\n      RABBIT_ADDRESS: \\${RABBIT_ADDRESS}\n      GM_OPEN_TIME: \\${GM_OPEN_TIME}\n      GM_SYNC_FLAG: \\${GM_SYNC_FLAG}\n      GM_EXCHANGE_PREFIX_FLAG: \\${GM_EXCHANGE_PREFIX_FLAG}\n      GM_QUOTE_COMMODITY: \\${GM_QUOTE_COMMODITY}\n      GM_EXCHANGE_NO: \\${GM_EXCHANGE_NO}\n      GM_TOKEN: \\${GM_TOKEN}\n      GM_STRATEGY_ID: \\${GM_STRATEGY_ID}\n      GM_SERV_ADDR: \\${GM_SERV_ADDR}\n      TRACING_URL: \\${TRACING_URL}\n      TRACING_SAMPLER: \\${TRACING_SAMPLER}\n      TRANFER_ADDRESS: \\${TRANFER_ADDRESS}\n      GM_SERVICE_NAME: \\${GM_SERVICE_NAME_STOCK}\n      SOURCE_GM_PORT: \\${SOURCE_GM_PORT_STOCK}\n      GM_SERVICE_LOG_PATH: \\${GM_SERVICE_LOG_PATH_STOCK}\n      SOURCE_GM_PROM_PORT: \\${SOURCE_GM_PROM_PORT_STOCK}\n      GM_SEC_TYPES: \\${GM_SEC_TYPES_STOCK}\n  querytables:\n    image: xxx/quote/querytables:\\${TAG}\n    container_name: "querytables"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    ports:\n      - 9104:9104\n    networks:\n      - network\n    environment:\n      MYSQL_SOURCE_TABLES: \\${MYSQL_SOURCE_TABLES}\n      TRACING_URL: \\${TRACING_URL}\n      TRACING_SAMPLER: \\${TRACING_SAMPLER}\n  transfer:\n    image: xxx/quote/transfer:\\${TAG}\n    container_name: "transfer"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    ports:\n      - 8082:8082\n      - 19103:9103\n    networks:\n      - network\n    environment:\n      RABBIT_ADDRESS: \\${RABBIT_ADDRESS}\n      TRACING_URL: \\${TRACING_URL}\n      TRACING_SAMPLER: \\${TRACING_SAMPLER}\n  push:\n    image: xxx/quote/push:\\${TAG}\n    container_name: "push"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    environment:\n      RABBIT_ADDRESS: \\${RABBIT_ADDRESS}\n      TRACING_URL: \\${TRACING_URL}\n      TRACING_SAMPLER: \\${TRACING_SAMPLER}\n  websocketv1:\n    image: xxx/quote/websocketv1:\\${TAG}\n    container_name: "websocketv1"\n    restart: always\n    ports:\n      - 8889:8889\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    depends_on:\n      - push\n    environment:\n      STORAGE_MODE: \\${STORAGE_MODE}\n      PUSH_ADDRESS: \\${PUSH_ADDRESS}\n      TRACING_URL: \\${TRACING_URL}\n      TRACING_SAMPLER: \\${TRACING_SAMPLER}\n  tap:\n    image: xxx/quote/tap:\\${TAG}\n    container_name: "tap"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    environment:\n      ESUNNY_QUOTE_IP: \\${ESUNNY_QUOTE_IP}\n      ESUNNY_QUOTE_PORT: \\${ESUNNY_QUOTE_PORT}\n      ESUNNY_QUOTE_AUTHCODE: \\${ESUNNY_QUOTE_AUTHCODE}\n      ESUNNY_QUOTE_USERNAME: \\${ESUNNY_QUOTE_USERNAME}\n      ESUNNY_QUOTE_PASSWD: \\${ESUNNY_QUOTE_PASSWD}\n      ESUNNY_QUOTE_COMMODITY: \\${ESUNNY_QUOTE_COMMODITY}\n      ESUNNY_TRADE_IP: \\${ESUNNY_TRADE_IP}\n      ESUNNY_TRADE_PORT: \\${ESUNNY_TRADE_PORT}\n      ESUNNY_TRADE_AUTHCODE: \\${ESUNNY_TRADE_AUTHCODE}\n      ESUNNY_TRADE_USERNAME: \\${ESUNNY_TRADE_USERNAME}\n      ESUNNY_TRADE_PASSWD: \\${ESUNNY_TRADE_PASSWD}\n      ESUNNY_COMMODITYNO: \\${ESUNNY_COMMODITYNO}\n      ESUNNY_OPEN_TIME: \\${ESUNNY_OPEN_TIME}\n      ESUNNY_SYNC_FLAG: \\${ESUNNY_SYNC_FLAG}\n      ESUNNY_EXCHANGE_PREFIX_FLAG: \\${ESUNNY_EXCHANGE_PREFIX_FLAG}\n      ESUNNY_LOG_PATH: \\${ESUNNY_LOG_PATH}\n      ESUNNY_QUOTE_FLAG: \\${ESUNNY_QUOTE_FLAG}\n      ESUNNY_EXCHANGE_NO: \\${ESUNNY_EXCHANGE_NO}\n      RABBIT_ADDRESS: \\${RABBIT_ADDRESS}\n      TRACING_URL: \\${TRACING_URL}\n      TRACING_SAMPLER: \\${TRACING_SAMPLER}\n      TRANFER_ADDRESS: \\${TRANFER_ADDRESS}\n\n  ths:\n    image: xxx/quote/ths:\\${TAG}\n    container_name: "ths"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    ports:\n      - 9162:9162\n    networks:\n      - network\n    environment:\n      THS_SERVICE_NAME: \\${THS_SERVICE_NAME}\n      SOURCE_THS_PORT: \\${SOURCE_THS_PORT}\n      SOURCE_THS_PROM_PORT: \\${SOURCE_THS_PROM_PORT}\n      RABBIT_ADDRESS: \\${RABBIT_ADDRESS}\n      TRANFER_ADDRESS: \\${TRANFER_ADDRESS}\n      TRACING_URL: \\${TRACING_URL}\n      TRACING_SAMPLER: \\${TRACING_SAMPLER}\n      THS_ACCESS_TOKEN: \\${THS_ACCESS_TOKEN}\n\n  futu:\n    image: xxx/quote/futu:\\${TAG}\n    container_name: "futu"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    environment:\n      FUTU_SERVICE_NAME: \\${FUTU_SERVICE_NAME}\n      SOURCE_FUTU_PORT: \\${SOURCE_FUTU_PORT}\n      RABBIT_ADDRESS: \\${RABBIT_ADDRESS}\n      FUTU_OPEN_TIME: \\${FUTU_OPEN_TIME}\n      FUTU_SYNC_FLAG: \\${FUTU_SYNC_FLAG}\n      FUTU_EXCHANGE_PREFIX_FLAG: \\${FUTU_EXCHANGE_PREFIX_FLAG}\n      FUTU_QUOTE_SYMBOLS: \\${FUTU_QUOTE_SYMBOLS}\n      FUTU_ADDRESS: \\${FUTU_ADDRESS}\n      FUTU_PORT: \\${FUTU_PORT}\n      FUTU_SERVICE_NAME: \\${FUTU_SERVICE_NAME}\n      FUTU_SERVICE_LOG_PATH: \\${FUTU_SERVICE_LOG_PATH}\n      SOURCE_FUTU_PROM_PORT: \\${SOURCE_FUTU_PROM_PORT}\n      TRACING_URL: \\${TRACING_URL}\n      TRACING_SAMPLER: \\${TRACING_SAMPLER}\n      TRANFER_ADDRESS: \\${TRANFER_ADDRESS}\n\n\n\n\nnetworks:\n  network:\n    driver: bridge\nEOF\n}\n\n\'\'\'\n\nenvScript = \'\'\'\nenvName=".env"\nbuild_env(){\ncat>"${envName}"<<EOF\nTAG=%s\nMYSQL_SOURCE="%s:%s@tcp(%s)/quote?charset=utf8mb4&parseTime=true&loc=Local"\nREDIS_ADDRESS="%s"\nREDIS_PASS="%s"\nRABBIT_ADDRESS="amqp://guest:guest@%s/quote"\nQUERY_ADDRESS="query:8081"\nTRACING_URL="%s"\nTRACING_SAMPLER=0.01\nMARKET_TYPE=%s\nSTORAGE_MODE=%s\nPROC_THREADS=8\nGTA_MYSQL_SOURCE="xx:xx@tcp(xx:3306)/RCWALGOPRD1?charset=utf8mb4&parseTime=true&loc=Local"\nGTA_REDIS_ADDRESS="xx:7788"\nGTA_REDIS_PASS="xx"\nTICKS_WRITE_FLAG=0\nGM_OPEN_TIME="06:10"\nGM_SYNC_FLAG=1\nGM_EXCHANGE_PREFIX_FLAG=1\nGM_QUOTE_COMMODITY=""\nGM_EXCHANGE_NO=""\nGM_TOKEN="%s"\nGM_STRATEGY_ID="xx"\nGM_SERV_ADDR="%s"\nMYSQL_SOURCE_TABLES="xx:123456@tcp(xx:3306)/xx?charset=utf8mb4&parseTime=true&loc=Local"\nQUERY_TABLES_ADDRESS="querytables:8083"\nTRANFER_ADDRESS="transfer:8082"\nPUSH_ADDRESS="push:8080"\nGM_SERVICE_NAME_STOCK=%s\nSOURCE_GM_PORT_STOCK=10010\nGM_SERVICE_LOG_PATH_STOCK=%s\nSOURCE_GM_PROM_PORT_STOCK=9159\nGM_SEC_TYPES_STOCK=%s\nESUNNY_QUOTE_IP=%s\nESUNNY_QUOTE_PORT=%s\nESUNNY_QUOTE_AUTHCODE=%s\nESUNNY_QUOTE_USERNAME=%s\nESUNNY_QUOTE_PASSWD=%s\nESUNNY_TRADE_IP=%s\nESUNNY_TRADE_PORT=%s\nESUNNY_TRADE_AUTHCODE=%s\nESUNNY_TRADE_USERNAME=%s\nESUNNY_TRADE_PASSWD=%s\nESUNNY_COMMODITYNO=%s\nESUNNY_OPEN_TIME=%s\nESUNNY_SYNC_FLAG=%s\nESUNNY_QUOTE_COMMODITY=%s\nESUNNY_EXCHANGE_PREFIX_FLAG=%s\nESUNNY_LOG_PATH=%s\nESUNNY_QUOTE_FLAG=%s\nESUNNY_EXCHANGE_NO=%s\nTICK_SAVE_SYMBOLS="SZSE_000001,SHSE_600000"\nTHS_SERVICE_NAME="ths"\n\n\nFUTU_SERVICE_NAME="futu_source"\nSOURCE_FUTU_PORT="10014"\nFUTU_OPEN_TIME="09:00"\nFUTU_SYNC_FLAG=1\nFUTU_EXCHANGE_PREFIX_FLAG=1\nFUTU_QUOTE_SYMBOLS="00001,00002,00003,00004,00005,00006,00011,00012,00016,00017,00019,00023,00027,00066,00083,00101,00135"\nFUTU_ADDRESS="172.16.60.223"\nFUTU_PORT="11111"\nFUTU_SERVICE_LOG_PATH="logs/futu"\nSOURCE_FUTU_PROM_PORT="9159"\n\n\n\nSOURCE_THS_PORT=10013\nSOURCE_THS_PROM_PORT=9162\nTHS_ACCESS_TOKEN="xxx=.eyJ1aWQiOiI2MzMxNDMwNjQifQ==.CA9BA90A3C7259037D07FC3ACDADBD67F3BB61B2DE62DDC6630370F200FEB833"\nSTORAGE_SERVICE_NAME="quote_storage"\nSTORAGE_SERVICE_PORT=10001\nSTORAGE_LOG_PATH="logs/storage"\nEOF\n}\n\nbuild_deploy(){\n    docker-compose up -d\n}\n\ninit(){\n    docker-compose down -v\n    docker images | grep xxx/quote | grep %s | awk \'{print $1 ":" $2}\' | xargs docker rmi\n}\n\nmain(){\n    init\n\n    build_compose_yml\n\n    build_env\n\n    build_deploy\n}\n\nmain\n\'\'\'\n\ndef build_trade_deploy():\n    env_dist = os.environ\n    es_quote_addr = env_dist.get("ESUNNY_QUOTE_ADDR", "xxx")\n    q_addr = es_quote_addr.split(":")\n    q_ip = q_addr[0]\n    q_port = q_addr[1]\n    es_trade_addr = env_dist.get("ESUNNY_TRADE_ADDR", "xxx")\n    t_addr = es_trade_addr.split(":")\n    t_ip = t_addr[0]\n    t_port = t_addr[1]\n    # æ¿æ¢å­ç¬¦ä¸².\n    env1 = envScript % (env_dist["version_number"], env_dist.get("DATABASE_USER", "dev"), env_dist.get("DATABASE_PWD", "dev_pwd"), env_dist.get("DATABASE_HOST", "172.16.30.194:13306"), \n                       env_dist.get("REDIS_HOST", "172.16.30.193:16379"), env_dist.get("REDIS_PWD", "Gg@xx!!!"), \n                       env_dist.get("RABBITMQ_HOST", "172.16.30.193:15672"), \n                       env_dist.get("TRACING_URL", "http://172.16.30.196:14368/api/traces"), \n                       env_dist.get("MARKET_TYPE", "stock"),\n                       env_dist.get("STORAGE_MODE", "test"), env_dist.get("GM_TOKEN", "xx"), env_dist.get("GM_SERV_ADDR", "172.16.60.223:7001"),\n                       env_dist.get("GM_SERVICE_NAME_STOCK", "gm_stock"),\n                       env_dist.get("GM_SERVICE_LOG_PATH_STOCK", "logs/gm_stock"),\n                       env_dist.get("GM_SEC_TYPES_STOCK", "stock"),\n                       q_ip, q_port, \n                       env_dist.get("ESUNNY_QUOTE_AUTHCODE", "xx"), \n                       env_dist.get("ESUNNY_QUOTE_USERNAME", "ES"), \n                       env_dist.get("ESUNNY_QUOTE_PASSWD", "xx"), \n                       t_ip, t_port, \n                       env_dist.get("ESUNNY_TRADE_AUTHCODE", "xx"), \n                       env_dist.get("ESUNNY_TRADE_USERNAME", "Q576288330"), \n                       env_dist.get("ESUNNY_TRADE_PASSWD", "xx"), \n                       env_dist.get("ESUNNY_COMMODITYNO", "xx"), \n                       env_dist.get("ESUNNY_OPEN_TIME", "04:55"), \n                       env_dist.get("ESUNNY_SYNC_FLAG", "1"),\n                       env_dist.get("ESUNNY_QUOTE_COMMODITY", "HIS,NQ,BO,BP,CL,SV"),\n                       env_dist.get("ESUNNY_EXCHANGE_PREFIX_FLAG", "1"),\n                       env_dist.get("ESUNNY_LOG_PATH", "logs/tap"),\n                       env_dist.get("ESUNNY_QUOTE_FLAG", "0"),\n                       env_dist.get("ESUNNY_EXCHANGE_NO", "x"),\n                       env_dist["version_number"])\n\n    script = yml + env1\n\n    # çæèæ¬æä»¶.\n    fp = open("quote_deploy.sh", "w")\n    fp.write(script)\n    fp.close()\n\n\nif __name__ == "__main__":\n    build_trade_deploy()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n286\n287\n288\n289\n290\n291\n292\n293\n294\n295\n296\n297\n298\n299\n300\n301\n302\n303\n304\n305\n306\n307\n308\n309\n310\n311\n312\n313\n314\n315\n316\n317\n318\n319\n320\n321\n322\n323\n324\n325\n326\n327\n328\n329\n330\n331\n332\n333\n334\n335\n336\n337\n338\n339\n340\n341\n342\n343\n344\n345\n346\n347\n348\n349\n350\n351\n352\n353\n354\n355\n356\n357\n358\n359\n360\n361\n362\n363\n364\n365\n366\n367\n368\n369\n370\n371\n372\n373\n374\n375\n376\n377\n378\n379\n380\n381\n382\n383\n384\n385\n386\n387\n388\n389\n390\n391\n392\n393\n394\n395\n396\n397\n398\n399\n400\n401\n402\n403\n404\n',normalizedContent:'#!/usr/bin/env python\n# coding=utf-8\nimport os\nimport sys\n\nappyml = \'\'\'#!/bin/bash\n\nymlname1="docker-compose.yml"\nbuild_compose_yml(){\ncat>"${ymlname1}"<<eof\nversion: "3"\nservices:\n  gateway:\n    image: xxx/ait0/gm_subscribe:\\${tag}\n    container_name: "gm_subscribe"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    environment:\n      mq_url: ${mq_url}\n      gm_address: ${gm_address}\n      gm_token: ${gm_token}\n      gm_symbols: ${gm_symbols}\n      use_fake: ${use_fake}\n    entrypoint: python3 ./gm_subscribe.py\n\nnetworks:\n  network:\n    driver: bridge\n\neof\n}\n\n\'\'\'\naitoolsappyml = \'\'\'#!/bin/bash\n\nymlname1="docker-compose.yml"\nbuild_compose_yml(){\ncat>"${ymlname1}"<<eof\nversion: "3"\nservices:\n  gateway:\n    image: xxx/ait0/python_aitools:%s\n    container_name: "python_aitools"\n    restart: always\n    volumes:\n      - ./config.json:/app/config/config.json\n    networks:\n      - network\n\nnetworks:\n  network:\n    driver: bridge\n\neof\n}\n\n\'\'\'\naitoolsenvscript = \'\'\'\nenvname1="config.json"\nbuild_env(){\ncat>"${envname1}"<<eof\n{\n  "mysql_param": {\n    "quote_db":{\n      "host": "172.16.30.194",\n      "port": 13307,\n      "user": "dev",\n      "passwd": "dev_pwd",\n      "db": "quote"\n    },\n    "sync_db":{\n      "host": "172.16.30.221",\n      "port": 13306,\n      "user": "root",\n      "passwd": "xxx",\n      "db": "quote_test"\n    },\n    "nano_db":{\n      "host": "xxx",\n      "port": 3306,\n      "user": "readonly",\n      "passwd": "xxxx",\n      "db": "marketdata"\n    },\n    "ait0_db":{\n      "host": "172.16.30.194",\n      "port": 13307,\n      "user": "dev",\n      "passwd": "dev_pwd",\n      "db": "ai_server"\n    }\n  },\n\n  "process_threads": 4,\n  "timer_param": {\n    "gm_stock_time": "15:30",\n    "gm_future_time": "16:30",\n    "nano_time": "09:30",\n    "code_time": "08:30",\n    "price_time": 5\n  },\n  "redis_param": {\n    "host": "172.16.30.194",\n    "port": 16379,\n    "password": "xxx"\n  },\n  "check_code_count" : [\n    {\n        "exchange": "szse",\n        "min_count": 2000\n    },\n    {\n        "exchange": "shse",\n        "min_count": 2000\n    }\n  ],\n  "check_price": [\n    {\n      "exchange": "szse",\n      "symbol": "000001"\n    },\n    {\n      "exchange": "shse",\n      "symbol": "600000"\n    }\n  ],\n  "other_param" : {\n    "ding_token": "xxx",\n    "quote_url": "http://172.16.30.194:8888/",\n    "quant_token":"xxxx",\n    "quant_addr": "127.0.0.1:7001"\n   }\n}\n\neof\n}\n\'\'\'\nenvscript = \'\'\'\nenvname1=".env"\nbuild_env(){\ncat>"${envname1}"<<eof\ntag=%s\nmq_url=%s\ngm_address=%s\ngm_token=%s\ngm_symbols=%s\nuse_fake=%s\neof\n}\n\n\'\'\'\n\naitoolsrunscript = \'\'\'\nbuild_deploy(){\n    docker-compose up -d\n}\n\ninit(){\n    docker-compose down -v\n    docker rmi xxx/ait0/python_aitools:%s\n}\n\nmain(){\n    init\n\n    build_compose_yml\n\n    build_env\n    build_deploy\n}\n\nmain\n\'\'\'\n\n\n\nrunscript = \'\'\'\nbuild_deploy(){\n    docker-compose up -d\n}\n\ninit(){\n    docker-compose down -v\n    docker rmi xxx/ait0/gm_subscribe:%s\n}\n\nmain(){\n    init\n\n    build_compose_yml\n\n    build_env\n    build_deploy\n}\n\nmain\n\'\'\'\n\n\ndef ait0_python_deploy():\n    env_dist = os.environ\n    mq_url = env_dist.get("mq_url", "amqp://guest:guest@172.16.50.24:15672/quote?heartbeat=0")\n    gm_address = env_dist.get("gm_address", "172.16.50.23:7001")\n    gm_token = env_dist.get("gm_token", "xxx")\n    gm_symbols = env_dist.get("gm_symbols", "szse.300890,szse.300409,shse.688700,shse.603738,shse.688689,shse.688668,szse.300428,szse.002011,szse.300416,szse.300065,szse.300447,szse.002897,szse.002837,szse.300648,szse.002518,shse.603912,szse.002567,shse.688556,shse.603396,shse.603477,shse.603596,szse.002906,szse.002466,shse.600563,szse.002484,szse.002812,szse.300274,szse.300316,shse.688598,shse.603806,shse.605117,shse.603606,szse.300850,szse.002531,szse.300327,szse.300633,szse.002335,shse.601636,szse.000959,szse.000932,shse.600782,shse.600985,shse.600188,shse.601088,shse.601600,szse.000807,shse.601899,shse.600362,szse.002714,szse.000977,shse.600845,szse.002271,shse.603208,szse.002572,szse.000400,szse.002028,szse.000733,shse.600765,szse.002179,szse.300394,szse.300504,shse.600702,shse.603198,shse.603589,shse.600559,shse.600197,shse.601800,shse.601669,shse.600426,shse.600309,shse.600230,szse.002241,szse.000672,shse.600585")\n    use_fake = env_dist.get("use_fake", "0")\n    version = env_dist["version_number"]\n\n    # æ¿æ¢å­ç¬¦ä¸².\n    yml = appyml\n    env1 = envscript % (version, mq_url, gm_address, gm_token, gm_symbols, use_fake)\n    run1 = runscript % (version)\n    script = yml + env1 + run1\n\n    # çæèæ¬æä»¶.\n    fp = open("ait0_python.sh", "w")\n    fp.write(script)\n    fp.close()\n\ndef aitools_python_deploy():\n    env_dist = os.environ\n    # mq_url = env_dist.get("mq_url", "amqp://guest:guest@172.16.50.24:15672/quote?heartbeat=0")\n    # gm_address = env_dist.get("gm_address", "172.16.50.23:7001")\n    # gm_token = env_dist.get("gm_token", "xxx")\n    # gm_symbols = env_dist.get("gm_symbols", "szse.300890,szse.300409,shse.688700,shse.603738,shse.688689,shse.688668,szse.300428,szse.002011,szse.300416,szse.300065,szse.300447,szse.002897,szse.002837,szse.300648,szse.002518,shse.603912,szse.002567,shse.688556,shse.603396,shse.603477,shse.603596,szse.002906,szse.002466,shse.600563,szse.002484,szse.002812,szse.300274,szse.300316,shse.688598,shse.603806,shse.605117,shse.603606,szse.300850,szse.002531,szse.300327,szse.300633,szse.002335,shse.601636,szse.000959,szse.000932,shse.600782,shse.600985,shse.600188,shse.601088,shse.601600,szse.000807,shse.601899,shse.600362,szse.002714,szse.000977,shse.600845,szse.002271,shse.603208,szse.002572,szse.000400,szse.002028,szse.000733,shse.600765,szse.002179,szse.300394,szse.300504,shse.600702,shse.603198,shse.603589,shse.600559,shse.600197,shse.601800,shse.601669,shse.600426,shse.600309,shse.600230,szse.002241,szse.000672,shse.600585")\n    # use_fake = env_dist.get("use_fake", "0")\n    version = env_dist["version_number"]\n\n    # æ¿æ¢å­ç¬¦ä¸².\n    yml = aitoolsappyml % (version)\n    env1 = aitoolsenvscript\n    run1 = aitoolsrunscript % (version)\n    script = yml + env1 + run1\n\n    # çæèæ¬æä»¶.\n    fp = open("aitools_python.sh", "w")\n    fp.write(script)\n    fp.close()\n\n\nif __name__ == "__main__":\n    param = sys.argv[1]\n    names = param.split(".")\n    n = names[len(names)-1]\n    if n == "ait0_python":\n        ait0_python_deploy()\n    elif n == "aitools":\n        aitools_python_deploy()\n    else:\n        print param\n\n\n#!/usr/bin/env python\n# coding=utf-8\n\nimport os\n\nyml = \'\'\'#!/bin/bash\n\nymlname="docker-compose.yml"\nbuild_compose_yml(){\ncat>"${ymlname}"<<eof\nversion: "3"\nservices:\n  gateway:\n    image: xxx/quote/gateway:\\${tag}\n    container_name: "gateway"\n    restart: always\n    ports:\n      - 8888:8888\n      - 39101:9101\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    depends_on:\n      - query\n    environment:\n      query_address: \\${query_address}\n      tracing_url: \\${tracing_url}\n      tracing_sampler: \\${tracing_sampler}\n      query_tables_address: \\${query_tables_address}\n  query:\n    image: xxx/quote/query:\\${tag}\n    container_name: "query"\n    restart: always\n    ports:\n      - 39102:9102\n      - 8081:8081\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    environment:\n      market_type: \\${market_type}\n      mysql_source: \\${mysql_source}\n      redis_address: \\${redis_address}\n      redis_pass: \\${redis_pass}\n      tracing_url: \\${tracing_url}\n      tracing_sampler: \\${tracing_sampler}\n\n  storage:\n    image: xxx/quote/storage:\\${tag}\n    container_name: "storage"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    environment:\n      mysql_source: \\${mysql_source}\n      storage_mode: \\${storage_mode}\n      redis_address: \\${redis_address}\n      redis_pass: \\${redis_pass}\n      rabbit_address: \\${rabbit_address}\n      proc_threads: \\${proc_threads}\n      ticks_write_flag: \\${ticks_write_flag}\n      tick_save_symbols: \\${tick_save_symbols}\n      storage_service_name: \\${storage_service_name}\n      storage_service_port: \\${storage_service_port}\n      storage_log_path: \\${storage_log_path}\n  probe:\n    image: xxx/probe/probe:v0.7.0\n    container_name: "probe"\n    restart: always\n    networks:\n      - network\n    ports:\n      - 15888:5888\n    command:\n      - -http=gateway:8888,storage:10001\n      - -grpc=query.rpc:query:8081\n  gm:\n    image: xxx/quote/gm:\\${tag}\n    container_name: "gm"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    ports:\n      - 9159:9159\n    networks:\n      - network\n    environment:\n      rabbit_address: \\${rabbit_address}\n      gm_open_time: \\${gm_open_time}\n      gm_sync_flag: \\${gm_sync_flag}\n      gm_exchange_prefix_flag: \\${gm_exchange_prefix_flag}\n      gm_quote_commodity: \\${gm_quote_commodity}\n      gm_exchange_no: \\${gm_exchange_no}\n      gm_token: \\${gm_token}\n      gm_strategy_id: \\${gm_strategy_id}\n      gm_serv_addr: \\${gm_serv_addr}\n      tracing_url: \\${tracing_url}\n      tracing_sampler: \\${tracing_sampler}\n      tranfer_address: \\${tranfer_address}\n      gm_service_name: \\${gm_service_name_stock}\n      source_gm_port: \\${source_gm_port_stock}\n      gm_service_log_path: \\${gm_service_log_path_stock}\n      source_gm_prom_port: \\${source_gm_prom_port_stock}\n      gm_sec_types: \\${gm_sec_types_stock}\n  querytables:\n    image: xxx/quote/querytables:\\${tag}\n    container_name: "querytables"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    ports:\n      - 9104:9104\n    networks:\n      - network\n    environment:\n      mysql_source_tables: \\${mysql_source_tables}\n      tracing_url: \\${tracing_url}\n      tracing_sampler: \\${tracing_sampler}\n  transfer:\n    image: xxx/quote/transfer:\\${tag}\n    container_name: "transfer"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    ports:\n      - 8082:8082\n      - 19103:9103\n    networks:\n      - network\n    environment:\n      rabbit_address: \\${rabbit_address}\n      tracing_url: \\${tracing_url}\n      tracing_sampler: \\${tracing_sampler}\n  push:\n    image: xxx/quote/push:\\${tag}\n    container_name: "push"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    environment:\n      rabbit_address: \\${rabbit_address}\n      tracing_url: \\${tracing_url}\n      tracing_sampler: \\${tracing_sampler}\n  websocketv1:\n    image: xxx/quote/websocketv1:\\${tag}\n    container_name: "websocketv1"\n    restart: always\n    ports:\n      - 8889:8889\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    depends_on:\n      - push\n    environment:\n      storage_mode: \\${storage_mode}\n      push_address: \\${push_address}\n      tracing_url: \\${tracing_url}\n      tracing_sampler: \\${tracing_sampler}\n  tap:\n    image: xxx/quote/tap:\\${tag}\n    container_name: "tap"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    environment:\n      esunny_quote_ip: \\${esunny_quote_ip}\n      esunny_quote_port: \\${esunny_quote_port}\n      esunny_quote_authcode: \\${esunny_quote_authcode}\n      esunny_quote_username: \\${esunny_quote_username}\n      esunny_quote_passwd: \\${esunny_quote_passwd}\n      esunny_quote_commodity: \\${esunny_quote_commodity}\n      esunny_trade_ip: \\${esunny_trade_ip}\n      esunny_trade_port: \\${esunny_trade_port}\n      esunny_trade_authcode: \\${esunny_trade_authcode}\n      esunny_trade_username: \\${esunny_trade_username}\n      esunny_trade_passwd: \\${esunny_trade_passwd}\n      esunny_commodityno: \\${esunny_commodityno}\n      esunny_open_time: \\${esunny_open_time}\n      esunny_sync_flag: \\${esunny_sync_flag}\n      esunny_exchange_prefix_flag: \\${esunny_exchange_prefix_flag}\n      esunny_log_path: \\${esunny_log_path}\n      esunny_quote_flag: \\${esunny_quote_flag}\n      esunny_exchange_no: \\${esunny_exchange_no}\n      rabbit_address: \\${rabbit_address}\n      tracing_url: \\${tracing_url}\n      tracing_sampler: \\${tracing_sampler}\n      tranfer_address: \\${tranfer_address}\n\n  ths:\n    image: xxx/quote/ths:\\${tag}\n    container_name: "ths"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    ports:\n      - 9162:9162\n    networks:\n      - network\n    environment:\n      ths_service_name: \\${ths_service_name}\n      source_ths_port: \\${source_ths_port}\n      source_ths_prom_port: \\${source_ths_prom_port}\n      rabbit_address: \\${rabbit_address}\n      tranfer_address: \\${tranfer_address}\n      tracing_url: \\${tracing_url}\n      tracing_sampler: \\${tracing_sampler}\n      ths_access_token: \\${ths_access_token}\n\n  futu:\n    image: xxx/quote/futu:\\${tag}\n    container_name: "futu"\n    restart: always\n    volumes:\n      - ./logs:/app/logs\n    networks:\n      - network\n    environment:\n      futu_service_name: \\${futu_service_name}\n      source_futu_port: \\${source_futu_port}\n      rabbit_address: \\${rabbit_address}\n      futu_open_time: \\${futu_open_time}\n      futu_sync_flag: \\${futu_sync_flag}\n      futu_exchange_prefix_flag: \\${futu_exchange_prefix_flag}\n      futu_quote_symbols: \\${futu_quote_symbols}\n      futu_address: \\${futu_address}\n      futu_port: \\${futu_port}\n      futu_service_name: \\${futu_service_name}\n      futu_service_log_path: \\${futu_service_log_path}\n      source_futu_prom_port: \\${source_futu_prom_port}\n      tracing_url: \\${tracing_url}\n      tracing_sampler: \\${tracing_sampler}\n      tranfer_address: \\${tranfer_address}\n\n\n\n\nnetworks:\n  network:\n    driver: bridge\neof\n}\n\n\'\'\'\n\nenvscript = \'\'\'\nenvname=".env"\nbuild_env(){\ncat>"${envname}"<<eof\ntag=%s\nmysql_source="%s:%s@tcp(%s)/quote?charset=utf8mb4&parsetime=true&loc=local"\nredis_address="%s"\nredis_pass="%s"\nrabbit_address="amqp://guest:guest@%s/quote"\nquery_address="query:8081"\ntracing_url="%s"\ntracing_sampler=0.01\nmarket_type=%s\nstorage_mode=%s\nproc_threads=8\ngta_mysql_source="xx:xx@tcp(xx:3306)/rcwalgoprd1?charset=utf8mb4&parsetime=true&loc=local"\ngta_redis_address="xx:7788"\ngta_redis_pass="xx"\nticks_write_flag=0\ngm_open_time="06:10"\ngm_sync_flag=1\ngm_exchange_prefix_flag=1\ngm_quote_commodity=""\ngm_exchange_no=""\ngm_token="%s"\ngm_strategy_id="xx"\ngm_serv_addr="%s"\nmysql_source_tables="xx:123456@tcp(xx:3306)/xx?charset=utf8mb4&parsetime=true&loc=local"\nquery_tables_address="querytables:8083"\ntranfer_address="transfer:8082"\npush_address="push:8080"\ngm_service_name_stock=%s\nsource_gm_port_stock=10010\ngm_service_log_path_stock=%s\nsource_gm_prom_port_stock=9159\ngm_sec_types_stock=%s\nesunny_quote_ip=%s\nesunny_quote_port=%s\nesunny_quote_authcode=%s\nesunny_quote_username=%s\nesunny_quote_passwd=%s\nesunny_trade_ip=%s\nesunny_trade_port=%s\nesunny_trade_authcode=%s\nesunny_trade_username=%s\nesunny_trade_passwd=%s\nesunny_commodityno=%s\nesunny_open_time=%s\nesunny_sync_flag=%s\nesunny_quote_commodity=%s\nesunny_exchange_prefix_flag=%s\nesunny_log_path=%s\nesunny_quote_flag=%s\nesunny_exchange_no=%s\ntick_save_symbols="szse_000001,shse_600000"\nths_service_name="ths"\n\n\nfutu_service_name="futu_source"\nsource_futu_port="10014"\nfutu_open_time="09:00"\nfutu_sync_flag=1\nfutu_exchange_prefix_flag=1\nfutu_quote_symbols="00001,00002,00003,00004,00005,00006,00011,00012,00016,00017,00019,00023,00027,00066,00083,00101,00135"\nfutu_address="172.16.60.223"\nfutu_port="11111"\nfutu_service_log_path="logs/futu"\nsource_futu_prom_port="9159"\n\n\n\nsource_ths_port=10013\nsource_ths_prom_port=9162\nths_access_token="xxx=.eyj1awqioii2mzmxndmwnjqifq==.ca9ba90a3c7259037d07fc3acdadbd67f3bb61b2de62ddc6630370f200feb833"\nstorage_service_name="quote_storage"\nstorage_service_port=10001\nstorage_log_path="logs/storage"\neof\n}\n\nbuild_deploy(){\n    docker-compose up -d\n}\n\ninit(){\n    docker-compose down -v\n    docker images | grep xxx/quote | grep %s | awk \'{print $1 ":" $2}\' | xargs docker rmi\n}\n\nmain(){\n    init\n\n    build_compose_yml\n\n    build_env\n\n    build_deploy\n}\n\nmain\n\'\'\'\n\ndef build_trade_deploy():\n    env_dist = os.environ\n    es_quote_addr = env_dist.get("esunny_quote_addr", "xxx")\n    q_addr = es_quote_addr.split(":")\n    q_ip = q_addr[0]\n    q_port = q_addr[1]\n    es_trade_addr = env_dist.get("esunny_trade_addr", "xxx")\n    t_addr = es_trade_addr.split(":")\n    t_ip = t_addr[0]\n    t_port = t_addr[1]\n    # æ¿æ¢å­ç¬¦ä¸².\n    env1 = envscript % (env_dist["version_number"], env_dist.get("database_user", "dev"), env_dist.get("database_pwd", "dev_pwd"), env_dist.get("database_host", "172.16.30.194:13306"), \n                       env_dist.get("redis_host", "172.16.30.193:16379"), env_dist.get("redis_pwd", "gg@xx!!!"), \n                       env_dist.get("rabbitmq_host", "172.16.30.193:15672"), \n                       env_dist.get("tracing_url", "http://172.16.30.196:14368/api/traces"), \n                       env_dist.get("market_type", "stock"),\n                       env_dist.get("storage_mode", "test"), env_dist.get("gm_token", "xx"), env_dist.get("gm_serv_addr", "172.16.60.223:7001"),\n                       env_dist.get("gm_service_name_stock", "gm_stock"),\n                       env_dist.get("gm_service_log_path_stock", "logs/gm_stock"),\n                       env_dist.get("gm_sec_types_stock", "stock"),\n                       q_ip, q_port, \n                       env_dist.get("esunny_quote_authcode", "xx"), \n                       env_dist.get("esunny_quote_username", "es"), \n                       env_dist.get("esunny_quote_passwd", "xx"), \n                       t_ip, t_port, \n                       env_dist.get("esunny_trade_authcode", "xx"), \n                       env_dist.get("esunny_trade_username", "q576288330"), \n                       env_dist.get("esunny_trade_passwd", "xx"), \n                       env_dist.get("esunny_commodityno", "xx"), \n                       env_dist.get("esunny_open_time", "04:55"), \n                       env_dist.get("esunny_sync_flag", "1"),\n                       env_dist.get("esunny_quote_commodity", "his,nq,bo,bp,cl,sv"),\n                       env_dist.get("esunny_exchange_prefix_flag", "1"),\n                       env_dist.get("esunny_log_path", "logs/tap"),\n                       env_dist.get("esunny_quote_flag", "0"),\n                       env_dist.get("esunny_exchange_no", "x"),\n                       env_dist["version_number"])\n\n    script = yml + env1\n\n    # çæèæ¬æä»¶.\n    fp = open("quote_deploy.sh", "w")\n    fp.write(script)\n    fp.close()\n\n\nif __name__ == "__main__":\n    build_trade_deploy()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n286\n287\n288\n289\n290\n291\n292\n293\n294\n295\n296\n297\n298\n299\n300\n301\n302\n303\n304\n305\n306\n307\n308\n309\n310\n311\n312\n313\n314\n315\n316\n317\n318\n319\n320\n321\n322\n323\n324\n325\n326\n327\n328\n329\n330\n331\n332\n333\n334\n335\n336\n337\n338\n339\n340\n341\n342\n343\n344\n345\n346\n347\n348\n349\n350\n351\n352\n353\n354\n355\n356\n357\n358\n359\n360\n361\n362\n363\n364\n365\n366\n367\n368\n369\n370\n371\n372\n373\n374\n375\n376\n377\n378\n379\n380\n381\n382\n383\n384\n385\n386\n387\n388\n389\n390\n391\n392\n393\n394\n395\n396\n397\n398\n399\n400\n401\n402\n403\n404\n',charsets:{cjk:!0}},{title:"pythonå°å¤ä¸ªæä»¶åå®¹è¾åºå°ä¸ä¸ªæä»¶ä¸­",frontmatter:{title:"pythonå°å¤ä¸ªæä»¶åå®¹è¾åºå°ä¸ä¸ªæä»¶ä¸­",date:"2023-01-09T17:43:27.000Z",permalink:"/pages/8d0b76/",categories:["ç¼ç¨","python"],tags:[null],readingShow:"top",description:"çæå¤ä¸ªæä»¶èæ¬",meta:[{name:"twitter:title",content:"pythonå°å¤ä¸ªæä»¶åå®¹è¾åºå°ä¸ä¸ªæä»¶ä¸­"},{name:"twitter:description",content:"çæå¤ä¸ªæä»¶èæ¬"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/01.python/06.python%E5%B0%86%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E8%BE%93%E5%87%BA%E5%88%B0%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E4%B8%AD.html"},{property:"og:type",content:"article"},{property:"og:title",content:"pythonå°å¤ä¸ªæä»¶åå®¹è¾åºå°ä¸ä¸ªæä»¶ä¸­"},{property:"og:description",content:"çæå¤ä¸ªæä»¶èæ¬"},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/01.python/06.python%E5%B0%86%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E8%BE%93%E5%87%BA%E5%88%B0%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E4%B8%AD.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-09T17:43:27.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"pythonå°å¤ä¸ªæä»¶åå®¹è¾åºå°ä¸ä¸ªæä»¶ä¸­"},{itemprop:"description",content:"çæå¤ä¸ªæä»¶èæ¬"}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/01.python/06.python%E5%B0%86%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E8%BE%93%E5%87%BA%E5%88%B0%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E4%B8%AD.html",relativePath:"03.ç¼ç¨/01.python/06.pythonå°å¤ä¸ªæä»¶åå®¹è¾åºå°ä¸ä¸ªæä»¶ä¸­.md",key:"v-2e07d1a0",path:"/pages/8d0b76/",headersStr:null,content:"çæå¤ä¸ªæä»¶èæ¬\n\n#coding=utf-8\n#import os\n#import sys\n\nsql1Script = '''\nuse scrm_%s;\n-- å¬å¸codeéæ¿æ¢ä¸ºç¸åºå¬å¸çcode\nCREATE OR REPLACE VIEW `scrm_crm_contract` AS SELECT * FROM scrm_jishufuwu.`scrm_crm_contract` WHERE `company_code` = '%s';\n\n-- æ´æ°æ°æ®åºçæ¬.\nINSERT INTO gf_db_version (MAIN_VERSION, DB_VERSION, SQL_NAME) VALUES ('R0028.000', 'R0028.000.000', 'R0028.000.000.0001.company.sql');\n\n'''\n\n\n\ndef init_sql_execute():\n    db_name=[\"Hitech\", \"Ztltech\", \"Bslm\", \"Yn\"]\n    # æ¿æ¢å­ç¬¦ä¸².\n    for item in db_name:\n        sql1 = sql1Script % (item, item)\n        script = sql1\n\n    # çæèæ¬æä»¶.\n        fp = open(\"saas_sql_\"+item+\".sh\", \"w\")\n        fp.write(script)\n        fp.close()\nif __name__ == \"__main__\":\n    init_sql_execute()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nå°å¤ä¸ªæä»¶è¾åºå°ä¸ä¸ªæä»¶ä¸­\n\n#!/usr/bin/python\n#encoding:utf-8\nimport os\n# ç®æ æä»¶å¤¹çè·¯å¾\nfiledir = r'/data/test'\n#è·åç®æ æä»¶çæä»¶åç§°åè¡¨  \nfilenames=os.listdir(filedir)\nf=open(r'/data/test/aa.sh', 'w+')\n\nfor filename in filenames:\n    filepath = filedir + '/' + filename\n    for line in open(filepath):\n        f.writelines(line)\n    f.write('\\n')\nf.close()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n",normalizedContent:"çæå¤ä¸ªæä»¶èæ¬\n\n#coding=utf-8\n#import os\n#import sys\n\nsql1script = '''\nuse scrm_%s;\n-- å¬å¸codeéæ¿æ¢ä¸ºç¸åºå¬å¸çcode\ncreate or replace view `scrm_crm_contract` as select * from scrm_jishufuwu.`scrm_crm_contract` where `company_code` = '%s';\n\n-- æ´æ°æ°æ®åºçæ¬.\ninsert into gf_db_version (main_version, db_version, sql_name) values ('r0028.000', 'r0028.000.000', 'r0028.000.000.0001.company.sql');\n\n'''\n\n\n\ndef init_sql_execute():\n    db_name=[\"hitech\", \"ztltech\", \"bslm\", \"yn\"]\n    # æ¿æ¢å­ç¬¦ä¸².\n    for item in db_name:\n        sql1 = sql1script % (item, item)\n        script = sql1\n\n    # çæèæ¬æä»¶.\n        fp = open(\"saas_sql_\"+item+\".sh\", \"w\")\n        fp.write(script)\n        fp.close()\nif __name__ == \"__main__\":\n    init_sql_execute()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nå°å¤ä¸ªæä»¶è¾åºå°ä¸ä¸ªæä»¶ä¸­\n\n#!/usr/bin/python\n#encoding:utf-8\nimport os\n# ç®æ æä»¶å¤¹çè·¯å¾\nfiledir = r'/data/test'\n#è·åç®æ æä»¶çæä»¶åç§°åè¡¨  \nfilenames=os.listdir(filedir)\nf=open(r'/data/test/aa.sh', 'w+')\n\nfor filename in filenames:\n    filepath = filedir + '/' + filename\n    for line in open(filepath):\n        f.writelines(line)\n    f.write('\\n')\nf.close()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n",charsets:{cjk:!0}},{title:"è¿ç¨pidå¤æ­èæ¬",frontmatter:{title:"è¿ç¨pidå¤æ­èæ¬",date:"2022-12-14T14:30:33.000Z",permalink:"/pages/cae02d/",categories:["ç¼ç¨","shell"],tags:[null],readingShow:"top",description:"ä¸å¡éæ±åç«¯è¿ç¨å®æºä»¥åè½å¨ç­æ¶é´åè¿éæèµ·ï¼ä¸å¡å½±åä¸å¤§ï¼ä½æ¯å¼åéè¦æ¥çcoredumpï¼è¦æ±è½çæ§å°pidååï¼å¨ç°æææ¶ä¸zabbixè½çæ§å¹¶æ¥è­¦ï¼",meta:[{name:"twitter:title",content:"è¿ç¨pidå¤æ­èæ¬"},{name:"twitter:description",content:"ä¸å¡éæ±åç«¯è¿ç¨å®æºä»¥åè½å¨ç­æ¶é´åè¿éæèµ·ï¼ä¸å¡å½±åä¸å¤§ï¼ä½æ¯å¼åéè¦æ¥çcoredumpï¼è¦æ±è½çæ§å°pidååï¼å¨ç°æææ¶ä¸zabbixè½çæ§å¹¶æ¥è­¦ï¼"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/01.%E8%BF%9B%E7%A8%8Bpid%E5%88%A4%E6%96%AD%E8%84%9A%E6%9C%AC.html"},{property:"og:type",content:"article"},{property:"og:title",content:"è¿ç¨pidå¤æ­èæ¬"},{property:"og:description",content:"ä¸å¡éæ±åç«¯è¿ç¨å®æºä»¥åè½å¨ç­æ¶é´åè¿éæèµ·ï¼ä¸å¡å½±åä¸å¤§ï¼ä½æ¯å¼åéè¦æ¥çcoredumpï¼è¦æ±è½çæ§å°pidååï¼å¨ç°æææ¶ä¸zabbixè½çæ§å¹¶æ¥è­¦ï¼"},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/01.%E8%BF%9B%E7%A8%8Bpid%E5%88%A4%E6%96%AD%E8%84%9A%E6%9C%AC.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-14T14:30:33.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"è¿ç¨pidå¤æ­èæ¬"},{itemprop:"description",content:"ä¸å¡éæ±åç«¯è¿ç¨å®æºä»¥åè½å¨ç­æ¶é´åè¿éæèµ·ï¼ä¸å¡å½±åä¸å¤§ï¼ä½æ¯å¼åéè¦æ¥çcoredumpï¼è¦æ±è½çæ§å°pidååï¼å¨ç°æææ¶ä¸zabbixè½çæ§å¹¶æ¥è­¦ï¼"}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/02.shell/01.%E8%BF%9B%E7%A8%8Bpid%E5%88%A4%E6%96%AD%E8%84%9A%E6%9C%AC.html",relativePath:"03.ç¼ç¨/02.shell/01.è¿ç¨pidå¤æ­èæ¬.md",key:"v-6c2001b3",path:"/pages/cae02d/",headersStr:null,content:"# zabbixçæ§è¿ç¨åå¨\n\n> ä¸å¡éæ±åç«¯è¿ç¨å®æºä»¥åè½å¨ç­æ¶é´åè¿éæèµ·ï¼ä¸å¡å½±åä¸å¤§ï¼ä½æ¯å¼åéè¦æ¥çcoredumpï¼è¦æ±è½çæ§å°pidååï¼å¨ç°æææ¶ä¸zabbixè½çæ§å¹¶æ¥è­¦ï¼\n\nå¨æ¯å°æå¡å¨/etc/zabbix/zabbix_agentd.confè®¾ç½®è·¯å¾ï¼æ­¤ä¾åªéè¦piddiff.sh\n\nUserParameter=checkpid,sh /usr/local/script/piddiff.sh\n\n/etc/zabbix/shä¸é¢å­æ¾èæ¬\n\nstorageä¸ºä¸å¡çæ§çidåå¼æ ¹æ®ä¸å¡éæ±\n\n#!/bin/bash\nonl_ok=1\nonl_cored=3\ndir=/etc/zabbix/sh\nif [[ ! -f \"$dir/old.txt\" ]];then\n    ps aux | grep storage | grep -v grep |grep -v probe | grep root | awk '{print $2,$11}' > $dir/old.txt\nelse\n    sleep 1s\nfi\n    ps aux | grep storage | grep -v grep |grep -v probe | grep root | awk '{print $2,$11}' > $dir/now.txt\nif ! diff -q $dir/old.txt $dir/now.txt > /dev/null;then\n    echo $onl_cored\n    diff -c $dir/old.txt $dir/now.txt > $dir/`date \"+%Y%m%d%H%M\"`_diff.txt\n    cat $dir/now.txt > $dir/old.txt\nelse\n    echo $onl_ok\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n",normalizedContent:"# zabbixçæ§è¿ç¨åå¨\n\n> ä¸å¡éæ±åç«¯è¿ç¨å®æºä»¥åè½å¨ç­æ¶é´åè¿éæèµ·ï¼ä¸å¡å½±åä¸å¤§ï¼ä½æ¯å¼åéè¦æ¥çcoredumpï¼è¦æ±è½çæ§å°pidååï¼å¨ç°æææ¶ä¸zabbixè½çæ§å¹¶æ¥è­¦ï¼\n\nå¨æ¯å°æå¡å¨/etc/zabbix/zabbix_agentd.confè®¾ç½®è·¯å¾ï¼æ­¤ä¾åªéè¦piddiff.sh\n\nuserparameter=checkpid,sh /usr/local/script/piddiff.sh\n\n/etc/zabbix/shä¸é¢å­æ¾èæ¬\n\nstorageä¸ºä¸å¡çæ§çidåå¼æ ¹æ®ä¸å¡éæ±\n\n#!/bin/bash\nonl_ok=1\nonl_cored=3\ndir=/etc/zabbix/sh\nif [[ ! -f \"$dir/old.txt\" ]];then\n    ps aux | grep storage | grep -v grep |grep -v probe | grep root | awk '{print $2,$11}' > $dir/old.txt\nelse\n    sleep 1s\nfi\n    ps aux | grep storage | grep -v grep |grep -v probe | grep root | awk '{print $2,$11}' > $dir/now.txt\nif ! diff -q $dir/old.txt $dir/now.txt > /dev/null;then\n    echo $onl_cored\n    diff -c $dir/old.txt $dir/now.txt > $dir/`date \"+%y%m%d%h%m\"`_diff.txt\n    cat $dir/now.txt > $dir/old.txt\nelse\n    echo $onl_ok\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n",charsets:{cjk:!0}},{title:"æ¥å¿åå²èæ¬",frontmatter:{title:"æ¥å¿åå²èæ¬",date:"2022-12-15T12:32:31.000Z",permalink:"/pages/3b937e/",categories:["ç¼ç¨","shell"],tags:[null],readingShow:"top",description:"èæ¬å¦ä¸",meta:[{name:"twitter:title",content:"æ¥å¿åå²èæ¬"},{name:"twitter:description",content:"èæ¬å¦ä¸"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/02.%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2%E8%84%9A%E6%9C%AC.html"},{property:"og:type",content:"article"},{property:"og:title",content:"æ¥å¿åå²èæ¬"},{property:"og:description",content:"èæ¬å¦ä¸"},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/02.%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2%E8%84%9A%E6%9C%AC.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T12:32:31.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"æ¥å¿åå²èæ¬"},{itemprop:"description",content:"èæ¬å¦ä¸"}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/02.shell/02.%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2%E8%84%9A%E6%9C%AC.html",relativePath:"03.ç¼ç¨/02.shell/02.æ¥å¿åå²èæ¬.md",key:"v-6ba31c1d",path:"/pages/3b937e/",headersStr:null,content:'# æ¥å¿åå²èæ¬\n\nèæ¬å¦ä¸\n\næ³¨ï¼å®è£zipå½ä»¤\n\n#!/bin/bash\nloglist=`ls -l /data/applications/*.log |awk -F \'/\' \'{print $NF}\'`\nlogdate=`date "+%Y%m%d"`\nfor logname in $loglist\n  do\n  zip -r /data/applications/logs/"$logname"-"$logdate".zip /data/applications/$logname\n  echo "" > /data/applications/$logname\ndone\nfind /data/applications/logs/* -mtime +60 -exec rm {} \\;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n',normalizedContent:'# æ¥å¿åå²èæ¬\n\nèæ¬å¦ä¸\n\næ³¨ï¼å®è£zipå½ä»¤\n\n#!/bin/bash\nloglist=`ls -l /data/applications/*.log |awk -f \'/\' \'{print $nf}\'`\nlogdate=`date "+%y%m%d"`\nfor logname in $loglist\n  do\n  zip -r /data/applications/logs/"$logname"-"$logdate".zip /data/applications/$logname\n  echo "" > /data/applications/$logname\ndone\nfind /data/applications/logs/* -mtime +60 -exec rm {} \\;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n',charsets:{cjk:!0}},{title:"è®¾ç½®è·³æ¿æºèæ¬",frontmatter:{title:"è®¾ç½®è·³æ¿æºèæ¬",date:"2022-12-15T12:41:13.000Z",permalink:"/pages/69b699/",categories:["ç¼ç¨","shell"],tags:[null],readingShow:"top",description:"åéå¬é¥å°å¯¹åºçæºå¨",meta:[{name:"twitter:title",content:"è®¾ç½®è·³æ¿æºèæ¬"},{name:"twitter:description",content:"åéå¬é¥å°å¯¹åºçæºå¨"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/03.%E8%AE%BE%E7%BD%AE%E8%B7%B3%E6%9D%BF%E6%9C%BA%E8%84%9A%E6%9C%AC.html"},{property:"og:type",content:"article"},{property:"og:title",content:"è®¾ç½®è·³æ¿æºèæ¬"},{property:"og:description",content:"åéå¬é¥å°å¯¹åºçæºå¨"},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/03.%E8%AE%BE%E7%BD%AE%E8%B7%B3%E6%9D%BF%E6%9C%BA%E8%84%9A%E6%9C%AC.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T12:41:13.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"è®¾ç½®è·³æ¿æºèæ¬"},{itemprop:"description",content:"åéå¬é¥å°å¯¹åºçæºå¨"}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/02.shell/03.%E8%AE%BE%E7%BD%AE%E8%B7%B3%E6%9D%BF%E6%9C%BA%E8%84%9A%E6%9C%AC.html",relativePath:"03.ç¼ç¨/02.shell/03.è®¾ç½®è·³æ¿æºèæ¬.md",key:"v-a840ca1e",path:"/pages/69b699/",headers:[{level:2,title:"èæ¬å¦ä¸",slug:"èæ¬å¦ä¸",normalizedTitle:"èæ¬å¦ä¸",charIndex:2}],headersStr:"èæ¬å¦ä¸",content:"# èæ¬å¦ä¸\n\nåéå¬é¥å°å¯¹åºçæºå¨\n\nç®å½ä¸åå»ºip\n\n192.168.100.32 | medicalinscore | ecsProd-201707141750\n192.168.100.33 | medicalinscore | ecsProd-201707141751\n192.168.100.197 | medicalinscore | ecsProd-medical-14-1\n192.168.100.195 | medicalinscore | ecsProd-medical-14-2\n192.168.100.226 | medicalinscore | ecsProd-medicalinscore-5\n192.168.100.227 | medicalinscore | ecsProd-medicalinscore-6\n192.168.100.225 | medicalinscore | ecsProd-medicalinscore-7\n192.168.100.224 | medicalinscore | ecsProd-medicalinscore-8\n\n192.168.100.31 | medicalinsprod | ecsProd-201707141752\n192.168.100.30 | medicalinsprod | ecsProd-201707141753\n192.168.100.196 | medicalinsprod | ecsProd-medical-14-3\n192.168.100.198 | medicalinsprod | ecsProd-medical-14-4\n192.168.100.229 | medicalinsprod | ecsProd-medicalinsprod-5\n192.168.100.228 | medicalinsprod | ecsProd-medicalinsprod-6\n\n192.168.100.75 | medicalinsmng | ecsProd-medicalinsmng-01\n192.168.100.74 | medicalinsmng | ecsProd-medicalinsmng-02\n192.168.100.208 | medicalinsmng-boot | ecsProd-medicalinsmng-boot-1\n192.168.100.209 | medicalinsmng-boot | ecsProd-medicalinsmng-boot-2\n\n\nè®¾ç½®è·³æ¿æºèæ¬\n\n#!/bin/bash\necho \"develop environment\"\nfor i in `seq  $(cat ip | wc -l )`\ndo read line\necho $i\"|\" $line\ndone <ip\necho \"please input the number for you choice machine\"\n\nread a\nhostname=`sed -n ''$a'p' ip |awk '{ print $2 }'`\nip=`sed -n ''$a'p' ip |awk '{ print $1 }'`\necho \"you while login this machine\"${hostname}\nssh -l log $ip\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n",normalizedContent:"# èæ¬å¦ä¸\n\nåéå¬é¥å°å¯¹åºçæºå¨\n\nç®å½ä¸åå»ºip\n\n192.168.100.32 | medicalinscore | ecsprod-201707141750\n192.168.100.33 | medicalinscore | ecsprod-201707141751\n192.168.100.197 | medicalinscore | ecsprod-medical-14-1\n192.168.100.195 | medicalinscore | ecsprod-medical-14-2\n192.168.100.226 | medicalinscore | ecsprod-medicalinscore-5\n192.168.100.227 | medicalinscore | ecsprod-medicalinscore-6\n192.168.100.225 | medicalinscore | ecsprod-medicalinscore-7\n192.168.100.224 | medicalinscore | ecsprod-medicalinscore-8\n\n192.168.100.31 | medicalinsprod | ecsprod-201707141752\n192.168.100.30 | medicalinsprod | ecsprod-201707141753\n192.168.100.196 | medicalinsprod | ecsprod-medical-14-3\n192.168.100.198 | medicalinsprod | ecsprod-medical-14-4\n192.168.100.229 | medicalinsprod | ecsprod-medicalinsprod-5\n192.168.100.228 | medicalinsprod | ecsprod-medicalinsprod-6\n\n192.168.100.75 | medicalinsmng | ecsprod-medicalinsmng-01\n192.168.100.74 | medicalinsmng | ecsprod-medicalinsmng-02\n192.168.100.208 | medicalinsmng-boot | ecsprod-medicalinsmng-boot-1\n192.168.100.209 | medicalinsmng-boot | ecsprod-medicalinsmng-boot-2\n\n\nè®¾ç½®è·³æ¿æºèæ¬\n\n#!/bin/bash\necho \"develop environment\"\nfor i in `seq  $(cat ip | wc -l )`\ndo read line\necho $i\"|\" $line\ndone <ip\necho \"please input the number for you choice machine\"\n\nread a\nhostname=`sed -n ''$a'p' ip |awk '{ print $2 }'`\nip=`sed -n ''$a'p' ip |awk '{ print $1 }'`\necho \"you while login this machine\"${hostname}\nssh -l log $ip\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n",charsets:{cjk:!0}},{title:"ç¼åå¯å¨ãåæ­¢ãéå¯çèæ¬",frontmatter:{title:"ç¼åå¯å¨ãåæ­¢ãéå¯çèæ¬",date:"2022-12-21T18:07:20.000Z",permalink:"/pages/fe0782/",categories:["ç¼ç¨","shell"],tags:[null],readingShow:"top",description:'PROFTPD="/usr/local/proftpd/sbin/proftpd"\nPROCONF="/usr/local/proftpd/etc/proftpd.conf"\nPROPID="/usr/local/proftpd/var/proftpd.pid"\nRETVAL=0\nprog="ProFTPd"',meta:[{name:"twitter:title",content:"ç¼åå¯å¨ãåæ­¢ãéå¯çèæ¬"},{name:"twitter:description",content:'PROFTPD="/usr/local/proftpd/sbin/proftpd"\nPROCONF="/usr/local/proftpd/etc/proftpd.conf"\nPROPID="/usr/local/proftpd/var/proftpd.pid"\nRETVAL=0\nprog="ProFTPd"'},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/04.%E7%BC%96%E5%86%99%E5%90%AF%E5%8A%A8%E3%80%81%E5%81%9C%E6%AD%A2%E3%80%81%E9%87%8D%E5%90%AF%E7%9A%84%E8%84%9A%E6%9C%AC.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ç¼åå¯å¨ãåæ­¢ãéå¯çèæ¬"},{property:"og:description",content:'PROFTPD="/usr/local/proftpd/sbin/proftpd"\nPROCONF="/usr/local/proftpd/etc/proftpd.conf"\nPROPID="/usr/local/proftpd/var/proftpd.pid"\nRETVAL=0\nprog="ProFTPd"'},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/04.%E7%BC%96%E5%86%99%E5%90%AF%E5%8A%A8%E3%80%81%E5%81%9C%E6%AD%A2%E3%80%81%E9%87%8D%E5%90%AF%E7%9A%84%E8%84%9A%E6%9C%AC.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-21T18:07:20.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ç¼åå¯å¨ãåæ­¢ãéå¯çèæ¬"},{itemprop:"description",content:'PROFTPD="/usr/local/proftpd/sbin/proftpd"\nPROCONF="/usr/local/proftpd/etc/proftpd.conf"\nPROPID="/usr/local/proftpd/var/proftpd.pid"\nRETVAL=0\nprog="ProFTPd"'}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/02.shell/04.%E7%BC%96%E5%86%99%E5%90%AF%E5%8A%A8%E3%80%81%E5%81%9C%E6%AD%A2%E3%80%81%E9%87%8D%E5%90%AF%E7%9A%84%E8%84%9A%E6%9C%AC.html",relativePath:"03.ç¼ç¨/02.shell/04.ç¼åå¯å¨ãåæ­¢ãéå¯çèæ¬.md",key:"v-8d36e636",path:"/pages/fe0782/",headersStr:null,content:'#!/bin/bash    \n# ProFTPd Settings \nPROFTPD="/usr/local/proftpd/sbin/proftpd" \nPROCONF="/usr/local/proftpd/etc/proftpd.conf" \nPROPID="/usr/local/proftpd/var/proftpd.pid" \nRETVAL=0 \nprog="ProFTPd" \n   \nstart() { \n    echo -n $"Starting $prog... " \n    $PROFTPD -c $PROCONF \n    if [ "$?" = 0 ] ; then \n        echo " done" \n    else \n        echo " failed" \n    fi \n} \n   \nstop() { \n    echo -n $"Stopping $prog...  " \n    if [ ! -e $PROPID ]; then \n        echo -n $"$prog is not running." \n        exit 1 \n    fi \n    kill `cat $PROPID` \n    if [ "$?" = 0 ] ; then \n        echo " done" \n    else \n        echo " failed" \n    fi \n} \n   \nrestart(){ \n    echo $"Restarting $prog..." \n    $0 stop \n    sleep 2 \n    $0 start \n} \n   \nstatus(){ \n    if [ -e $PROPID ]; then \n        echo $"$prog is running." \n    else \n        echo $"$prog is not running." \n    fi \n} \n   \ncase "$1" in \n    start) \n        start \n        ;; \n    stop) \n        stop \n        ;; \n    restart) \n        restart \n        ;; \n    status) \n        status \n        ;; \n  *) \n        echo $"Usage: $0 {start|stop|restart|status}" \nesac \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n',normalizedContent:'#!/bin/bash    \n# proftpd settings \nproftpd="/usr/local/proftpd/sbin/proftpd" \nproconf="/usr/local/proftpd/etc/proftpd.conf" \npropid="/usr/local/proftpd/var/proftpd.pid" \nretval=0 \nprog="proftpd" \n   \nstart() { \n    echo -n $"starting $prog... " \n    $proftpd -c $proconf \n    if [ "$?" = 0 ] ; then \n        echo " done" \n    else \n        echo " failed" \n    fi \n} \n   \nstop() { \n    echo -n $"stopping $prog...  " \n    if [ ! -e $propid ]; then \n        echo -n $"$prog is not running." \n        exit 1 \n    fi \n    kill `cat $propid` \n    if [ "$?" = 0 ] ; then \n        echo " done" \n    else \n        echo " failed" \n    fi \n} \n   \nrestart(){ \n    echo $"restarting $prog..." \n    $0 stop \n    sleep 2 \n    $0 start \n} \n   \nstatus(){ \n    if [ -e $propid ]; then \n        echo $"$prog is running." \n    else \n        echo $"$prog is not running." \n    fi \n} \n   \ncase "$1" in \n    start) \n        start \n        ;; \n    stop) \n        stop \n        ;; \n    restart) \n        restart \n        ;; \n    status) \n        status \n        ;; \n  *) \n        echo $"usage: $0 {start|stop|restart|status}" \nesac \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n',charsets:{cjk:!0}},{title:"mysqlæ°æ®åºå¤ä»½çä¸ç§æ¹å¼",frontmatter:{title:"mysqlæ°æ®åºå¤ä»½çä¸ç§æ¹å¼",date:"2023-01-04T14:22:29.000Z",permalink:"/pages/93dcc7/",categories:["ç¼ç¨","shell"],tags:[null],readingShow:"top",description:"Mysqldumpæ¯mysqlèªå¸¦å·¥å·ãå¤ä»½åºæ¥çæä»¶æ¯ä¸ä¸ªå¯ä»¥ç´æ¥åå¥çsqlèæ¬ãè¯¥sqlæä»¶ä¸­å®éä¸åå«äºå¤ä¸ªCREATE åINSERTè¯­å¥ï¼ä½¿ç¨è¿äºè¯­å¥å¯ä»¥éæ°åå»ºè¡¨åæå¥æ°æ®ã",meta:[{name:"twitter:title",content:"mysqlæ°æ®åºå¤ä»½çä¸ç§æ¹å¼"},{name:"twitter:description",content:"Mysqldumpæ¯mysqlèªå¸¦å·¥å·ãå¤ä»½åºæ¥çæä»¶æ¯ä¸ä¸ªå¯ä»¥ç´æ¥åå¥çsqlèæ¬ãè¯¥sqlæä»¶ä¸­å®éä¸åå«äºå¤ä¸ªCREATE åINSERTè¯­å¥ï¼ä½¿ç¨è¿äºè¯­å¥å¯ä»¥éæ°åå»ºè¡¨åæå¥æ°æ®ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/05.mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F.html"},{property:"og:type",content:"article"},{property:"og:title",content:"mysqlæ°æ®åºå¤ä»½çä¸ç§æ¹å¼"},{property:"og:description",content:"Mysqldumpæ¯mysqlèªå¸¦å·¥å·ãå¤ä»½åºæ¥çæä»¶æ¯ä¸ä¸ªå¯ä»¥ç´æ¥åå¥çsqlèæ¬ãè¯¥sqlæä»¶ä¸­å®éä¸åå«äºå¤ä¸ªCREATE åINSERTè¯­å¥ï¼ä½¿ç¨è¿äºè¯­å¥å¯ä»¥éæ°åå»ºè¡¨åæå¥æ°æ®ã"},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/05.mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-04T14:22:29.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"mysqlæ°æ®åºå¤ä»½çä¸ç§æ¹å¼"},{itemprop:"description",content:"Mysqldumpæ¯mysqlèªå¸¦å·¥å·ãå¤ä»½åºæ¥çæä»¶æ¯ä¸ä¸ªå¯ä»¥ç´æ¥åå¥çsqlèæ¬ãè¯¥sqlæä»¶ä¸­å®éä¸åå«äºå¤ä¸ªCREATE åINSERTè¯­å¥ï¼ä½¿ç¨è¿äºè¯­å¥å¯ä»¥éæ°åå»ºè¡¨åæå¥æ°æ®ã"}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/02.shell/05.mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F.html",relativePath:"03.ç¼ç¨/02.shell/05.mysqlæ°æ®åºå¤ä»½çä¸ç§æ¹å¼.md",key:"v-08986d40",path:"/pages/93dcc7/",headersStr:null,content:' 1. mysqldumpå¤ä»½\n\n> Mysqldumpæ¯mysqlèªå¸¦å·¥å·ãå¤ä»½åºæ¥çæä»¶æ¯ä¸ä¸ªå¯ä»¥ç´æ¥åå¥çsqlèæ¬ãè¯¥sqlæä»¶ä¸­å®éä¸åå«äºå¤ä¸ªCREATE åINSERTè¯­å¥ï¼ä½¿ç¨è¿äºè¯­å¥å¯ä»¥éæ°åå»ºè¡¨åæå¥æ°æ®ã\n\n#!/bin/bash\naiserver_bak()\n{\nuser="root"\npasswd="xxxx"\ndb_name="ai_server"\nbackup_path="/data/mysql-backup/ai_server"\ndate=$(date +"%Y%m%d%H%M%S")\numask 177\n/usr/bin/mysqldump -u${user} -p${passwd} ${db_name} |gzip > ${backup_path}/${db_name}_mysql_${date}.sql.gz\nfind ${backup_path} -name "mysql_*.sql.gz" -type f -mtime +10 -exec rm -rf {} \\;\n}\naiserver_bak\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n 2. mysqlbackupå¤ä»½\n\n> Mysqlbackupæ¯ç©çå¤ä»½çæ¹å¼ãå¯¹innodbçè¡¨ç©ºé´è¿è¡ç©çå¤å¶ï¼ä½æ¯ï¼å®æ¯è®°å½LSNç¹çãå¨å¤ä»½è¿ç¨ä¸­ï¼æ°å¢å çè¾å¥ç´æ¥åå¥å¤ä»½æä»¶çibbackup_logfileä¸­ãåæ¶è®°å½æåçLSNç¹ãè¿åçæ¶åï¼æ£æµå¯¹æ¯ibbackup_logfileæä»¶éé¢ä¸è¡¨ç©ºé´éé¢çå·®å¼ï¼ä½¿ibbackup_logfileéé¢çæ°æ®è¿å¥äºå¡æ¥å¿æè¡¨ç©ºé´ã\n\n#!/bin/bash\n#ç­å¤ï¼å¤ä»½æ°æ®åºç®å½\nBACKUP_DIR=/var/backups/mysql/backups\nBACKUP_PASS=xxx\nBACKUP_USER=root\n\nDATE_DAY=$(date +"%Y-%m-%d")\nDATE_HOUR=$(date +"%H")\n\n#EMAIL_RECIPIENT=dba_zhang@163.com\n\n#/usr/local/mysql/bin/mysqlbackup --port=3306 --protocol=tcp --user=$BACKUP_USER --password=$BACKUP_PASS --with-timestamp --backup-dir=$BACKUP_DIR backup-and-apply-log\n/var/lib/mysql/meb/meb-4.1.3-linux-glibc2.12-x86-64bit/bin/mysqlbackup --port=3306 --protocol=tcp --user=$BACKUP_USER --password=$BACKUP_PASS --with-timestamp --backup-dir=$BACKUP_DIR --compress --compress-level=9 backup-and-apply-log\n\nsleep 100s\n\ntar -zcvf ${BACKUP_DIR}/meb-bk${DATE_DAY}${DATE_HOUR}.tar.gz ${BACKUP_DIR}/${DATE_DAY}*\n\nsleep 100s\n\nrm -rf ${BACKUP_DIR}/${DATE_DAY}*\n\nNO_OF_COMPLETE_OK_MESSAGES=$(cat $BACKUP_DIR/${DATE_DAY}_${DATE_HOUR}*/meta/MEB_${DATE_DAY}.${DATE_HOUR}*.log | grep "mysqlbackup completed OK" | wc -l)\n\n# Note that the string "mysqlbackup completed OK" must occur 2 times in the log in order for the backup to be OK\nif [ $NO_OF_COMPLETE_OK_MESSAGES -eq 2 ]; then\n        # Backup successful, find backup directory\n        echo "Backup succeeded"\n        exit 0\n#else\n#        echo "MySQL backup failed, please check logfile" | mail -s "ERROR: MySQL Backup Failed!" ${EMAIL_RECIPIENT}\n#        exit 1\nfi\nfind $BACKUP_DIR -mtime +17 -exec rm -f {} \\;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n 3. innobackupexå¤ä»½\n\n> Percona XtraBackupæ¯ä¸æ¬¾åºäºMySQLçç­å¤ä»½çå¼æºå®ç¨ç¨åºï¼å®å¯ä»¥å¤ä»½5.1å°5.7çæ¬ä¸InnoDB,XtraDB,MyISAMå­å¨å¼æçè¡¨ï¼ Xtrabackupæä¸¤ä¸ªä¸»è¦çå·¥å·ï¼xtrabackupãinnobackupex ã\n> ï¼1ï¼xtrabackupåªè½å¤ä»½InnoDBåXtraDBä¸¤ç§æ°æ®è¡¨ï¼èä¸è½å¤ä»½MyISAMæ°æ®è¡¨ ãã\n> ï¼2ï¼innobackupexåå°è£äºxtrabackupï¼æ¯ä¸ä¸ªèæ¬å°è£ï¼æä»¥è½åæ¶å¤ä»½å¤çinnodbåmyisamï¼ä½å¨å¤çmyisamæ¶éè¦å ä¸ä¸ªè¯»éã\n\n#!/bin/bash\n\n#### -- default value -- ####\n# mysqlåæ°\nMYSQL_CNF=/etc/my.cnf\nMYSQL_USER="mysqlbackup"\nMYSQL_PASS="xxx"\nMYSQL_HOST=\'localhost\'\n\n# å¤ä»½åæ°\nlogtime=`date +%x\' \'%T`\nfullbase=/data/mysql_master_backup/full\nlogbase=/data/mysql_master_backup/logs\n#DBlist=`mysql -u${MYSQL_USER} -p${MYSQL_PASS} -e "show databases" | egrep -v $exclude`\ninnobackupex=/usr/bin/innobackupex\n\n#### -- ç®å½åå»º -- ####\n[ -d ${fullbase} ] || mkdir -p ${fullbase}\n[ -d ${logbase} ] || mkdir -p ${logbase}\n\n\n####å¤ä»½æ¶é´ãå¤§å°è®°å½\n\nlog_file="/data/mysql_master_backup/logs/backup_record_"$(date +%Y%m%d%H%M%S)".log"\n\n#### -- main funcation -- ####\n# å¨å¤\n_FULLBackup()\n{\ndtime=`date +%Y-%m-%d`\n$innobackupex --defaults-file=$MYSQL_CNF --user=$MYSQL_USER --password=$MYSQL_PASS --host=$MYSQL_HOST $fullbase > $logbase/${dtime}.log 2>&1\nresult=$?\nif [ $result -eq 0 ];then\n        bkbase=`ls -d ${fullbase}/${dtime}* | sort -r | head -n 1`\n        bksize=`du -sh ${bkbase} | awk \'{print $1}\'`\n        echo -e "[$logtime]\\tStatus: successful, Backdir: $bkbase, size: $bksize" | tee -a  ${logbase}/full.log\nelse\n        echo -e "[$logtime]\\tStatus: failed, Reason: check you log $logbase/${dtime}.log" | tee -a  ${logbase}/backup.log\nfi\n}\n\n# run\nbackup_timer_start=`date "+%Y-%m-%d %H:%M:%S"`\necho "backup_timer_start   :    $backup_timer_start" >>$log_file\n_FULLBackup\nbackup_timer_end=`date "+%Y-%m-%d %H:%M:%S"`\necho "backup_timer_end     :    $backup_timer_end" >>$log_file\nbackup_duration=`echo $(($(date +%s -d "${backup_timer_end}") - $(date +%s -d "${backup_timer_start}"))) | awk \'{t=split("60 s 60 m 24 h 999 d",a);for(n=1;n<t;n+=2){if($1==0)break;s=$1%a[n]a[n+1] s;$1=int($1/a[n])}print s}\'`\necho "total backup time    :    $backup_duration"  >>$log_file\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n',normalizedContent:' 1. mysqldumpå¤ä»½\n\n> mysqldumpæ¯mysqlèªå¸¦å·¥å·ãå¤ä»½åºæ¥çæä»¶æ¯ä¸ä¸ªå¯ä»¥ç´æ¥åå¥çsqlèæ¬ãè¯¥sqlæä»¶ä¸­å®éä¸åå«äºå¤ä¸ªcreate åinsertè¯­å¥ï¼ä½¿ç¨è¿äºè¯­å¥å¯ä»¥éæ°åå»ºè¡¨åæå¥æ°æ®ã\n\n#!/bin/bash\naiserver_bak()\n{\nuser="root"\npasswd="xxxx"\ndb_name="ai_server"\nbackup_path="/data/mysql-backup/ai_server"\ndate=$(date +"%y%m%d%h%m%s")\numask 177\n/usr/bin/mysqldump -u${user} -p${passwd} ${db_name} |gzip > ${backup_path}/${db_name}_mysql_${date}.sql.gz\nfind ${backup_path} -name "mysql_*.sql.gz" -type f -mtime +10 -exec rm -rf {} \\;\n}\naiserver_bak\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n 2. mysqlbackupå¤ä»½\n\n> mysqlbackupæ¯ç©çå¤ä»½çæ¹å¼ãå¯¹innodbçè¡¨ç©ºé´è¿è¡ç©çå¤å¶ï¼ä½æ¯ï¼å®æ¯è®°å½lsnç¹çãå¨å¤ä»½è¿ç¨ä¸­ï¼æ°å¢å çè¾å¥ç´æ¥åå¥å¤ä»½æä»¶çibbackup_logfileä¸­ãåæ¶è®°å½æåçlsnç¹ãè¿åçæ¶åï¼æ£æµå¯¹æ¯ibbackup_logfileæä»¶éé¢ä¸è¡¨ç©ºé´éé¢çå·®å¼ï¼ä½¿ibbackup_logfileéé¢çæ°æ®è¿å¥äºå¡æ¥å¿æè¡¨ç©ºé´ã\n\n#!/bin/bash\n#ç­å¤ï¼å¤ä»½æ°æ®åºç®å½\nbackup_dir=/var/backups/mysql/backups\nbackup_pass=xxx\nbackup_user=root\n\ndate_day=$(date +"%y-%m-%d")\ndate_hour=$(date +"%h")\n\n#email_recipient=dba_zhang@163.com\n\n#/usr/local/mysql/bin/mysqlbackup --port=3306 --protocol=tcp --user=$backup_user --password=$backup_pass --with-timestamp --backup-dir=$backup_dir backup-and-apply-log\n/var/lib/mysql/meb/meb-4.1.3-linux-glibc2.12-x86-64bit/bin/mysqlbackup --port=3306 --protocol=tcp --user=$backup_user --password=$backup_pass --with-timestamp --backup-dir=$backup_dir --compress --compress-level=9 backup-and-apply-log\n\nsleep 100s\n\ntar -zcvf ${backup_dir}/meb-bk${date_day}${date_hour}.tar.gz ${backup_dir}/${date_day}*\n\nsleep 100s\n\nrm -rf ${backup_dir}/${date_day}*\n\nno_of_complete_ok_messages=$(cat $backup_dir/${date_day}_${date_hour}*/meta/meb_${date_day}.${date_hour}*.log | grep "mysqlbackup completed ok" | wc -l)\n\n# note that the string "mysqlbackup completed ok" must occur 2 times in the log in order for the backup to be ok\nif [ $no_of_complete_ok_messages -eq 2 ]; then\n        # backup successful, find backup directory\n        echo "backup succeeded"\n        exit 0\n#else\n#        echo "mysql backup failed, please check logfile" | mail -s "error: mysql backup failed!" ${email_recipient}\n#        exit 1\nfi\nfind $backup_dir -mtime +17 -exec rm -f {} \\;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n 3. innobackupexå¤ä»½\n\n> percona xtrabackupæ¯ä¸æ¬¾åºäºmysqlçç­å¤ä»½çå¼æºå®ç¨ç¨åºï¼å®å¯ä»¥å¤ä»½5.1å°5.7çæ¬ä¸innodb,xtradb,myisamå­å¨å¼æçè¡¨ï¼ xtrabackupæä¸¤ä¸ªä¸»è¦çå·¥å·ï¼xtrabackupãinnobackupex ã\n> ï¼1ï¼xtrabackupåªè½å¤ä»½innodbåxtradbä¸¤ç§æ°æ®è¡¨ï¼èä¸è½å¤ä»½myisamæ°æ®è¡¨ ãã\n> ï¼2ï¼innobackupexåå°è£äºxtrabackupï¼æ¯ä¸ä¸ªèæ¬å°è£ï¼æä»¥è½åæ¶å¤ä»½å¤çinnodbåmyisamï¼ä½å¨å¤çmyisamæ¶éè¦å ä¸ä¸ªè¯»éã\n\n#!/bin/bash\n\n#### -- default value -- ####\n# mysqlåæ°\nmysql_cnf=/etc/my.cnf\nmysql_user="mysqlbackup"\nmysql_pass="xxx"\nmysql_host=\'localhost\'\n\n# å¤ä»½åæ°\nlogtime=`date +%x\' \'%t`\nfullbase=/data/mysql_master_backup/full\nlogbase=/data/mysql_master_backup/logs\n#dblist=`mysql -u${mysql_user} -p${mysql_pass} -e "show databases" | egrep -v $exclude`\ninnobackupex=/usr/bin/innobackupex\n\n#### -- ç®å½åå»º -- ####\n[ -d ${fullbase} ] || mkdir -p ${fullbase}\n[ -d ${logbase} ] || mkdir -p ${logbase}\n\n\n####å¤ä»½æ¶é´ãå¤§å°è®°å½\n\nlog_file="/data/mysql_master_backup/logs/backup_record_"$(date +%y%m%d%h%m%s)".log"\n\n#### -- main funcation -- ####\n# å¨å¤\n_fullbackup()\n{\ndtime=`date +%y-%m-%d`\n$innobackupex --defaults-file=$mysql_cnf --user=$mysql_user --password=$mysql_pass --host=$mysql_host $fullbase > $logbase/${dtime}.log 2>&1\nresult=$?\nif [ $result -eq 0 ];then\n        bkbase=`ls -d ${fullbase}/${dtime}* | sort -r | head -n 1`\n        bksize=`du -sh ${bkbase} | awk \'{print $1}\'`\n        echo -e "[$logtime]\\tstatus: successful, backdir: $bkbase, size: $bksize" | tee -a  ${logbase}/full.log\nelse\n        echo -e "[$logtime]\\tstatus: failed, reason: check you log $logbase/${dtime}.log" | tee -a  ${logbase}/backup.log\nfi\n}\n\n# run\nbackup_timer_start=`date "+%y-%m-%d %h:%m:%s"`\necho "backup_timer_start   :    $backup_timer_start" >>$log_file\n_fullbackup\nbackup_timer_end=`date "+%y-%m-%d %h:%m:%s"`\necho "backup_timer_end     :    $backup_timer_end" >>$log_file\nbackup_duration=`echo $(($(date +%s -d "${backup_timer_end}") - $(date +%s -d "${backup_timer_start}"))) | awk \'{t=split("60 s 60 m 24 h 999 d",a);for(n=1;n<t;n+=2){if($1==0)break;s=$1%a[n]a[n+1] s;$1=int($1/a[n])}print s}\'`\necho "total backup time    :    $backup_duration"  >>$log_file\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n',charsets:{cjk:!0}},{title:"jenkinsç¼è¯æå¡èæ¬",frontmatter:{title:"jenkinsç¼è¯æå¡èæ¬",date:"2023-01-06T11:01:07.000Z",permalink:"/pages/2019f8/",categories:["ç¼ç¨","shell"],tags:[null],readingShow:"top",description:'gittreestate="clean"\nbuild_tag=""',meta:[{name:"twitter:title",content:"jenkinsç¼è¯æå¡èæ¬"},{name:"twitter:description",content:'gittreestate="clean"\nbuild_tag=""'},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/06.jenkins%E7%BC%96%E8%AF%91%E6%9C%8D%E5%8A%A1%E8%84%9A%E6%9C%AC.html"},{property:"og:type",content:"article"},{property:"og:title",content:"jenkinsç¼è¯æå¡èæ¬"},{property:"og:description",content:'gittreestate="clean"\nbuild_tag=""'},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/06.jenkins%E7%BC%96%E8%AF%91%E6%9C%8D%E5%8A%A1%E8%84%9A%E6%9C%AC.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-06T11:01:07.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"jenkinsç¼è¯æå¡èæ¬"},{itemprop:"description",content:'gittreestate="clean"\nbuild_tag=""'}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/02.shell/06.jenkins%E7%BC%96%E8%AF%91%E6%9C%8D%E5%8A%A1%E8%84%9A%E6%9C%AC.html",relativePath:"03.ç¼ç¨/02.shell/06.jenkinsç¼è¯æå¡èæ¬.md",key:"v-38a8ed18",path:"/pages/2019f8/",headersStr:null,content:'#!/bin/bash\n\nproject_code=$product_code\nbuild_path=/var/jenkins_home/workspace/$JOB_NAME\ntime=`date +\'%Y-%m-%dT%H:%M:%SZ\'`\ngit_tree_state="clean"\nbuild_tag=""\n\nfunction run_build(){\n    name=${JOB_BASE_NAME##*.}\n    if [[ $name = "service_cpp_quote" ]] || [[ $name = "service_new_trade" ]]  || [[ $name = "service_new_trade_gg" ]];then\n        # C++éè¦åç¼è¯.\n        mapping_path=/workspace\n        docker_images=xxx/cpp/dev_base_tools:1.1.1\n        build_command="cd /workspace && rm -rf build && mkdir build && cd build && cmake .. && make -j4 install"\n        sudo docker run -v /opt/apps/jenkins/jenkins_home/workspace/$JOB_BASE_NAME:$mapping_path --rm $docker_images sh -c "$build_command"\n        cd $build_path/build/dist\n    elif [[ $JOB_BASE_NAME = "AIRM.db" ]]; then\n        time=`date "+%Y%m%d%H%M%S"`\n        cd $build_path\n        sudo mkdir -p $JOB_BASE_NAME\n        versionlib_path=/data/Vsersion_Lib/$project_code\n\t\tsudo mkdir -p $versionlib_path\n        sudo cp -rf `ls |grep $"sql"` $JOB_BASE_NAME/\n        sudo tar -zcf  "$JOB_BASE_NAME"_"$time"_"$COMMIT_ID".tar.gz $JOB_BASE_NAME/\n        sudo cp "$JOB_BASE_NAME"_"$time"_"$COMMIT_ID".tar.gz $versionlib_path/\n        sudo rm -f "$JOB_BASE_NAME"_"$time"_"$COMMIT_ID".tar.gz\n        sudo rm -rf $JOB_BASE_NAME/\n        echo "$JOB_BASE_NAME"_"$time"_"$COMMIT_ID".tar.gz\n\n        return 0\n    elif [[ $JOB_BASE_NAME = "AIRM.gateway" ]]; then\n        build_tag="--build-arg VERSION=$version_number --build-arg GIT_COMMIT=$COMMIT_ID --build-arg GIT_TREE_STATE=$git_tree_state --build-arg BUILD_DATE=$time"\n    elif [[ $JOB_BASE_NAME = "AIRM.service_go_trade" ]]; then\n        build_tag="--build-arg VERSION=$version_number --build-arg GIT_COMMIT=$COMMIT_ID --build-arg GIT_TREE_STATE=$git_tree_state --build-arg BUILD_DATE=$time"\n        docker_names=("new_gateway" "query" "trade")\n        for docker_name in ${docker_names[@]}\n        do\n            cp script/docker/$docker_name/Dockerfile .\n            sudo docker tag xxx/$project_code/$docker_name:$version_number xxx/$project_code/$docker_name:$version_number.$BUILD_NUMBER\n            sudo docker rmi xxx/$project_code/$docker_name:$version_number\n            sudo docker build -t xxx/$project_code/$docker_name:$version_number $build_tag .\n            rm -f Dockerfile\n            sudo docker push xxx/$project_code/$docker_name:$version_number\n        done\n\n        return 0\n    else\n        cd $build_path\n    fi\n\n    # æå.\n    docker_name=${name}\n    sudo docker tag xxx/$project_code/$docker_name:$version_number xxx/$project_code/$docker_name:$version_number.$BUILD_NUMBER\n    sudo docker rmi xxx/$project_code/$docker_name:$version_number\n    sudo docker build -t xxx/$project_code/$docker_name:$version_number $build_tag .\n    sudo docker push xxx/$project_code/$docker_name:$version_number\n}\n\nfunction checkBuild(){\n    product=$1\n    version=$2\n    if [[ -z $product ]] || [[ -z $version ]];then\n        # åæ°ä¸ºç©º.\n        return 1\n    fi\n    info_path=http://172.16.30.217:9110/version/status\n    value=`curl -XGET "$info_path?product_code=$product_code&version_number=$version_number" |awk -F\'lock_status":\' \'{print $2}\'|awk -F, \'{print $1}\'`\n    if [[ $value -eq 0 ]];then\n        # å¯ä»¥æ­£å¸¸æå»º.\n        return 0\n    else\n        # çæ¬å·²éå®.\n        return 3\n    fi\n}\n\nres1=$(checkBuild $product_code $version_number)\nres2=`echo $?`\nif [[ $res2 -eq 1 ]];then\n    echo "çæ¬å·æ²¡æè¾å¥"\n    exit $res2\nelif [[ $res2 -eq 3 ]];then\n    echo "å¯¹åºççæ¬å·²éå®"\n    exit $res2\nelse\n    run_build\nfi\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n',normalizedContent:'#!/bin/bash\n\nproject_code=$product_code\nbuild_path=/var/jenkins_home/workspace/$job_name\ntime=`date +\'%y-%m-%dt%h:%m:%sz\'`\ngit_tree_state="clean"\nbuild_tag=""\n\nfunction run_build(){\n    name=${job_base_name##*.}\n    if [[ $name = "service_cpp_quote" ]] || [[ $name = "service_new_trade" ]]  || [[ $name = "service_new_trade_gg" ]];then\n        # c++éè¦åç¼è¯.\n        mapping_path=/workspace\n        docker_images=xxx/cpp/dev_base_tools:1.1.1\n        build_command="cd /workspace && rm -rf build && mkdir build && cd build && cmake .. && make -j4 install"\n        sudo docker run -v /opt/apps/jenkins/jenkins_home/workspace/$job_base_name:$mapping_path --rm $docker_images sh -c "$build_command"\n        cd $build_path/build/dist\n    elif [[ $job_base_name = "airm.db" ]]; then\n        time=`date "+%y%m%d%h%m%s"`\n        cd $build_path\n        sudo mkdir -p $job_base_name\n        versionlib_path=/data/vsersion_lib/$project_code\n\t\tsudo mkdir -p $versionlib_path\n        sudo cp -rf `ls |grep $"sql"` $job_base_name/\n        sudo tar -zcf  "$job_base_name"_"$time"_"$commit_id".tar.gz $job_base_name/\n        sudo cp "$job_base_name"_"$time"_"$commit_id".tar.gz $versionlib_path/\n        sudo rm -f "$job_base_name"_"$time"_"$commit_id".tar.gz\n        sudo rm -rf $job_base_name/\n        echo "$job_base_name"_"$time"_"$commit_id".tar.gz\n\n        return 0\n    elif [[ $job_base_name = "airm.gateway" ]]; then\n        build_tag="--build-arg version=$version_number --build-arg git_commit=$commit_id --build-arg git_tree_state=$git_tree_state --build-arg build_date=$time"\n    elif [[ $job_base_name = "airm.service_go_trade" ]]; then\n        build_tag="--build-arg version=$version_number --build-arg git_commit=$commit_id --build-arg git_tree_state=$git_tree_state --build-arg build_date=$time"\n        docker_names=("new_gateway" "query" "trade")\n        for docker_name in ${docker_names[@]}\n        do\n            cp script/docker/$docker_name/dockerfile .\n            sudo docker tag xxx/$project_code/$docker_name:$version_number xxx/$project_code/$docker_name:$version_number.$build_number\n            sudo docker rmi xxx/$project_code/$docker_name:$version_number\n            sudo docker build -t xxx/$project_code/$docker_name:$version_number $build_tag .\n            rm -f dockerfile\n            sudo docker push xxx/$project_code/$docker_name:$version_number\n        done\n\n        return 0\n    else\n        cd $build_path\n    fi\n\n    # æå.\n    docker_name=${name}\n    sudo docker tag xxx/$project_code/$docker_name:$version_number xxx/$project_code/$docker_name:$version_number.$build_number\n    sudo docker rmi xxx/$project_code/$docker_name:$version_number\n    sudo docker build -t xxx/$project_code/$docker_name:$version_number $build_tag .\n    sudo docker push xxx/$project_code/$docker_name:$version_number\n}\n\nfunction checkbuild(){\n    product=$1\n    version=$2\n    if [[ -z $product ]] || [[ -z $version ]];then\n        # åæ°ä¸ºç©º.\n        return 1\n    fi\n    info_path=http://172.16.30.217:9110/version/status\n    value=`curl -xget "$info_path?product_code=$product_code&version_number=$version_number" |awk -f\'lock_status":\' \'{print $2}\'|awk -f, \'{print $1}\'`\n    if [[ $value -eq 0 ]];then\n        # å¯ä»¥æ­£å¸¸æå»º.\n        return 0\n    else\n        # çæ¬å·²éå®.\n        return 3\n    fi\n}\n\nres1=$(checkbuild $product_code $version_number)\nres2=`echo $?`\nif [[ $res2 -eq 1 ]];then\n    echo "çæ¬å·æ²¡æè¾å¥"\n    exit $res2\nelif [[ $res2 -eq 3 ]];then\n    echo "å¯¹åºççæ¬å·²éå®"\n    exit $res2\nelse\n    run_build\nfi\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n',charsets:{cjk:!0}},{title:"appç¼è¯èæ¬",frontmatter:{title:"appç¼è¯èæ¬",date:"2023-01-06T11:06:30.000Z",permalink:"/pages/fd3678/",categories:["ç¼ç¨","shell"],tags:[null],readingShow:"top",description:"commit_num=git rev-parse --short HEAD\nproject_code=saas\nproductcode=$projectcode\nversionlibpath=/data/VsersionLib/$project_code\ndocker_images=\nmapping_path=\ndevbuildpath=",meta:[{name:"twitter:title",content:"appç¼è¯èæ¬"},{name:"twitter:description",content:"commit_num=git rev-parse --short HEAD\nproject_code=saas\nproductcode=$projectcode\nversionlibpath=/data/VsersionLib/$project_code\ndocker_images=\nmapping_path=\ndevbuildpath="},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/07.app%E7%BC%96%E8%AF%91%E8%84%9A%E6%9C%AC.html"},{property:"og:type",content:"article"},{property:"og:title",content:"appç¼è¯èæ¬"},{property:"og:description",content:"commit_num=git rev-parse --short HEAD\nproject_code=saas\nproductcode=$projectcode\nversionlibpath=/data/VsersionLib/$project_code\ndocker_images=\nmapping_path=\ndevbuildpath="},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/07.app%E7%BC%96%E8%AF%91%E8%84%9A%E6%9C%AC.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-06T11:06:30.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"appç¼è¯èæ¬"},{itemprop:"description",content:"commit_num=git rev-parse --short HEAD\nproject_code=saas\nproductcode=$projectcode\nversionlibpath=/data/VsersionLib/$project_code\ndocker_images=\nmapping_path=\ndevbuildpath="}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/02.shell/07.app%E7%BC%96%E8%AF%91%E8%84%9A%E6%9C%AC.html",relativePath:"03.ç¼ç¨/02.shell/07.appç¼è¯èæ¬.md",key:"v-45252678",path:"/pages/fd3678/",headers:[{level:4,title:"androidç¼è¯",slug:"androidç¼è¯",normalizedTitle:"androidç¼è¯",charIndex:2},{level:4,title:"iosç¼è¯",slug:"iosç¼è¯",normalizedTitle:"iosç¼è¯",charIndex:5429}],headersStr:"androidç¼è¯ iosç¼è¯",content:'# androidç¼è¯\n\n#!/bin/bash\n\n\ntime=`date "+%Y%m%d%H%M%S"`\ncommit_num=`git rev-parse --short HEAD`\nproject_code=saas\nproduct_code=$project_code\nversionlib_path=/data/Vsersion_Lib/$project_code\ndocker_images=\nmapping_path=\ndev_build_path=\n\nrun_build(){\n    sudo docker run -v /data/jenkins/jenkins_home/workspace/saas/$JOB_BASE_NAME:$mapping_path -v /data/gradle_cache/.gradle:/home/cirrus/.gradle --env GRADLE_USER_HOME=/home/cirrus/.gradle --workdir /build --rm $docker_images sh -c "$build_command"\n    if [ "$1" == "app_dev" ];then\n        echo "å¼å§devæå"\n        cd $dev_build_path\n        sudo mkdir -p $versionlib_path\n        sudo cp -rf app-release.apk $versionlib_path/"$JOB_BASE_NAME"_dev_"$time"_"$commit_num".apk\n        dev_new_package_name="$JOB_BASE_NAME"_dev_"$time"_"$commit_num".apk\n        echo $dev_new_package_name\n        # echo "å¼å§stestæå"\n        # cd $stest_build_path\n        # sudo cp -rf app-stest-release.apk $versionlib_path/"$JOB_BASE_NAME"_test_"$time"_"$commit_num".apk\n        # test_new_package_name="$JOB_BASE_NAME"_test_"$time"_"$commit_num".apk\n        # echo $test_new_package_name\n        # echo "å¼å§proæå"\n        # cd $pro_build_path\n        # sudo cp -rf app-pro-release.apk $versionlib_path/"$JOB_BASE_NAME"_pro_"$time"_"$commit_num".apk\n        # pro_new_package_name="$JOB_BASE_NAME"_pro_"$time"_"$commit_num".apk\n        # echo $pro_new_package_name\n        curl -H "Content-Type:application/json" -XPOST http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$project_code"\'","version_number":"\'"$version_number"\'","new_package_name":"\'"$dev_new_package_name"\'"}\'\n        # curl -H "Content-Type:application/json" -XPOST http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$project_code"\'","version_number":"\'"$version_number"\'","new_package_name":"\'"$test_new_package_name"\'"}\'\n        # curl -H "Content-Type:application/json" -XPOST http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$project_code"\'","version_number":"\'"$version_number"\'","new_package_name":"\'"$pro_new_package_name"\'"}\' \n    elif [ "$1" == "app_test" ];then\n        echo "å¼å§testæå"\n        cd $test_build_path\n        sudo mkdir -p $versionlib_path\n        sudo cp -rf app-release.apk $versionlib_path/"$JOB_BASE_NAME"_test_"$time"_"$commit_num".apk\n        test_new_package_name="$JOB_BASE_NAME"_test_"$time"_"$commit_num".apk\n        echo $test_new_package_name\n        curl -H "Content-Type:application/json" -XPOST http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$project_code"\'","version_number":"\'"$version_number"\'","new_package_name":"\'"$test_new_package_name"\'"}\'\n    elif [ "$1" == "app_release" ];then\n        echo "å¼å§releaseæå"\n        cd $release_build_path\n        sudo mkdir -p $versionlib_path\n        sudo cp -rf app-release.apk $versionlib_path/"$JOB_BASE_NAME"_pro_"$time"_"$commit_num".apk\n        pro_new_package_name="$JOB_BASE_NAME"_pro_"$time"_"$commit_num".apk\n        echo $pro_new_package_name\n        curl -H "Content-Type:application/json" -XPOST http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$project_code"\'","version_number":"\'"$version_number"\'","new_package_name":"\'"$pro_new_package_name"\'"}\'               \n\n    else\n        exit 1\n    fi\n\n}\n\nrun_build1(){\nif [ "$1" == "android_dev" ];then\n        docker_images=xxx/library/flutter:latest\n        mapping_path=/build\n        dev_build_path=/var/jenkins_home/workspace/$JOB_NAME/build/app/outputs/flutter-apk\n        build_command="flutter clean && flutter packages get && flutter build apk --no-sound-null-safety --dart-define=APP_ENV=dev"\n        run_build app_dev\nelif [ "$1" == "android_test" ];then\n        docker_images=xxx/library/flutter:latest\n        mapping_path=/build\n        test_build_path=/var/jenkins_home/workspace/$JOB_NAME/build/app/outputs/flutter-apk\n        build_command="flutter clean && flutter packages get && flutter build apk --no-sound-null-safety --dart-define=APP_ENV=test"\n        run_build app_test\nelif [ "$1" == "android_release" ];then\n        docker_images=xxx/library/flutter:latest\n        mapping_path=/build\n        release_build_path=/var/jenkins_home/workspace/$JOB_NAME/build/app/outputs/flutter-apk\n        build_command="flutter clean && flutter packages get && flutter build apk --no-sound-null-safety --dart-define=APP_ENV=release"\n        run_build app_release\n\n\nelse\n        exit 2\nfi\n}\nfunction checkBuild(){\n    product=$1\n    version=$2\n    if [[ -z $product ]] || [[ -z $version ]];then\n        # åæ°ä¸ºç©º.\n        return 1\n    fi\n    info_path=http://172.16.30.217:9110/version/status\n    value=`curl -XGET "$info_path?product_code=$product_code&version_number=$version_number" |awk -F\'lock_status":\' \'{print $2}\'|awk -F, \'{print $1}\'`\n    if [[ $value -eq 0 ]];then\n        # å¯ä»¥æ­£å¸¸æå»º.\n        return 0\n    else\n        # çæ¬å·²éå®.\n        return 3\n    fi\n}\n\nres1=$(checkBuild $product_code $version_number)\nres2=`echo $?`\nif [[ $res2 -eq 1 ]];then\n    echo "çæ¬å·æ²¡æè¾å¥"\n    exit $res2\nelif [[ $res2 -eq 3 ]];then\n    echo "å¯¹åºççæ¬å·²éå®"\n    exit $res2\nelse\n    run_build1 $1\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n\n\n# iosç¼è¯\n\n#flutter build ipa --build-name=0.0.6 --build-number=15 --release --dart-define=APP_ENV=dev --no-sound-null-safety\n#flutter build ipa --release --dart-define=APP_ENV=test --no-sound-null-safety\n#open ./build/ios/archive/Runner.xcarchive\n#flutter build apk --no-sound-null-safety --dart-define=APP_ENV=test\n\n#flutter build ipa --release --dart-define=APP_ENV=dev --no-sound-null-safety\n#xcodebuild -exportArchive -exportOptionsPlist ExportOptionsDevelopment.plist -archivePath $PWD/build/ios/archive/Runner.xcarchive -exportPath $PWD/build/ios/ipa/ -allowProvisioningUpdates\n#cd ./ios && xcodebuild -workspace Runner.xcworkspace -scheme Runner -sdk iphoneos -configuration Release archive -archivePath $PWD/build/Runner.xcarchive && cd ..\n#cd ./ios && fastlane ios build_dev && cd ..\n\n#flutter build ipa --release --dart-define=APP_ENV=test --no-sound-null-safety\n#cd ./ios && fastlane ios build_test && cd ..\n\n\n#flutter build ios --release --dart-define=APP_ENV=dev --no-sound-null-safety\n#cd ./ios && fastlane ios build_dev && cd ..\n#\n#flutter build ios --release --dart-define=APP_ENV=test --no-sound-null-safety\n#cd ./ios && fastlane ios build_test && cd ..\n#\ntime=`date "+%Y%m%d%H%M%S"`\ncommit_num=`git rev-parse --short HEAD`\nproduct_code=saas\nchoice_env=$1\nversion_number=$2\nexport LANG=en_US.UTF-8\n#JOB_NAME=scrm.ios\n\nrun_build(){\n    if [ "$1" == "app_dev" ];then\n        fir publish ./build/ios/outputs/saas_dev.ipa -c "jenkinsèªå¨æåä¸ä¼ " > /opt/jenkins/logs/saas/saas_dev.log\n        time=`date "+%Y%m%d%H%M%S"`\n        aa=`cat /opt/jenkins/logs/saas/saas_dev.log | grep Published | awk \'{print $9}\' | awk -F\'/\' \'{print $4}\'`\n        bb=`cat /opt/jenkins/logs/saas/saas_dev.log | grep Release | awk \'{print $10}\'`\n        new_package_name="$JOB_BASE_NAME"_dev_"$time"-"$commit_num"-"$aa"?release_id="$bb"\n        echo $new_package_name\n        echo $version_number\n        curl -H "Content-Type:application/json" -XPOST http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$product_code"\'","\'"version_number"\'":"\'"$version_number"\'","new_package_name":"\'"$new_package_name"\'"}\'\n    elif [ "$1" == "app_test" ];then\n        fir publish ./build/ios/outputs/saas_test.ipa -c "jenkinsèªå¨æåä¸ä¼ " > /opt/jenkins/logs/saas/saas_test.log\n        time=`date "+%Y%m%d%H%M%S"`\n        aa=`cat /opt/jenkins/logs/saas/saas_test.log | grep Published | awk \'{print $9}\' | awk -F\'/\' \'{print $4}\'`\n        bb=`cat /opt/jenkins/logs/saas/saas_test.log | grep Release | awk \'{print $10}\'`\n        new_package_name="$JOB_BASE_NAME"_test_"$time"-"$commit_num"-"$aa"?release_id="$bb"\n        echo $new_package_name\n        curl -H "Content-Type:application/json" -XPOST http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$product_code"\'","\'"version_number"\'":"\'"$version_number"\'","new_package_name":"\'"$new_package_name"\'"}\'\n    elif [ "$1" == "app_release" ];then\n        fir publish ./build/ios/outputs/saas_release.ipa -c "jenkinsèªå¨æåä¸ä¼ " > /opt/jenkins/logs/saas/saas_pro.log\n        time=`date "+%Y%m%d%H%M%S"`\n        aa=`cat /opt/jenkins/logs/saas/saas_pro.log | grep Published | awk \'{print $9}\' | awk -F\'/\' \'{print $4}\'`\n        bb=`cat /opt/jenkins/logs/saas/saas_pro.log | grep Release | awk \'{print $10}\'`\n        new_package_name="$JOB_BASE_NAME"_pro_"$time"-"$commit_num"-"$aa"?release_id="$bb"\n        echo $new_package_name\n        curl -H "Content-Type:application/json" -XPOST http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$product_code"\'","\'"version_number"\'":"\'"$version_number"\'","new_package_name":"\'"$new_package_name"\'"}\'\n    else\n       exit 1\n    fi\n}\n\n\nclean_build(){\n  flutter doctor\n  flutter clean\n  rm -Rf ios/Pods\n  rm -Rf ios/.symlinks\n  rm -Rf ios/Flutter/Flutter.framework\n  rm -Rf ios/Flutter/Flutter.podspec\n  rm ios/Podfile\n}\n\nrun_build1(){\nif [ $choice_env == "ios_dev" ];then\n     clean_build\n     flutter build ipa --export-options-plist ./ios/ExportOptionsDevelopment.plist --release --dart-define=APP_ENV=dev --no-sound-null-safety\n     mkdir -p ./build/ios/outputs\n     cp -r ./build/ios/ipa/scrm_app.ipa ./build/ios/outputs/saas_dev.ipa\n     run_build app_dev\nelif [ $choice_env == "ios_test" ];then\n     clean_build\n     flutter build ipa --export-options-plist ./ios/ExportOptionsDevelopment.plist --release --dart-define=APP_ENV=test --no-sound-null-safety\n     mkdir -p ./build/ios/outputs\n     cp -r ./build/ios/ipa/scrm_app.ipa ./build/ios/outputs/saas_test.ipa\n     run_build app_test\nelif [ $choice_env == "ios_release" ];then\n     clean_build\n     flutter build ipa --export-options-plist ./ios/ExportOptionsDevelopment.plist --release --dart-define=APP_ENV=release --no-sound-null-safety\n     mkdir -p ./build/ios/outputs\n     cp -r ./build/ios/ipa/scrm_app.ipa ./build/ios/outputs/saas_release.ipa\n     run_build app_release\nelif [ $choice_env == "ios_appstore" ];then\n     cd ./ios && fastlane ios sign_xcarchive_and_publish\nelse\n     exit 2\nfi\n}\nfunction checkBuild(){\n    product=$1\n    version=$2\n    if [[ -z $product ]] || [[ -z $version ]];then\n        # åæ°ä¸ºç©º.\n        return 1\n    fi\n    info_path=http://172.16.30.217:9110/version/status\n    value=`curl -XGET "$info_path?product_code=$product_code&version_number=$version_number" |awk -F\'lock_status":\' \'{print $2}\'|awk -F, \'{print $1}\'`\n    if [[ $value -eq 0 ]];then\n        # å¯ä»¥æ­£å¸¸æå»º.\n        return 0\n    else\n        # çæ¬å·²éå®.\n        return 3\n    fi\n}\n\nres1=$(checkBuild $product_code $version_number)\nres2=`echo $?`\nif [[ $res2 -eq 1 ]];then\n    echo "çæ¬å·æ²¡æè¾å¥"\n    exit $res2\nelif [[ $res2 -eq 3 ]];then\n    echo "å¯¹åºççæ¬å·²éå®"\n    exit $res2\nelse\n    run_build1\nfi\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n',normalizedContent:'# androidç¼è¯\n\n#!/bin/bash\n\n\ntime=`date "+%y%m%d%h%m%s"`\ncommit_num=`git rev-parse --short head`\nproject_code=saas\nproduct_code=$project_code\nversionlib_path=/data/vsersion_lib/$project_code\ndocker_images=\nmapping_path=\ndev_build_path=\n\nrun_build(){\n    sudo docker run -v /data/jenkins/jenkins_home/workspace/saas/$job_base_name:$mapping_path -v /data/gradle_cache/.gradle:/home/cirrus/.gradle --env gradle_user_home=/home/cirrus/.gradle --workdir /build --rm $docker_images sh -c "$build_command"\n    if [ "$1" == "app_dev" ];then\n        echo "å¼å§devæå"\n        cd $dev_build_path\n        sudo mkdir -p $versionlib_path\n        sudo cp -rf app-release.apk $versionlib_path/"$job_base_name"_dev_"$time"_"$commit_num".apk\n        dev_new_package_name="$job_base_name"_dev_"$time"_"$commit_num".apk\n        echo $dev_new_package_name\n        # echo "å¼å§stestæå"\n        # cd $stest_build_path\n        # sudo cp -rf app-stest-release.apk $versionlib_path/"$job_base_name"_test_"$time"_"$commit_num".apk\n        # test_new_package_name="$job_base_name"_test_"$time"_"$commit_num".apk\n        # echo $test_new_package_name\n        # echo "å¼å§proæå"\n        # cd $pro_build_path\n        # sudo cp -rf app-pro-release.apk $versionlib_path/"$job_base_name"_pro_"$time"_"$commit_num".apk\n        # pro_new_package_name="$job_base_name"_pro_"$time"_"$commit_num".apk\n        # echo $pro_new_package_name\n        curl -h "content-type:application/json" -xpost http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$project_code"\'","version_number":"\'"$version_number"\'","new_package_name":"\'"$dev_new_package_name"\'"}\'\n        # curl -h "content-type:application/json" -xpost http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$project_code"\'","version_number":"\'"$version_number"\'","new_package_name":"\'"$test_new_package_name"\'"}\'\n        # curl -h "content-type:application/json" -xpost http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$project_code"\'","version_number":"\'"$version_number"\'","new_package_name":"\'"$pro_new_package_name"\'"}\' \n    elif [ "$1" == "app_test" ];then\n        echo "å¼å§testæå"\n        cd $test_build_path\n        sudo mkdir -p $versionlib_path\n        sudo cp -rf app-release.apk $versionlib_path/"$job_base_name"_test_"$time"_"$commit_num".apk\n        test_new_package_name="$job_base_name"_test_"$time"_"$commit_num".apk\n        echo $test_new_package_name\n        curl -h "content-type:application/json" -xpost http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$project_code"\'","version_number":"\'"$version_number"\'","new_package_name":"\'"$test_new_package_name"\'"}\'\n    elif [ "$1" == "app_release" ];then\n        echo "å¼å§releaseæå"\n        cd $release_build_path\n        sudo mkdir -p $versionlib_path\n        sudo cp -rf app-release.apk $versionlib_path/"$job_base_name"_pro_"$time"_"$commit_num".apk\n        pro_new_package_name="$job_base_name"_pro_"$time"_"$commit_num".apk\n        echo $pro_new_package_name\n        curl -h "content-type:application/json" -xpost http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$project_code"\'","version_number":"\'"$version_number"\'","new_package_name":"\'"$pro_new_package_name"\'"}\'               \n\n    else\n        exit 1\n    fi\n\n}\n\nrun_build1(){\nif [ "$1" == "android_dev" ];then\n        docker_images=xxx/library/flutter:latest\n        mapping_path=/build\n        dev_build_path=/var/jenkins_home/workspace/$job_name/build/app/outputs/flutter-apk\n        build_command="flutter clean && flutter packages get && flutter build apk --no-sound-null-safety --dart-define=app_env=dev"\n        run_build app_dev\nelif [ "$1" == "android_test" ];then\n        docker_images=xxx/library/flutter:latest\n        mapping_path=/build\n        test_build_path=/var/jenkins_home/workspace/$job_name/build/app/outputs/flutter-apk\n        build_command="flutter clean && flutter packages get && flutter build apk --no-sound-null-safety --dart-define=app_env=test"\n        run_build app_test\nelif [ "$1" == "android_release" ];then\n        docker_images=xxx/library/flutter:latest\n        mapping_path=/build\n        release_build_path=/var/jenkins_home/workspace/$job_name/build/app/outputs/flutter-apk\n        build_command="flutter clean && flutter packages get && flutter build apk --no-sound-null-safety --dart-define=app_env=release"\n        run_build app_release\n\n\nelse\n        exit 2\nfi\n}\nfunction checkbuild(){\n    product=$1\n    version=$2\n    if [[ -z $product ]] || [[ -z $version ]];then\n        # åæ°ä¸ºç©º.\n        return 1\n    fi\n    info_path=http://172.16.30.217:9110/version/status\n    value=`curl -xget "$info_path?product_code=$product_code&version_number=$version_number" |awk -f\'lock_status":\' \'{print $2}\'|awk -f, \'{print $1}\'`\n    if [[ $value -eq 0 ]];then\n        # å¯ä»¥æ­£å¸¸æå»º.\n        return 0\n    else\n        # çæ¬å·²éå®.\n        return 3\n    fi\n}\n\nres1=$(checkbuild $product_code $version_number)\nres2=`echo $?`\nif [[ $res2 -eq 1 ]];then\n    echo "çæ¬å·æ²¡æè¾å¥"\n    exit $res2\nelif [[ $res2 -eq 3 ]];then\n    echo "å¯¹åºççæ¬å·²éå®"\n    exit $res2\nelse\n    run_build1 $1\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n\n\n# iosç¼è¯\n\n#flutter build ipa --build-name=0.0.6 --build-number=15 --release --dart-define=app_env=dev --no-sound-null-safety\n#flutter build ipa --release --dart-define=app_env=test --no-sound-null-safety\n#open ./build/ios/archive/runner.xcarchive\n#flutter build apk --no-sound-null-safety --dart-define=app_env=test\n\n#flutter build ipa --release --dart-define=app_env=dev --no-sound-null-safety\n#xcodebuild -exportarchive -exportoptionsplist exportoptionsdevelopment.plist -archivepath $pwd/build/ios/archive/runner.xcarchive -exportpath $pwd/build/ios/ipa/ -allowprovisioningupdates\n#cd ./ios && xcodebuild -workspace runner.xcworkspace -scheme runner -sdk iphoneos -configuration release archive -archivepath $pwd/build/runner.xcarchive && cd ..\n#cd ./ios && fastlane ios build_dev && cd ..\n\n#flutter build ipa --release --dart-define=app_env=test --no-sound-null-safety\n#cd ./ios && fastlane ios build_test && cd ..\n\n\n#flutter build ios --release --dart-define=app_env=dev --no-sound-null-safety\n#cd ./ios && fastlane ios build_dev && cd ..\n#\n#flutter build ios --release --dart-define=app_env=test --no-sound-null-safety\n#cd ./ios && fastlane ios build_test && cd ..\n#\ntime=`date "+%y%m%d%h%m%s"`\ncommit_num=`git rev-parse --short head`\nproduct_code=saas\nchoice_env=$1\nversion_number=$2\nexport lang=en_us.utf-8\n#job_name=scrm.ios\n\nrun_build(){\n    if [ "$1" == "app_dev" ];then\n        fir publish ./build/ios/outputs/saas_dev.ipa -c "jenkinsèªå¨æåä¸ä¼ " > /opt/jenkins/logs/saas/saas_dev.log\n        time=`date "+%y%m%d%h%m%s"`\n        aa=`cat /opt/jenkins/logs/saas/saas_dev.log | grep published | awk \'{print $9}\' | awk -f\'/\' \'{print $4}\'`\n        bb=`cat /opt/jenkins/logs/saas/saas_dev.log | grep release | awk \'{print $10}\'`\n        new_package_name="$job_base_name"_dev_"$time"-"$commit_num"-"$aa"?release_id="$bb"\n        echo $new_package_name\n        echo $version_number\n        curl -h "content-type:application/json" -xpost http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$product_code"\'","\'"version_number"\'":"\'"$version_number"\'","new_package_name":"\'"$new_package_name"\'"}\'\n    elif [ "$1" == "app_test" ];then\n        fir publish ./build/ios/outputs/saas_test.ipa -c "jenkinsèªå¨æåä¸ä¼ " > /opt/jenkins/logs/saas/saas_test.log\n        time=`date "+%y%m%d%h%m%s"`\n        aa=`cat /opt/jenkins/logs/saas/saas_test.log | grep published | awk \'{print $9}\' | awk -f\'/\' \'{print $4}\'`\n        bb=`cat /opt/jenkins/logs/saas/saas_test.log | grep release | awk \'{print $10}\'`\n        new_package_name="$job_base_name"_test_"$time"-"$commit_num"-"$aa"?release_id="$bb"\n        echo $new_package_name\n        curl -h "content-type:application/json" -xpost http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$product_code"\'","\'"version_number"\'":"\'"$version_number"\'","new_package_name":"\'"$new_package_name"\'"}\'\n    elif [ "$1" == "app_release" ];then\n        fir publish ./build/ios/outputs/saas_release.ipa -c "jenkinsèªå¨æåä¸ä¼ " > /opt/jenkins/logs/saas/saas_pro.log\n        time=`date "+%y%m%d%h%m%s"`\n        aa=`cat /opt/jenkins/logs/saas/saas_pro.log | grep published | awk \'{print $9}\' | awk -f\'/\' \'{print $4}\'`\n        bb=`cat /opt/jenkins/logs/saas/saas_pro.log | grep release | awk \'{print $10}\'`\n        new_package_name="$job_base_name"_pro_"$time"-"$commit_num"-"$aa"?release_id="$bb"\n        echo $new_package_name\n        curl -h "content-type:application/json" -xpost http://172.16.30.217:9110/version/modify -d \'{"product_code":"\'"$product_code"\'","\'"version_number"\'":"\'"$version_number"\'","new_package_name":"\'"$new_package_name"\'"}\'\n    else\n       exit 1\n    fi\n}\n\n\nclean_build(){\n  flutter doctor\n  flutter clean\n  rm -rf ios/pods\n  rm -rf ios/.symlinks\n  rm -rf ios/flutter/flutter.framework\n  rm -rf ios/flutter/flutter.podspec\n  rm ios/podfile\n}\n\nrun_build1(){\nif [ $choice_env == "ios_dev" ];then\n     clean_build\n     flutter build ipa --export-options-plist ./ios/exportoptionsdevelopment.plist --release --dart-define=app_env=dev --no-sound-null-safety\n     mkdir -p ./build/ios/outputs\n     cp -r ./build/ios/ipa/scrm_app.ipa ./build/ios/outputs/saas_dev.ipa\n     run_build app_dev\nelif [ $choice_env == "ios_test" ];then\n     clean_build\n     flutter build ipa --export-options-plist ./ios/exportoptionsdevelopment.plist --release --dart-define=app_env=test --no-sound-null-safety\n     mkdir -p ./build/ios/outputs\n     cp -r ./build/ios/ipa/scrm_app.ipa ./build/ios/outputs/saas_test.ipa\n     run_build app_test\nelif [ $choice_env == "ios_release" ];then\n     clean_build\n     flutter build ipa --export-options-plist ./ios/exportoptionsdevelopment.plist --release --dart-define=app_env=release --no-sound-null-safety\n     mkdir -p ./build/ios/outputs\n     cp -r ./build/ios/ipa/scrm_app.ipa ./build/ios/outputs/saas_release.ipa\n     run_build app_release\nelif [ $choice_env == "ios_appstore" ];then\n     cd ./ios && fastlane ios sign_xcarchive_and_publish\nelse\n     exit 2\nfi\n}\nfunction checkbuild(){\n    product=$1\n    version=$2\n    if [[ -z $product ]] || [[ -z $version ]];then\n        # åæ°ä¸ºç©º.\n        return 1\n    fi\n    info_path=http://172.16.30.217:9110/version/status\n    value=`curl -xget "$info_path?product_code=$product_code&version_number=$version_number" |awk -f\'lock_status":\' \'{print $2}\'|awk -f, \'{print $1}\'`\n    if [[ $value -eq 0 ]];then\n        # å¯ä»¥æ­£å¸¸æå»º.\n        return 0\n    else\n        # çæ¬å·²éå®.\n        return 3\n    fi\n}\n\nres1=$(checkbuild $product_code $version_number)\nres2=`echo $?`\nif [[ $res2 -eq 1 ]];then\n    echo "çæ¬å·æ²¡æè¾å¥"\n    exit $res2\nelif [[ $res2 -eq 3 ]];then\n    echo "å¯¹åºççæ¬å·²éå®"\n    exit $res2\nelse\n    run_build1\nfi\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n',charsets:{cjk:!0}},{title:"å¸¸ç¨shellèæ¬",frontmatter:{title:"å¸¸ç¨shellèæ¬",date:"2023-02-24T15:30:36.000Z",permalink:"/pages/8fdac1/",categories:["ç¼ç¨","shell"],tags:[null],readingShow:"top",description:"response=$(curl -sL -o /dev/null -w %{http_code} https://baidu.com)\nif [[ $response -ge 200 && $response -le 299 ]] ;then\n    echo 'check point success'\nelse\n    echo 'check point fail'\nfi\n`",meta:[{name:"twitter:title",content:"å¸¸ç¨shellèæ¬"},{name:"twitter:description",content:"response=$(curl -sL -o /dev/null -w %{http_code} https://baidu.com)\nif [[ $response -ge 200 && $response -le 299 ]] ;then\n    echo 'check point success'\nelse\n    echo 'check point fail'\nfi\n`"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/08.%E5%B8%B8%E7%94%A8shell%E8%84%9A%E6%9C%AC.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å¸¸ç¨shellèæ¬"},{property:"og:description",content:"response=$(curl -sL -o /dev/null -w %{http_code} https://baidu.com)\nif [[ $response -ge 200 && $response -le 299 ]] ;then\n    echo 'check point success'\nelse\n    echo 'check point fail'\nfi\n`"},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/08.%E5%B8%B8%E7%94%A8shell%E8%84%9A%E6%9C%AC.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-24T15:30:36.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"å¸¸ç¨shellèæ¬"},{itemprop:"description",content:"response=$(curl -sL -o /dev/null -w %{http_code} https://baidu.com)\nif [[ $response -ge 200 && $response -le 299 ]] ;then\n    echo 'check point success'\nelse\n    echo 'check point fail'\nfi\n`"}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/02.shell/08.%E5%B8%B8%E7%94%A8shell%E8%84%9A%E6%9C%AC.html",relativePath:"03.ç¼ç¨/02.shell/08.å¸¸ç¨shellèæ¬.md",key:"v-c86447e2",path:"/pages/8fdac1/",headersStr:null,content:'# å¸¸ç¨shellèæ¬\n\n#!/bin/bash\nresponse=$(curl -sL -o /dev/null -w %{http_code} https://baidu.com)\nif [[ $response -ge 200 && $response -le 299 ]] ;then \n    echo \'check point success\'\nelse \n    echo \'check point fail\'\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 2ãè¯»åæä»¶ä¸­çéç½®å°åéä¸­\n\n#!/bin/bash\n# éç½®æä»¶ä¸­çéç½®é¡¹æ ¼å¼ä¸ºkey1=value1ï¼ä¸è¡ä¸ä¸ªéç½®é¡¹\nwhile read line;do\n    eval "$line"\ndone < /etc/openvpn/server/smtp.conf\necho $key1\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 3ãæ ¹æ® console è¾å¥æ¡ä»¶æ§è¡\n\n#!/bin/bash\necho "éæ©ä»¥ä¸åè½:"\necho "   0) åè½0"\necho "   1) åè½1"\necho "   2) åè½2"\necho "   3) åè½3"\necho "   4) åè½4"\nread -p "åè½éé¡¹[4]: " option\nuntil [[ -z "$option" || "$option" =~ ^[0-4]$ ]]; do\n    read -p "$optionä¸ºæ æçéé¡¹ï¼è¯·éæ°è¾å¥åè½éé¡¹: " option\ndone\ncase "$option" in\n    0) \n        echo "åè½0å·²æ§è¡!" \n    ;;\n        1)\n            echo "åè½1å·²æ§è¡!" \n      exit\n    ;;\n        2)\n            echo "åè½2å·²æ§è¡!" \n            exit\n        ;;\n        3)\n            echo "åè½3å·²æ§è¡!"  \n            exit\n        ;;\n        # é»è®¤éé¡¹\n        4|"")\n            echo "åè½4å·²æ§è¡!" \n            exit\n        ;;\nesac\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\n\n# 4ãå°æå®è¾åºåå®¹åå¥æä»¶\n\n{\necho "hahh"\necho "lalal"\n} > /tmp/test\n\n\n1\n2\n3\n4\n\n\n\n# 5ãå¤æ­åéæ¯å¦å­å¨æä¸ºç©º\n\nif [ -z ${var+x} ]; then \n    echo "var is unset"; \nelse \n    echo "var is set to \'$var\'"; \nfi\n\n\n1\n2\n3\n4\n5\n\n\nåèï¼https://stackoverflow.com/questions/3601515/how-to-check-if-a-variable-is-set-in-bash\n\n\n#\n\n\n# 6ãæ¢ç®ç§ä¸ºåéãå°æ¶\n\n#!/bin/bash\n\na=60100\nswap_seconds ()\n{\n    SEC=$1\n    (( SEC < 60 )) && echo -e "æç»­æ¶é´: $SECç§\\c"\n    (( SEC >= 60 && SEC < 3600 )) && echo -e "æç»­æ¶é´: $(( SEC / 60 ))åé$(( SEC % 60 ))ç§\\c"\n    (( SEC > 3600 )) && echo -e "æç»­æ¶é´: $(( SEC / 3600 ))å°æ¶$(( (SEC % 3600) / 60 ))åé$(( (SEC % 3600) % 60 ))ç§\\c"\n}\n\nb=`swap_seconds $a`\necho $b\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nè¾åº\n\næç»­æ¶é´: 16å°æ¶41åé40ç§\n\n\n1\n\n\n\n# 7ãèæ¬å½ä»¤è¡åæ°çä¼ éä¸å¤æ­\n\n#!/bin/bash\n\nmain() {\n    if [[ $# == 1 ]]; then\n        case $1 in\n        "-h")\n            echo "èæ¬ä½¿ç¨æ¹æ³: "\n            echo "  ./gitlab-pipeline.sh gitä»åºå1 gitä»åºå2 ... tagå(tagå½åè§åä¸º: *-vå æ°å­)"\n            exit\n            ;;\n        "--help")\n            echo "èæ¬ä½¿ç¨æ¹æ³: "\n            echo "  ./gitlab-pipeline.sh gitä»åºå1 gitä»åºå2 ... tagå(tagå½åè§åä¸º: *-vå æ°å­)"\n            exit\n            ;;\n        *)\n            echo "åæ°éè¯¯ï¼"\n            exit\n            ;;\n        esac\n    fi\n}\n\nmain $*\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# 8ãæ£æµ docker å®¹å¨çå¯å¨ç¶æ\n\n# ç¬¬ä¸æ­¥ï¼å¤æ­éåæ¯å¦å­å¨\nif [ `docker images --format {{.Repository}}:{{.Tag}} |grep -Fx 192.168.1.7:32772/applications/$CI_PROJECT_NAME:${CI_COMMIT_SHORT_SHA};echo $?` -eq 0 ];then\n   docker pull 192.168.1.7:32772/applications/$CI_PROJECT_NAME:$CI_COMMIT_SHORT_SHA ;\nfi;\n# ç¬¬äºæ­¥ï¼å¤æ­æ¯å¦å·²ç»æéåçå®¹å¨å¨è¿è¡æèå¤å¨å¶ä»ç¶æãéåçï¼åå æï¼å¨å¯å¨ï¼ä¸éåçç´æ¥å¯å¨\nif [ `docker ps -a --format {{.Names}} |grep -Fx $CI_PROJECT_NAME > /dev/null ;echo $?` -eq 0 ] ;then\n   docker rm -f $CI_PROJECT_NAME ;\n   docker run -d --name $CI_PROJECT_NAME -p 30088:8080 192.168.1.7:32772/applications/$CI_PROJECT_NAME:$CI_COMMIT_SHORT_SHA ;\nelse\n   docker run -d --name $CI_PROJECT_NAME -p 30088:8080 192.168.1.7:32772/applications/$CI_PROJECT_NAME:$CI_COMMIT_SHORT_SHA ;\nfi;\n# ç¬¬ä¸æ­¥ï¼å¾ªç¯äºæ¬¡å¤æ­å®¹å¨ççæ§æ£æµæ¯å¦å¤äºä»ä¹ç¶æãå¥åº·ç¶æå°±ç´æ¥éåºå¾ªç¯ï¼ä¸å¥åº·æ¾ç¤ºå¥åº·æ£æ¥æ¥å¿ï¼æ­£å¨å¯å¨çç´æ¥æ¾ç¤ºãå¤äºå¶ä»ç¶æçç´æ¥æ¾ç¤ºç¶æ\nn=0;\nwhile true ;do\n  container_state=`docker inspect --format=\'{{json .State.Health.Status}}\' $CI_PROJECT_NAME`;\n  case $container_state in\n    \'"starting"\' )\n      echo "åºç¨å®¹å¨æ­£å¨å¯å¨ï¼";\n    ;;\n    \'"healthy"\' )\n      echo "åºç¨å®¹å¨å·²å¯å¨ï¼ç¶æå¥åº·ï¼";\n    break;\n    ;;\n    \'"unhealthy"\' )\n      echo "åºç¨å®¹å¨å¥åº·æ£æµå¤±è´¥ï¼";\n      docker inspect --format=\'{{json .State.Health.Log}}\' $CI_PROJECT_NAME;\n    ;;\n    * )\n      echo "æªç¥çç¶æ:$container_state";\n    ;;\n  esac;\n  sleep 1s;\n  n=$(($n+1));\n  if [ $n -eq 5 ];\n     then break ;\n  fi ;\ndone\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\n\n# 9ãæ£æ¥å¸¸è§ç³»ç»å½ä»¤æ¯å¦å®è£\n\ncheck_command() {\n    if ! command -v ifconfig >/dev/null 2>&1; then\n        echo -e "\\033[31mifconfigå½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y net-tools >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y net-tools >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y net-tools >/dev/null 2>&1\n        fi\n    elif ! command -v ip >/dev/null 2>&1; then\n        echo -e "\\033[31mipå½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y iproute2 >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y iproute2 >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y iproute2 >/dev/null 2>&1\n        fi\n    elif ! command -v curl >/dev/null 2>&1; then\n        echo -e "\\033[31mcurlå½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y curl >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y curl >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y curl >/dev/null 2>&1\n        fi\n    elif ! command -v wget >/dev/null 2>&1; then\n        echo -e "\\033[31mawkå½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y wget >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y wget >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y wget >/dev/null 2>&1\n        fi\n    elif ! command -v tail >/dev/null 2>&1; then\n        echo -e "\\033[31mcoreutilså½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y coreutils >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y coreutils >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y coreutils >/dev/null 2>&1\n        fi\n    elif ! command -v sed >/dev/null 2>&1; then\n        echo -e "\\033[31msedå½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y sed >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y sed >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y sed >/dev/null 2>&1\n        fi\n    elif ! command -v grep >/dev/null 2>&1; then\n        echo -e "\\033[31mgrepå½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y grep >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y grep >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y grep >/dev/null 2>&1\n        fi\n    fi\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n\n\n\n# 10ãæ£æ¥ç³»ç»ç½ç»\n\ncheck_network() {\n    check_command\n    ping -c 4 114.114.114.114 >/dev/null\n    if [ ! $? -eq 0 ]; then\n        echo -e "\\033[31mIPå°åæ æ³pingéï¼è¯·æ£æ¥ç½ç»è¿æ¥ï¼ï¼ï¼\\033[0m"\n        exit\n    fi\n    ping -c 4 www.baidu.com >/dev/null\n    if [ ! $? -eq 0 ]; then\n        echo -e "\\033[31mååæ æ³Pingéï¼è¯·æ£æ¥DNSéç½®ï¼ï¼ï¼\\033[0m"\n        exit\n    fi\n    curl -s --retry 2 --connect-timeout 2 www.baidu.com >/dev/null\n    if [ ! $? -eq 0 ]; then\n        echo -e "\\033[31mååæ æ³Pingéï¼è¯·æ£æ¥DNSéç½®ï¼ï¼ï¼\\033[0m"\n        exit\n    fi\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# 11ãåééééç¥\n\nfunction sendDingDing(){\n  Ding_Webhook_Token=\'ééæºå¨äººçWebHook Token\'\n  Ding_Webhook_keyword="å¯ç¨ä½æ¶æ¯æ é¢"\n  send_result=$(curl -sS \\\n    -XPOST https://oapi.dingtalk.com/robot/send?access_token="$Ding_Webhook_Token" \\\n    -H \'Content-Type: application/json\' \\\n    -d \'{"msgtype": "markdown","markdown": {"title": "\'$Ding_Webhook_Keyword\'","text": "\'"$*"\'"},"at": {"isAtAll": true}}\')\n  if [ $(echo $send_result | jq -r \'.errcode\') -eq 0 ]; then\n    echo "åéæå:  \\n" $*" "\n  else\n    echo "åéå¤±è´¥:  \\n" $*"\\n"\n    echo $send_result\n  fi\n}\n\nsendDingDing  "$(date +"%F %H:%M:%S") éè¦åè­¦çæ¶æ¯"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n.zshrc\n\nfunction sendDingDing() {\n  setopt no_nomatch\n  Ding_Webhook_Token=\'ééæºå¨äººçWebHook Token\'\n  Ding_Webhook_Keyword=\'å¯ç¨ä½æ¶æ¯æ é¢\'\n  send_result=$(curl -sS \\\n    -XPOST https://oapi.dingtalk.com/robot/send?access_token="$Ding_Webhook_Token" \\\n    -H \'Content-Type: application/json\' \\\n    -d \'{"msgtype": "markdown","markdown": {"title": "\'$Ding_Webhook_Keyword\'","text": "\'"$*"\'"},"at": {"isAtAll": true}}\')\n  if [ $(echo $send_result | jq -r \'.errcode\') -eq 0 ]; then\n    echo "åéæå:  \\n" $*" "\n  else\n    echo "åéå¤±è´¥:  \\n" $*"\\n"\n    echo $send_result\n  fi\n}\nfunction kfdd() {\n  sendDingDing "$(date +"%F %H:%M:%S") "$*" "\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# 12ãæ¸çä¿æå¤ä»½ä¸ªæ°\n\næ¸çæå®ç®å½åå¤ä»½æä»¶ï¼å¹¶ä¿ææå®ä¸ªæ°ã\n\nfunction clean_backups (){\n  if [ $# -gt 2 ];then\n    echo "åæ°éè¯¯"\n    exit 1\n  else\n    BAK_HOME=$1\n    keepNum=$2\n    fileNum=$(find ${BAK_HOME} -maxdepth 1 -type d -ctime -1 ! -path $BAK_HOME |wc -l)\n    if [ $fileNum -gt $keepNum ] ;then\n      find ${BAK_HOME} -maxdepth 1 -type d -ctime -1 ! -path $BAK_HOME | head -n `expr $fileNum - $keepNum` | xargs rm -rf\n    fi\n  fi\n}\n# è°ç¨\nclean_backups "./backups" 2 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n----------------------------------------\n\nåæé¾æ¥ï¼å¸¸ç¨shellèæ¬ | Gaoyufu \'s blog',normalizedContent:'# å¸¸ç¨shellèæ¬\n\n#!/bin/bash\nresponse=$(curl -sl -o /dev/null -w %{http_code} https://baidu.com)\nif [[ $response -ge 200 && $response -le 299 ]] ;then \n    echo \'check point success\'\nelse \n    echo \'check point fail\'\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 2ãè¯»åæä»¶ä¸­çéç½®å°åéä¸­\n\n#!/bin/bash\n# éç½®æä»¶ä¸­çéç½®é¡¹æ ¼å¼ä¸ºkey1=value1ï¼ä¸è¡ä¸ä¸ªéç½®é¡¹\nwhile read line;do\n    eval "$line"\ndone < /etc/openvpn/server/smtp.conf\necho $key1\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 3ãæ ¹æ® console è¾å¥æ¡ä»¶æ§è¡\n\n#!/bin/bash\necho "éæ©ä»¥ä¸åè½:"\necho "   0) åè½0"\necho "   1) åè½1"\necho "   2) åè½2"\necho "   3) åè½3"\necho "   4) åè½4"\nread -p "åè½éé¡¹[4]: " option\nuntil [[ -z "$option" || "$option" =~ ^[0-4]$ ]]; do\n    read -p "$optionä¸ºæ æçéé¡¹ï¼è¯·éæ°è¾å¥åè½éé¡¹: " option\ndone\ncase "$option" in\n    0) \n        echo "åè½0å·²æ§è¡!" \n    ;;\n        1)\n            echo "åè½1å·²æ§è¡!" \n      exit\n    ;;\n        2)\n            echo "åè½2å·²æ§è¡!" \n            exit\n        ;;\n        3)\n            echo "åè½3å·²æ§è¡!"  \n            exit\n        ;;\n        # é»è®¤éé¡¹\n        4|"")\n            echo "åè½4å·²æ§è¡!" \n            exit\n        ;;\nesac\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\n\n# 4ãå°æå®è¾åºåå®¹åå¥æä»¶\n\n{\necho "hahh"\necho "lalal"\n} > /tmp/test\n\n\n1\n2\n3\n4\n\n\n\n# 5ãå¤æ­åéæ¯å¦å­å¨æä¸ºç©º\n\nif [ -z ${var+x} ]; then \n    echo "var is unset"; \nelse \n    echo "var is set to \'$var\'"; \nfi\n\n\n1\n2\n3\n4\n5\n\n\nåèï¼https://stackoverflow.com/questions/3601515/how-to-check-if-a-variable-is-set-in-bash\n\n\n#\n\n\n# 6ãæ¢ç®ç§ä¸ºåéãå°æ¶\n\n#!/bin/bash\n\na=60100\nswap_seconds ()\n{\n    sec=$1\n    (( sec < 60 )) && echo -e "æç»­æ¶é´: $secç§\\c"\n    (( sec >= 60 && sec < 3600 )) && echo -e "æç»­æ¶é´: $(( sec / 60 ))åé$(( sec % 60 ))ç§\\c"\n    (( sec > 3600 )) && echo -e "æç»­æ¶é´: $(( sec / 3600 ))å°æ¶$(( (sec % 3600) / 60 ))åé$(( (sec % 3600) % 60 ))ç§\\c"\n}\n\nb=`swap_seconds $a`\necho $b\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nè¾åº\n\næç»­æ¶é´: 16å°æ¶41åé40ç§\n\n\n1\n\n\n\n# 7ãèæ¬å½ä»¤è¡åæ°çä¼ éä¸å¤æ­\n\n#!/bin/bash\n\nmain() {\n    if [[ $# == 1 ]]; then\n        case $1 in\n        "-h")\n            echo "èæ¬ä½¿ç¨æ¹æ³: "\n            echo "  ./gitlab-pipeline.sh gitä»åºå1 gitä»åºå2 ... tagå(tagå½åè§åä¸º: *-vå æ°å­)"\n            exit\n            ;;\n        "--help")\n            echo "èæ¬ä½¿ç¨æ¹æ³: "\n            echo "  ./gitlab-pipeline.sh gitä»åºå1 gitä»åºå2 ... tagå(tagå½åè§åä¸º: *-vå æ°å­)"\n            exit\n            ;;\n        *)\n            echo "åæ°éè¯¯ï¼"\n            exit\n            ;;\n        esac\n    fi\n}\n\nmain $*\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# 8ãæ£æµ docker å®¹å¨çå¯å¨ç¶æ\n\n# ç¬¬ä¸æ­¥ï¼å¤æ­éåæ¯å¦å­å¨\nif [ `docker images --format {{.repository}}:{{.tag}} |grep -fx 192.168.1.7:32772/applications/$ci_project_name:${ci_commit_short_sha};echo $?` -eq 0 ];then\n   docker pull 192.168.1.7:32772/applications/$ci_project_name:$ci_commit_short_sha ;\nfi;\n# ç¬¬äºæ­¥ï¼å¤æ­æ¯å¦å·²ç»æéåçå®¹å¨å¨è¿è¡æèå¤å¨å¶ä»ç¶æãéåçï¼åå æï¼å¨å¯å¨ï¼ä¸éåçç´æ¥å¯å¨\nif [ `docker ps -a --format {{.names}} |grep -fx $ci_project_name > /dev/null ;echo $?` -eq 0 ] ;then\n   docker rm -f $ci_project_name ;\n   docker run -d --name $ci_project_name -p 30088:8080 192.168.1.7:32772/applications/$ci_project_name:$ci_commit_short_sha ;\nelse\n   docker run -d --name $ci_project_name -p 30088:8080 192.168.1.7:32772/applications/$ci_project_name:$ci_commit_short_sha ;\nfi;\n# ç¬¬ä¸æ­¥ï¼å¾ªç¯äºæ¬¡å¤æ­å®¹å¨ççæ§æ£æµæ¯å¦å¤äºä»ä¹ç¶æãå¥åº·ç¶æå°±ç´æ¥éåºå¾ªç¯ï¼ä¸å¥åº·æ¾ç¤ºå¥åº·æ£æ¥æ¥å¿ï¼æ­£å¨å¯å¨çç´æ¥æ¾ç¤ºãå¤äºå¶ä»ç¶æçç´æ¥æ¾ç¤ºç¶æ\nn=0;\nwhile true ;do\n  container_state=`docker inspect --format=\'{{json .state.health.status}}\' $ci_project_name`;\n  case $container_state in\n    \'"starting"\' )\n      echo "åºç¨å®¹å¨æ­£å¨å¯å¨ï¼";\n    ;;\n    \'"healthy"\' )\n      echo "åºç¨å®¹å¨å·²å¯å¨ï¼ç¶æå¥åº·ï¼";\n    break;\n    ;;\n    \'"unhealthy"\' )\n      echo "åºç¨å®¹å¨å¥åº·æ£æµå¤±è´¥ï¼";\n      docker inspect --format=\'{{json .state.health.log}}\' $ci_project_name;\n    ;;\n    * )\n      echo "æªç¥çç¶æ:$container_state";\n    ;;\n  esac;\n  sleep 1s;\n  n=$(($n+1));\n  if [ $n -eq 5 ];\n     then break ;\n  fi ;\ndone\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\n\n# 9ãæ£æ¥å¸¸è§ç³»ç»å½ä»¤æ¯å¦å®è£\n\ncheck_command() {\n    if ! command -v ifconfig >/dev/null 2>&1; then\n        echo -e "\\033[31mifconfigå½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y net-tools >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y net-tools >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y net-tools >/dev/null 2>&1\n        fi\n    elif ! command -v ip >/dev/null 2>&1; then\n        echo -e "\\033[31mipå½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y iproute2 >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y iproute2 >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y iproute2 >/dev/null 2>&1\n        fi\n    elif ! command -v curl >/dev/null 2>&1; then\n        echo -e "\\033[31mcurlå½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y curl >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y curl >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y curl >/dev/null 2>&1\n        fi\n    elif ! command -v wget >/dev/null 2>&1; then\n        echo -e "\\033[31mawkå½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y wget >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y wget >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y wget >/dev/null 2>&1\n        fi\n    elif ! command -v tail >/dev/null 2>&1; then\n        echo -e "\\033[31mcoreutilså½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y coreutils >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y coreutils >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y coreutils >/dev/null 2>&1\n        fi\n    elif ! command -v sed >/dev/null 2>&1; then\n        echo -e "\\033[31msedå½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y sed >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y sed >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y sed >/dev/null 2>&1\n        fi\n    elif ! command -v grep >/dev/null 2>&1; then\n        echo -e "\\033[31mgrepå½ä»¤ä¸å­å¨ï¼æ­£å¨ä¸è½½å®è£ï¼\\033[0m"\n        if os="ubuntu"; then\n            apt install -y grep >/dev/null 2>&1\n        elif os="centos"; then\n            yum install -y grep >/dev/null 2>&1\n        elif os="fedora"; then\n            dnf install -y grep >/dev/null 2>&1\n        fi\n    fi\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n\n\n\n# 10ãæ£æ¥ç³»ç»ç½ç»\n\ncheck_network() {\n    check_command\n    ping -c 4 114.114.114.114 >/dev/null\n    if [ ! $? -eq 0 ]; then\n        echo -e "\\033[31mipå°åæ æ³pingéï¼è¯·æ£æ¥ç½ç»è¿æ¥ï¼ï¼ï¼\\033[0m"\n        exit\n    fi\n    ping -c 4 www.baidu.com >/dev/null\n    if [ ! $? -eq 0 ]; then\n        echo -e "\\033[31mååæ æ³pingéï¼è¯·æ£æ¥dnséç½®ï¼ï¼ï¼\\033[0m"\n        exit\n    fi\n    curl -s --retry 2 --connect-timeout 2 www.baidu.com >/dev/null\n    if [ ! $? -eq 0 ]; then\n        echo -e "\\033[31mååæ æ³pingéï¼è¯·æ£æ¥dnséç½®ï¼ï¼ï¼\\033[0m"\n        exit\n    fi\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# 11ãåééééç¥\n\nfunction senddingding(){\n  ding_webhook_token=\'ééæºå¨äººçwebhook token\'\n  ding_webhook_keyword="å¯ç¨ä½æ¶æ¯æ é¢"\n  send_result=$(curl -ss \\\n    -xpost https://oapi.dingtalk.com/robot/send?access_token="$ding_webhook_token" \\\n    -h \'content-type: application/json\' \\\n    -d \'{"msgtype": "markdown","markdown": {"title": "\'$ding_webhook_keyword\'","text": "\'"$*"\'"},"at": {"isatall": true}}\')\n  if [ $(echo $send_result | jq -r \'.errcode\') -eq 0 ]; then\n    echo "åéæå:  \\n" $*" "\n  else\n    echo "åéå¤±è´¥:  \\n" $*"\\n"\n    echo $send_result\n  fi\n}\n\nsenddingding  "$(date +"%f %h:%m:%s") éè¦åè­¦çæ¶æ¯"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n.zshrc\n\nfunction senddingding() {\n  setopt no_nomatch\n  ding_webhook_token=\'ééæºå¨äººçwebhook token\'\n  ding_webhook_keyword=\'å¯ç¨ä½æ¶æ¯æ é¢\'\n  send_result=$(curl -ss \\\n    -xpost https://oapi.dingtalk.com/robot/send?access_token="$ding_webhook_token" \\\n    -h \'content-type: application/json\' \\\n    -d \'{"msgtype": "markdown","markdown": {"title": "\'$ding_webhook_keyword\'","text": "\'"$*"\'"},"at": {"isatall": true}}\')\n  if [ $(echo $send_result | jq -r \'.errcode\') -eq 0 ]; then\n    echo "åéæå:  \\n" $*" "\n  else\n    echo "åéå¤±è´¥:  \\n" $*"\\n"\n    echo $send_result\n  fi\n}\nfunction kfdd() {\n  senddingding "$(date +"%f %h:%m:%s") "$*" "\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# 12ãæ¸çä¿æå¤ä»½ä¸ªæ°\n\næ¸çæå®ç®å½åå¤ä»½æä»¶ï¼å¹¶ä¿ææå®ä¸ªæ°ã\n\nfunction clean_backups (){\n  if [ $# -gt 2 ];then\n    echo "åæ°éè¯¯"\n    exit 1\n  else\n    bak_home=$1\n    keepnum=$2\n    filenum=$(find ${bak_home} -maxdepth 1 -type d -ctime -1 ! -path $bak_home |wc -l)\n    if [ $filenum -gt $keepnum ] ;then\n      find ${bak_home} -maxdepth 1 -type d -ctime -1 ! -path $bak_home | head -n `expr $filenum - $keepnum` | xargs rm -rf\n    fi\n  fi\n}\n# è°ç¨\nclean_backups "./backups" 2 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n----------------------------------------\n\nåæé¾æ¥ï¼å¸¸ç¨shellèæ¬ | gaoyufu \'s blog',charsets:{cjk:!0}},{title:"å­ç¬¦ä¸²çæªåæ¼æ¥",frontmatter:{title:"å­ç¬¦ä¸²çæªåæ¼æ¥",date:"2023-02-24T17:28:59.000Z",permalink:"/pages/f5c376/",categories:["ç¼ç¨","shell"],tags:[null],readingShow:"top",description:"ä¸ãå­ç¬¦ä¸²çæªå",meta:[{name:"twitter:title",content:"å­ç¬¦ä¸²çæªåæ¼æ¥"},{name:"twitter:description",content:"ä¸ãå­ç¬¦ä¸²çæªå"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/09.%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%88%AA%E5%8F%96%E6%8B%BC%E6%8E%A5.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å­ç¬¦ä¸²çæªåæ¼æ¥"},{property:"og:description",content:"ä¸ãå­ç¬¦ä¸²çæªå"},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/09.%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%88%AA%E5%8F%96%E6%8B%BC%E6%8E%A5.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-24T17:28:59.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"å­ç¬¦ä¸²çæªåæ¼æ¥"},{itemprop:"description",content:"ä¸ãå­ç¬¦ä¸²çæªå"}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/02.shell/09.%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%88%AA%E5%8F%96%E6%8B%BC%E6%8E%A5.html",relativePath:"03.ç¼ç¨/02.shell/09.å­ç¬¦ä¸²çæªåæ¼æ¥.md",key:"v-1ae891a8",path:"/pages/f5c376/",headers:[{level:2,title:"1ã# å·ä»å·¦è¾¹å¼å§ï¼å é¤ç¬¬ä¸æ¬¡å¹éå°æ¡ä»¶çå·¦è¾¹å­ç¬¦ï¼ä¿çå³è¾¹å­ç¬¦",slug:"_1ã-å·ä»å·¦è¾¹å¼å§-å é¤ç¬¬ä¸æ¬¡å¹éå°æ¡ä»¶çå·¦è¾¹å­ç¬¦-ä¿çå³è¾¹å­ç¬¦",normalizedTitle:"1ã# å·ä»å·¦è¾¹å¼å§ï¼å é¤ç¬¬ä¸æ¬¡å¹éå°æ¡ä»¶çå·¦è¾¹å­ç¬¦ï¼ä¿çå³è¾¹å­ç¬¦",charIndex:1507},{level:2,title:"2ã## å·ä»å·¦è¾¹å¼å§ï¼å é¤æåä¸æ¬¡å¹éå°æ¡ä»¶çå·¦è¾¹å­ç¬¦ï¼ä¿çå³è¾¹å­ç¬¦",slug:"_2ã-å·ä»å·¦è¾¹å¼å§-å é¤æåä¸æ¬¡å¹éå°æ¡ä»¶çå·¦è¾¹å­ç¬¦-ä¿çå³è¾¹å­ç¬¦",normalizedTitle:"2ã## å·ä»å·¦è¾¹å¼å§ï¼å é¤æåä¸æ¬¡å¹éå°æ¡ä»¶çå·¦è¾¹å­ç¬¦ï¼ä¿çå³è¾¹å­ç¬¦",charIndex:1678},{level:2,title:"3ã%å·ä»å³è¾¹å¼å§ï¼å é¤ç¬¬ä¸æ¬¡å¹éå°æ¡ä»¶çå³è¾¹åå®¹ï¼ä¿çå·¦è¾¹å­ç¬¦ï¼ä¸ä¿çå¹éæ¡ä»¶ï¼",slug:"_3ã-å·ä»å³è¾¹å¼å§-å é¤ç¬¬ä¸æ¬¡å¹éå°æ¡ä»¶çå³è¾¹åå®¹-ä¿çå·¦è¾¹å­ç¬¦-ä¸ä¿çå¹éæ¡ä»¶",normalizedTitle:"3ã%å·ä»å³è¾¹å¼å§ï¼å é¤ç¬¬ä¸æ¬¡å¹éå°æ¡ä»¶çå³è¾¹åå®¹ï¼ä¿çå·¦è¾¹å­ç¬¦ï¼ä¸ä¿çå¹éæ¡ä»¶ï¼",charIndex:1842},{level:2,title:"4ã%% å·ä»å³è¾¹å¼å§ï¼å é¤æåä¸æ¬¡å¹éå°æ¡ä»¶çå³è¾¹åå®¹ï¼ä¿çå·¦è¾¹å­ç¬¦ï¼ä¸ä¿çå¹éæ¡ä»¶ï¼",slug:"_4ã-å·ä»å³è¾¹å¼å§-å é¤æåä¸æ¬¡å¹éå°æ¡ä»¶çå³è¾¹åå®¹-ä¿çå·¦è¾¹å­ç¬¦-ä¸ä¿çå¹éæ¡ä»¶",normalizedTitle:"4ã%% å·ä»å³è¾¹å¼å§ï¼å é¤æåä¸æ¬¡å¹éå°æ¡ä»¶çå³è¾¹åå®¹ï¼ä¿çå·¦è¾¹å­ç¬¦ï¼ä¸ä¿çå¹éæ¡ä»¶ï¼",charIndex:2004},{level:2,title:"5ãä»å·¦è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼åå­ç¬¦çä¸ªæ°",slug:"_5ãä»å·¦è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§-åå­ç¬¦çä¸ªæ°",normalizedTitle:"5ãä»å·¦è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼åå­ç¬¦çä¸ªæ°",charIndex:2160},{level:2,title:"6ãä»å·¦è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼ä¸ç´å°ç»æ",slug:"_6ãä»å·¦è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§-ä¸ç´å°ç»æ",normalizedTitle:"6ãä»å·¦è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼ä¸ç´å°ç»æ",charIndex:2287},{level:2,title:"7ãä»å³è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼åå³æªå length ä¸ªå­ç¬¦ã",slug:"_7ãä»å³è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§-åå³æªå-length-ä¸ªå­ç¬¦ã",normalizedTitle:"7ãä»å³è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼åå³æªå length ä¸ªå­ç¬¦ã",charIndex:2448},{level:2,title:"8ãä»å³è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼ä¸ç´å°ç»æ",slug:"_8ãä»å³è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§-ä¸ç´å°ç»æ",normalizedTitle:"8ãä»å³è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼ä¸ç´å°ç»æ",charIndex:2587},{level:2,title:"9ãæªåå­ç¬¦ä¸²ä¸­çip",slug:"_9ãæªåå­ç¬¦ä¸²ä¸­çip",normalizedTitle:"9ãæªåå­ç¬¦ä¸²ä¸­çip",charIndex:2716},{level:2,title:"10ãæåå­ç¬¦ä¸²ä¸­çæ°å­",slug:"_10ãæåå­ç¬¦ä¸²ä¸­çæ°å­",normalizedTitle:"10ãæåå­ç¬¦ä¸²ä¸­çæ°å­",charIndex:2905}],headersStr:"1ã# å·ä»å·¦è¾¹å¼å§ï¼å é¤ç¬¬ä¸æ¬¡å¹éå°æ¡ä»¶çå·¦è¾¹å­ç¬¦ï¼ä¿çå³è¾¹å­ç¬¦ 2ã## å·ä»å·¦è¾¹å¼å§ï¼å é¤æåä¸æ¬¡å¹éå°æ¡ä»¶çå·¦è¾¹å­ç¬¦ï¼ä¿çå³è¾¹å­ç¬¦ 3ã%å·ä»å³è¾¹å¼å§ï¼å é¤ç¬¬ä¸æ¬¡å¹éå°æ¡ä»¶çå³è¾¹åå®¹ï¼ä¿çå·¦è¾¹å­ç¬¦ï¼ä¸ä¿çå¹éæ¡ä»¶ï¼ 4ã%% å·ä»å³è¾¹å¼å§ï¼å é¤æåä¸æ¬¡å¹éå°æ¡ä»¶çå³è¾¹åå®¹ï¼ä¿çå·¦è¾¹å­ç¬¦ï¼ä¸ä¿çå¹éæ¡ä»¶ï¼ 5ãä»å·¦è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼åå­ç¬¦çä¸ªæ° 6ãä»å·¦è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼ä¸ç´å°ç»æ 7ãä»å³è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼åå³æªå length ä¸ªå­ç¬¦ã 8ãä»å³è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼ä¸ç´å°ç»æ 9ãæªåå­ç¬¦ä¸²ä¸­çip 10ãæåå­ç¬¦ä¸²ä¸­çæ°å­",content:'ä¸ãå­ç¬¦ä¸²çæªå\n\nè¡¨è¾¾å¼                                       å«ä¹\n${#string}                                $stringçå­ç¬¦ä¸ªæ°\n${string:position}                        å¨$stringä¸­, ä»ä½ç½®$positionå¼å§æåå­ä¸²\n${string:position:length}                 å¨$stringä¸­, ä»ä½ç½®positionå¼å§æåé¿åº¦ä¸ºlengthçå­ä¸²\n${string#substring}                       ä» åé$stringçå¼å¤´, å é¤æç­å¹é$substringçå­ä¸²\n${string##substring}                      ä» åé$stringçå¼å¤´, å é¤æé¿å¹é$substringçå­ä¸²\n${string%substring}                       ä» åé$stringçç»å°¾, å é¤æç­å¹é$substringçå­ä¸²\n${string%%substring}                      ä» åé$stringçç»å°¾, å é¤æé¿å¹é$substringçå­ä¸²\n${string/substring/replacement}           ä½¿ç¨$replacement, æ¥ä»£æ¿ç¬¬ä¸ä¸ªå¹éç$substring\n${string//substring/replacement}          ä½¿ç¨$replacement, ä»£æ¿ææå¹éç$substring\n${string/#substring/replacement}          å¦æ$stringçåç¼å¹ésubstring, é£ä¹å°±ç¨replacementæ¥ä»£æ¿å¹éå°ç$substring\n${string/%substring/replacement}          å¦æ$stringçåç¼å¹ésubstring, é£ä¹å°±ç¨replacementæ¥ä»£æ¿å¹éå°ç$substring\nexpr match "$string" \'$substring\'         å¹é$stringå¼å¤´ç$substring* çé¿åº¦\nexpr "$string" : \'$substring\'             å¹ é$stringå¼å¤´ç$substring* çé¿åº¦\nexpr index "$string" $substring           å¨$stringä¸­å¹éå°ç$substringçç¬¬ä¸ä¸ªå­ç¬¦åºç°çä½ç½®\nexpr substr $string $position $length     å¨$stringä¸­ ä»ä½ç½®positionå¼å§æåé¿åº¦ä¸ºlengthçå­ä¸²\nexpr match "$string" \'\\($substring\\)\'     ä»$stringç å¼å¤´ä½ç½®æå$substring*\nexpr "$string" : \'\\($substring\\)\'         ä»$stringç å¼å¤´ä½ç½®æå$substring*\nexpr match "$string" \'.*\\($substring\\)\'   ä»$stringç ç»å°¾æå$substring*\nexpr "$string" : \'.*\\($substring\\)\'       ä»$stringç ç»å°¾æå$substring*\n\n\n# 1ã# å·ä»å·¦è¾¹å¼å§ï¼å é¤ç¬¬ä¸æ¬¡å¹éå°æ¡ä»¶çå·¦è¾¹å­ç¬¦ï¼ä¿çå³è¾¹å­ç¬¦\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"\nb=${a#*/};echo $b\n# ç»æï¼openshift/origin-metrics-cassandra:v3.9\n\n\n1\n2\n3\n\n\n\n# 2ã## å·ä»å·¦è¾¹å¼å§ï¼å é¤æåä¸æ¬¡å¹éå°æ¡ä»¶çå·¦è¾¹å­ç¬¦ï¼ä¿çå³è¾¹å­ç¬¦\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"\nb=${a##*/};echo $b\n# ç»æï¼origin-metrics-cassandra:v3.9\n\n\n1\n2\n3\n\n\n\n# 3ã%å·ä»å³è¾¹å¼å§ï¼å é¤ç¬¬ä¸æ¬¡å¹éå°æ¡ä»¶çå³è¾¹åå®¹ï¼ä¿çå·¦è¾¹å­ç¬¦ï¼ä¸ä¿çå¹éæ¡ä»¶ï¼\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"   \nb=${a%/*};echo $b\n# ç»æï¼docker.io/openshift\n\n\n1\n2\n3\n\n\n\n# 4ã%% å·ä»å³è¾¹å¼å§ï¼å é¤æåä¸æ¬¡å¹éå°æ¡ä»¶çå³è¾¹åå®¹ï¼ä¿çå·¦è¾¹å­ç¬¦ï¼ä¸ä¿çå¹éæ¡ä»¶ï¼\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"   \nb=${a%%/*};echo $b\n# ç»æï¼docker.io\n\n\n1\n2\n3\n\n\n\n# 5ãä»å·¦è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼åå­ç¬¦çä¸ªæ°\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"   \nb=${a:0:5};echo $b\n# ç»æï¼docke\n\n\n1\n2\n3\n\n\n\n# 6ãä»å·¦è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼ä¸ç´å°ç»æ\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"   \nb=${a:7};echo $b\n# ç»æï¼io/openshift/origin-metrics-cassandra:v3.9\n\n\n1\n2\n3\n\n\n\n# 7ãä»å³è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼åå³æªå length ä¸ªå­ç¬¦ã\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"   \nb=${a:0-8:5};echo $b\n# ç»æï¼dra:v\n\n\n1\n2\n3\n\n\n\n# 8ãä»å³è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼ä¸ç´å°ç»æ\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"   \nb=${a:0-8};echo $b\n# ç»æï¼dra:v3.9\n\n\n1\n2\n3\n\n\n\n# 9ãæªåå­ç¬¦ä¸²ä¸­çip\n\n# æ ·æ¬: a="å½å IPï¼123.456.789.172  æ¥èªäºï¼ä¸­å½ ä¸æµ· ä¸æµ·  èé"\nb=${a//[!0-9.]/};echo $b\n\næè\necho $a | grep -o -E "[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]*"\n\n# ç»æï¼123.456.789.172\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 10ãæåå­ç¬¦ä¸²ä¸­çæ°å­\n\necho "test-v1.1.0" | tr -cd \'[0-9.]\'    # è¾åº1.1.0\naa="test-v1.1.0" | echo ${aa//[!0-9.]/} # è¾åº1.1.0\n\n\n1\n2\n',normalizedContent:'ä¸ãå­ç¬¦ä¸²çæªå\n\nè¡¨è¾¾å¼                                       å«ä¹\n${#string}                                $stringçå­ç¬¦ä¸ªæ°\n${string:position}                        å¨$stringä¸­, ä»ä½ç½®$positionå¼å§æåå­ä¸²\n${string:position:length}                 å¨$stringä¸­, ä»ä½ç½®positionå¼å§æåé¿åº¦ä¸ºlengthçå­ä¸²\n${string#substring}                       ä» åé$stringçå¼å¤´, å é¤æç­å¹é$substringçå­ä¸²\n${string##substring}                      ä» åé$stringçå¼å¤´, å é¤æé¿å¹é$substringçå­ä¸²\n${string%substring}                       ä» åé$stringçç»å°¾, å é¤æç­å¹é$substringçå­ä¸²\n${string%%substring}                      ä» åé$stringçç»å°¾, å é¤æé¿å¹é$substringçå­ä¸²\n${string/substring/replacement}           ä½¿ç¨$replacement, æ¥ä»£æ¿ç¬¬ä¸ä¸ªå¹éç$substring\n${string//substring/replacement}          ä½¿ç¨$replacement, ä»£æ¿ææå¹éç$substring\n${string/#substring/replacement}          å¦æ$stringçåç¼å¹ésubstring, é£ä¹å°±ç¨replacementæ¥ä»£æ¿å¹éå°ç$substring\n${string/%substring/replacement}          å¦æ$stringçåç¼å¹ésubstring, é£ä¹å°±ç¨replacementæ¥ä»£æ¿å¹éå°ç$substring\nexpr match "$string" \'$substring\'         å¹é$stringå¼å¤´ç$substring* çé¿åº¦\nexpr "$string" : \'$substring\'             å¹ é$stringå¼å¤´ç$substring* çé¿åº¦\nexpr index "$string" $substring           å¨$stringä¸­å¹éå°ç$substringçç¬¬ä¸ä¸ªå­ç¬¦åºç°çä½ç½®\nexpr substr $string $position $length     å¨$stringä¸­ ä»ä½ç½®positionå¼å§æåé¿åº¦ä¸ºlengthçå­ä¸²\nexpr match "$string" \'\\($substring\\)\'     ä»$stringç å¼å¤´ä½ç½®æå$substring*\nexpr "$string" : \'\\($substring\\)\'         ä»$stringç å¼å¤´ä½ç½®æå$substring*\nexpr match "$string" \'.*\\($substring\\)\'   ä»$stringç ç»å°¾æå$substring*\nexpr "$string" : \'.*\\($substring\\)\'       ä»$stringç ç»å°¾æå$substring*\n\n\n# 1ã# å·ä»å·¦è¾¹å¼å§ï¼å é¤ç¬¬ä¸æ¬¡å¹éå°æ¡ä»¶çå·¦è¾¹å­ç¬¦ï¼ä¿çå³è¾¹å­ç¬¦\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"\nb=${a#*/};echo $b\n# ç»æï¼openshift/origin-metrics-cassandra:v3.9\n\n\n1\n2\n3\n\n\n\n# 2ã## å·ä»å·¦è¾¹å¼å§ï¼å é¤æåä¸æ¬¡å¹éå°æ¡ä»¶çå·¦è¾¹å­ç¬¦ï¼ä¿çå³è¾¹å­ç¬¦\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"\nb=${a##*/};echo $b\n# ç»æï¼origin-metrics-cassandra:v3.9\n\n\n1\n2\n3\n\n\n\n# 3ã%å·ä»å³è¾¹å¼å§ï¼å é¤ç¬¬ä¸æ¬¡å¹éå°æ¡ä»¶çå³è¾¹åå®¹ï¼ä¿çå·¦è¾¹å­ç¬¦ï¼ä¸ä¿çå¹éæ¡ä»¶ï¼\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"   \nb=${a%/*};echo $b\n# ç»æï¼docker.io/openshift\n\n\n1\n2\n3\n\n\n\n# 4ã%% å·ä»å³è¾¹å¼å§ï¼å é¤æåä¸æ¬¡å¹éå°æ¡ä»¶çå³è¾¹åå®¹ï¼ä¿çå·¦è¾¹å­ç¬¦ï¼ä¸ä¿çå¹éæ¡ä»¶ï¼\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"   \nb=${a%%/*};echo $b\n# ç»æï¼docker.io\n\n\n1\n2\n3\n\n\n\n# 5ãä»å·¦è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼åå­ç¬¦çä¸ªæ°\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"   \nb=${a:0:5};echo $b\n# ç»æï¼docke\n\n\n1\n2\n3\n\n\n\n# 6ãä»å·¦è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼ä¸ç´å°ç»æ\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"   \nb=${a:7};echo $b\n# ç»æï¼io/openshift/origin-metrics-cassandra:v3.9\n\n\n1\n2\n3\n\n\n\n# 7ãä»å³è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼åå³æªå length ä¸ªå­ç¬¦ã\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"   \nb=${a:0-8:5};echo $b\n# ç»æï¼dra:v\n\n\n1\n2\n3\n\n\n\n# 8ãä»å³è¾¹ç¬¬å ä¸ªå­ç¬¦å¼å§ï¼ä¸ç´å°ç»æ\n\n# æ ·æ¬: a="docker.io/openshift/origin-metrics-cassandra:v3.9"   \nb=${a:0-8};echo $b\n# ç»æï¼dra:v3.9\n\n\n1\n2\n3\n\n\n\n# 9ãæªåå­ç¬¦ä¸²ä¸­çip\n\n# æ ·æ¬: a="å½å ipï¼123.456.789.172  æ¥èªäºï¼ä¸­å½ ä¸æµ· ä¸æµ·  èé"\nb=${a//[!0-9.]/};echo $b\n\næè\necho $a | grep -o -e "[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]*"\n\n# ç»æï¼123.456.789.172\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 10ãæåå­ç¬¦ä¸²ä¸­çæ°å­\n\necho "test-v1.1.0" | tr -cd \'[0-9.]\'    # è¾åº1.1.0\naa="test-v1.1.0" | echo ${aa//[!0-9.]/} # è¾åº1.1.0\n\n\n1\n2\n',charsets:{cjk:!0}},{title:"shellåºç¡",frontmatter:{title:"shellåºç¡",date:"2023-02-24T17:31:50.000Z",permalink:"/pages/665355/",categories:["ç¼ç¨","shell"],tags:[null],readingShow:"top",description:'è®¡ç®æºåªè½è®¤è¯ï¼è¯å«ï¼æºå¨è¯­è¨(0å1)ï¼å¦ï¼11000000 è¿ç§ï¼ãä½æ¯ï¼æä»¬çç¨åºç¿ä»¬ä¸è½ç´æ¥å»å01è¿æ ·çä»£ç ï¼æä»¥ï¼è¦æ³å°ç¨åºç¿æå¼åçä»£ç å¨è®¡ç®æºä¸è¿è¡ï¼å°±å¿é¡»æ¾"äºº"ï¼å·¥å·ï¼æ¥ç¿»è¯ææºå¨è¯­è¨ï¼è¿ä¸ª"äºº"(å·¥å·)å°±æ¯æä»¬å¸¸å¸¸æè¯´çç¼è¯å¨æèè§£éå¨ã',meta:[{name:"image",content:"http://pic.zzppjj.top/LightPicture/2023/02/87fe91cf99897c92.png"},{name:"twitter:title",content:"shellåºç¡"},{name:"twitter:description",content:'è®¡ç®æºåªè½è®¤è¯ï¼è¯å«ï¼æºå¨è¯­è¨(0å1)ï¼å¦ï¼11000000 è¿ç§ï¼ãä½æ¯ï¼æä»¬çç¨åºç¿ä»¬ä¸è½ç´æ¥å»å01è¿æ ·çä»£ç ï¼æä»¥ï¼è¦æ³å°ç¨åºç¿æå¼åçä»£ç å¨è®¡ç®æºä¸è¿è¡ï¼å°±å¿é¡»æ¾"äºº"ï¼å·¥å·ï¼æ¥ç¿»è¯ææºå¨è¯­è¨ï¼è¿ä¸ª"äºº"(å·¥å·)å°±æ¯æä»¬å¸¸å¸¸æè¯´çç¼è¯å¨æèè§£éå¨ã'},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://pic.zzppjj.top/LightPicture/2023/02/87fe91cf99897c92.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/10.shell%E5%9F%BA%E7%A1%80.html"},{property:"og:type",content:"article"},{property:"og:title",content:"shellåºç¡"},{property:"og:description",content:'è®¡ç®æºåªè½è®¤è¯ï¼è¯å«ï¼æºå¨è¯­è¨(0å1)ï¼å¦ï¼11000000 è¿ç§ï¼ãä½æ¯ï¼æä»¬çç¨åºç¿ä»¬ä¸è½ç´æ¥å»å01è¿æ ·çä»£ç ï¼æä»¥ï¼è¦æ³å°ç¨åºç¿æå¼åçä»£ç å¨è®¡ç®æºä¸è¿è¡ï¼å°±å¿é¡»æ¾"äºº"ï¼å·¥å·ï¼æ¥ç¿»è¯ææºå¨è¯­è¨ï¼è¿ä¸ª"äºº"(å·¥å·)å°±æ¯æä»¬å¸¸å¸¸æè¯´çç¼è¯å¨æèè§£éå¨ã'},{property:"og:image",content:"http://pic.zzppjj.top/LightPicture/2023/02/87fe91cf99897c92.png"},{property:"og:url",content:"https://blog.zzppjj.top/03.%E7%BC%96%E7%A8%8B/02.shell/10.shell%E5%9F%BA%E7%A1%80.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-24T17:31:50.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"shellåºç¡"},{itemprop:"description",content:'è®¡ç®æºåªè½è®¤è¯ï¼è¯å«ï¼æºå¨è¯­è¨(0å1)ï¼å¦ï¼11000000 è¿ç§ï¼ãä½æ¯ï¼æä»¬çç¨åºç¿ä»¬ä¸è½ç´æ¥å»å01è¿æ ·çä»£ç ï¼æä»¥ï¼è¦æ³å°ç¨åºç¿æå¼åçä»£ç å¨è®¡ç®æºä¸è¿è¡ï¼å°±å¿é¡»æ¾"äºº"ï¼å·¥å·ï¼æ¥ç¿»è¯ææºå¨è¯­è¨ï¼è¿ä¸ª"äºº"(å·¥å·)å°±æ¯æä»¬å¸¸å¸¸æè¯´çç¼è¯å¨æèè§£éå¨ã'},{itemprop:"image",content:"http://pic.zzppjj.top/LightPicture/2023/02/87fe91cf99897c92.png"}]},regularPath:"/03.%E7%BC%96%E7%A8%8B/02.shell/10.shell%E5%9F%BA%E7%A1%80.html",relativePath:"03.ç¼ç¨/02.shell/10.shellåºç¡.md",key:"v-0aaf2f47",path:"/pages/665355/",headers:[{level:2,title:"1. ç¼ç¨è¯­è¨åç±»",slug:"_1-ç¼ç¨è¯­è¨åç±»",normalizedTitle:"1. ç¼ç¨è¯­è¨åç±»",charIndex:148},{level:2,title:"2. shellç®ä»",slug:"_2-shellç®ä»",normalizedTitle:"2. shellç®ä»",charIndex:500},{level:2,title:"3. shellèæ¬",slug:"_3-shellèæ¬",normalizedTitle:"3. shellèæ¬",charIndex:889},{level:3,title:"1ãä»ä¹æ¯shellèæ¬ï¼",slug:"_1ãä»ä¹æ¯shellèæ¬",normalizedTitle:"1ãä»ä¹æ¯shellèæ¬ï¼",charIndex:904},{level:3,title:"2ã ä»ä¹æ¶åç¨å°èæ¬?",slug:"_2ã-ä»ä¹æ¶åç¨å°èæ¬",normalizedTitle:"2ã ä»ä¹æ¶åç¨å°èæ¬?",charIndex:1024},{level:3,title:"3ã shellèæ¬è½å¹²å¥?",slug:"_3ã-shellèæ¬è½å¹²å¥",normalizedTitle:"3ã shellèæ¬è½å¹²å¥?",charIndex:1086},{level:3,title:"4ãå¦ä½å­¦ä¹ shellèæ¬ï¼",slug:"_4ãå¦ä½å­¦ä¹ shellèæ¬",normalizedTitle:"4ãå¦ä½å­¦ä¹ shellèæ¬ï¼",charIndex:1216},{level:3,title:"5ã å­¦ä¹ shellèæ¬çç§è¯",slug:"_5ã-å­¦ä¹ shellèæ¬çç§è¯",normalizedTitle:"5ã å­¦ä¹ shellèæ¬çç§è¯",charIndex:1319},{level:3,title:"6ã shellèæ¬çåºæ¬åæ³",slug:"_6ã-shellèæ¬çåºæ¬åæ³",normalizedTitle:"6ã shellèæ¬çåºæ¬åæ³",charIndex:1366},{level:3,title:"7ãshellèæ¬çæ§è¡æ¹æ³",slug:"_7ãshellèæ¬çæ§è¡æ¹æ³",normalizedTitle:"7ãshellèæ¬çæ§è¡æ¹æ³",charIndex:1742},{level:2,title:"äºãåéçå®ä¹",slug:"äºãåéçå®ä¹",normalizedTitle:"äºãåéçå®ä¹",charIndex:3263},{level:2,title:"1. åéæ¯ä»ä¹ï¼",slug:"_1-åéæ¯ä»ä¹",normalizedTitle:"1. åéæ¯ä»ä¹ï¼",charIndex:3275},{level:2,title:"2. ä»ä¹æ¶åéè¦å®ä¹åéï¼",slug:"_2-ä»ä¹æ¶åéè¦å®ä¹åé",normalizedTitle:"2. ä»ä¹æ¶åéè¦å®ä¹åéï¼",charIndex:3322},{level:2,title:"3.åéå¦ä½å®ä¹ï¼",slug:"_3-åéå¦ä½å®ä¹",normalizedTitle:"3.åéå¦ä½å®ä¹ï¼",charIndex:3462},{level:2,title:"4. åéçå®ä¹è§å",slug:"_4-åéçå®ä¹è§å",normalizedTitle:"4. åéçå®ä¹è§å",charIndex:3826},{level:3,title:"1ãåéååºåå¤§å°å",slug:"_1ãåéååºåå¤§å°å",normalizedTitle:"1ãåéååºåå¤§å°å",charIndex:3875},{level:3,title:"2ã åéåä¸è½æç¹æ®ç¬¦å·",slug:"_2ã-åéåä¸è½æç¹æ®ç¬¦å·",normalizedTitle:"2ã åéåä¸è½æç¹æ®ç¬¦å·",charIndex:3958},{level:3,title:"3ã åéåä¸è½ä»¥æ°å­å¼å¤´",slug:"_3ã-åéåä¸è½ä»¥æ°å­å¼å¤´",normalizedTitle:"3ã åéåä¸è½ä»¥æ°å­å¼å¤´",charIndex:4259},{level:3,title:"4ãç­å·ä¸¤è¾¹ä¸è½æä»»ä½ç©ºæ ¼",slug:"_4ãç­å·ä¸¤è¾¹ä¸è½æä»»ä½ç©ºæ ¼",normalizedTitle:"4ãç­å·ä¸¤è¾¹ä¸è½æä»»ä½ç©ºæ ¼",charIndex:4376},{level:3,title:"5ã åéåå°½éåå°è§åç¥æ",slug:"_5ã-åéåå°½éåå°è§åç¥æ",normalizedTitle:"5ã åéåå°½éåå°è§åç¥æ",charIndex:4552},{level:2,title:"5. åéçå®ä¹æ¹å¼æåªäºï¼",slug:"_5-åéçå®ä¹æ¹å¼æåªäº",normalizedTitle:"5. åéçå®ä¹æ¹å¼æåªäºï¼",charIndex:4690},{level:3,title:"1ãåºæ¬æ¹å¼",slug:"_1ãåºæ¬æ¹å¼",normalizedTitle:"1ãåºæ¬æ¹å¼",charIndex:4709},{level:3,title:"2ã å½ä»¤æ§è¡ç»æèµå¼ç»åé",slug:"_2ã-å½ä»¤æ§è¡ç»æèµå¼ç»åé",normalizedTitle:"2ã å½ä»¤æ§è¡ç»æèµå¼ç»åé",charIndex:4905},{level:3,title:"3ã äº¤äºå¼å®ä¹åé(read)",slug:"_3ã-äº¤äºå¼å®ä¹åé-read",normalizedTitle:"3ã äº¤äºå¼å®ä¹åé(read)",charIndex:5024},{level:3,title:"4ãå®ä¹æç±»åçåé(declare)",slug:"_4ãå®ä¹æç±»åçåé-declare",normalizedTitle:"4ãå®ä¹æç±»åçåé(declare)",charIndex:5488},{level:2,title:"6. åéçåç±»",slug:"_6-åéçåç±»",normalizedTitle:"6. åéçåç±»",charIndex:6018},{level:3,title:"1ãæ¬å°åé",slug:"_1ãæ¬å°åé",normalizedTitle:"1ãæ¬å°åé",charIndex:6031},{level:3,title:"2ã ç¯å¢åé",slug:"_2ã-ç¯å¢åé",normalizedTitle:"2ã ç¯å¢åé",charIndex:7121},{level:3,title:"3ã å¨å±åé",slug:"_3ã-å¨å±åé",normalizedTitle:"3ã å¨å±åé",charIndex:7528},{level:3,title:"4ãç³»ç»åé",slug:"_4ãç³»ç»åé",normalizedTitle:"4ãç³»ç»åé",charIndex:8182},{level:2,title:"1. ååè¿ç®ç¬¦å·",slug:"_1-ååè¿ç®ç¬¦å·",normalizedTitle:"1. ååè¿ç®ç¬¦å·",charIndex:9167},{level:2,title:"2.äºè§£i++å++i",slug:"_2-äºè§£i-å-i",normalizedTitle:"2.äºè§£i++å++i",charIndex:9468},{level:2,title:"1. æ°ç»å®ä¹",slug:"_1-æ°ç»å®ä¹",normalizedTitle:"1. æ°ç»å®ä¹",charIndex:9754},{level:3,title:"1ãæ°ç»åç±»",slug:"_1ãæ°ç»åç±»",normalizedTitle:"1ãæ°ç»åç±»",charIndex:9766},{level:3,title:"2ã æ®éæ°ç»å®ä¹",slug:"_2ã-æ®éæ°ç»å®ä¹",normalizedTitle:"2ã æ®éæ°ç»å®ä¹",charIndex:9835},{level:3,title:"3ã æ°ç»çè¯»å",slug:"_3ã-æ°ç»çè¯»å",normalizedTitle:"3ã æ°ç»çè¯»å",charIndex:10166},{level:3,title:"4ãå³èæ°ç»å®ä¹",slug:"_4ãå³èæ°ç»å®ä¹",normalizedTitle:"4ãå³èæ°ç»å®ä¹",charIndex:10466},{level:4,title:"1ãé¦åå£°æå³èæ°ç»",slug:"_1ãé¦åå£°æå³èæ°ç»",normalizedTitle:"1ãé¦åå£°æå³èæ°ç»",charIndex:10478},{level:4,title:"2ãæ°ç»èµå¼",slug:"_2ãæ°ç»èµå¼",normalizedTitle:"2ãæ°ç»èµå¼",charIndex:10595},{level:2,title:"2. å¶ä»åéå®ä¹",slug:"_2-å¶ä»åéå®ä¹",normalizedTitle:"2. å¶ä»åéå®ä¹",charIndex:11508}],headersStr:"1. ç¼ç¨è¯­è¨åç±» 2. shellç®ä» 3. shellèæ¬ 1ãä»ä¹æ¯shellèæ¬ï¼ 2ã ä»ä¹æ¶åç¨å°èæ¬? 3ã shellèæ¬è½å¹²å¥? 4ãå¦ä½å­¦ä¹ shellèæ¬ï¼ 5ã å­¦ä¹ shellèæ¬çç§è¯ 6ã shellèæ¬çåºæ¬åæ³ 7ãshellèæ¬çæ§è¡æ¹æ³ äºãåéçå®ä¹ 1. åéæ¯ä»ä¹ï¼ 2. ä»ä¹æ¶åéè¦å®ä¹åéï¼ 3.åéå¦ä½å®ä¹ï¼ 4. åéçå®ä¹è§å 1ãåéååºåå¤§å°å 2ã åéåä¸è½æç¹æ®ç¬¦å· 3ã åéåä¸è½ä»¥æ°å­å¼å¤´ 4ãç­å·ä¸¤è¾¹ä¸è½æä»»ä½ç©ºæ ¼ 5ã åéåå°½éåå°è§åç¥æ 5. åéçå®ä¹æ¹å¼æåªäºï¼ 1ãåºæ¬æ¹å¼ 2ã å½ä»¤æ§è¡ç»æèµå¼ç»åé 3ã äº¤äºå¼å®ä¹åé(read) 4ãå®ä¹æç±»åçåé(declare) 6. åéçåç±» 1ãæ¬å°åé 2ã ç¯å¢åé 3ã å¨å±åé 4ãç³»ç»åé 1. ååè¿ç®ç¬¦å· 2.äºè§£i++å++i 1. æ°ç»å®ä¹ 1ãæ°ç»åç±» 2ã æ®éæ°ç»å®ä¹ 3ã æ°ç»çè¯»å 4ãå³èæ°ç»å®ä¹ 1ãé¦åå£°æå³èæ°ç» 2ãæ°ç»èµå¼ 2. å¶ä»åéå®ä¹",content:'# ä¸ãSHELLä»ç»\n\nè®¡ç®æºåªè½è®¤è¯ï¼è¯å«ï¼æºå¨è¯­è¨(0å1)ï¼å¦ï¼11000000 è¿ç§ï¼ãä½æ¯ï¼æä»¬çç¨åºç¿ä»¬ä¸è½ç´æ¥å»å01è¿æ ·çä»£ç ï¼æä»¥ï¼è¦æ³å°ç¨åºç¿æå¼åçä»£ç å¨è®¡ç®æºä¸è¿è¡ï¼å°±å¿é¡»æ¾"äºº"ï¼å·¥å·ï¼æ¥ç¿»è¯ææºå¨è¯­è¨ï¼è¿ä¸ª"äºº"(å·¥å·)å°±æ¯æä»¬å¸¸å¸¸æè¯´çç¼è¯å¨æèè§£éå¨ã\n\n\n# 1. ç¼ç¨è¯­è¨åç±»\n\n * ç¼è¯åè¯­è¨ï¼\n   \n   ç¨åºå¨æ§è¡ä¹åéè¦ä¸ä¸ªä¸é¨çç¼è¯è¿ç¨ï¼æç¨åºç¼è¯æä¸ºæºå¨è¯­è¨æä»¶ï¼è¿è¡æ¶ä¸éè¦éæ°ç¿»è¯ï¼ç´æ¥ä½¿ç¨ç¼è¯çç»æå°±è¡äºãç¨åºæ§è¡æçé«ï¼ä¾èµç¼è¯å¨ï¼è·¨å¹³å°æ§å·®äºãå¦CãC++\n\n * è§£éåè¯­è¨ï¼\n   \n   ç¨åºä¸éè¦ç¼è¯ï¼ç¨åºå¨è¿è¡æ¶ç±è§£éå¨ç¿»è¯ææºå¨è¯­è¨ï¼æ¯æ§è¡ä¸æ¬¡é½è¦ç¿»è¯ä¸æ¬¡ãå æ­¤æçæ¯è¾ä½ãæ¯å¦Python/JavaScript/ Perl /ruby/Shellç­é½æ¯è§£éåè¯­è¨ã\n\n * æ»ç»\n\nç¼è¯åè¯­è¨æ¯è§£éåè¯­è¨éåº¦è¾å¿«ï¼ä½æ¯ä¸å¦è§£éåè¯­è¨è·¨å¹³å°æ§å¥½ãå¦æååºå±å¼åæèå¤§ååºç¨ç¨åºæèæä½ç³»å¼åä¸è¬é½ç¨ç¼è¯åè¯­è¨ï¼å¦ææ¯ä¸äºæå¡å¨èæ¬åä¸äºè¾å©çæ¥å£ï¼å¯¹éåº¦è¦æ±ä¸é«ãå¯¹åä¸ªå¹³å°çå¼å®¹æ§æè¦æ±çè¯åä¸è¬é½ç¨è§£éåè¯­è¨ã\n\n\n# 2. shellç®ä»\n\næ»ç»ï¼\n\n * shellå°±æ¯äººæºäº¤äºçä¸ä¸ªæ¡¥æ¢\n\n * shellçç§ç±»```bash\n\n# cat /etc/shells \n/bin/sh                #æ¯bashçä¸ä¸ªå¿«æ·æ¹å¼\n/bin/bash            #bashæ¯å¤§å¤æ°Linuxé»è®¤çshellï¼åå«çåè½å ä¹å¯ä»¥æ¶µçshellææçåè½\n/sbin/nologin        #è¡¨ç¤ºéäº¤äºï¼ä¸è½ç»å½æä½ç³»ç»\n/bin/dash            #å°å·§ï¼é«æï¼åè½ç¸æ¯å°ä¸äº\n\n/bin/csh            #å·æCè¯­è¨é£æ ¼çä¸ç§shellï¼å·æè®¸å¤ç¹æ§ï¼ä½ä¹æä¸äºç¼ºé·\n/bin/tcsh            #æ¯cshçå¢å¼ºçï¼å®å¨å¼å®¹csh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næèï¼ç»ç«¯åshellæä»ä¹å³ç³»ï¼\n\n\n\n\n# 3. shellèæ¬\n\n\n# 1ãä»ä¹æ¯shellèæ¬ï¼\n\n * ä¸å¥è¯æ¦æ¬ç®åæ¥è¯´å°±æ¯å°éè¦æ§è¡çå½ä»¤ä¿å­å°ææ¬ä¸­ï¼æç§é¡ºåºæ§è¡ãå®æ¯è§£éåçï¼æå³çä¸éè¦ç¼è¯ã\n\n * åç¡®åè¿°\n\nè¥å¹²å½ä»¤ + èæ¬çåºæ¬æ ¼å¼ + èæ¬ç¹å®è¯­æ³ + ææ³= shellèæ¬\n\n\n# 2ã ä»ä¹æ¶åç¨å°èæ¬?\n\néå¤åãå¤æåçå·¥ä½ï¼éè¿æå·¥ä½çå½ä»¤åæèæ¬ï¼ä»¥åä»ä»éè¦æ§è¡èæ¬å°±è½å®æè¿äºå·¥ä½ã\n\n\n# 3ã shellèæ¬è½å¹²å¥?\n\nâ èªå¨åè½¯ä»¶é¨ç½² LAMP/LNMP/Tomcat...\n\nâ¡èªå¨åç®¡ç ç³»ç»åå§åèæ¬ãæ¹éæ´æ¹ä¸»æºå¯ç ãæ¨éå¬é¥...\n\nâ¢èªå¨ååæå¤ç ç»è®¡ç½ç«è®¿é®éâ£èªå¨åå¤ä»½ æ°æ®åºå¤ä»½ãæ¥å¿è½¬å¨...\n\nâ¤èªå¨åçæ§èæ¬\n\n\n# 4ãå¦ä½å­¦ä¹ shellèæ¬ï¼\n\n 1. å°½å¯è½è®°å¿æ´å¤çå½ä»¤(è®°å¿å½ä»¤ä½¿ç¨åè½ååºæ¯)2. ææ¡èæ¬çæ åçæ ¼å¼ï¼æå®é­æ³å­èãä½¿ç¨æ åçæ§è¡æ¹å¼è¿è¡èæ¬ï¼3. å¿é¡»çæææ¡èæ¬çåºæ¬è¯­æ³ï¼éç¹)\n\n\n# 5ã å­¦ä¹ shellèæ¬çç§è¯\n\nå¤çï¼çæï¼ââ>æ¨¡ä»¿ï¼å¤ç»ï¼ââ>å¤æèï¼å¤åï¼\n\n\n# 6ã shellèæ¬çåºæ¬åæ³\n\n1ï¼èæ¬ç¬¬ä¸è¡ï¼é­æ³å­ç¬¦**#!**æå®è§£éå¨ãå¿åã\n\n#!/bin/bash è¡¨ç¤ºä»¥ä¸åå®¹ä½¿ç¨bashè§£éå¨è§£æ\n\næ³¨æï¼ å¦æç´æ¥å°è§£éå¨è·¯å¾åæ­»å¨èæ¬éï¼å¯è½å¨æäºç³»ç»å°±ä¼å­å¨æ¾ä¸å°è§£éå¨çå¼å®¹æ§é®é¢ï¼æä»¥å¯ä»¥ä½¿ç¨:#!/bin/env è§£éå¨ #!/bin/env bash\n\n2ï¼èæ¬ç¬¬äºé¨åï¼æ³¨é(#å·)è¯´æï¼å¯¹èæ¬çåºæ¬ä¿¡æ¯è¿è¡æè¿°ãå¯éã\n\n#!/bin/env bash\n\n# ä»¥ä¸åå®¹æ¯å¯¹èæ¬çåºæ¬ä¿¡æ¯çæè¿°\n# Name: åå­\n# Desc:æè¿°describe\n# Path:å­æ¾è·¯å¾\n# Usage:ç¨æ³\n# Update:æ´æ°æ¶é´\n\n#ä¸é¢å°±æ¯èæ¬çå·ä½åå®¹\ncommands\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n3ï¼èæ¬ç¬¬ä¸é¨åï¼èæ¬è¦å®ç°çå·ä½ä»£ç åå®¹\n\n\n# 7ãshellèæ¬çæ§è¡æ¹æ³\n\nç¼åäººçç¬¬ä¸ä¸ªshellèæ¬\n# cat example.sh\n#!/bin/env bash\n\n# ä»¥ä¸åå®¹æ¯å¯¹èæ¬çåºæ¬ä¿¡æ¯çæè¿°\n# Name: example.sh\n# Desc: num1\n# Path: /tmp/shell/example.sh\n# Usage:/tmp/shell/example.sh\n# Update:2019-05-05\n\necho "hello Aluo"\necho "hello world"\n\n# pwd\n/tmp/shell\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n1ãä»¥è·¯å¾æ¹å¼æ§è¡ï¼åæ¬ç¸å¯¹è·¯å¾åç»å¯¹è·¯å¾ä¸¤ç§æ¹å¼ã\n\n1) ç¸å¯¹è·¯å¾\n# cd /tmp/shell\n# chmod +x example.sh\n# ./example.sh\n\n2) ç»å¯¹è·¯å¾\n# chmod +x /tmp/shell/example.sh\n# /tmp/shell/example.sh\n\nè¯´æï¼ ./ ä»£è¡¨å¨å½åçå·¥ä½ç®å½ä¸æ§è¡example.shãå¦æä¸å ä¸ ./ï¼bashå¯è½ä¼å æ¾ä¸å°ç¸åºexample.shèæ¥éï¼å ä¸ºç®åçå·¥ä½ç®å½ï¼/tmp/shellï¼å¯è½ä¸å¨æ§è¡ç¨åºé»è®¤çæç´¢è·¯å¾ä¹å,ä¹å°±æ¯è¯´ï¼ä¸å¨ç¯å¢åé     PASHçåå®¹ä¹ä¸­ãæ¥çPATHçåå®¹å¯ç¨echo $PASHå½ä»¤ãç°å¨ç/tmp/shellå°±ä¸å¨ç¯å¢åéPASHä¸­çï¼æ     ä»¥å¿é¡»å ä¸./æå¯æ§è¡ã\nè·¯å¾æ¹å¼æ§è¡è¦æ±èæ¬æä»¶æå¯æ§è¡æéï¼æä»¥éè¦äºåè®¾å®èæ¬æä»¶çæ§è¡æéã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n2ãç´æ¥å¨å½ä»¤è¡æå®è§£éå¨æ§è¡ï¼ä½¿ç¨Â bash æ shÂ å½ä»¤æ§è¡ã\n\n1) bash\n# cd /tmp/shell\n# bash example.sh\n# bash -x example.sh \n+ echo \'hello Aluo\'\nhello Aluo\n+ echo \'hello world\'\nhello world\n\n----------------\n-x:ä¸è¬ç¨äºæéï¼æ¥çèæ¬çæ§è¡è¿ç¨\n-n:ç¨æ¥æ¥çèæ¬çè¯­æ³æ¯å¦æé®é¢\n------------\n\n2) sh\n# cd /tmp/shell\n# sh example.sh\n\nè¯´æï¼ä½¿ç¨bashæshå½ä»¤æ§è¡å¯ä»¥ä¸å¿äºåè®¾å®èæ¬æä»¶çæ§è¡æéï¼çè³é½ä¸ç¨åshellæä»¶ä¸­çç¬¬ä¸è¡ï¼æå®bashè·¯å¾ï¼ï¼å ä¸ºè¿ç§æ¹å¼æ¯å°example.shä½ä¸ºåæ°ä¼ ç»sh(bash)å½ä»¤æ¥æ§è¡çï¼è¿æ¶ä¸æ¯example.shèªå·±æ¥æ§è¡ï¼èæ¯è¢«äººå®¶è°ç¨æ§è¡ï¼æä»¥ä¸è¦æ§è¡æéãé£ä¹ä¸ç¨æå®bashè·¯å¾èªç¶ä¹å¥½çè§£äºã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n3ãå¨å½å shell ç¯å¢ä¸­æ§è¡\n\n1) source\n# cd /tmp/shell\n# source example.sh     # æsource /tmp/shell/example.sh\n\n2) .\n# cd /tmp/shell\n# . example.sh          # æ. /tmp/shell/example.sh\n\nè¯´æï¼åé¢ä¸¤ç§æ¹æ³æ§è¡shellèæ¬æ¶é½æ¯å¨å½åshellï¼ç§°ä¸ºç¶shellï¼ä¸­å¼å¯çä¸ä¸ªå­shellç¯å¢ä¸­å»æ§è¡ï¼shellèæ¬æ§è¡å®åå­shellç¯å¢éå³å³é­ï¼ç¶åååå°ç¶shellä¸­ãèæ¹æ³3åæ¯å¨å½åshellä¸­æ§è¡çã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# äºãåéçå®ä¹\n\n\n# 1. åéæ¯ä»ä¹ï¼\n\nä¸å¥è¯æ¦æ¬ï¼åéæ¯ç¨æ¥ä¸´æ¶ä¿å­æ°æ®çï¼è¯¥æ°æ®æ¯å¯ä»¥ååçæ°æ®ã\n\n\n# 2. ä»ä¹æ¶åéè¦å®ä¹åéï¼\n\n * å¦ææä¸ªåå®¹éè¦å¤æ¬¡ä½¿ç¨ï¼å¹¶ä¸å¨ä»£ç ä¸­éå¤åºç°ï¼é£ä¹å¯ä»¥ç¨åéä»£è¡¨è¯¥åå®¹ãè¿æ ·å¨ä¿®æ¹åå®¹çæ¶åï¼ä»ä»éè¦ä¿®æ¹åéçå¼ã\n * å¨ä»£ç è¿ä½çè¿ç¨ä¸­ï¼å¯è½ä¼ææäºå½ä»¤çæ§è¡ç»æä¿å­èµ·æ¥ï¼åç»­ä»£ç éè¦ä½¿ç¨è¿äºç»æï¼å°±å¯ä»¥ç´æ¥ä½¿ç¨è¿ä¸ªåéã\n\n\n# 3.åéå¦ä½å®ä¹ï¼\n\nåéå=åéå¼\n\nåéåï¼ç¨æ¥ä¸´æ¶ä¿å­æ°æ®ç\n\nåéå¼ï¼å°±æ¯ä¸´æ¶çå¯ååçæ°æ®\n\n# A=hello            å®ä¹åéA\n# echo $A            è°ç¨åéAï¼è¦ç»é±çï¼ä¸æ¯äººæ°å¸æ¯ç¾å"$"\nhello\n# echo ${A}            è¿å¯ä»¥è¿æ ·è°ç¨ï¼ä¸ç®¡ä½ çå§¿å¿å¤ä¼éï¼æ»ä¹è¦ç»é±\nhello\n# A=world            å ä¸ºæ¯åéæä»¥å¯ä»¥åï¼ç§»æå«ææ¯å¸¸äº\n# echo $A            ä¸ç®¡ä½ æ¯è°ï¼åªè¦è°ç¨å°±è¦ç»é±\nworld\n# unset A            ä¸è·ä½ ç©äºï¼åæ¶åé\n# echo $A            ä»æ­¤ï¼æåèº«äºï¼ä½ å¯ä»¥ç»æä»ç»ä»»ä½äºº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 4. åéçå®ä¹è§å\n\nè½ç¶å¯ä»¥ç»åéï¼åéåï¼èµäºä»»ä½å¼ï¼ä½æ¯ï¼å¯¹äºåéåä¹æ¯è¦æ±çï¼\n\n\n# 1ãåéååºåå¤§å°å\n\n# A=hello\n# a=world\n# echo $A\nhello\n# echo $a\nworld\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 2ã åéåä¸è½æç¹æ®ç¬¦å·\n\n# *A=hello\n-bash: *A=hello: command not found\n# ?A=hello\n-bash: ?A=hello: command not found\n# @A=hello\n-bash: @A=hello: command not found\n\nç¹å«è¯´æï¼å¯¹äºæç©ºæ ¼çå­ç¬¦ä¸²ç»åéèµå¼æ¶ï¼è¦ç¨å¼å·å¼èµ·æ¥\n# A=hello world\n-bash: world: command not found\n# A="hello world"\n# A=\'hello world\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# 3ã åéåä¸è½ä»¥æ°å­å¼å¤´\n\n# 1A=hello\n-bash: 1A=hello: command not found\n# A1=hello\n\næ³¨æï¼ä¸è½ä»¥æ°å­å¼å¤´å¹¶ä¸ä»£è¡¨åéåä¸­ä¸è½åå«æ°å­å¦ã\n\n\n1\n2\n3\n4\n5\n\n\n\n# 4ãç­å·ä¸¤è¾¹ä¸è½æä»»ä½ç©ºæ ¼\n\n# A =123\n-bash: A: command not found\n# A= 123\n-bash: 123: command not found\n# A = 123\n-bash: A: command not found\n# A=123\n# echo $A\n123\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# 5ã åéåå°½éåå°è§åç¥æ\n\nNTP_IP=10.1.1.1\nDIR=/u01/app1\nTMP_FILE=/var/log/1.log\n...\n\nè¯´æï¼ä¸è¬åéåä½¿ç¨å¤§åï¼å°åä¹å¯ä»¥ï¼ï¼ä¸è¦åä¸ä¸ªèæ¬ä¸­åéå¨æ¯a,b,cç­ä¸å®¹æéè¯»\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 5. åéçå®ä¹æ¹å¼æåªäºï¼\n\n\n# 1ãåºæ¬æ¹å¼\n\n> ç´æ¥èµå¼ç»ä¸ä¸ªåé\n\n# A=1234567\n# echo $A\n1234567\n# echo ${A:2:4}        è¡¨ç¤ºä»Aåéä¸­ç¬¬3ä¸ªå­ç¬¦å¼å§æªåï¼æªå4ä¸ªå­ç¬¦\n3456\n\nè¯´æï¼\n$åéå å ${åéå}çå¼å\nç¸åç¹ï¼é½å¯ä»¥è°ç¨åé\nä¸åç¹ï¼${åéå}å¯ä»¥åªæªååéçä¸é¨åï¼è$åéåä¸å¯ä»¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 2ã å½ä»¤æ§è¡ç»æèµå¼ç»åé\n\n# B=`date +%F`\n# echo $B\n2019-04-16\n# C=$(uname -r)\n# echo $C\n2.6.32-696.el6.x86_64\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 3ã äº¤äºå¼å®ä¹åé(read)\n\n**ç®çï¼**è®©ç¨æ·èªå·±ç»åéèµå¼ï¼æ¯è¾çµæ´»ã\n\nè¯­æ³ï¼read [éé¡¹] åéå\n\nå¸¸è§éé¡¹ï¼\n\néé¡¹   éä¹\n-p   å®ä¹æç¤ºç¨æ·çä¿¡æ¯\n-n   å®ä¹å­ç¬¦æ°ï¼éå¶åéå¼çé¿åº¦ï¼\n-s   ä¸æ¾ç¤ºï¼ä¸æ¾ç¤ºç¨æ·è¾å¥çåå®¹ï¼\n-t   å®ä¹è¶æ¶æ¶é´ï¼é»è®¤åä½ä¸ºç§ï¼éå¶ç¨æ·è¾å¥åéå¼çè¶æ¶æ¶é´ï¼\n\nä¸¾ä¾è¯´æï¼\n\nç¨æ³1ï¼ç¨æ·èªå·±å®ä¹åéå¼\n# read name\nharry\n# echo $name\nharry\n# read -p "Input your name:" name\nInput your name:tom\n# echo $name\ntom\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nç¨æ³2ï¼åéå¼æ¥èªæä»¶\n\n# cat 1.txt \n10.1.1.1 255.255.255.0\n\n# read ip mask < 1.txt \n# echo $ip\n10.1.1.1\n# echo $mask\n255.255.255.0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 4ãå®ä¹æç±»åçåé(declare)\n\nç®çï¼ ç»åéåä¸äºéå¶ï¼åºå®åéçç±»åï¼æ¯å¦ï¼æ´åãåªè¯»\n\nç¨æ³ï¼declare éé¡¹ åéå=åéå¼\n\nå¸¸ç¨éé¡¹ï¼\n\néé¡¹   éä¹              ä¸¾ä¾\n-i   å°åéçææ´æ°         declare -i A=123\n-r   å®ä¹åªè¯»åé          declare -r B=hello\n-a   å®ä¹æ®éæ°ç»ï¼æ¥çæ®éæ°ç»   \n-A   å®ä¹å³èæ°ç»ï¼æ¥çå³èæ°ç»   \n-x   å°åééè¿ç¯å¢å¯¼åº       declare -x AAA=123456 ç­äº export AAA=123456\n\nä¸¾ä¾è¯´æï¼\n\n# declare -i A=123\n# echo $A\n123\n# A=hello\n# echo $A\n0\n\n# declare -r B=hello\n# echo $B\nhello\n# B=world\n-bash: B: readonly variable\n# unset B\n-bash: unset: B: cannot unset: readonly variable\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# 6. åéçåç±»\n\n\n# 1ãæ¬å°åé\n\n * æ¬å°åéï¼å½åç¨æ·èªå®ä¹çåéãå½åè¿ç¨ä¸­ææï¼å¶ä»è¿ç¨åå½åè¿ç¨çå­è¿ç¨æ æã\n\n# ps                     # å½åbashçè¿ç¨å·ä¸º29105\n  PID TTY          TIME CMD\n29105 pts/2    00:00:00 bash\n29354 pts/2    00:00:00 ps\n# echo $$                # å½åbashçè¿ç¨å·ä¸º29105\n29105\n# name=aluo\n# echo $name\naluo\n# /bin/bash               # åå¼å¯ä¸ä¸ªbash\n# ps\n  PID TTY          TIME CMD\n29105 pts/2    00:00:00 bash\n29355 pts/2    00:00:00 bash\n29366 pts/2    00:00:00 ps\n# ps auxf | grep bash     # è¿ç¨å·ä¸º29355çbashæ¯è¿ç¨å·ä¸º29105çbashçå­è¿ç¨\nroot     28884  0.0  0.1 115680  2204 pts/1    Ss   10:37   0:00  \nroot     29027  0.0  0.1 115680  2132 pts/1    S    12:32   0:00 \nroot     29039  0.0  0.1 115680  2156 pts/1    S+   12:32   0:00 \nroot     29105  0.0  0.1 115680  2260 pts/2    Ss   13:30   0:00 \nroot     29355  0.0  0.1 115680  2124 pts/2    S    15:15   0:00\nroot     29368  0.0  0.0 112812   972 pts/2    S+   15:15   0:00\n# echo $$                 # æå°å½åæå¨è¿ç¨çè¿ç¨å·\n29355\n# echo $name              # å­è¿ç¨ä¸­æ æ³è°ç¨ç¶è¿ç¨ä¸­å®ä¹çnameåé\n\n# exit\nexit\n# echo $name\naluo\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\n\n# 2ã ç¯å¢åé\n\n * ç¯å¢åé\n   \n   å½åè¿ç¨ææï¼å¹¶ä¸è½å¤è¢«å­è¿ç¨è°ç¨ã\n   \n   * envæ¥çå½åç¨æ·çç¯å¢åé\n   * setæ¥è¯¢å½åç¨æ·çææåé(ä¸´æ¶åéä¸ç¯å¢åé)\n   * export åéå=åéå¼ æè åéå=åéå¼ï¼export åéå æè declare -x åéå=åéå¼\n\n# export A=hello        # ä¸´æ¶å°ä¸ä¸ªæ¬å°åéï¼ä¸´æ¶åéï¼åæç¯å¢åé\n# env|grep ^A\nA=hello\n\næ°¸ä¹çæï¼\nvim /etc/profile æè ~/.bashrc\nexport A=hello\næè\nA=hello\nexport A\n\nè¯´æï¼\nç³»ç»ä¸­æä¸ä¸ªåéPATHï¼ç¯å¢åé\nexport PATH=/usr/local/mysql/bin:$PATH\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# 3ã å¨å±åé\n\n * å¨å±åéï¼å¨å±ææçç¨æ·åç¨åºé½è½è°ç¨ï¼ä¸ç»§æ¿ï¼æ°å»ºçç¨æ·ä¹é»è®¤è½è°ç¨.\n * è§£è¯»ç¸å³éç½®æä»¶\n\næä»¶å               è¯´æ                    å¤æ³¨\n~/.bashrc         å½åç¨æ·çbashä¿¡æ¯ï¼ç¨æ·ç»å½æ¶è¯»å   å±é¨ãå®ä¹å«åãumaskãå½æ°ç­\n~/.bash_profile   å½åç¨æ·çç¯å¢åéä¿¡æ¯ï¼ç¨æ·ç»å½æ¶è¯»å   å±é¨ã\n~/.bash_logout    å½åç¨æ·éåºå½åshellæ¶æåè¯»å    å±é¨ãå®ä¹ç¨æ·éåºæ¶æ§è¡çç¨åºç­\n~/.bash_history   å½åç¨æ·çåå²å½ä»¤             å±é¨ãhistory -wä¿å­åå²è®°å½ history -cæ¸ç©ºåå²è®°å½\n/etc/bashrc       å¨å±çbashä¿¡æ¯             å¨å±ãææç¨æ·é½çæ\n/etc/profile      å¨å±ç¯å¢åéä¿¡æ¯              å¨å±ãç³»ç»åææç¨æ·é½çæ\n\n**è¯´æï¼**ä»¥ä¸æä»¶ä¿®æ¹åï¼é½éè¦éæ°sourceè®©å¶çææèéåºéæ°ç»å½ã\n\n * ç¨æ·ç»å½ç³»ç»è¯»åç¸å³æä»¶çé¡ºåº\n   1. /etc/profile\n   2. $HOME/.bash_profile\n   3. $HOME/.bashrc\n   4. /etc/bashrc\n   5. $HOME/.bash_logout\n\n> è¯´æï¼æ¬å°åéãç¯å¢åéãå¨å±åéæ¯æ ¹æ®åéçä½ç¨åæ¥åºåçã\n\n\n# 4ãç³»ç»åé\n\n * ç³»ç»åé(åç½®bashä¸­åé) ï¼ shellæ¬èº«å·²ç»åºå®å¥½äºå®çåå­åä½ç¨.\n\nåç½®åé       å«ä¹\n$?         ä¸ä¸æ¡å½ä»¤æ§è¡åè¿åçç¶æï¼ç¶æå¼ä¸º0è¡¨ç¤ºæ§è¡æ­£å¸¸ï¼é0è¡¨ç¤ºæ§è¡å¼å¸¸æéè¯¯\n$0         å½åæ§è¡çç¨åºæèæ¬å\n$#         èæ¬åé¢æ¥çåæ°çä¸ªæ°\n$*         èæ¬åé¢ææåæ°ï¼åæ°å½æä¸ä¸ªæ´ä½è¾åºï¼æ¯ä¸ä¸ªåéåæ°ä¹é´ä»¥ç©ºæ ¼éå¼\n$@         èæ¬åé¢ææåæ°ï¼åæ°æ¯ç¬ç«çï¼ä¹æ¯å¨é¨è¾åº\n1~9        èæ¬åé¢çä½ç½®åæ°ï¼$1è¡¨ç¤ºç¬¬1ä¸ªä½ç½®åæ°ï¼ä¾æ¬¡ç±»æ¨\n{10}~{n}   æ©å±ä½ç½®åæ°,ç¬¬10ä¸ªä½ç½®åéå¿é¡»ç¨{}å¤§æ¬å·æ¬èµ·æ¥(2ä½æ°å­ä»¥ä¸æ©èµ·æ¥)\n$$         å½åæå¨è¿ç¨çè¿ç¨å·ï¼å¦echo $$\n$ï¼         åå°è¿è¡çæåä¸ä¸ªè¿ç¨å· (å½åç»ç«¯ï¼\n!$         è°ç¨æåä¸æ¡å½ä»¤åå²ä¸­çåæ°\n\n * è¿ä¸æ­¥äºè§£ä½ç½®åæ°$1~${n}\n\n#!/bin/bash\n#äºè§£shellåç½®åéä¸­çä½ç½®åæ°å«ä¹\necho "\\$0 = $0"\necho "\\$# = $#"\necho "\\$* = $*"\necho "\\$@ = $@"\necho "\\$1 = $1" \necho "\\$2 = $2" \necho "\\$3 = $3" \necho "\\$11 = ${11}" \necho "\\$12 = ${12}"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n * è¿ä¸æ­¥äºè§£*å@çåºå«\n\n$*ï¼è¡¨ç¤ºå°åéçæä¸ä¸ªæ´ä½ $@ï¼è¡¨ç¤ºåéæ¯ç¬ç«ç\n\n#!/bin/bash\nfor i in "$@"\ndo\necho $i\ndone\n\necho "======ææ¯åå²çº¿======="\n\nfor i in "$*"\ndo\necho $i\ndone\n\n# bash 3.sh a b c\na\nb\nc\n======ææ¯åå²çº¿=======\na b c\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# ä¸ãç®åååè¿ç®\n\nç®æ¯è¿ç®ï¼é»è®¤æåµä¸ï¼shellå°±åªè½æ¯æç®åçæ´æ°è¿ç®\n\nè¿ç®åå®¹ï¼å (+)ãå(-)ãä¹(*)ãé¤(/)ãæ±ä½æ°ï¼%ï¼ãå¹ï¼**ï¼\n\n\n# 1. ååè¿ç®ç¬¦å·\n\nè¡¨è¾¾å¼      ä¸¾ä¾                           è¯´æ\n$(( ))   echo $((1+1))                \n$[ ]     echo $[10-5]                 \nexpr     expr 10 / 5                  exprç¨åºä¸­ï¼æ°å¼ä¸è¿ç®ç¬¦ä¹é´éè¦ç©ºæ ¼éå¼ï¼ä¹(*)è¿ç®ç¬¦éè¦ç¨è½¬ä¹ç¬¦( \\ )è½¬ä¹ï¼exprä¸è½åå¹è¿ç®\nlet      n=1;let n+=1 ç­ä»·äº let n=n+1   let n*=2 ç­ä»·äºlet n=n*2ï¼ä¸è½ä½¿ç¨let n**=2\n\n\n# 2.äºè§£i++å++i\n\n * å¯¹åéçå¼çå½±å\n\n# i=1\n# let i++\n# echo $i\n2\n# j=1\n# let ++j\n# echo $j\n2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * å¯¹è¡¨è¾¾å¼çå¼çå½±å\n\n# unset i j\n# i=1;j=1\n# let x=i++         åèµå¼ï¼åè¿ç®\n# let y=++j         åè¿ç®ï¼åèµå¼\n# echo $i\n2\n# echo $j\n2\n# echo $x\n1\n# echo $y\n2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# åãæ©å±è¡¥å\n\n\n# 1. æ°ç»å®ä¹\n\n\n# 1ãæ°ç»åç±»\n\n * æ®éæ°ç»ï¼åªè½ä½¿ç¨æ´æ°ä½ä¸ºæ°ç»ç´¢å¼(åç´ çä¸æ )\n * å³èæ°ç»ï¼å¯ä»¥ä½¿ç¨å­ç¬¦ä¸²ä½ä¸ºæ°ç»ç´¢å¼(åç´ çä¸æ )\n\n\n# 2ã æ®éæ°ç»å®ä¹\n\n * ä¸æ¬¡èµäºä¸ä¸ªå¼\n\næ°ç»å[ç´¢å¼ä¸æ ]=å¼\narray[0]=v1\narray[1]=v2\narray[2]=v3\narray[3]=v4\n\n\n1\n2\n3\n4\n5\n\n * ä¸æ¬¡èµäºå¤ä¸ªå¼\n\næ°ç»å=(å¼1 å¼2 å¼3 ...)\narray=(var1 var2 var3 var4)\n\narray1=(`cat /etc/passwd`)            å°æä»¶ä¸­æ¯ä¸è¡èµå¼ç»array1æ°ç»\narray2=(`ls /root`)\narray3=(harry amy jack "Miss Hou")\narray4=(1 2 3 4 "hello world" [10]=linux)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 3ã æ°ç»çè¯»å\n\n${æ°ç»å[åç´ ä¸æ ]}\n\necho ${array[0]}            è·åæ°ç»éç¬¬ä¸ä¸ªåç´ \necho ${array[*]}            è·åæ°ç»éçææåç´ \necho ${#array[*]}            è·åæ°ç»éææåç´ ä¸ªæ°\necho ${!array[@]}            è·åæ°ç»åç´ çç´¢å¼ä¸æ \necho ${array[@]:1:2}        è®¿é®æå®çåç´ ï¼1ä»£è¡¨ä»ä¸æ ä¸º1çåç´ å¼å§è·åï¼2ä»£è¡¨è·ååé¢å ä¸ªåç´ \n\næ¥çæ®éæ°ç»ä¿¡æ¯ï¼\n# declare -a\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 4ãå³èæ°ç»å®ä¹\n\n# 1ãé¦åå£°æå³èæ°ç»\n\ndeclare -A asso_array1\n\ndeclare -A asso_array1\ndeclare -A asso_array2\ndeclare -A asso_array3\n\n\n1\n2\n3\n\n\n# 2ãæ°ç»èµå¼\n\n * ä¸æ¬¡èµä¸ä¸ªå¼\n\næ°ç»å[ç´¢å¼orä¸æ ]=åéå¼\n# asso_array1[linux]=one\n# asso_array1[java]=two\n# asso_array1[php]=three\n\n\n1\n2\n3\n4\n\n * ä¸æ¬¡èµå¤ä¸ªå¼\n\n# asso_array2=([name1]=harry [name2]=jack [name3]=amy [name4]="Miss Hou")\n\n\n1\n\n * æ¥çå³èæ°ç»\n\n# declare -A\ndeclare -A asso_array1=\'([php]="three" [java]="two" [linux]="one" )\'\ndeclare -A asso_array2=\'([name3]="amy" [name2]="jack" [name1]="harry" [name4]="Miss Hou" )\'\n\n\n1\n2\n3\n\n * è·åå³èæ°ç»å¼\n\n# echo ${asso_array1[linux]}\none\n# echo ${asso_array1[php]}\nthree\n# echo ${asso_array1[*]}\nthree two one\n# echo ${!asso_array1[*]}\nphp java linux\n# echo ${#asso_array1[*]}\n3\n# echo ${#asso_array2[*]}\n4\n# echo ${!asso_array2[*]}\nname3 name2 name1 name4\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n * å¶ä»å®ä¹æ¹å¼\n\n# declare -A books\n# let books[linux]++\n# declare -A|grep books\ndeclare -A books=\'([linux]="1" )\'\n# let books[linux]++\n# declare -A|grep books\ndeclare -A books=\'([linux]="2" )\'\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 2. å¶ä»åéå®ä¹\n\n * ååºä¸ä¸ªç®å½ä¸çç®å½åæä»¶ï¼dirnameå basename\n\n# A=/root/Desktop/shell/mem.txt \n# echo $A\n/root/Desktop/shell/mem.txt\n# dirname $A   ååºç®å½\n/root/Desktop/shell\n# basename $A  ååºæä»¶\nmem.txt\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * -åé"åå®¹"çå é¤åæ¿æ¢\n\nä¸ä¸ªâ%âä»£è¡¨ä»å³å¾å·¦å é¤\nä¸¤ä¸ªâ%%âä»£è¡¨ä»å³å¾å·¦å»ææå¤\nä¸ä¸ªâ#âä»£è¡¨ä»å·¦å¾å³å»æå é¤\nä¸¤ä¸ªâ##âä»£è¡¨ä»å·¦å¾å³å»ææå¤\n\nä¸¾ä¾è¯´æï¼\n# url=www.taobao.com\n# echo ${#url}             è·ååéçé¿åº¦\n# echo ${url#*.}\n# echo ${url##*.}\n# echo ${url%.*}\n# echo ${url%%.*}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n * ä»¥ä¸äºè§£\n\næ¿æ¢ï¼/ å //\n 1015  echo ${url/ao/AO}  ç¨AOä»£æ¿aoï¼ä»å·¦å¾å³ç¬¬ä¸ä¸ªï¼\n 1017  echo ${url//ao/AO}   è´ªå©ªæ¿æ¢ï¼æ¿ä»£ææï¼\n\næ¿ä»£ï¼ - å :-  +å:+\n 1019  echo ${abc-123}\n 1020  abc=hello\n 1021  echo ${abc-444}\n 1022  echo $abc\n 1024  abc=\n 1025  echo ${abc-222}\n\n${åéå-æ°çåéå¼} æè ${åéå=æ°çåéå¼}\nåéæ²¡æè¢«èµå¼ï¼ä¼ä½¿ç¨âæ°çåéå¼â æ¿ä»£\nåéæè¢«èµå¼ï¼åæ¬ç©ºå¼ï¼ï¼ ä¸ä¼è¢«æ¿ä»£\n\n 1062  echo ${ABC:-123}\n 1063  ABC=HELLO\n 1064  echo ${ABC:-123}\n 1065  ABC=\n 1066  echo ${ABC:-123}\n\n${åéå:-æ°çåéå¼} æè ${åéå:=æ°çåéå¼}\nåéæ²¡æè¢«èµå¼æèèµç©ºå¼ï¼ä¼ä½¿ç¨âæ°çåéå¼â æ¿ä»£\nåéæè¢«èµå¼ï¼ ä¸ä¼è¢«æ¿ä»£\n\n 1116  echo ${abc=123}\n 1118  echo ${abc:=123}\n\n# unset abc\n# echo ${abc:+123}\n\n# abc=hello\n# echo ${abc:+123}\n123\n# abc=\n# echo ${abc:+123}\n\n${åéå+æ°çåéå¼}\nåéæ²¡æè¢«èµå¼æèèµç©ºå¼ï¼ä¸ä¼ä½¿ç¨âæ°çåéå¼â æ¿ä»£\nåéæè¢«èµå¼ï¼ ä¼è¢«æ¿ä»£\n# unset abc\n# echo ${abc+123}\n\n# abc=hello\n# echo ${abc+123}\n123\n# abc=\n# echo ${abc+123}\n123\n${åéå:+æ°çåéå¼}\nåéæ²¡æè¢«èµå¼ï¼ä¸ä¼ä½¿ç¨âæ°çåéå¼â æ¿ä»£\nåéæè¢«èµå¼ï¼åæ¬ç©ºå¼ï¼ï¼ ä¼è¢«æ¿ä»£\n\n# unset abc\n# echo ${abc?123}\n-bash: abc: 123\n\n# abc=hello\n# echo ${abc?123}\nhello\n# abc=\n# echo ${abc?123}\n\n${åéå?æ°çåéå¼}\nåéæ²¡æè¢«èµå¼:æç¤ºéè¯¯ä¿¡æ¯\nåéè¢«èµå¼ï¼åæ¬ç©ºå¼ï¼ï¼ä¸ä¼ä½¿ç¨âæ°çåéå¼â æ¿ä»£\n\n# unset abc\n# echo ${abc:?123}\n-bash: abc: 123\n# abc=hello\n# echo ${abc:?123}\nhello\n# abc=\n# echo ${abc:?123}\n-bash: abc: 123\n\n${åéå:?æ°çåéå¼}\nåéæ²¡æè¢«èµå¼æèèµç©ºå¼æ¶:æç¤ºéè¯¯ä¿¡æ¯\nåéè¢«èµå¼ï¼ä¸ä¼ä½¿ç¨âæ°çåéå¼â æ¿ä»£\n\nè¯´æï¼?ä¸»è¦æ¯å½åéæ²¡æèµå¼æç¤ºéè¯¯ä¿¡æ¯çï¼æ²¡æèµå¼åè½\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n',normalizedContent:'# ä¸ãshellä»ç»\n\nè®¡ç®æºåªè½è®¤è¯ï¼è¯å«ï¼æºå¨è¯­è¨(0å1)ï¼å¦ï¼11000000 è¿ç§ï¼ãä½æ¯ï¼æä»¬çç¨åºç¿ä»¬ä¸è½ç´æ¥å»å01è¿æ ·çä»£ç ï¼æä»¥ï¼è¦æ³å°ç¨åºç¿æå¼åçä»£ç å¨è®¡ç®æºä¸è¿è¡ï¼å°±å¿é¡»æ¾"äºº"ï¼å·¥å·ï¼æ¥ç¿»è¯ææºå¨è¯­è¨ï¼è¿ä¸ª"äºº"(å·¥å·)å°±æ¯æä»¬å¸¸å¸¸æè¯´çç¼è¯å¨æèè§£éå¨ã\n\n\n# 1. ç¼ç¨è¯­è¨åç±»\n\n * ç¼è¯åè¯­è¨ï¼\n   \n   ç¨åºå¨æ§è¡ä¹åéè¦ä¸ä¸ªä¸é¨çç¼è¯è¿ç¨ï¼æç¨åºç¼è¯æä¸ºæºå¨è¯­è¨æä»¶ï¼è¿è¡æ¶ä¸éè¦éæ°ç¿»è¯ï¼ç´æ¥ä½¿ç¨ç¼è¯çç»æå°±è¡äºãç¨åºæ§è¡æçé«ï¼ä¾èµç¼è¯å¨ï¼è·¨å¹³å°æ§å·®äºãå¦cãc++\n\n * è§£éåè¯­è¨ï¼\n   \n   ç¨åºä¸éè¦ç¼è¯ï¼ç¨åºå¨è¿è¡æ¶ç±è§£éå¨ç¿»è¯ææºå¨è¯­è¨ï¼æ¯æ§è¡ä¸æ¬¡é½è¦ç¿»è¯ä¸æ¬¡ãå æ­¤æçæ¯è¾ä½ãæ¯å¦python/javascript/ perl /ruby/shellç­é½æ¯è§£éåè¯­è¨ã\n\n * æ»ç»\n\nç¼è¯åè¯­è¨æ¯è§£éåè¯­è¨éåº¦è¾å¿«ï¼ä½æ¯ä¸å¦è§£éåè¯­è¨è·¨å¹³å°æ§å¥½ãå¦æååºå±å¼åæèå¤§ååºç¨ç¨åºæèæä½ç³»å¼åä¸è¬é½ç¨ç¼è¯åè¯­è¨ï¼å¦ææ¯ä¸äºæå¡å¨èæ¬åä¸äºè¾å©çæ¥å£ï¼å¯¹éåº¦è¦æ±ä¸é«ãå¯¹åä¸ªå¹³å°çå¼å®¹æ§æè¦æ±çè¯åä¸è¬é½ç¨è§£éåè¯­è¨ã\n\n\n# 2. shellç®ä»\n\næ»ç»ï¼\n\n * shellå°±æ¯äººæºäº¤äºçä¸ä¸ªæ¡¥æ¢\n\n * shellçç§ç±»```bash\n\n# cat /etc/shells \n/bin/sh                #æ¯bashçä¸ä¸ªå¿«æ·æ¹å¼\n/bin/bash            #bashæ¯å¤§å¤æ°linuxé»è®¤çshellï¼åå«çåè½å ä¹å¯ä»¥æ¶µçshellææçåè½\n/sbin/nologin        #è¡¨ç¤ºéäº¤äºï¼ä¸è½ç»å½æä½ç³»ç»\n/bin/dash            #å°å·§ï¼é«æï¼åè½ç¸æ¯å°ä¸äº\n\n/bin/csh            #å·æcè¯­è¨é£æ ¼çä¸ç§shellï¼å·æè®¸å¤ç¹æ§ï¼ä½ä¹æä¸äºç¼ºé·\n/bin/tcsh            #æ¯cshçå¢å¼ºçï¼å®å¨å¼å®¹csh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næèï¼ç»ç«¯åshellæä»ä¹å³ç³»ï¼\n\n\n\n\n# 3. shellèæ¬\n\n\n# 1ãä»ä¹æ¯shellèæ¬ï¼\n\n * ä¸å¥è¯æ¦æ¬ç®åæ¥è¯´å°±æ¯å°éè¦æ§è¡çå½ä»¤ä¿å­å°ææ¬ä¸­ï¼æç§é¡ºåºæ§è¡ãå®æ¯è§£éåçï¼æå³çä¸éè¦ç¼è¯ã\n\n * åç¡®åè¿°\n\nè¥å¹²å½ä»¤ + èæ¬çåºæ¬æ ¼å¼ + èæ¬ç¹å®è¯­æ³ + ææ³= shellèæ¬\n\n\n# 2ã ä»ä¹æ¶åç¨å°èæ¬?\n\néå¤åãå¤æåçå·¥ä½ï¼éè¿æå·¥ä½çå½ä»¤åæèæ¬ï¼ä»¥åä»ä»éè¦æ§è¡èæ¬å°±è½å®æè¿äºå·¥ä½ã\n\n\n# 3ã shellèæ¬è½å¹²å¥?\n\nâ èªå¨åè½¯ä»¶é¨ç½² lamp/lnmp/tomcat...\n\nâ¡èªå¨åç®¡ç ç³»ç»åå§åèæ¬ãæ¹éæ´æ¹ä¸»æºå¯ç ãæ¨éå¬é¥...\n\nâ¢èªå¨ååæå¤ç ç»è®¡ç½ç«è®¿é®éâ£èªå¨åå¤ä»½ æ°æ®åºå¤ä»½ãæ¥å¿è½¬å¨...\n\nâ¤èªå¨åçæ§èæ¬\n\n\n# 4ãå¦ä½å­¦ä¹ shellèæ¬ï¼\n\n 1. å°½å¯è½è®°å¿æ´å¤çå½ä»¤(è®°å¿å½ä»¤ä½¿ç¨åè½ååºæ¯)2. ææ¡èæ¬çæ åçæ ¼å¼ï¼æå®é­æ³å­èãä½¿ç¨æ åçæ§è¡æ¹å¼è¿è¡èæ¬ï¼3. å¿é¡»çæææ¡èæ¬çåºæ¬è¯­æ³ï¼éç¹)\n\n\n# 5ã å­¦ä¹ shellèæ¬çç§è¯\n\nå¤çï¼çæï¼ââ>æ¨¡ä»¿ï¼å¤ç»ï¼ââ>å¤æèï¼å¤åï¼\n\n\n# 6ã shellèæ¬çåºæ¬åæ³\n\n1ï¼èæ¬ç¬¬ä¸è¡ï¼é­æ³å­ç¬¦**#!**æå®è§£éå¨ãå¿åã\n\n#!/bin/bash è¡¨ç¤ºä»¥ä¸åå®¹ä½¿ç¨bashè§£éå¨è§£æ\n\næ³¨æï¼ å¦æç´æ¥å°è§£éå¨è·¯å¾åæ­»å¨èæ¬éï¼å¯è½å¨æäºç³»ç»å°±ä¼å­å¨æ¾ä¸å°è§£éå¨çå¼å®¹æ§é®é¢ï¼æä»¥å¯ä»¥ä½¿ç¨:#!/bin/env è§£éå¨ #!/bin/env bash\n\n2ï¼èæ¬ç¬¬äºé¨åï¼æ³¨é(#å·)è¯´æï¼å¯¹èæ¬çåºæ¬ä¿¡æ¯è¿è¡æè¿°ãå¯éã\n\n#!/bin/env bash\n\n# ä»¥ä¸åå®¹æ¯å¯¹èæ¬çåºæ¬ä¿¡æ¯çæè¿°\n# name: åå­\n# desc:æè¿°describe\n# path:å­æ¾è·¯å¾\n# usage:ç¨æ³\n# update:æ´æ°æ¶é´\n\n#ä¸é¢å°±æ¯èæ¬çå·ä½åå®¹\ncommands\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n3ï¼èæ¬ç¬¬ä¸é¨åï¼èæ¬è¦å®ç°çå·ä½ä»£ç åå®¹\n\n\n# 7ãshellèæ¬çæ§è¡æ¹æ³\n\nç¼åäººçç¬¬ä¸ä¸ªshellèæ¬\n# cat example.sh\n#!/bin/env bash\n\n# ä»¥ä¸åå®¹æ¯å¯¹èæ¬çåºæ¬ä¿¡æ¯çæè¿°\n# name: example.sh\n# desc: num1\n# path: /tmp/shell/example.sh\n# usage:/tmp/shell/example.sh\n# update:2019-05-05\n\necho "hello aluo"\necho "hello world"\n\n# pwd\n/tmp/shell\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n1ãä»¥è·¯å¾æ¹å¼æ§è¡ï¼åæ¬ç¸å¯¹è·¯å¾åç»å¯¹è·¯å¾ä¸¤ç§æ¹å¼ã\n\n1) ç¸å¯¹è·¯å¾\n# cd /tmp/shell\n# chmod +x example.sh\n# ./example.sh\n\n2) ç»å¯¹è·¯å¾\n# chmod +x /tmp/shell/example.sh\n# /tmp/shell/example.sh\n\nè¯´æï¼ ./ ä»£è¡¨å¨å½åçå·¥ä½ç®å½ä¸æ§è¡example.shãå¦æä¸å ä¸ ./ï¼bashå¯è½ä¼å æ¾ä¸å°ç¸åºexample.shèæ¥éï¼å ä¸ºç®åçå·¥ä½ç®å½ï¼/tmp/shellï¼å¯è½ä¸å¨æ§è¡ç¨åºé»è®¤çæç´¢è·¯å¾ä¹å,ä¹å°±æ¯è¯´ï¼ä¸å¨ç¯å¢åé     pashçåå®¹ä¹ä¸­ãæ¥çpathçåå®¹å¯ç¨echo $pashå½ä»¤ãç°å¨ç/tmp/shellå°±ä¸å¨ç¯å¢åépashä¸­çï¼æ     ä»¥å¿é¡»å ä¸./æå¯æ§è¡ã\nè·¯å¾æ¹å¼æ§è¡è¦æ±èæ¬æä»¶æå¯æ§è¡æéï¼æä»¥éè¦äºåè®¾å®èæ¬æä»¶çæ§è¡æéã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n2ãç´æ¥å¨å½ä»¤è¡æå®è§£éå¨æ§è¡ï¼ä½¿ç¨Â bash æ shÂ å½ä»¤æ§è¡ã\n\n1) bash\n# cd /tmp/shell\n# bash example.sh\n# bash -x example.sh \n+ echo \'hello aluo\'\nhello aluo\n+ echo \'hello world\'\nhello world\n\n----------------\n-x:ä¸è¬ç¨äºæéï¼æ¥çèæ¬çæ§è¡è¿ç¨\n-n:ç¨æ¥æ¥çèæ¬çè¯­æ³æ¯å¦æé®é¢\n------------\n\n2) sh\n# cd /tmp/shell\n# sh example.sh\n\nè¯´æï¼ä½¿ç¨bashæshå½ä»¤æ§è¡å¯ä»¥ä¸å¿äºåè®¾å®èæ¬æä»¶çæ§è¡æéï¼çè³é½ä¸ç¨åshellæä»¶ä¸­çç¬¬ä¸è¡ï¼æå®bashè·¯å¾ï¼ï¼å ä¸ºè¿ç§æ¹å¼æ¯å°example.shä½ä¸ºåæ°ä¼ ç»sh(bash)å½ä»¤æ¥æ§è¡çï¼è¿æ¶ä¸æ¯example.shèªå·±æ¥æ§è¡ï¼èæ¯è¢«äººå®¶è°ç¨æ§è¡ï¼æä»¥ä¸è¦æ§è¡æéãé£ä¹ä¸ç¨æå®bashè·¯å¾èªç¶ä¹å¥½çè§£äºã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n3ãå¨å½å shell ç¯å¢ä¸­æ§è¡\n\n1) source\n# cd /tmp/shell\n# source example.sh     # æsource /tmp/shell/example.sh\n\n2) .\n# cd /tmp/shell\n# . example.sh          # æ. /tmp/shell/example.sh\n\nè¯´æï¼åé¢ä¸¤ç§æ¹æ³æ§è¡shellèæ¬æ¶é½æ¯å¨å½åshellï¼ç§°ä¸ºç¶shellï¼ä¸­å¼å¯çä¸ä¸ªå­shellç¯å¢ä¸­å»æ§è¡ï¼shellèæ¬æ§è¡å®åå­shellç¯å¢éå³å³é­ï¼ç¶åååå°ç¶shellä¸­ãèæ¹æ³3åæ¯å¨å½åshellä¸­æ§è¡çã\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# äºãåéçå®ä¹\n\n\n# 1. åéæ¯ä»ä¹ï¼\n\nä¸å¥è¯æ¦æ¬ï¼åéæ¯ç¨æ¥ä¸´æ¶ä¿å­æ°æ®çï¼è¯¥æ°æ®æ¯å¯ä»¥ååçæ°æ®ã\n\n\n# 2. ä»ä¹æ¶åéè¦å®ä¹åéï¼\n\n * å¦ææä¸ªåå®¹éè¦å¤æ¬¡ä½¿ç¨ï¼å¹¶ä¸å¨ä»£ç ä¸­éå¤åºç°ï¼é£ä¹å¯ä»¥ç¨åéä»£è¡¨è¯¥åå®¹ãè¿æ ·å¨ä¿®æ¹åå®¹çæ¶åï¼ä»ä»éè¦ä¿®æ¹åéçå¼ã\n * å¨ä»£ç è¿ä½çè¿ç¨ä¸­ï¼å¯è½ä¼ææäºå½ä»¤çæ§è¡ç»æä¿å­èµ·æ¥ï¼åç»­ä»£ç éè¦ä½¿ç¨è¿äºç»æï¼å°±å¯ä»¥ç´æ¥ä½¿ç¨è¿ä¸ªåéã\n\n\n# 3.åéå¦ä½å®ä¹ï¼\n\nåéå=åéå¼\n\nåéåï¼ç¨æ¥ä¸´æ¶ä¿å­æ°æ®ç\n\nåéå¼ï¼å°±æ¯ä¸´æ¶çå¯ååçæ°æ®\n\n# a=hello            å®ä¹åéa\n# echo $a            è°ç¨åéaï¼è¦ç»é±çï¼ä¸æ¯äººæ°å¸æ¯ç¾å"$"\nhello\n# echo ${a}            è¿å¯ä»¥è¿æ ·è°ç¨ï¼ä¸ç®¡ä½ çå§¿å¿å¤ä¼éï¼æ»ä¹è¦ç»é±\nhello\n# a=world            å ä¸ºæ¯åéæä»¥å¯ä»¥åï¼ç§»æå«ææ¯å¸¸äº\n# echo $a            ä¸ç®¡ä½ æ¯è°ï¼åªè¦è°ç¨å°±è¦ç»é±\nworld\n# unset a            ä¸è·ä½ ç©äºï¼åæ¶åé\n# echo $a            ä»æ­¤ï¼æåèº«äºï¼ä½ å¯ä»¥ç»æä»ç»ä»»ä½äºº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 4. åéçå®ä¹è§å\n\nè½ç¶å¯ä»¥ç»åéï¼åéåï¼èµäºä»»ä½å¼ï¼ä½æ¯ï¼å¯¹äºåéåä¹æ¯è¦æ±çï¼\n\n\n# 1ãåéååºåå¤§å°å\n\n# a=hello\n# a=world\n# echo $a\nhello\n# echo $a\nworld\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 2ã åéåä¸è½æç¹æ®ç¬¦å·\n\n# *a=hello\n-bash: *a=hello: command not found\n# ?a=hello\n-bash: ?a=hello: command not found\n# @a=hello\n-bash: @a=hello: command not found\n\nç¹å«è¯´æï¼å¯¹äºæç©ºæ ¼çå­ç¬¦ä¸²ç»åéèµå¼æ¶ï¼è¦ç¨å¼å·å¼èµ·æ¥\n# a=hello world\n-bash: world: command not found\n# a="hello world"\n# a=\'hello world\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# 3ã åéåä¸è½ä»¥æ°å­å¼å¤´\n\n# 1a=hello\n-bash: 1a=hello: command not found\n# a1=hello\n\næ³¨æï¼ä¸è½ä»¥æ°å­å¼å¤´å¹¶ä¸ä»£è¡¨åéåä¸­ä¸è½åå«æ°å­å¦ã\n\n\n1\n2\n3\n4\n5\n\n\n\n# 4ãç­å·ä¸¤è¾¹ä¸è½æä»»ä½ç©ºæ ¼\n\n# a =123\n-bash: a: command not found\n# a= 123\n-bash: 123: command not found\n# a = 123\n-bash: a: command not found\n# a=123\n# echo $a\n123\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# 5ã åéåå°½éåå°è§åç¥æ\n\nntp_ip=10.1.1.1\ndir=/u01/app1\ntmp_file=/var/log/1.log\n...\n\nè¯´æï¼ä¸è¬åéåä½¿ç¨å¤§åï¼å°åä¹å¯ä»¥ï¼ï¼ä¸è¦åä¸ä¸ªèæ¬ä¸­åéå¨æ¯a,b,cç­ä¸å®¹æéè¯»\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 5. åéçå®ä¹æ¹å¼æåªäºï¼\n\n\n# 1ãåºæ¬æ¹å¼\n\n> ç´æ¥èµå¼ç»ä¸ä¸ªåé\n\n# a=1234567\n# echo $a\n1234567\n# echo ${a:2:4}        è¡¨ç¤ºä»aåéä¸­ç¬¬3ä¸ªå­ç¬¦å¼å§æªåï¼æªå4ä¸ªå­ç¬¦\n3456\n\nè¯´æï¼\n$åéå å ${åéå}çå¼å\nç¸åç¹ï¼é½å¯ä»¥è°ç¨åé\nä¸åç¹ï¼${åéå}å¯ä»¥åªæªååéçä¸é¨åï¼è$åéåä¸å¯ä»¥\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 2ã å½ä»¤æ§è¡ç»æèµå¼ç»åé\n\n# b=`date +%f`\n# echo $b\n2019-04-16\n# c=$(uname -r)\n# echo $c\n2.6.32-696.el6.x86_64\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 3ã äº¤äºå¼å®ä¹åé(read)\n\n**ç®çï¼**è®©ç¨æ·èªå·±ç»åéèµå¼ï¼æ¯è¾çµæ´»ã\n\nè¯­æ³ï¼read [éé¡¹] åéå\n\nå¸¸è§éé¡¹ï¼\n\néé¡¹   éä¹\n-p   å®ä¹æç¤ºç¨æ·çä¿¡æ¯\n-n   å®ä¹å­ç¬¦æ°ï¼éå¶åéå¼çé¿åº¦ï¼\n-s   ä¸æ¾ç¤ºï¼ä¸æ¾ç¤ºç¨æ·è¾å¥çåå®¹ï¼\n-t   å®ä¹è¶æ¶æ¶é´ï¼é»è®¤åä½ä¸ºç§ï¼éå¶ç¨æ·è¾å¥åéå¼çè¶æ¶æ¶é´ï¼\n\nä¸¾ä¾è¯´æï¼\n\nç¨æ³1ï¼ç¨æ·èªå·±å®ä¹åéå¼\n# read name\nharry\n# echo $name\nharry\n# read -p "input your name:" name\ninput your name:tom\n# echo $name\ntom\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nç¨æ³2ï¼åéå¼æ¥èªæä»¶\n\n# cat 1.txt \n10.1.1.1 255.255.255.0\n\n# read ip mask < 1.txt \n# echo $ip\n10.1.1.1\n# echo $mask\n255.255.255.0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 4ãå®ä¹æç±»åçåé(declare)\n\nç®çï¼ ç»åéåä¸äºéå¶ï¼åºå®åéçç±»åï¼æ¯å¦ï¼æ´åãåªè¯»\n\nç¨æ³ï¼declare éé¡¹ åéå=åéå¼\n\nå¸¸ç¨éé¡¹ï¼\n\néé¡¹   éä¹              ä¸¾ä¾\n-i   å°åéçææ´æ°         declare -i a=123\n-r   å®ä¹åªè¯»åé          declare -r b=hello\n-a   å®ä¹æ®éæ°ç»ï¼æ¥çæ®éæ°ç»   \n-a   å®ä¹å³èæ°ç»ï¼æ¥çå³èæ°ç»   \n-x   å°åééè¿ç¯å¢å¯¼åº       declare -x aaa=123456 ç­äº export aaa=123456\n\nä¸¾ä¾è¯´æï¼\n\n# declare -i a=123\n# echo $a\n123\n# a=hello\n# echo $a\n0\n\n# declare -r b=hello\n# echo $b\nhello\n# b=world\n-bash: b: readonly variable\n# unset b\n-bash: unset: b: cannot unset: readonly variable\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# 6. åéçåç±»\n\n\n# 1ãæ¬å°åé\n\n * æ¬å°åéï¼å½åç¨æ·èªå®ä¹çåéãå½åè¿ç¨ä¸­ææï¼å¶ä»è¿ç¨åå½åè¿ç¨çå­è¿ç¨æ æã\n\n# ps                     # å½åbashçè¿ç¨å·ä¸º29105\n  pid tty          time cmd\n29105 pts/2    00:00:00 bash\n29354 pts/2    00:00:00 ps\n# echo $$                # å½åbashçè¿ç¨å·ä¸º29105\n29105\n# name=aluo\n# echo $name\naluo\n# /bin/bash               # åå¼å¯ä¸ä¸ªbash\n# ps\n  pid tty          time cmd\n29105 pts/2    00:00:00 bash\n29355 pts/2    00:00:00 bash\n29366 pts/2    00:00:00 ps\n# ps auxf | grep bash     # è¿ç¨å·ä¸º29355çbashæ¯è¿ç¨å·ä¸º29105çbashçå­è¿ç¨\nroot     28884  0.0  0.1 115680  2204 pts/1    ss   10:37   0:00  \nroot     29027  0.0  0.1 115680  2132 pts/1    s    12:32   0:00 \nroot     29039  0.0  0.1 115680  2156 pts/1    s+   12:32   0:00 \nroot     29105  0.0  0.1 115680  2260 pts/2    ss   13:30   0:00 \nroot     29355  0.0  0.1 115680  2124 pts/2    s    15:15   0:00\nroot     29368  0.0  0.0 112812   972 pts/2    s+   15:15   0:00\n# echo $$                 # æå°å½åæå¨è¿ç¨çè¿ç¨å·\n29355\n# echo $name              # å­è¿ç¨ä¸­æ æ³è°ç¨ç¶è¿ç¨ä¸­å®ä¹çnameåé\n\n# exit\nexit\n# echo $name\naluo\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\n\n# 2ã ç¯å¢åé\n\n * ç¯å¢åé\n   \n   å½åè¿ç¨ææï¼å¹¶ä¸è½å¤è¢«å­è¿ç¨è°ç¨ã\n   \n   * envæ¥çå½åç¨æ·çç¯å¢åé\n   * setæ¥è¯¢å½åç¨æ·çææåé(ä¸´æ¶åéä¸ç¯å¢åé)\n   * export åéå=åéå¼ æè åéå=åéå¼ï¼export åéå æè declare -x åéå=åéå¼\n\n# export a=hello        # ä¸´æ¶å°ä¸ä¸ªæ¬å°åéï¼ä¸´æ¶åéï¼åæç¯å¢åé\n# env|grep ^a\na=hello\n\næ°¸ä¹çæï¼\nvim /etc/profile æè ~/.bashrc\nexport a=hello\næè\na=hello\nexport a\n\nè¯´æï¼\nç³»ç»ä¸­æä¸ä¸ªåépathï¼ç¯å¢åé\nexport path=/usr/local/mysql/bin:$path\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# 3ã å¨å±åé\n\n * å¨å±åéï¼å¨å±ææçç¨æ·åç¨åºé½è½è°ç¨ï¼ä¸ç»§æ¿ï¼æ°å»ºçç¨æ·ä¹é»è®¤è½è°ç¨.\n * è§£è¯»ç¸å³éç½®æä»¶\n\næä»¶å               è¯´æ                    å¤æ³¨\n~/.bashrc         å½åç¨æ·çbashä¿¡æ¯ï¼ç¨æ·ç»å½æ¶è¯»å   å±é¨ãå®ä¹å«åãumaskãå½æ°ç­\n~/.bash_profile   å½åç¨æ·çç¯å¢åéä¿¡æ¯ï¼ç¨æ·ç»å½æ¶è¯»å   å±é¨ã\n~/.bash_logout    å½åç¨æ·éåºå½åshellæ¶æåè¯»å    å±é¨ãå®ä¹ç¨æ·éåºæ¶æ§è¡çç¨åºç­\n~/.bash_history   å½åç¨æ·çåå²å½ä»¤             å±é¨ãhistory -wä¿å­åå²è®°å½ history -cæ¸ç©ºåå²è®°å½\n/etc/bashrc       å¨å±çbashä¿¡æ¯             å¨å±ãææç¨æ·é½çæ\n/etc/profile      å¨å±ç¯å¢åéä¿¡æ¯              å¨å±ãç³»ç»åææç¨æ·é½çæ\n\n**è¯´æï¼**ä»¥ä¸æä»¶ä¿®æ¹åï¼é½éè¦éæ°sourceè®©å¶çææèéåºéæ°ç»å½ã\n\n * ç¨æ·ç»å½ç³»ç»è¯»åç¸å³æä»¶çé¡ºåº\n   1. /etc/profile\n   2. $home/.bash_profile\n   3. $home/.bashrc\n   4. /etc/bashrc\n   5. $home/.bash_logout\n\n> è¯´æï¼æ¬å°åéãç¯å¢åéãå¨å±åéæ¯æ ¹æ®åéçä½ç¨åæ¥åºåçã\n\n\n# 4ãç³»ç»åé\n\n * ç³»ç»åé(åç½®bashä¸­åé) ï¼ shellæ¬èº«å·²ç»åºå®å¥½äºå®çåå­åä½ç¨.\n\nåç½®åé       å«ä¹\n$?         ä¸ä¸æ¡å½ä»¤æ§è¡åè¿åçç¶æï¼ç¶æå¼ä¸º0è¡¨ç¤ºæ§è¡æ­£å¸¸ï¼é0è¡¨ç¤ºæ§è¡å¼å¸¸æéè¯¯\n$0         å½åæ§è¡çç¨åºæèæ¬å\n$#         èæ¬åé¢æ¥çåæ°çä¸ªæ°\n$*         èæ¬åé¢ææåæ°ï¼åæ°å½æä¸ä¸ªæ´ä½è¾åºï¼æ¯ä¸ä¸ªåéåæ°ä¹é´ä»¥ç©ºæ ¼éå¼\n$@         èæ¬åé¢ææåæ°ï¼åæ°æ¯ç¬ç«çï¼ä¹æ¯å¨é¨è¾åº\n1~9        èæ¬åé¢çä½ç½®åæ°ï¼$1è¡¨ç¤ºç¬¬1ä¸ªä½ç½®åæ°ï¼ä¾æ¬¡ç±»æ¨\n{10}~{n}   æ©å±ä½ç½®åæ°,ç¬¬10ä¸ªä½ç½®åéå¿é¡»ç¨{}å¤§æ¬å·æ¬èµ·æ¥(2ä½æ°å­ä»¥ä¸æ©èµ·æ¥)\n$$         å½åæå¨è¿ç¨çè¿ç¨å·ï¼å¦echo $$\n$ï¼         åå°è¿è¡çæåä¸ä¸ªè¿ç¨å· (å½åç»ç«¯ï¼\n!$         è°ç¨æåä¸æ¡å½ä»¤åå²ä¸­çåæ°\n\n * è¿ä¸æ­¥äºè§£ä½ç½®åæ°$1~${n}\n\n#!/bin/bash\n#äºè§£shellåç½®åéä¸­çä½ç½®åæ°å«ä¹\necho "\\$0 = $0"\necho "\\$# = $#"\necho "\\$* = $*"\necho "\\$@ = $@"\necho "\\$1 = $1" \necho "\\$2 = $2" \necho "\\$3 = $3" \necho "\\$11 = ${11}" \necho "\\$12 = ${12}"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n * è¿ä¸æ­¥äºè§£*å@çåºå«\n\n$*ï¼è¡¨ç¤ºå°åéçæä¸ä¸ªæ´ä½ $@ï¼è¡¨ç¤ºåéæ¯ç¬ç«ç\n\n#!/bin/bash\nfor i in "$@"\ndo\necho $i\ndone\n\necho "======ææ¯åå²çº¿======="\n\nfor i in "$*"\ndo\necho $i\ndone\n\n# bash 3.sh a b c\na\nb\nc\n======ææ¯åå²çº¿=======\na b c\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# ä¸ãç®åååè¿ç®\n\nç®æ¯è¿ç®ï¼é»è®¤æåµä¸ï¼shellå°±åªè½æ¯æç®åçæ´æ°è¿ç®\n\nè¿ç®åå®¹ï¼å (+)ãå(-)ãä¹(*)ãé¤(/)ãæ±ä½æ°ï¼%ï¼ãå¹ï¼**ï¼\n\n\n# 1. ååè¿ç®ç¬¦å·\n\nè¡¨è¾¾å¼      ä¸¾ä¾                           è¯´æ\n$(( ))   echo $((1+1))                \n$[ ]     echo $[10-5]                 \nexpr     expr 10 / 5                  exprç¨åºä¸­ï¼æ°å¼ä¸è¿ç®ç¬¦ä¹é´éè¦ç©ºæ ¼éå¼ï¼ä¹(*)è¿ç®ç¬¦éè¦ç¨è½¬ä¹ç¬¦( \\ )è½¬ä¹ï¼exprä¸è½åå¹è¿ç®\nlet      n=1;let n+=1 ç­ä»·äº let n=n+1   let n*=2 ç­ä»·äºlet n=n*2ï¼ä¸è½ä½¿ç¨let n**=2\n\n\n# 2.äºè§£i++å++i\n\n * å¯¹åéçå¼çå½±å\n\n# i=1\n# let i++\n# echo $i\n2\n# j=1\n# let ++j\n# echo $j\n2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n * å¯¹è¡¨è¾¾å¼çå¼çå½±å\n\n# unset i j\n# i=1;j=1\n# let x=i++         åèµå¼ï¼åè¿ç®\n# let y=++j         åè¿ç®ï¼åèµå¼\n# echo $i\n2\n# echo $j\n2\n# echo $x\n1\n# echo $y\n2\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# åãæ©å±è¡¥å\n\n\n# 1. æ°ç»å®ä¹\n\n\n# 1ãæ°ç»åç±»\n\n * æ®éæ°ç»ï¼åªè½ä½¿ç¨æ´æ°ä½ä¸ºæ°ç»ç´¢å¼(åç´ çä¸æ )\n * å³èæ°ç»ï¼å¯ä»¥ä½¿ç¨å­ç¬¦ä¸²ä½ä¸ºæ°ç»ç´¢å¼(åç´ çä¸æ )\n\n\n# 2ã æ®éæ°ç»å®ä¹\n\n * ä¸æ¬¡èµäºä¸ä¸ªå¼\n\næ°ç»å[ç´¢å¼ä¸æ ]=å¼\narray[0]=v1\narray[1]=v2\narray[2]=v3\narray[3]=v4\n\n\n1\n2\n3\n4\n5\n\n * ä¸æ¬¡èµäºå¤ä¸ªå¼\n\næ°ç»å=(å¼1 å¼2 å¼3 ...)\narray=(var1 var2 var3 var4)\n\narray1=(`cat /etc/passwd`)            å°æä»¶ä¸­æ¯ä¸è¡èµå¼ç»array1æ°ç»\narray2=(`ls /root`)\narray3=(harry amy jack "miss hou")\narray4=(1 2 3 4 "hello world" [10]=linux)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 3ã æ°ç»çè¯»å\n\n${æ°ç»å[åç´ ä¸æ ]}\n\necho ${array[0]}            è·åæ°ç»éç¬¬ä¸ä¸ªåç´ \necho ${array[*]}            è·åæ°ç»éçææåç´ \necho ${#array[*]}            è·åæ°ç»éææåç´ ä¸ªæ°\necho ${!array[@]}            è·åæ°ç»åç´ çç´¢å¼ä¸æ \necho ${array[@]:1:2}        è®¿é®æå®çåç´ ï¼1ä»£è¡¨ä»ä¸æ ä¸º1çåç´ å¼å§è·åï¼2ä»£è¡¨è·ååé¢å ä¸ªåç´ \n\næ¥çæ®éæ°ç»ä¿¡æ¯ï¼\n# declare -a\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# 4ãå³èæ°ç»å®ä¹\n\n# 1ãé¦åå£°æå³èæ°ç»\n\ndeclare -a asso_array1\n\ndeclare -a asso_array1\ndeclare -a asso_array2\ndeclare -a asso_array3\n\n\n1\n2\n3\n\n\n# 2ãæ°ç»èµå¼\n\n * ä¸æ¬¡èµä¸ä¸ªå¼\n\næ°ç»å[ç´¢å¼orä¸æ ]=åéå¼\n# asso_array1[linux]=one\n# asso_array1[java]=two\n# asso_array1[php]=three\n\n\n1\n2\n3\n4\n\n * ä¸æ¬¡èµå¤ä¸ªå¼\n\n# asso_array2=([name1]=harry [name2]=jack [name3]=amy [name4]="miss hou")\n\n\n1\n\n * æ¥çå³èæ°ç»\n\n# declare -a\ndeclare -a asso_array1=\'([php]="three" [java]="two" [linux]="one" )\'\ndeclare -a asso_array2=\'([name3]="amy" [name2]="jack" [name1]="harry" [name4]="miss hou" )\'\n\n\n1\n2\n3\n\n * è·åå³èæ°ç»å¼\n\n# echo ${asso_array1[linux]}\none\n# echo ${asso_array1[php]}\nthree\n# echo ${asso_array1[*]}\nthree two one\n# echo ${!asso_array1[*]}\nphp java linux\n# echo ${#asso_array1[*]}\n3\n# echo ${#asso_array2[*]}\n4\n# echo ${!asso_array2[*]}\nname3 name2 name1 name4\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n * å¶ä»å®ä¹æ¹å¼\n\n# declare -a books\n# let books[linux]++\n# declare -a|grep books\ndeclare -a books=\'([linux]="1" )\'\n# let books[linux]++\n# declare -a|grep books\ndeclare -a books=\'([linux]="2" )\'\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# 2. å¶ä»åéå®ä¹\n\n * ååºä¸ä¸ªç®å½ä¸çç®å½åæä»¶ï¼dirnameå basename\n\n# a=/root/desktop/shell/mem.txt \n# echo $a\n/root/desktop/shell/mem.txt\n# dirname $a   ååºç®å½\n/root/desktop/shell\n# basename $a  ååºæä»¶\nmem.txt\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * -åé"åå®¹"çå é¤åæ¿æ¢\n\nä¸ä¸ªâ%âä»£è¡¨ä»å³å¾å·¦å é¤\nä¸¤ä¸ªâ%%âä»£è¡¨ä»å³å¾å·¦å»ææå¤\nä¸ä¸ªâ#âä»£è¡¨ä»å·¦å¾å³å»æå é¤\nä¸¤ä¸ªâ##âä»£è¡¨ä»å·¦å¾å³å»ææå¤\n\nä¸¾ä¾è¯´æï¼\n# url=www.taobao.com\n# echo ${#url}             è·ååéçé¿åº¦\n# echo ${url#*.}\n# echo ${url##*.}\n# echo ${url%.*}\n# echo ${url%%.*}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n * ä»¥ä¸äºè§£\n\næ¿æ¢ï¼/ å //\n 1015  echo ${url/ao/ao}  ç¨aoä»£æ¿aoï¼ä»å·¦å¾å³ç¬¬ä¸ä¸ªï¼\n 1017  echo ${url//ao/ao}   è´ªå©ªæ¿æ¢ï¼æ¿ä»£ææï¼\n\næ¿ä»£ï¼ - å :-  +å:+\n 1019  echo ${abc-123}\n 1020  abc=hello\n 1021  echo ${abc-444}\n 1022  echo $abc\n 1024  abc=\n 1025  echo ${abc-222}\n\n${åéå-æ°çåéå¼} æè ${åéå=æ°çåéå¼}\nåéæ²¡æè¢«èµå¼ï¼ä¼ä½¿ç¨âæ°çåéå¼â æ¿ä»£\nåéæè¢«èµå¼ï¼åæ¬ç©ºå¼ï¼ï¼ ä¸ä¼è¢«æ¿ä»£\n\n 1062  echo ${abc:-123}\n 1063  abc=hello\n 1064  echo ${abc:-123}\n 1065  abc=\n 1066  echo ${abc:-123}\n\n${åéå:-æ°çåéå¼} æè ${åéå:=æ°çåéå¼}\nåéæ²¡æè¢«èµå¼æèèµç©ºå¼ï¼ä¼ä½¿ç¨âæ°çåéå¼â æ¿ä»£\nåéæè¢«èµå¼ï¼ ä¸ä¼è¢«æ¿ä»£\n\n 1116  echo ${abc=123}\n 1118  echo ${abc:=123}\n\n# unset abc\n# echo ${abc:+123}\n\n# abc=hello\n# echo ${abc:+123}\n123\n# abc=\n# echo ${abc:+123}\n\n${åéå+æ°çåéå¼}\nåéæ²¡æè¢«èµå¼æèèµç©ºå¼ï¼ä¸ä¼ä½¿ç¨âæ°çåéå¼â æ¿ä»£\nåéæè¢«èµå¼ï¼ ä¼è¢«æ¿ä»£\n# unset abc\n# echo ${abc+123}\n\n# abc=hello\n# echo ${abc+123}\n123\n# abc=\n# echo ${abc+123}\n123\n${åéå:+æ°çåéå¼}\nåéæ²¡æè¢«èµå¼ï¼ä¸ä¼ä½¿ç¨âæ°çåéå¼â æ¿ä»£\nåéæè¢«èµå¼ï¼åæ¬ç©ºå¼ï¼ï¼ ä¼è¢«æ¿ä»£\n\n# unset abc\n# echo ${abc?123}\n-bash: abc: 123\n\n# abc=hello\n# echo ${abc?123}\nhello\n# abc=\n# echo ${abc?123}\n\n${åéå?æ°çåéå¼}\nåéæ²¡æè¢«èµå¼:æç¤ºéè¯¯ä¿¡æ¯\nåéè¢«èµå¼ï¼åæ¬ç©ºå¼ï¼ï¼ä¸ä¼ä½¿ç¨âæ°çåéå¼â æ¿ä»£\n\n# unset abc\n# echo ${abc:?123}\n-bash: abc: 123\n# abc=hello\n# echo ${abc:?123}\nhello\n# abc=\n# echo ${abc:?123}\n-bash: abc: 123\n\n${åéå:?æ°çåéå¼}\nåéæ²¡æè¢«èµå¼æèèµç©ºå¼æ¶:æç¤ºéè¯¯ä¿¡æ¯\nåéè¢«èµå¼ï¼ä¸ä¼ä½¿ç¨âæ°çåéå¼â æ¿ä»£\n\nè¯´æï¼?ä¸»è¦æ¯å½åéæ²¡æèµå¼æç¤ºéè¯¯ä¿¡æ¯çï¼æ²¡æèµå¼åè½\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n',charsets:{cjk:!0}},{title:"rsyncç¨æ³ååæ°è¯¦è§£",frontmatter:{title:"rsyncç¨æ³ååæ°è¯¦è§£",categories:["rsync"],tags:["rsync"],date:"2022-12-09T20:51:06.000Z",permalink:"/pages/98cac7/",feed:{enable:!0},description:"Logrotateå¥é¨äºè§£åçäº§å®è·µ",readingShow:"top",meta:[{name:"twitter:title",content:"rsyncç¨æ³ååæ°è¯¦è§£"},{name:"twitter:description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/01.rsync/01.rsync%E7%94%A8%E6%B3%95%E5%8F%8A%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3.html"},{property:"og:type",content:"article"},{property:"og:title",content:"rsyncç¨æ³ååæ°è¯¦è§£"},{property:"og:description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/01.rsync/01.rsync%E7%94%A8%E6%B3%95%E5%8F%8A%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:51:06.000Z"},{property:"article:tag",content:"rsync"},{itemprop:"name",content:"rsyncç¨æ³ååæ°è¯¦è§£"},{itemprop:"description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/01.linux/01.rsync/01.rsync%E7%94%A8%E6%B3%95%E5%8F%8A%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3.html",relativePath:"04.è¿ç»´/01.linux/01.rsync/01.rsyncç¨æ³ååæ°è¯¦è§£.md",key:"v-11090b27",path:"/pages/98cac7/",headers:[{level:2,title:"rsync",slug:"rsync",normalizedTitle:"rsync",charIndex:2}],headersStr:"rsync",content:'# rsync\n\nrsyncçç®çæ¯å®ç°æ¬å°ä¸»æºåè¿ç¨ä¸»æºä¸çæä»¶åæ­¥(åæ¬æ¬å°æ¨å°è¿ç¨ï¼è¿ç¨æå°æ¬å°ä¸¤ç§åæ­¥æ¹å¼)ï¼ä¹å¯ä»¥å®ç°æ¬å°ä¸åè·¯å¾ä¸æä»¶çåæ­¥ï¼ä½ä¸è½å®ç°è¿ç¨è·¯å¾1å°è¿ç¨è·¯å¾2ä¹é´çåæ­¥(scpå¯ä»¥å®ç°)ã\n\nä¸èèrsyncçå®ç°ç»èï¼å°±æä»¶åæ­¥èè¨ï¼æ¶åäºæºæä»¶åç®æ æä»¶çæ¦å¿µï¼è¿æ¶åäºä»¥åªè¾¹æä»¶ä¸ºåæ­¥åºåãä¾å¦ï¼æ³è®©ç®æ ä¸»æºä¸çæä»¶åæ¬å°æä»¶ä¿æåæ­¥ï¼åæ¯ä»¥æ¬å°æä»¶ä¸ºåæ­¥åºåï¼å°æ¬å°æä»¶ä½ä¸ºæºæä»¶æ¨éå°ç®æ ä¸»æºä¸ãåä¹ï¼å¦ææ³è®©æ¬å°ä¸»æºä¸çæä»¶åç®æ ä¸»æºä¸çæä»¶ä¿æåæ­¥ï¼åç®æ ä¸»æºä¸çæä»¶ä¸ºåæ­¥åºåï¼å®ç°æ¹å¼æ¯å°ç®æ ä¸»æºä¸çæä»¶ä½ä¸ºæºæä»¶æåå°æ¬å°ãå½ç¶ï¼è¦ä¿ææ¬å°çä¸¤ä¸ªæä»¶ç¸äºåæ­¥ï¼rsyncä¹ä¸æ ·è½å®ç°ï¼è¿å°±åLinuxä¸­cpå½ä»¤ä¸æ ·ï¼ä»¥æ¬å°ææä»¶ä½ä¸ºæºï¼å¦ä¸æä»¶ä½ä¸ºç®æ æä»¶ï¼ä½è¯·æ³¨æï¼è½ç¶rsyncåcpè½è¾¾å°ç¸åçç®çï¼ä½å®ä»¬çå®ç°æ¹å¼æ¯ä¸ä¸æ ·çã\n\næ¢ç¶æ¯æä»¶åæ­¥ï¼å¨åæ­¥è¿ç¨ä¸­å¿ç¶ä¼æ¶åå°æºåç®æ ä¸¤æä»¶ä¹é´çæ¬æ§å¶çé®é¢ï¼ä¾å¦æ¯å¦è¦å é¤æºä¸»æºä¸æ²¡æä½ç®æ ä¸å¤åºæ¥çæä»¶ï¼ç®æ æä»¶æ¯æºæä»¶æ´æ°(newer than source)æ¶æ¯å¦ä»è¦ä¿æåæ­¥ï¼éå°è½¯é¾æ¥æ¶æ¯æ·è´è½¯é¾æ¥æ¬èº«è¿æ¯æ·è´è½¯é¾æ¥ææåçæä»¶ï¼ç®æ æä»¶å·²å­å¨æ¶æ¯å¦è¦åå¯¹å¶åä¸ªå¤ä»½ç­ç­ã\n\nrsyncåæ­¥è¿ç¨ä¸­ç±ä¸¤é¨åæ¨¡å¼ç»æï¼å³å®åªäºæä»¶éè¦åæ­¥çæ£æ¥æ¨¡å¼ä»¥åæä»¶åæ­¥æ¶çåæ­¥æ¨¡å¼ã\n\n(1).æ£æ¥æ¨¡å¼æ¯ææç§æå®è§åæ¥æ£æ¥åªäºæä»¶éè¦è¢«åæ­¥ï¼ä¾å¦åªäºæä»¶æ¯æç¡®è¢«æé¤ä¸ä¼ è¾çã**é»è®¤æåµä¸ï¼rsyncä½¿ç¨"quick check"ç®æ³å¿«éæ£æ¥æºæä»¶åç®æ æä»¶çå¤§å°ãmtime(ä¿®æ¹æ¶é´)æ¯å¦ä¸è´ï¼å¦æä¸ä¸è´åéè¦ä¼ è¾ã**å½ç¶ï¼ä¹å¯ä»¥éè¿å¨rsyncå½ä»¤è¡ä¸­æå®æäºéé¡¹æ¥æ¹åquick checkçæ£æ¥æ¨¡å¼ï¼æ¯å¦"--size-only"éé¡¹è¡¨ç¤º"quick check"å°ä»æ£æ¥æä»¶å¤§å°ä¸åçæä»¶ä½ä¸ºå¾ä¼ è¾æä»¶ãrsyncæ¯æéå¸¸å¤çéé¡¹ï¼å¶ä¸­æ£æ¥æ¨¡å¼çèªå®ä¹æ§æ¯éå¸¸æå¼¹æ§çã\n\n(2).åæ­¥æ¨¡å¼æ¯æå¨æä»¶ç¡®å®è¦è¢«åæ­¥åï¼å¨åæ­¥è¿ç¨åçä¹åè¦ååªäºé¢å¤å·¥ä½ãä¾å¦ä¸ææè¯´çæ¯å¦è¦åå é¤æºä¸»æºä¸æ²¡æä½ç®æ ä¸»æºä¸æçæä»¶ï¼æ¯å¦è¦åå¤ä»½å·²å­å¨çç®æ æä»¶ï¼æ¯å¦è¦è¿½è¸ªé¾æ¥æä»¶ç­é¢å¤æä½ãrsyncä¹æä¾éå¸¸å¤çéé¡¹ä½¿å¾åæ­¥æ¨¡å¼åå¾æ´å·å¼¹æ§ã\n\nç¸å¯¹æ¥è¯´ï¼ä¸ºrsyncæå¨æå®åæ­¥æ¨¡å¼çéé¡¹æ´å¸¸è§ä¸äºï¼åªæå¨æç¹æ®éæ±æ¶ææå®æ£æ¥æ¨¡å¼ï¼å ä¸ºå¤§å¤æ°æ£æ¥æ¨¡å¼éé¡¹é½å¯è½ä¼å½±årsyncçæ§è½ã\n\nrsync çå½ä»¤æ ¼å¼ï¼ç¨æ³ï¼ä¸ºï¼\n\n1ï¼æ¬å°ä½¿ç¨ï¼\n\n\n\nrsync [OPTION...] SRC... [DEST]\n\n\n\n\n\n\n\n2ï¼éè¿è¿ç¨ Shell ä½¿ç¨ï¼\n\n\n\næ: rsync [OPTION...] [USER@]HOST:SRC... [DEST]\n\n\n\næ¨: rsync [OPTION...] SRC... [USER@]HOST:DEST\n\n\n\n\n\n\n\n3ï¼è®¿é® rsync æå¡å¨:\n\n\n\næ: rsync [OPTION...] [USER@]HOST::SRC... [DEST]\n\n\n\næ¨: rsync [OPTION...] SRC... [USER@]HOST::DEST\n\n\n\næ: rsync [OPTION...] rsync://[USER@]HOST[:PORT]/SRC... [DEST]\n\n\n\næ¨: rsync [OPTION...] SRC... rsync://[USER@]HOST[:PORT]/DEST\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\nå¶ä¸­ï¼\n\n * SRC: æ¯è¦å¤å¶çæºä½ç½®\n\n * DEST: æ¯å¤å¶ç®æ ä½ç½®\n\n * è¥æ¬å°ç»å½ç¨æ·ä¸è¿ç¨ä¸»æºä¸çç¨æ·ä¸è´ï¼å¯ä»¥çç¥ USER@\n\n * ä½¿ç¨è¿ç¨ shell åæ­¥æ¶ï¼ä¸»æºåä¸èµæºä¹é´ä½¿ç¨åä¸ªåå·â:âä½ä¸ºåéç¬¦\n\n * ä½¿ç¨ rsync æå¡å¨åæ­¥æ¶ï¼ä¸»æºåä¸èµæºä¹é´ä½¿ç¨ä¸¤ä¸ªåå·â::âä½ä¸ºåéç¬¦\n\n * å½è®¿é® rsync æå¡å¨æ¶ä¹å¯ä»¥ä½¿ç¨ rsync:// URL\n\n * âæâå¤å¶æ¯æä»è¿ç¨ä¸»æºå¤å¶æä»¶å°æ¬å°ä¸»æº\n\n * âæ¨âå¤å¶æ¯æä»æ¬å°ä¸»æºå¤å¶æä»¶å°è¿ç¨ä¸»æº\n\n * å½è¿è¡âæâå¤å¶æ¶ï¼è¥æå®ä¸ä¸ª SRC ä¸çç¥ DESTï¼ååªååºèµæºèä¸è¿è¡å¤å¶\n   \n   ä¸é¢ååºå¸¸ç¨éé¡¹ï¼\n   \n   éé¡¹                     è¯´æ\n   -a, ââarchive          å½æ¡£æ¨¡å¼ï¼è¡¨ç¤ºä»¥éå½æ¹å¼ä¼ è¾æä»¶ï¼å¹¶ä¿ææææä»¶å±æ§ï¼ç­ä»·äº -rlptgoD (æ³¨æä¸åæ¬ -H)\n   -r, âârecursive        å¯¹å­ç®å½ä»¥éå½æ¨¡å¼å¤ç\n   -l, ââlinks            ä¿æç¬¦å·é¾æ¥æä»¶\n   -H, ââhard-links       ä¿æç¡¬é¾æ¥æä»¶\n   -p, ââperms            ä¿ææä»¶æé\n   -t, ââtimes            ä¿ææä»¶æ¶é´ä¿¡æ¯\n   -g, ââgroup            ä¿ææä»¶å±ç»ä¿¡æ¯\n   -o, ââowner            ä¿ææä»¶å±ä¸»ä¿¡æ¯ (super-user only)\n   -D                     ä¿æè®¾å¤æä»¶åç¹æ®æä»¶ (super-user only)\n   -z, ââcompress         å¨ä¼ è¾æä»¶æ¶è¿è¡åç¼©å¤ç\n   ââexclude=PATTERN      æå®æé¤ä¸ä¸ªä¸éè¦ä¼ è¾çæä»¶å¹éæ¨¡å¼\n   ââexclude-from=FILE    ä» FILE ä¸­è¯»åæé¤è§å\n   ââinclude=PATTERN      æå®éè¦ä¼ è¾çæä»¶å¹éæ¨¡å¼\n   ââinclude-from=FILE    ä» FILE ä¸­è¯»ååå«è§å\n   ââcopy-unsafe-links    æ·è´æåSRCè·¯å¾ç®å½æ ä»¥å¤çé¾æ¥æä»¶\n   ââsafe-links           å¿½ç¥æåSRCè·¯å¾ç®å½æ ä»¥å¤çé¾æ¥æä»¶ï¼é»è®¤ï¼\n   ââexisting             ä»ä»æ´æ°é£äºå·²ç»å­å¨äºæ¥æ¶ç«¯çæä»¶ï¼èä¸å¤ä»½é£äºæ°åå»ºçæä»¶\n   ââignore-existing      å¿½ç¥é£äºå·²ç»å­å¨äºæ¥æ¶ç«¯çæä»¶ï¼ä»å¤ä»½é£äºæ°åå»ºçæä»¶\n   -b, ââbackup           å½æååæ¶ï¼å¯¹ç®æ ç®å½ä¸­çæ§çæä»¶è¿è¡å¤ä»½\n   ââbackup-dir=DIR       ä¸ -b ç»åä½¿ç¨ï¼å°å¤ä»½çæä»¶å­å° DIR ç®å½ä¸­\n   ââlink-dest=DIR        å½æä»¶æªæ¹åæ¶åºäº DIR åå»ºç¡¬é¾æ¥æä»¶\n   ââdelete               å é¤é£äºæ¥æ¶ç«¯è¿æèåéç«¯å·²ç»ä¸å­å¨çæä»¶\n   ââdelete-before        æ¥æ¶èå¨ä¼ è¾ä¹åè¿è¡å é¤æä½ (é»è®¤)\n   ââdelete-during        æ¥æ¶èå¨ä¼ è¾è¿ç¨ä¸­è¿è¡å é¤æä½\n   ââdelete-after         æ¥æ¶èå¨ä¼ è¾ä¹åè¿è¡å é¤æä½\n   ââdelete-excluded      å¨æ¥æ¶æ¹åæ¶å é¤è¢«æé¤çæä»¶\n   -e, âârsh=COMMAND      æå®æ¿ä»£ rsh ç shell ç¨åº\n   ââignore-errors        å³ä½¿åºç° I/O éè¯¯ä¹è¿è¡å é¤\n   ââpartial              ä¿çé£äºå ææ²¡æå®å¨ä¼ è¾çæä»¶ï¼ä»¥æ¯å å¿«éåçåæ¬¡ä¼ è¾\n   ââprogress             å¨ä¼ è¾æ¶æ¾ç¤ºä¼ è¾è¿ç¨\n   -P                     ç­ä»·äº ââpartial ââprogress\n   ââdelay-updates        å°æ­£å¨æ´æ°çæä»¶åä¿å­å°ä¸ä¸ªä¸´æ¶ç®å½ï¼é»è®¤ä¸º â.~tmp~âï¼ï¼å¾ä¼ è¾å®æ¯åæ´æ°ç®æ æä»¶\n   -v, ââverbose          è¯¦ç»è¾åºæ¨¡å¼\n   -q, ââquiet            ç²¾ç®è¾åºæ¨¡å¼\n   -h, ââhuman-readable   è¾åºæä»¶å¤§å°ä½¿ç¨æè¯»çåä½ï¼å¦ï¼Kï¼Mç­ï¼\n   -n, ââdry-run          æ¾ç¤ºåªäºæä»¶å°è¢«ä¼ è¾\n   ââlist-only            ä»ä»ååºæä»¶èä¸è¿è¡å¤å¶\n   âârsyncpath=PROGRAM    æå®è¿ç¨æå¡å¨ä¸ç rsync å½ä»¤æå¨è·¯å¾\n   ââpassword-file=FILE   ä» FILE ä¸­è¯»åå£ä»¤ï¼ä»¥é¿åå¨ç»ç«¯ä¸è¾å¥å£ä»¤ï¼éå¸¸å¨ cron ä¸­è¿æ¥ rsync æå¡å¨æ¶ä½¿ç¨\n   -4, ââipv4             ä½¿ç¨ IPv4\n   -6, ââipv6             ä½¿ç¨ IPv6\n   ââversion              æå°çæ¬ä¿¡æ¯\n   ââhelp                 æ¾ç¤ºå¸®å©ä¿¡æ¯\n\n * è¥ä½¿ç¨æ®éç¨æ·èº«ä»½è¿è¡ rsync å½ä»¤ï¼åæ­¥åçæä»¶çå±ä¸»å°æ¹åä¸ºè¿ä¸ªæ®éç¨æ·èº«ä»½ã\n\n * è¥ä½¿ç¨è¶çº§ç¨æ·èº«ä»½è¿è¡ rsync å½ä»¤ï¼åæ­¥åçæä»¶çå±ä¸»å°ä¿æåæ¥çç¨æ·èº«ä»½ã\n\næèªï¼\n\nhttps://www.cnblogs.com/noxy/p/8986164.html\n\nhttp://www.cnblogs.com/f-ck-need-u/p/7220009.html\n\nhttps://blog.csdn.net/woshiji594167/article/details/83860993',normalizedContent:'# rsync\n\nrsyncçç®çæ¯å®ç°æ¬å°ä¸»æºåè¿ç¨ä¸»æºä¸çæä»¶åæ­¥(åæ¬æ¬å°æ¨å°è¿ç¨ï¼è¿ç¨æå°æ¬å°ä¸¤ç§åæ­¥æ¹å¼)ï¼ä¹å¯ä»¥å®ç°æ¬å°ä¸åè·¯å¾ä¸æä»¶çåæ­¥ï¼ä½ä¸è½å®ç°è¿ç¨è·¯å¾1å°è¿ç¨è·¯å¾2ä¹é´çåæ­¥(scpå¯ä»¥å®ç°)ã\n\nä¸èèrsyncçå®ç°ç»èï¼å°±æä»¶åæ­¥èè¨ï¼æ¶åäºæºæä»¶åç®æ æä»¶çæ¦å¿µï¼è¿æ¶åäºä»¥åªè¾¹æä»¶ä¸ºåæ­¥åºåãä¾å¦ï¼æ³è®©ç®æ ä¸»æºä¸çæä»¶åæ¬å°æä»¶ä¿æåæ­¥ï¼åæ¯ä»¥æ¬å°æä»¶ä¸ºåæ­¥åºåï¼å°æ¬å°æä»¶ä½ä¸ºæºæä»¶æ¨éå°ç®æ ä¸»æºä¸ãåä¹ï¼å¦ææ³è®©æ¬å°ä¸»æºä¸çæä»¶åç®æ ä¸»æºä¸çæä»¶ä¿æåæ­¥ï¼åç®æ ä¸»æºä¸çæä»¶ä¸ºåæ­¥åºåï¼å®ç°æ¹å¼æ¯å°ç®æ ä¸»æºä¸çæä»¶ä½ä¸ºæºæä»¶æåå°æ¬å°ãå½ç¶ï¼è¦ä¿ææ¬å°çä¸¤ä¸ªæä»¶ç¸äºåæ­¥ï¼rsyncä¹ä¸æ ·è½å®ç°ï¼è¿å°±ålinuxä¸­cpå½ä»¤ä¸æ ·ï¼ä»¥æ¬å°ææä»¶ä½ä¸ºæºï¼å¦ä¸æä»¶ä½ä¸ºç®æ æä»¶ï¼ä½è¯·æ³¨æï¼è½ç¶rsyncåcpè½è¾¾å°ç¸åçç®çï¼ä½å®ä»¬çå®ç°æ¹å¼æ¯ä¸ä¸æ ·çã\n\næ¢ç¶æ¯æä»¶åæ­¥ï¼å¨åæ­¥è¿ç¨ä¸­å¿ç¶ä¼æ¶åå°æºåç®æ ä¸¤æä»¶ä¹é´çæ¬æ§å¶çé®é¢ï¼ä¾å¦æ¯å¦è¦å é¤æºä¸»æºä¸æ²¡æä½ç®æ ä¸å¤åºæ¥çæä»¶ï¼ç®æ æä»¶æ¯æºæä»¶æ´æ°(newer than source)æ¶æ¯å¦ä»è¦ä¿æåæ­¥ï¼éå°è½¯é¾æ¥æ¶æ¯æ·è´è½¯é¾æ¥æ¬èº«è¿æ¯æ·è´è½¯é¾æ¥ææåçæä»¶ï¼ç®æ æä»¶å·²å­å¨æ¶æ¯å¦è¦åå¯¹å¶åä¸ªå¤ä»½ç­ç­ã\n\nrsyncåæ­¥è¿ç¨ä¸­ç±ä¸¤é¨åæ¨¡å¼ç»æï¼å³å®åªäºæä»¶éè¦åæ­¥çæ£æ¥æ¨¡å¼ä»¥åæä»¶åæ­¥æ¶çåæ­¥æ¨¡å¼ã\n\n(1).æ£æ¥æ¨¡å¼æ¯ææç§æå®è§åæ¥æ£æ¥åªäºæä»¶éè¦è¢«åæ­¥ï¼ä¾å¦åªäºæä»¶æ¯æç¡®è¢«æé¤ä¸ä¼ è¾çã**é»è®¤æåµä¸ï¼rsyncä½¿ç¨"quick check"ç®æ³å¿«éæ£æ¥æºæä»¶åç®æ æä»¶çå¤§å°ãmtime(ä¿®æ¹æ¶é´)æ¯å¦ä¸è´ï¼å¦æä¸ä¸è´åéè¦ä¼ è¾ã**å½ç¶ï¼ä¹å¯ä»¥éè¿å¨rsyncå½ä»¤è¡ä¸­æå®æäºéé¡¹æ¥æ¹åquick checkçæ£æ¥æ¨¡å¼ï¼æ¯å¦"--size-only"éé¡¹è¡¨ç¤º"quick check"å°ä»æ£æ¥æä»¶å¤§å°ä¸åçæä»¶ä½ä¸ºå¾ä¼ è¾æä»¶ãrsyncæ¯æéå¸¸å¤çéé¡¹ï¼å¶ä¸­æ£æ¥æ¨¡å¼çèªå®ä¹æ§æ¯éå¸¸æå¼¹æ§çã\n\n(2).åæ­¥æ¨¡å¼æ¯æå¨æä»¶ç¡®å®è¦è¢«åæ­¥åï¼å¨åæ­¥è¿ç¨åçä¹åè¦ååªäºé¢å¤å·¥ä½ãä¾å¦ä¸ææè¯´çæ¯å¦è¦åå é¤æºä¸»æºä¸æ²¡æä½ç®æ ä¸»æºä¸æçæä»¶ï¼æ¯å¦è¦åå¤ä»½å·²å­å¨çç®æ æä»¶ï¼æ¯å¦è¦è¿½è¸ªé¾æ¥æä»¶ç­é¢å¤æä½ãrsyncä¹æä¾éå¸¸å¤çéé¡¹ä½¿å¾åæ­¥æ¨¡å¼åå¾æ´å·å¼¹æ§ã\n\nç¸å¯¹æ¥è¯´ï¼ä¸ºrsyncæå¨æå®åæ­¥æ¨¡å¼çéé¡¹æ´å¸¸è§ä¸äºï¼åªæå¨æç¹æ®éæ±æ¶ææå®æ£æ¥æ¨¡å¼ï¼å ä¸ºå¤§å¤æ°æ£æ¥æ¨¡å¼éé¡¹é½å¯è½ä¼å½±årsyncçæ§è½ã\n\nrsync çå½ä»¤æ ¼å¼ï¼ç¨æ³ï¼ä¸ºï¼\n\n1ï¼æ¬å°ä½¿ç¨ï¼\n\n\n\nrsync [option...] src... [dest]\n\n\n\n\n\n\n\n2ï¼éè¿è¿ç¨ shell ä½¿ç¨ï¼\n\n\n\næ: rsync [option...] [user@]host:src... [dest]\n\n\n\næ¨: rsync [option...] src... [user@]host:dest\n\n\n\n\n\n\n\n3ï¼è®¿é® rsync æå¡å¨:\n\n\n\næ: rsync [option...] [user@]host::src... [dest]\n\n\n\næ¨: rsync [option...] src... [user@]host::dest\n\n\n\næ: rsync [option...] rsync://[user@]host[:port]/src... [dest]\n\n\n\næ¨: rsync [option...] src... rsync://[user@]host[:port]/dest\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\nå¶ä¸­ï¼\n\n * src: æ¯è¦å¤å¶çæºä½ç½®\n\n * dest: æ¯å¤å¶ç®æ ä½ç½®\n\n * è¥æ¬å°ç»å½ç¨æ·ä¸è¿ç¨ä¸»æºä¸çç¨æ·ä¸è´ï¼å¯ä»¥çç¥ user@\n\n * ä½¿ç¨è¿ç¨ shell åæ­¥æ¶ï¼ä¸»æºåä¸èµæºä¹é´ä½¿ç¨åä¸ªåå·â:âä½ä¸ºåéç¬¦\n\n * ä½¿ç¨ rsync æå¡å¨åæ­¥æ¶ï¼ä¸»æºåä¸èµæºä¹é´ä½¿ç¨ä¸¤ä¸ªåå·â::âä½ä¸ºåéç¬¦\n\n * å½è®¿é® rsync æå¡å¨æ¶ä¹å¯ä»¥ä½¿ç¨ rsync:// url\n\n * âæâå¤å¶æ¯æä»è¿ç¨ä¸»æºå¤å¶æä»¶å°æ¬å°ä¸»æº\n\n * âæ¨âå¤å¶æ¯æä»æ¬å°ä¸»æºå¤å¶æä»¶å°è¿ç¨ä¸»æº\n\n * å½è¿è¡âæâå¤å¶æ¶ï¼è¥æå®ä¸ä¸ª src ä¸çç¥ destï¼ååªååºèµæºèä¸è¿è¡å¤å¶\n   \n   ä¸é¢ååºå¸¸ç¨éé¡¹ï¼\n   \n   éé¡¹                     è¯´æ\n   -a, ââarchive          å½æ¡£æ¨¡å¼ï¼è¡¨ç¤ºä»¥éå½æ¹å¼ä¼ è¾æä»¶ï¼å¹¶ä¿ææææä»¶å±æ§ï¼ç­ä»·äº -rlptgod (æ³¨æä¸åæ¬ -h)\n   -r, âârecursive        å¯¹å­ç®å½ä»¥éå½æ¨¡å¼å¤ç\n   -l, ââlinks            ä¿æç¬¦å·é¾æ¥æä»¶\n   -h, ââhard-links       ä¿æç¡¬é¾æ¥æä»¶\n   -p, ââperms            ä¿ææä»¶æé\n   -t, ââtimes            ä¿ææä»¶æ¶é´ä¿¡æ¯\n   -g, ââgroup            ä¿ææä»¶å±ç»ä¿¡æ¯\n   -o, ââowner            ä¿ææä»¶å±ä¸»ä¿¡æ¯ (super-user only)\n   -d                     ä¿æè®¾å¤æä»¶åç¹æ®æä»¶ (super-user only)\n   -z, ââcompress         å¨ä¼ è¾æä»¶æ¶è¿è¡åç¼©å¤ç\n   ââexclude=pattern      æå®æé¤ä¸ä¸ªä¸éè¦ä¼ è¾çæä»¶å¹éæ¨¡å¼\n   ââexclude-from=file    ä» file ä¸­è¯»åæé¤è§å\n   ââinclude=pattern      æå®éè¦ä¼ è¾çæä»¶å¹éæ¨¡å¼\n   ââinclude-from=file    ä» file ä¸­è¯»ååå«è§å\n   ââcopy-unsafe-links    æ·è´æåsrcè·¯å¾ç®å½æ ä»¥å¤çé¾æ¥æä»¶\n   ââsafe-links           å¿½ç¥æåsrcè·¯å¾ç®å½æ ä»¥å¤çé¾æ¥æä»¶ï¼é»è®¤ï¼\n   ââexisting             ä»ä»æ´æ°é£äºå·²ç»å­å¨äºæ¥æ¶ç«¯çæä»¶ï¼èä¸å¤ä»½é£äºæ°åå»ºçæä»¶\n   ââignore-existing      å¿½ç¥é£äºå·²ç»å­å¨äºæ¥æ¶ç«¯çæä»¶ï¼ä»å¤ä»½é£äºæ°åå»ºçæä»¶\n   -b, ââbackup           å½æååæ¶ï¼å¯¹ç®æ ç®å½ä¸­çæ§çæä»¶è¿è¡å¤ä»½\n   ââbackup-dir=dir       ä¸ -b ç»åä½¿ç¨ï¼å°å¤ä»½çæä»¶å­å° dir ç®å½ä¸­\n   ââlink-dest=dir        å½æä»¶æªæ¹åæ¶åºäº dir åå»ºç¡¬é¾æ¥æä»¶\n   ââdelete               å é¤é£äºæ¥æ¶ç«¯è¿æèåéç«¯å·²ç»ä¸å­å¨çæä»¶\n   ââdelete-before        æ¥æ¶èå¨ä¼ è¾ä¹åè¿è¡å é¤æä½ (é»è®¤)\n   ââdelete-during        æ¥æ¶èå¨ä¼ è¾è¿ç¨ä¸­è¿è¡å é¤æä½\n   ââdelete-after         æ¥æ¶èå¨ä¼ è¾ä¹åè¿è¡å é¤æä½\n   ââdelete-excluded      å¨æ¥æ¶æ¹åæ¶å é¤è¢«æé¤çæä»¶\n   -e, âârsh=command      æå®æ¿ä»£ rsh ç shell ç¨åº\n   ââignore-errors        å³ä½¿åºç° i/o éè¯¯ä¹è¿è¡å é¤\n   ââpartial              ä¿çé£äºå ææ²¡æå®å¨ä¼ è¾çæä»¶ï¼ä»¥æ¯å å¿«éåçåæ¬¡ä¼ è¾\n   ââprogress             å¨ä¼ è¾æ¶æ¾ç¤ºä¼ è¾è¿ç¨\n   -p                     ç­ä»·äº ââpartial ââprogress\n   ââdelay-updates        å°æ­£å¨æ´æ°çæä»¶åä¿å­å°ä¸ä¸ªä¸´æ¶ç®å½ï¼é»è®¤ä¸º â.~tmp~âï¼ï¼å¾ä¼ è¾å®æ¯åæ´æ°ç®æ æä»¶\n   -v, ââverbose          è¯¦ç»è¾åºæ¨¡å¼\n   -q, ââquiet            ç²¾ç®è¾åºæ¨¡å¼\n   -h, ââhuman-readable   è¾åºæä»¶å¤§å°ä½¿ç¨æè¯»çåä½ï¼å¦ï¼kï¼mç­ï¼\n   -n, ââdry-run          æ¾ç¤ºåªäºæä»¶å°è¢«ä¼ è¾\n   ââlist-only            ä»ä»ååºæä»¶èä¸è¿è¡å¤å¶\n   âârsyncpath=program    æå®è¿ç¨æå¡å¨ä¸ç rsync å½ä»¤æå¨è·¯å¾\n   ââpassword-file=file   ä» file ä¸­è¯»åå£ä»¤ï¼ä»¥é¿åå¨ç»ç«¯ä¸è¾å¥å£ä»¤ï¼éå¸¸å¨ cron ä¸­è¿æ¥ rsync æå¡å¨æ¶ä½¿ç¨\n   -4, ââipv4             ä½¿ç¨ ipv4\n   -6, ââipv6             ä½¿ç¨ ipv6\n   ââversion              æå°çæ¬ä¿¡æ¯\n   ââhelp                 æ¾ç¤ºå¸®å©ä¿¡æ¯\n\n * è¥ä½¿ç¨æ®éç¨æ·èº«ä»½è¿è¡ rsync å½ä»¤ï¼åæ­¥åçæä»¶çå±ä¸»å°æ¹åä¸ºè¿ä¸ªæ®éç¨æ·èº«ä»½ã\n\n * è¥ä½¿ç¨è¶çº§ç¨æ·èº«ä»½è¿è¡ rsync å½ä»¤ï¼åæ­¥åçæä»¶çå±ä¸»å°ä¿æåæ¥çç¨æ·èº«ä»½ã\n\næèªï¼\n\nhttps://www.cnblogs.com/noxy/p/8986164.html\n\nhttp://www.cnblogs.com/f-ck-need-u/p/7220009.html\n\nhttps://blog.csdn.net/woshiji594167/article/details/83860993',charsets:{cjk:!0}},{title:"rsyncæå¡å®ç°æ¨éï¼æå",frontmatter:{title:"rsyncæå¡å®ç°æ¨éï¼æå",categories:["rsync"],tags:["rsync"],date:"2022-12-09T20:51:06.000Z",permalink:"/pages/c7f1bc/",feed:{enable:!0},description:"Logrotateå¥é¨äºè§£åçäº§å®è·µ",readingShow:"top",meta:[{name:"image",content:"http://s3.51cto.com/wyfs02/M02/8A/01/wKioL1gkBdaDE-dQAAAE5R3eKYo767.png"},{name:"twitter:title",content:"rsyncæå¡å®ç°æ¨éï¼æå"},{name:"twitter:description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://s3.51cto.com/wyfs02/M02/8A/01/wKioL1gkBdaDE-dQAAAE5R3eKYo767.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/01.rsync/02.rsync%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E6%8E%A8%E9%80%81%EF%BC%8C%E6%8B%89%E5%8F%96.html"},{property:"og:type",content:"article"},{property:"og:title",content:"rsyncæå¡å®ç°æ¨éï¼æå"},{property:"og:description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{property:"og:image",content:"http://s3.51cto.com/wyfs02/M02/8A/01/wKioL1gkBdaDE-dQAAAE5R3eKYo767.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/01.rsync/02.rsync%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E6%8E%A8%E9%80%81%EF%BC%8C%E6%8B%89%E5%8F%96.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:51:06.000Z"},{property:"article:tag",content:"rsync"},{itemprop:"name",content:"rsyncæå¡å®ç°æ¨éï¼æå"},{itemprop:"description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{itemprop:"image",content:"http://s3.51cto.com/wyfs02/M02/8A/01/wKioL1gkBdaDE-dQAAAE5R3eKYo767.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/01.linux/01.rsync/02.rsync%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E6%8E%A8%E9%80%81%EF%BC%8C%E6%8B%89%E5%8F%96.html",relativePath:"04.è¿ç»´/01.linux/01.rsync/02.rsyncæå¡å®ç°æ¨éï¼æå.md",key:"v-2f584880",path:"/pages/c7f1bc/",headersStr:null,content:'# rsyncæå¡å®ç°æ¨éï¼æå\n\nhttps://www.csdn.net/tags/OtTacg3sMzk5Mi1ibG9n.html\n\n1.ç®ä»\n\nrsyncæ¯ä¸æ¬¾è¿ç¨æ°æ®åæ­¥å·¥å·ï¼ä¸ä¸ªRsync serverè½å¤åæ¶å¤ä»½å¤ä¸ªå®¢æ·ç«¯æ°æ®ï¼éè¦scpï¼sshï¼daemonçæ¯æï¼é»è®¤ç«¯å£ä¸º873ã\n\nrsync + crond å¯ä»¥å®ç°æ°æ®å®æ¶åæ­¥ï¼rsync + inotifyå¯ä»¥å®ç°æ°æ®çå®æ¶åæ­¥ã\n\nå·¥ä½ä¸­çRsyncæå¡æå¥½ä»¥åªè¯»æ¹å¼æä¾è¦å¤ä»½çæ°æ®ï¼é¿åé æè¯¯æä½ã\n\n*2.å®éªç¯å¢ä»ç»*\n\nä¸¤å°CentOS6.3 x64 æµè¯æºï¼ä¸å°serverï¼ä¸å°clientãç³»ç»å·²ç»é»è®¤å®è£äºrsyncè½¯ä»¶ã\n\n\n\n*3.Rsyncå½ä»¤æ ¼å¼åå½ä»¤åæ°*\n\n\n\nåæ°ä»ç»ï¼\n\n-a å½æ¡£æ¨¡å¼ï¼è¡¨ç¤ºä»¥å½æ¡£æ¹å¼ä¼ è¾æä»¶ï¼å¹¶ä¿ææææä»¶å±æ§\n\n-v è¯¦ç»æ¨¡å¼è¾åº\n\n-z å¯¹å¤ä»½çæä»¶å¨ä¼ è¾æ¶è¿è¡åç¼©å¤ç\n\n--delete æ å·®å¼åæ­¥\n\n*4.Rsyncçä¸ç§å·¥ä½æ¨¡å¼*\n\n1ï¼æ¬å°çæ·è´åå é¤\n\n# rsync avz /etc/hosts /tmp å°æä»¶hostsæ·è´å°/tmpç®å½ä¸­ãä¸cpå½ä»¤ç¸ä¼¼ï¼ä½åºå«å¨rsyncå¯ä»¥èªå·±æ¯è¾ä¸¤ä¸ªæä»¶ï¼å®ç°å¢éå¤ä»½\n\n\n\n# rsync avz delete /tmp/ /opt/ /tmp/ç®å½ä¸ºç©ºï¼å ä¸ --deleteåæ°ï¼ç¸å½äº rm å½ä»¤\n\n--deleteå¯ä»¥çè§£ä¸ºï¼æ¬å°æè¿ç«¯æï¼æ¬å°æ²¡æå é¤è¿ç«¯æç\n\n\n\n2ï¼remote shell\n\nrsyncè¿ç¨"æ¨"å"æ"\n\nï¼æ¨ï¼# rsync avzP e \'ssh p 22\' /tmp/ root@192.168.87.138:/tmp/aaa\n\nææ¬å°ç /tmp/ ç®å½ä¸­çæä»¶å¤å¶å°192.168.87.138ç /tmp/aaa ç®å½ä¸ï¼éè¿22ç«¯å£\n\n\n\nï¼æï¼# rsync avzP e \'ssh p 22\' root@192.168.87.138:/tmp/ /tmp\n\næ192.168.87.138ç /tmp/ ç®å½æä»¶å¤å¶å°æ¬å°ç /tmp ç®å½ä¸­\n\n\n\n# rsync -avzP -e \'ssh -p 22\' /tmp*/* root@192.168.87.133:/tmp\n\n# rsync -avzP -e \'ssh -p 22\' root@192.168.87.133:/tmp*/* /tmp\n\næ çº¢çææ ï¼æè¿ä¸ªå°±æ¯æ¨éæå®æä»¶å¤¹çå¨é¨åå®¹ï¼æ²¡æè¿ä¸ªå°±æ¯æ¨éæ´ä¸ªç®å½\n\n3ï¼daemon ï¼éç½®Rsyncæå¡ç«¯æ­¥éª¤ï¼\n\né¦åç¡®è®¤ç³»ç»ä¸­å®è£äºrsyncçæ¬åå¶çæ¬å·\n\n# rsync --versionæ¥çå½årsyncçæ¬\n\n# rpm qa rsync\n\n\n\nrsyncçéç½®æä»¶é»è®¤ä¸å­å¨ï¼éè¦æå·¥åå»ºãè·¯å¾ä¸º /etc/rsyncd.conf\n\nç¼è¾ /etc/rsyncd.conf æä»¶ï¼åå®¹å¦ä¸ãå¤å¶ç²è´´ä¿å­éåºå³å¯ã\n\n\n\n#Rsync server\n\n#yuci\n\nuid = rsync\n\ngid = rsync\n\nuse chroot = no\n\nmax connections = 2000\n\ntimeout = 600\n\npid file = /var/run/rsyncd.pid\n\nlock file = /var/run/rsync.lock\n\nlog file = /var/log/rsyncd.log\n\nignore errors\n\nread only = false\n\nlist = false\n\nhosts allow = 192.168.0.0/24\n\nhosts deny = 0.0.0.0/32\n\nauth users = rsync_backup\n\nsecrets file = /etc/rsync.password\n\n###################################\n\n[backup]\n\ncomment = www by yuci\n\npath = /backup\n\nåå»ºrsyncç¨æ·åå±äº«çç®å½ /backupï¼åå»ºå®åæ£æ¥ä¸ä¸ï¼å»æå¥½ä¹ æ¯ï¼\n\n\n\nå¦ä¸ç¼è¾çæä»¶ï¼secrets file = /etc/rsync.password ä¸ºå¯ç æä»¶ï¼å¯ä»¥å®ç°ä¸¤å°æºå¨äºä¿¡ãå ä¸ºæ¯å¯ç æä»¥éè¦æ´æ¹æéã\n\nrsync_backup æ¯ä¸é¢éç½®æä»¶ç auth users = rsync_backup "123456"ä¸ºè¿æ¥æ¶éè¦éªè¯çå¯ç \n\n\n\n# rsync --daemon å¯å¨rsyncæå¡\n\n# netstat lntup | grep rsync æ¥çrsyncæ¯å¦æ­£å¸¸è¿è¡å¨873ç«¯å£\n\n# ps ef | grep rsync\n\n# echo "rsync --daemon" >> /etc/rc.local å å¥å¼æºèªå¯å¨\n\n# cat /etc/rc.local\n\n\n\n\n\n\n\nå°æ­¤ä¸ºæ­¢ï¼æå¡å¨ç«¯çéç½®å·²ç»å®æãæ¥ä¸æ¥éç½®å®¢æ·ç«¯\n\n# echo "123456" >> /etc/rsync.password\n\nåªéè¦å¯ç å³å¯ï¼å ä¸ºå¨è¿æ¥å½ä»¤ä¸­å·²ç»æäº rsync_backupç¨æ·\n\n# chmod 600 /etc/rsync.password\n\nè·æå¡å¨çå¯ç æä»¶ç¸åï¼éè¦ä¿®æ¹æé\n\n\n\nå®¢æ·ç«¯åªéè¦è¿ç®åçä¸¤æ­¥å°±å¯ä»¥äºã\n\n*5.æµè¯ç¯å¢æ­å»ºæ¯å¦æå*\n\nç°å¨è¦å°å®¢æ·ç«¯ç /tmp/ ç®å½ä¸­çæä»¶ï¼æ¨éå°æå¡ç«¯ç /backup ç®å½ä¸­ï¼å° /backup ç®å½æ¸ç©ºï¼å¨ /tmp/ ç®å½ä¸­éä¾¿åå»ºå ä¸ªæä»¶\n\næ²¡ææ¥éæ¨éæåï¼ä¸å¾éä¸­çbackupæ¯è¦å¯¹åº /etc/rsyncd.conf ä¸­çæ¨¡åå½ä»¤\n\n\n\nä¸ä¸å¾ç ::backup å¯¹åº\n\n\n\nåå°æå¡å¨ç«¯æ£æ¥ï¼æµè¯æå\n\n\n\næ¬æè½¬èª mlwzby 51CTOåå®¢ï¼åæé¾æ¥:http://blog.51cto.com/aby028/1871433',normalizedContent:'# rsyncæå¡å®ç°æ¨éï¼æå\n\nhttps://www.csdn.net/tags/ottacg3smzk5mi1ibg9n.html\n\n1.ç®ä»\n\nrsyncæ¯ä¸æ¬¾è¿ç¨æ°æ®åæ­¥å·¥å·ï¼ä¸ä¸ªrsync serverè½å¤åæ¶å¤ä»½å¤ä¸ªå®¢æ·ç«¯æ°æ®ï¼éè¦scpï¼sshï¼daemonçæ¯æï¼é»è®¤ç«¯å£ä¸º873ã\n\nrsync + crond å¯ä»¥å®ç°æ°æ®å®æ¶åæ­¥ï¼rsync + inotifyå¯ä»¥å®ç°æ°æ®çå®æ¶åæ­¥ã\n\nå·¥ä½ä¸­çrsyncæå¡æå¥½ä»¥åªè¯»æ¹å¼æä¾è¦å¤ä»½çæ°æ®ï¼é¿åé æè¯¯æä½ã\n\n*2.å®éªç¯å¢ä»ç»*\n\nä¸¤å°centos6.3 x64 æµè¯æºï¼ä¸å°serverï¼ä¸å°clientãç³»ç»å·²ç»é»è®¤å®è£äºrsyncè½¯ä»¶ã\n\n\n\n*3.rsyncå½ä»¤æ ¼å¼åå½ä»¤åæ°*\n\n\n\nåæ°ä»ç»ï¼\n\n-a å½æ¡£æ¨¡å¼ï¼è¡¨ç¤ºä»¥å½æ¡£æ¹å¼ä¼ è¾æä»¶ï¼å¹¶ä¿ææææä»¶å±æ§\n\n-v è¯¦ç»æ¨¡å¼è¾åº\n\n-z å¯¹å¤ä»½çæä»¶å¨ä¼ è¾æ¶è¿è¡åç¼©å¤ç\n\n--delete æ å·®å¼åæ­¥\n\n*4.rsyncçä¸ç§å·¥ä½æ¨¡å¼*\n\n1ï¼æ¬å°çæ·è´åå é¤\n\n# rsync avz /etc/hosts /tmp å°æä»¶hostsæ·è´å°/tmpç®å½ä¸­ãä¸cpå½ä»¤ç¸ä¼¼ï¼ä½åºå«å¨rsyncå¯ä»¥èªå·±æ¯è¾ä¸¤ä¸ªæä»¶ï¼å®ç°å¢éå¤ä»½\n\n\n\n# rsync avz delete /tmp/ /opt/ /tmp/ç®å½ä¸ºç©ºï¼å ä¸ --deleteåæ°ï¼ç¸å½äº rm å½ä»¤\n\n--deleteå¯ä»¥çè§£ä¸ºï¼æ¬å°æè¿ç«¯æï¼æ¬å°æ²¡æå é¤è¿ç«¯æç\n\n\n\n2ï¼remote shell\n\nrsyncè¿ç¨"æ¨"å"æ"\n\nï¼æ¨ï¼# rsync avzp e \'ssh p 22\' /tmp/ root@192.168.87.138:/tmp/aaa\n\nææ¬å°ç /tmp/ ç®å½ä¸­çæä»¶å¤å¶å°192.168.87.138ç /tmp/aaa ç®å½ä¸ï¼éè¿22ç«¯å£\n\n\n\nï¼æï¼# rsync avzp e \'ssh p 22\' root@192.168.87.138:/tmp/ /tmp\n\næ192.168.87.138ç /tmp/ ç®å½æä»¶å¤å¶å°æ¬å°ç /tmp ç®å½ä¸­\n\n\n\n# rsync -avzp -e \'ssh -p 22\' /tmp*/* root@192.168.87.133:/tmp\n\n# rsync -avzp -e \'ssh -p 22\' root@192.168.87.133:/tmp*/* /tmp\n\næ çº¢çææ ï¼æè¿ä¸ªå°±æ¯æ¨éæå®æä»¶å¤¹çå¨é¨åå®¹ï¼æ²¡æè¿ä¸ªå°±æ¯æ¨éæ´ä¸ªç®å½\n\n3ï¼daemon ï¼éç½®rsyncæå¡ç«¯æ­¥éª¤ï¼\n\né¦åç¡®è®¤ç³»ç»ä¸­å®è£äºrsyncçæ¬åå¶çæ¬å·\n\n# rsync --versionæ¥çå½årsyncçæ¬\n\n# rpm qa rsync\n\n\n\nrsyncçéç½®æä»¶é»è®¤ä¸å­å¨ï¼éè¦æå·¥åå»ºãè·¯å¾ä¸º /etc/rsyncd.conf\n\nç¼è¾ /etc/rsyncd.conf æä»¶ï¼åå®¹å¦ä¸ãå¤å¶ç²è´´ä¿å­éåºå³å¯ã\n\n\n\n#rsync server\n\n#yuci\n\nuid = rsync\n\ngid = rsync\n\nuse chroot = no\n\nmax connections = 2000\n\ntimeout = 600\n\npid file = /var/run/rsyncd.pid\n\nlock file = /var/run/rsync.lock\n\nlog file = /var/log/rsyncd.log\n\nignore errors\n\nread only = false\n\nlist = false\n\nhosts allow = 192.168.0.0/24\n\nhosts deny = 0.0.0.0/32\n\nauth users = rsync_backup\n\nsecrets file = /etc/rsync.password\n\n###################################\n\n[backup]\n\ncomment = www by yuci\n\npath = /backup\n\nåå»ºrsyncç¨æ·åå±äº«çç®å½ /backupï¼åå»ºå®åæ£æ¥ä¸ä¸ï¼å»æå¥½ä¹ æ¯ï¼\n\n\n\nå¦ä¸ç¼è¾çæä»¶ï¼secrets file = /etc/rsync.password ä¸ºå¯ç æä»¶ï¼å¯ä»¥å®ç°ä¸¤å°æºå¨äºä¿¡ãå ä¸ºæ¯å¯ç æä»¥éè¦æ´æ¹æéã\n\nrsync_backup æ¯ä¸é¢éç½®æä»¶ç auth users = rsync_backup "123456"ä¸ºè¿æ¥æ¶éè¦éªè¯çå¯ç \n\n\n\n# rsync --daemon å¯å¨rsyncæå¡\n\n# netstat lntup | grep rsync æ¥çrsyncæ¯å¦æ­£å¸¸è¿è¡å¨873ç«¯å£\n\n# ps ef | grep rsync\n\n# echo "rsync --daemon" >> /etc/rc.local å å¥å¼æºèªå¯å¨\n\n# cat /etc/rc.local\n\n\n\n\n\n\n\nå°æ­¤ä¸ºæ­¢ï¼æå¡å¨ç«¯çéç½®å·²ç»å®æãæ¥ä¸æ¥éç½®å®¢æ·ç«¯\n\n# echo "123456" >> /etc/rsync.password\n\nåªéè¦å¯ç å³å¯ï¼å ä¸ºå¨è¿æ¥å½ä»¤ä¸­å·²ç»æäº rsync_backupç¨æ·\n\n# chmod 600 /etc/rsync.password\n\nè·æå¡å¨çå¯ç æä»¶ç¸åï¼éè¦ä¿®æ¹æé\n\n\n\nå®¢æ·ç«¯åªéè¦è¿ç®åçä¸¤æ­¥å°±å¯ä»¥äºã\n\n*5.æµè¯ç¯å¢æ­å»ºæ¯å¦æå*\n\nç°å¨è¦å°å®¢æ·ç«¯ç /tmp/ ç®å½ä¸­çæä»¶ï¼æ¨éå°æå¡ç«¯ç /backup ç®å½ä¸­ï¼å° /backup ç®å½æ¸ç©ºï¼å¨ /tmp/ ç®å½ä¸­éä¾¿åå»ºå ä¸ªæä»¶\n\næ²¡ææ¥éæ¨éæåï¼ä¸å¾éä¸­çbackupæ¯è¦å¯¹åº /etc/rsyncd.conf ä¸­çæ¨¡åå½ä»¤\n\n\n\nä¸ä¸å¾ç ::backup å¯¹åº\n\n\n\nåå°æå¡å¨ç«¯æ£æ¥ï¼æµè¯æå\n\n\n\næ¬æè½¬èª mlwzby 51ctoåå®¢ï¼åæé¾æ¥:http://blog.51cto.com/aby028/1871433',charsets:{cjk:!0}},{title:"centos7æ­å»ºdns,bindéç½®",frontmatter:{title:"centos7æ­å»ºdns,bindéç½®",date:"2022-12-15T19:18:37.000Z",permalink:"/pages/78c801/",categories:["è¿ç»´","dns"],tags:[null],feed:{enable:!0},description:"Logrotateå¥é¨äºè§£åçäº§å®è·µ",readingShow:"top",meta:[{name:"image",content:"http://pic.zzppjj.top/LightPicture/2023/01/c61083c823f2ed94.png"},{name:"twitter:title",content:"centos7æ­å»ºdns,bindéç½®"},{name:"twitter:description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://pic.zzppjj.top/LightPicture/2023/01/c61083c823f2ed94.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/02.dns/01.centos7%E6%90%AD%E5%BB%BAdns,bind%E9%85%8D%E7%BD%AE.html"},{property:"og:type",content:"article"},{property:"og:title",content:"centos7æ­å»ºdns,bindéç½®"},{property:"og:description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{property:"og:image",content:"http://pic.zzppjj.top/LightPicture/2023/01/c61083c823f2ed94.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/02.dns/01.centos7%E6%90%AD%E5%BB%BAdns,bind%E9%85%8D%E7%BD%AE.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T19:18:37.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"centos7æ­å»ºdns,bindéç½®"},{itemprop:"description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{itemprop:"image",content:"http://pic.zzppjj.top/LightPicture/2023/01/c61083c823f2ed94.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/01.linux/02.dns/01.centos7%E6%90%AD%E5%BB%BAdns,bind%E9%85%8D%E7%BD%AE.html",relativePath:"04.è¿ç»´/01.linux/02.dns/01.centos7æ­å»ºdns,bindéç½®.md",key:"v-52cf205e",path:"/pages/78c801/",headersStr:null,content:'è½ç¶å¯ä»¥ä¿®æ¹æä½ç³»ç»ä¸çhostsæä»¶å«ædnsè§£æï¼ä½æ¯å¦æå¨å¤å°è®¡ç®æºä¹é´æµè¯ï¼å°±å¾ä¸è¡è¡çå¤å¶å°å¤ä¸ªè®¡ç®æºä¸­ãæ´æçèï¼å¦ææµè¯æ¥å£å°åæ¯æµè¯ååï¼å¨æªè¶ç±çiphoneä¸­å°±æ²¡åæ³æµè¯äºï¼æªè¶ç±çiphoneä¿®æ¹ä¸äºhostsãèä¸hostsåªæ¯æAè®°å½ï¼æ²¡åæ³è®¾ç½®MXï¼PTRï¼CNAMEâ¦â¦æ­å»ºä¸ä¸ªdnsæå¡å¨è¿äºé®é¢å°±è§£å³äºã\n\n\n\n1.å®è£\n\nyum install bind-chroot\n\n2.è®¾ç½®å¼æºå¯å¨\n\nsystemctl enable named-chroot\n\n3.éç½®bind\n\nvim /etc/named.conf\n\noptions {\n    listen-on port 53 { any; };\n    listen-on-v6 port 53 { ::1; };\n    directory     "/var/named";\n    dump-file     "/var/named/data/cache_dump.db";\n    statistics-file "/var/named/data/named_stats.txt";\n    memstatistics-file "/var/named/data/named_mem_stats.txt";\n    allow-query     { any; };\n\n    /* \n     - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.\n     - If you are building a RECURSIVE (caching) DNS server, you need to enable \n       recursion. \n     - If your recursive DNS server has a public IP address, you MUST enable access \n       control to limit queries to your legitimate users. Failing to do so will\n       cause your server to become part of large scale DNS amplification \n       attacks. Implementing BCP38 within your network would greatly\n       reduce such attack surface \n    */\n    recursion yes;\n    forwarders { 223.5.5.5; };\n    dnssec-enable no;\n    dnssec-validation no;\n\n    /* Path to ISC DLV key */\n    bindkeys-file "/etc/named.iscdlv.key";\n\n    managed-keys-directory "/var/named/dynamic";\n\n    pid-file "/run/named/named.pid";\n    session-keyfile "/run/named/session.key";\n};\n\nlogging {\n        channel default_debug {\n                file "data/named.run";\n                severity dynamic;\n        };\n};\n\nzone "." IN {\n    type hint;\n    file "named.ca";\n};\n\nzone "a.com" IN {\n    type master;\n    file "a.com.zone";\n};\n\nzone "0.168.192.in-addr.arpa" IN {\n    type master;\n    file "192.168.0.zone";\n};\n\ninclude "/etc/named.rfc1912.zones";\ninclude "/etc/named.root.key";\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\né»è®¤éç½®ä¿®æ¹è¿ä¸¤é¡¹:\n\nlisten-on port 53 { any; }è¡¨ç¤ºçå¬ä»»ä½ipå¯¹53ç«¯å£çè¯·æ±\n\nallow-query { any; }è¡¨ç¤ºæ¥æ¶ä»»ä½æ¥æºæ¥è¯¢dnsè®°å½\n\nzone "a.com" IN { type master; file "a.com.zone"; };\n\næ­¤æ®µå¢å ä¸ä¸ªa.comååçè§£æï¼å·ä½è§£æè§åå¨/var/named/a.com.zoneéã\n\nzone "0.168.192.in-addr.arpa" IN { type master; file "192.168.0.zone"; };\n\næ­¤æ®µå¢å ä¸ä¸ªååè§£æï¼å³æ ¹æ®ipæ¥ååï¼ä¸éè¦çè¯å¯ä»¥ä¸è®¾ç½®ï¼\n\n/var/named/a.com.zoneæä»¶åå®¹ï¼è¯·æ³¨ænamedç¨æ·æè¯»çæé\n\n$TTL 1D @ IN SOA @ root.a.com. ( 0 ; serial 1D ; refresh 1H ; retry 1W ; expire 3H ) ; minimum NS @ A 192.168.0.111 www A 192.168.0.112 @ MX 10 mx.a.com. AAAA ::1\n\næ­¤æ®µè®¾ç½®äº\n\na.comçipä¸º192.168.0.111ï¼\n\nwww.a.comçipè§£æå°192.168.0.112,\n\na.comçmxè®°å½ä¸ºmx.a.com\n\n/var/named/192.168.0.zoneæä»¶åå®¹ï¼è¯·æ³¨ænamedç¨æ·éè¦æè¯»çæé\n\n$TTL 86400 @ IN SOA localhost a.com. ( 2014031101 2H 10M 7D 1D ) IN NS localhost. 111 IN PTR a.com 112 IN PTR www.a.com.\n\næ­¤æ®µè®¾ç½®äºåæ¥è®°å½ï¼å³\n\n192.168.0.111æ¥è¯¢åå¾å°çååæ¯a.com\n\n192.168.0.222æ¥è¯¢åå¾å°çååæ¯www.a.com\n\næåï¼å¯å¨bind\n\nsystemctl start named-chroot\n\nåºæ¬çDNSæå¡å¨æ­å»ºå®æï¼å¹¶å·²ç»è®¾ç½®äºä¸ä¸ªa.comçååè§£æï¼æ¥æµè¯ä¸ä¸ã\n\nwindowså³é®ç½å¡å¾æ ï¼æå¼ç½ç»åå±äº«ä¸­å¿ï¼æ´æ¹ééå¨è®¾ç½®ï¼å³é®ç½å¡ï¼å±æ§ï¼Internet åè®®çæ¬4(TCP/IPv4)ï¼å¾éä½¿ç¨ä¸é¢çDNSæå¡å¨å°åï¼é¦éDNSæå¡å¨å¡«å¥æå¡å¨ip,ç±»nixç³»ç»ç¼è¾/etc/resolv.confä¿®æ¹nameserverä¸ºæå¡å¨ipã115.28.142.187ä¸ºæçdnsæå¡å¨IPï¼ä¸é¢çç»æé½æ¯åºäº115.28.142.187dnsæå¡å¨è¿åçç»æ.\n\næ¥è¯¢a.comçdnsè®°å½\n\na.com Aè®°å½\n\næ¥è¯¢www.a.comçdnsè®°å½\n\nwww.a.com Aè®°å½\n\næ¥è¯¢a.comçMXè®°å½\n\na.com MXè®°å½\n\næ¥è¯¢www.a.comçPTRè®°å½\n\nwww.a.com PTRè®°å½\n\nè½¬è½½è¯·æ³¨æï¼é£å¨Â Â»Â CentOS 7æ­å»ºDNSæå¡å¨ï¼bindå®è£éç½®\n\nä¾å­ååéç½®ï¼\n\n$TTL 1D\n\n@ IN SOA ns.vcenter.com. root (\n\n0 ; serial\n\n1D ; refresh\n\n1H ; retry\n\n1W ; expire\n\n3H ) ; minimum\n\nNS ns.vcenter.com.\n\nns A 172.16.30.243\n\n@ A 172.16.30.211\n\nwww A 172.16.30.211',normalizedContent:'è½ç¶å¯ä»¥ä¿®æ¹æä½ç³»ç»ä¸çhostsæä»¶å«ædnsè§£æï¼ä½æ¯å¦æå¨å¤å°è®¡ç®æºä¹é´æµè¯ï¼å°±å¾ä¸è¡è¡çå¤å¶å°å¤ä¸ªè®¡ç®æºä¸­ãæ´æçèï¼å¦ææµè¯æ¥å£å°åæ¯æµè¯ååï¼å¨æªè¶ç±çiphoneä¸­å°±æ²¡åæ³æµè¯äºï¼æªè¶ç±çiphoneä¿®æ¹ä¸äºhostsãèä¸hostsåªæ¯æaè®°å½ï¼æ²¡åæ³è®¾ç½®mxï¼ptrï¼cnameâ¦â¦æ­å»ºä¸ä¸ªdnsæå¡å¨è¿äºé®é¢å°±è§£å³äºã\n\n\n\n1.å®è£\n\nyum install bind-chroot\n\n2.è®¾ç½®å¼æºå¯å¨\n\nsystemctl enable named-chroot\n\n3.éç½®bind\n\nvim /etc/named.conf\n\noptions {\n    listen-on port 53 { any; };\n    listen-on-v6 port 53 { ::1; };\n    directory     "/var/named";\n    dump-file     "/var/named/data/cache_dump.db";\n    statistics-file "/var/named/data/named_stats.txt";\n    memstatistics-file "/var/named/data/named_mem_stats.txt";\n    allow-query     { any; };\n\n    /* \n     - if you are building an authoritative dns server, do not enable recursion.\n     - if you are building a recursive (caching) dns server, you need to enable \n       recursion. \n     - if your recursive dns server has a public ip address, you must enable access \n       control to limit queries to your legitimate users. failing to do so will\n       cause your server to become part of large scale dns amplification \n       attacks. implementing bcp38 within your network would greatly\n       reduce such attack surface \n    */\n    recursion yes;\n    forwarders { 223.5.5.5; };\n    dnssec-enable no;\n    dnssec-validation no;\n\n    /* path to isc dlv key */\n    bindkeys-file "/etc/named.iscdlv.key";\n\n    managed-keys-directory "/var/named/dynamic";\n\n    pid-file "/run/named/named.pid";\n    session-keyfile "/run/named/session.key";\n};\n\nlogging {\n        channel default_debug {\n                file "data/named.run";\n                severity dynamic;\n        };\n};\n\nzone "." in {\n    type hint;\n    file "named.ca";\n};\n\nzone "a.com" in {\n    type master;\n    file "a.com.zone";\n};\n\nzone "0.168.192.in-addr.arpa" in {\n    type master;\n    file "192.168.0.zone";\n};\n\ninclude "/etc/named.rfc1912.zones";\ninclude "/etc/named.root.key";\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n\n\né»è®¤éç½®ä¿®æ¹è¿ä¸¤é¡¹:\n\nlisten-on port 53 { any; }è¡¨ç¤ºçå¬ä»»ä½ipå¯¹53ç«¯å£çè¯·æ±\n\nallow-query { any; }è¡¨ç¤ºæ¥æ¶ä»»ä½æ¥æºæ¥è¯¢dnsè®°å½\n\nzone "a.com" in { type master; file "a.com.zone"; };\n\næ­¤æ®µå¢å ä¸ä¸ªa.comååçè§£æï¼å·ä½è§£æè§åå¨/var/named/a.com.zoneéã\n\nzone "0.168.192.in-addr.arpa" in { type master; file "192.168.0.zone"; };\n\næ­¤æ®µå¢å ä¸ä¸ªååè§£æï¼å³æ ¹æ®ipæ¥ååï¼ä¸éè¦çè¯å¯ä»¥ä¸è®¾ç½®ï¼\n\n/var/named/a.com.zoneæä»¶åå®¹ï¼è¯·æ³¨ænamedç¨æ·æè¯»çæé\n\n$ttl 1d @ in soa @ root.a.com. ( 0 ; serial 1d ; refresh 1h ; retry 1w ; expire 3h ) ; minimum ns @ a 192.168.0.111 www a 192.168.0.112 @ mx 10 mx.a.com. aaaa ::1\n\næ­¤æ®µè®¾ç½®äº\n\na.comçipä¸º192.168.0.111ï¼\n\nwww.a.comçipè§£æå°192.168.0.112,\n\na.comçmxè®°å½ä¸ºmx.a.com\n\n/var/named/192.168.0.zoneæä»¶åå®¹ï¼è¯·æ³¨ænamedç¨æ·éè¦æè¯»çæé\n\n$ttl 86400 @ in soa localhost a.com. ( 2014031101 2h 10m 7d 1d ) in ns localhost. 111 in ptr a.com 112 in ptr www.a.com.\n\næ­¤æ®µè®¾ç½®äºåæ¥è®°å½ï¼å³\n\n192.168.0.111æ¥è¯¢åå¾å°çååæ¯a.com\n\n192.168.0.222æ¥è¯¢åå¾å°çååæ¯www.a.com\n\næåï¼å¯å¨bind\n\nsystemctl start named-chroot\n\nåºæ¬çdnsæå¡å¨æ­å»ºå®æï¼å¹¶å·²ç»è®¾ç½®äºä¸ä¸ªa.comçååè§£æï¼æ¥æµè¯ä¸ä¸ã\n\nwindowså³é®ç½å¡å¾æ ï¼æå¼ç½ç»åå±äº«ä¸­å¿ï¼æ´æ¹ééå¨è®¾ç½®ï¼å³é®ç½å¡ï¼å±æ§ï¼internet åè®®çæ¬4(tcp/ipv4)ï¼å¾éä½¿ç¨ä¸é¢çdnsæå¡å¨å°åï¼é¦édnsæå¡å¨å¡«å¥æå¡å¨ip,ç±»nixç³»ç»ç¼è¾/etc/resolv.confä¿®æ¹nameserverä¸ºæå¡å¨ipã115.28.142.187ä¸ºæçdnsæå¡å¨ipï¼ä¸é¢çç»æé½æ¯åºäº115.28.142.187dnsæå¡å¨è¿åçç»æ.\n\næ¥è¯¢a.comçdnsè®°å½\n\na.com aè®°å½\n\næ¥è¯¢www.a.comçdnsè®°å½\n\nwww.a.com aè®°å½\n\næ¥è¯¢a.comçmxè®°å½\n\na.com mxè®°å½\n\næ¥è¯¢www.a.comçptrè®°å½\n\nwww.a.com ptrè®°å½\n\nè½¬è½½è¯·æ³¨æï¼é£å¨Â Â»Â centos 7æ­å»ºdnsæå¡å¨ï¼bindå®è£éç½®\n\nä¾å­ååéç½®ï¼\n\n$ttl 1d\n\n@ in soa ns.vcenter.com. root (\n\n0 ; serial\n\n1d ; refresh\n\n1h ; retry\n\n1w ; expire\n\n3h ) ; minimum\n\nns ns.vcenter.com.\n\nns a 172.16.30.243\n\n@ a 172.16.30.211\n\nwww a 172.16.30.211',charsets:{cjk:!0}},{title:"sedå½ä»¤å¨ææ¬æ¯è¡,è¡å°¾æè¡é¦æ·»å å­ç¬¦",frontmatter:{title:"sedå½ä»¤å¨ææ¬æ¯è¡,è¡å°¾æè¡é¦æ·»å å­ç¬¦",date:"2022-12-21T20:56:09.000Z",permalink:"/pages/4baba0/",categories:["è¿ç»´","linux","sedãawkãgrepãfindååå®¢"],tags:[null],feed:{enable:!0},description:"Logrotateå¥é¨äºè§£åçäº§å®è·µ",readingShow:"top",meta:[{name:"image",content:"https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMwMDIuY25ibG9ncy5jb20vaW1hZ2VzLzIwMTEvMzIyODMzLzIwMTEwODE5MDk0NDQwMTMucG5n?x-oss-process=image/format,png"},{name:"twitter:title",content:"sedå½ä»¤å¨ææ¬æ¯è¡,è¡å°¾æè¡é¦æ·»å å­ç¬¦"},{name:"twitter:description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMwMDIuY25ibG9ncy5jb20vaW1hZ2VzLzIwMTEvMzIyODMzLzIwMTEwODE5MDk0NDQwMTMucG5n?x-oss-process=image/format,png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/03.sed%E3%80%81awk%E3%80%81grep%E3%80%81find%E5%9B%9B%E5%89%91%E5%AE%A2/01.sed%E5%91%BD%E4%BB%A4%E5%9C%A8%E6%96%87%E6%9C%AC%E6%AF%8F%E8%A1%8C,%E8%A1%8C%E5%B0%BE%E6%88%96%E8%A1%8C%E9%A6%96%E6%B7%BB%E5%8A%A0%E5%AD%97%E7%AC%A6.html"},{property:"og:type",content:"article"},{property:"og:title",content:"sedå½ä»¤å¨ææ¬æ¯è¡,è¡å°¾æè¡é¦æ·»å å­ç¬¦"},{property:"og:description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{property:"og:image",content:"https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMwMDIuY25ibG9ncy5jb20vaW1hZ2VzLzIwMTEvMzIyODMzLzIwMTEwODE5MDk0NDQwMTMucG5n?x-oss-process=image/format,png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/03.sed%E3%80%81awk%E3%80%81grep%E3%80%81find%E5%9B%9B%E5%89%91%E5%AE%A2/01.sed%E5%91%BD%E4%BB%A4%E5%9C%A8%E6%96%87%E6%9C%AC%E6%AF%8F%E8%A1%8C,%E8%A1%8C%E5%B0%BE%E6%88%96%E8%A1%8C%E9%A6%96%E6%B7%BB%E5%8A%A0%E5%AD%97%E7%AC%A6.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-21T20:56:09.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"sedå½ä»¤å¨ææ¬æ¯è¡,è¡å°¾æè¡é¦æ·»å å­ç¬¦"},{itemprop:"description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{itemprop:"image",content:"https://imgconvert.csdnimg.cn/aHR0cHM6Ly9waWMwMDIuY25ibG9ncy5jb20vaW1hZ2VzLzIwMTEvMzIyODMzLzIwMTEwODE5MDk0NDQwMTMucG5n?x-oss-process=image/format,png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/01.linux/03.sed%E3%80%81awk%E3%80%81grep%E3%80%81find%E5%9B%9B%E5%89%91%E5%AE%A2/01.sed%E5%91%BD%E4%BB%A4%E5%9C%A8%E6%96%87%E6%9C%AC%E6%AF%8F%E8%A1%8C,%E8%A1%8C%E5%B0%BE%E6%88%96%E8%A1%8C%E9%A6%96%E6%B7%BB%E5%8A%A0%E5%AD%97%E7%AC%A6.html",relativePath:"04.è¿ç»´/01.linux/03.sedãawkãgrepãfindååå®¢/01.sedå½ä»¤å¨ææ¬æ¯è¡,è¡å°¾æè¡é¦æ·»å å­ç¬¦.md",key:"v-44ab5907",path:"/pages/4baba0/",headersStr:null,content:'ç¨sedå½ä»¤å¨è¡é¦æè¡å°¾æ·»å å­ç¬¦çå½ä»¤æä»¥ä¸å ç§ï¼\nåè®¾å¤ççææ¬ä¸ºtest.file\n\n\n\nå¨æ¯è¡çå¤´æ·»å å­ç¬¦ï¼æ¯å¦"HEAD"ï¼å½ä»¤å¦ä¸ï¼\n\nsed "s/^/HEAD&/g" test.file\n\n\n1\n\n\nå¨æ¯è¡çè¡å°¾æ·»å å­ç¬¦ï¼æ¯å¦âTAILâï¼å½ä»¤å¦ä¸ï¼\n\nsed "s/$/&TAIL/g" test.file\n\n\n1\n\n\nè¿è¡ç»æå¦ä¸å¾ï¼\n\n\n\nå ç¹è¯´æï¼\n\n 1. "^"ä»£è¡¨è¡é¦ï¼"$"ä»£è¡¨è¡å°¾\n\n 2. \'s/$/&TAIL/g\'ä¸­çå­ç¬¦gä»£è¡¨æ¯è¡åºç°çå­ç¬¦å¨é¨æ¿æ¢ï¼å¦ææ³å¨ç¹å®å­ç¬¦å¤æ·»å ï¼gå°±æç¨äºï¼å¦ååªä¼æ¿æ¢æ¯è¡ç¬¬ä¸ä¸ªï¼èä¸ç»§ç»­å¾åæ¾äº\n\nä¾ï¼\n\n\n\n 3. å¦ææ³å¯¼åºæä»¶ï¼å¨å½ä»¤æ«å°¾å "> outfile_name"ï¼å¦ææ³å¨åæä»¶ä¸æ´æ¹ï¼æ·»å éé¡¹"-i"ï¼å¦ï¼è¿éç-iï¼å¯ä»¥çè§£ä¸ºå¶ä»å½ä»¤æ§è¡åçç»æéå®åå°åæä»¶ï¼æä»¥-n pç­åæ°ä¼å½±å-içææ\n\n\n\n 4. ä¹å¯ä»¥æä¸¤æ¡å½ä»¤åå¨ä¸èµ·ï¼å¨test.fileçæ¯ä¸è¡çè¡å¤´åè¡å°¾åå«æ·»å å­ç¬¦"HEAD"ãâTAILâï¼å½ä»¤ï¼\n\nsed "/./{s/^/HEAD&/;s/$/&TAIL/}" test.file\n\n\n1\n',normalizedContent:'ç¨sedå½ä»¤å¨è¡é¦æè¡å°¾æ·»å å­ç¬¦çå½ä»¤æä»¥ä¸å ç§ï¼\nåè®¾å¤ççææ¬ä¸ºtest.file\n\n\n\nå¨æ¯è¡çå¤´æ·»å å­ç¬¦ï¼æ¯å¦"head"ï¼å½ä»¤å¦ä¸ï¼\n\nsed "s/^/head&/g" test.file\n\n\n1\n\n\nå¨æ¯è¡çè¡å°¾æ·»å å­ç¬¦ï¼æ¯å¦âtailâï¼å½ä»¤å¦ä¸ï¼\n\nsed "s/$/&tail/g" test.file\n\n\n1\n\n\nè¿è¡ç»æå¦ä¸å¾ï¼\n\n\n\nå ç¹è¯´æï¼\n\n 1. "^"ä»£è¡¨è¡é¦ï¼"$"ä»£è¡¨è¡å°¾\n\n 2. \'s/$/&tail/g\'ä¸­çå­ç¬¦gä»£è¡¨æ¯è¡åºç°çå­ç¬¦å¨é¨æ¿æ¢ï¼å¦ææ³å¨ç¹å®å­ç¬¦å¤æ·»å ï¼gå°±æç¨äºï¼å¦ååªä¼æ¿æ¢æ¯è¡ç¬¬ä¸ä¸ªï¼èä¸ç»§ç»­å¾åæ¾äº\n\nä¾ï¼\n\n\n\n 3. å¦ææ³å¯¼åºæä»¶ï¼å¨å½ä»¤æ«å°¾å "> outfile_name"ï¼å¦ææ³å¨åæä»¶ä¸æ´æ¹ï¼æ·»å éé¡¹"-i"ï¼å¦ï¼è¿éç-iï¼å¯ä»¥çè§£ä¸ºå¶ä»å½ä»¤æ§è¡åçç»æéå®åå°åæä»¶ï¼æä»¥-n pç­åæ°ä¼å½±å-içææ\n\n\n\n 4. ä¹å¯ä»¥æä¸¤æ¡å½ä»¤åå¨ä¸èµ·ï¼å¨test.fileçæ¯ä¸è¡çè¡å¤´åè¡å°¾åå«æ·»å å­ç¬¦"head"ãâtailâï¼å½ä»¤ï¼\n\nsed "/./{s/^/head&/;s/$/&tail/}" test.file\n\n\n1\n',charsets:{cjk:!0}},{title:"LVMç®¡ç",frontmatter:{title:"LVMç®¡ç",date:"2022-12-15T17:38:10.000Z",permalink:"/pages/5f261c/",categories:["è¿ç»´","linuxç³»ç»"],tags:[null],feed:{enable:!0},description:"LVMæ¯å¨ç£çååºåæä»¶ç³»ç»ä¹é´æ·»å çä¸ä¸ªé»è¾å±ï¼æ¥ä¸ºæä»¶ç³»ç»å±è½ä¸å±ç£çååºå¸å±ï¼æä¾ä¸ä¸ªæ½è±¡ççå·ï¼å¨çå·ä¸å»ºç«æä»¶ç³»ç»ãç®¡çåå©ç¨LVMå¯ä»¥å¨ç£çä¸ç¨éæ°ååºçæåµä¸å¨æè°æ´æä»¶ç³»ç»çå¤§å°ï¼å¹¶ä¸å©ç¨LVMç®¡ççæä»¶ç³»ç»å¯ä»¥è·¨è¶ç£çï¼å½æå¡å¨æ·»å äºæ°çç£çåï¼ç®¡çåä¸å¿å°åæçæä»¶ç§»å¨å°æ°çç£çä¸ï¼èæ¯éè¿LVMå¯ä»¥ç´æ¥æ©å±æä»¶ç³»ç»è·¨è¶ç£ç",readingShow:"top",meta:[{name:"image",content:"http://pic.zzppjj.top/LightPicture/2023/01/5a41ef21aac7ec6c.jpg"},{name:"twitter:title",content:"LVMç®¡ç"},{name:"twitter:description",content:"LVMæ¯å¨ç£çååºåæä»¶ç³»ç»ä¹é´æ·»å çä¸ä¸ªé»è¾å±ï¼æ¥ä¸ºæä»¶ç³»ç»å±è½ä¸å±ç£çååºå¸å±ï¼æä¾ä¸ä¸ªæ½è±¡ççå·ï¼å¨çå·ä¸å»ºç«æä»¶ç³»ç»ãç®¡çåå©ç¨LVMå¯ä»¥å¨ç£çä¸ç¨éæ°ååºçæåµä¸å¨æè°æ´æä»¶ç³»ç»çå¤§å°ï¼å¹¶ä¸å©ç¨LVMç®¡ççæä»¶ç³»ç»å¯ä»¥è·¨è¶ç£çï¼å½æå¡å¨æ·»å äºæ°çç£çåï¼ç®¡çåä¸å¿å°åæçæä»¶ç§»å¨å°æ°çç£çä¸ï¼èæ¯éè¿LVMå¯ä»¥ç´æ¥æ©å±æä»¶ç³»ç»è·¨è¶ç£ç"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://pic.zzppjj.top/LightPicture/2023/01/5a41ef21aac7ec6c.jpg"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/04.LVM%E7%AE%A1%E7%90%86.html"},{property:"og:type",content:"article"},{property:"og:title",content:"LVMç®¡ç"},{property:"og:description",content:"LVMæ¯å¨ç£çååºåæä»¶ç³»ç»ä¹é´æ·»å çä¸ä¸ªé»è¾å±ï¼æ¥ä¸ºæä»¶ç³»ç»å±è½ä¸å±ç£çååºå¸å±ï¼æä¾ä¸ä¸ªæ½è±¡ççå·ï¼å¨çå·ä¸å»ºç«æä»¶ç³»ç»ãç®¡çåå©ç¨LVMå¯ä»¥å¨ç£çä¸ç¨éæ°ååºçæåµä¸å¨æè°æ´æä»¶ç³»ç»çå¤§å°ï¼å¹¶ä¸å©ç¨LVMç®¡ççæä»¶ç³»ç»å¯ä»¥è·¨è¶ç£çï¼å½æå¡å¨æ·»å äºæ°çç£çåï¼ç®¡çåä¸å¿å°åæçæä»¶ç§»å¨å°æ°çç£çä¸ï¼èæ¯éè¿LVMå¯ä»¥ç´æ¥æ©å±æä»¶ç³»ç»è·¨è¶ç£ç"},{property:"og:image",content:"http://pic.zzppjj.top/LightPicture/2023/01/5a41ef21aac7ec6c.jpg"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/04.LVM%E7%AE%A1%E7%90%86.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T17:38:10.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"LVMç®¡ç"},{itemprop:"description",content:"LVMæ¯å¨ç£çååºåæä»¶ç³»ç»ä¹é´æ·»å çä¸ä¸ªé»è¾å±ï¼æ¥ä¸ºæä»¶ç³»ç»å±è½ä¸å±ç£çååºå¸å±ï¼æä¾ä¸ä¸ªæ½è±¡ççå·ï¼å¨çå·ä¸å»ºç«æä»¶ç³»ç»ãç®¡çåå©ç¨LVMå¯ä»¥å¨ç£çä¸ç¨éæ°ååºçæåµä¸å¨æè°æ´æä»¶ç³»ç»çå¤§å°ï¼å¹¶ä¸å©ç¨LVMç®¡ççæä»¶ç³»ç»å¯ä»¥è·¨è¶ç£çï¼å½æå¡å¨æ·»å äºæ°çç£çåï¼ç®¡çåä¸å¿å°åæçæä»¶ç§»å¨å°æ°çç£çä¸ï¼èæ¯éè¿LVMå¯ä»¥ç´æ¥æ©å±æä»¶ç³»ç»è·¨è¶ç£ç"},{itemprop:"image",content:"http://pic.zzppjj.top/LightPicture/2023/01/5a41ef21aac7ec6c.jpg"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/01.linux/04.LVM%E7%AE%A1%E7%90%86.html",relativePath:"04.è¿ç»´/01.linux/04.LVMç®¡ç.md",key:"v-e8e0b9ea",path:"/pages/5f261c/",headers:[{level:2,title:"lvmå·¥ä½åç",slug:"lvmå·¥ä½åç",normalizedTitle:"lvmå·¥ä½åç",charIndex:2},{level:2,title:"LVMå¸¸ç¨çæ¯è¯­",slug:"lvmå¸¸ç¨çæ¯è¯­",normalizedTitle:"lvmå¸¸ç¨çæ¯è¯­",charIndex:363},{level:2,title:"LVMä¼ç¹",slug:"lvmä¼ç¹",normalizedTitle:"lvmä¼ç¹",charIndex:906},{level:2,title:"åå»ºLVMçåºæ¬æ­¥éª¤",slug:"åå»ºlvmçåºæ¬æ­¥éª¤",normalizedTitle:"åå»ºlvmçåºæ¬æ­¥éª¤",charIndex:1297},{level:2,title:"LVMå é¤",slug:"lvmå é¤",normalizedTitle:"lvmå é¤",charIndex:1635},{level:2,title:"åºå±å­å¨æ´æ¢æ°å»ºPV pvcreate /dev/sdc1",slug:"åºå±å­å¨æ´æ¢æ°å»ºpv-pvcreate-dev-sdc1",normalizedTitle:"åºå±å­å¨æ´æ¢æ°å»ºpv pvcreate /dev/sdc1",charIndex:1782},{level:2,title:"æ©å®¹æä½",slug:"æ©å®¹æä½",normalizedTitle:"æ©å®¹æä½",charIndex:1938},{level:2,title:"å¤§äº2Tçæ©å®¹ä½¿ç¨",slug:"å¤§äº2tçæ©å®¹ä½¿ç¨",normalizedTitle:"å¤§äº2tçæ©å®¹ä½¿ç¨",charIndex:2153}],headersStr:"lvmå·¥ä½åç LVMå¸¸ç¨çæ¯è¯­ LVMä¼ç¹ åå»ºLVMçåºæ¬æ­¥éª¤ LVMå é¤ åºå±å­å¨æ´æ¢æ°å»ºPV pvcreate /dev/sdc1 æ©å®¹æä½ å¤§äº2Tçæ©å®¹ä½¿ç¨",content:'# lvmå·¥ä½åç\n\nLVMæ¯å¨ç£çååºåæä»¶ç³»ç»ä¹é´æ·»å çä¸ä¸ªé»è¾å±ï¼æ¥ä¸ºæä»¶ç³»ç»å±è½ä¸å±ç£çååºå¸å±ï¼æä¾ä¸ä¸ªæ½è±¡ççå·ï¼å¨çå·ä¸å»ºç«æä»¶ç³»ç»ãç®¡çåå©ç¨LVMå¯ä»¥å¨ç£çä¸ç¨éæ°ååºçæåµä¸å¨æè°æ´æä»¶ç³»ç»çå¤§å°ï¼å¹¶ä¸å©ç¨LVMç®¡ççæä»¶ç³»ç»å¯ä»¥è·¨è¶ç£çï¼å½æå¡å¨æ·»å äºæ°çç£çåï¼ç®¡çåä¸å¿å°åæçæä»¶ç§»å¨å°æ°çç£çä¸ï¼èæ¯éè¿LVMå¯ä»¥ç´æ¥æ©å±æä»¶ç³»ç»è·¨è¶ç£ç\n\nå®å°±æ¯éè¿å°åºå±çç©çç¡¬çå°è£èµ·æ¥ï¼ç¶åä»¥é»è¾å·çæ¹å¼åç°ç»ä¸å±åºç¨ãå¨LVMä¸­ï¼å¶éè¿å¯¹åºå±çç¡¬çè¿è¡å°è£ï¼å½æä»¬å¯¹åºå±çç©çç¡¬çè¿è¡æä½æ¶ï¼å¶ä¸åæ¯éå¯¹äºååºè¿è¡æä½ï¼èæ¯éè¿ä¸ä¸ªå«åé»è¾å·çä¸è¥¿æ¥å¯¹å¶è¿è¡åºå±çç£çç®¡çæä½ã\n\né»è¾å·ç®¡ççæ ¸å¿å¨äºå¦ä½å¤çæä»¬ç³»ç»ä¸­å®è£çç¡¬çåå¶ååºï¼å¯¹äºæä»¬çé»è¾å·ç®¡çå¨æ¥è¯´ï¼æç¡¬çå½ä½ç©çå·æ¥ç\n\n\n\n\n# LVMå¸¸ç¨çæ¯è¯­\n\nåæ¥äºè§£ä¸ä¸å¸¸ç¨çåè¯è§£é\n\n * ç©çå­å¨ä»è´¨ï¼TheÂ physicalÂ mediaï¼\n\nè¿éæç³»ç»çå­å¨è®¾å¤æä»¶ï¼å¯æ¯ç£çååºï¼æ´ä¸ªç£çï¼RAIDéµåæSANç£çï¼è®¾å¤å¿é¡»åå§åä¸ºLVMç©çå·ï¼æè½ä¸LVMç»åä½¿ç¨\n\n * ç©çå·PVï¼physicalÂ volumeï¼\n\nç©çå·å°±æ¯æç¡¬çååºæä»é»è¾ä¸ä¸ç£çååºå·æåæ ·åè½çè®¾å¤(å¦RAID)ï¼æ¯LVMçåºæ¬å­å¨é»è¾åï¼ä½ååºæ¬çç©çå­å¨ä»è´¨ï¼å¦ååºãç£çç­ï¼æ¯è¾ï¼å´åå«æä¸LVMç¸å³çç®¡çåæ°Â ï¼æ³¨åç©çè®¾å¤ä»¥ä¾¿å¨å·ç»ä¸­ä½¿ç¨ï¼,åå»ºç©çå·å®å¯ä»¥ç¨ç¡¬çååºï¼ä¹å¯ä»¥ç¨ç¡¬çæ¬èº«ï¼\n\n * å·ç»VGï¼VolumeÂ Groupï¼\n\nLVMå·ç»ç±»ä¼¼äºéLVMç³»ç»ä¸­çç©çç¡¬çï¼ä¸ä¸ªLVMå·ç»ç±ä¸ä¸ªæå¤ä¸ªç©çå·ç»æ ï¬ï¬\n\n * é»è¾å·LVï¼logicalÂ volumeï¼\n\nç±»ä¼¼äºéLVMç³»ç»ä¸­çç¡¬çååºï¼LVå»ºç«å¨VGä¹ä¸ï¼å¯ä»¥å¨LVä¹ä¸å»ºç«æä»¶ç³»ç»\n\n * PEï¼physicalÂ extentsï¼\n\nPVä¸­å¯ä»¥åéçæå°å­å¨ååï¼PEçå¤§å°æ¯å¯ä»¥æå®çï¼é»è®¤ä¸º4MB\n\n * LEï¼logicalÂ extentï¼\n\nLVä¸­å¯ä»¥åéçæå°å­å¨ååï¼å¨åä¸ä¸ªå·ç»ä¸­ï¼LEçå¤§å°åPEæ¯ç¸åçï¼å¹¶ä¸ä¸ä¸å¯¹åº\n\n\n# LVMä¼ç¹\n\n * ä½¿ç¨å·ç»ï¼ä½¿å¤ä¸ªç¡¬çç©ºé´çèµ·æ¥åæ¯ä¸ä¸ªå¤§çç¡¬ç\n * ä½¿ç¨é»è¾å·ï¼å¯ä»¥è·¨å¤ä¸ªç¡¬çç©ºé´çååº sdb1 sdb2 sdc1 sdd2 sdf\n * å¨ä½¿ç¨é»è¾å·æ¶ï¼å®å¯ä»¥å¨ç©ºé´ä¸è¶³æ¶å¨æè°æ´å®çå¤§å°\n * å¨è°æ´é»è¾å·å¤§å°æ¶ï¼ä¸éè¦èèé»è¾å·å¨ç¡¬çä¸çä½ç½®ï¼ä¸ç¨æå¿æ²¡æå¯ç¨çè¿ç»­ç©ºé´\n * å¯ä»¥å¨çº¿å¯¹LV,VG è¿è¡åå»ºï¼å é¤ï¼è°æ´å¤§å°ç­æä½ãLVMä¸çæä»¶ç³»ç»ä¹éè¦éæ°è°æ´å¤§å°ã\n * å¯ä»¥å°æ­£å¨ä½¿ç¨ä¸­çç¡¬çè¿ç§»å°å«çç¡¬çä¸(emc--500G DELL---1.2T)\n * åè®¸åå»ºå¿«ç§ï¼å¯ä»¥ç¨æ¥ä¿å­æä»¶ç³»ç»çå¤ä»½ãåªè½ä½¿ç¨ä¸æ¬¡\n\n> è§£éï¼\n> \n> LVMæ¯è½¯ä»¶çå·ç®¡çæ¹å¼ï¼èRAIDæ¯ç£çä¿æ¤çæ¹æ³ãå¯¹äºéè¦çä¸å¡æ¥è¯´ï¼ä¸è¬æ¯åæ¶å­å¨ãRAIDç¨æ¥ä¿æ¤ç©ççç£çä¸ä¼å ä¸ºæéèä¸­æ­ä¸å¡ãLVMç¨æ¥å®ç°å¯¹å·çè¯æ§çç®¡çï¼æ´å¥½çå©ç¨ç£çèµæº\n\n\n# åå»ºLVMçåºæ¬æ­¥éª¤\n\n 1. ååç©çå· pvcreate /dev/sdb1\n\n 2. æä¸åçç©çå·å å¥å°å·ç»å½ä¸­ vgcreate datavg /dev/sdb1\n\n 3. åå»ºé»è¾å· lvcreate\n\n 4. æ ¼å¼åæä»¶ç³»ç» mkfs.xfs\n\n 5. åå»ºæè½½ç¹å¹¶è¿è¡æè½½ mount\n\n> lvcreate -l +100%FREE æå®å¨é¨å¤§å°\n\nå¯¹extç±»åæä»¶ç³»ç»æ©å®¹ï¼ resize2fs\n\nå¯¹xfsç±»åæä»¶ç³»ç»æ©å®¹ï¼ xfs_growfs\n\nresize2fsåxfs_growfs ä¸¤èçåºå«æ¯ä¼ éçåæ°ä¸ä¸æ ·çï¼xfs_growfsæ¯éç¨çæè½½ç¹ï¼resize2fsæ¯é»è¾å·åç§°ï¼èä¸resize2fså½ä»¤ä¸è½å¯¹xfsç±»åæä»¶ç³»ç»ä½¿ç¨\n\n\n# LVMå é¤\n\nåå»º: pvcreate ---\x3e vgcreate ---\x3e lvcrdeate ---\x3e mkfs.xfs lv ----\x3e mount\n\nå é¤ï¼ umount ----\x3e lvremove lv -----\x3e vgremove vg -----\x3e pvremove\n\n\n# åºå±å­å¨æ´æ¢æ°å»ºPV pvcreate /dev/sdc1\n\næ©å®¹VG vgextend datavg /dev/sdc1\n\nç§»å¨æ°æ® pvmove /dev/sdb5 /dev/sdc1\n\nVGç¼©å° vgreduce datavg /dev/sdb5\n\nå é¤å°ç pvremove /dev/sdb5\n\n\n# æ©å®¹æä½\n\n1.fdisk /dev/vdc    //ç»æ°å çç¡¬çè®¾å¤/dev/vdcåå»ºååº(æ³¨æè®¾å¤åç§°ç¥æå·®å¼ï¼æ­¥éª¤åä¸)\n2.åå«ænãpã1ãtã8eãwr\n3.pvcreate /dev/vdc1\n4.vgextend vg0 /dev/vdd1\n5.lvextend -l +100%FREE /dev/vg0/lv0\n6. xfs_growfs  /dev/vg0/lv0\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# å¤§äº2Tçæ©å®¹ä½¿ç¨\n\n1. ä½¿ç¨partedæ¹å¼æ ¼å¼åç£ç\n1.1 æ¥çç£çæåµ\n[root@jylhlog2 ~]# fdisk -l\nDisk /dev/sdd: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sdb: 42.9 GB, 42949672960 bytes, 83886080 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sdc: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sde: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sdf: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sda: 536.9 GB, 536870912000 bytes, 1048576000 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x0008ce60\nDevice Boot Start End Blocks Id System\n/dev/sda1 * 2048 2099199 1048576 83 Linux\n/dev/sda2 2099200 1048567807 523234304 8e Linux LVM\nDisk /dev/mapper/vg_root-lv_root: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-lv_swap: 68.7 GB, 68719476736 bytes, 134217728 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-lv_data: 209.4 GB, 209371267072 bytes, 408928256 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-lv_home: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-oracle: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-lv_grid: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sdg: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\n[root@jylhlog2 ~]#\n1.2 ä½¿ç¨partedæ ¼å¼å/dev/sdgååº\n[root@jylhlog2 ~]# parted /dev/sdg\nGNU Parted 3.1\nUsing /dev/sdg\nWelcome to GNU Parted! Type âhelpâ to view a list of commands.\n(parted) mklabel gpt ------å°MBRååºå½¢å¼è½¬ä¸ºGPTååºå½¢å¼\n(parted) mkpart primary xfs 0 -1 ------è®¾ç½®ååºçå¼å§ä½ç½®åç»æä½ç½®\nWarning: The resulting partition is not properly aligned for best performance.\nIgnore/Cancel? Ignore\n(parted) print ------æ¥çååº\nModel: VMware Virtual disk (scsi)\nDisk /dev/sdg: 2199GB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags:\nNumber Start End Size File system Name Flags\n1 17.4kB 2199GB 2199GB primary\n(parted) toggle 1 lvm ------ä½¿ç¨toggle æ´æ¹ç¡¬çç±»å\n(parted) print ------æ¥çååº\nModel: VMware Virtual disk (scsi)\nDisk /dev/sdg: 2199GB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags:\nNumber Start End Size File system Name Flags\n1 17.4kB 2199GB 2199GB primary lvm\n(parted) quit\nInformation: You may need to update /etc/fstab.\n[root@jylhlog2 ~]#\n1.3 æ¥çæ ¼å¼ååçååºæåµ\n[root@jylhlog2 ~]# fdisk -l\nDisk /dev/sdd: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sdb: 42.9 GB, 42949672960 bytes, 83886080 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sdc: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sde: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sdf: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sda: 536.9 GB, 536870912000 bytes, 1048576000 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x0008ce60\nDevice Boot Start End Blocks Id System\n/dev/sda1 * 2048 2099199 1048576 83 Linux\n/dev/sda2 2099200 1048567807 523234304 8e Linux LVM\nDisk /dev/mapper/vg_root-lv_root: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-lv_swap: 68.7 GB, 68719476736 bytes, 134217728 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-lv_data: 209.4 GB, 209371267072 bytes, 408928256 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-lv_home: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-oracle: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-lv_grid: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nWARNING: fdisk GPT support is currently new, and therefore in an experimental phase. Use at your own discretion.\nDisk /dev/sdg: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: gpt\nDisk identifier: 9C5E039C-2C6C-4585-8EAB-7B2DBA949516\n# Start End Size Type Name\n1 34 4294965343 2T Linux LVM primary\n[root@jylhlog2 ~]#\n1.4 ä½¿ç³»ç»éè¯»ååºè¡¨\n[root@jylhlog2 ~]# partprobe\nWarning: Unable to open /dev/sr0 read-write (Read-only file system). /dev/sr0 has been opened read-only.\n[root@jylhlog2 ~]#\n[root@jylhlog2 ~]# fdisk -l\nDisk /dev/sdd: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sdb: 42.9 GB, 42949672960 bytes, 83886080 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sdc: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sde: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sdf: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/sda: 536.9 GB, 536870912000 bytes, 1048576000 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x0008ce60\nDevice Boot Start End Blocks Id System\n/dev/sda1 * 2048 2099199 1048576 83 Linux\n/dev/sda2 2099200 1048567807 523234304 8e Linux LVM\nDisk /dev/mapper/vg_root-lv_root: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-lv_swap: 68.7 GB, 68719476736 bytes, 134217728 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-lv_data: 209.4 GB, 209371267072 bytes, 408928256 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-lv_home: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-oracle: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk /dev/mapper/vg_root-lv_grid: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nWARNING: fdisk GPT support is currently new, and therefore in an experimental phase. Use at your own discretion.\nDisk /dev/sdg: 2199.0 GB, 2199023255552 bytes, 4294967296 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: gpt\nDisk identifier: 9C5E039C-2C6C-4585-8EAB-7B2DBA949516\n# Start End Size Type Name\n1 34 4294965343 2T Linux LVM primary\n[root@jylhlog2 ~]#\n2. åå»ºpvãæ©å®¹vgãæ©å®¹lvãæ©å®¹xfsååº\n2.1 æ¥çç®åååºæåµ\n[root@jylhlog2 ~]# df -h\nFilesystem Size Used Avail Use% Mounted on\n/dev/mapper/vg_root-lv_root 60G 6.2G 54G 11% /\ndevtmpfs 63G 0 63G 0% /dev\ntmpfs 63G 640M 63G 1% /dev/shm\ntmpfs 63G 32M 63G 1% /run\ntmpfs 63G 0 63G 0% /sys/fs/cgroup\n/dev/sda1 1014M 179M 836M 18% /boot\n/dev/mapper/vg_root-lv_grid 60G 40G 21G 66% /grid\n/dev/mapper/vg_root-lv_data 195G 595M 195G 1% /data\n/dev/mapper/vg_root-oracle 60G 22G 38G 37% /oracle\n/dev/mapper/vg_root-lv_home 60G 16G 45G 27% /home\ntmpfs 13G 12K 13G 1% /run/user/42\ntmpfs 13G 0 13G 0% /run/user/1000\n[root@jylhlog2 ~]#\n2.2 æ¥çç®ålvæåµ\n[root@jylhlog2 ~]# lvs\nLV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert\nlv_data vg_root -wi-ao---- 194.99g\nlv_grid vg_root -wi-ao---- 60.00g\nlv_home vg_root -wi-ao---- 60.00g\nlv_root vg_root -wi-ao---- 60.00g\nlv_swap vg_root -wi-ao---- 64.00g\noracle vg_root -wi-ao---- 60.00g\n[root@jylhlog2 ~]#\n2.3 æ¥çç®åvgæåµ\n[root@jylhlog2 ~]# vgs\nVG #PV #LV #SN Attr VSize VFree\nvg_root 1 6 0 wzân- 498.99g 0\n[root@jylhlog2 ~]#\n2.4 åå»ºpv\n[root@jylhlog2 ~]# pvcreate /dev/sdg1\nPhysical volume â/dev/sdg1â successfully created.\n[root@jylhlog2 ~]#\n2.5 æ©å®¹vg\n[root@jylhlog2 ~]# vgextend vg_root /dev/sdg1\nVolume group âvg_rootâ successfully extended\n[root@jylhlog2 ~]#\n2.6 æ¥çvgæ©å®¹æåµ\n[root@jylhlog2 ~]# vgs\nVG #PV #LV #SN Attr VSize VFree\nvg_root 2 6 0 wzân- <2.49t <2.00t\n[root@jylhlog2 ~]#\n2.7 æ¥çæ©å®¹åvgå¤§å°æåµ\n[root@jylhlog2 ~]# vgdisplay\nâ Volume group â\nVG Name vg_root\nSystem ID\nFormat lvm2\nMetadata Areas 2\nMetadata Sequence No 8\nVG Access read/write\nVG Status resizable\nMAX LV 0\nCur LV 6\nOpen LV 6\nMax PV 0\nCur PV 2\nAct PV 2\nVG Size <2.49 TiB\nPE Size 4.00 MiB\nTotal PE 652029\nAlloc PE / Size 127742 / 498.99 GiB\nFree PE / Size 524287 / <2.00 TiB\nVG UUID bV0qQR-Vhfg-ynTF-dbza-qJD1-ao3k-l02WiP\n[root@jylhlog2 ~]#\n2.8 æ©å®¹lv\n[root@jylhlog2 ~]# lvextend -L +2097148M /dev/mapper/vg_root-lv_data\nSize of logical volume vg_root/lv_data changed from 194.99 GiB (49918 extents) to 2.19 TiB (574205 extents).\nLogical volume vg_root/lv_data successfully resized.\n[root@jylhlog2 ~]#\n2.9 æ¥çå®¹éååï¼åç°æä»¶ç³»ç»å¤§å°æ²¡æåå\n[root@jylhlog2 ~]# df -h\nFilesystem Size Used Avail Use% Mounted on\n/dev/mapper/vg_root-lv_root 60G 6.2G 54G 11% /\ndevtmpfs 63G 0 63G 0% /dev\ntmpfs 63G 640M 63G 1% /dev/shm\ntmpfs 63G 32M 63G 1% /run\ntmpfs 63G 0 63G 0% /sys/fs/cgroup\n/dev/sda1 1014M 179M 836M 18% /boot\n/dev/mapper/vg_root-lv_grid 60G 40G 21G 66% /grid\n/dev/mapper/vg_root-lv_data 195G 595M 195G 1% /data\n/dev/mapper/vg_root-oracle 60G 22G 38G 37% /oracle\n/dev/mapper/vg_root-lv_home 60G 16G 45G 27% /home\ntmpfs 13G 12K 13G 1% /run/user/42\ntmpfs 13G 0 13G 0% /run/user/1000\n[root@jylhlog2 ~]#\n2.10 ä½¿ç¨xfs_growfsåæ­¥ç£çä¿¡æ¯\n[root@jylhlog2 ~]# xfs_growfs /dev/mapper/vg_root-lv_data\nmeta-data=/dev/mapper/vg_root-lv_data isize=512 agcount=4, agsize=12779008 blks\nâ = sectsz=512 attr=2, projid32bit=1\nâ = crc=1 finobt=0 spinodes=0\ndata = bsize=4096 blocks=51116032, imaxpct=25\nâ = sunit=0 swidth=0 blks\nnaming =version 2 bsize=4096 ascii-ci=0 ftype=1\nlog =internal bsize=4096 blocks=24959, version=2\nâ = sectsz=512 sunit=0 blks, lazy-count=1\nrealtime =none extsz=4096 blocks=0, rtextents=0\ndata blocks changed from 51116032 to 587985920\n[root@jylhlog2 ~]#\n2.11 æ¥çå®¹éååï¼åç°æä»¶ç³»ç»å·²æ©å®¹æå\n[root@jylhlog2 ~]# df -h\nFilesystem Size Used Avail Use% Mounted on\n/dev/mapper/vg_root-lv_root 60G 6.2G 54G 11% /\ndevtmpfs 63G 0 63G 0% /dev\ntmpfs 63G 640M 63G 1% /dev/shm\ntmpfs 63G 32M 63G 1% /run\ntmpfs 63G 0 63G 0% /sys/fs/cgroup\n/dev/sda1 1014M 179M 836M 18% /boot\n/dev/mapper/vg_root-lv_grid 60G 40G 21G 66% /grid\n/dev/mapper/vg_root-lv_data 2.2T 597M 2.2T 1% /data\n/dev/mapper/vg_root-oracle 60G 22G 38G 37% /oracle\n/dev/mapper/vg_root-lv_home 60G 16G 45G 27% /home\ntmpfs 13G 12K 13G 1% /run/user/42\ntmpfs 13G 0 13G 0% /run/user/1000\n[root@jylhlog2 ~]#\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n286\n287\n288\n289\n290\n291\n292\n293\n294\n295\n296\n297\n298\n299\n300\n301\n302\n303\n304\n305\n306\n307\n308\n309\n310\n311\n312\n313\n314\n315\n316\n317\n318\n319\n320\n321\n322\n323\n324\n325\n326\n327\n328\n329\n330\n331\n332\n333\n334\n335\n336\n337\n338\n339\n340\n341\n\n\n> å¦æsdb1æ¯ä¸ä¸ªç£çéµåï¼èè¿ä¸ªç£çéµåä½¿ç¨å¹´ä»£å¤ªä¹ï¼æä»¬å¿é¡»ç§»åºæä¹åï¼\n> \n> ç§»å¨æ°æ®ï¼ [root@test1 ~]# pvmove /dev/sdb1 /dev/sdb3 #å°sdb1ä¸æ°æ®ç§»å°æ°å¢å sdb3 pv ä¸ /dev/sdb1: Moved: 23.53% /dev/sdb1: Moved: 76.47% /dev/sdb1: Moved: 100.00% [root@test1 ~]# vgreduce vg01 /dev/sdb1 #ç§»å®æ°æ®åç§»åº Removed "/dev/sdb1" from volume group "vg01" [root@test1 ~]# pvs PV VG Fmt Attr PSize PFree /dev/sdb1 lvm2 --- 1.00g 1.00g /dev/sdb2 vg02 lvm2 a-- 1008.00m 1008.00m /dev/sdb3 vg01 lvm2 a-- 1020.00m 952.00m #vg01ä¸­åªæsdb3äº',normalizedContent:'# lvmå·¥ä½åç\n\nlvmæ¯å¨ç£çååºåæä»¶ç³»ç»ä¹é´æ·»å çä¸ä¸ªé»è¾å±ï¼æ¥ä¸ºæä»¶ç³»ç»å±è½ä¸å±ç£çååºå¸å±ï¼æä¾ä¸ä¸ªæ½è±¡ççå·ï¼å¨çå·ä¸å»ºç«æä»¶ç³»ç»ãç®¡çåå©ç¨lvmå¯ä»¥å¨ç£çä¸ç¨éæ°ååºçæåµä¸å¨æè°æ´æä»¶ç³»ç»çå¤§å°ï¼å¹¶ä¸å©ç¨lvmç®¡ççæä»¶ç³»ç»å¯ä»¥è·¨è¶ç£çï¼å½æå¡å¨æ·»å äºæ°çç£çåï¼ç®¡çåä¸å¿å°åæçæä»¶ç§»å¨å°æ°çç£çä¸ï¼èæ¯éè¿lvmå¯ä»¥ç´æ¥æ©å±æä»¶ç³»ç»è·¨è¶ç£ç\n\nå®å°±æ¯éè¿å°åºå±çç©çç¡¬çå°è£èµ·æ¥ï¼ç¶åä»¥é»è¾å·çæ¹å¼åç°ç»ä¸å±åºç¨ãå¨lvmä¸­ï¼å¶éè¿å¯¹åºå±çç¡¬çè¿è¡å°è£ï¼å½æä»¬å¯¹åºå±çç©çç¡¬çè¿è¡æä½æ¶ï¼å¶ä¸åæ¯éå¯¹äºååºè¿è¡æä½ï¼èæ¯éè¿ä¸ä¸ªå«åé»è¾å·çä¸è¥¿æ¥å¯¹å¶è¿è¡åºå±çç£çç®¡çæä½ã\n\né»è¾å·ç®¡ççæ ¸å¿å¨äºå¦ä½å¤çæä»¬ç³»ç»ä¸­å®è£çç¡¬çåå¶ååºï¼å¯¹äºæä»¬çé»è¾å·ç®¡çå¨æ¥è¯´ï¼æç¡¬çå½ä½ç©çå·æ¥ç\n\n\n\n\n# lvmå¸¸ç¨çæ¯è¯­\n\nåæ¥äºè§£ä¸ä¸å¸¸ç¨çåè¯è§£é\n\n * ç©çå­å¨ä»è´¨ï¼theÂ physicalÂ mediaï¼\n\nè¿éæç³»ç»çå­å¨è®¾å¤æä»¶ï¼å¯æ¯ç£çååºï¼æ´ä¸ªç£çï¼raidéµåæsanç£çï¼è®¾å¤å¿é¡»åå§åä¸ºlvmç©çå·ï¼æè½ä¸lvmç»åä½¿ç¨\n\n * ç©çå·pvï¼physicalÂ volumeï¼\n\nç©çå·å°±æ¯æç¡¬çååºæä»é»è¾ä¸ä¸ç£çååºå·æåæ ·åè½çè®¾å¤(å¦raid)ï¼æ¯lvmçåºæ¬å­å¨é»è¾åï¼ä½ååºæ¬çç©çå­å¨ä»è´¨ï¼å¦ååºãç£çç­ï¼æ¯è¾ï¼å´åå«æä¸lvmç¸å³çç®¡çåæ°Â ï¼æ³¨åç©çè®¾å¤ä»¥ä¾¿å¨å·ç»ä¸­ä½¿ç¨ï¼,åå»ºç©çå·å®å¯ä»¥ç¨ç¡¬çååºï¼ä¹å¯ä»¥ç¨ç¡¬çæ¬èº«ï¼\n\n * å·ç»vgï¼volumeÂ groupï¼\n\nlvmå·ç»ç±»ä¼¼äºélvmç³»ç»ä¸­çç©çç¡¬çï¼ä¸ä¸ªlvmå·ç»ç±ä¸ä¸ªæå¤ä¸ªç©çå·ç»æ ï¬ï¬\n\n * é»è¾å·lvï¼logicalÂ volumeï¼\n\nç±»ä¼¼äºélvmç³»ç»ä¸­çç¡¬çååºï¼lvå»ºç«å¨vgä¹ä¸ï¼å¯ä»¥å¨lvä¹ä¸å»ºç«æä»¶ç³»ç»\n\n * peï¼physicalÂ extentsï¼\n\npvä¸­å¯ä»¥åéçæå°å­å¨ååï¼peçå¤§å°æ¯å¯ä»¥æå®çï¼é»è®¤ä¸º4mb\n\n * leï¼logicalÂ extentï¼\n\nlvä¸­å¯ä»¥åéçæå°å­å¨ååï¼å¨åä¸ä¸ªå·ç»ä¸­ï¼leçå¤§å°åpeæ¯ç¸åçï¼å¹¶ä¸ä¸ä¸å¯¹åº\n\n\n# lvmä¼ç¹\n\n * ä½¿ç¨å·ç»ï¼ä½¿å¤ä¸ªç¡¬çç©ºé´çèµ·æ¥åæ¯ä¸ä¸ªå¤§çç¡¬ç\n * ä½¿ç¨é»è¾å·ï¼å¯ä»¥è·¨å¤ä¸ªç¡¬çç©ºé´çååº sdb1 sdb2 sdc1 sdd2 sdf\n * å¨ä½¿ç¨é»è¾å·æ¶ï¼å®å¯ä»¥å¨ç©ºé´ä¸è¶³æ¶å¨æè°æ´å®çå¤§å°\n * å¨è°æ´é»è¾å·å¤§å°æ¶ï¼ä¸éè¦èèé»è¾å·å¨ç¡¬çä¸çä½ç½®ï¼ä¸ç¨æå¿æ²¡æå¯ç¨çè¿ç»­ç©ºé´\n * å¯ä»¥å¨çº¿å¯¹lv,vg è¿è¡åå»ºï¼å é¤ï¼è°æ´å¤§å°ç­æä½ãlvmä¸çæä»¶ç³»ç»ä¹éè¦éæ°è°æ´å¤§å°ã\n * å¯ä»¥å°æ­£å¨ä½¿ç¨ä¸­çç¡¬çè¿ç§»å°å«çç¡¬çä¸(emc--500g dell---1.2t)\n * åè®¸åå»ºå¿«ç§ï¼å¯ä»¥ç¨æ¥ä¿å­æä»¶ç³»ç»çå¤ä»½ãåªè½ä½¿ç¨ä¸æ¬¡\n\n> è§£éï¼\n> \n> lvmæ¯è½¯ä»¶çå·ç®¡çæ¹å¼ï¼èraidæ¯ç£çä¿æ¤çæ¹æ³ãå¯¹äºéè¦çä¸å¡æ¥è¯´ï¼ä¸è¬æ¯åæ¶å­å¨ãraidç¨æ¥ä¿æ¤ç©ççç£çä¸ä¼å ä¸ºæéèä¸­æ­ä¸å¡ãlvmç¨æ¥å®ç°å¯¹å·çè¯æ§çç®¡çï¼æ´å¥½çå©ç¨ç£çèµæº\n\n\n# åå»ºlvmçåºæ¬æ­¥éª¤\n\n 1. ååç©çå· pvcreate /dev/sdb1\n\n 2. æä¸åçç©çå·å å¥å°å·ç»å½ä¸­ vgcreate datavg /dev/sdb1\n\n 3. åå»ºé»è¾å· lvcreate\n\n 4. æ ¼å¼åæä»¶ç³»ç» mkfs.xfs\n\n 5. åå»ºæè½½ç¹å¹¶è¿è¡æè½½ mount\n\n> lvcreate -l +100%free æå®å¨é¨å¤§å°\n\nå¯¹extç±»åæä»¶ç³»ç»æ©å®¹ï¼ resize2fs\n\nå¯¹xfsç±»åæä»¶ç³»ç»æ©å®¹ï¼ xfs_growfs\n\nresize2fsåxfs_growfs ä¸¤èçåºå«æ¯ä¼ éçåæ°ä¸ä¸æ ·çï¼xfs_growfsæ¯éç¨çæè½½ç¹ï¼resize2fsæ¯é»è¾å·åç§°ï¼èä¸resize2fså½ä»¤ä¸è½å¯¹xfsç±»åæä»¶ç³»ç»ä½¿ç¨\n\n\n# lvmå é¤\n\nåå»º: pvcreate ---\x3e vgcreate ---\x3e lvcrdeate ---\x3e mkfs.xfs lv ----\x3e mount\n\nå é¤ï¼ umount ----\x3e lvremove lv -----\x3e vgremove vg -----\x3e pvremove\n\n\n# åºå±å­å¨æ´æ¢æ°å»ºpv pvcreate /dev/sdc1\n\næ©å®¹vg vgextend datavg /dev/sdc1\n\nç§»å¨æ°æ® pvmove /dev/sdb5 /dev/sdc1\n\nvgç¼©å° vgreduce datavg /dev/sdb5\n\nå é¤å°ç pvremove /dev/sdb5\n\n\n# æ©å®¹æä½\n\n1.fdisk /dev/vdc    //ç»æ°å çç¡¬çè®¾å¤/dev/vdcåå»ºååº(æ³¨æè®¾å¤åç§°ç¥æå·®å¼ï¼æ­¥éª¤åä¸)\n2.åå«ænãpã1ãtã8eãwr\n3.pvcreate /dev/vdc1\n4.vgextend vg0 /dev/vdd1\n5.lvextend -l +100%free /dev/vg0/lv0\n6. xfs_growfs  /dev/vg0/lv0\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# å¤§äº2tçæ©å®¹ä½¿ç¨\n\n1. ä½¿ç¨partedæ¹å¼æ ¼å¼åç£ç\n1.1 æ¥çç£çæåµ\n[root@jylhlog2 ~]# fdisk -l\ndisk /dev/sdd: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sdb: 42.9 gb, 42949672960 bytes, 83886080 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sdc: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sde: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sdf: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sda: 536.9 gb, 536870912000 bytes, 1048576000 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk label type: dos\ndisk identifier: 0x0008ce60\ndevice boot start end blocks id system\n/dev/sda1 * 2048 2099199 1048576 83 linux\n/dev/sda2 2099200 1048567807 523234304 8e linux lvm\ndisk /dev/mapper/vg_root-lv_root: 64.4 gb, 64424509440 bytes, 125829120 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-lv_swap: 68.7 gb, 68719476736 bytes, 134217728 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-lv_data: 209.4 gb, 209371267072 bytes, 408928256 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-lv_home: 64.4 gb, 64424509440 bytes, 125829120 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-oracle: 64.4 gb, 64424509440 bytes, 125829120 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-lv_grid: 64.4 gb, 64424509440 bytes, 125829120 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sdg: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\n[root@jylhlog2 ~]#\n1.2 ä½¿ç¨partedæ ¼å¼å/dev/sdgååº\n[root@jylhlog2 ~]# parted /dev/sdg\ngnu parted 3.1\nusing /dev/sdg\nwelcome to gnu parted! type âhelpâ to view a list of commands.\n(parted) mklabel gpt ------å°mbrååºå½¢å¼è½¬ä¸ºgptååºå½¢å¼\n(parted) mkpart primary xfs 0 -1 ------è®¾ç½®ååºçå¼å§ä½ç½®åç»æä½ç½®\nwarning: the resulting partition is not properly aligned for best performance.\nignore/cancel? ignore\n(parted) print ------æ¥çååº\nmodel: vmware virtual disk (scsi)\ndisk /dev/sdg: 2199gb\nsector size (logical/physical): 512b/512b\npartition table: gpt\ndisk flags:\nnumber start end size file system name flags\n1 17.4kb 2199gb 2199gb primary\n(parted) toggle 1 lvm ------ä½¿ç¨toggle æ´æ¹ç¡¬çç±»å\n(parted) print ------æ¥çååº\nmodel: vmware virtual disk (scsi)\ndisk /dev/sdg: 2199gb\nsector size (logical/physical): 512b/512b\npartition table: gpt\ndisk flags:\nnumber start end size file system name flags\n1 17.4kb 2199gb 2199gb primary lvm\n(parted) quit\ninformation: you may need to update /etc/fstab.\n[root@jylhlog2 ~]#\n1.3 æ¥çæ ¼å¼ååçååºæåµ\n[root@jylhlog2 ~]# fdisk -l\ndisk /dev/sdd: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sdb: 42.9 gb, 42949672960 bytes, 83886080 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sdc: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sde: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sdf: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sda: 536.9 gb, 536870912000 bytes, 1048576000 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk label type: dos\ndisk identifier: 0x0008ce60\ndevice boot start end blocks id system\n/dev/sda1 * 2048 2099199 1048576 83 linux\n/dev/sda2 2099200 1048567807 523234304 8e linux lvm\ndisk /dev/mapper/vg_root-lv_root: 64.4 gb, 64424509440 bytes, 125829120 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-lv_swap: 68.7 gb, 68719476736 bytes, 134217728 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-lv_data: 209.4 gb, 209371267072 bytes, 408928256 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-lv_home: 64.4 gb, 64424509440 bytes, 125829120 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-oracle: 64.4 gb, 64424509440 bytes, 125829120 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-lv_grid: 64.4 gb, 64424509440 bytes, 125829120 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\nwarning: fdisk gpt support is currently new, and therefore in an experimental phase. use at your own discretion.\ndisk /dev/sdg: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk label type: gpt\ndisk identifier: 9c5e039c-2c6c-4585-8eab-7b2dba949516\n# start end size type name\n1 34 4294965343 2t linux lvm primary\n[root@jylhlog2 ~]#\n1.4 ä½¿ç³»ç»éè¯»ååºè¡¨\n[root@jylhlog2 ~]# partprobe\nwarning: unable to open /dev/sr0 read-write (read-only file system). /dev/sr0 has been opened read-only.\n[root@jylhlog2 ~]#\n[root@jylhlog2 ~]# fdisk -l\ndisk /dev/sdd: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sdb: 42.9 gb, 42949672960 bytes, 83886080 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sdc: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sde: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sdf: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/sda: 536.9 gb, 536870912000 bytes, 1048576000 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk label type: dos\ndisk identifier: 0x0008ce60\ndevice boot start end blocks id system\n/dev/sda1 * 2048 2099199 1048576 83 linux\n/dev/sda2 2099200 1048567807 523234304 8e linux lvm\ndisk /dev/mapper/vg_root-lv_root: 64.4 gb, 64424509440 bytes, 125829120 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-lv_swap: 68.7 gb, 68719476736 bytes, 134217728 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-lv_data: 209.4 gb, 209371267072 bytes, 408928256 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-lv_home: 64.4 gb, 64424509440 bytes, 125829120 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-oracle: 64.4 gb, 64424509440 bytes, 125829120 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk /dev/mapper/vg_root-lv_grid: 64.4 gb, 64424509440 bytes, 125829120 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\nwarning: fdisk gpt support is currently new, and therefore in an experimental phase. use at your own discretion.\ndisk /dev/sdg: 2199.0 gb, 2199023255552 bytes, 4294967296 sectors\nunits = sectors of 1 * 512 = 512 bytes\nsector size (logical/physical): 512 bytes / 512 bytes\ni/o size (minimum/optimal): 512 bytes / 512 bytes\ndisk label type: gpt\ndisk identifier: 9c5e039c-2c6c-4585-8eab-7b2dba949516\n# start end size type name\n1 34 4294965343 2t linux lvm primary\n[root@jylhlog2 ~]#\n2. åå»ºpvãæ©å®¹vgãæ©å®¹lvãæ©å®¹xfsååº\n2.1 æ¥çç®åååºæåµ\n[root@jylhlog2 ~]# df -h\nfilesystem size used avail use% mounted on\n/dev/mapper/vg_root-lv_root 60g 6.2g 54g 11% /\ndevtmpfs 63g 0 63g 0% /dev\ntmpfs 63g 640m 63g 1% /dev/shm\ntmpfs 63g 32m 63g 1% /run\ntmpfs 63g 0 63g 0% /sys/fs/cgroup\n/dev/sda1 1014m 179m 836m 18% /boot\n/dev/mapper/vg_root-lv_grid 60g 40g 21g 66% /grid\n/dev/mapper/vg_root-lv_data 195g 595m 195g 1% /data\n/dev/mapper/vg_root-oracle 60g 22g 38g 37% /oracle\n/dev/mapper/vg_root-lv_home 60g 16g 45g 27% /home\ntmpfs 13g 12k 13g 1% /run/user/42\ntmpfs 13g 0 13g 0% /run/user/1000\n[root@jylhlog2 ~]#\n2.2 æ¥çç®ålvæåµ\n[root@jylhlog2 ~]# lvs\nlv vg attr lsize pool origin data% meta% move log cpy%sync convert\nlv_data vg_root -wi-ao---- 194.99g\nlv_grid vg_root -wi-ao---- 60.00g\nlv_home vg_root -wi-ao---- 60.00g\nlv_root vg_root -wi-ao---- 60.00g\nlv_swap vg_root -wi-ao---- 64.00g\noracle vg_root -wi-ao---- 60.00g\n[root@jylhlog2 ~]#\n2.3 æ¥çç®åvgæåµ\n[root@jylhlog2 ~]# vgs\nvg #pv #lv #sn attr vsize vfree\nvg_root 1 6 0 wzân- 498.99g 0\n[root@jylhlog2 ~]#\n2.4 åå»ºpv\n[root@jylhlog2 ~]# pvcreate /dev/sdg1\nphysical volume â/dev/sdg1â successfully created.\n[root@jylhlog2 ~]#\n2.5 æ©å®¹vg\n[root@jylhlog2 ~]# vgextend vg_root /dev/sdg1\nvolume group âvg_rootâ successfully extended\n[root@jylhlog2 ~]#\n2.6 æ¥çvgæ©å®¹æåµ\n[root@jylhlog2 ~]# vgs\nvg #pv #lv #sn attr vsize vfree\nvg_root 2 6 0 wzân- <2.49t <2.00t\n[root@jylhlog2 ~]#\n2.7 æ¥çæ©å®¹åvgå¤§å°æåµ\n[root@jylhlog2 ~]# vgdisplay\nâ volume group â\nvg name vg_root\nsystem id\nformat lvm2\nmetadata areas 2\nmetadata sequence no 8\nvg access read/write\nvg status resizable\nmax lv 0\ncur lv 6\nopen lv 6\nmax pv 0\ncur pv 2\nact pv 2\nvg size <2.49 tib\npe size 4.00 mib\ntotal pe 652029\nalloc pe / size 127742 / 498.99 gib\nfree pe / size 524287 / <2.00 tib\nvg uuid bv0qqr-vhfg-yntf-dbza-qjd1-ao3k-l02wip\n[root@jylhlog2 ~]#\n2.8 æ©å®¹lv\n[root@jylhlog2 ~]# lvextend -l +2097148m /dev/mapper/vg_root-lv_data\nsize of logical volume vg_root/lv_data changed from 194.99 gib (49918 extents) to 2.19 tib (574205 extents).\nlogical volume vg_root/lv_data successfully resized.\n[root@jylhlog2 ~]#\n2.9 æ¥çå®¹éååï¼åç°æä»¶ç³»ç»å¤§å°æ²¡æåå\n[root@jylhlog2 ~]# df -h\nfilesystem size used avail use% mounted on\n/dev/mapper/vg_root-lv_root 60g 6.2g 54g 11% /\ndevtmpfs 63g 0 63g 0% /dev\ntmpfs 63g 640m 63g 1% /dev/shm\ntmpfs 63g 32m 63g 1% /run\ntmpfs 63g 0 63g 0% /sys/fs/cgroup\n/dev/sda1 1014m 179m 836m 18% /boot\n/dev/mapper/vg_root-lv_grid 60g 40g 21g 66% /grid\n/dev/mapper/vg_root-lv_data 195g 595m 195g 1% /data\n/dev/mapper/vg_root-oracle 60g 22g 38g 37% /oracle\n/dev/mapper/vg_root-lv_home 60g 16g 45g 27% /home\ntmpfs 13g 12k 13g 1% /run/user/42\ntmpfs 13g 0 13g 0% /run/user/1000\n[root@jylhlog2 ~]#\n2.10 ä½¿ç¨xfs_growfsåæ­¥ç£çä¿¡æ¯\n[root@jylhlog2 ~]# xfs_growfs /dev/mapper/vg_root-lv_data\nmeta-data=/dev/mapper/vg_root-lv_data isize=512 agcount=4, agsize=12779008 blks\nâ = sectsz=512 attr=2, projid32bit=1\nâ = crc=1 finobt=0 spinodes=0\ndata = bsize=4096 blocks=51116032, imaxpct=25\nâ = sunit=0 swidth=0 blks\nnaming =version 2 bsize=4096 ascii-ci=0 ftype=1\nlog =internal bsize=4096 blocks=24959, version=2\nâ = sectsz=512 sunit=0 blks, lazy-count=1\nrealtime =none extsz=4096 blocks=0, rtextents=0\ndata blocks changed from 51116032 to 587985920\n[root@jylhlog2 ~]#\n2.11 æ¥çå®¹éååï¼åç°æä»¶ç³»ç»å·²æ©å®¹æå\n[root@jylhlog2 ~]# df -h\nfilesystem size used avail use% mounted on\n/dev/mapper/vg_root-lv_root 60g 6.2g 54g 11% /\ndevtmpfs 63g 0 63g 0% /dev\ntmpfs 63g 640m 63g 1% /dev/shm\ntmpfs 63g 32m 63g 1% /run\ntmpfs 63g 0 63g 0% /sys/fs/cgroup\n/dev/sda1 1014m 179m 836m 18% /boot\n/dev/mapper/vg_root-lv_grid 60g 40g 21g 66% /grid\n/dev/mapper/vg_root-lv_data 2.2t 597m 2.2t 1% /data\n/dev/mapper/vg_root-oracle 60g 22g 38g 37% /oracle\n/dev/mapper/vg_root-lv_home 60g 16g 45g 27% /home\ntmpfs 13g 12k 13g 1% /run/user/42\ntmpfs 13g 0 13g 0% /run/user/1000\n[root@jylhlog2 ~]#\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n286\n287\n288\n289\n290\n291\n292\n293\n294\n295\n296\n297\n298\n299\n300\n301\n302\n303\n304\n305\n306\n307\n308\n309\n310\n311\n312\n313\n314\n315\n316\n317\n318\n319\n320\n321\n322\n323\n324\n325\n326\n327\n328\n329\n330\n331\n332\n333\n334\n335\n336\n337\n338\n339\n340\n341\n\n\n> å¦æsdb1æ¯ä¸ä¸ªç£çéµåï¼èè¿ä¸ªç£çéµåä½¿ç¨å¹´ä»£å¤ªä¹ï¼æä»¬å¿é¡»ç§»åºæä¹åï¼\n> \n> ç§»å¨æ°æ®ï¼ [root@test1 ~]# pvmove /dev/sdb1 /dev/sdb3 #å°sdb1ä¸æ°æ®ç§»å°æ°å¢å sdb3 pv ä¸ /dev/sdb1: moved: 23.53% /dev/sdb1: moved: 76.47% /dev/sdb1: moved: 100.00% [root@test1 ~]# vgreduce vg01 /dev/sdb1 #ç§»å®æ°æ®åç§»åº removed "/dev/sdb1" from volume group "vg01" [root@test1 ~]# pvs pv vg fmt attr psize pfree /dev/sdb1 lvm2 --- 1.00g 1.00g /dev/sdb2 vg02 lvm2 a-- 1008.00m 1008.00m /dev/sdb3 vg01 lvm2 a-- 1020.00m 952.00m #vg01ä¸­åªæsdb3äº',charsets:{cjk:!0}},{title:"sudoæéè§å",frontmatter:{title:"sudoæéè§å",date:"2022-12-15T18:49:07.000Z",permalink:"/pages/0bac05/",categories:["è¿ç»´","linuxç³»ç»"],tags:[null],feed:{enable:!0},description:"sudoæéè§å",readingShow:"top",meta:[{name:"twitter:title",content:"sudoæéè§å"},{name:"twitter:description",content:"sudoæéè§å"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/05.sudo%E6%9D%83%E9%99%90%E8%A7%84%E5%88%92.html"},{property:"og:type",content:"article"},{property:"og:title",content:"sudoæéè§å"},{property:"og:description",content:"sudoæéè§å"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/05.sudo%E6%9D%83%E9%99%90%E8%A7%84%E5%88%92.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T18:49:07.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"sudoæéè§å"},{itemprop:"description",content:"sudoæéè§å"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/01.linux/05.sudo%E6%9D%83%E9%99%90%E8%A7%84%E5%88%92.html",relativePath:"04.è¿ç»´/01.linux/05.sudoæéè§å.md",key:"v-ba2529e4",path:"/pages/0bac05/",headersStr:null,content:'ä¸ é®é¢ç®è¿°\n\néçå¬å¸çæå¡å¨è¶æ¥è¶å¤,äººåæµå¨æ§ä¹å¼å§ä¸æ¥ä¿±å¢,ä»¥å¾ç®¡çæå¡å¨çéæ§ææ³ï¼rootæééæç»åºï¼å¼åãæµè¯ãè¿ç»´å±ç¨åä¸è´¦å·ï¼åºå½æå¼,å¬å¸éè¦ææ´å¥½æ´å®åçæéä½ç³»,ç»è¿å¤è½®æ²éååå,å¬å¸ä¸è´å³å®éæ°æ´çè§åæéä½ç³»ãè¿ç»´ä¸»ç®¡æç¡®æåºæéå­å¨çé®é¢,å¹¶éè¦è§£å³ä»¥å¾çrootæéæ³æ»¥é®é¢ã\n\næä½ä¸ºæ¬æ¬¡æéè§åçåèµ·äºº,æé¦åäºè§£å°å¬å¸æå¡å¨æéç°ç¶å,ç»è¿å¤æ¬¡ä¸ç¸å³åå·¥åé¢å¯¼æ²é,ç¡®è®¤äºå¬å¸å­å¨çé¨åé®é¢:è¿ç»´é¨åºæ¬å¥èç¦»èæµç¨ä¸­å­å¨ä¸äºè´¦å·é®é¢ï¼å¦ï¼ç¦»èä¸æ¥å¤,ç³»ç»æéä¸åæ¶ãè´¦å·å¯ç è¿äºç®ååç­ãrootæééæç»å¼ååæµè¯ã\n\nä»¥ä¸é®é¢æ çç»å¬å¸çæå¡å¨åæ°æ®å®å¨é æäºä¸å°çéæ£ãå æ­¤ä¸æå°è¯¦è§£æ­¤æ¬¡å³äºæéååçæ¹æ¡ã\n\nå¬å¸æå¤ä¸ªé¨é¨ä½¿ç¨æä»¬æä¾çlinuxæå¡å¨ä»¥åå¼éçè´¦å·:å®å¨æéæ²¡æè¿è¡åçè§å,å æ­¤ææåºæ´å å®å¨çè´¦å·ç®¡çæ¹å¼:â é¢ç¨è´¦å·æéæµç¨ï¼â¡å½ä»¤æ§è¡ä»¥sudoææå½¢å¼ã\n\nä¼å¿: å®å¯ä»¥å¯¹è´¦å·è¿è¡è¯¦ç»çæéåå±åå,ç»æå¡å¨å¸¦æ¥äºæ´å¥½çå®å¨ä¿éï¼å¬å¸æçº§å«ä¸åçè¿ç»´äººå,æä»¬éè¦å¯¹å¶æéæ´çåå,æ ¹æ®èè´£è½åæä»¬è§åæéä¸ºåçº§ãä¸­çº§ãé«çº§ãèå¶ä»é¨é¨ï¼å¦å¼åãæµè¯ç­é¨é¨éåæå¡å¨è´¦å·æéæµç¨ãè¿æ ·æå©äºæéæå°åæ§å¶ï¼é¿åå æéæ»¥ç¨å¯¼è´æå¡è¿è¡ä¸ç¨³å®ï¼éç½®éæä¿®æ¹ï¼ä¸è§èæä½ç­å®å¨éæ£ãä¸ºåç»­æ¥å¿å®¡è®¡ç­æº¯æºï¼åæå¥ å®åºç¡ã\n\näº æéè§åè¡¨åææ¯äººåéå¤æåµ\n\n1.æéè§åè¡¨\n\nâ è¿ç»´ç»æéè§åè¡¨\n\n       \nçº§å«     æé\nåçº§è¿ç»´   æ¥çç³»ç»ãç½ç»ãæå¡ãè¿ç¨ç¶æä¿¡æ¯ï¼\n       /bin/hostname,/sbin/ifconfig,/bin/netstat,/sbin/route,/sbin/ip,/bin/ping,\n       /usr/bin/sar,/usr/bin/free,\n       Â \n       /usr/bin/vmstat,/usr/bin/mpstat,/usr/bin/iostat,/usr/sbin/iotop,/usr/bin/top,/bin/ps\né«çº§è¿ç»´   æ¥çåä¿®æ¹ç³»ç»ãç½æ ¼ãæå¡ãè¿ç¨ç¶æéç½®ä¿¡æ¯ï¼è½¯ä»¶åç®¡çï¼å­å¨ç®¡ç\n       \n       /bin/hostname,/sbin/ifconfig,/bin/netstat,/sbin/route,/sbin/ip,/usr/bin/sar,\n       /usr/bin/free, /usr/bin/vmstat,\n       /usr/bin/mpstat,/usr/bin/iostat,/usr/sbin/iotop,/usr/bin/top,\n       /bin/ps,/sbin/iptables,/etc/init.d/network,/bin/nice,/bin/kill,/usr/bin/kill,\n       /usr/bin/killall,/bin/rpm,/usr/bin/up2date,/usr/bin/yum,/sbin/fdisk,/sbin/sfdisk,\n       /sbin/parted,/sbin/partprobe,/bin/mount,/bin/umount\nè¿ç»´ç»ç   è¶çº§ç¨æ·æææé\n       \n       Â Â ALL\n\nâ¡å¼åç»æéæ¨¡æ¿\n\n       \nçº§å«     æé\nåçº§å¼å   rootçæ¥çæéï¼å¯¹åºæå¡æ¥çæ¥å¿çæé\n       \n       Â  /usr/bin/tail /app/log*,/bin/grep\n       /app/log*,/bin/cat,/bin/ls\né«çº§å¼å   rootçæ¥çæéï¼å¯¹åºæå¡æ¥çæ¥å¿çæéï¼éå¯å¯¹åºæå¡çæé\n       \n       /sbin/service,/sbin/chkconfig,/usr/bin/tail\n       /app/log*,/bin/grep Â  /app/log*,/bin/cat,/bin/ls,Â /bin/sh\n       ~/scripts/deploy.sh\nå¼åç»ç   é¡¹ç®æå¨æå¡å¨çALLæéï¼ä¸è½ä¿®æ¹rootå¯ç \n       \n       Â  ALL,!/usr/bin/passwd root,!/usr/sbin/visudo,!/usr/bin/vim\n       Â  /etc/sudoers\n\nâ¢æµè¯ç»æéæ¨¡æ¿\n\n     \nçº§å«   æé\næµè¯   æ®éç¨æ·çæé\n     \n     ä¸å å¥sudoåè¡¨\n\nâ£DBAç»æéæ¨¡æ¿\n\n        \nçº§å«      æé\nåçº§DBA   æ®éç¨æ·çæé\n        \n        ä¸å å¥sudoåè¡¨\né«çº§DBA   é¡¹ç®æå¨æ°æ®åºæå¡å¨çALLæé\n        \n        Â Â ALL,!/usr/bin/passwd root,!/usr/sbin/visudo,!/usr/bin/vim\n        Â  /etc/sudoers\n\nâ¤ç½ç»ç»æéæ¨¡æ¿\n\n       \nçº§å«     æé\nåçº§ç½å·¥   æ®éç¨æ·çæé\n       \n       ä¸å å¥sudoåè¡¨\né«çº§ç½å·¥   é¡¹ç®æå¨æå¡å¨çæå³ç½ç»éç½®çæé\n       \n       Â \n       /sbin/route,/sbin/ifconfig,/bin/ping,/sbin/dhclient,/usr/bin/net,\n       /sbin/ip,/sbin/iptables,/usr/bin/rfcomm,/usr/bin/wvdial,/sbin/iwconfig,/sbin/mii-tool,/bin/cat\n       /var/log/,/usr/bin/vim Â  /etc/sysconfig/network-scripts/\n\n2.å¬å¸ç®åçææ¯äººåéå¤æåµ\n\nè¿ç»´ç»ï¼5ä¸ªåçº§è¿ç»´ï¼2ä¸ªé«çº§è¿ç»´ï¼1ä¸ªè¿ç»´ç»ç\n\nå¼åç»ï¼3ä¸ªåçº§å¼åäººåï¼1ä¸ªé«çº§å¼åï¼1ä¸ªå¼åç»ç\n\næµè¯ç»ï¼2ä¸ªæµè¯å·¥ç¨å¸ï¼æµè¯ç»ä¸å å¥sudoï¼\n\nDBAç»ï¼3ä¸ªåçº§DBAï¼åçº§DBAä¸å å¥sudoï¼ï¼1ä¸ªé«çº§DBA\n\nç½ç»ç»ï¼2ä¸ªåçº§ç½å·¥ï¼åçº§DBAä¸å å¥sudoï¼ï¼1ä¸ªé«çº§ç½å·¥\n\nä¸ å½ä»¤è®²è§£\n\nåå»ºç¨æ·\n\nuseradd yw && echo "123456" | passwd --stdin yw\n\nåå»ºywç¨æ·,ç¶åè¾åºä¸ä¸ª123456äº¤passwdä½ä¸ºywç¨æ·çå¯ç \n\nfor n in seq 21 25;do useradd user$n;echo "user$necho user$n|md5sum|cut -c4-8"|passwd --stdin user$n;done\n\nç¨forå¾ªç¯æ¥åå»ºç¨æ·è´¦å·åå¯ç : seq 21 25åå»º5ä¸ªæ°å­ï¼21ï¼22ï¼23ï¼24ï¼25ï¼ï¼n å°±ä»£è¡¨è¿5ä¸ªæ°å­ï¼åé¢çåå»ºç¨æ·æ¥çuser$nå°±æ¯ä»¥userå¼å¤´æ¥nï¼\n\nç¶å echo è¾åºç¨æ·åçmd5ï¼ä½¿ç¨cut ååº4-8åçå­ç¬¦äº¤ç»passwd --stdinæ¥ä¸ºæ¯ä½ç¨æ·éç½®ä¸åçå¯ç ,ä»ä»¬çå¯ç é½æ¯ç¨æ·åçmd5å¼ç4è³8ä½å­ç¬¦ä¸²ã\n\nå é¤ç¨æ·\n\nuserdel yw\n\nå é¤ywç¨æ·\n\nfor n in seq 21 25;do userdel -r user$n;done\n\nç¨forå¾ªç¯å é¤ç¨æ·\n\næ¥çèªå·±çsudoæéï¼sudo -l\n\nâ¦â¦\n\nâ¦â¦\n\nå å®æ½å½ä»¤èæ¬\n\nä¸¾ä¾ï¼å¨å¬å¸æ¶æ ¹æ®å®éæåµç¼åç¨æ·è´¦å·å¯ç åç¸åºæéï¼æ­¤å¤æ ¹æ®ä¸è¿°æéè§åè¡¨ä¸ºä¾ã\n\n1.åå»ºç¨æ·ç»åç¨æ·ï¼\n\n#è¿ç»´ç»ãå¼åç»ãæµè¯ç»ãDBAç»ãç½ç»ç»\n\ngroupadd chujiyunwei -g 1100\n\ngroupadd gaojiyunwei -g 1110\n\ngroupadd yunweijingli -g 1120\n\ngroupadd chujikaifa -g 1200\n\ngroupadd gaojikaifa -g 1210\n\ngroupadd kaifajingli -g 1220\n\ngroupadd ceshi -g 1300\n\ngroupadd chujidba -g 1400\n\ngroupadd gaojidba -g 1410\n\ngroupadd chujinetwork -g 1500\n\ngroupadd gaojinetwork -g 1510\n\n#-----------------------------------------------------------------------------\n\n#è¿ç»´ç»ï¼5ä¸ªåçº§è¿ç»´ï¼2ä¸ªé«çº§è¿ç»´ï¼1ä¸ªè¿ç»´ç»ç\n\n#-----------------------------------------------------------------------------\n\nfor n in seq 1 5;do useradd chujiyunwei$n -g 1100;echo "123456" | passwd --stdin chuji$n;done\n\n#åå»º5ä¸ªåçº§è¿ç»´è´¦æ·å¹¶éç½®äºå¯ç \n\nfor n in seq 1 2;do useradd gaojiyunwei$n -g 1110;echo "123456" | passwd --stdin gaoji$n;done\n\n#åå»º2ä¸ªé«çº§è¿ç»´çç¨æ·åå¯ç \n\nuseradd yunweijingli -g 1120 && echo 123456 | passwd --stdin yunweijingli\n\n#åå»º1ä¸ªè¿ç»´ç»ççè´¦å·åå¯ç \n\n#-----------------------------------------------------------------------------\n\n#å¼åç»ï¼3ä¸ªåçº§å¼åäººåï¼1ä¸ªé«çº§å¼åï¼1ä¸ªå¼åç»ç\n\n#-----------------------------------------------------------------------------\n\nfor n in seq 1 3;do useradd chujikaifa$n -g 1200;echo "123456" | passwd --stdin chujikaifa$n;done\n\n#åå»º3ä¸ªåçº§å¼åè´¦æ·å¹¶éç½®äºå¯ç \n\nuseradd gaojikaifa1 -g 1210 && echo "123456" | passwd --stdin gaojikaifa1\n\n#åå»º1ä¸ªé«çº§å¼åçç¨æ·åå¯ç \n\nuseradd kaifajingli -g 1220 && echo 123456 | passwd --stdin kaifajingli\n\n#åå»º1ä¸ªå¼åç»ççè´¦å·åå¯ç \n\n#-----------------------------------------------------------------------------\n\n#æµè¯ç»ï¼2ä¸ªæµè¯\n\n#-----------------------------------------------------------------------------\n\nfor n in seq 1 2;do useradd ceshi$n -g 1300;echo "123456" | passwd --stdin ceshi$n;done\n\n#åå»º2ä¸ªæµè¯è´¦å·åå¯ç \n\n#-----------------------------------------------------------------------------\n\n#DBAç»ï¼3ä¸ªåçº§DBAï¼1ä¸ªé«çº§DBA\n\n#-----------------------------------------------------------------------------\n\nfor n in seq 1 3;do useradd chujidba$n -g 1400;echo "123456" | passwd --stdin chujidba$n;done\n\n#åå»º3ä¸ªåçº§dba è´¦å·åå¯ç \n\nuseradd gaojidba1 -g 1410&& echo 123456 | passwd --stdin gaojidba1\n\n#åå»º1ä¸ªé«çº§dbaè´¦å·åå¯ç \n\n#-----------------------------------------------------------------------------\n\n#ç½å·¥ç»ï¼2ä¸ªåçº§ç½å·¥ï¼1ä¸ªé«çº§ç½å·¥\n\n#-----------------------------------------------------------------------------\n\nfor n in seq 1 2;do useradd chujinetwork$n -g 1500;echo "123456" | passwd --stdin chujinetwork$n;done\n\n#åå»º2ä¸ªåçº§ç½å·¥\n\nuseradd gaojinetwork1 -g 1510 && echo 123456 | passwd --stdin gaojinetwork1\n\n#åå»º1ä¸ªé«çº§ç½å·¥\n\n2.éç½®/etc/sudoersæä»¶\n\ncat >>/etc/sudoers<<EOF\n\n#éç½®ç¨æ·ç»å«å:\n\nUser_Alias CHUJIYUNWEI = %chujiyunwei\n\nUser_Alias GAOJIYUNWEI = %gaojiyunwei\n\nUser_Alias YUNWEIJINGLI = %yunweijingli\n\nUser_Alias CHUJIKAIFA = %chujikaifa\n\nUser_Alias GAOJIKAIFA = %gaojikaifa\n\nUser_Alias KAIFAJINGLI = %kaifajingli\n\nUser_Alias CESHI= %ceshi\n\nUser_Alias CHUJIDBA = %chujidba\n\nUser_Alias GAOJIDBA = %gaojidba\n\nUser_Alias CHUJINETWORK = %chujinetwork\n\nUser_Alias GAOJINETWORK = %gaojinetwork\n\n#éç½®å½ä»¤å«åï¼\n\nCmnd_Alias CHUJIYUNWEI_CMD =Â  /bin/hostname,/sbin/ifconfig,/bin/netstat,/sbin/route,/sbin/ip,/bin/ping,/usr/bin/sar,/usr/bin/free, /usr/bin/vmstat,/usr/bin/mpstat,/usr/bin/iostat,/usr/sbin/iotop,/usr/bin/top,/bin/ps\n\nCmnd_Alias GAOJIYUNWEI_CMD =Â  /bin/hostname,/sbin/ifconfig,/bin/netstat,/sbin/route,/sbin/ip,/usr/bin/sar,/usr/bin/free,/usr/bin/vmstat,/usr/bin/mpstat,/usr/bin/iostat,/usr/sbin/iotop,/usr/bin/top,/bin/ps,/sbin/iptables,/etc/init.d/network,/bin/nice,/bin/kill,/usr/bin/kill,/usr/bin/killall,/bin/rpm,/usr/bin/up2date,/usr/bin/yum,/sbin/fdisk,/sbin/sfdisk,/sbin/parted,/sbin/partprobe,/bin/mount,/bin/umount\n\nCmnd_Alias YUNWEIJINGLI_CMD =Â  ALL\n\nCmnd_Alias CHUJIKAIFA_CMD =Â  /usr/bin/tail /app/log*,/bin/grep /app/log*,/bin/cat,/bin/ls\n\nCmnd_Alias GAOJIKAIFA_CMD =Â  /sbin/service,/sbin/chkconfig,/usr/bin/tail /app/log*,/bin/grep /app/log*,/bin/cat,/bin/ls, /bin/sh ~/scripts/deploy.sh\n\nCmnd_Alias KAIFAJINGLI_CMD =Â  ALL,!/usr/bin/passwd root,!/usr/sbin/visudo,!/usr/bin/vim /etc/sudoers\n\nCmnd_Alias CESHI_CMD =Â  /usr/bin/uname\n\nCmnd_Alias CHUJIDBA_CMD =Â  /usr/bin/uname\n\nCmnd_Alias GAOJIDBA_CMD =Â  ALL,!/usr/bin/passwd root,!/usr/sbin/visudo,!/usr/bin/vim /etc/sudoers\n\nCmnd_Alias CHUJINETWORK_CMD =Â  /usr/bin/uname\n\nCmnd_Alias GAOJINETWORK_CMD =Â  /sbin/route,/sbin/ifconfig,/bin/ping,/sbin/dhclient,/usr/bin/net,/sbin/ip,/sbin/iptables,/usr/bin/rfcomm,/usr/bin/wvdial,/sbin/iwconfig,/sbin/mii-tool,/bin/cat /var/log/,/usr/bin/vim /etc/sysconfig/network-scripts/\n\n#ç¨æ·ç»è½è·åå°çæé\n\nRunas_Alias CHUJIYUNWEI = root\n\nRunas_Alias GAOJIYUNWEI = root\n\nRunas_Alias YUNWEIJINGLI = root\n\nRunas_Alias CHUJIKAIFA = root\n\nRunas_Alias GAOJIKAIFA = root\n\nRunas_Alias KAIFAJINGLI = root\n\nRunas_Alias CESHI = root\n\nRunas_Alias CHUJIDBA = root\n\nRunas_Alias GAOJIDBA = root\n\nRunas_Alias CHUJINETWORK = root\n\nRunas_Alias GAOJINETWORK = root\n\n#ç¨æ·ç»æéå¯¹åºå³ç³»\n\nCHUJIYUNWEI ALL=(CHUJIYUNWEI) CHUJIYUNWEI_CMD\n\nGAOJIYUNWEI ALL=(GAOJIYUNWEI) GAOJIYUNWEI_CMD\n\nYUNWEIJINGLI ALL=(YUNWEIJINGLI) YUNWEIJINGLI_CMD\n\nCHUJIKAIFA ALL=(CHUJIKAIFA) CHUJIKAIFA_CMD\n\nGAOJIKAIFA ALL=(GAOJIKAIFA) GAOJIKAIFA_CMD\n\nKAIFAJINGLI ALL=(KAIFAJINGLI) KAIFAJINGLI_CMD\n\nCESHI ALL=(CESHI) CESHI_CMD\n\nCHUJIDBA ALL=(CHUJIDBA) CHUJIDBA_CMD\n\nGAOJIDBA ALL=(GAOJIDBA) GAOJIDBA_CMD\n\nCHUJINETWORK ALL=(CHUJINETWORK) CHUJINETWORK_CMD\n\nGAOJINETWORK ALL=(GAOJINETWORK) GAOJINETWORK_CMD\n\nEOF\n\näº æéé¢ç¨æµç¨\n\n1.Â Â  é¢ç¨æµç¨\n\nâ  é¢ç¨äººåèµ·æéé¢ç¨æµç¨ï¼å¡«åæééç½®åæ´ç³è¯·è¡¨ï¼äº¤ç±è¿ç»´äººåå®¡æ ¸ã\n\nâ¡ è¿ç»´äººåå®¡æ ¸æ²¡æé®é¢åç¥è¿ç»´ä¸»ç®¡ï¼ç±è¿ç»´ä¸»ç®¡å¼æ¾æéã\n\n2.éç½®æ´åç³è¯·è¡¨\n\n                                                                                            \néç½®åæ´ç³è¯·è¡¨                                                                                     \n*ä»¥ä¸ç³è¯·é¨é¨å¡«å                                                                          å¡«è¡¨æ¥æï¼    \nç³è¯·é¨é¨                                                                                        \nç³Â è¯·Â äºº                                                                              èç³»æ¹å¼     \nç³è¯·æµè¯æ¥æ                                                                   å¹´Â Â æÂ Â æ¥   ç³è¯·å®æ½æ¥æ   \nå®æ½é¨é¨                                                                                        \nå®æ½èç³»äºº                                                                              èç³»æ¹å¼     \nåæ´ç®çï¼                                                                                       \nåæ´åå®¹ï¼ï¼å¦åå®¹è¾å¤ï¼è¯·å¦éé¡µè¯´æï¼                                                                         \nç³è¯·é¨é¨                                        å£Â ä¸è¬åæ´Â Â Â Â å£Â éå¤§åæ´Â Â Â Â å£Â ç´§æ¥åæ´                      \n\næÂ Â Â è§\nç­¾ç« ï¼Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  æ¥æï¼Â Â Â Â Â Â å¹´Â Â Â Â æÂ Â Â Â æ¥                                                   \n*ä»¥ä¸ä¸ºè¿ç»´åä½å¡«å                                                                                  \nè¿ç»´åä½                                        å£Â ä¸è¬åæ´Â Â Â Â å£Â éå¤§åæ´Â Â Â Â å£Â ç´§æ¥åæ´                      \n\næÂ Â Â è§\nå£Â åæç³è¯·å®æ½æ¥æÂ Â Â Â Â å£Â è¯·å¨ä»¥ä¸æ¥ææ§è¡ï¼Â Â Â Â  å¹´Â  æÂ  æ¥                                                      \nç­¾ç« ï¼Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  æ¥æï¼Â Â Â Â Â Â å¹´Â Â Â Â æÂ Â Â Â æ¥                                                   \n*ä»¥ä¸ä¸ºå®æ½äººå¡«å                                                                                   \nè¿ç»´åä½                                                                                        \n\nå¤çç»æ\nç­¾ç« ï¼Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  æ¥æï¼Â Â Â Â Â Â å¹´Â Â Â Â æÂ Â Â Â æ¥                                                   \n\næ³¨ï¼ 1ãè¯¥ç³è¯·ééå¸¦éæ±æ¥åãå¼åååæ´è®¡åãåæ´æ¹æ¡æä½æ­¥éª¤è¯¦è§£ãç¨æ·æµè¯æ¥åãæºä»£ç æèæ¬ç­ççº¸è´¨æä»¶ï¼åæä½ææ¶åå°ççµå­æä»¶ç¨ä»¥å­æ¡£ã\n\n2ãåæ´æ¹æ¡éåæ¬åæ´æ­¥éª¤è¯¦è§£ãåæ´æåæ å¿ãåæ»æ¹æ¡ç­ã\n\nï¼ä¾å­ï¼\n\ngroupadd loguser -g 1003\n\nuseradd loguser -g 1003 && echo "############" | passwd --stdin loguser\n\ncat >>/etc/sudoers<<EOF\n\nUser_Alias LOGUSER = %loguser\n\nCmnd_Alias LOGUSER_CMD = /sbin/service,/sbin/chkconfig,/usr/bin/tail,/bin/grep,/bin/cat,/bin/ls, /bin/sh,/bin/vim,/bin/less,/usr/bin/docker\n\nRunas_Alias LOGUSER = root\n\nLOGUSER ALL=(LOGUSER) NOPASSWD:LOGUSER_CMD\n\nEOF',normalizedContent:'ä¸ é®é¢ç®è¿°\n\néçå¬å¸çæå¡å¨è¶æ¥è¶å¤,äººåæµå¨æ§ä¹å¼å§ä¸æ¥ä¿±å¢,ä»¥å¾ç®¡çæå¡å¨çéæ§ææ³ï¼rootæééæç»åºï¼å¼åãæµè¯ãè¿ç»´å±ç¨åä¸è´¦å·ï¼åºå½æå¼,å¬å¸éè¦ææ´å¥½æ´å®åçæéä½ç³»,ç»è¿å¤è½®æ²éååå,å¬å¸ä¸è´å³å®éæ°æ´çè§åæéä½ç³»ãè¿ç»´ä¸»ç®¡æç¡®æåºæéå­å¨çé®é¢,å¹¶éè¦è§£å³ä»¥å¾çrootæéæ³æ»¥é®é¢ã\n\næä½ä¸ºæ¬æ¬¡æéè§åçåèµ·äºº,æé¦åäºè§£å°å¬å¸æå¡å¨æéç°ç¶å,ç»è¿å¤æ¬¡ä¸ç¸å³åå·¥åé¢å¯¼æ²é,ç¡®è®¤äºå¬å¸å­å¨çé¨åé®é¢:è¿ç»´é¨åºæ¬å¥èç¦»èæµç¨ä¸­å­å¨ä¸äºè´¦å·é®é¢ï¼å¦ï¼ç¦»èä¸æ¥å¤,ç³»ç»æéä¸åæ¶ãè´¦å·å¯ç è¿äºç®ååç­ãrootæééæç»å¼ååæµè¯ã\n\nä»¥ä¸é®é¢æ çç»å¬å¸çæå¡å¨åæ°æ®å®å¨é æäºä¸å°çéæ£ãå æ­¤ä¸æå°è¯¦è§£æ­¤æ¬¡å³äºæéååçæ¹æ¡ã\n\nå¬å¸æå¤ä¸ªé¨é¨ä½¿ç¨æä»¬æä¾çlinuxæå¡å¨ä»¥åå¼éçè´¦å·:å®å¨æéæ²¡æè¿è¡åçè§å,å æ­¤ææåºæ´å å®å¨çè´¦å·ç®¡çæ¹å¼:â é¢ç¨è´¦å·æéæµç¨ï¼â¡å½ä»¤æ§è¡ä»¥sudoææå½¢å¼ã\n\nä¼å¿: å®å¯ä»¥å¯¹è´¦å·è¿è¡è¯¦ç»çæéåå±åå,ç»æå¡å¨å¸¦æ¥äºæ´å¥½çå®å¨ä¿éï¼å¬å¸æçº§å«ä¸åçè¿ç»´äººå,æä»¬éè¦å¯¹å¶æéæ´çåå,æ ¹æ®èè´£è½åæä»¬è§åæéä¸ºåçº§ãä¸­çº§ãé«çº§ãèå¶ä»é¨é¨ï¼å¦å¼åãæµè¯ç­é¨é¨éåæå¡å¨è´¦å·æéæµç¨ãè¿æ ·æå©äºæéæå°åæ§å¶ï¼é¿åå æéæ»¥ç¨å¯¼è´æå¡è¿è¡ä¸ç¨³å®ï¼éç½®éæä¿®æ¹ï¼ä¸è§èæä½ç­å®å¨éæ£ãä¸ºåç»­æ¥å¿å®¡è®¡ç­æº¯æºï¼åæå¥ å®åºç¡ã\n\näº æéè§åè¡¨åææ¯äººåéå¤æåµ\n\n1.æéè§åè¡¨\n\nâ è¿ç»´ç»æéè§åè¡¨\n\n       \nçº§å«     æé\nåçº§è¿ç»´   æ¥çç³»ç»ãç½ç»ãæå¡ãè¿ç¨ç¶æä¿¡æ¯ï¼\n       /bin/hostname,/sbin/ifconfig,/bin/netstat,/sbin/route,/sbin/ip,/bin/ping,\n       /usr/bin/sar,/usr/bin/free,\n       Â \n       /usr/bin/vmstat,/usr/bin/mpstat,/usr/bin/iostat,/usr/sbin/iotop,/usr/bin/top,/bin/ps\né«çº§è¿ç»´   æ¥çåä¿®æ¹ç³»ç»ãç½æ ¼ãæå¡ãè¿ç¨ç¶æéç½®ä¿¡æ¯ï¼è½¯ä»¶åç®¡çï¼å­å¨ç®¡ç\n       \n       /bin/hostname,/sbin/ifconfig,/bin/netstat,/sbin/route,/sbin/ip,/usr/bin/sar,\n       /usr/bin/free, /usr/bin/vmstat,\n       /usr/bin/mpstat,/usr/bin/iostat,/usr/sbin/iotop,/usr/bin/top,\n       /bin/ps,/sbin/iptables,/etc/init.d/network,/bin/nice,/bin/kill,/usr/bin/kill,\n       /usr/bin/killall,/bin/rpm,/usr/bin/up2date,/usr/bin/yum,/sbin/fdisk,/sbin/sfdisk,\n       /sbin/parted,/sbin/partprobe,/bin/mount,/bin/umount\nè¿ç»´ç»ç   è¶çº§ç¨æ·æææé\n       \n       Â Â all\n\nâ¡å¼åç»æéæ¨¡æ¿\n\n       \nçº§å«     æé\nåçº§å¼å   rootçæ¥çæéï¼å¯¹åºæå¡æ¥çæ¥å¿çæé\n       \n       Â  /usr/bin/tail /app/log*,/bin/grep\n       /app/log*,/bin/cat,/bin/ls\né«çº§å¼å   rootçæ¥çæéï¼å¯¹åºæå¡æ¥çæ¥å¿çæéï¼éå¯å¯¹åºæå¡çæé\n       \n       /sbin/service,/sbin/chkconfig,/usr/bin/tail\n       /app/log*,/bin/grep Â  /app/log*,/bin/cat,/bin/ls,Â /bin/sh\n       ~/scripts/deploy.sh\nå¼åç»ç   é¡¹ç®æå¨æå¡å¨çallæéï¼ä¸è½ä¿®æ¹rootå¯ç \n       \n       Â  all,!/usr/bin/passwd root,!/usr/sbin/visudo,!/usr/bin/vim\n       Â  /etc/sudoers\n\nâ¢æµè¯ç»æéæ¨¡æ¿\n\n     \nçº§å«   æé\næµè¯   æ®éç¨æ·çæé\n     \n     ä¸å å¥sudoåè¡¨\n\nâ£dbaç»æéæ¨¡æ¿\n\n        \nçº§å«      æé\nåçº§dba   æ®éç¨æ·çæé\n        \n        ä¸å å¥sudoåè¡¨\né«çº§dba   é¡¹ç®æå¨æ°æ®åºæå¡å¨çallæé\n        \n        Â Â all,!/usr/bin/passwd root,!/usr/sbin/visudo,!/usr/bin/vim\n        Â  /etc/sudoers\n\nâ¤ç½ç»ç»æéæ¨¡æ¿\n\n       \nçº§å«     æé\nåçº§ç½å·¥   æ®éç¨æ·çæé\n       \n       ä¸å å¥sudoåè¡¨\né«çº§ç½å·¥   é¡¹ç®æå¨æå¡å¨çæå³ç½ç»éç½®çæé\n       \n       Â \n       /sbin/route,/sbin/ifconfig,/bin/ping,/sbin/dhclient,/usr/bin/net,\n       /sbin/ip,/sbin/iptables,/usr/bin/rfcomm,/usr/bin/wvdial,/sbin/iwconfig,/sbin/mii-tool,/bin/cat\n       /var/log/,/usr/bin/vim Â  /etc/sysconfig/network-scripts/\n\n2.å¬å¸ç®åçææ¯äººåéå¤æåµ\n\nè¿ç»´ç»ï¼5ä¸ªåçº§è¿ç»´ï¼2ä¸ªé«çº§è¿ç»´ï¼1ä¸ªè¿ç»´ç»ç\n\nå¼åç»ï¼3ä¸ªåçº§å¼åäººåï¼1ä¸ªé«çº§å¼åï¼1ä¸ªå¼åç»ç\n\næµè¯ç»ï¼2ä¸ªæµè¯å·¥ç¨å¸ï¼æµè¯ç»ä¸å å¥sudoï¼\n\ndbaç»ï¼3ä¸ªåçº§dbaï¼åçº§dbaä¸å å¥sudoï¼ï¼1ä¸ªé«çº§dba\n\nç½ç»ç»ï¼2ä¸ªåçº§ç½å·¥ï¼åçº§dbaä¸å å¥sudoï¼ï¼1ä¸ªé«çº§ç½å·¥\n\nä¸ å½ä»¤è®²è§£\n\nåå»ºç¨æ·\n\nuseradd yw && echo "123456" | passwd --stdin yw\n\nåå»ºywç¨æ·,ç¶åè¾åºä¸ä¸ª123456äº¤passwdä½ä¸ºywç¨æ·çå¯ç \n\nfor n in seq 21 25;do useradd user$n;echo "user$necho user$n|md5sum|cut -c4-8"|passwd --stdin user$n;done\n\nç¨forå¾ªç¯æ¥åå»ºç¨æ·è´¦å·åå¯ç : seq 21 25åå»º5ä¸ªæ°å­ï¼21ï¼22ï¼23ï¼24ï¼25ï¼ï¼n å°±ä»£è¡¨è¿5ä¸ªæ°å­ï¼åé¢çåå»ºç¨æ·æ¥çuser$nå°±æ¯ä»¥userå¼å¤´æ¥nï¼\n\nç¶å echo è¾åºç¨æ·åçmd5ï¼ä½¿ç¨cut ååº4-8åçå­ç¬¦äº¤ç»passwd --stdinæ¥ä¸ºæ¯ä½ç¨æ·éç½®ä¸åçå¯ç ,ä»ä»¬çå¯ç é½æ¯ç¨æ·åçmd5å¼ç4è³8ä½å­ç¬¦ä¸²ã\n\nå é¤ç¨æ·\n\nuserdel yw\n\nå é¤ywç¨æ·\n\nfor n in seq 21 25;do userdel -r user$n;done\n\nç¨forå¾ªç¯å é¤ç¨æ·\n\næ¥çèªå·±çsudoæéï¼sudo -l\n\nâ¦â¦\n\nâ¦â¦\n\nå å®æ½å½ä»¤èæ¬\n\nä¸¾ä¾ï¼å¨å¬å¸æ¶æ ¹æ®å®éæåµç¼åç¨æ·è´¦å·å¯ç åç¸åºæéï¼æ­¤å¤æ ¹æ®ä¸è¿°æéè§åè¡¨ä¸ºä¾ã\n\n1.åå»ºç¨æ·ç»åç¨æ·ï¼\n\n#è¿ç»´ç»ãå¼åç»ãæµè¯ç»ãdbaç»ãç½ç»ç»\n\ngroupadd chujiyunwei -g 1100\n\ngroupadd gaojiyunwei -g 1110\n\ngroupadd yunweijingli -g 1120\n\ngroupadd chujikaifa -g 1200\n\ngroupadd gaojikaifa -g 1210\n\ngroupadd kaifajingli -g 1220\n\ngroupadd ceshi -g 1300\n\ngroupadd chujidba -g 1400\n\ngroupadd gaojidba -g 1410\n\ngroupadd chujinetwork -g 1500\n\ngroupadd gaojinetwork -g 1510\n\n#-----------------------------------------------------------------------------\n\n#è¿ç»´ç»ï¼5ä¸ªåçº§è¿ç»´ï¼2ä¸ªé«çº§è¿ç»´ï¼1ä¸ªè¿ç»´ç»ç\n\n#-----------------------------------------------------------------------------\n\nfor n in seq 1 5;do useradd chujiyunwei$n -g 1100;echo "123456" | passwd --stdin chuji$n;done\n\n#åå»º5ä¸ªåçº§è¿ç»´è´¦æ·å¹¶éç½®äºå¯ç \n\nfor n in seq 1 2;do useradd gaojiyunwei$n -g 1110;echo "123456" | passwd --stdin gaoji$n;done\n\n#åå»º2ä¸ªé«çº§è¿ç»´çç¨æ·åå¯ç \n\nuseradd yunweijingli -g 1120 && echo 123456 | passwd --stdin yunweijingli\n\n#åå»º1ä¸ªè¿ç»´ç»ççè´¦å·åå¯ç \n\n#-----------------------------------------------------------------------------\n\n#å¼åç»ï¼3ä¸ªåçº§å¼åäººåï¼1ä¸ªé«çº§å¼åï¼1ä¸ªå¼åç»ç\n\n#-----------------------------------------------------------------------------\n\nfor n in seq 1 3;do useradd chujikaifa$n -g 1200;echo "123456" | passwd --stdin chujikaifa$n;done\n\n#åå»º3ä¸ªåçº§å¼åè´¦æ·å¹¶éç½®äºå¯ç \n\nuseradd gaojikaifa1 -g 1210 && echo "123456" | passwd --stdin gaojikaifa1\n\n#åå»º1ä¸ªé«çº§å¼åçç¨æ·åå¯ç \n\nuseradd kaifajingli -g 1220 && echo 123456 | passwd --stdin kaifajingli\n\n#åå»º1ä¸ªå¼åç»ççè´¦å·åå¯ç \n\n#-----------------------------------------------------------------------------\n\n#æµè¯ç»ï¼2ä¸ªæµè¯\n\n#-----------------------------------------------------------------------------\n\nfor n in seq 1 2;do useradd ceshi$n -g 1300;echo "123456" | passwd --stdin ceshi$n;done\n\n#åå»º2ä¸ªæµè¯è´¦å·åå¯ç \n\n#-----------------------------------------------------------------------------\n\n#dbaç»ï¼3ä¸ªåçº§dbaï¼1ä¸ªé«çº§dba\n\n#-----------------------------------------------------------------------------\n\nfor n in seq 1 3;do useradd chujidba$n -g 1400;echo "123456" | passwd --stdin chujidba$n;done\n\n#åå»º3ä¸ªåçº§dba è´¦å·åå¯ç \n\nuseradd gaojidba1 -g 1410&& echo 123456 | passwd --stdin gaojidba1\n\n#åå»º1ä¸ªé«çº§dbaè´¦å·åå¯ç \n\n#-----------------------------------------------------------------------------\n\n#ç½å·¥ç»ï¼2ä¸ªåçº§ç½å·¥ï¼1ä¸ªé«çº§ç½å·¥\n\n#-----------------------------------------------------------------------------\n\nfor n in seq 1 2;do useradd chujinetwork$n -g 1500;echo "123456" | passwd --stdin chujinetwork$n;done\n\n#åå»º2ä¸ªåçº§ç½å·¥\n\nuseradd gaojinetwork1 -g 1510 && echo 123456 | passwd --stdin gaojinetwork1\n\n#åå»º1ä¸ªé«çº§ç½å·¥\n\n2.éç½®/etc/sudoersæä»¶\n\ncat >>/etc/sudoers<<eof\n\n#éç½®ç¨æ·ç»å«å:\n\nuser_alias chujiyunwei = %chujiyunwei\n\nuser_alias gaojiyunwei = %gaojiyunwei\n\nuser_alias yunweijingli = %yunweijingli\n\nuser_alias chujikaifa = %chujikaifa\n\nuser_alias gaojikaifa = %gaojikaifa\n\nuser_alias kaifajingli = %kaifajingli\n\nuser_alias ceshi= %ceshi\n\nuser_alias chujidba = %chujidba\n\nuser_alias gaojidba = %gaojidba\n\nuser_alias chujinetwork = %chujinetwork\n\nuser_alias gaojinetwork = %gaojinetwork\n\n#éç½®å½ä»¤å«åï¼\n\ncmnd_alias chujiyunwei_cmd =Â  /bin/hostname,/sbin/ifconfig,/bin/netstat,/sbin/route,/sbin/ip,/bin/ping,/usr/bin/sar,/usr/bin/free, /usr/bin/vmstat,/usr/bin/mpstat,/usr/bin/iostat,/usr/sbin/iotop,/usr/bin/top,/bin/ps\n\ncmnd_alias gaojiyunwei_cmd =Â  /bin/hostname,/sbin/ifconfig,/bin/netstat,/sbin/route,/sbin/ip,/usr/bin/sar,/usr/bin/free,/usr/bin/vmstat,/usr/bin/mpstat,/usr/bin/iostat,/usr/sbin/iotop,/usr/bin/top,/bin/ps,/sbin/iptables,/etc/init.d/network,/bin/nice,/bin/kill,/usr/bin/kill,/usr/bin/killall,/bin/rpm,/usr/bin/up2date,/usr/bin/yum,/sbin/fdisk,/sbin/sfdisk,/sbin/parted,/sbin/partprobe,/bin/mount,/bin/umount\n\ncmnd_alias yunweijingli_cmd =Â  all\n\ncmnd_alias chujikaifa_cmd =Â  /usr/bin/tail /app/log*,/bin/grep /app/log*,/bin/cat,/bin/ls\n\ncmnd_alias gaojikaifa_cmd =Â  /sbin/service,/sbin/chkconfig,/usr/bin/tail /app/log*,/bin/grep /app/log*,/bin/cat,/bin/ls, /bin/sh ~/scripts/deploy.sh\n\ncmnd_alias kaifajingli_cmd =Â  all,!/usr/bin/passwd root,!/usr/sbin/visudo,!/usr/bin/vim /etc/sudoers\n\ncmnd_alias ceshi_cmd =Â  /usr/bin/uname\n\ncmnd_alias chujidba_cmd =Â  /usr/bin/uname\n\ncmnd_alias gaojidba_cmd =Â  all,!/usr/bin/passwd root,!/usr/sbin/visudo,!/usr/bin/vim /etc/sudoers\n\ncmnd_alias chujinetwork_cmd =Â  /usr/bin/uname\n\ncmnd_alias gaojinetwork_cmd =Â  /sbin/route,/sbin/ifconfig,/bin/ping,/sbin/dhclient,/usr/bin/net,/sbin/ip,/sbin/iptables,/usr/bin/rfcomm,/usr/bin/wvdial,/sbin/iwconfig,/sbin/mii-tool,/bin/cat /var/log/,/usr/bin/vim /etc/sysconfig/network-scripts/\n\n#ç¨æ·ç»è½è·åå°çæé\n\nrunas_alias chujiyunwei = root\n\nrunas_alias gaojiyunwei = root\n\nrunas_alias yunweijingli = root\n\nrunas_alias chujikaifa = root\n\nrunas_alias gaojikaifa = root\n\nrunas_alias kaifajingli = root\n\nrunas_alias ceshi = root\n\nrunas_alias chujidba = root\n\nrunas_alias gaojidba = root\n\nrunas_alias chujinetwork = root\n\nrunas_alias gaojinetwork = root\n\n#ç¨æ·ç»æéå¯¹åºå³ç³»\n\nchujiyunwei all=(chujiyunwei) chujiyunwei_cmd\n\ngaojiyunwei all=(gaojiyunwei) gaojiyunwei_cmd\n\nyunweijingli all=(yunweijingli) yunweijingli_cmd\n\nchujikaifa all=(chujikaifa) chujikaifa_cmd\n\ngaojikaifa all=(gaojikaifa) gaojikaifa_cmd\n\nkaifajingli all=(kaifajingli) kaifajingli_cmd\n\nceshi all=(ceshi) ceshi_cmd\n\nchujidba all=(chujidba) chujidba_cmd\n\ngaojidba all=(gaojidba) gaojidba_cmd\n\nchujinetwork all=(chujinetwork) chujinetwork_cmd\n\ngaojinetwork all=(gaojinetwork) gaojinetwork_cmd\n\neof\n\näº æéé¢ç¨æµç¨\n\n1.Â Â  é¢ç¨æµç¨\n\nâ  é¢ç¨äººåèµ·æéé¢ç¨æµç¨ï¼å¡«åæééç½®åæ´ç³è¯·è¡¨ï¼äº¤ç±è¿ç»´äººåå®¡æ ¸ã\n\nâ¡ è¿ç»´äººåå®¡æ ¸æ²¡æé®é¢åç¥è¿ç»´ä¸»ç®¡ï¼ç±è¿ç»´ä¸»ç®¡å¼æ¾æéã\n\n2.éç½®æ´åç³è¯·è¡¨\n\n                                                                                            \néç½®åæ´ç³è¯·è¡¨                                                                                     \n*ä»¥ä¸ç³è¯·é¨é¨å¡«å                                                                          å¡«è¡¨æ¥æï¼    \nç³è¯·é¨é¨                                                                                        \nç³Â è¯·Â äºº                                                                              èç³»æ¹å¼     \nç³è¯·æµè¯æ¥æ                                                                   å¹´Â Â æÂ Â æ¥   ç³è¯·å®æ½æ¥æ   \nå®æ½é¨é¨                                                                                        \nå®æ½èç³»äºº                                                                              èç³»æ¹å¼     \nåæ´ç®çï¼                                                                                       \nåæ´åå®¹ï¼ï¼å¦åå®¹è¾å¤ï¼è¯·å¦éé¡µè¯´æï¼                                                                         \nç³è¯·é¨é¨                                        å£Â ä¸è¬åæ´Â Â Â Â å£Â éå¤§åæ´Â Â Â Â å£Â ç´§æ¥åæ´                      \n\næÂ Â Â è§\nç­¾ç« ï¼Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  æ¥æï¼Â Â Â Â Â Â å¹´Â Â Â Â æÂ Â Â Â æ¥                                                   \n*ä»¥ä¸ä¸ºè¿ç»´åä½å¡«å                                                                                  \nè¿ç»´åä½                                        å£Â ä¸è¬åæ´Â Â Â Â å£Â éå¤§åæ´Â Â Â Â å£Â ç´§æ¥åæ´                      \n\næÂ Â Â è§\nå£Â åæç³è¯·å®æ½æ¥æÂ Â Â Â Â å£Â è¯·å¨ä»¥ä¸æ¥ææ§è¡ï¼Â Â Â Â  å¹´Â  æÂ  æ¥                                                      \nç­¾ç« ï¼Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  æ¥æï¼Â Â Â Â Â Â å¹´Â Â Â Â æÂ Â Â Â æ¥                                                   \n*ä»¥ä¸ä¸ºå®æ½äººå¡«å                                                                                   \nè¿ç»´åä½                                                                                        \n\nå¤çç»æ\nç­¾ç« ï¼Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  æ¥æï¼Â Â Â Â Â Â å¹´Â Â Â Â æÂ Â Â Â æ¥                                                   \n\næ³¨ï¼ 1ãè¯¥ç³è¯·ééå¸¦éæ±æ¥åãå¼åååæ´è®¡åãåæ´æ¹æ¡æä½æ­¥éª¤è¯¦è§£ãç¨æ·æµè¯æ¥åãæºä»£ç æèæ¬ç­ççº¸è´¨æä»¶ï¼åæä½ææ¶åå°ççµå­æä»¶ç¨ä»¥å­æ¡£ã\n\n2ãåæ´æ¹æ¡éåæ¬åæ´æ­¥éª¤è¯¦è§£ãåæ´æåæ å¿ãåæ»æ¹æ¡ç­ã\n\nï¼ä¾å­ï¼\n\ngroupadd loguser -g 1003\n\nuseradd loguser -g 1003 && echo "############" | passwd --stdin loguser\n\ncat >>/etc/sudoers<<eof\n\nuser_alias loguser = %loguser\n\ncmnd_alias loguser_cmd = /sbin/service,/sbin/chkconfig,/usr/bin/tail,/bin/grep,/bin/cat,/bin/ls, /bin/sh,/bin/vim,/bin/less,/usr/bin/docker\n\nrunas_alias loguser = root\n\nloguser all=(loguser) nopasswd:loguser_cmd\n\neof',charsets:{cjk:!0}},{title:"linuxä¿®æ¹ç½å¡ä¸ºeth0çä¸¤ç§æ¹æ³",frontmatter:{title:"linuxä¿®æ¹ç½å¡ä¸ºeth0çä¸¤ç§æ¹æ³",date:"2022-12-21T14:34:00.000Z",permalink:"/pages/c17655/",categories:["è¿ç»´","linux"],tags:[null],feed:{enable:!0},description:"sudoæéè§å",readingShow:"top",meta:[{name:"image",content:"https://img-blog.csdnimg.cn/20210719151032530.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjUxNjkyMg==,size_16,color_FFFFFF,t_70"},{name:"twitter:title",content:"linuxä¿®æ¹ç½å¡ä¸ºeth0çä¸¤ç§æ¹æ³"},{name:"twitter:description",content:"sudoæéè§å"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://img-blog.csdnimg.cn/20210719151032530.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjUxNjkyMg==,size_16,color_FFFFFF,t_70"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/06.linux%E4%BF%AE%E6%94%B9%E7%BD%91%E5%8D%A1%E4%B8%BAeth0%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95.html"},{property:"og:type",content:"article"},{property:"og:title",content:"linuxä¿®æ¹ç½å¡ä¸ºeth0çä¸¤ç§æ¹æ³"},{property:"og:description",content:"sudoæéè§å"},{property:"og:image",content:"https://img-blog.csdnimg.cn/20210719151032530.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjUxNjkyMg==,size_16,color_FFFFFF,t_70"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/06.linux%E4%BF%AE%E6%94%B9%E7%BD%91%E5%8D%A1%E4%B8%BAeth0%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-21T14:34:00.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"linuxä¿®æ¹ç½å¡ä¸ºeth0çä¸¤ç§æ¹æ³"},{itemprop:"description",content:"sudoæéè§å"},{itemprop:"image",content:"https://img-blog.csdnimg.cn/20210719151032530.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjUxNjkyMg==,size_16,color_FFFFFF,t_70"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/01.linux/06.linux%E4%BF%AE%E6%94%B9%E7%BD%91%E5%8D%A1%E4%B8%BAeth0%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95.html",relativePath:"04.è¿ç»´/01.linux/06.linuxä¿®æ¹ç½å¡ä¸ºeth0çä¸¤ç§æ¹æ³.md",key:"v-2c290406",path:"/pages/c17655/",headers:[{level:4,title:"å¨ç³»ç»å®è£æ¶",slug:"å¨ç³»ç»å®è£æ¶",normalizedTitle:"å¨ç³»ç»å®è£æ¶",charIndex:2},{level:4,title:"ç³»ç»å®è£å®æå",slug:"ç³»ç»å®è£å®æå",normalizedTitle:"ç³»ç»å®è£å®æå",charIndex:80}],headersStr:"å¨ç³»ç»å®è£æ¶ ç³»ç»å®è£å®æå",content:'# å¨ç³»ç»å®è£æ¶\n\n 1. å¦ä¸å¾ï¼ç³»ç»å®è£æ¶ï¼ç´æ¥æä¸"tab"æé®ï¼è¿å¥ç¼è¾çé¢ï¼æ·»å å¦ä¸ä¿¡æ¯ï¼"net.ifnames=0 biosdevname=0",ç³»ç»å®è£å®æåé»è®¤ä¸ºeth0ã\n\n\n\n# ç³»ç»å®è£å®æå\n\n 1. ä¿®æ¹ç½å¡éç½®æä»¶DEVICEéç½®çå¼ï¼\n    \n    vim /etc/sysconfig/network-scripts/ifcfg-ens33 ... DEVICE=eth0 ...\n\n 2. éæ°å½åç½å¡æä»¶\n    \n    mv /etc/sysconfig/network-scripts/ifcfg-ens33 /etc/sysconfig/network-scripts/ifcfg-eth0\n\n 3. ç±äºcentos7éç¨grub2 å¼å¯¼ï¼è¿éè¦å¯¹ grub2 è¿è¡ä¿®æ¹ï¼ç¼è¾ /etc/default/grub éç½®æä»¶,å¨"GRUB_CMDLINE_LINUX "è¿ä¸ªåæ°åé¢å å¥ "net.ifnames=0 biosdevname=0"éç½®ï¼\n    \n    vim /etc/default/grub ... GRUB_CMDLINE_LINUX="rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet net.ifnames=0 biosdevname=0" ...\n\n 4. æåï¼ç¨ grub2-mkconfig å½ä»¤éæ°çæGRUBéç½®å¹¶æ´æ°åæ ¸,éå¯ç³»ç»å³å¯ï¼\n    \n    grub2-mkconfig -o /boot/grub2/grub.cfg reboot',normalizedContent:'# å¨ç³»ç»å®è£æ¶\n\n 1. å¦ä¸å¾ï¼ç³»ç»å®è£æ¶ï¼ç´æ¥æä¸"tab"æé®ï¼è¿å¥ç¼è¾çé¢ï¼æ·»å å¦ä¸ä¿¡æ¯ï¼"net.ifnames=0 biosdevname=0",ç³»ç»å®è£å®æåé»è®¤ä¸ºeth0ã\n\n\n\n# ç³»ç»å®è£å®æå\n\n 1. ä¿®æ¹ç½å¡éç½®æä»¶deviceéç½®çå¼ï¼\n    \n    vim /etc/sysconfig/network-scripts/ifcfg-ens33 ... device=eth0 ...\n\n 2. éæ°å½åç½å¡æä»¶\n    \n    mv /etc/sysconfig/network-scripts/ifcfg-ens33 /etc/sysconfig/network-scripts/ifcfg-eth0\n\n 3. ç±äºcentos7éç¨grub2 å¼å¯¼ï¼è¿éè¦å¯¹ grub2 è¿è¡ä¿®æ¹ï¼ç¼è¾ /etc/default/grub éç½®æä»¶,å¨"grub_cmdline_linux "è¿ä¸ªåæ°åé¢å å¥ "net.ifnames=0 biosdevname=0"éç½®ï¼\n    \n    vim /etc/default/grub ... grub_cmdline_linux="rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet net.ifnames=0 biosdevname=0" ...\n\n 4. æåï¼ç¨ grub2-mkconfig å½ä»¤éæ°çægrubéç½®å¹¶æ´æ°åæ ¸,éå¯ç³»ç»å³å¯ï¼\n    \n    grub2-mkconfig -o /boot/grub2/grub.cfg reboot',charsets:{cjk:!0}},{title:"Logrotateå¥é¨äºè§£åçäº§å®è·µ",frontmatter:{title:"Logrotateå¥é¨äºè§£åçäº§å®è·µ",date:"2023-01-11T15:19:54.000Z",permalink:"/pages/a8c469/",categories:["è¿ç»´","linux"],tags:[null],feed:{enable:!0},description:"Logrotateå¥é¨äºè§£åçäº§å®è·µ",readingShow:"top",meta:[{name:"twitter:title",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{name:"twitter:description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/07.Logrotate%E5%85%A5%E9%97%A8%E4%BA%86%E8%A7%A3%E5%8F%8A%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{property:"og:description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/01.linux/07.Logrotate%E5%85%A5%E9%97%A8%E4%BA%86%E8%A7%A3%E5%8F%8A%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-11T15:19:54.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{itemprop:"description",content:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/01.linux/07.Logrotate%E5%85%A5%E9%97%A8%E4%BA%86%E8%A7%A3%E5%8F%8A%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5.html",relativePath:"04.è¿ç»´/01.linux/07.Logrotateå¥é¨äºè§£åçäº§å®è·µ.md",key:"v-78111152",path:"/pages/a8c469/",headers:[{level:2,title:"1ï¼ç®åäºè§£",slug:"_1-ç®åäºè§£",normalizedTitle:"1ï¼ç®åäºè§£",charIndex:2},{level:2,title:"2ï¼éç½®äºè§£",slug:"_2-éç½®äºè§£",normalizedTitle:"2ï¼éç½®äºè§£",charIndex:833},{level:2,title:"3ï¼çäº§æ¡ä¾",slug:"_3-çäº§æ¡ä¾",normalizedTitle:"3ï¼çäº§æ¡ä¾",charIndex:1810},{level:3,title:"",slug:"",normalizedTitle:"",charIndex:0},{level:3,title:"2ï¼catalina æ¥å¿",slug:"_2-catalina-æ¥å¿",normalizedTitle:"2ï¼catalina æ¥å¿",charIndex:2497},{level:3,title:"3ï¼æ¥å¿éå¤§",slug:"_3-æ¥å¿éå¤§",normalizedTitle:"3ï¼æ¥å¿éå¤§",charIndex:2934}],headersStr:"1ï¼ç®åäºè§£ 2ï¼éç½®äºè§£ 3ï¼çäº§æ¡ä¾  2ï¼catalina æ¥å¿ 3ï¼æ¥å¿éå¤§",content:"# 1ï¼ç®åäºè§£\n\nlogrotate å¨ CentOS ç³»ç»ä¸­æ¯é»è®¤å®è£çæ¥å¿è½®æ¿ç»ä»¶ï¼éè¿å¦ä¸å½ä»¤å¯ä»¥çå°ä¸»éç½®åå®¹ï¼\n\negrep -v '^$|^#' logrotate.conf\nweekly\nrotate 4\ncreate\ndateext\ninclude /etc/logrotate.d\n/var/log/wtmp {\n    monthly\n    create 0664 root utmp\n    minsize 1M\n    rotate 1\n}\n/var/log/btmp {\n    missingok\n    monthly\n    create 0600 root utmp\n    rotate 1\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè¿ä¸ªéç½®å½ä¸­å¶ä»åå®¹åºæ¬ä¸å¯ä»¥å¿½ç¥ï¼ä¸»è¦åå®¹æ¯ç¬¬ 6 è¡çå¼ç¨ï¼æä»¬æ°å¢ä¸äºæ¥å¿ç®¡çç­ç¥ä¹é½å¯ä»¥å¨è¿ä¸ªç®å½ä¸åå»ºç¸å³ç­ç¥æ¥ç»´æ¤ã\n\nlogrorate é»è®¤å¨ç³»ç»çÂ /etc/cron.dailyä¸­å­æ¾äºä¸ä¸ªæ§è¡èæ¬ï¼å æ­¤é»è®¤æåµä¸èæ¬å°ä¼æ¯å¤©æ§è¡ä¸æ¬¡ï¼\n\n$cat /etc/cron.daily/logrotate\n#!/bin/sh\n/usr/sbin/logrotate -s /var/lib/logrotate/logrotate.status /etc/logrotate.conf\nEXITVALUE=$?\nif [ $EXITVALUE != 0 ]; then\n    /usr/bin/logger -t logrotate \"ALERT exited abnormally with [$EXITVALUE]\"\nfi\nexit 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\näºè§£äºè¿äºåºæ¬ä¿¡æ¯ä¹åï¼å°±å¯ä»¥å¯¹è¿ä¸ªå·¥å·æå¥ä½¿ç¨äºï¼ä¸è¿è¿éè¦äºè§£ä¸ä¸éç½®æä»¶ä¸­çåæ°æä¹ï¼ä»¥ä¾¿éå¶åºç¬¦åèªå·±éæ±çè½®æ¿èæ¬ã\n\n\n# 2ï¼éç½®äºè§£\n\n * compressï¼éè¿ gzipï¼åç¼©è½¬å¨ä»¥åçæ¥å¿\n * nocompressï¼ä¸éè¦åç¼©æ¶ï¼ç¨è¿ä¸ªåæ°\n * copytruncateï¼ç¨äºè¿å¨æå¼ä¸­çæ¥å¿æä»¶ï¼æå½åæ¥å¿å¤ä»½å¹¶æªæ­\n * nocopytruncateï¼å¤ä»½æ¥å¿æä»¶ä½æ¯ä¸æªæ­\n * createmodeownergroupï¼è½¬å¨æä»¶ï¼ä½¿ç¨æå®çæä»¶æ¨¡å¼åå»ºæ°çæ¥å¿æä»¶\n * nocreateï¼ä¸å»ºç«æ°çæ¥å¿æä»¶\n * delaycompressåcompressï¼ä¸èµ·ä½¿ç¨æ¶ï¼è½¬å¨çæ¥å¿æä»¶å°ä¸ä¸æ¬¡è½¬å¨æ¶æåç¼©\n * missingokï¼å¨æ¥å¿è½®å¾ªæé´ï¼ä»»ä½éè¯¯å°è¢«å¿½ç¥ï¼ä¾å¦ âæä»¶æ æ³æ¾å°â ä¹ç±»çéè¯¯ã\n * nodelaycompressï¼è¦ç delaycompress éé¡¹ï¼è½¬å¨åæ¶åç¼©ã\n * errorsaddressï¼ä¸å¨æ¶çéè¯¯ä¿¡æ¯åéå°æå®ç Email å°å\n * ifemptyï¼å³ä½¿æ¯ç©ºæä»¶ä¹è½¬å¨ï¼è¿ä¸ªæ¯ logrotate çç¼ºçéé¡¹ã\n * notifemptyï¼å¦ææ¯ç©ºæä»¶çè¯ï¼ä¸è½¬å¨\n * mailaddressï¼æè½¬å¨çæ¥å¿æä»¶åéå°æå®ç E-mail å°å\n * nomailï¼è½¬å¨æ¶ä¸åéæ¥å¿æä»¶\n * dateextï¼è½¬å¨åçæ¥å¿æä»¶ä»¥æ¥æå½å\n * olddirdirectoryï¼è½¬å¨åçæ¥å¿æä»¶æ¾å¥æå®çç®å½ï¼å¿é¡»åå½åæ¥å¿æä»¶å¨åä¸ä¸ªæä»¶ç³»ç»\n * noolddirï¼è½¬å¨åçæ¥å¿æä»¶åå½åæ¥å¿æä»¶æ¾å¨åä¸ä¸ªç®å½ä¸\n * prerotate/endscriptï¼å¨è½¬å¨ä»¥åéè¦æ§è¡çå½ä»¤å¯ä»¥æ¾å¥è¿ä¸ªå¯¹ï¼è¿ä¸¤ä¸ªå³é®å­å¿é¡»åç¬æè¡\n * postrotate/endscriptï¼å¨è½¬å¨ä»¥åéè¦æ§è¡çå½ä»¤å¯ä»¥æ¾å¥è¿ä¸ªå¯¹ï¼è¿ä¸¤ä¸ªå³é®å­å¿é¡»åç¬æè¡\n * dailyï¼æå®è½¬å¨å¨æä¸ºæ¯å¤©\n * weeklyï¼æå®è½¬å¨å¨æä¸ºæ¯å¨\n * monthlyï¼æå®è½¬å¨å¨æä¸ºæ¯æ\n * rotatecountï¼æå®æ¥å¿æä»¶å é¤ä¹åè½¬å¨çæ¬¡æ°ï¼0 ææ²¡æå¤ä»½ï¼5 æä¿ç 5 ä¸ªå¤ä»½\n * sizeï¼æ minsizeï¼ï¼size å½æ¥å¿æä»¶å°è¾¾æå®çå¤§å°æ¶æè½¬å¨ï¼Size å¯ä»¥æå® bytes(ç¼ºç) ä»¥å KB(sizek) æè MB(sizem)\n\nä»¥ä¸æ¯ä¸äºå¸¸ç¨çéç½®ï¼å¯ä»¥æéå®ä¹èªå·±çéç½®æä»¶ã\n\n\n# 3ï¼çäº§æ¡ä¾\n\næ¥ä¸æ¥ä»ç»å ä¸ªçäº§å½ä¸­å¸¸ç¨çä¾å­ï¼å¯ä»¥ç´æ¥åé´ä»¥ä½¿ç¨ã\n\n\n#\n\n1ï¼NGINX æ¥å¿\n\nNGINX æ¥å¿çå¤çæ¯ä¸ç§å¸¸è§çåºæ¯ï¼å¤ççæ¹å¼ç¨çè¾å¤çæ¯ç»å logrotate æ¥è¿è¡å¤çï¼å½ç¶ä¹å¯ä»¥åºäº NGINX èªèº«çéç½®æä»¶ç­ç¥å¯¹æ¥å¿è¿è¡èªå¨åå²ï¼æ­¤ç§æ¹æ¡å¯ä»¥åèå¦å¤ä¸ç¯æç« ï¼ä» NGINX èªèº«éç½®æä»¶ä¸­å®ä¹è®¿é®æ¥å¿ææ¶é´åå²ï¼è¿éåä»ç» logrotate æ¹æ¡çå·ä½éç½®æ¹å¼ã\n\nå¨Â /etc/logrotate.dä¸æ·»å å¦ä¸éç½®ï¼\n\n$ cat /etc/logrotate.d/nginx\n/data/log/access.log\n/data/log/error.log\n{\n    daily\n    dateext\n    missingok\n    rotate 7\n    notifempty\n    create 755 www\n    sharedscripts\n    postrotate\n        [ -f /var/run/nginx.pid ] && kill -USR1 `cat /var/run/nginx.pid`\n    endscript\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¿ä¸ªæ¡ä¾æ¯éå¯¹è¿ç§æä¾äºå¹³æ»è¿æ¸¡æ¥å¿åæä½çèæ¬ï¼å¶ä»ç±»ä¼¼çåºç¨æ¥å¿ä¹å¯ä»¥å¥ç¨è¿ä¸ªå°æ¹çéç½®ã\n\nå½æä»¬éç½®æ·»å ä¹åï¼ç­ä¸äºç³»ç»çæ§è¡ï¼æ³è¦èªå·±çä¸ä¸ææï¼å¯ç¨å¦ä¸å½ä»¤æå¨è¿è¡ï¼\n\nlogrotate -f /etc/logrotate.d/nginx\n\n\n1\n\n\n\n# 2ï¼catalina æ¥å¿\n\ncatalina æ¯ä¸ä¸ªä»£æï¼ä¸ä¸è¾¹éç½®ç¸å¯¹çï¼ç¹æé£ç§å§ç»åå°ä¸ä¸ªæä»¶éï¼èªèº«æ²¡æä»»ä½è½®æ¿ç­ç¥ï¼ä¹æ æ³éè¿è°ç¨ææå¹³æ»è¿æ¸¡æ¥å¤ççæåµä¸ï¼å¯ä»¥ä½¿ç¨å¦ä¸éç½®å¯¹æ¥å¿è¿è¡å¤çã\n\néç½®å¦ä¸ï¼\n\n$ cat /etc/logrotate.d/catalina\n/data/log/catalina.log \n{\n    missingok\n    copytruncate\n    compress\n    dateext\n    notifempty\n    daily\n    rotate 7\n    create 755 root root\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nè¿ä¸ªéç½®æä»¶çèµ·æ¥ä¸ä¸è¾¹çåºå«é¤äºèæ¬çå¤çä¹å¤ï¼è¿å¤äºä¸ä¸ªéè¦çéç½®æ¯Â copytruncateï¼å¦æä½ å¨éç½®äº rotate ç­ç¥ä¹åï¼åç°æ¥å¿è½¬å¨äºï¼ä½æ¯åçå¯¹è±¡ä¹è½¬ç§»å°äºè½¬å¨ä¹åçæä»¶äºï¼é£ä¹åºè¯¥å°±æ¯æ¼äºè¿ä¸ªéç½®é¡¹ã\n\n\n# 3ï¼æ¥å¿éå¤§\n\nææ¶åå¯è½ä¸å¡ééå¸¸å¤§ï¼é»è®¤çæå¤©åå²å°±æç¹ä¸å¤§è½å¤æ»¡è¶³æä»¬çéæ±ï¼ç£çå¯è½å¾å¿«å°±è¦æ»¡äºï¼è¿ä¸ªæ¶åå¯ä»¥å°ç­ç¥èªå®ä¹ä¸ºæ¯å°æ¶æ§è¡ä¸æ¬¡ã\n\n$ cat /etc/logrotate.d/nginx\n/data/log/access.log\n/data/log/error.log\n{\n    hourly\n    dateext\n    missingok\n    rotate 7\n    notifempty\n    create 755 www\n    sharedscripts\n    postrotate\n        [ -f /var/run/nginx.pid ] && kill -USR1 `cat /var/run/nginx.pid`\n    endscript\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nç¶åè®°å¾ææ§è¡èæ¬å¾å°æ¶æ§è¡æ± å­éæ·è´ä¸ä»½ï¼\n\ncp /etc/cron.daily/logrotate /etc/cron.hourly/\n\n\n1\n\n\nå½ç¶ä¹å¯å°ç­ç¥è°æ´ä¸ºæå¤§å°è¿è¡åå²ï¼è¿ä¸ªæ¹æ¡ä¹æ¯å¯ä»¥çï¼è¿éå°±ä¸åç¤ºä¾äºã\n\nåæé¾æ¥ï¼https://wiki.eryajf.net/pages/4721.html",normalizedContent:"# 1ï¼ç®åäºè§£\n\nlogrotate å¨ centos ç³»ç»ä¸­æ¯é»è®¤å®è£çæ¥å¿è½®æ¿ç»ä»¶ï¼éè¿å¦ä¸å½ä»¤å¯ä»¥çå°ä¸»éç½®åå®¹ï¼\n\negrep -v '^$|^#' logrotate.conf\nweekly\nrotate 4\ncreate\ndateext\ninclude /etc/logrotate.d\n/var/log/wtmp {\n    monthly\n    create 0664 root utmp\n    minsize 1m\n    rotate 1\n}\n/var/log/btmp {\n    missingok\n    monthly\n    create 0600 root utmp\n    rotate 1\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nè¿ä¸ªéç½®å½ä¸­å¶ä»åå®¹åºæ¬ä¸å¯ä»¥å¿½ç¥ï¼ä¸»è¦åå®¹æ¯ç¬¬ 6 è¡çå¼ç¨ï¼æä»¬æ°å¢ä¸äºæ¥å¿ç®¡çç­ç¥ä¹é½å¯ä»¥å¨è¿ä¸ªç®å½ä¸åå»ºç¸å³ç­ç¥æ¥ç»´æ¤ã\n\nlogrorate é»è®¤å¨ç³»ç»çÂ /etc/cron.dailyä¸­å­æ¾äºä¸ä¸ªæ§è¡èæ¬ï¼å æ­¤é»è®¤æåµä¸èæ¬å°ä¼æ¯å¤©æ§è¡ä¸æ¬¡ï¼\n\n$cat /etc/cron.daily/logrotate\n#!/bin/sh\n/usr/sbin/logrotate -s /var/lib/logrotate/logrotate.status /etc/logrotate.conf\nexitvalue=$?\nif [ $exitvalue != 0 ]; then\n    /usr/bin/logger -t logrotate \"alert exited abnormally with [$exitvalue]\"\nfi\nexit 0\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\näºè§£äºè¿äºåºæ¬ä¿¡æ¯ä¹åï¼å°±å¯ä»¥å¯¹è¿ä¸ªå·¥å·æå¥ä½¿ç¨äºï¼ä¸è¿è¿éè¦äºè§£ä¸ä¸éç½®æä»¶ä¸­çåæ°æä¹ï¼ä»¥ä¾¿éå¶åºç¬¦åèªå·±éæ±çè½®æ¿èæ¬ã\n\n\n# 2ï¼éç½®äºè§£\n\n * compressï¼éè¿ gzipï¼åç¼©è½¬å¨ä»¥åçæ¥å¿\n * nocompressï¼ä¸éè¦åç¼©æ¶ï¼ç¨è¿ä¸ªåæ°\n * copytruncateï¼ç¨äºè¿å¨æå¼ä¸­çæ¥å¿æä»¶ï¼æå½åæ¥å¿å¤ä»½å¹¶æªæ­\n * nocopytruncateï¼å¤ä»½æ¥å¿æä»¶ä½æ¯ä¸æªæ­\n * createmodeownergroupï¼è½¬å¨æä»¶ï¼ä½¿ç¨æå®çæä»¶æ¨¡å¼åå»ºæ°çæ¥å¿æä»¶\n * nocreateï¼ä¸å»ºç«æ°çæ¥å¿æä»¶\n * delaycompressåcompressï¼ä¸èµ·ä½¿ç¨æ¶ï¼è½¬å¨çæ¥å¿æä»¶å°ä¸ä¸æ¬¡è½¬å¨æ¶æåç¼©\n * missingokï¼å¨æ¥å¿è½®å¾ªæé´ï¼ä»»ä½éè¯¯å°è¢«å¿½ç¥ï¼ä¾å¦ âæä»¶æ æ³æ¾å°â ä¹ç±»çéè¯¯ã\n * nodelaycompressï¼è¦ç delaycompress éé¡¹ï¼è½¬å¨åæ¶åç¼©ã\n * errorsaddressï¼ä¸å¨æ¶çéè¯¯ä¿¡æ¯åéå°æå®ç email å°å\n * ifemptyï¼å³ä½¿æ¯ç©ºæä»¶ä¹è½¬å¨ï¼è¿ä¸ªæ¯ logrotate çç¼ºçéé¡¹ã\n * notifemptyï¼å¦ææ¯ç©ºæä»¶çè¯ï¼ä¸è½¬å¨\n * mailaddressï¼æè½¬å¨çæ¥å¿æä»¶åéå°æå®ç e-mail å°å\n * nomailï¼è½¬å¨æ¶ä¸åéæ¥å¿æä»¶\n * dateextï¼è½¬å¨åçæ¥å¿æä»¶ä»¥æ¥æå½å\n * olddirdirectoryï¼è½¬å¨åçæ¥å¿æä»¶æ¾å¥æå®çç®å½ï¼å¿é¡»åå½åæ¥å¿æä»¶å¨åä¸ä¸ªæä»¶ç³»ç»\n * noolddirï¼è½¬å¨åçæ¥å¿æä»¶åå½åæ¥å¿æä»¶æ¾å¨åä¸ä¸ªç®å½ä¸\n * prerotate/endscriptï¼å¨è½¬å¨ä»¥åéè¦æ§è¡çå½ä»¤å¯ä»¥æ¾å¥è¿ä¸ªå¯¹ï¼è¿ä¸¤ä¸ªå³é®å­å¿é¡»åç¬æè¡\n * postrotate/endscriptï¼å¨è½¬å¨ä»¥åéè¦æ§è¡çå½ä»¤å¯ä»¥æ¾å¥è¿ä¸ªå¯¹ï¼è¿ä¸¤ä¸ªå³é®å­å¿é¡»åç¬æè¡\n * dailyï¼æå®è½¬å¨å¨æä¸ºæ¯å¤©\n * weeklyï¼æå®è½¬å¨å¨æä¸ºæ¯å¨\n * monthlyï¼æå®è½¬å¨å¨æä¸ºæ¯æ\n * rotatecountï¼æå®æ¥å¿æä»¶å é¤ä¹åè½¬å¨çæ¬¡æ°ï¼0 ææ²¡æå¤ä»½ï¼5 æä¿ç 5 ä¸ªå¤ä»½\n * sizeï¼æ minsizeï¼ï¼size å½æ¥å¿æä»¶å°è¾¾æå®çå¤§å°æ¶æè½¬å¨ï¼size å¯ä»¥æå® bytes(ç¼ºç) ä»¥å kb(sizek) æè mb(sizem)\n\nä»¥ä¸æ¯ä¸äºå¸¸ç¨çéç½®ï¼å¯ä»¥æéå®ä¹èªå·±çéç½®æä»¶ã\n\n\n# 3ï¼çäº§æ¡ä¾\n\næ¥ä¸æ¥ä»ç»å ä¸ªçäº§å½ä¸­å¸¸ç¨çä¾å­ï¼å¯ä»¥ç´æ¥åé´ä»¥ä½¿ç¨ã\n\n\n#\n\n1ï¼nginx æ¥å¿\n\nnginx æ¥å¿çå¤çæ¯ä¸ç§å¸¸è§çåºæ¯ï¼å¤ççæ¹å¼ç¨çè¾å¤çæ¯ç»å logrotate æ¥è¿è¡å¤çï¼å½ç¶ä¹å¯ä»¥åºäº nginx èªèº«çéç½®æä»¶ç­ç¥å¯¹æ¥å¿è¿è¡èªå¨åå²ï¼æ­¤ç§æ¹æ¡å¯ä»¥åèå¦å¤ä¸ç¯æç« ï¼ä» nginx èªèº«éç½®æä»¶ä¸­å®ä¹è®¿é®æ¥å¿ææ¶é´åå²ï¼è¿éåä»ç» logrotate æ¹æ¡çå·ä½éç½®æ¹å¼ã\n\nå¨Â /etc/logrotate.dä¸æ·»å å¦ä¸éç½®ï¼\n\n$ cat /etc/logrotate.d/nginx\n/data/log/access.log\n/data/log/error.log\n{\n    daily\n    dateext\n    missingok\n    rotate 7\n    notifempty\n    create 755 www\n    sharedscripts\n    postrotate\n        [ -f /var/run/nginx.pid ] && kill -usr1 `cat /var/run/nginx.pid`\n    endscript\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nè¿ä¸ªæ¡ä¾æ¯éå¯¹è¿ç§æä¾äºå¹³æ»è¿æ¸¡æ¥å¿åæä½çèæ¬ï¼å¶ä»ç±»ä¼¼çåºç¨æ¥å¿ä¹å¯ä»¥å¥ç¨è¿ä¸ªå°æ¹çéç½®ã\n\nå½æä»¬éç½®æ·»å ä¹åï¼ç­ä¸äºç³»ç»çæ§è¡ï¼æ³è¦èªå·±çä¸ä¸ææï¼å¯ç¨å¦ä¸å½ä»¤æå¨è¿è¡ï¼\n\nlogrotate -f /etc/logrotate.d/nginx\n\n\n1\n\n\n\n# 2ï¼catalina æ¥å¿\n\ncatalina æ¯ä¸ä¸ªä»£æï¼ä¸ä¸è¾¹éç½®ç¸å¯¹çï¼ç¹æé£ç§å§ç»åå°ä¸ä¸ªæä»¶éï¼èªèº«æ²¡æä»»ä½è½®æ¿ç­ç¥ï¼ä¹æ æ³éè¿è°ç¨ææå¹³æ»è¿æ¸¡æ¥å¤ççæåµä¸ï¼å¯ä»¥ä½¿ç¨å¦ä¸éç½®å¯¹æ¥å¿è¿è¡å¤çã\n\néç½®å¦ä¸ï¼\n\n$ cat /etc/logrotate.d/catalina\n/data/log/catalina.log \n{\n    missingok\n    copytruncate\n    compress\n    dateext\n    notifempty\n    daily\n    rotate 7\n    create 755 root root\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nè¿ä¸ªéç½®æä»¶çèµ·æ¥ä¸ä¸è¾¹çåºå«é¤äºèæ¬çå¤çä¹å¤ï¼è¿å¤äºä¸ä¸ªéè¦çéç½®æ¯Â copytruncateï¼å¦æä½ å¨éç½®äº rotate ç­ç¥ä¹åï¼åç°æ¥å¿è½¬å¨äºï¼ä½æ¯åçå¯¹è±¡ä¹è½¬ç§»å°äºè½¬å¨ä¹åçæä»¶äºï¼é£ä¹åºè¯¥å°±æ¯æ¼äºè¿ä¸ªéç½®é¡¹ã\n\n\n# 3ï¼æ¥å¿éå¤§\n\nææ¶åå¯è½ä¸å¡ééå¸¸å¤§ï¼é»è®¤çæå¤©åå²å°±æç¹ä¸å¤§è½å¤æ»¡è¶³æä»¬çéæ±ï¼ç£çå¯è½å¾å¿«å°±è¦æ»¡äºï¼è¿ä¸ªæ¶åå¯ä»¥å°ç­ç¥èªå®ä¹ä¸ºæ¯å°æ¶æ§è¡ä¸æ¬¡ã\n\n$ cat /etc/logrotate.d/nginx\n/data/log/access.log\n/data/log/error.log\n{\n    hourly\n    dateext\n    missingok\n    rotate 7\n    notifempty\n    create 755 www\n    sharedscripts\n    postrotate\n        [ -f /var/run/nginx.pid ] && kill -usr1 `cat /var/run/nginx.pid`\n    endscript\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nç¶åè®°å¾ææ§è¡èæ¬å¾å°æ¶æ§è¡æ± å­éæ·è´ä¸ä»½ï¼\n\ncp /etc/cron.daily/logrotate /etc/cron.hourly/\n\n\n1\n\n\nå½ç¶ä¹å¯å°ç­ç¥è°æ´ä¸ºæå¤§å°è¿è¡åå²ï¼è¿ä¸ªæ¹æ¡ä¹æ¯å¯ä»¥çï¼è¿éå°±ä¸åç¤ºä¾äºã\n\nåæé¾æ¥ï¼https://wiki.eryajf.net/pages/4721.html",charsets:{cjk:!0}},{title:"windowsæ¯æå¤ç¨æ·è¿ç¨ç»å½",frontmatter:{title:"windowsæ¯æå¤ç¨æ·è¿ç¨ç»å½",date:"2022-12-15T18:56:36.000Z",permalink:"/pages/18b06c/",categories:["è¿ç»´","windowsç³»ç»"],tags:[null],readingShow:"top",description:"ç®åæµè¯çwindows server2016å¯ä»¥å®ç°",meta:[{name:"twitter:title",content:"windowsæ¯æå¤ç¨æ·è¿ç¨ç»å½"},{name:"twitter:description",content:"ç®åæµè¯çwindows server2016å¯ä»¥å®ç°"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/02.windows/01.windows%E6%94%AF%E6%8C%81%E5%A4%9A%E7%94%A8%E6%88%B7%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95.html"},{property:"og:type",content:"article"},{property:"og:title",content:"windowsæ¯æå¤ç¨æ·è¿ç¨ç»å½"},{property:"og:description",content:"ç®åæµè¯çwindows server2016å¯ä»¥å®ç°"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/02.windows/01.windows%E6%94%AF%E6%8C%81%E5%A4%9A%E7%94%A8%E6%88%B7%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T18:56:36.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"windowsæ¯æå¤ç¨æ·è¿ç¨ç»å½"},{itemprop:"description",content:"ç®åæµè¯çwindows server2016å¯ä»¥å®ç°"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/02.windows/01.windows%E6%94%AF%E6%8C%81%E5%A4%9A%E7%94%A8%E6%88%B7%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95.html",relativePath:"04.è¿ç»´/02.windows/01.windowsæ¯æå¤ç¨æ·è¿ç¨ç»å½.md",key:"v-c1c1c24e",path:"/pages/18b06c/",headersStr:null,content:"ç®åæµè¯çwindows server2016å¯ä»¥å®ç°\n\néç½®å¦ä¸\n\nå¾®è½¯Serverçæä½ç³»ç»é»è®¤æ¯æ¯æå¤ç¨æ·ç»éçï¼ä¾å¦WindowsÂ Server 2012ï¼èWin10æä½ç³»ç»æ­£å¸¸æåµä¸æ¯ä¸åè®¸ç¨æ·åæ¶è¿ç¨çï¼å³ä¸ä¸ªç¨æ·è¿ç¨è¿æ¥ä¼æå¦ä¸ä¸ªç¨æ·è¸¢æï¼å æ­¤éè¦ç ´è§£æè½ä½¿å¾å¤ä¸ªç¨æ·åæ¶ç»éè¿ç¨æ¡é¢ãWin10ç³»ç»å®ç°å¤ç¨æ·è¿ç¨éè¦ä»¥ä¸ä¸¤ä¸ªæ­¥éª¤ï¼\n\nä¸ãä¸»æºä¿®æ¹è¿ç¨ç»å½ç¸å³éç½®\n\n1ãæ°å»ºç¨æ·\n\nå³é®[æ­¤çµè] --\x3e [ç®¡ç]Â --\x3e [è®¡ç®æºç®¡ç]Â --\x3e [æ¬å°ç¨æ·åç»]ï¼å³é®åå»[ç¨æ·]Â --\x3e [æ°ç¨æ·]ï¼æ·»å ç¨æ·ååè®¾ç½®å¯ç ï¼å¾éå¯ç æ°¸ä¸è¿æï¼ç¶åç¹å»[åå»º]ï¼\n\n2ãæ·»å è¿ç¨æ¡é¢ç¨æ·\n\nå³é®[æ­¤çµè] --\x3e [å±æ§] --\x3e [è¿ç¨]ï¼å¾éâåè®¸è¿ç¨åå©è¿æ¥è¿å°è®¡ç®æºâåâåè®¸è¿ç¨è¿æ¥å°æ­¤çµèâï¼ç¶åç¹å»[éæ©ç¨æ·]ï¼æ·»å åååå»ºçç¨æ·ï¼ç¹å»ç¡®å®ï¼\n\n3ãéç½®æ¬å°ç»ç­ç¥\n\nè¿è¡gpedit.mscï¼æå¼æ¬å°ç»ç­ç¥ç¼è¾å¨ï¼ä¾æ¬¡éæ©[è®¡ç®æºéç½®] --\x3e [ç®¡çæ¨¡æ¿] --\x3e [Windowsç»ä»¶] --\x3e [è¿ç¨æ¡é¢æå¡] --\x3e [è¿æ¥]å±å¼ï¼ç¶ååå«è¿è¡ä»¥ä¸3é¡¹éç½®ï¼\n\nâ éç½®âåè®¸ç¨æ·éè¿ä½¿ç¨è¿ç¨æ¡é¢æå¡è¿è¡è¿ç¨è¿æ¥âï¼éæ©ï¼å·²å¯ç¨ï¼\n\nâ¡éç½®âéå¶è¿æ¥çæ°éâï¼ç¹å»âå·²å¯ç¨âï¼å¶ä¸­âåè®¸çRDæå¤§è¿æ¥æ°âå¯ä»¥èªå·±è§æåµèå®ï¼\n\nâ¢éç½®âå°è¿ç¨æ¡é¢æå¡ç¨æ·éå¶å°åç¬çè¿ç¨æ¡é¢æå¡ä¼è¯âï¼éæ©ï¼å·²å¯ç¨ï¼\n\nãæ¸©é¦¨æç¤ºãï¼âå°è¿ç¨æ¡é¢æå¡ç¨æ·éå¶å°åç¬çè¿ç¨æ¡é¢æå¡ä¼è¯âè¿ä¸ªéç½®æ¯è¾éè¦ï¼å¦ææ²¡å¯ç¨ï¼ä¼å¯¼è´æ­å¼ä¸ä¸ªè¿ç¨ç»å½è¿æ¥åï¼åéæ°è¿æ¥ï¼ä¼éæ°æå¼ä¸ä¸ªæ°çæ¡é¢ãä½æ¯æå¼æ°çåºç¨ç¨åºæ¶ï¼ç³»ç»æç¤ºç³»ç»åå°æ­£å¨è¿è¡ï¼ä¹åæ­å¼åçåºç¨ç¨åºå´ä¸ä¸ªä¹æ¾ä¸å°ãå ä¸ºåä¸ä¸ªç¨æ·ååç»éè¿ç¨ç³»ç»ï¼ç³»ç»ä¼åéä¸åçä¼è¯ï¼ä»èå¯¼è´ä½ å¨ä¸ä¸ªè¿ç¨æ¡é¢çæä½é½ä¸è§äºï¼è½ç¶ä½ è¿è¡çä¸äºç¨åºå¹¶æ²¡æè¢«ç³»ç»å³é­ï¼ä½æ¯ä½ æ æ³å¯¹ä»ä»¬è¿è¡ç®¡çã\n\näºãç ´è§£è¿ç¨ç»å½ç¨æ·éå¶\n\n1ãä¸è½½è§£é¤è¿ç¨æ¡é¢å¤ç¨æ·è¿æ¥éå¶è¡¥ä¸ï¼ä¸è½½å°åè§æåéä»¶ï¼\n\n2ãè§£åä¸è½½å¥½çRDPWrapåç¼©ååï¼è¿è¡ä»¥ä¸æä½ï¼\n\nâ ä»¥ç®¡çåèº«ä»½è¿è¡install.batå®è£ï¼\n\nâ¡æ·è´rdpwrap.iniå°C:\\Program Files\\RDP Wrapperç®å½ä¸ï¼å¹¶è¦çï¼\n\nâ¢éå¯çµèï¼\n\nâ£è¿è¡RDPConf.exeï¼æ¥çåä¸ªç»ä»¶è¿è¡ç¶æï¼ç¶æå¨é¨ä¸ºç»¿è²å°±å¯ä»¥ä½¿ç¨å¤ç¨æ·è¿ç¨æ¡é¢äºãå¦æç«¯å£çå¬ä¸ºNothing listening, æèåºç°Listening [not supported], åéè¦è¿è¡ä¸ä¸update.batï¼\n\nâ¤è¿è¡RDPCheck.exeï¼æµè¯è¿ç¨æ¯å¦æ­£å¸¸ï¼\n\nä¸ãä½¿ç¨è¯´æ\n\n1ãä»¥ä¸æ¹æ³å¯¹äºWin10ç³»ç»çæ¬å·æ¯1803ä»¥ä¸çå¤§é¨åè®¡ç®æºæ¯å®å¨å¯è¡çï¼è¥æä½ç³»ç»çæ¯1809åä»¥ä¸çæ¬å·ï¼åè¡ä¸éï¼\n\n2ãå¦ææä½ç³»ç»çæ¬å·æ¯1809ï¼è¯¥æä¹æä½å¢ï¼æ ¹æ®RDPWrapè¡¥ä¸çåçæ¯ï¼ä¿®æ¹termsrv.dllåtermsrv.dll.muiè¿ä¸¤ä¸ªè¿ç¨æå¡æä»¶ï¼è¾¾å°å¤ç¨æ·è¿ç¨ç»éçç®çãå¯ä»¥æå¶å®æä½ç³»ç»ä¸çtermsrv.dllåtermsrv.dll.muiè¿ä¸¤ä¸ªæä»¶æååºæ¥ï¼ç¶åæ¿æ¢æ¬æºä¸çæä»¶ï¼åè¿è¡RDPConf.exeæ¥çåä¸ªç»ä»¶è¿è¡ç¶æã\n\nâ termsrv.dllæä»¶è·¯å¾ï¼C:\\Windows\\System32\n\nâÂ termsrv.dll.muiæä»¶è·¯å¾ï¼C:\\Windows\\System32\\zh-CN\n\nåæç« é¾æ¥ï¼http://www.zhulincat.com/post/265.html\n\nwindows server 2019å¤ç¨æ·\n\nWindows Server 2019è¿ç¨æ¡é¢æå¡éç½®åæææ¿æ´»_51CTOåå®¢_windows server 2019 è¿ç¨æ¡é¢",normalizedContent:"ç®åæµè¯çwindows server2016å¯ä»¥å®ç°\n\néç½®å¦ä¸\n\nå¾®è½¯serverçæä½ç³»ç»é»è®¤æ¯æ¯æå¤ç¨æ·ç»éçï¼ä¾å¦windowsÂ server 2012ï¼èwin10æä½ç³»ç»æ­£å¸¸æåµä¸æ¯ä¸åè®¸ç¨æ·åæ¶è¿ç¨çï¼å³ä¸ä¸ªç¨æ·è¿ç¨è¿æ¥ä¼æå¦ä¸ä¸ªç¨æ·è¸¢æï¼å æ­¤éè¦ç ´è§£æè½ä½¿å¾å¤ä¸ªç¨æ·åæ¶ç»éè¿ç¨æ¡é¢ãwin10ç³»ç»å®ç°å¤ç¨æ·è¿ç¨éè¦ä»¥ä¸ä¸¤ä¸ªæ­¥éª¤ï¼\n\nä¸ãä¸»æºä¿®æ¹è¿ç¨ç»å½ç¸å³éç½®\n\n1ãæ°å»ºç¨æ·\n\nå³é®[æ­¤çµè] --\x3e [ç®¡ç]Â --\x3e [è®¡ç®æºç®¡ç]Â --\x3e [æ¬å°ç¨æ·åç»]ï¼å³é®åå»[ç¨æ·]Â --\x3e [æ°ç¨æ·]ï¼æ·»å ç¨æ·ååè®¾ç½®å¯ç ï¼å¾éå¯ç æ°¸ä¸è¿æï¼ç¶åç¹å»[åå»º]ï¼\n\n2ãæ·»å è¿ç¨æ¡é¢ç¨æ·\n\nå³é®[æ­¤çµè] --\x3e [å±æ§] --\x3e [è¿ç¨]ï¼å¾éâåè®¸è¿ç¨åå©è¿æ¥è¿å°è®¡ç®æºâåâåè®¸è¿ç¨è¿æ¥å°æ­¤çµèâï¼ç¶åç¹å»[éæ©ç¨æ·]ï¼æ·»å åååå»ºçç¨æ·ï¼ç¹å»ç¡®å®ï¼\n\n3ãéç½®æ¬å°ç»ç­ç¥\n\nè¿è¡gpedit.mscï¼æå¼æ¬å°ç»ç­ç¥ç¼è¾å¨ï¼ä¾æ¬¡éæ©[è®¡ç®æºéç½®] --\x3e [ç®¡çæ¨¡æ¿] --\x3e [windowsç»ä»¶] --\x3e [è¿ç¨æ¡é¢æå¡] --\x3e [è¿æ¥]å±å¼ï¼ç¶ååå«è¿è¡ä»¥ä¸3é¡¹éç½®ï¼\n\nâ éç½®âåè®¸ç¨æ·éè¿ä½¿ç¨è¿ç¨æ¡é¢æå¡è¿è¡è¿ç¨è¿æ¥âï¼éæ©ï¼å·²å¯ç¨ï¼\n\nâ¡éç½®âéå¶è¿æ¥çæ°éâï¼ç¹å»âå·²å¯ç¨âï¼å¶ä¸­âåè®¸çrdæå¤§è¿æ¥æ°âå¯ä»¥èªå·±è§æåµèå®ï¼\n\nâ¢éç½®âå°è¿ç¨æ¡é¢æå¡ç¨æ·éå¶å°åç¬çè¿ç¨æ¡é¢æå¡ä¼è¯âï¼éæ©ï¼å·²å¯ç¨ï¼\n\nãæ¸©é¦¨æç¤ºãï¼âå°è¿ç¨æ¡é¢æå¡ç¨æ·éå¶å°åç¬çè¿ç¨æ¡é¢æå¡ä¼è¯âè¿ä¸ªéç½®æ¯è¾éè¦ï¼å¦ææ²¡å¯ç¨ï¼ä¼å¯¼è´æ­å¼ä¸ä¸ªè¿ç¨ç»å½è¿æ¥åï¼åéæ°è¿æ¥ï¼ä¼éæ°æå¼ä¸ä¸ªæ°çæ¡é¢ãä½æ¯æå¼æ°çåºç¨ç¨åºæ¶ï¼ç³»ç»æç¤ºç³»ç»åå°æ­£å¨è¿è¡ï¼ä¹åæ­å¼åçåºç¨ç¨åºå´ä¸ä¸ªä¹æ¾ä¸å°ãå ä¸ºåä¸ä¸ªç¨æ·ååç»éè¿ç¨ç³»ç»ï¼ç³»ç»ä¼åéä¸åçä¼è¯ï¼ä»èå¯¼è´ä½ å¨ä¸ä¸ªè¿ç¨æ¡é¢çæä½é½ä¸è§äºï¼è½ç¶ä½ è¿è¡çä¸äºç¨åºå¹¶æ²¡æè¢«ç³»ç»å³é­ï¼ä½æ¯ä½ æ æ³å¯¹ä»ä»¬è¿è¡ç®¡çã\n\näºãç ´è§£è¿ç¨ç»å½ç¨æ·éå¶\n\n1ãä¸è½½è§£é¤è¿ç¨æ¡é¢å¤ç¨æ·è¿æ¥éå¶è¡¥ä¸ï¼ä¸è½½å°åè§æåéä»¶ï¼\n\n2ãè§£åä¸è½½å¥½çrdpwrapåç¼©ååï¼è¿è¡ä»¥ä¸æä½ï¼\n\nâ ä»¥ç®¡çåèº«ä»½è¿è¡install.batå®è£ï¼\n\nâ¡æ·è´rdpwrap.iniå°c:\\program files\\rdp wrapperç®å½ä¸ï¼å¹¶è¦çï¼\n\nâ¢éå¯çµèï¼\n\nâ£è¿è¡rdpconf.exeï¼æ¥çåä¸ªç»ä»¶è¿è¡ç¶æï¼ç¶æå¨é¨ä¸ºç»¿è²å°±å¯ä»¥ä½¿ç¨å¤ç¨æ·è¿ç¨æ¡é¢äºãå¦æç«¯å£çå¬ä¸ºnothing listening, æèåºç°listening [not supported], åéè¦è¿è¡ä¸ä¸update.batï¼\n\nâ¤è¿è¡rdpcheck.exeï¼æµè¯è¿ç¨æ¯å¦æ­£å¸¸ï¼\n\nä¸ãä½¿ç¨è¯´æ\n\n1ãä»¥ä¸æ¹æ³å¯¹äºwin10ç³»ç»çæ¬å·æ¯1803ä»¥ä¸çå¤§é¨åè®¡ç®æºæ¯å®å¨å¯è¡çï¼è¥æä½ç³»ç»çæ¯1809åä»¥ä¸çæ¬å·ï¼åè¡ä¸éï¼\n\n2ãå¦ææä½ç³»ç»çæ¬å·æ¯1809ï¼è¯¥æä¹æä½å¢ï¼æ ¹æ®rdpwrapè¡¥ä¸çåçæ¯ï¼ä¿®æ¹termsrv.dllåtermsrv.dll.muiè¿ä¸¤ä¸ªè¿ç¨æå¡æä»¶ï¼è¾¾å°å¤ç¨æ·è¿ç¨ç»éçç®çãå¯ä»¥æå¶å®æä½ç³»ç»ä¸çtermsrv.dllåtermsrv.dll.muiè¿ä¸¤ä¸ªæä»¶æååºæ¥ï¼ç¶åæ¿æ¢æ¬æºä¸çæä»¶ï¼åè¿è¡rdpconf.exeæ¥çåä¸ªç»ä»¶è¿è¡ç¶æã\n\nâ termsrv.dllæä»¶è·¯å¾ï¼c:\\windows\\system32\n\nâÂ termsrv.dll.muiæä»¶è·¯å¾ï¼c:\\windows\\system32\\zh-cn\n\nåæç« é¾æ¥ï¼http://www.zhulincat.com/post/265.html\n\nwindows server 2019å¤ç¨æ·\n\nwindows server 2019è¿ç¨æ¡é¢æå¡éç½®åæææ¿æ´»_51ctoåå®¢_windows server 2019 è¿ç¨æ¡é¢",charsets:{cjk:!0}},{title:"windowsåºç¨æå¡é¨ç½²èæ¬",frontmatter:{title:"windowsåºç¨æå¡é¨ç½²èæ¬",date:"2023-02-28T22:13:50.000Z",permalink:"/pages/adbe78/",categories:["è¿ç»´","windows"],tags:[null],readingShow:"top",description:"",meta:[{name:"image",content:"http://pic.zzppjj.top/LightPicture/2023/02/46cae67941eaa158.jpg"},{name:"twitter:title",content:"windowsåºç¨æå¡é¨ç½²èæ¬"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://pic.zzppjj.top/LightPicture/2023/02/46cae67941eaa158.jpg"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/02.windows/02.windows%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC.html"},{property:"og:type",content:"article"},{property:"og:title",content:"windowsåºç¨æå¡é¨ç½²èæ¬"},{property:"og:description",content:""},{property:"og:image",content:"http://pic.zzppjj.top/LightPicture/2023/02/46cae67941eaa158.jpg"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/02.windows/02.windows%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-28T22:13:50.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"windowsåºç¨æå¡é¨ç½²èæ¬"},{itemprop:"description",content:""},{itemprop:"image",content:"http://pic.zzppjj.top/LightPicture/2023/02/46cae67941eaa158.jpg"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/02.windows/02.windows%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC.html",relativePath:"04.è¿ç»´/02.windows/02.windowsåºç¨æå¡é¨ç½²èæ¬.md",key:"v-0cc13236",path:"/pages/adbe78/",headers:[{level:3,title:"æææå¡èæ¬",slug:"æææå¡èæ¬",normalizedTitle:"æææå¡èæ¬",charIndex:154},{level:3,title:"æå¡å¯å¨éç½®",slug:"æå¡å¯å¨éç½®",normalizedTitle:"æå¡å¯å¨éç½®",charIndex:396},{level:3,title:"ansibleé¨ç½²èæ¬",slug:"ansibleé¨ç½²èæ¬",normalizedTitle:"ansibleé¨ç½²èæ¬",charIndex:430},{level:4,title:"hostsæä»¶",slug:"hostsæä»¶",normalizedTitle:"hostsæä»¶",charIndex:1896},{level:4,title:"jenkinsfileæä»¶",slug:"jenkinsfileæä»¶",normalizedTitle:"jenkinsfileæä»¶",charIndex:2114}],headersStr:"æææå¡èæ¬ æå¡å¯å¨éç½® ansibleé¨ç½²èæ¬ hostsæä»¶ jenkinsfileæä»¶",content:'ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½\n\n\n# æææå¡èæ¬\n\n@echo off\nset TempFile=%TEMP%\\sthUnique.tmp\nwmic process where name="md.exe" get processid,commandline | find "gf" >%TempFile%\nset /P _string=<%TempFile%\nset _pid=%_string:~32%\necho %_pid%\ntaskkill /f /pid %_pid%\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# æå¡å¯å¨éç½®\n\næå¼ä»»å¡è®¡åç¨åºï¼åå»ºä»»å¡\n\n\n\n\n\n\n\n\n\n\n# ansibleé¨ç½²èæ¬\n\n---\n- hosts: "windows_deploy02"\n  tasks:\n    - name: kill md service\n      win_command: c:\\\\app\\md.bat\n      ignore_errors: True\n      tags:\n        - taskkill_md\n    # - name: kill md service\n    #   win_command: taskkill /F /im md.exe\n    #   ignore_errors: True\n    #   tags:\n    #     - taskkill_md  \n    - name: copy gf file\n      win_copy:\n        src: "{{ WORKSPACE }}/Quote_md/"\n        dest: c:\\\\app\\gf\\Quote_md\\\n      tags:\n        - copy_gf\n    - name: copy gf config file\n      win_copy:\n        src: "/var/jenkins_home/project_config/gf_md/source_md.yaml"\n        dest: c:\\\\app\\gf\\Quote_md\\etc\n      tags:\n        - copy_gf_config\n    - name: copy quote file\n      win_copy:\n        src: "{{ WORKSPACE }}/Quote_md/"\n        dest: c:\\\\app\\quote\\md\\\n      tags:\n        - copy_quote\n    - name: copy quote config file\n      win_copy:\n        src: "/var/jenkins_home/project_config/airm_md/source_md.yaml"\n        dest: c:\\\\app\\quote\\md\\etc\n      tags:\n        - copy_quote_config\n    - name: start trade service\n      win_command: C:\\Windows\\System32\\schtasks.exe /Run /TN start_gf\n      tags:\n        - start_gf\n      ignore_errors: True\n    - name: start quote service\n      win_command: C:\\Windows\\System32\\schtasks.exe /Run /TN start_quote\n      ignore_errors: True\n      tags:\n        - start_quote\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n# hostsæä»¶\n\n[windows_deploy02]\n172.16.30.198 ansible_ssh_port=5985 ansible_ssh_user=admin ansible_ssh_pass=123456 ansible_connection=winrm ansible_winrm_server_cert_validation=ignore ansible_winrm_transport=ssl\n\n\n1\n2\n\n\n# jenkinsfileæä»¶\n\n\n\n\n1\n',normalizedContent:'ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½\n\n\n# æææå¡èæ¬\n\n@echo off\nset tempfile=%temp%\\sthunique.tmp\nwmic process where name="md.exe" get processid,commandline | find "gf" >%tempfile%\nset /p _string=<%tempfile%\nset _pid=%_string:~32%\necho %_pid%\ntaskkill /f /pid %_pid%\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# æå¡å¯å¨éç½®\n\næå¼ä»»å¡è®¡åç¨åºï¼åå»ºä»»å¡\n\n\n\n\n\n\n\n\n\n\n# ansibleé¨ç½²èæ¬\n\n---\n- hosts: "windows_deploy02"\n  tasks:\n    - name: kill md service\n      win_command: c:\\\\app\\md.bat\n      ignore_errors: true\n      tags:\n        - taskkill_md\n    # - name: kill md service\n    #   win_command: taskkill /f /im md.exe\n    #   ignore_errors: true\n    #   tags:\n    #     - taskkill_md  \n    - name: copy gf file\n      win_copy:\n        src: "{{ workspace }}/quote_md/"\n        dest: c:\\\\app\\gf\\quote_md\\\n      tags:\n        - copy_gf\n    - name: copy gf config file\n      win_copy:\n        src: "/var/jenkins_home/project_config/gf_md/source_md.yaml"\n        dest: c:\\\\app\\gf\\quote_md\\etc\n      tags:\n        - copy_gf_config\n    - name: copy quote file\n      win_copy:\n        src: "{{ workspace }}/quote_md/"\n        dest: c:\\\\app\\quote\\md\\\n      tags:\n        - copy_quote\n    - name: copy quote config file\n      win_copy:\n        src: "/var/jenkins_home/project_config/airm_md/source_md.yaml"\n        dest: c:\\\\app\\quote\\md\\etc\n      tags:\n        - copy_quote_config\n    - name: start trade service\n      win_command: c:\\windows\\system32\\schtasks.exe /run /tn start_gf\n      tags:\n        - start_gf\n      ignore_errors: true\n    - name: start quote service\n      win_command: c:\\windows\\system32\\schtasks.exe /run /tn start_quote\n      ignore_errors: true\n      tags:\n        - start_quote\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n# hostsæä»¶\n\n[windows_deploy02]\n172.16.30.198 ansible_ssh_port=5985 ansible_ssh_user=admin ansible_ssh_pass=123456 ansible_connection=winrm ansible_winrm_server_cert_validation=ignore ansible_winrm_transport=ssl\n\n\n1\n2\n\n\n# jenkinsfileæä»¶\n\n\n\n\n1\n',charsets:{cjk:!0}},{title:"nginxéç½®æç¨",frontmatter:{title:"nginxéç½®æç¨",categories:"nginx",tags:["nginx"],date:"2022-12-09T20:48:36.000Z",permalink:"/pages/5ed327/",readingShow:"top",description:"](http://nginx.org/)",meta:[{name:"image",content:"https://dictator.oss-cn-hongkong.aliyuncs.com/hexo/title/nginx.svg"},{name:"twitter:title",content:"nginxéç½®æç¨"},{name:"twitter:description",content:"](http://nginx.org/)"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://dictator.oss-cn-hongkong.aliyuncs.com/hexo/title/nginx.svg"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.nginx/01.nginx%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html"},{property:"og:type",content:"article"},{property:"og:title",content:"nginxéç½®æç¨"},{property:"og:description",content:"](http://nginx.org/)"},{property:"og:image",content:"https://dictator.oss-cn-hongkong.aliyuncs.com/hexo/title/nginx.svg"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.nginx/01.nginx%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:48:36.000Z"},{property:"article:tag",content:"nginx"},{itemprop:"name",content:"nginxéç½®æç¨"},{itemprop:"description",content:"](http://nginx.org/)"},{itemprop:"image",content:"https://dictator.oss-cn-hongkong.aliyuncs.com/hexo/title/nginx.svg"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.nginx/01.nginx%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html",relativePath:"04.è¿ç»´/03.ä¸­é´ä»¶/01.nginx/01.nginxéç½®æç¨.md",key:"v-0df2a669",path:"/pages/5ed327/",headers:[{level:2,title:"å®è£",slug:"å®è£",normalizedTitle:"å®è£",charIndex:260},{level:3,title:"å®è£ä¾èµ",slug:"å®è£ä¾èµ",normalizedTitle:"å®è£ä¾èµ",charIndex:267},{level:3,title:"ä¸è½½",slug:"ä¸è½½",normalizedTitle:"ä¸è½½",charIndex:494},{level:3,title:"ç¼è¯å®è£",slug:"ç¼è¯å®è£",normalizedTitle:"ç¼è¯å®è£",charIndex:722},{level:3,title:"nginxæµè¯",slug:"nginxæµè¯",normalizedTitle:"nginxæµè¯",charIndex:1828},{level:3,title:"è®¾ç½®å¨å±nginxå½ä»¤",slug:"è®¾ç½®å¨å±nginxå½ä»¤",normalizedTitle:"è®¾ç½®å¨å±nginxå½ä»¤",charIndex:2100},{level:2,title:"Mac å®è£",slug:"mac-å®è£",normalizedTitle:"mac å®è£",charIndex:2296},{level:3,title:"å®è£nginx",slug:"å®è£nginx",normalizedTitle:"å®è£nginx",charIndex:2357},{level:3,title:"å¯å¨æå¡",slug:"å¯å¨æå¡",normalizedTitle:"å¯å¨æå¡",charIndex:4952},{level:2,title:"å¼æºèªå¯å¨",slug:"å¼æºèªå¯å¨",normalizedTitle:"å¼æºèªå¯å¨",charIndex:5050},{level:2,title:"è¿ç»´",slug:"è¿ç»´",normalizedTitle:"è¿ç»´",charIndex:7065},{level:3,title:"æå¡ç®¡ç",slug:"æå¡ç®¡ç",normalizedTitle:"æå¡ç®¡ç",charIndex:7072},{level:3,title:"éå¯æå¡é²ç«å¢æ¥éè§£å³",slug:"éå¯æå¡é²ç«å¢æ¥éè§£å³",normalizedTitle:"éå¯æå¡é²ç«å¢æ¥éè§£å³",charIndex:7610},{level:2,title:"nginxå¸è½½",slug:"nginxå¸è½½",normalizedTitle:"nginxå¸è½½",charIndex:8083},{level:2,title:"åæ°è¯´æ",slug:"åæ°è¯´æ",normalizedTitle:"åæ°è¯´æ",charIndex:748},{level:2,title:"éç½®",slug:"éç½®",normalizedTitle:"éç½®",charIndex:7},{level:3,title:"å¸¸ç¨æ­£å",slug:"å¸¸ç¨æ­£å",normalizedTitle:"å¸¸ç¨æ­£å",charIndex:15868},{level:3,title:"å¨å±åé",slug:"å¨å±åé",normalizedTitle:"å¨å±åé",charIndex:16132},{level:3,title:"ç¬¦å·åè",slug:"ç¬¦å·åè",normalizedTitle:"ç¬¦å·åè",charIndex:17474},{level:3,title:"éç½®æä»¶",slug:"éç½®æä»¶",normalizedTitle:"éç½®æä»¶",charIndex:6588},{level:3,title:"åç½®é¢å®ä¹åé",slug:"åç½®é¢å®ä¹åé",normalizedTitle:"åç½®é¢å®ä¹åé",charIndex:20544},{level:3,title:"ååä»£ç",slug:"ååä»£ç",normalizedTitle:"ååä»£ç",charIndex:42},{level:3,title:"è´è½½åè¡¡",slug:"è´è½½åè¡¡",normalizedTitle:"è´è½½åè¡¡",charIndex:90},{level:4,title:"RR",slug:"rr",normalizedTitle:"rr",charIndex:25126},{level:4,title:"æé",slug:"æé",normalizedTitle:"æé",charIndex:23275},{level:4,title:"ip_hash",slug:"ip-hash",normalizedTitle:"ip_hash",charIndex:12201},{level:4,title:"fair",slug:"fair",normalizedTitle:"fair",charIndex:26296},{level:4,title:"url_hash",slug:"url-hash",normalizedTitle:"url_hash",charIndex:26444},{level:3,title:"å±è½ip",slug:"å±è½ip",normalizedTitle:"å±è½ip",charIndex:27110},{level:2,title:"ç¬¬ä¸æ¹æ¨¡åå®è£æ¹æ³",slug:"ç¬¬ä¸æ¹æ¨¡åå®è£æ¹æ³",normalizedTitle:"ç¬¬ä¸æ¹æ¨¡åå®è£æ¹æ³",charIndex:27687},{level:2,title:"éå®å",slug:"éå®å",normalizedTitle:"éå®å",charIndex:280},{level:3,title:"éå®åæ´ä¸ªç½ç«",slug:"éå®åæ´ä¸ªç½ç«",normalizedTitle:"éå®åæ´ä¸ªç½ç«",charIndex:27836},{level:3,title:"éå®ååé¡µ",slug:"éå®ååé¡µ",normalizedTitle:"éå®ååé¡µ",charIndex:27953},{level:3,title:"éå®åæ´ä¸ªå­è·¯å¾",slug:"éå®åæ´ä¸ªå­è·¯å¾",normalizedTitle:"éå®åæ´ä¸ªå­è·¯å¾",charIndex:28079},{level:2,title:"æ§è½",slug:"æ§è½",normalizedTitle:"æ§è½",charIndex:26},{level:3,title:"åå®¹ç¼å­",slug:"åå®¹ç¼å­",normalizedTitle:"åå®¹ç¼å­",charIndex:28204},{level:3,title:"Gzipåç¼©",slug:"gzipåç¼©",normalizedTitle:"gzipåç¼©",charIndex:28442},{level:3,title:"æå¼æä»¶ç¼å­",slug:"æå¼æä»¶ç¼å­",normalizedTitle:"æå¼æä»¶ç¼å­",charIndex:29027},{level:3,title:"SSLç¼å­",slug:"sslç¼å­",normalizedTitle:"sslç¼å­",charIndex:29173},{level:3,title:"ä¸æ¸¸Keepalive",slug:"ä¸æ¸¸keepalive",normalizedTitle:"ä¸æ¸¸keepalive",charIndex:29252},{level:3,title:"çæ§",slug:"çæ§",normalizedTitle:"çæ§",charIndex:29520},{level:2,title:"å¸¸è§ä½¿ç¨åºæ¯",slug:"å¸¸è§ä½¿ç¨åºæ¯",normalizedTitle:"å¸¸è§ä½¿ç¨åºæ¯",charIndex:30303},{level:3,title:"è·¨åé®é¢",slug:"è·¨åé®é¢",normalizedTitle:"è·¨åé®é¢",charIndex:30314},{level:3,title:"è·³è½¬å°å¸¦wwwçåä¸é¢",slug:"è·³è½¬å°å¸¦wwwçåä¸é¢",normalizedTitle:"è·³è½¬å°å¸¦wwwçåä¸é¢",charIndex:32164},{level:3,title:"ä»£çè½¬å",slug:"ä»£çè½¬å",normalizedTitle:"ä»£çè½¬å",charIndex:32598},{level:3,title:"çæ§ç¶æä¿¡æ¯",slug:"çæ§ç¶æä¿¡æ¯",normalizedTitle:"çæ§ç¶æä¿¡æ¯",charIndex:33561},{level:3,title:"ä»£çè½¬åè¿æ¥æ¿æ¢",slug:"ä»£çè½¬åè¿æ¥æ¿æ¢",normalizedTitle:"ä»£çè½¬åè¿æ¥æ¿æ¢",charIndex:34104},{level:3,title:"ssléç½®",slug:"ssléç½®",normalizedTitle:"ssléç½®",charIndex:34231},{level:3,title:"å¼ºå¶å°httpéå®åå°https",slug:"å¼ºå¶å°httpéå®åå°https",normalizedTitle:"å¼ºå¶å°httpéå®åå°https",charIndex:37156},{level:3,title:"ä¸¤ä¸ªèæä¸»æº",slug:"ä¸¤ä¸ªèæä¸»æº",normalizedTitle:"ä¸¤ä¸ªèæä¸»æº",charIndex:37413},{level:3,title:"èæä¸»æºæ åéç½®",slug:"èæä¸»æºæ åéç½®",normalizedTitle:"èæä¸»æºæ åéç½®",charIndex:38003},{level:3,title:"ç¬è«è¿æ»¤",slug:"ç¬è«è¿æ»¤",normalizedTitle:"ç¬è«è¿æ»¤",charIndex:38263},{level:3,title:"é²çé¾",slug:"é²çé¾",normalizedTitle:"é²çé¾",charIndex:38503},{level:3,title:"èæç®å½éç½®",slug:"èæç®å½éç½®",normalizedTitle:"èæç®å½éç½®",charIndex:38712},{level:3,title:"é²çå¾éç½®",slug:"é²çå¾éç½®",normalizedTitle:"é²çå¾éç½®",charIndex:38995},{level:3,title:"å±è½.gitç­æä»¶",slug:"å±è½-gitç­æä»¶",normalizedTitle:"å±è½.gitç­æä»¶",charIndex:39237},{level:3,title:"ååè·¯å¾å ä¸å éè¦é½è½æ­£å¸¸è®¿é®",slug:"ååè·¯å¾å ä¸å éè¦é½è½æ­£å¸¸è®¿é®",normalizedTitle:"ååè·¯å¾å ä¸å éè¦é½è½æ­£å¸¸è®¿é®",charIndex:39330},{level:2,title:"éè¯¯é®é¢",slug:"éè¯¯é®é¢",normalizedTitle:"éè¯¯é®é¢",charIndex:39814},{level:2,title:"Nginx æ¨¡å",slug:"nginx-æ¨¡å",normalizedTitle:"nginx æ¨¡å",charIndex:40271},{level:2,title:"ç²¾åæç« åè",slug:"ç²¾åæç« åè",normalizedTitle:"ç²¾åæç« åè",charIndex:40339}],headersStr:"å®è£ å®è£ä¾èµ ä¸è½½ ç¼è¯å®è£ nginxæµè¯ è®¾ç½®å¨å±nginxå½ä»¤ Mac å®è£ å®è£nginx å¯å¨æå¡ å¼æºèªå¯å¨ è¿ç»´ æå¡ç®¡ç éå¯æå¡é²ç«å¢æ¥éè§£å³ nginxå¸è½½ åæ°è¯´æ éç½® å¸¸ç¨æ­£å å¨å±åé ç¬¦å·åè éç½®æä»¶ åç½®é¢å®ä¹åé ååä»£ç è´è½½åè¡¡ RR æé ip_hash fair url_hash å±è½ip ç¬¬ä¸æ¹æ¨¡åå®è£æ¹æ³ éå®å éå®åæ´ä¸ªç½ç« éå®ååé¡µ éå®åæ´ä¸ªå­è·¯å¾ æ§è½ åå®¹ç¼å­ Gzipåç¼© æå¼æä»¶ç¼å­ SSLç¼å­ ä¸æ¸¸Keepalive çæ§ å¸¸è§ä½¿ç¨åºæ¯ è·¨åé®é¢ è·³è½¬å°å¸¦wwwçåä¸é¢ ä»£çè½¬å çæ§ç¶æä¿¡æ¯ ä»£çè½¬åè¿æ¥æ¿æ¢ ssléç½® å¼ºå¶å°httpéå®åå°https ä¸¤ä¸ªèæä¸»æº èæä¸»æºæ åéç½® ç¬è«è¿æ»¤ é²çé¾ èæç®å½éç½® é²çå¾éç½® å±è½.gitç­æä»¶ ååè·¯å¾å ä¸å éè¦é½è½æ­£å¸¸è®¿é® éè¯¯é®é¢ Nginx æ¨¡å ç²¾åæç« åè",content:'# Nginxéç½®æç¨\n\n\n\nNginx æ¯ä¸æ¬¾é¢åæ§è½è®¾è®¡ç HTTP æå¡å¨ï¼è½ååä»£ç HTTPï¼HTTPS åé®ä»¶ç¸å³(SMTPï¼POP3ï¼IMAP)çåè®®é¾æ¥ãå¹¶ä¸æä¾äºè´è½½åè¡¡ä»¥å HTTP ç¼å­ãå®çè®¾è®¡ååä½¿ç¨å¼æ­¥äºä»¶æ¨¡åï¼ååä¸ä¸æè°åº¦çå¼éï¼æé«æå¡å¨å¹¶åè½åãéç¨äºæ¨¡ååè®¾è®¡ï¼æä¾äºä¸°å¯æ¨¡åçç¬¬ä¸æ¹æ¨¡åã\n\næä»¥å³äº Nginxï¼æè¿äºæ ç­¾ï¼ãå¼æ­¥ããäºä»¶ããæ¨¡ååããé«æ§è½ããé«å¹¶åããååä»£çããè´è½½åè¡¡ã\n\nLinuxç³»ç»ï¼Centos 7 x64 Nginxçæ¬ï¼1.11.5\n\n\n# å®è£\n\n\n# å®è£ä¾èµ\n\n> prce(éå®åæ¯æ)åopenssl(httpsæ¯æï¼å¦æä¸éè¦httpså¯ä»¥ä¸å®è£ã)\n\nå¤å¶yum install -y pcre-devel \nyum -y install gcc make gcc-c++ wget\nyum -y install openssl openssl-devel\n\n\n1\n2\n3\n\n\nCentOS 6.5 æå®è£çæ¶åæ¯éæ©çâåºæ¬æå¡å¨âï¼é»è®¤è¿ä¸¤ä¸ªåé½æ²¡å®è£å¨ï¼æä»¥è¿ä¸¤ä¸ªé½è¿è¡å®è£å³å¯ã\n\n\n# ä¸è½½\n\nnginxçææçæ¬å¨è¿é\n\nå¤å¶wget http://nginx.org/download/nginx-1.13.3.tar.gz\nwget http://nginx.org/download/nginx-1.13.7.tar.gz\n\n# å¦ææ²¡æå®è£wget\n# ä¸è½½å·²ç¼è¯çæ¬\n$ yum install wget\n\n# è§£ååç¼©å\ntar zxf nginx-1.13.3.tar.gz\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# ç¼è¯å®è£\n\nç¶åè¿å¥ç®å½ç¼è¯å®è£ï¼configureåæ°è¯´æ\n\nå¤å¶cd nginx-1.11.5\n./configure\n\n....\nConfiguration summary\n  + using system PCRE library\n  + OpenSSL library is not used\n  + using system zlib library\n\n  nginx path prefix: "/usr/local/nginx"\n  nginx binary file: "/usr/local/nginx/sbin/nginx"\n  nginx modules path: "/usr/local/nginx/modules"\n  nginx configuration prefix: "/usr/local/nginx/conf"\n  nginx configuration file: "/usr/local/nginx/conf/nginx.conf"\n  nginx pid file: "/usr/local/nginx/logs/nginx.pid"\n  nginx error log file: "/usr/local/nginx/logs/error.log"\n  nginx http access log file: "/usr/local/nginx/logs/access.log"\n  nginx http client request body temporary files: "client_body_temp"\n  nginx http proxy temporary files: "proxy_temp"\n  nginx http fastcgi temporary files: "fastcgi_temp"\n  nginx http uwsgi temporary files: "uwsgi_temp"\n  nginx http scgi temporary files: "scgi_temp"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nå®è£æ¥éè¯¯çè¯æ¯å¦ï¼âC compiler cc is not foundâï¼è¿ä¸ªå°±æ¯ç¼ºå°ç¼è¯ç¯å¢ï¼å®è£ä¸ä¸å°±å¯ä»¥äº yum -y install gcc make gcc-c++ openssl-devel\n\nå¦ææ²¡æerrorä¿¡æ¯ï¼å°±å¯ä»¥æ§è¡ä¸è¾¹çå®è£äºï¼\n\nå¤å¶make\nmake install\n\n\n1\n2\n\n\n\n# nginxæµè¯\n\nè¿è¡ä¸é¢å½ä»¤ä¼åºç°ä¸¤ä¸ªç»æï¼ä¸è¬æåµnginxä¼å®è£å¨/usr/local/nginxç®å½ä¸­\n\nå¤å¶cd /usr/local/nginx/sbin/\n./nginx -t\n\n# nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok\n# nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful\n\n\n1\n2\n3\n4\n5\n\n\n\n# è®¾ç½®å¨å±nginxå½ä»¤\n\nå¤å¶vi ~/.bash_profile\n\n\n1\n\n\nå°ä¸é¢åå®¹æ·»å å° ~/.bash_profile æä»¶ä¸­\n\nå¤å¶PATH=$PATH:$HOME/bin:/usr/local/nginx/sbin/\nexport PATH\n\n\n1\n2\n\n\nè¿è¡å½ä»¤ source ~/.bash_profile è®©éç½®ç«å³çæãä½ å°±å¯ä»¥å¨å±è¿è¡ nginx å½ä»¤äºã\n\n\n# Mac å®è£\n\nMac OSX å®è£ç¹å«ç®åï¼é¦åä½ éè¦å®è£ Brewï¼ éè¿ brew å¿«éå®è£ nginxã\n\n\n# å®è£nginx\n\nå¤å¶brew install nginx\n# Updating Homebrew...\n# ==> Auto-updated Homebrew!\n# Updated 2 taps (homebrew/core, homebrew/cask).\n# ==> Updated Formulae\n# ==> Installing dependencies for nginx: openssl, pcre\n# ==> Installing nginx dependency: openssl\n# ==> Downloading https://homebrew.bintray.com/bottles/openssl-1.0.2o_1.high_sierra.bottle.tar.gz\n# ######################################################################## 100.0%\n# ==> Pouring openssl-1.0.2o_1.high_sierra.bottle.tar.gz\n# ==> Caveats\n# A CA file has been bootstrapped using certificates from the SystemRoots\n# keychain. To add additional certificates (e.g. the certificates added in\n# the System keychain), place .pem files in\n#   /usr/local/etc/openssl/certs\n# \n# and run\n#   /usr/local/opt/openssl/bin/c_rehash\n# \n# This formula is keg-only, which means it was not symlinked into /usr/local,\n# because Apple has deprecated use of OpenSSL in favor of its own TLS and crypto libraries.\n# \n# If you need to have this software first in your PATH run:\n#   echo \'export PATH="/usr/local/opt/openssl/bin:$PATH"\' >> ~/.zshrc\n# \n# For compilers to find this software you may need to set:\n#     LDFLAGS:  -L/usr/local/opt/openssl/lib\n#     CPPFLAGS: -I/usr/local/opt/openssl/include\n# For pkg-config to find this software you may need to set:\n#     PKG_CONFIG_PATH: /usr/local/opt/openssl/lib/pkgconfig\n# \n# ==> Summary\n# ðº  /usr/local/Cellar/openssl/1.0.2o_1: 1,791 files, 12.3MB\n# ==> Installing nginx dependency: pcre\n# ==> Downloading https://homebrew.bintray.com/bottles/pcre-8.42.high_sierra.bottle.tar.gz\n# ######################################################################## 100.0%\n# ==> Pouring pcre-8.42.high_sierra.bottle.tar.gz\n# ðº  /usr/local/Cellar/pcre/8.42: 204 files, 5.3MB\n# ==> Installing nginx\n# ==> Downloading https://homebrew.bintray.com/bottles/nginx-1.13.12.high_sierra.bottle.tar.gz\n# ######################################################################## 100.0%\n# ==> Pouring nginx-1.13.12.high_sierra.bottle.tar.gz\n# ==> Caveats\n# Docroot is: /usr/local/var/www\n# \n# The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that\n# nginx can run without sudo.\n# \n# nginx will load all files in /usr/local/etc/nginx/servers/.\n# \n# To have launchd start nginx now and restart at login:\n#   brew services start nginx\n# Or, if you don\'t wacd /usr/local/Cellar/nginx/1.13.12/n just run:\n# cd /usr/local/Cellar/nginx/1.13.12/\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n\n\n\n# å¯å¨æå¡\n\næ³¨æé»è®¤ç«¯å£ä¸æ¯ 8080 æ¥çç¡®è®¤ç«¯å£æ¯å¦è¢«å ç¨ã\n\nå¤å¶brew services start nginx\n# http://localhost:8080/\n\n\n1\n2\n\n\n\n# å¼æºèªå¯å¨\n\nå¼æºèªå¯å¨æ¹æ³ä¸ï¼\n\nç¼è¾ vi /lib/systemd/system/nginx.service æä»¶ï¼æ²¡æåå»ºä¸ä¸ª touch nginx.service ç¶åå°å¦ä¸åå®¹æ ¹æ®å·ä½æåµè¿è¡ä¿®æ¹åï¼æ·»å å°nginx.serviceæä»¶ä¸­ï¼\n\nå¤å¶[Unit]\nDescription=nginx\nAfter=network.target remote-fs.target nss-lookup.target\n\n[Service]\n\nType=forking\nPIDFile=/var/run/nginx.pid\nExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf\nExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf\nExecReload=/bin/kill -s HUP $MAINPID\nExecStop=/bin/kill -s QUIT $MAINPID\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n * [Unit]:æå¡çè¯´æ\n * Description:æè¿°æå¡\n * After:æè¿°æå¡ç±»å«\n * [Service]æå¡è¿è¡åæ°çè®¾ç½®\n * Type=forkingæ¯åå°è¿è¡çå½¢å¼\n * ExecStartä¸ºæå¡çå·ä½è¿è¡å½ä»¤\n * ExecReloadä¸ºéå¯å½ä»¤\n * ExecStopä¸ºåæ­¢å½ä»¤\n * PrivateTmp=Trueè¡¨ç¤ºç»æå¡åéç¬ç«çä¸´æ¶ç©ºé´\n\næ³¨æï¼[Service]çå¯å¨ãéå¯ãåæ­¢å½ä»¤å¨é¨è¦æ±ä½¿ç¨ç»å¯¹è·¯å¾ã\n\n[Install]è¿è¡çº§å«ä¸æå¡å®è£çç¸å³è®¾ç½®ï¼å¯è®¾ç½®ä¸ºå¤ç¨æ·ï¼å³ç³»ç»è¿è¡çº§å«ä¸º3ã\n\nä¿å­éåºã\n\nè®¾ç½®å¼æºå¯å¨ï¼ä½¿éç½®çæï¼\n\nå¤å¶# å¯å¨nginxæå¡\nsystemctl start nginx.service\n# åæ­¢å¼æºèªå¯å¨\nsystemctl disable nginx.service\n# æ¥çæå¡å½åç¶æ\nsystemctl status nginx.service\n# æ¥çææå·²å¯å¨çæå¡\nsystemctl list-units --type=service\n# éæ°å¯å¨æå¡\nsystemctl restart nginx.service\n# è®¾ç½®å¼æºèªå¯å¨\nsystemctl enable nginx.service\n# è¾åºä¸é¢åå®¹è¡¨ç¤ºæåäº\nCreated symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.\nå¤å¶systemctl is-enabled servicename.service # æ¥è¯¢æå¡æ¯å¦å¼æºå¯å¨\nsystemctl enable *.service # å¼æºè¿è¡æå¡\nsystemctl disable *.service # åæ¶å¼æºè¿è¡\nsystemctl start *.service # å¯å¨æå¡\nsystemctl stop *.service # åæ­¢æå¡\nsystemctl restart *.service # éå¯æå¡\nsystemctl reload *.service # éæ°å è½½æå¡éç½®æä»¶\nsystemctl status *.service # æ¥è¯¢æå¡è¿è¡ç¶æ\nsystemctl --failed # æ¾ç¤ºå¯å¨å¤±è´¥çæå¡\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næ³¨ï¼*ä»£è¡¨æä¸ªæå¡çåå­ï¼å¦httpçæå¡åä¸ºhttpd\n\nå¼æºèªå¯å¨æ¹æ³äºï¼\n\nå¤å¶vi /etc/rc.local\n\n# å¨ rc.local æä»¶ä¸­ï¼æ·»å ä¸é¢è¿æ¡å½ä»¤\n/usr/local/nginx/sbin/nginx start\n\n\n1\n2\n3\n4\n\n\nå¦æå¼æºååç°èªå¯å¨èæ¬æ²¡ææ§è¡ï¼ä½ è¦å»ç¡®è®¤ä¸ä¸rc.localè¿ä¸ªæä»¶çè®¿é®æéæ¯å¦æ¯å¯æ§è¡çï¼å ä¸ºrc.localé»è®¤æ¯ä¸å¯æ§è¡çãä¿®æ¹rc.localè®¿é®æéï¼å¢å å¯æ§è¡æéï¼\n\nå¤å¶# /etc/rc.localæ¯/etc/rc.d/rc.localçè½¯è¿æ¥ï¼\nchmod +x /etc/rc.d/rc.local\n\n\n1\n2\n\n\nå®æ¹èæ¬ ed Hat NGINX Init Scriptã\n\n\n# è¿ç»´\n\n\n# æå¡ç®¡ç\n\nå¤å¶# å¯å¨\n/usr/local/nginx/sbin/nginx\n\n# éå¯\n/usr/local/nginx/sbin/nginx -s reload\n\n# å³é­è¿ç¨\n/usr/local/nginx/sbin/nginx -s stop\n\n# å¹³æ»å³é­nginx\n/usr/local/nginx/sbin/nginx -s quit\n\n# æ¥çnginxçå®è£ç¶æï¼\n/usr/local/nginx/sbin/nginx -V\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nå³é­é²ç«å¢ï¼æèæ·»å é²ç«å¢è§åå°±å¯ä»¥æµè¯äº\n\nå¤å¶service iptables stop\n\n\n1\n\n\næèç¼è¾éç½®æä»¶ï¼\n\nå¤å¶vi /etc/sysconfig/iptables\n\n\n1\n\n\næ·»å è¿æ ·ä¸æ¡å¼æ¾80ç«¯å£çè§ååä¿å­ï¼\n\nå¤å¶-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT\n\n\n1\n\n\néå¯æå¡å³å¯:\n\nå¤å¶service iptables restart\n# å½ä»¤è¿è¡æ¥çç®ånat\niptables -t nat -L\n\n\n1\n2\n3\n\n\n\n# éå¯æå¡é²ç«å¢æ¥éè§£å³\n\nå¤å¶service iptables restart\n# Redirecting to /bin/systemctl restart  iptables.service\n# Failed to restart iptables.service: Unit iptables.service failed to load: No such file or directory.\n\n\n1\n2\n3\n\n\nå¨CentOS 7æRHEL 7æFedoraä¸­é²ç«å¢ç± firewalld æ¥ç®¡çï¼å½ç¶ä½ å¯ä»¥è¿åä¼ ç»çç®¡çæ¹å¼ãæåä½¿ç¨æ°çå½ä»¤è¿è¡ç®¡çã åå¦éç¨ä¼ ç»è¯·æ§è¡ä¸ä¸å½ä»¤ï¼\n\nå¤å¶# ä¼ ç»å½ä»¤\nsystemctl stop firewalld\nsystemctl mask firewalld\nå¤å¶# å®è£å½ä»¤\nyum install iptables-services\n\nsystemctl enable iptables \nservice iptables restart\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# nginxå¸è½½\n\nå¦æéè¿yumå®è£ï¼ä½¿ç¨ä¸é¢å½ä»¤å®è£ã\n\nå¤å¶yum remove nginx\n\n\n1\n\n\nç¼è¯å®è£ï¼å é¤/usr/local/nginxç®å½å³å¯ å¦æéç½®äºèªå¯å¨èæ¬ï¼ä¹éè¦å é¤ã\n\n\n# åæ°è¯´æ\n\nåæ°                                           è¯´æ\nâprefix=<path>                               Nginxå®è£è·¯å¾ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º /usr/local/nginxã\nâsbin-path=<path>                            Nginxå¯æ§è¡æä»¶å®è£è·¯å¾ãåªè½å®è£æ¶æå®ï¼å¦ææ²¡ææå®ï¼é»è®¤ä¸º<prefix>/sbin/nginxã\nâconf-path=<path>                            å¨æ²¡æç»å®-céé¡¹ä¸é»è®¤çnginx.confçè·¯å¾ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º<prefix>/conf/nginx.confã\nâpid-path=<path>                             å¨nginx.confä¸­æ²¡ææå®pidæä»¤çæåµä¸ï¼é»è®¤çnginx.pidçè·¯å¾ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º\n                                             <prefix>/logs/nginx.pidã\nâlock-path=<path>                            nginx.lockæä»¶çè·¯å¾ã\nâerror-log-path=<path>                       å¨nginx.confä¸­æ²¡ææå®error_logæä»¤çæåµä¸ï¼é»è®¤çéè¯¯æ¥å¿çè·¯å¾ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º\n                                             <prefix>/- logs/error.logã\nâhttp-log-path=<path>                        å¨nginx.confä¸­æ²¡ææå®access_logæä»¤çæåµä¸ï¼é»è®¤çè®¿é®æ¥å¿çè·¯å¾ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º\n                                             <prefix>/- logs/access.logã\nâuser=<user>                                 å¨nginx.confä¸­æ²¡ææå®useræä»¤çæåµä¸ï¼é»è®¤çnginxä½¿ç¨çç¨æ·ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º nobodyã\nâgroup=<group>                               å¨nginx.confä¸­æ²¡ææå®useræä»¤çæåµä¸ï¼é»è®¤çnginxä½¿ç¨çç»ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º nobodyã\nâbuilddir=DIR                                æå®ç¼è¯çç®å½\nâwith-rtsig_module                           å¯ç¨ rtsig æ¨¡å\nâwith-select_module âwithout-select_module   åè®¸æä¸åè®¸å¼å¯SELECTæ¨¡å¼ï¼å¦æ configure æ²¡ææ¾å°æ´åéçæ¨¡å¼ï¼æ¯å¦ï¼kqueue(sun\n                                             os),epoll (linux kenel 2.6+), rtsig(-\n                                             å®æ¶ä¿¡å·)æè/dev/poll(ä¸ç§ç±»ä¼¼selectçæ¨¡å¼ï¼åºå±å®ç°ä¸SELECTåºæ¬ç¸ åï¼é½æ¯éç¨è½®è®­æ¹æ³)\n                                             SELECTæ¨¡å¼å°æ¯é»è®¤å®è£æ¨¡å¼\nâwith-poll_module âwithout-poll_module       Whether or not to enable the poll module. This module is\n                                             enabled by, default if a more suitable method such as\n                                             kqueue, epoll, rtsig or /dev/poll is not discovered by\n                                             configure.\nâwith-http_ssl_module                        Enable ngx_http_ssl_module. Enables SSL support and the\n                                             ability to handle HTTPS requests. Requires OpenSSL. On\n                                             Debian, this is libssl-dev. å¼å¯HTTP\n                                             SSLæ¨¡åï¼ä½¿NGINXå¯ä»¥æ¯æHTTPSè¯·æ±ãè¿ä¸ªæ¨¡åéè¦å·²ç»å®è£äºOPENSSLï¼å¨DEBIANä¸æ¯libssl\nâwith-http_realip_module                     å¯ç¨ ngx_http_realip_module\nâwith-http_addition_module                   å¯ç¨ ngx_http_addition_module\nâwith-http_sub_module                        å¯ç¨ ngx_http_sub_module\nâwith-http_dav_module                        å¯ç¨ ngx_http_dav_module\nâwith-http_flv_module                        å¯ç¨ ngx_http_flv_module\nâwith-http_stub_status_module                å¯ç¨ âserver statusâ é¡µ\nâwithout-http_charset_module                 ç¦ç¨ ngx_http_charset_module\nâwithout-http_gzip_module                    ç¦ç¨ ngx_http_gzip_module. å¦æå¯ç¨ï¼éè¦ zlib ã\nâwithout-http_ssi_module                     ç¦ç¨ ngx_http_ssi_module\nâwithout-http_userid_module                  ç¦ç¨ ngx_http_userid_module\nâwithout-http_access_module                  ç¦ç¨ ngx_http_access_module\nâwithout-http_auth_basic_module              ç¦ç¨ ngx_http_auth_basic_module\nâwithout-http_autoindex_module               ç¦ç¨ ngx_http_autoindex_module\nâwithout-http_geo_module                     ç¦ç¨ ngx_http_geo_module\nâwithout-http_map_module                     ç¦ç¨ ngx_http_map_module\nâwithout-http_referer_module                 ç¦ç¨ ngx_http_referer_module\nâwithout-http_rewrite_module                 ç¦ç¨ ngx_http_rewrite_module. å¦æå¯ç¨éè¦ PCRE ã\nâwithout-http_proxy_module                   ç¦ç¨ ngx_http_proxy_module\nâwithout-http_fastcgi_module                 ç¦ç¨ ngx_http_fastcgi_module\nâwithout-http_memcached_module               ç¦ç¨ ngx_http_memcached_module\nâwithout-http_limit_zone_module              ç¦ç¨ ngx_http_limit_zone_module\nâwithout-http_empty_gif_module               ç¦ç¨ ngx_http_empty_gif_module\nâwithout-http_browser_module                 ç¦ç¨ ngx_http_browser_module\nâwithout-http_upstream_ip_hash_module        ç¦ç¨ ngx_http_upstream_ip_hash_module\nâwith-http_perl_module                       å¯ç¨ ngx_http_perl_module\nâwith-perl_modules_path=PATH                 æå® perl æ¨¡åçè·¯å¾\nâwith-perl=PATH                              æå® perl æ§è¡æä»¶çè·¯å¾\nâhttp-log-path=PATH                          Set path to the http access log\nâhttp-client-body-temp-path=PATH             Set path to the http client request body temporary files\nâhttp-proxy-temp-path=PATH                   Set path to the http proxy temporary files\nâhttp-fastcgi-temp-path=PATH                 Set path to the http fastcgi temporary files\nâwithout-http                                ç¦ç¨ HTTP server\nâwith-mail                                   å¯ç¨ IMAP4/POP3/SMTP ä»£çæ¨¡å\nâwith-mail_ssl_module                        å¯ç¨ ngx_mail_ssl_module\nâwith-cc=PATH                                æå® C ç¼è¯å¨çè·¯å¾\nâwith-cpp=PATH                               æå® C é¢å¤çå¨çè·¯å¾\nâwith-cc-opt=OPTIONS                         Additional parameters which will be added to the variable\n                                             CFLAGS. With the use of the system library PCRE in FreeBSD,\n                                             it is necessary to indicate âwith-cc-opt=â-I\n                                             /usr/local/includeâ. If we are using select() and it is\n                                             necessary to increase the number of file descriptors, then\n                                             this also can be assigned here: âwith-cc-opt=â-D\n                                             FD_SETSIZE=2048â.\nâwith-ld-opt=OPTIONS                         Additional parameters passed to the linker. With the use of\n                                             the system library PCRE in - FreeBSD, it is necessary to\n                                             indicate âwith-ld-opt=â-L /usr/local/libâ.\nâwith-cpu-opt=CPU                            ä¸ºç¹å®ç CPU ç¼è¯ï¼ææçå¼åæ¬ï¼pentium, pentiumpro, pentium3, pentium4,\n                                             athlon, opteron, amd64, sparc32, sparc64, ppc64\nâwithout-pcre                                ç¦æ­¢ PCRE åºçä½¿ç¨ãåæ¶ä¹ä¼ç¦æ­¢ HTTP rewrite æ¨¡åãå¨ âlocationâ\n                                             éç½®æä»¤ä¸­çæ­£åè¡¨è¾¾å¼ä¹éè¦ PCRE ã\nâwith-pcre=DIR                               æå® PCRE åºçæºä»£ç çè·¯å¾ã\nâwith-pcre-opt=OPTIONS                       Set additional options for PCRE building.\nâwith-md5=DIR                                Set path to md5 library sources.\nâwith-md5-opt=OPTIONS                        Set additional options for md5 building.\nâwith-md5-asm                                Use md5 assembler sources.\nâwith-sha1=DIR                               Set path to sha1 library sources.\nâwith-sha1-opt=OPTIONS                       Set additional options for sha1 building.\nâwith-sha1-asm                               Use sha1 assembler sources.\nâwith-zlib=DIR                               Set path to zlib library sources.\nâwith-zlib-opt=OPTIONS                       Set additional options for zlib building.\nâwith-zlib-asm=CPU                           Use zlib assembler sources optimized for specified CPU,\n                                             valid values are: pentium, pentiumpro\nâwith-openssl=DIR                            Set path to OpenSSL library sources\nâwith-openssl-opt=OPTIONS                    Set additional options for OpenSSL building\nâwith-debug                                  å¯ç¨è°è¯æ¥å¿\nâadd-module=PATH                             Add in a third-party module found in directory PATH\n\n\n# éç½®\n\nå¨Centos é»è®¤éç½®æä»¶å¨ /usr/local/nginx-1.5.1/conf/nginx.conf æä»¬è¦å¨è¿ééç½®ä¸äºæä»¶ãnginx.confæ¯ä¸»éç½®æä»¶ï¼ç±è¥å¹²ä¸ªé¨åç»æï¼æ¯ä¸ªå¤§æ¬å·{}è¡¨ç¤ºä¸ä¸ªé¨åãæ¯ä¸è¡æä»¤é½ç±åå·ç»æ;ï¼æ å¿çä¸è¡çç»æã\n\n\n# å¸¸ç¨æ­£å\n\næ­£å   è¯´æ              æ­£å      è¯´æ\n.    å¹éé¤æ¢è¡ç¬¦ä»¥å¤çä»»æå­ç¬¦   $       å¹éå­ç¬¦ä¸²çç»æ\n?    éå¤0æ¬¡æ1æ¬¡         {n}     éå¤næ¬¡\n+    éå¤1æ¬¡ææ´å¤æ¬¡        {n,}    éå¤næ¬¡ææ´å¤æ¬¡\n*    éå¤0æ¬¡ææ´å¤æ¬¡        [c]     å¹éåä¸ªå­ç¬¦c\n\\d   å¹éæ°å­            [a-z]   å¹éa-zå°åå­æ¯çä»»æä¸ä¸ª\n^    å¹éå­ç¬¦ä¸²çå¼å§        -       -\n\n\n# å¨å±åé\n\nåé                 è¯´æ                             åé                  è¯´æ\n$args              è¿ä¸ªåéç­äºè¯·æ±è¡ä¸­çåæ°ï¼å$query_string   $remote_port        å®¢æ·ç«¯çç«¯å£ã\n$content_length    è¯·æ±å¤´ä¸­çContent-lengthå­æ®µã         $remote_user        å·²ç»ç»è¿Auth Basic Moduleéªè¯çç¨æ·åã\n$content_type      è¯·æ±å¤´ä¸­çContent-Typeå­æ®µã           $request_filename   å½åè¯·æ±çæä»¶è·¯å¾ï¼ç±rootæaliasæä»¤ä¸URIè¯·æ±çæã\n$document_root     å½åè¯·æ±å¨rootæä»¤ä¸­æå®çå¼ã              $scheme             HTTPæ¹æ³ï¼å¦httpï¼httpsï¼ã\n$host              è¯·æ±ä¸»æºå¤´å­æ®µï¼å¦åä¸ºæå¡å¨åç§°ã              $server_protocol    è¯·æ±ä½¿ç¨çåè®®ï¼éå¸¸æ¯HTTP/1.0æHTTP/1.1ã\n$http_user_agent   å®¢æ·ç«¯agentä¿¡æ¯                     $server_addr        æå¡å¨å°åï¼å¨å®æä¸æ¬¡ç³»ç»è°ç¨åå¯ä»¥ç¡®å®è¿ä¸ªå¼ã\n$http_cookie       å®¢æ·ç«¯cookieä¿¡æ¯                    $server_name        æå¡å¨åç§°ã\n$limit_rate        è¿ä¸ªåéå¯ä»¥éå¶è¿æ¥éçã                  $server_port        è¯·æ±å°è¾¾æå¡å¨çç«¯å£å·ã\n$request_method    å®¢æ·ç«¯è¯·æ±çå¨ä½ï¼éå¸¸ä¸ºGETæPOSTã          $request_uri        åå«è¯·æ±åæ°çåå§URIï¼ä¸åå«ä¸»æºåï¼å¦ï¼/foo/bar.php?arg=bazã\n$remote_addr       å®¢æ·ç«¯çIPå°åã                      $uri                ä¸å¸¦è¯·æ±åæ°çå½åURIï¼$uriä¸åå«ä¸»æºåï¼å¦/foo/bar.htmlã\n$document_uri      ä¸$uriç¸åã                       -                   -\n\nä¾å¦è¯·æ±ï¼http://localhost:3000/test1/test2/test.php\n\n$hostï¼localhost $server_portï¼3000 $request_uriï¼/test1/test2/test.php $document_uriï¼/test1/test2/test.php $document_rootï¼/var/www/html $request_filenameï¼/var/www/html/test1/test2/test.php\n\n\n# ç¬¦å·åè\n\nç¬¦å·    è¯´æ    ç¬¦å·    è¯´æ    ç¬¦å·   è¯´æ\nk,K   åå­è   m,M   åå­è   ms   æ¯«ç§\ns     ç§     m     åé    h    å°æ¶\nd     æ¥     w     å¨     M    ä¸ä¸ªæ, 30å¤©\n\nä¾å¦ï¼â8kâï¼â1mâ ä»£è¡¨å­èæ°è®¡éã ä¾å¦ï¼â1h 30mâï¼â1y 6Mâãä»£è¡¨ â1å°æ¶ 30åâï¼â1å¹´é¶6ä¸ªæâã\n\n\n# éç½®æä»¶\n\nnginx çéç½®ç³»ç»ç±ä¸ä¸ªä¸»éç½®æä»¶åå¶ä»ä¸äºè¾å©çéç½®æä»¶ææãè¿äºéç½®æä»¶åæ¯çº¯ææ¬æä»¶ï¼å¨é¨ä½äº nginx å®è£ç®å½ä¸ç conf ç®å½ä¸ã\n\næä»¤ç± nginx çåä¸ªæ¨¡åæä¾ï¼ä¸åçæ¨¡åä¼æä¾ä¸åçæä»¤æ¥å®ç°éç½®ã æä»¤é¤äº Key-Value çå½¢å¼ï¼è¿æä½ç¨åæä»¤ã\n\nnginx.conf ä¸­çéç½®ä¿¡æ¯ï¼æ ¹æ®å¶é»è¾ä¸çæä¹ï¼å¯¹å®ä»¬è¿è¡äºåç±»ï¼ä¹å°±æ¯åæäºå¤ä¸ªä½ç¨åï¼æèç§°ä¹ä¸ºéç½®æä»¤ä¸ä¸æãä¸åçä½ç¨åå«æä¸ä¸ªæèå¤ä¸ªéç½®é¡¹ã\n\nä¸é¢çè¿äºä¸ä¸ææä»¤æ¯ç¨çæ¯è¾å¤ï¼\n\nDIRECTIVE        DESCRIPTION                                                      CONTAINS DIRECTIVE\nmain             nginx å¨è¿è¡æ¶ä¸å·ä½ä¸å¡åè½ï¼æ¯å¦ http æå¡æè email                             user, worker_processes, error_log, events, http, mail\n                 æå¡ä»£çï¼æ å³çä¸äºåæ°ï¼æ¯å¦å·¥ä½è¿ç¨æ°ï¼è¿è¡çèº«ä»½ç­ã\nhttp             ä¸æä¾ http æå¡ç¸å³çä¸äºéç½®åæ°ãä¾å¦ï¼æ¯å¦ä½¿ç¨ keepalive åï¼æ¯å¦ä½¿ç¨ gzip è¿è¡åç¼©ç­ã        server\nserver           http æå¡ä¸æ¯æè¥å¹²èæä¸»æºãæ¯ä¸ªèæä¸»æºä¸ä¸ªå¯¹åºç server                              listen, server_name, access_log, location, protocol, proxy,\n                 éç½®é¡¹ï¼éç½®é¡¹éé¢åå«è¯¥èæä¸»æºç¸å³çéç½®ãå¨æä¾ mail æå¡çä»£çæ¶ï¼ä¹å¯ä»¥å»ºç«è¥å¹² server. æ¯ä¸ª         smtp_auth, xclient\n                 server éè¿çå¬çå°åæ¥åºåã\nlocation         http æå¡ä¸­ï¼æäºç¹å®ç URL å¯¹åºçä¸ç³»åéç½®é¡¹ã                                    index, root\nmail             å®ç° email ç¸å³ç SMTP/IMAP/POP3                                      server, http, imap_capabilities\n                 ä»£çæ¶ï¼å±äº«çä¸äºéç½®é¡¹ï¼å ä¸ºå¯è½å®ç°å¤ä¸ªä»£çï¼å·¥ä½å¨å¤ä¸ªçå¬å°åä¸ï¼ã\ninclude          ä»¥ä¾¿å¢å¼ºéç½®æä»¶çå¯è¯»æ§ï¼ä½¿å¾é¨åéç½®æä»¶å¯ä»¥éæ°ä½¿ç¨ã                                     -\nvalid_referers   ç¨æ¥æ ¡éªHttpè¯·æ±å¤´Refereræ¯å¦ææã                                          -\ntry_files        ç¨å¨serveré¨åï¼ä¸è¿æå¸¸è§çè¿æ¯ç¨å¨locationé¨åï¼å®ä¼æç§ç»å®çåæ°é¡ºåºè¿è¡å°è¯ï¼ç¬¬ä¸ä¸ªè¢«å¹éå°çå°ä¼è¢«ä½¿ç¨ã   -\nif               å½å¨locationåä¸­ä½¿ç¨ifæä»¤ï¼å¨æäºæåµä¸å®å¹¶ä¸æç§é¢æè¿è¡ï¼ä¸è¬æ¥è¯´é¿åä½¿ç¨ifæä»¤ã                 -\n\nä¾å¦æä»¬å nginx.conf éé¢å¼ç¨ä¸¤ä¸ªéç½® vhost/example.com.conf å vhost/gitlab.com.conf å®ä»¬é½è¢«æ¾å¨ä¸ä¸ªæèªå·±æ°å»ºçç®å½ vhost ä¸é¢ãnginx.conf éç½®å¦ä¸ï¼\n\nå¤å¶worker_processes  1;\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'\n    #                  \'$status $body_bytes_sent "$http_referer" \'\n    #                  \'"$http_user_agent" "$http_x_forwarded_for"\';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    #gzip  on;\n    server {\n        listen       80;\n        server_name  localhost;\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n    include  vhost/example.com.conf;\n    include  vhost/gitlab.com.conf;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\nç®åçéç½®: example.com.conf\n\nå¤å¶server {\n    #ä¾¦å¬ç80ç«¯å£\n    listen       80;\n    server_name  baidu.com app.baidu.com; # è¿éæå®åå\n    index        index.html index.htm;    # è¿éæå®é»è®¤å¥å£é¡µé¢\n    root /home/www/app.baidu.com;         # è¿éæå®ç®å½\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# åç½®é¢å®ä¹åé\n\nNginxæä¾äºè®¸å¤é¢å®ä¹çåéï¼ä¹å¯ä»¥éè¿ä½¿ç¨setæ¥è®¾ç½®åéãä½ å¯ä»¥å¨ifä¸­ä½¿ç¨é¢å®ä¹åéï¼ä¹å¯ä»¥å°å®ä»¬ä¼ éç»ä»£çæå¡å¨ãä»¥ä¸æ¯ä¸äºå¸¸è§çé¢å®ä¹åéï¼æ´å¤è¯¦è§\n\nåéåç§°              å¼\n$args_name        å¨è¯·æ±ä¸­çnameåæ°\n$args             ææè¯·æ±åæ°\n$query_string     $argsçå«å\n$content_length   è¯·æ±å¤´Content-Lengthçå¼\n$content_type     è¯·æ±å¤´Content-Typeçå¼\n$host             å¦æå½åæHostï¼åä¸ºè¯·æ±å¤´Hostçå¼ï¼å¦ææ²¡æè¿ä¸ªå¤´ï¼é£ä¹è¯¥å¼ç­äºå¹éè¯¥è¯·æ±çserver_nameçå¼\n$remote_addr      å®¢æ·ç«¯çIPå°å\n$request          å®æ´çè¯·æ±ï¼ä»å®¢æ·ç«¯æ¶å°ï¼åæ¬Httpè¯·æ±æ¹æ³ãURIãHttpåè®®ãå¤´ãè¯·æ±ä½\n$request_uri      å®æ´è¯·æ±çURIï¼ä»å®¢æ·ç«¯æ¥çè¯·æ±ï¼åæ¬åæ°\n$scheme           å½åè¯·æ±çåè®®\n$uri              å½åè¯·æ±çæ ååURI\n\n\n# ååä»£ç\n\nååä»£çæ¯ä¸ä¸ªWebæå¡å¨ï¼å®æ¥åå®¢æ·ç«¯çè¿æ¥è¯·æ±ï¼ç¶åå°è¯·æ±è½¬åç»ä¸æ¸¸æå¡å¨ï¼å¹¶å°ä»æå¡å¨å¾å°çç»æè¿åç»è¿æ¥çå®¢æ·ç«¯ãä¸é¢ç®åçååä»£ççä¾å­ï¼\n\nå¤å¶server {  \n  listen       80;                                                        \n  server_name  localhost;                                              \n  client_max_body_size 1024M;  # åè®¸å®¢æ·ç«¯è¯·æ±çæå¤§åæä»¶å­èæ°\n\n  location / {\n    proxy_pass                         http://localhost:8080;\n    proxy_set_header Host              $host:$server_port;\n    proxy_set_header X-Forwarded-For   $remote_addr; # HTTPçè¯·æ±ç«¯çå®çIP\n    proxy_set_header X-Forwarded-Proto $scheme;      # ä¸ºäºæ­£ç¡®å°è¯å«å®éç¨æ·ååºçåè®®æ¯ http è¿æ¯ https\n  }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¤æçéç½®: gitlab.com.confã\n\nå¤å¶server {\n    #ä¾¦å¬ç80ç«¯å£\n    listen       80;\n    server_name  git.example.cn;\n    location / {\n        proxy_pass   http://localhost:3000;\n        #ä»¥ä¸æ¯ä¸äºååä»£ççéç½®å¯å é¤\n        proxy_redirect             off;\n        #åç«¯çWebæå¡å¨å¯ä»¥éè¿X-Forwarded-Forè·åç¨æ·çå®IP\n        proxy_set_header           Host $host;\n        client_max_body_size       10m; #åè®¸å®¢æ·ç«¯è¯·æ±çæå¤§åæä»¶å­èæ°\n        client_body_buffer_size    128k; #ç¼å²åºä»£çç¼å²ç¨æ·ç«¯è¯·æ±çæå¤§å­èæ°\n        proxy_connect_timeout      300; #nginxè·åç«¯æå¡å¨è¿æ¥è¶æ¶æ¶é´(ä»£çè¿æ¥è¶æ¶)\n        proxy_send_timeout         300; #åç«¯æå¡å¨æ°æ®åä¼ æ¶é´(ä»£çåéè¶æ¶)\n        proxy_read_timeout         300; #è¿æ¥æååï¼åç«¯æå¡å¨ååºæ¶é´(ä»£çæ¥æ¶è¶æ¶)\n        proxy_buffer_size          4k; #è®¾ç½®ä»£çæå¡å¨ï¼nginxï¼ä¿å­ç¨æ·å¤´ä¿¡æ¯çç¼å²åºå¤§å°\n        proxy_buffers              4 32k; #proxy_buffersç¼å²åºï¼ç½é¡µå¹³åå¨32kä»¥ä¸çè¯ï¼è¿æ ·è®¾ç½®\n        proxy_busy_buffers_size    64k; #é«è´è·ä¸ç¼å²å¤§å°ï¼proxy_buffers*2ï¼\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nä»£çå°ä¸æ¸¸æå¡å¨çéç½®ä¸­ï¼æéè¦çæ¯proxy_passæä»¤ãä»¥ä¸æ¯ä»£çæ¨¡åä¸­çä¸äºå¸¸ç¨æä»¤ï¼\n\næä»¤                       è¯´æ\nproxy_connect_timeout    Nginxä»æ¥åè¯·æ±è³è¿æ¥å°ä¸æ¸¸æå¡å¨çæé¿ç­å¾æ¶é´\nproxy_send_timeout       åç«¯æå¡å¨æ°æ®åä¼ æ¶é´(ä»£çåéè¶æ¶)\nproxy_read_timeout       è¿æ¥æååï¼åç«¯æå¡å¨ååºæ¶é´(ä»£çæ¥æ¶è¶æ¶)\nproxy_cookie_domain      æ¿ä»£ä»ä¸æ¸¸æå¡å¨æ¥çSet-Cookieå¤´çdomainå±æ§\nproxy_cookie_path        æ¿ä»£ä»ä¸æ¸¸æå¡å¨æ¥çSet-Cookieå¤´çpathå±æ§\nproxy_buffer_size        è®¾ç½®ä»£çæå¡å¨ï¼nginxï¼ä¿å­ç¨æ·å¤´ä¿¡æ¯çç¼å²åºå¤§å°\nproxy_buffers            proxy_buffersç¼å²åºï¼ç½é¡µå¹³åå¨å¤å°kä»¥ä¸\nproxy_set_header         éååéå°ä¸æ¸¸æå¡å¨å¤´çåå®¹ï¼ä¹å¯ä»¥éè¿å°æä¸ªå¤´é¨çå¼è®¾ç½®ä¸ºç©ºå­ç¬¦ä¸²ï¼èä¸åéæä¸ªå¤´é¨çæ¹æ³å®ç°\nproxy_ignore_headers     è¿ä¸ªæä»¤ç¦æ­¢å¤çæ¥èªä»£çæå¡å¨çåºç­ã\nproxy_intercept_errors   ä½¿nginxé»æ­¢HTTPåºç­ä»£ç ä¸º400æèæ´é«çåºç­ã\n\n\n# è´è½½åè¡¡\n\nupstreamæä»¤å¯ç¨ä¸ä¸ªæ°çéç½®åºæ®µï¼å¨è¯¥åºæ®µå®ä¹ä¸ç»ä¸æ¸¸æå¡å¨ãè¿äºæå¡å¨å¯è½è¢«è®¾ç½®ä¸åçæéï¼ä¹å¯è½åºäºå¯¹æå¡å¨è¿è¡ç»´æ¤ï¼æ è®°ä¸ºdownã\n\nå¤å¶upstream gitlab {\n    ip_hash;\n    # upstreamçè´è½½åè¡¡ï¼weightæ¯æéï¼å¯ä»¥æ ¹æ®æºå¨éç½®å®ä¹æéãweigthåæ°è¡¨ç¤ºæå¼ï¼æå¼è¶é«è¢«åéå°çå çè¶å¤§ã\n    server 192.168.122.11:8081 ;\n    server 127.0.0.1:82 weight=3;\n    server 127.0.0.1:83 weight=3 down;\n    server 127.0.0.1:84 weight=3; max_fails=3  fail_timeout=20s;\n    server 127.0.0.1:85 weight=4;;\n    keepalive 32;\n}\nserver {\n    #ä¾¦å¬ç80ç«¯å£\n    listen       80;\n    server_name  git.example.cn;\n    location / {\n        proxy_pass   http://gitlab;    #å¨è¿éè®¾ç½®ä¸ä¸ªä»£çï¼åupstreamçåå­ä¸æ ·\n        #ä»¥ä¸æ¯ä¸äºååä»£ççéç½®å¯å é¤\n        proxy_redirect             off;\n        #åç«¯çWebæå¡å¨å¯ä»¥éè¿X-Forwarded-Forè·åç¨æ·çå®IP\n        proxy_set_header           Host $host;\n        proxy_set_header           X-Real-IP $remote_addr;\n        proxy_set_header           X-Forwarded-For $proxy_add_x_forwarded_for;\n        client_max_body_size       10m;  #åè®¸å®¢æ·ç«¯è¯·æ±çæå¤§åæä»¶å­èæ°\n        client_body_buffer_size    128k; #ç¼å²åºä»£çç¼å²ç¨æ·ç«¯è¯·æ±çæå¤§å­èæ°\n        proxy_connect_timeout      300;  #nginxè·åç«¯æå¡å¨è¿æ¥è¶æ¶æ¶é´(ä»£çè¿æ¥è¶æ¶)\n        proxy_send_timeout         300;  #åç«¯æå¡å¨æ°æ®åä¼ æ¶é´(ä»£çåéè¶æ¶)\n        proxy_read_timeout         300;  #è¿æ¥æååï¼åç«¯æå¡å¨ååºæ¶é´(ä»£çæ¥æ¶è¶æ¶)\n        proxy_buffer_size          4k; #è®¾ç½®ä»£çæå¡å¨ï¼nginxï¼ä¿å­ç¨æ·å¤´ä¿¡æ¯çç¼å²åºå¤§å°\n        proxy_buffers              4 32k;# ç¼å²åºï¼ç½é¡µå¹³åå¨32kä»¥ä¸çè¯ï¼è¿æ ·è®¾ç½®\n        proxy_busy_buffers_size    64k; #é«è´è·ä¸ç¼å²å¤§å°ï¼proxy_buffers*2ï¼\n        proxy_temp_file_write_size 64k; #è®¾å®ç¼å­æä»¶å¤¹å¤§å°ï¼å¤§äºè¿ä¸ªå¼ï¼å°ä»upstreamæå¡å¨ä¼ \n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\næ¯ä¸ªè¯·æ±ææ¶é´é¡ºåºéä¸åéå°ä¸åçåç«¯æå¡å¨ï¼å¦æåç«¯æå¡å¨downæï¼è½èªå¨åé¤ã\n\nè´è½½åè¡¡ï¼\n\nupstreamæ¨¡åè½å¤ä½¿ç¨3ç§è´è½½åè¡¡ç®æ³ï¼è½®è¯¢ãIPåå¸ãæå°è¿æ¥æ°ã\n\nè½®è¯¢ï¼ é»è®¤æåµä¸ä½¿ç¨è½®è¯¢ç®æ³ï¼ä¸éè¦éç½®æä»¤æ¥æ¿æ´»å®ï¼å®æ¯åºäºå¨éåä¸­è°æ¯ä¸ä¸ä¸ªçåçç¡®ä¿è®¿é®ååå°åå¸å°æ¯ä¸ªä¸æ¸¸æå¡å¨ï¼ IPåå¸ï¼ éè¿ip_hashæä»¤æ¥æ¿æ´»ï¼Nginxéè¿IPv4å°åçå3ä¸ªå­èæèæ´ä¸ªIPv6å°åä½ä¸ºåå¸é®æ¥å®ç°ï¼åä¸ä¸ªIPå°åæ»æ¯è½è¢«æ å°å°åä¸ä¸ªä¸æ¸¸æå¡å¨ï¼ æå°è¿æ¥æ°ï¼ éè¿least_connæä»¤æ¥æ¿æ´»ï¼è¯¥ç®æ³éè¿éæ©ä¸ä¸ªæ´»è·æ°æå°çä¸æ¸¸æå¡å¨è¿è¡è¿æ¥ãå¦æä¸æ¸¸æå¡å¨å¤çè½åä¸åï¼å¯ä»¥éè¿ç»serveréç½®weightæéæ¥è¯´æï¼è¯¥ç®æ³å°èèå°ä¸åæå¡å¨çå ææå°è¿æ¥æ°ã\n\n# RR\n\nç®åéç½® ï¼è¿éæéç½®äº2å°æå¡å¨ï¼å½ç¶å®éä¸æ¯ä¸å°ï¼åªæ¯ç«¯å£ä¸ä¸æ ·èå·²ï¼è8081çæå¡å¨æ¯ä¸å­å¨çï¼ä¹å°±æ¯è¯´è®¿é®ä¸å°ï¼ä½æ¯æä»¬è®¿é® http://localhost çæ¶åï¼ä¹ä¸ä¼æé®é¢ï¼ä¼é»è®¤è·³è½¬å°http://localhost:8080å·ä½æ¯å ä¸ºNginxä¼èªå¨å¤æ­æå¡å¨çç¶æï¼å¦ææå¡å¨å¤äºä¸è½è®¿é®ï¼æå¡å¨æäºï¼ï¼å°±ä¸ä¼è·³è½¬å°è¿å°æå¡å¨ï¼æä»¥ä¹é¿åäºä¸å°æå¡å¨æäºå½±åä½¿ç¨çæåµï¼ç±äºNginxé»è®¤æ¯RRç­ç¥ï¼æä»¥æä»¬ä¸éè¦å¶ä»æ´å¤çè®¾ç½®\n\nå¤å¶upstream test {\n    server localhost:8080;\n    server localhost:8081;\n}\nserver {\n    listen       81;\n    server_name  localhost;\n    client_max_body_size 1024M;\n \n    location / {\n        proxy_pass http://test;\n        proxy_set_header Host $host:$server_port;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nè´è½½åè¡¡çæ ¸å¿ä»£ç ä¸º\n\nå¤å¶upstream test {\n    server localhost:8080;\n    server localhost:8081;\n}\n\n\n1\n2\n3\n4\n\n\n# æé\n\næå®è½®è¯¢å çï¼weightåè®¿é®æ¯çææ­£æ¯ï¼ç¨äºåç«¯æå¡å¨æ§è½ä¸åçæåµã ä¾å¦\n\nå¤å¶upstream test {\n    server localhost:8080 weight=9;\n    server localhost:8081 weight=1;\n}\n\n\n1\n2\n3\n4\n\n\né£ä¹10æ¬¡ä¸è¬åªä¼æ1æ¬¡ä¼è®¿é®å°8081ï¼èæ9æ¬¡ä¼è®¿é®å°8080\n\n# ip_hash\n\nä¸é¢ç2ç§æ¹å¼é½æä¸ä¸ªé®é¢ï¼é£å°±æ¯ä¸ä¸ä¸ªè¯·æ±æ¥çæ¶åè¯·æ±å¯è½ååå°å¦å¤ä¸ä¸ªæå¡å¨ï¼å½æä»¬çç¨åºä¸æ¯æ ç¶æçæ¶åï¼éç¨äºsessionä¿å­æ°æ®ï¼ï¼è¿æ¶åå°±æä¸ä¸ªå¾å¤§çå¾é®é¢äºï¼æ¯å¦æç»å½ä¿¡æ¯ä¿å­å°äºsessionä¸­ï¼é£ä¹è·³è½¬å°å¦å¤ä¸å°æå¡å¨çæ¶åå°±éè¦éæ°ç»å½äºï¼æä»¥å¾å¤æ¶åæä»¬éè¦ä¸ä¸ªå®¢æ·åªè®¿é®ä¸ä¸ªæå¡å¨ï¼é£ä¹å°±éè¦ç¨iphashäºï¼iphashçæ¯ä¸ªè¯·æ±æè®¿é®ipçhashç»æåéï¼è¿æ ·æ¯ä¸ªè®¿å®¢åºå®è®¿é®ä¸ä¸ªåç«¯æå¡å¨ï¼å¯ä»¥è§£å³sessionçé®é¢ã\n\nå¤å¶upstream test {\n    ip_hash;\n    server localhost:8080;\n    server localhost:8081;\n}\n\n\n1\n2\n3\n4\n5\n\n\n# fair\n\nè¿æ¯ä¸ªç¬¬ä¸æ¹æ¨¡åï¼æåç«¯æå¡å¨çååºæ¶é´æ¥åéè¯·æ±ï¼ååºæ¶é´ç­çä¼ååéã\n\nå¤å¶upstream backend {\n    fair;\n    server localhost:8080;\n    server localhost:8081;\n}\n\n\n1\n2\n3\n4\n5\n\n\n# url_hash\n\nè¿æ¯ä¸ªç¬¬ä¸æ¹æ¨¡åï¼æè®¿é®urlçhashç»ææ¥åéè¯·æ±ï¼ä½¿æ¯ä¸ªurlå®åå°åä¸ä¸ªåç«¯æå¡å¨ï¼åç«¯æå¡å¨ä¸ºç¼å­æ¶æ¯è¾ææã å¨upstreamä¸­å å¥hashè¯­å¥ï¼serverè¯­å¥ä¸­ä¸è½åå¥weightç­å¶ä»çåæ°ï¼hash_methodæ¯ä½¿ç¨çhashç®æ³\n\nå¤å¶upstream backend {\n    hash $request_uri;\n    hash_method crc32;\n    server localhost:8080;\n    server localhost:8081;\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nä»¥ä¸5ç§è´è½½åè¡¡åèªéç¨ä¸åæåµä¸ä½¿ç¨ï¼æä»¥å¯ä»¥æ ¹æ®å®éæåµéæ©ä½¿ç¨åªç§ç­ç¥æ¨¡å¼ï¼ä¸è¿fairåurl_hashéè¦å®è£ç¬¬ä¸æ¹æ¨¡åæè½ä½¿ç¨\n\nserveræä»¤å¯éåæ°ï¼\n\n 1. weightï¼è®¾ç½®ä¸ä¸ªæå¡å¨çè®¿é®æéï¼æ°å¼è¶é«ï¼æ¶å°çè¯·æ±ä¹è¶å¤ï¼\n 2. fail_timeoutï¼å¨è¿ä¸ªæå®çæ¶é´åæå¡å¨å¿é¡»æä¾ååºï¼å¦æå¨è¿ä¸ªæ¶é´åæ²¡ææ¶å°ååºï¼é£ä¹æå¡å¨å°ä¼è¢«æ è®°ä¸ºdownç¶æï¼\n 3. max_failsï¼è®¾ç½®å¨fail_timeoutæ¶é´ä¹åå°è¯å¯¹ä¸ä¸ªæå¡å¨è¿æ¥çæå¤§æ¬¡æ°ï¼å¦æè¶è¿è¿ä¸ªæ¬¡æ°ï¼é£ä¹æå¡å¨å°ä¼è¢«æ è®°ä¸ºdown;\n 4. downï¼æ è®°ä¸ä¸ªæå¡å¨ä¸åæ¥åä»»ä½è¯·æ±ï¼\n 5. backupï¼ä¸æ¦å¶ä»æå¡å¨å®æºï¼é£ä¹æè¯¥æ è®°çæºå¨å°ä¼æ¥æ¶è¯·æ±ã\n\nkeepaliveæä»¤ï¼\n\nNginxæå¡å¨å°ä¼ä¸ºæ¯ä¸ä¸ªworkerè¿è¡ä¿æåä¸æ¸¸æå¡å¨çè¿æ¥ã\n\n\n# å±è½ip\n\nå¨nginxçéç½®æä»¶nginx.confä¸­å å¥å¦ä¸éç½®ï¼å¯ä»¥æ¾å°http, server, location, limit_exceptè¯­å¥åï¼éè¦æ³¨æç¸å¯¹è·¯å¾ï¼æ¬ä¾å½ä¸­nginx.confï¼blocksip.confå¨åä¸ä¸ªç®å½ä¸­ã\n\nå¤å¶include blockip.conf;\n\n\n1\n\n\nå¨blockip.conféé¢è¾å¥åå®¹ï¼å¦ï¼\n\nå¤å¶deny 165.91.122.67;\n\ndeny IP;   # å±è½åä¸ªipè®¿é®\nallow IP;  # åè®¸åä¸ªipè®¿é®\ndeny all;  # å±è½ææipè®¿é®\nallow all; # åè®¸ææipè®¿é®\ndeny 123.0.0.0/8   # å±è½æ´ä¸ªæ®µå³ä»123.0.0.1å°123.255.255.254è®¿é®çå½ä»¤\ndeny 124.45.0.0/16 # å±è½IPæ®µå³ä»123.45.0.1å°123.45.255.254è®¿é®çå½ä»¤\ndeny 123.45.6.0/24 # å±è½IPæ®µå³ä»123.45.6.1å°123.45.6.254è®¿é®çå½ä»¤\n\n# å¦æä½ æ³å®ç°è¿æ ·çåºç¨ï¼é¤äºå ä¸ªIPå¤ï¼å¶ä»å¨é¨æç»\nallow 1.1.1.1; \nallow 1.1.1.2;\ndeny all;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# ç¬¬ä¸æ¹æ¨¡åå®è£æ¹æ³\n\nå¤å¶./configure --prefix=/ä½ çå®è£ç®å½  --add-module=/ç¬¬ä¸æ¹æ¨¡åç®å½\n\n\n1\n\n\n\n# éå®å\n\n * permanent æ°¸ä¹æ§éå®åãè¯·æ±æ¥å¿ä¸­çç¶æç ä¸º301\n * redirect ä¸´æ¶éå®åãè¯·æ±æ¥å¿ä¸­çç¶æç ä¸º302\n\n\n# éå®åæ´ä¸ªç½ç«\n\nå¤å¶server {\n    server_name old-site.com\n    return 301 $scheme://new-site.com$request_uri;\n}\n\n\n1\n2\n3\n4\n\n\n\n# éå®ååé¡µ\n\nå¤å¶server {\n    location = /oldpage.html {\n        return 301 http://example.org/newpage.html;\n    }\n}\n\n\n1\n2\n3\n4\n5\n\n\n\n# éå®åæ´ä¸ªå­è·¯å¾\n\nå¤å¶location /old-site {\n    rewrite ^/old-site/(.*) http://example.org/new-site/$1 permanent;\n}\n\n\n1\n2\n3\n\n\n\n# æ§è½\n\n\n# åå®¹ç¼å­\n\nåè®¸æµè§å¨åºæ¬ä¸æ°¸ä¹å°ç¼å­éæåå®¹ã Nginxå°ä¸ºæ¨è®¾ç½®ExpiresåCache-Controlå¤´ä¿¡æ¯ã\n\nå¤å¶location /static {\n    root /data;\n    expires max;\n}\n\n\n1\n2\n3\n4\n\n\nå¦æè¦æ±æµè§å¨æ°¸è¿ä¸ä¼ç¼å­ååºï¼ä¾å¦ç¨äºè·è¸ªè¯·æ±ï¼ï¼è¯·ä½¿ç¨-1ã\n\nå¤å¶location = /empty.gif {\n    empty_gif;\n    expires -1;\n}\n\n\n1\n2\n3\n4\n\n\n\n# Gzipåç¼©\n\nå¤å¶gzip  on;\ngzip_buffers 16 8k;\ngzip_comp_level 6;\ngzip_http_version 1.1;\ngzip_min_length 256;\ngzip_proxied any;\ngzip_vary on;\ngzip_types\n    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml\n    text/javascript application/javascript application/x-javascript\n    text/x-json application/json application/x-web-app-manifest+json\n    text/css text/plain text/x-component\n    font/opentype application/x-font-ttf application/vnd.ms-fontobject\n    image/x-icon;\ngzip_disable  "msie6";\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# æå¼æä»¶ç¼å­\n\nå¤å¶open_file_cache max=1000 inactive=20s;\nopen_file_cache_valid 30s;\nopen_file_cache_min_uses 2;\nopen_file_cache_errors on;\n\n\n1\n2\n3\n4\n\n\n\n# SSLç¼å­\n\nå¤å¶ssl_session_cache shared:SSL:10m;\nssl_session_timeout 10m;\n\n\n1\n2\n\n\n\n# ä¸æ¸¸Keepalive\n\nå¤å¶upstream backend {\n    server 127.0.0.1:8080;\n    keepalive 32;\n}\nserver {\n    ...\n    location /api/ {\n        proxy_pass http://backend;\n        proxy_http_version 1.1;\n        proxy_set_header Connection "";\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# çæ§\n\nä½¿ç¨ngxtopå®æ¶è§£ænginxè®¿é®æ¥å¿ï¼å¹¶ä¸å°å¤çç»æè¾åºå°ç»ç«¯ï¼åè½ç±»ä¼¼äºç³»ç»å½ä»¤topãææç¤ºä¾é½è¯»ånginxéç½®æä»¶çè®¿é®æ¥å¿ä½ç½®åæ ¼å¼ãå¦æè¦æå®è®¿é®æ¥å¿æä»¶å/ææ¥å¿æ ¼å¼ï¼è¯·ä½¿ç¨-få-aéé¡¹ã\n\næ³¨æï¼å¨nginxéç½®ä¸­/usr/local/nginx/conf/nginx.confæ¥å¿æä»¶å¿é¡»æ¯ç»å¯¹è·¯å¾ã\n\nå¤å¶# å®è£ ngxtop\npip install ngxtop\n\n# å®æ¶ç¶æ\nngxtop\n# ç¶æä¸º404çå10ä¸ªè¯·æ±çè·¯å¾ï¼\nngxtop top request_path --filter \'status == 404\'\n\n# åéæ»å­èæ°æå¤çå10ä¸ªè¯·æ±\nngxtop --order-by \'avg(bytes_sent) * count\'\n\n# æåååä½çIPï¼ä¾å¦ï¼è°æ»å»ä½ æå¤\nngxtop --group-by remote_addr\n\n# æå°å·æ4xxæ5xxç¶æçè¯·æ±ï¼ä»¥åstatusåhttp referer\nngxtop -i \'status >= 400\' print request status http_referer\n\n# ç±200ä¸ªè¯·æ±è·¯å¾ååºåéçå¹³åæ­£æå­èä»¥\'foo\'å¼å§ï¼\nngxtop avg bytes_sent --filter \'status == 200 and request_path.startswith("foo")\'\n\n# ä½¿ç¨âcommonâæ¥å¿æ ¼å¼ä»è¿ç¨æºå¨åæapacheè®¿é®æ¥å¿\nssh remote tail -f /var/log/apache2/access.log | ngxtop -f common\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# å¸¸è§ä½¿ç¨åºæ¯\n\n\n# è·¨åé®é¢\n\nå¨å·¥ä½ä¸­ï¼ææ¶åä¼éå°ä¸äºæ¥å£ä¸æ¯æè·¨åï¼è¿æ¶åå¯ä»¥ç®åçæ·»å add_headersæ¥æ¯æcorsè·¨åãéç½®å¦ä¸ï¼\n\nå¤å¶server {\n  listen 80;\n  server_name api.xxx.com;\n    \n  add_header \'Access-Control-Allow-Origin\' \'*\';\n  add_header \'Access-Control-Allow-Credentials\' \'true\';\n  add_header \'Access-Control-Allow-Methods\' \'GET,POST,HEAD\';\n\n  location / {\n    proxy_pass http://127.0.0.1:3000;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header Host  $http_host;    \n  } \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nä¸é¢æ´æ¹å¤´ä¿¡æ¯ï¼è¿æä¸ç§ï¼ä½¿ç¨ rewrite æä»¤éå®åURIæ¥è§£å³è·¨åé®é¢ã\n\nå¤å¶upstream test {\n  server 127.0.0.1:8080;\n  server localhost:8081;\n}\nserver {\n  listen 80;\n  server_name api.xxx.com;\n  location / { \n    root  html;                   #å»è¯·æ±../htmlæä»¶å¤¹éçæä»¶\n    index  index.html index.htm;  #é¦é¡µååºå°å\n  }\n  # ç¨äºæ¦æªè¯·æ±ï¼å¹éä»»ä½ä»¥ /api/å¼å¤´çå°åï¼\n  # å¹éç¬¦åä»¥åï¼åæ­¢å¾ä¸æç´¢æ­£åã\n  location ^~/api/{ \n    # ä»£è¡¨éåæ¦æªè¿æ¥çè¯·æ±ï¼å¹¶ä¸åªè½å¯¹åååè¾¹çé¤å»ä¼ éçåæ°å¤çå­ç¬¦ä¸²èµ·ä½ç¨ï¼\n    # ä¾å¦www.a.com/proxy/api/msg?meth=1&par=2éåï¼åªå¯¹/proxy/api/msgéåã\n    # rewriteåé¢çåæ°æ¯ä¸ä¸ªç®åçæ­£å ^/api/(.*)$ï¼\n    # $1ä»£è¡¨æ­£åä¸­çç¬¬ä¸ä¸ª()ï¼$2ä»£è¡¨ç¬¬äºä¸ª()çå¼ï¼ä»¥æ­¤ç±»æ¨ã\n    rewrite ^/api/(.*)$ /$1 break;\n    \n    # æè¯·æ±ä»£çå°å¶ä»ä¸»æº \n    # å¶ä¸­ http://www.b.com/ åæ³å http://www.b.comåæ³çåºå«å¦ä¸\n    # å¦æä½ çè¯·æ±å°åæ¯ä» http://server/html/test.jsp\n    # éç½®ä¸ï¼ http://www.b.com/ åé¢æâ/â \n    #         å°ååä»£çæ http://www.b.com/html/test.jsp è®¿é®\n    # éç½®ä¸ï¼ http://www.b.com åé¢æ²¡ææâ/â \n    #         å°ååä»£çæ http://www.b.com/test.jsp è®¿é®\n    proxy_pass http://test;\n\n    # å¦æ proxy_pass  URL æ¯ http://a.xx.com/platform/ è¿ç§æåµ\n    # proxy_cookie_pathåºè¯¥è®¾ç½®æ /platform/ / (æ³¨æä¸¤ä¸ªææ ä¹é´æç©ºæ ¼)ã\n    proxy_cookie_path /platfrom/ /;\n\n    # http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass_header\n    # è®¾ç½® Cookie å¤´éè¿\n    proxy_pass_header Set-Cookie;\n  } \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n\n\n\n# è·³è½¬å°å¸¦wwwçåä¸é¢\n\nå¤å¶server {\n    listen 80;\n    # éç½®æ­£å¸¸çå¸¦wwwçåå\n    server_name www.wangchujiang.com;\n    root /home/www/wabg/download;\n    location / {\n        try_files $uri $uri/ /index.html =404;\n    }\n}\nserver {\n    # è¿ä¸ªè¦æ¾å°ä¸é¢ï¼\n    # å°ä¸å¸¦wwwç wangchujiang.com æ°¸ä¹æ§éå®åå°  https://www.wangchujiang.com\n    server_name wangchujiang.com;\n    rewrite ^(.*) https://www.wangchujiang.com$1 permanent;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# ä»£çè½¬å\n\nå¤å¶upstream server-api{\n    # api ä»£çæå¡å°å\n    server 127.0.0.1:3110;    \n}\nupstream server-resource{\n    # éæèµæº ä»£çæå¡å°å\n    server 127.0.0.1:3120;\n}\nserver {\n    listen       3111;\n    server_name  localhost;      # è¿éæå®åå\n    root /home/www/server-statics;\n    # å¹é api è·¯ç±çååä»£çå°APIæå¡\n    location ^~/api/ {\n        rewrite ^/(.*)$ /$1 break;\n        proxy_pass http://server-api;\n    }\n    # åè®¾è¿ééªè¯ç ä¹å¨APIæå¡ä¸­\n    location ^~/captcha {\n        rewrite ^/(.*)$ /$1 break;\n        proxy_pass http://server-api;\n    }\n    # åè®¾ä½ çå¾çèµæºå¨é¨å¨å¦å¤ä¸ä¸ªæå¡ä¸é¢\n    location ^~/img/ {\n        rewrite ^/(.*)$ /$1 break;\n        proxy_pass http://server-resource;\n    }\n    # è·¯ç±å¨åç«¯ï¼åç«¯æ²¡æçå®è·¯ç±ï¼å¨è·¯ç±ä¸å­å¨ç 404ç¶æçé¡µé¢è¿å /index.html\n    # è¿ä¸ªæ¹å¼ä½¿ç¨åºæ¯ï¼ä½ å¨åReactæèVueé¡¹ç®çæ¶åï¼æ²¡æçå®è·¯ç±\n    location / {\n        try_files $uri $uri/ /index.html =404;\n        #                               ^ ç©ºæ ¼å¾éè¦\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# çæ§ç¶æä¿¡æ¯\n\néè¿ nginx -V æ¥æ¥çæ¯å¦æ with-http_stub_status_module è¯¥æ¨¡åã\n\n> nginx -V è¿é V æ¯å¤§åçï¼å¦ææ¯å°åç v å³ nginx -vï¼åä¸ä¼åºç°æåªäºæ¨¡åï¼åªä¼åºç° nginx ççæ¬\n\nå¤å¶location /nginx_status {\n    stub_status on;\n    access_log off;\n}\n\n\n1\n2\n3\n4\n\n\néè¿ http://127.0.0.1/nginx_status è®¿é®åºç°ä¸é¢ç»æã\n\nå¤å¶Active connections: 3\nserver accepts handled requests\n 7 7 5 \nReading: 0 Writing: 1 Waiting: 2\n\n\n1\n2\n3\n4\n\n 1. ä¸»å¨è¿æ¥(ç¬¬ 1 è¡)\n\nå½åä¸httpå»ºç«çè¿æ¥æ°ï¼åæ¬ç­å¾çå®¢æ·ç«¯è¿æ¥ï¼3\n\n 1. æå¡å¨æ¥åå¤ççè¯·æ±(ç¬¬ 2~3 è¡)\n\næ¥åçå®¢æ·ç«¯è¿æ¥æ»æ°ç®ï¼7 å¤ççå®¢æ·ç«¯è¿æ¥æ»æ°ç®ï¼7 å®¢æ·ç«¯æ»çè¯·æ±æ°ç®ï¼5\n\n 1. è¯»åå¶å®ä¿¡(ç¬¬ 4 è¡)\n\nå½åï¼nginxè¯»è¯·æ±è¿æ¥ å½åï¼nginxåååºè¿åç»å®¢æ·ç«¯ ç®åæå¤å°ç©ºé²å®¢æ·ç«¯è¯·æ±è¿æ¥\n\n\n# ä»£çè½¬åè¿æ¥æ¿æ¢\n\nå¤å¶location ^~/api/upload {\n    rewrite ^/(.*)$ /wfs/v1/upload break;\n    proxy_pass http://wfs-api;\n}\n\n\n1\n2\n3\n4\n\n\n\n# ssléç½®\n\nè¶ææ¬ä¼ è¾å®å¨åè®®ï¼ç¼©åï¼HTTPSï¼è±è¯­ï¼Hypertext Transfer Protocol Secureï¼æ¯è¶ææ¬ä¼ è¾åè®®åSSL/TLSçç»åï¼ç¨ä»¥æä¾å å¯éè®¯åå¯¹ç½ç»æå¡å¨èº«ä»½çé´å®ãHTTPSè¿æ¥ç»å¸¸è¢«ç¨äºä¸ç»´ç½ä¸çäº¤ææ¯ä»åä¼ä¸ä¿¡æ¯ç³»ç»ä¸­ææä¿¡æ¯çä¼ è¾ãHTTPSä¸åºä¸å¨RFC 2660ä¸­å®ä¹çå®å¨è¶ææ¬ä¼ è¾åè®®ï¼S-HTTPï¼ç¸æ··ãHTTPS ç®åå·²ç»æ¯æææ³¨ééç§åå®å¨çç½ç«çé¦éï¼éçææ¯çä¸æ­åå±ï¼HTTPS ç½ç«å·²ä¸åæ¯å¤§åç½ç«çä¸å©ï¼æææ®éçä¸ªäººç«é¿ååå®¢åå¯ä»¥èªå·±å¨ææ­å»ºä¸ä¸ªå®å¨çå å¯çç½ç«ã\n\nåå»ºSSLè¯ä¹¦ï¼å¦æä½ è´­ä¹°çè¯ä¹¦ï¼å°±å¯ä»¥ç´æ¥ä¸è½½\n\nå¤å¶sudo mkdir /etc/nginx/ssl\n# åå»ºäºæææ100å¹´ï¼å å¯å¼ºåº¦ä¸ºRSA2048çSSLå¯é¥keyåX509è¯ä¹¦æä»¶ã\nsudo openssl req -x509 -nodes -days 36500 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt\n# ä¸é¢å½ä»¤ï¼ä¼æä¸é¢éè¦å¡«ååå®¹\nCountry Name (2 letter code) [AU]:US\nState or Province Name (full name) [Some-State]:New York\nLocality Name (eg, city) []:New York City\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:Bouncy Castles, Inc.\nOrganizational Unit Name (eg, section) []:Ministry of Water Slides\nCommon Name (e.g. server FQDN or YOUR name) []:your_domain.com\nEmail Address []:admin@your_domain.com\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nåå»ºèªç­¾è¯ä¹¦\n\nå¤å¶é¦åï¼åå»ºè¯ä¹¦åç§é¥çç®å½\n# mkdir -p /etc/nginx/cert\n# cd /etc/nginx/cert\nåå»ºæå¡å¨ç§é¥ï¼å½ä»¤ä¼è®©ä½ è¾å¥ä¸ä¸ªå£ä»¤ï¼\n# openssl genrsa -des3 -out nginx.key 2048\nåå»ºç­¾åè¯·æ±çè¯ä¹¦ï¼CSRï¼ï¼\n# openssl req -new -key nginx.key -out nginx.csr\nå¨å è½½SSLæ¯æçNginxå¹¶ä½¿ç¨ä¸è¿°ç§é¥æ¶é¤å»å¿é¡»çå£ä»¤ï¼\n# cp nginx.key nginx.key.org\n# openssl rsa -in nginx.key.org -out nginx.key\næåæ è®°è¯ä¹¦ä½¿ç¨ä¸è¿°ç§é¥åCSRï¼\n# openssl x509 -req -days 365 -in nginx.csr -signkey nginx.key -out nginx.crt\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥çç®ånginxç¼è¯éé¡¹\n\nå¤å¶sbin/nginx -V\n\n\n1\n\n\nè¾åºä¸é¢åå®¹\n\nå¤å¶nginx version: nginx/1.7.8\nbuilt by gcc 4.4.7 20120313 (Red Hat 4.4.7-4) (GCC)\nTLS SNI support enabled\nconfigure arguments: --prefix=/usr/local/nginx-1.7.8 --with-http_ssl_module --with-http_spdy_module --with-http_stub_status_module --with-pcre\n\n\n1\n2\n3\n4\n\n\nå¦æä¾èµçæ¨¡åä¸å­å¨ï¼å¯ä»¥è¿å¥å®è£ç®å½ï¼è¾å¥ä¸é¢å½ä»¤éæ°ç¼è¯å®è£ã\n\nå¤å¶./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module\n\n\n1\n\n\nè¿è¡å®æä¹åè¿éè¦make (ä¸ç¨make install)\n\nå¤å¶# å¤ä»½nginxçäºè¿å¶æä»¶\ncp -rf /usr/local/nginx/sbin/nginxã /usr/local/nginx/sbin/nginx.bak\n# è¦çnginxçäºè¿å¶æä»¶\ncp -rf objs/nginx   /usr/local/nginx/sbin/\n\n\n1\n2\n3\n4\n\n\nHTTPS server\n\nå¤å¶server {\n    listen       443 ssl;\n    server_name  localhost;\n\n    ssl_certificate /etc/nginx/ssl/nginx.crt;\n    ssl_certificate_key /etc/nginx/ssl/nginx.key;\n    # ç¦æ­¢å¨headerä¸­åºç°æå¡å¨çæ¬ï¼é²æ­¢é»å®¢å©ç¨çæ¬æ¼æ´æ»å»\n    server_tokens off;\n    # è®¾ç½®ssl/tlsä¼è¯ç¼å­çç±»ååå¤§å°ãå¦æè®¾ç½®äºè¿ä¸ªåæ°ä¸è¬æ¯sharedï¼buildinå¯è½ä¼åæ°åå­ç¢çï¼é»è®¤æ¯noneï¼åoffå·®ä¸å¤ï¼åç¨ç¼å­ãå¦shared:SSL:10mè¡¨ç¤ºæææçnginxå·¥ä½è¿ç¨å±äº«sslä¼è¯ç¼å­ï¼å®ç½ä»ç»è¯´1Må¯ä»¥å­æ¾çº¦4000ä¸ªsessionsã \n    ssl_session_cache    shared:SSL:1m; \n\n    # å®¢æ·ç«¯å¯ä»¥éç¨ä¼è¯ç¼å­ä¸­sslåæ°çè¿ææ¶é´ï¼åç½ç³»ç»é»è®¤5åéå¤ªç­äºï¼å¯ä»¥è®¾æ30må³30åéçè³4hã\n    ssl_session_timeout  5m; \n\n    # éæ©å å¯å¥ä»¶ï¼ä¸åçæµè§å¨ææ¯æçå¥ä»¶ï¼åé¡ºåºï¼å¯è½ä¼ä¸åã\n    # è¿éæå®çæ¯OpenSSLåºè½å¤è¯å«çåæ³ï¼ä½ å¯ä»¥éè¿ openssl -v cipher \'RC4:HIGH:!aNULL:!MD5\'ï¼åé¢æ¯ä½ ææå®çå¥ä»¶å å¯ç®æ³ï¼ æ¥çææ¯æç®æ³ã\n    ssl_ciphers  HIGH:!aNULL:!MD5;\n\n    # è®¾ç½®ååå å¯ç®æ³æ¶ï¼ä¼åä½¿ç¨æä»¬æå¡ç«¯çå å¯å¥ä»¶ï¼èä¸æ¯å®¢æ·ç«¯æµè§å¨çå å¯å¥ä»¶ã\n    ssl_prefer_server_ciphers  on;\n\n    location / {\n        root   html;\n        index  index.html index.htm;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\n\n# å¼ºå¶å°httpéå®åå°https\n\nå¤å¶server {\n    listen       80;\n    server_name  example.com;\n    rewrite ^ https://$http_host$request_uri? permanent;    # å¼ºå¶å°httpéå®åå°https\n    # å¨éè¯¯é¡µé¢åâæå¡å¨âååºå¤´å­æ®µä¸­å¯ç¨æç¦ç¨åå°nginxçæ¬ã é²æ­¢é»å®¢å©ç¨çæ¬æ¼æ´æ»å»\n    server_tokens off;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# ä¸¤ä¸ªèæä¸»æº\n\nçº¯éæ-html æ¯æ\n\nå¤å¶http {\n    server {\n        listen          80;\n        server_name     www.domain1.com;\n        access_log      logs/domain1.access.log main;\n        location / {\n            index index.html;\n            root  /var/www/domain1.com/htdocs;\n        }\n    }\n    server {\n        listen          80;\n        server_name     www.domain2.com;\n        access_log      logs/domain2.access.log main;\n        location / {\n            index index.html;\n            root  /var/www/domain2.com/htdocs;\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# èæä¸»æºæ åéç½®\n\nå¤å¶http {\n  server {\n    listen          80 default;\n    server_name     _ *;\n    access_log      logs/default.access.log main;\n    location / {\n       index index.html;\n       root  /var/www/default/htdocs;\n    }\n  }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# ç¬è«è¿æ»¤\n\næ ¹æ® User-Agent è¿æ»¤è¯·æ±ï¼éè¿ä¸ä¸ªç®åçæ­£åè¡¨è¾¾å¼ï¼å°±å¯ä»¥è¿æ»¤ä¸ç¬¦åè¦æ±çç¬è«è¯·æ±(åçº§ç¬è«)ã\n\n> ~* è¡¨ç¤ºä¸åºåå¤§å°åçæ­£åå¹é\n\nå¤å¶location / {\n    if ($http_user_agent ~* "python|curl|java|wget|httpclient|okhttp") {\n        return 503;\n    }\n    # æ­£å¸¸å¤ç\n    # ...\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# é²çé¾\n\nå¤å¶location ~* \\.(gif|jpg|png|swf|flv)$ {\n   root html\n   valid_referers none blocked *.nginxcn.com;\n   if ($invalid_referer) {\n     rewrite ^/ www.nginx.cn\n     #return 404;\n   }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# èæç®å½éç½®\n\naliasæå®çç®å½æ¯åç¡®çï¼rootæ¯æå®ç®å½çä¸çº§ç®å½ï¼å¹¶ä¸è¯¥ä¸çº§ç®å½è¦å«ælocationæå®åç§°çååç®å½ã\n\nå¤å¶location /img/ {\n    alias /var/www/image/;\n}\n# è®¿é®/img/ç®å½éé¢çæä»¶æ¶ï¼ningxä¼èªå¨å»/var/www/image/ç®å½æ¾æä»¶\nlocation /img/ {\n    root /var/www/image;\n}\n# è®¿é®/img/ç®å½ä¸çæä»¶æ¶ï¼nginxä¼å»/var/www/image/img/ç®å½ä¸æ¾æä»¶ã]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# é²çå¾éç½®\n\nå¤å¶location ~ \\/public\\/(css|js|img)\\/.*\\.(js|css|gif|jpg|jpeg|png|bmp|swf) {\n    valid_referers none blocked *.jslite.io;\n    if ($invalid_referer) {\n        rewrite ^/  http://wangchujiang.com/piratesp.png;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# å±è½.gitç­æä»¶\n\nå¤å¶location ~ (.git|.gitattributes|.gitignore|.svn) {\n    deny all;\n}\n\n\n1\n2\n3\n\n\n\n# ååè·¯å¾å ä¸å éè¦é½è½æ­£å¸¸è®¿é®\n\nå¤å¶http://wangchujiang.com/api/index.php?a=1&name=wcj\n                                  ^ æåç¼\n\nhttp://wangchujiang.com/api/index?a=1&name=wcj\n                                 ^ æ²¡æåç¼\n\n\n1\n2\n3\n4\n5\n\n\nnginx rewriteè§åå¦ä¸ï¼\n\nå¤å¶rewrite ^/(.*)/$ /index.php?/$1 permanent;\nif (!-d $request_filename){\n        set $rule_1 1$rule_1;\n}\nif (!-f $request_filename){\n        set $rule_1 2$rule_1;\n}\nif ($rule_1 = "21"){\n        rewrite ^/ /index.php last;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# éè¯¯é®é¢\n\nå¤å¶The plain HTTP request was sent to HTTPS port\n\n\n1\n\n\nè§£å³åæ³ï¼fastcgi_param HTTPS $https if_not_empty æ·»å è¿æ¡è§åï¼\n\nå¤å¶server {\n    listen 443 ssl; # æ³¨æè¿æ¡è§å\n    server_name  my.domain.com;\n    \n    fastcgi_param HTTPS $https if_not_empty;\n    fastcgi_param HTTPS on;\n\n    ssl_certificate /etc/ssl/certs/your.pem;\n    ssl_certificate_key /etc/ssl/private/your.key;\n\n    location / {\n        # Your config here...\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# Nginx æ¨¡å\n\n * Nginx Office Hours ä¸ä¸ª nginx æ¨¡åï¼åè®¸æ¨ä»å¨åå¬æ¶é´åæä¾è®¿é®è®¿é®ç½ç«ã\n\n\n# ç²¾åæç« åè\n\n * è´è½½åè¡¡åççè§£æ\n\n * Nginxæ³ååè§£æï¼å®ç°å¤ä¸ªäºçº§åå\n\n * æ·±å¥ NGINX: æä»¬å¦ä½è®¾è®¡æ§è½åæ©å±\n\n * Inside NGINX: How We Designed for Performance & Scale\n\n * Nginxå¼åä»å¥é¨å°ç²¾é\n\n * Nginxçä¼åä¸é²çé¾\n\n * å®æå¼åä¸ä¸ªNginxæ©å± (Nginx Module)\n\n * Nginx+Keepalived(åæºç­å¤)æ­å»ºé«å¯ç¨è´è½½åè¡¡ç¯å¢(HA)\n\n * Nginx å¹³æ»åçº§\n\n * Nginxææ°æ¨¡åângx_http_mirror_moduleåæå¯ä»¥åçæ¬åå¸åçé¢åéªè¯ï¼è¿è¡æµéæ¾å¤§åçåæµç­ç­\n   \n   åæé¾æ¥https://www.viayc.com/2019/03/13/Nginx%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B/',normalizedContent:'# nginxéç½®æç¨\n\n\n\nnginx æ¯ä¸æ¬¾é¢åæ§è½è®¾è®¡ç http æå¡å¨ï¼è½ååä»£ç httpï¼https åé®ä»¶ç¸å³(smtpï¼pop3ï¼imap)çåè®®é¾æ¥ãå¹¶ä¸æä¾äºè´è½½åè¡¡ä»¥å http ç¼å­ãå®çè®¾è®¡ååä½¿ç¨å¼æ­¥äºä»¶æ¨¡åï¼ååä¸ä¸æè°åº¦çå¼éï¼æé«æå¡å¨å¹¶åè½åãéç¨äºæ¨¡ååè®¾è®¡ï¼æä¾äºä¸°å¯æ¨¡åçç¬¬ä¸æ¹æ¨¡åã\n\næä»¥å³äº nginxï¼æè¿äºæ ç­¾ï¼ãå¼æ­¥ããäºä»¶ããæ¨¡ååããé«æ§è½ããé«å¹¶åããååä»£çããè´è½½åè¡¡ã\n\nlinuxç³»ç»ï¼centos 7 x64 nginxçæ¬ï¼1.11.5\n\n\n# å®è£\n\n\n# å®è£ä¾èµ\n\n> prce(éå®åæ¯æ)åopenssl(httpsæ¯æï¼å¦æä¸éè¦httpså¯ä»¥ä¸å®è£ã)\n\nå¤å¶yum install -y pcre-devel \nyum -y install gcc make gcc-c++ wget\nyum -y install openssl openssl-devel\n\n\n1\n2\n3\n\n\ncentos 6.5 æå®è£çæ¶åæ¯éæ©çâåºæ¬æå¡å¨âï¼é»è®¤è¿ä¸¤ä¸ªåé½æ²¡å®è£å¨ï¼æä»¥è¿ä¸¤ä¸ªé½è¿è¡å®è£å³å¯ã\n\n\n# ä¸è½½\n\nnginxçææçæ¬å¨è¿é\n\nå¤å¶wget http://nginx.org/download/nginx-1.13.3.tar.gz\nwget http://nginx.org/download/nginx-1.13.7.tar.gz\n\n# å¦ææ²¡æå®è£wget\n# ä¸è½½å·²ç¼è¯çæ¬\n$ yum install wget\n\n# è§£ååç¼©å\ntar zxf nginx-1.13.3.tar.gz\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# ç¼è¯å®è£\n\nç¶åè¿å¥ç®å½ç¼è¯å®è£ï¼configureåæ°è¯´æ\n\nå¤å¶cd nginx-1.11.5\n./configure\n\n....\nconfiguration summary\n  + using system pcre library\n  + openssl library is not used\n  + using system zlib library\n\n  nginx path prefix: "/usr/local/nginx"\n  nginx binary file: "/usr/local/nginx/sbin/nginx"\n  nginx modules path: "/usr/local/nginx/modules"\n  nginx configuration prefix: "/usr/local/nginx/conf"\n  nginx configuration file: "/usr/local/nginx/conf/nginx.conf"\n  nginx pid file: "/usr/local/nginx/logs/nginx.pid"\n  nginx error log file: "/usr/local/nginx/logs/error.log"\n  nginx http access log file: "/usr/local/nginx/logs/access.log"\n  nginx http client request body temporary files: "client_body_temp"\n  nginx http proxy temporary files: "proxy_temp"\n  nginx http fastcgi temporary files: "fastcgi_temp"\n  nginx http uwsgi temporary files: "uwsgi_temp"\n  nginx http scgi temporary files: "scgi_temp"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nå®è£æ¥éè¯¯çè¯æ¯å¦ï¼âc compiler cc is not foundâï¼è¿ä¸ªå°±æ¯ç¼ºå°ç¼è¯ç¯å¢ï¼å®è£ä¸ä¸å°±å¯ä»¥äº yum -y install gcc make gcc-c++ openssl-devel\n\nå¦ææ²¡æerrorä¿¡æ¯ï¼å°±å¯ä»¥æ§è¡ä¸è¾¹çå®è£äºï¼\n\nå¤å¶make\nmake install\n\n\n1\n2\n\n\n\n# nginxæµè¯\n\nè¿è¡ä¸é¢å½ä»¤ä¼åºç°ä¸¤ä¸ªç»æï¼ä¸è¬æåµnginxä¼å®è£å¨/usr/local/nginxç®å½ä¸­\n\nå¤å¶cd /usr/local/nginx/sbin/\n./nginx -t\n\n# nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok\n# nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful\n\n\n1\n2\n3\n4\n5\n\n\n\n# è®¾ç½®å¨å±nginxå½ä»¤\n\nå¤å¶vi ~/.bash_profile\n\n\n1\n\n\nå°ä¸é¢åå®¹æ·»å å° ~/.bash_profile æä»¶ä¸­\n\nå¤å¶path=$path:$home/bin:/usr/local/nginx/sbin/\nexport path\n\n\n1\n2\n\n\nè¿è¡å½ä»¤ source ~/.bash_profile è®©éç½®ç«å³çæãä½ å°±å¯ä»¥å¨å±è¿è¡ nginx å½ä»¤äºã\n\n\n# mac å®è£\n\nmac osx å®è£ç¹å«ç®åï¼é¦åä½ éè¦å®è£ brewï¼ éè¿ brew å¿«éå®è£ nginxã\n\n\n# å®è£nginx\n\nå¤å¶brew install nginx\n# updating homebrew...\n# ==> auto-updated homebrew!\n# updated 2 taps (homebrew/core, homebrew/cask).\n# ==> updated formulae\n# ==> installing dependencies for nginx: openssl, pcre\n# ==> installing nginx dependency: openssl\n# ==> downloading https://homebrew.bintray.com/bottles/openssl-1.0.2o_1.high_sierra.bottle.tar.gz\n# ######################################################################## 100.0%\n# ==> pouring openssl-1.0.2o_1.high_sierra.bottle.tar.gz\n# ==> caveats\n# a ca file has been bootstrapped using certificates from the systemroots\n# keychain. to add additional certificates (e.g. the certificates added in\n# the system keychain), place .pem files in\n#   /usr/local/etc/openssl/certs\n# \n# and run\n#   /usr/local/opt/openssl/bin/c_rehash\n# \n# this formula is keg-only, which means it was not symlinked into /usr/local,\n# because apple has deprecated use of openssl in favor of its own tls and crypto libraries.\n# \n# if you need to have this software first in your path run:\n#   echo \'export path="/usr/local/opt/openssl/bin:$path"\' >> ~/.zshrc\n# \n# for compilers to find this software you may need to set:\n#     ldflags:  -l/usr/local/opt/openssl/lib\n#     cppflags: -i/usr/local/opt/openssl/include\n# for pkg-config to find this software you may need to set:\n#     pkg_config_path: /usr/local/opt/openssl/lib/pkgconfig\n# \n# ==> summary\n# ðº  /usr/local/cellar/openssl/1.0.2o_1: 1,791 files, 12.3mb\n# ==> installing nginx dependency: pcre\n# ==> downloading https://homebrew.bintray.com/bottles/pcre-8.42.high_sierra.bottle.tar.gz\n# ######################################################################## 100.0%\n# ==> pouring pcre-8.42.high_sierra.bottle.tar.gz\n# ðº  /usr/local/cellar/pcre/8.42: 204 files, 5.3mb\n# ==> installing nginx\n# ==> downloading https://homebrew.bintray.com/bottles/nginx-1.13.12.high_sierra.bottle.tar.gz\n# ######################################################################## 100.0%\n# ==> pouring nginx-1.13.12.high_sierra.bottle.tar.gz\n# ==> caveats\n# docroot is: /usr/local/var/www\n# \n# the default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that\n# nginx can run without sudo.\n# \n# nginx will load all files in /usr/local/etc/nginx/servers/.\n# \n# to have launchd start nginx now and restart at login:\n#   brew services start nginx\n# or, if you don\'t wacd /usr/local/cellar/nginx/1.13.12/n just run:\n# cd /usr/local/cellar/nginx/1.13.12/\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n\n\n\n# å¯å¨æå¡\n\næ³¨æé»è®¤ç«¯å£ä¸æ¯ 8080 æ¥çç¡®è®¤ç«¯å£æ¯å¦è¢«å ç¨ã\n\nå¤å¶brew services start nginx\n# http://localhost:8080/\n\n\n1\n2\n\n\n\n# å¼æºèªå¯å¨\n\nå¼æºèªå¯å¨æ¹æ³ä¸ï¼\n\nç¼è¾ vi /lib/systemd/system/nginx.service æä»¶ï¼æ²¡æåå»ºä¸ä¸ª touch nginx.service ç¶åå°å¦ä¸åå®¹æ ¹æ®å·ä½æåµè¿è¡ä¿®æ¹åï¼æ·»å å°nginx.serviceæä»¶ä¸­ï¼\n\nå¤å¶[unit]\ndescription=nginx\nafter=network.target remote-fs.target nss-lookup.target\n\n[service]\n\ntype=forking\npidfile=/var/run/nginx.pid\nexecstartpre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf\nexecstart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf\nexecreload=/bin/kill -s hup $mainpid\nexecstop=/bin/kill -s quit $mainpid\nprivatetmp=true\n\n[install]\nwantedby=multi-user.target\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n * [unit]:æå¡çè¯´æ\n * description:æè¿°æå¡\n * after:æè¿°æå¡ç±»å«\n * [service]æå¡è¿è¡åæ°çè®¾ç½®\n * type=forkingæ¯åå°è¿è¡çå½¢å¼\n * execstartä¸ºæå¡çå·ä½è¿è¡å½ä»¤\n * execreloadä¸ºéå¯å½ä»¤\n * execstopä¸ºåæ­¢å½ä»¤\n * privatetmp=trueè¡¨ç¤ºç»æå¡åéç¬ç«çä¸´æ¶ç©ºé´\n\næ³¨æï¼[service]çå¯å¨ãéå¯ãåæ­¢å½ä»¤å¨é¨è¦æ±ä½¿ç¨ç»å¯¹è·¯å¾ã\n\n[install]è¿è¡çº§å«ä¸æå¡å®è£çç¸å³è®¾ç½®ï¼å¯è®¾ç½®ä¸ºå¤ç¨æ·ï¼å³ç³»ç»è¿è¡çº§å«ä¸º3ã\n\nä¿å­éåºã\n\nè®¾ç½®å¼æºå¯å¨ï¼ä½¿éç½®çæï¼\n\nå¤å¶# å¯å¨nginxæå¡\nsystemctl start nginx.service\n# åæ­¢å¼æºèªå¯å¨\nsystemctl disable nginx.service\n# æ¥çæå¡å½åç¶æ\nsystemctl status nginx.service\n# æ¥çææå·²å¯å¨çæå¡\nsystemctl list-units --type=service\n# éæ°å¯å¨æå¡\nsystemctl restart nginx.service\n# è®¾ç½®å¼æºèªå¯å¨\nsystemctl enable nginx.service\n# è¾åºä¸é¢åå®¹è¡¨ç¤ºæåäº\ncreated symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.\nå¤å¶systemctl is-enabled servicename.service # æ¥è¯¢æå¡æ¯å¦å¼æºå¯å¨\nsystemctl enable *.service # å¼æºè¿è¡æå¡\nsystemctl disable *.service # åæ¶å¼æºè¿è¡\nsystemctl start *.service # å¯å¨æå¡\nsystemctl stop *.service # åæ­¢æå¡\nsystemctl restart *.service # éå¯æå¡\nsystemctl reload *.service # éæ°å è½½æå¡éç½®æä»¶\nsystemctl status *.service # æ¥è¯¢æå¡è¿è¡ç¶æ\nsystemctl --failed # æ¾ç¤ºå¯å¨å¤±è´¥çæå¡\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næ³¨ï¼*ä»£è¡¨æä¸ªæå¡çåå­ï¼å¦httpçæå¡åä¸ºhttpd\n\nå¼æºèªå¯å¨æ¹æ³äºï¼\n\nå¤å¶vi /etc/rc.local\n\n# å¨ rc.local æä»¶ä¸­ï¼æ·»å ä¸é¢è¿æ¡å½ä»¤\n/usr/local/nginx/sbin/nginx start\n\n\n1\n2\n3\n4\n\n\nå¦æå¼æºååç°èªå¯å¨èæ¬æ²¡ææ§è¡ï¼ä½ è¦å»ç¡®è®¤ä¸ä¸rc.localè¿ä¸ªæä»¶çè®¿é®æéæ¯å¦æ¯å¯æ§è¡çï¼å ä¸ºrc.localé»è®¤æ¯ä¸å¯æ§è¡çãä¿®æ¹rc.localè®¿é®æéï¼å¢å å¯æ§è¡æéï¼\n\nå¤å¶# /etc/rc.localæ¯/etc/rc.d/rc.localçè½¯è¿æ¥ï¼\nchmod +x /etc/rc.d/rc.local\n\n\n1\n2\n\n\nå®æ¹èæ¬ ed hat nginx init scriptã\n\n\n# è¿ç»´\n\n\n# æå¡ç®¡ç\n\nå¤å¶# å¯å¨\n/usr/local/nginx/sbin/nginx\n\n# éå¯\n/usr/local/nginx/sbin/nginx -s reload\n\n# å³é­è¿ç¨\n/usr/local/nginx/sbin/nginx -s stop\n\n# å¹³æ»å³é­nginx\n/usr/local/nginx/sbin/nginx -s quit\n\n# æ¥çnginxçå®è£ç¶æï¼\n/usr/local/nginx/sbin/nginx -v\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nå³é­é²ç«å¢ï¼æèæ·»å é²ç«å¢è§åå°±å¯ä»¥æµè¯äº\n\nå¤å¶service iptables stop\n\n\n1\n\n\næèç¼è¾éç½®æä»¶ï¼\n\nå¤å¶vi /etc/sysconfig/iptables\n\n\n1\n\n\næ·»å è¿æ ·ä¸æ¡å¼æ¾80ç«¯å£çè§ååä¿å­ï¼\n\nå¤å¶-a input -m state --state new -m tcp -p tcp --dport 80 -j accept\n\n\n1\n\n\néå¯æå¡å³å¯:\n\nå¤å¶service iptables restart\n# å½ä»¤è¿è¡æ¥çç®ånat\niptables -t nat -l\n\n\n1\n2\n3\n\n\n\n# éå¯æå¡é²ç«å¢æ¥éè§£å³\n\nå¤å¶service iptables restart\n# redirecting to /bin/systemctl restart  iptables.service\n# failed to restart iptables.service: unit iptables.service failed to load: no such file or directory.\n\n\n1\n2\n3\n\n\nå¨centos 7ærhel 7æfedoraä¸­é²ç«å¢ç± firewalld æ¥ç®¡çï¼å½ç¶ä½ å¯ä»¥è¿åä¼ ç»çç®¡çæ¹å¼ãæåä½¿ç¨æ°çå½ä»¤è¿è¡ç®¡çã åå¦éç¨ä¼ ç»è¯·æ§è¡ä¸ä¸å½ä»¤ï¼\n\nå¤å¶# ä¼ ç»å½ä»¤\nsystemctl stop firewalld\nsystemctl mask firewalld\nå¤å¶# å®è£å½ä»¤\nyum install iptables-services\n\nsystemctl enable iptables \nservice iptables restart\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# nginxå¸è½½\n\nå¦æéè¿yumå®è£ï¼ä½¿ç¨ä¸é¢å½ä»¤å®è£ã\n\nå¤å¶yum remove nginx\n\n\n1\n\n\nç¼è¯å®è£ï¼å é¤/usr/local/nginxç®å½å³å¯ å¦æéç½®äºèªå¯å¨èæ¬ï¼ä¹éè¦å é¤ã\n\n\n# åæ°è¯´æ\n\nåæ°                                           è¯´æ\nâprefix=<path>                               nginxå®è£è·¯å¾ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º /usr/local/nginxã\nâsbin-path=<path>                            nginxå¯æ§è¡æä»¶å®è£è·¯å¾ãåªè½å®è£æ¶æå®ï¼å¦ææ²¡ææå®ï¼é»è®¤ä¸º<prefix>/sbin/nginxã\nâconf-path=<path>                            å¨æ²¡æç»å®-céé¡¹ä¸é»è®¤çnginx.confçè·¯å¾ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º<prefix>/conf/nginx.confã\nâpid-path=<path>                             å¨nginx.confä¸­æ²¡ææå®pidæä»¤çæåµä¸ï¼é»è®¤çnginx.pidçè·¯å¾ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º\n                                             <prefix>/logs/nginx.pidã\nâlock-path=<path>                            nginx.lockæä»¶çè·¯å¾ã\nâerror-log-path=<path>                       å¨nginx.confä¸­æ²¡ææå®error_logæä»¤çæåµä¸ï¼é»è®¤çéè¯¯æ¥å¿çè·¯å¾ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º\n                                             <prefix>/- logs/error.logã\nâhttp-log-path=<path>                        å¨nginx.confä¸­æ²¡ææå®access_logæä»¤çæåµä¸ï¼é»è®¤çè®¿é®æ¥å¿çè·¯å¾ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º\n                                             <prefix>/- logs/access.logã\nâuser=<user>                                 å¨nginx.confä¸­æ²¡ææå®useræä»¤çæåµä¸ï¼é»è®¤çnginxä½¿ç¨çç¨æ·ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º nobodyã\nâgroup=<group>                               å¨nginx.confä¸­æ²¡ææå®useræä»¤çæåµä¸ï¼é»è®¤çnginxä½¿ç¨çç»ãå¦ææ²¡ææå®ï¼é»è®¤ä¸º nobodyã\nâbuilddir=dir                                æå®ç¼è¯çç®å½\nâwith-rtsig_module                           å¯ç¨ rtsig æ¨¡å\nâwith-select_module âwithout-select_module   åè®¸æä¸åè®¸å¼å¯selectæ¨¡å¼ï¼å¦æ configure æ²¡ææ¾å°æ´åéçæ¨¡å¼ï¼æ¯å¦ï¼kqueue(sun\n                                             os),epoll (linux kenel 2.6+), rtsig(-\n                                             å®æ¶ä¿¡å·)æè/dev/poll(ä¸ç§ç±»ä¼¼selectçæ¨¡å¼ï¼åºå±å®ç°ä¸selectåºæ¬ç¸ åï¼é½æ¯éç¨è½®è®­æ¹æ³)\n                                             selectæ¨¡å¼å°æ¯é»è®¤å®è£æ¨¡å¼\nâwith-poll_module âwithout-poll_module       whether or not to enable the poll module. this module is\n                                             enabled by, default if a more suitable method such as\n                                             kqueue, epoll, rtsig or /dev/poll is not discovered by\n                                             configure.\nâwith-http_ssl_module                        enable ngx_http_ssl_module. enables ssl support and the\n                                             ability to handle https requests. requires openssl. on\n                                             debian, this is libssl-dev. å¼å¯http\n                                             sslæ¨¡åï¼ä½¿nginxå¯ä»¥æ¯æhttpsè¯·æ±ãè¿ä¸ªæ¨¡åéè¦å·²ç»å®è£äºopensslï¼å¨debianä¸æ¯libssl\nâwith-http_realip_module                     å¯ç¨ ngx_http_realip_module\nâwith-http_addition_module                   å¯ç¨ ngx_http_addition_module\nâwith-http_sub_module                        å¯ç¨ ngx_http_sub_module\nâwith-http_dav_module                        å¯ç¨ ngx_http_dav_module\nâwith-http_flv_module                        å¯ç¨ ngx_http_flv_module\nâwith-http_stub_status_module                å¯ç¨ âserver statusâ é¡µ\nâwithout-http_charset_module                 ç¦ç¨ ngx_http_charset_module\nâwithout-http_gzip_module                    ç¦ç¨ ngx_http_gzip_module. å¦æå¯ç¨ï¼éè¦ zlib ã\nâwithout-http_ssi_module                     ç¦ç¨ ngx_http_ssi_module\nâwithout-http_userid_module                  ç¦ç¨ ngx_http_userid_module\nâwithout-http_access_module                  ç¦ç¨ ngx_http_access_module\nâwithout-http_auth_basic_module              ç¦ç¨ ngx_http_auth_basic_module\nâwithout-http_autoindex_module               ç¦ç¨ ngx_http_autoindex_module\nâwithout-http_geo_module                     ç¦ç¨ ngx_http_geo_module\nâwithout-http_map_module                     ç¦ç¨ ngx_http_map_module\nâwithout-http_referer_module                 ç¦ç¨ ngx_http_referer_module\nâwithout-http_rewrite_module                 ç¦ç¨ ngx_http_rewrite_module. å¦æå¯ç¨éè¦ pcre ã\nâwithout-http_proxy_module                   ç¦ç¨ ngx_http_proxy_module\nâwithout-http_fastcgi_module                 ç¦ç¨ ngx_http_fastcgi_module\nâwithout-http_memcached_module               ç¦ç¨ ngx_http_memcached_module\nâwithout-http_limit_zone_module              ç¦ç¨ ngx_http_limit_zone_module\nâwithout-http_empty_gif_module               ç¦ç¨ ngx_http_empty_gif_module\nâwithout-http_browser_module                 ç¦ç¨ ngx_http_browser_module\nâwithout-http_upstream_ip_hash_module        ç¦ç¨ ngx_http_upstream_ip_hash_module\nâwith-http_perl_module                       å¯ç¨ ngx_http_perl_module\nâwith-perl_modules_path=path                 æå® perl æ¨¡åçè·¯å¾\nâwith-perl=path                              æå® perl æ§è¡æä»¶çè·¯å¾\nâhttp-log-path=path                          set path to the http access log\nâhttp-client-body-temp-path=path             set path to the http client request body temporary files\nâhttp-proxy-temp-path=path                   set path to the http proxy temporary files\nâhttp-fastcgi-temp-path=path                 set path to the http fastcgi temporary files\nâwithout-http                                ç¦ç¨ http server\nâwith-mail                                   å¯ç¨ imap4/pop3/smtp ä»£çæ¨¡å\nâwith-mail_ssl_module                        å¯ç¨ ngx_mail_ssl_module\nâwith-cc=path                                æå® c ç¼è¯å¨çè·¯å¾\nâwith-cpp=path                               æå® c é¢å¤çå¨çè·¯å¾\nâwith-cc-opt=options                         additional parameters which will be added to the variable\n                                             cflags. with the use of the system library pcre in freebsd,\n                                             it is necessary to indicate âwith-cc-opt=â-i\n                                             /usr/local/includeâ. if we are using select() and it is\n                                             necessary to increase the number of file descriptors, then\n                                             this also can be assigned here: âwith-cc-opt=â-d\n                                             fd_setsize=2048â.\nâwith-ld-opt=options                         additional parameters passed to the linker. with the use of\n                                             the system library pcre in - freebsd, it is necessary to\n                                             indicate âwith-ld-opt=â-l /usr/local/libâ.\nâwith-cpu-opt=cpu                            ä¸ºç¹å®ç cpu ç¼è¯ï¼ææçå¼åæ¬ï¼pentium, pentiumpro, pentium3, pentium4,\n                                             athlon, opteron, amd64, sparc32, sparc64, ppc64\nâwithout-pcre                                ç¦æ­¢ pcre åºçä½¿ç¨ãåæ¶ä¹ä¼ç¦æ­¢ http rewrite æ¨¡åãå¨ âlocationâ\n                                             éç½®æä»¤ä¸­çæ­£åè¡¨è¾¾å¼ä¹éè¦ pcre ã\nâwith-pcre=dir                               æå® pcre åºçæºä»£ç çè·¯å¾ã\nâwith-pcre-opt=options                       set additional options for pcre building.\nâwith-md5=dir                                set path to md5 library sources.\nâwith-md5-opt=options                        set additional options for md5 building.\nâwith-md5-asm                                use md5 assembler sources.\nâwith-sha1=dir                               set path to sha1 library sources.\nâwith-sha1-opt=options                       set additional options for sha1 building.\nâwith-sha1-asm                               use sha1 assembler sources.\nâwith-zlib=dir                               set path to zlib library sources.\nâwith-zlib-opt=options                       set additional options for zlib building.\nâwith-zlib-asm=cpu                           use zlib assembler sources optimized for specified cpu,\n                                             valid values are: pentium, pentiumpro\nâwith-openssl=dir                            set path to openssl library sources\nâwith-openssl-opt=options                    set additional options for openssl building\nâwith-debug                                  å¯ç¨è°è¯æ¥å¿\nâadd-module=path                             add in a third-party module found in directory path\n\n\n# éç½®\n\nå¨centos é»è®¤éç½®æä»¶å¨ /usr/local/nginx-1.5.1/conf/nginx.conf æä»¬è¦å¨è¿ééç½®ä¸äºæä»¶ãnginx.confæ¯ä¸»éç½®æä»¶ï¼ç±è¥å¹²ä¸ªé¨åç»æï¼æ¯ä¸ªå¤§æ¬å·{}è¡¨ç¤ºä¸ä¸ªé¨åãæ¯ä¸è¡æä»¤é½ç±åå·ç»æ;ï¼æ å¿çä¸è¡çç»æã\n\n\n# å¸¸ç¨æ­£å\n\næ­£å   è¯´æ              æ­£å      è¯´æ\n.    å¹éé¤æ¢è¡ç¬¦ä»¥å¤çä»»æå­ç¬¦   $       å¹éå­ç¬¦ä¸²çç»æ\n?    éå¤0æ¬¡æ1æ¬¡         {n}     éå¤næ¬¡\n+    éå¤1æ¬¡ææ´å¤æ¬¡        {n,}    éå¤næ¬¡ææ´å¤æ¬¡\n*    éå¤0æ¬¡ææ´å¤æ¬¡        [c]     å¹éåä¸ªå­ç¬¦c\n\\d   å¹éæ°å­            [a-z]   å¹éa-zå°åå­æ¯çä»»æä¸ä¸ª\n^    å¹éå­ç¬¦ä¸²çå¼å§        -       -\n\n\n# å¨å±åé\n\nåé                 è¯´æ                             åé                  è¯´æ\n$args              è¿ä¸ªåéç­äºè¯·æ±è¡ä¸­çåæ°ï¼å$query_string   $remote_port        å®¢æ·ç«¯çç«¯å£ã\n$content_length    è¯·æ±å¤´ä¸­çcontent-lengthå­æ®µã         $remote_user        å·²ç»ç»è¿auth basic moduleéªè¯çç¨æ·åã\n$content_type      è¯·æ±å¤´ä¸­çcontent-typeå­æ®µã           $request_filename   å½åè¯·æ±çæä»¶è·¯å¾ï¼ç±rootæaliasæä»¤ä¸uriè¯·æ±çæã\n$document_root     å½åè¯·æ±å¨rootæä»¤ä¸­æå®çå¼ã              $scheme             httpæ¹æ³ï¼å¦httpï¼httpsï¼ã\n$host              è¯·æ±ä¸»æºå¤´å­æ®µï¼å¦åä¸ºæå¡å¨åç§°ã              $server_protocol    è¯·æ±ä½¿ç¨çåè®®ï¼éå¸¸æ¯http/1.0æhttp/1.1ã\n$http_user_agent   å®¢æ·ç«¯agentä¿¡æ¯                     $server_addr        æå¡å¨å°åï¼å¨å®æä¸æ¬¡ç³»ç»è°ç¨åå¯ä»¥ç¡®å®è¿ä¸ªå¼ã\n$http_cookie       å®¢æ·ç«¯cookieä¿¡æ¯                    $server_name        æå¡å¨åç§°ã\n$limit_rate        è¿ä¸ªåéå¯ä»¥éå¶è¿æ¥éçã                  $server_port        è¯·æ±å°è¾¾æå¡å¨çç«¯å£å·ã\n$request_method    å®¢æ·ç«¯è¯·æ±çå¨ä½ï¼éå¸¸ä¸ºgetæpostã          $request_uri        åå«è¯·æ±åæ°çåå§uriï¼ä¸åå«ä¸»æºåï¼å¦ï¼/foo/bar.php?arg=bazã\n$remote_addr       å®¢æ·ç«¯çipå°åã                      $uri                ä¸å¸¦è¯·æ±åæ°çå½åuriï¼$uriä¸åå«ä¸»æºåï¼å¦/foo/bar.htmlã\n$document_uri      ä¸$uriç¸åã                       -                   -\n\nä¾å¦è¯·æ±ï¼http://localhost:3000/test1/test2/test.php\n\n$hostï¼localhost $server_portï¼3000 $request_uriï¼/test1/test2/test.php $document_uriï¼/test1/test2/test.php $document_rootï¼/var/www/html $request_filenameï¼/var/www/html/test1/test2/test.php\n\n\n# ç¬¦å·åè\n\nç¬¦å·    è¯´æ    ç¬¦å·    è¯´æ    ç¬¦å·   è¯´æ\nk,k   åå­è   m,m   åå­è   ms   æ¯«ç§\ns     ç§     m     åé    h    å°æ¶\nd     æ¥     w     å¨     m    ä¸ä¸ªæ, 30å¤©\n\nä¾å¦ï¼â8kâï¼â1mâ ä»£è¡¨å­èæ°è®¡éã ä¾å¦ï¼â1h 30mâï¼â1y 6mâãä»£è¡¨ â1å°æ¶ 30åâï¼â1å¹´é¶6ä¸ªæâã\n\n\n# éç½®æä»¶\n\nnginx çéç½®ç³»ç»ç±ä¸ä¸ªä¸»éç½®æä»¶åå¶ä»ä¸äºè¾å©çéç½®æä»¶ææãè¿äºéç½®æä»¶åæ¯çº¯ææ¬æä»¶ï¼å¨é¨ä½äº nginx å®è£ç®å½ä¸ç conf ç®å½ä¸ã\n\næä»¤ç± nginx çåä¸ªæ¨¡åæä¾ï¼ä¸åçæ¨¡åä¼æä¾ä¸åçæä»¤æ¥å®ç°éç½®ã æä»¤é¤äº key-value çå½¢å¼ï¼è¿æä½ç¨åæä»¤ã\n\nnginx.conf ä¸­çéç½®ä¿¡æ¯ï¼æ ¹æ®å¶é»è¾ä¸çæä¹ï¼å¯¹å®ä»¬è¿è¡äºåç±»ï¼ä¹å°±æ¯åæäºå¤ä¸ªä½ç¨åï¼æèç§°ä¹ä¸ºéç½®æä»¤ä¸ä¸æãä¸åçä½ç¨åå«æä¸ä¸ªæèå¤ä¸ªéç½®é¡¹ã\n\nä¸é¢çè¿äºä¸ä¸ææä»¤æ¯ç¨çæ¯è¾å¤ï¼\n\ndirective        description                                                      contains directive\nmain             nginx å¨è¿è¡æ¶ä¸å·ä½ä¸å¡åè½ï¼æ¯å¦ http æå¡æè email                             user, worker_processes, error_log, events, http, mail\n                 æå¡ä»£çï¼æ å³çä¸äºåæ°ï¼æ¯å¦å·¥ä½è¿ç¨æ°ï¼è¿è¡çèº«ä»½ç­ã\nhttp             ä¸æä¾ http æå¡ç¸å³çä¸äºéç½®åæ°ãä¾å¦ï¼æ¯å¦ä½¿ç¨ keepalive åï¼æ¯å¦ä½¿ç¨ gzip è¿è¡åç¼©ç­ã        server\nserver           http æå¡ä¸æ¯æè¥å¹²èæä¸»æºãæ¯ä¸ªèæä¸»æºä¸ä¸ªå¯¹åºç server                              listen, server_name, access_log, location, protocol, proxy,\n                 éç½®é¡¹ï¼éç½®é¡¹éé¢åå«è¯¥èæä¸»æºç¸å³çéç½®ãå¨æä¾ mail æå¡çä»£çæ¶ï¼ä¹å¯ä»¥å»ºç«è¥å¹² server. æ¯ä¸ª         smtp_auth, xclient\n                 server éè¿çå¬çå°åæ¥åºåã\nlocation         http æå¡ä¸­ï¼æäºç¹å®ç url å¯¹åºçä¸ç³»åéç½®é¡¹ã                                    index, root\nmail             å®ç° email ç¸å³ç smtp/imap/pop3                                      server, http, imap_capabilities\n                 ä»£çæ¶ï¼å±äº«çä¸äºéç½®é¡¹ï¼å ä¸ºå¯è½å®ç°å¤ä¸ªä»£çï¼å·¥ä½å¨å¤ä¸ªçå¬å°åä¸ï¼ã\ninclude          ä»¥ä¾¿å¢å¼ºéç½®æä»¶çå¯è¯»æ§ï¼ä½¿å¾é¨åéç½®æä»¶å¯ä»¥éæ°ä½¿ç¨ã                                     -\nvalid_referers   ç¨æ¥æ ¡éªhttpè¯·æ±å¤´refereræ¯å¦ææã                                          -\ntry_files        ç¨å¨serveré¨åï¼ä¸è¿æå¸¸è§çè¿æ¯ç¨å¨locationé¨åï¼å®ä¼æç§ç»å®çåæ°é¡ºåºè¿è¡å°è¯ï¼ç¬¬ä¸ä¸ªè¢«å¹éå°çå°ä¼è¢«ä½¿ç¨ã   -\nif               å½å¨locationåä¸­ä½¿ç¨ifæä»¤ï¼å¨æäºæåµä¸å®å¹¶ä¸æç§é¢æè¿è¡ï¼ä¸è¬æ¥è¯´é¿åä½¿ç¨ifæä»¤ã                 -\n\nä¾å¦æä»¬å nginx.conf éé¢å¼ç¨ä¸¤ä¸ªéç½® vhost/example.com.conf å vhost/gitlab.com.conf å®ä»¬é½è¢«æ¾å¨ä¸ä¸ªæèªå·±æ°å»ºçç®å½ vhost ä¸é¢ãnginx.conf éç½®å¦ä¸ï¼\n\nå¤å¶worker_processes  1;\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'\n    #                  \'$status $body_bytes_sent "$http_referer" \'\n    #                  \'"$http_user_agent" "$http_x_forwarded_for"\';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    #gzip  on;\n    server {\n        listen       80;\n        server_name  localhost;\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n    include  vhost/example.com.conf;\n    include  vhost/gitlab.com.conf;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\nç®åçéç½®: example.com.conf\n\nå¤å¶server {\n    #ä¾¦å¬ç80ç«¯å£\n    listen       80;\n    server_name  baidu.com app.baidu.com; # è¿éæå®åå\n    index        index.html index.htm;    # è¿éæå®é»è®¤å¥å£é¡µé¢\n    root /home/www/app.baidu.com;         # è¿éæå®ç®å½\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# åç½®é¢å®ä¹åé\n\nnginxæä¾äºè®¸å¤é¢å®ä¹çåéï¼ä¹å¯ä»¥éè¿ä½¿ç¨setæ¥è®¾ç½®åéãä½ å¯ä»¥å¨ifä¸­ä½¿ç¨é¢å®ä¹åéï¼ä¹å¯ä»¥å°å®ä»¬ä¼ éç»ä»£çæå¡å¨ãä»¥ä¸æ¯ä¸äºå¸¸è§çé¢å®ä¹åéï¼æ´å¤è¯¦è§\n\nåéåç§°              å¼\n$args_name        å¨è¯·æ±ä¸­çnameåæ°\n$args             ææè¯·æ±åæ°\n$query_string     $argsçå«å\n$content_length   è¯·æ±å¤´content-lengthçå¼\n$content_type     è¯·æ±å¤´content-typeçå¼\n$host             å¦æå½åæhostï¼åä¸ºè¯·æ±å¤´hostçå¼ï¼å¦ææ²¡æè¿ä¸ªå¤´ï¼é£ä¹è¯¥å¼ç­äºå¹éè¯¥è¯·æ±çserver_nameçå¼\n$remote_addr      å®¢æ·ç«¯çipå°å\n$request          å®æ´çè¯·æ±ï¼ä»å®¢æ·ç«¯æ¶å°ï¼åæ¬httpè¯·æ±æ¹æ³ãuriãhttpåè®®ãå¤´ãè¯·æ±ä½\n$request_uri      å®æ´è¯·æ±çuriï¼ä»å®¢æ·ç«¯æ¥çè¯·æ±ï¼åæ¬åæ°\n$scheme           å½åè¯·æ±çåè®®\n$uri              å½åè¯·æ±çæ ååuri\n\n\n# ååä»£ç\n\nååä»£çæ¯ä¸ä¸ªwebæå¡å¨ï¼å®æ¥åå®¢æ·ç«¯çè¿æ¥è¯·æ±ï¼ç¶åå°è¯·æ±è½¬åç»ä¸æ¸¸æå¡å¨ï¼å¹¶å°ä»æå¡å¨å¾å°çç»æè¿åç»è¿æ¥çå®¢æ·ç«¯ãä¸é¢ç®åçååä»£ççä¾å­ï¼\n\nå¤å¶server {  \n  listen       80;                                                        \n  server_name  localhost;                                              \n  client_max_body_size 1024m;  # åè®¸å®¢æ·ç«¯è¯·æ±çæå¤§åæä»¶å­èæ°\n\n  location / {\n    proxy_pass                         http://localhost:8080;\n    proxy_set_header host              $host:$server_port;\n    proxy_set_header x-forwarded-for   $remote_addr; # httpçè¯·æ±ç«¯çå®çip\n    proxy_set_header x-forwarded-proto $scheme;      # ä¸ºäºæ­£ç¡®å°è¯å«å®éç¨æ·ååºçåè®®æ¯ http è¿æ¯ https\n  }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nå¤æçéç½®: gitlab.com.confã\n\nå¤å¶server {\n    #ä¾¦å¬ç80ç«¯å£\n    listen       80;\n    server_name  git.example.cn;\n    location / {\n        proxy_pass   http://localhost:3000;\n        #ä»¥ä¸æ¯ä¸äºååä»£ççéç½®å¯å é¤\n        proxy_redirect             off;\n        #åç«¯çwebæå¡å¨å¯ä»¥éè¿x-forwarded-forè·åç¨æ·çå®ip\n        proxy_set_header           host $host;\n        client_max_body_size       10m; #åè®¸å®¢æ·ç«¯è¯·æ±çæå¤§åæä»¶å­èæ°\n        client_body_buffer_size    128k; #ç¼å²åºä»£çç¼å²ç¨æ·ç«¯è¯·æ±çæå¤§å­èæ°\n        proxy_connect_timeout      300; #nginxè·åç«¯æå¡å¨è¿æ¥è¶æ¶æ¶é´(ä»£çè¿æ¥è¶æ¶)\n        proxy_send_timeout         300; #åç«¯æå¡å¨æ°æ®åä¼ æ¶é´(ä»£çåéè¶æ¶)\n        proxy_read_timeout         300; #è¿æ¥æååï¼åç«¯æå¡å¨ååºæ¶é´(ä»£çæ¥æ¶è¶æ¶)\n        proxy_buffer_size          4k; #è®¾ç½®ä»£çæå¡å¨ï¼nginxï¼ä¿å­ç¨æ·å¤´ä¿¡æ¯çç¼å²åºå¤§å°\n        proxy_buffers              4 32k; #proxy_buffersç¼å²åºï¼ç½é¡µå¹³åå¨32kä»¥ä¸çè¯ï¼è¿æ ·è®¾ç½®\n        proxy_busy_buffers_size    64k; #é«è´è·ä¸ç¼å²å¤§å°ï¼proxy_buffers*2ï¼\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nä»£çå°ä¸æ¸¸æå¡å¨çéç½®ä¸­ï¼æéè¦çæ¯proxy_passæä»¤ãä»¥ä¸æ¯ä»£çæ¨¡åä¸­çä¸äºå¸¸ç¨æä»¤ï¼\n\næä»¤                       è¯´æ\nproxy_connect_timeout    nginxä»æ¥åè¯·æ±è³è¿æ¥å°ä¸æ¸¸æå¡å¨çæé¿ç­å¾æ¶é´\nproxy_send_timeout       åç«¯æå¡å¨æ°æ®åä¼ æ¶é´(ä»£çåéè¶æ¶)\nproxy_read_timeout       è¿æ¥æååï¼åç«¯æå¡å¨ååºæ¶é´(ä»£çæ¥æ¶è¶æ¶)\nproxy_cookie_domain      æ¿ä»£ä»ä¸æ¸¸æå¡å¨æ¥çset-cookieå¤´çdomainå±æ§\nproxy_cookie_path        æ¿ä»£ä»ä¸æ¸¸æå¡å¨æ¥çset-cookieå¤´çpathå±æ§\nproxy_buffer_size        è®¾ç½®ä»£çæå¡å¨ï¼nginxï¼ä¿å­ç¨æ·å¤´ä¿¡æ¯çç¼å²åºå¤§å°\nproxy_buffers            proxy_buffersç¼å²åºï¼ç½é¡µå¹³åå¨å¤å°kä»¥ä¸\nproxy_set_header         éååéå°ä¸æ¸¸æå¡å¨å¤´çåå®¹ï¼ä¹å¯ä»¥éè¿å°æä¸ªå¤´é¨çå¼è®¾ç½®ä¸ºç©ºå­ç¬¦ä¸²ï¼èä¸åéæä¸ªå¤´é¨çæ¹æ³å®ç°\nproxy_ignore_headers     è¿ä¸ªæä»¤ç¦æ­¢å¤çæ¥èªä»£çæå¡å¨çåºç­ã\nproxy_intercept_errors   ä½¿nginxé»æ­¢httpåºç­ä»£ç ä¸º400æèæ´é«çåºç­ã\n\n\n# è´è½½åè¡¡\n\nupstreamæä»¤å¯ç¨ä¸ä¸ªæ°çéç½®åºæ®µï¼å¨è¯¥åºæ®µå®ä¹ä¸ç»ä¸æ¸¸æå¡å¨ãè¿äºæå¡å¨å¯è½è¢«è®¾ç½®ä¸åçæéï¼ä¹å¯è½åºäºå¯¹æå¡å¨è¿è¡ç»´æ¤ï¼æ è®°ä¸ºdownã\n\nå¤å¶upstream gitlab {\n    ip_hash;\n    # upstreamçè´è½½åè¡¡ï¼weightæ¯æéï¼å¯ä»¥æ ¹æ®æºå¨éç½®å®ä¹æéãweigthåæ°è¡¨ç¤ºæå¼ï¼æå¼è¶é«è¢«åéå°çå çè¶å¤§ã\n    server 192.168.122.11:8081 ;\n    server 127.0.0.1:82 weight=3;\n    server 127.0.0.1:83 weight=3 down;\n    server 127.0.0.1:84 weight=3; max_fails=3  fail_timeout=20s;\n    server 127.0.0.1:85 weight=4;;\n    keepalive 32;\n}\nserver {\n    #ä¾¦å¬ç80ç«¯å£\n    listen       80;\n    server_name  git.example.cn;\n    location / {\n        proxy_pass   http://gitlab;    #å¨è¿éè®¾ç½®ä¸ä¸ªä»£çï¼åupstreamçåå­ä¸æ ·\n        #ä»¥ä¸æ¯ä¸äºååä»£ççéç½®å¯å é¤\n        proxy_redirect             off;\n        #åç«¯çwebæå¡å¨å¯ä»¥éè¿x-forwarded-forè·åç¨æ·çå®ip\n        proxy_set_header           host $host;\n        proxy_set_header           x-real-ip $remote_addr;\n        proxy_set_header           x-forwarded-for $proxy_add_x_forwarded_for;\n        client_max_body_size       10m;  #åè®¸å®¢æ·ç«¯è¯·æ±çæå¤§åæä»¶å­èæ°\n        client_body_buffer_size    128k; #ç¼å²åºä»£çç¼å²ç¨æ·ç«¯è¯·æ±çæå¤§å­èæ°\n        proxy_connect_timeout      300;  #nginxè·åç«¯æå¡å¨è¿æ¥è¶æ¶æ¶é´(ä»£çè¿æ¥è¶æ¶)\n        proxy_send_timeout         300;  #åç«¯æå¡å¨æ°æ®åä¼ æ¶é´(ä»£çåéè¶æ¶)\n        proxy_read_timeout         300;  #è¿æ¥æååï¼åç«¯æå¡å¨ååºæ¶é´(ä»£çæ¥æ¶è¶æ¶)\n        proxy_buffer_size          4k; #è®¾ç½®ä»£çæå¡å¨ï¼nginxï¼ä¿å­ç¨æ·å¤´ä¿¡æ¯çç¼å²åºå¤§å°\n        proxy_buffers              4 32k;# ç¼å²åºï¼ç½é¡µå¹³åå¨32kä»¥ä¸çè¯ï¼è¿æ ·è®¾ç½®\n        proxy_busy_buffers_size    64k; #é«è´è·ä¸ç¼å²å¤§å°ï¼proxy_buffers*2ï¼\n        proxy_temp_file_write_size 64k; #è®¾å®ç¼å­æä»¶å¤¹å¤§å°ï¼å¤§äºè¿ä¸ªå¼ï¼å°ä»upstreamæå¡å¨ä¼ \n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\næ¯ä¸ªè¯·æ±ææ¶é´é¡ºåºéä¸åéå°ä¸åçåç«¯æå¡å¨ï¼å¦æåç«¯æå¡å¨downæï¼è½èªå¨åé¤ã\n\nè´è½½åè¡¡ï¼\n\nupstreamæ¨¡åè½å¤ä½¿ç¨3ç§è´è½½åè¡¡ç®æ³ï¼è½®è¯¢ãipåå¸ãæå°è¿æ¥æ°ã\n\nè½®è¯¢ï¼ é»è®¤æåµä¸ä½¿ç¨è½®è¯¢ç®æ³ï¼ä¸éè¦éç½®æä»¤æ¥æ¿æ´»å®ï¼å®æ¯åºäºå¨éåä¸­è°æ¯ä¸ä¸ä¸ªçåçç¡®ä¿è®¿é®ååå°åå¸å°æ¯ä¸ªä¸æ¸¸æå¡å¨ï¼ ipåå¸ï¼ éè¿ip_hashæä»¤æ¥æ¿æ´»ï¼nginxéè¿ipv4å°åçå3ä¸ªå­èæèæ´ä¸ªipv6å°åä½ä¸ºåå¸é®æ¥å®ç°ï¼åä¸ä¸ªipå°åæ»æ¯è½è¢«æ å°å°åä¸ä¸ªä¸æ¸¸æå¡å¨ï¼ æå°è¿æ¥æ°ï¼ éè¿least_connæä»¤æ¥æ¿æ´»ï¼è¯¥ç®æ³éè¿éæ©ä¸ä¸ªæ´»è·æ°æå°çä¸æ¸¸æå¡å¨è¿è¡è¿æ¥ãå¦æä¸æ¸¸æå¡å¨å¤çè½åä¸åï¼å¯ä»¥éè¿ç»serveréç½®weightæéæ¥è¯´æï¼è¯¥ç®æ³å°èèå°ä¸åæå¡å¨çå ææå°è¿æ¥æ°ã\n\n# rr\n\nç®åéç½® ï¼è¿éæéç½®äº2å°æå¡å¨ï¼å½ç¶å®éä¸æ¯ä¸å°ï¼åªæ¯ç«¯å£ä¸ä¸æ ·èå·²ï¼è8081çæå¡å¨æ¯ä¸å­å¨çï¼ä¹å°±æ¯è¯´è®¿é®ä¸å°ï¼ä½æ¯æä»¬è®¿é® http://localhost çæ¶åï¼ä¹ä¸ä¼æé®é¢ï¼ä¼é»è®¤è·³è½¬å°http://localhost:8080å·ä½æ¯å ä¸ºnginxä¼èªå¨å¤æ­æå¡å¨çç¶æï¼å¦ææå¡å¨å¤äºä¸è½è®¿é®ï¼æå¡å¨æäºï¼ï¼å°±ä¸ä¼è·³è½¬å°è¿å°æå¡å¨ï¼æä»¥ä¹é¿åäºä¸å°æå¡å¨æäºå½±åä½¿ç¨çæåµï¼ç±äºnginxé»è®¤æ¯rrç­ç¥ï¼æä»¥æä»¬ä¸éè¦å¶ä»æ´å¤çè®¾ç½®\n\nå¤å¶upstream test {\n    server localhost:8080;\n    server localhost:8081;\n}\nserver {\n    listen       81;\n    server_name  localhost;\n    client_max_body_size 1024m;\n \n    location / {\n        proxy_pass http://test;\n        proxy_set_header host $host:$server_port;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nè´è½½åè¡¡çæ ¸å¿ä»£ç ä¸º\n\nå¤å¶upstream test {\n    server localhost:8080;\n    server localhost:8081;\n}\n\n\n1\n2\n3\n4\n\n\n# æé\n\næå®è½®è¯¢å çï¼weightåè®¿é®æ¯çææ­£æ¯ï¼ç¨äºåç«¯æå¡å¨æ§è½ä¸åçæåµã ä¾å¦\n\nå¤å¶upstream test {\n    server localhost:8080 weight=9;\n    server localhost:8081 weight=1;\n}\n\n\n1\n2\n3\n4\n\n\né£ä¹10æ¬¡ä¸è¬åªä¼æ1æ¬¡ä¼è®¿é®å°8081ï¼èæ9æ¬¡ä¼è®¿é®å°8080\n\n# ip_hash\n\nä¸é¢ç2ç§æ¹å¼é½æä¸ä¸ªé®é¢ï¼é£å°±æ¯ä¸ä¸ä¸ªè¯·æ±æ¥çæ¶åè¯·æ±å¯è½ååå°å¦å¤ä¸ä¸ªæå¡å¨ï¼å½æä»¬çç¨åºä¸æ¯æ ç¶æçæ¶åï¼éç¨äºsessionä¿å­æ°æ®ï¼ï¼è¿æ¶åå°±æä¸ä¸ªå¾å¤§çå¾é®é¢äºï¼æ¯å¦æç»å½ä¿¡æ¯ä¿å­å°äºsessionä¸­ï¼é£ä¹è·³è½¬å°å¦å¤ä¸å°æå¡å¨çæ¶åå°±éè¦éæ°ç»å½äºï¼æä»¥å¾å¤æ¶åæä»¬éè¦ä¸ä¸ªå®¢æ·åªè®¿é®ä¸ä¸ªæå¡å¨ï¼é£ä¹å°±éè¦ç¨iphashäºï¼iphashçæ¯ä¸ªè¯·æ±æè®¿é®ipçhashç»æåéï¼è¿æ ·æ¯ä¸ªè®¿å®¢åºå®è®¿é®ä¸ä¸ªåç«¯æå¡å¨ï¼å¯ä»¥è§£å³sessionçé®é¢ã\n\nå¤å¶upstream test {\n    ip_hash;\n    server localhost:8080;\n    server localhost:8081;\n}\n\n\n1\n2\n3\n4\n5\n\n\n# fair\n\nè¿æ¯ä¸ªç¬¬ä¸æ¹æ¨¡åï¼æåç«¯æå¡å¨çååºæ¶é´æ¥åéè¯·æ±ï¼ååºæ¶é´ç­çä¼ååéã\n\nå¤å¶upstream backend {\n    fair;\n    server localhost:8080;\n    server localhost:8081;\n}\n\n\n1\n2\n3\n4\n5\n\n\n# url_hash\n\nè¿æ¯ä¸ªç¬¬ä¸æ¹æ¨¡åï¼æè®¿é®urlçhashç»ææ¥åéè¯·æ±ï¼ä½¿æ¯ä¸ªurlå®åå°åä¸ä¸ªåç«¯æå¡å¨ï¼åç«¯æå¡å¨ä¸ºç¼å­æ¶æ¯è¾ææã å¨upstreamä¸­å å¥hashè¯­å¥ï¼serverè¯­å¥ä¸­ä¸è½åå¥weightç­å¶ä»çåæ°ï¼hash_methodæ¯ä½¿ç¨çhashç®æ³\n\nå¤å¶upstream backend {\n    hash $request_uri;\n    hash_method crc32;\n    server localhost:8080;\n    server localhost:8081;\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\nä»¥ä¸5ç§è´è½½åè¡¡åèªéç¨ä¸åæåµä¸ä½¿ç¨ï¼æä»¥å¯ä»¥æ ¹æ®å®éæåµéæ©ä½¿ç¨åªç§ç­ç¥æ¨¡å¼ï¼ä¸è¿fairåurl_hashéè¦å®è£ç¬¬ä¸æ¹æ¨¡åæè½ä½¿ç¨\n\nserveræä»¤å¯éåæ°ï¼\n\n 1. weightï¼è®¾ç½®ä¸ä¸ªæå¡å¨çè®¿é®æéï¼æ°å¼è¶é«ï¼æ¶å°çè¯·æ±ä¹è¶å¤ï¼\n 2. fail_timeoutï¼å¨è¿ä¸ªæå®çæ¶é´åæå¡å¨å¿é¡»æä¾ååºï¼å¦æå¨è¿ä¸ªæ¶é´åæ²¡ææ¶å°ååºï¼é£ä¹æå¡å¨å°ä¼è¢«æ è®°ä¸ºdownç¶æï¼\n 3. max_failsï¼è®¾ç½®å¨fail_timeoutæ¶é´ä¹åå°è¯å¯¹ä¸ä¸ªæå¡å¨è¿æ¥çæå¤§æ¬¡æ°ï¼å¦æè¶è¿è¿ä¸ªæ¬¡æ°ï¼é£ä¹æå¡å¨å°ä¼è¢«æ è®°ä¸ºdown;\n 4. downï¼æ è®°ä¸ä¸ªæå¡å¨ä¸åæ¥åä»»ä½è¯·æ±ï¼\n 5. backupï¼ä¸æ¦å¶ä»æå¡å¨å®æºï¼é£ä¹æè¯¥æ è®°çæºå¨å°ä¼æ¥æ¶è¯·æ±ã\n\nkeepaliveæä»¤ï¼\n\nnginxæå¡å¨å°ä¼ä¸ºæ¯ä¸ä¸ªworkerè¿è¡ä¿æåä¸æ¸¸æå¡å¨çè¿æ¥ã\n\n\n# å±è½ip\n\nå¨nginxçéç½®æä»¶nginx.confä¸­å å¥å¦ä¸éç½®ï¼å¯ä»¥æ¾å°http, server, location, limit_exceptè¯­å¥åï¼éè¦æ³¨æç¸å¯¹è·¯å¾ï¼æ¬ä¾å½ä¸­nginx.confï¼blocksip.confå¨åä¸ä¸ªç®å½ä¸­ã\n\nå¤å¶include blockip.conf;\n\n\n1\n\n\nå¨blockip.conféé¢è¾å¥åå®¹ï¼å¦ï¼\n\nå¤å¶deny 165.91.122.67;\n\ndeny ip;   # å±è½åä¸ªipè®¿é®\nallow ip;  # åè®¸åä¸ªipè®¿é®\ndeny all;  # å±è½ææipè®¿é®\nallow all; # åè®¸ææipè®¿é®\ndeny 123.0.0.0/8   # å±è½æ´ä¸ªæ®µå³ä»123.0.0.1å°123.255.255.254è®¿é®çå½ä»¤\ndeny 124.45.0.0/16 # å±è½ipæ®µå³ä»123.45.0.1å°123.45.255.254è®¿é®çå½ä»¤\ndeny 123.45.6.0/24 # å±è½ipæ®µå³ä»123.45.6.1å°123.45.6.254è®¿é®çå½ä»¤\n\n# å¦æä½ æ³å®ç°è¿æ ·çåºç¨ï¼é¤äºå ä¸ªipå¤ï¼å¶ä»å¨é¨æç»\nallow 1.1.1.1; \nallow 1.1.1.2;\ndeny all;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# ç¬¬ä¸æ¹æ¨¡åå®è£æ¹æ³\n\nå¤å¶./configure --prefix=/ä½ çå®è£ç®å½  --add-module=/ç¬¬ä¸æ¹æ¨¡åç®å½\n\n\n1\n\n\n\n# éå®å\n\n * permanent æ°¸ä¹æ§éå®åãè¯·æ±æ¥å¿ä¸­çç¶æç ä¸º301\n * redirect ä¸´æ¶éå®åãè¯·æ±æ¥å¿ä¸­çç¶æç ä¸º302\n\n\n# éå®åæ´ä¸ªç½ç«\n\nå¤å¶server {\n    server_name old-site.com\n    return 301 $scheme://new-site.com$request_uri;\n}\n\n\n1\n2\n3\n4\n\n\n\n# éå®ååé¡µ\n\nå¤å¶server {\n    location = /oldpage.html {\n        return 301 http://example.org/newpage.html;\n    }\n}\n\n\n1\n2\n3\n4\n5\n\n\n\n# éå®åæ´ä¸ªå­è·¯å¾\n\nå¤å¶location /old-site {\n    rewrite ^/old-site/(.*) http://example.org/new-site/$1 permanent;\n}\n\n\n1\n2\n3\n\n\n\n# æ§è½\n\n\n# åå®¹ç¼å­\n\nåè®¸æµè§å¨åºæ¬ä¸æ°¸ä¹å°ç¼å­éæåå®¹ã nginxå°ä¸ºæ¨è®¾ç½®expiresåcache-controlå¤´ä¿¡æ¯ã\n\nå¤å¶location /static {\n    root /data;\n    expires max;\n}\n\n\n1\n2\n3\n4\n\n\nå¦æè¦æ±æµè§å¨æ°¸è¿ä¸ä¼ç¼å­ååºï¼ä¾å¦ç¨äºè·è¸ªè¯·æ±ï¼ï¼è¯·ä½¿ç¨-1ã\n\nå¤å¶location = /empty.gif {\n    empty_gif;\n    expires -1;\n}\n\n\n1\n2\n3\n4\n\n\n\n# gzipåç¼©\n\nå¤å¶gzip  on;\ngzip_buffers 16 8k;\ngzip_comp_level 6;\ngzip_http_version 1.1;\ngzip_min_length 256;\ngzip_proxied any;\ngzip_vary on;\ngzip_types\n    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml\n    text/javascript application/javascript application/x-javascript\n    text/x-json application/json application/x-web-app-manifest+json\n    text/css text/plain text/x-component\n    font/opentype application/x-font-ttf application/vnd.ms-fontobject\n    image/x-icon;\ngzip_disable  "msie6";\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# æå¼æä»¶ç¼å­\n\nå¤å¶open_file_cache max=1000 inactive=20s;\nopen_file_cache_valid 30s;\nopen_file_cache_min_uses 2;\nopen_file_cache_errors on;\n\n\n1\n2\n3\n4\n\n\n\n# sslç¼å­\n\nå¤å¶ssl_session_cache shared:ssl:10m;\nssl_session_timeout 10m;\n\n\n1\n2\n\n\n\n# ä¸æ¸¸keepalive\n\nå¤å¶upstream backend {\n    server 127.0.0.1:8080;\n    keepalive 32;\n}\nserver {\n    ...\n    location /api/ {\n        proxy_pass http://backend;\n        proxy_http_version 1.1;\n        proxy_set_header connection "";\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# çæ§\n\nä½¿ç¨ngxtopå®æ¶è§£ænginxè®¿é®æ¥å¿ï¼å¹¶ä¸å°å¤çç»æè¾åºå°ç»ç«¯ï¼åè½ç±»ä¼¼äºç³»ç»å½ä»¤topãææç¤ºä¾é½è¯»ånginxéç½®æä»¶çè®¿é®æ¥å¿ä½ç½®åæ ¼å¼ãå¦æè¦æå®è®¿é®æ¥å¿æä»¶å/ææ¥å¿æ ¼å¼ï¼è¯·ä½¿ç¨-få-aéé¡¹ã\n\næ³¨æï¼å¨nginxéç½®ä¸­/usr/local/nginx/conf/nginx.confæ¥å¿æä»¶å¿é¡»æ¯ç»å¯¹è·¯å¾ã\n\nå¤å¶# å®è£ ngxtop\npip install ngxtop\n\n# å®æ¶ç¶æ\nngxtop\n# ç¶æä¸º404çå10ä¸ªè¯·æ±çè·¯å¾ï¼\nngxtop top request_path --filter \'status == 404\'\n\n# åéæ»å­èæ°æå¤çå10ä¸ªè¯·æ±\nngxtop --order-by \'avg(bytes_sent) * count\'\n\n# æåååä½çipï¼ä¾å¦ï¼è°æ»å»ä½ æå¤\nngxtop --group-by remote_addr\n\n# æå°å·æ4xxæ5xxç¶æçè¯·æ±ï¼ä»¥åstatusåhttp referer\nngxtop -i \'status >= 400\' print request status http_referer\n\n# ç±200ä¸ªè¯·æ±è·¯å¾ååºåéçå¹³åæ­£æå­èä»¥\'foo\'å¼å§ï¼\nngxtop avg bytes_sent --filter \'status == 200 and request_path.startswith("foo")\'\n\n# ä½¿ç¨âcommonâæ¥å¿æ ¼å¼ä»è¿ç¨æºå¨åæapacheè®¿é®æ¥å¿\nssh remote tail -f /var/log/apache2/access.log | ngxtop -f common\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n\n# å¸¸è§ä½¿ç¨åºæ¯\n\n\n# è·¨åé®é¢\n\nå¨å·¥ä½ä¸­ï¼ææ¶åä¼éå°ä¸äºæ¥å£ä¸æ¯æè·¨åï¼è¿æ¶åå¯ä»¥ç®åçæ·»å add_headersæ¥æ¯æcorsè·¨åãéç½®å¦ä¸ï¼\n\nå¤å¶server {\n  listen 80;\n  server_name api.xxx.com;\n    \n  add_header \'access-control-allow-origin\' \'*\';\n  add_header \'access-control-allow-credentials\' \'true\';\n  add_header \'access-control-allow-methods\' \'get,post,head\';\n\n  location / {\n    proxy_pass http://127.0.0.1:3000;\n    proxy_set_header x-real-ip $remote_addr;\n    proxy_set_header x-forwarded-for $proxy_add_x_forwarded_for;\n    proxy_set_header host  $http_host;    \n  } \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nä¸é¢æ´æ¹å¤´ä¿¡æ¯ï¼è¿æä¸ç§ï¼ä½¿ç¨ rewrite æä»¤éå®åuriæ¥è§£å³è·¨åé®é¢ã\n\nå¤å¶upstream test {\n  server 127.0.0.1:8080;\n  server localhost:8081;\n}\nserver {\n  listen 80;\n  server_name api.xxx.com;\n  location / { \n    root  html;                   #å»è¯·æ±../htmlæä»¶å¤¹éçæä»¶\n    index  index.html index.htm;  #é¦é¡µååºå°å\n  }\n  # ç¨äºæ¦æªè¯·æ±ï¼å¹éä»»ä½ä»¥ /api/å¼å¤´çå°åï¼\n  # å¹éç¬¦åä»¥åï¼åæ­¢å¾ä¸æç´¢æ­£åã\n  location ^~/api/{ \n    # ä»£è¡¨éåæ¦æªè¿æ¥çè¯·æ±ï¼å¹¶ä¸åªè½å¯¹åååè¾¹çé¤å»ä¼ éçåæ°å¤çå­ç¬¦ä¸²èµ·ä½ç¨ï¼\n    # ä¾å¦www.a.com/proxy/api/msg?meth=1&par=2éåï¼åªå¯¹/proxy/api/msgéåã\n    # rewriteåé¢çåæ°æ¯ä¸ä¸ªç®åçæ­£å ^/api/(.*)$ï¼\n    # $1ä»£è¡¨æ­£åä¸­çç¬¬ä¸ä¸ª()ï¼$2ä»£è¡¨ç¬¬äºä¸ª()çå¼ï¼ä»¥æ­¤ç±»æ¨ã\n    rewrite ^/api/(.*)$ /$1 break;\n    \n    # æè¯·æ±ä»£çå°å¶ä»ä¸»æº \n    # å¶ä¸­ http://www.b.com/ åæ³å http://www.b.comåæ³çåºå«å¦ä¸\n    # å¦æä½ çè¯·æ±å°åæ¯ä» http://server/html/test.jsp\n    # éç½®ä¸ï¼ http://www.b.com/ åé¢æâ/â \n    #         å°ååä»£çæ http://www.b.com/html/test.jsp è®¿é®\n    # éç½®ä¸ï¼ http://www.b.com åé¢æ²¡ææâ/â \n    #         å°ååä»£çæ http://www.b.com/test.jsp è®¿é®\n    proxy_pass http://test;\n\n    # å¦æ proxy_pass  url æ¯ http://a.xx.com/platform/ è¿ç§æåµ\n    # proxy_cookie_pathåºè¯¥è®¾ç½®æ /platform/ / (æ³¨æä¸¤ä¸ªææ ä¹é´æç©ºæ ¼)ã\n    proxy_cookie_path /platfrom/ /;\n\n    # http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass_header\n    # è®¾ç½® cookie å¤´éè¿\n    proxy_pass_header set-cookie;\n  } \n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n\n\n\n# è·³è½¬å°å¸¦wwwçåä¸é¢\n\nå¤å¶server {\n    listen 80;\n    # éç½®æ­£å¸¸çå¸¦wwwçåå\n    server_name www.wangchujiang.com;\n    root /home/www/wabg/download;\n    location / {\n        try_files $uri $uri/ /index.html =404;\n    }\n}\nserver {\n    # è¿ä¸ªè¦æ¾å°ä¸é¢ï¼\n    # å°ä¸å¸¦wwwç wangchujiang.com æ°¸ä¹æ§éå®åå°  https://www.wangchujiang.com\n    server_name wangchujiang.com;\n    rewrite ^(.*) https://www.wangchujiang.com$1 permanent;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# ä»£çè½¬å\n\nå¤å¶upstream server-api{\n    # api ä»£çæå¡å°å\n    server 127.0.0.1:3110;    \n}\nupstream server-resource{\n    # éæèµæº ä»£çæå¡å°å\n    server 127.0.0.1:3120;\n}\nserver {\n    listen       3111;\n    server_name  localhost;      # è¿éæå®åå\n    root /home/www/server-statics;\n    # å¹é api è·¯ç±çååä»£çå°apiæå¡\n    location ^~/api/ {\n        rewrite ^/(.*)$ /$1 break;\n        proxy_pass http://server-api;\n    }\n    # åè®¾è¿ééªè¯ç ä¹å¨apiæå¡ä¸­\n    location ^~/captcha {\n        rewrite ^/(.*)$ /$1 break;\n        proxy_pass http://server-api;\n    }\n    # åè®¾ä½ çå¾çèµæºå¨é¨å¨å¦å¤ä¸ä¸ªæå¡ä¸é¢\n    location ^~/img/ {\n        rewrite ^/(.*)$ /$1 break;\n        proxy_pass http://server-resource;\n    }\n    # è·¯ç±å¨åç«¯ï¼åç«¯æ²¡æçå®è·¯ç±ï¼å¨è·¯ç±ä¸å­å¨ç 404ç¶æçé¡µé¢è¿å /index.html\n    # è¿ä¸ªæ¹å¼ä½¿ç¨åºæ¯ï¼ä½ å¨åreactæèvueé¡¹ç®çæ¶åï¼æ²¡æçå®è·¯ç±\n    location / {\n        try_files $uri $uri/ /index.html =404;\n        #                               ^ ç©ºæ ¼å¾éè¦\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n\n# çæ§ç¶æä¿¡æ¯\n\néè¿ nginx -v æ¥æ¥çæ¯å¦æ with-http_stub_status_module è¯¥æ¨¡åã\n\n> nginx -v è¿é v æ¯å¤§åçï¼å¦ææ¯å°åç v å³ nginx -vï¼åä¸ä¼åºç°æåªäºæ¨¡åï¼åªä¼åºç° nginx ççæ¬\n\nå¤å¶location /nginx_status {\n    stub_status on;\n    access_log off;\n}\n\n\n1\n2\n3\n4\n\n\néè¿ http://127.0.0.1/nginx_status è®¿é®åºç°ä¸é¢ç»æã\n\nå¤å¶active connections: 3\nserver accepts handled requests\n 7 7 5 \nreading: 0 writing: 1 waiting: 2\n\n\n1\n2\n3\n4\n\n 1. ä¸»å¨è¿æ¥(ç¬¬ 1 è¡)\n\nå½åä¸httpå»ºç«çè¿æ¥æ°ï¼åæ¬ç­å¾çå®¢æ·ç«¯è¿æ¥ï¼3\n\n 1. æå¡å¨æ¥åå¤ççè¯·æ±(ç¬¬ 2~3 è¡)\n\næ¥åçå®¢æ·ç«¯è¿æ¥æ»æ°ç®ï¼7 å¤ççå®¢æ·ç«¯è¿æ¥æ»æ°ç®ï¼7 å®¢æ·ç«¯æ»çè¯·æ±æ°ç®ï¼5\n\n 1. è¯»åå¶å®ä¿¡(ç¬¬ 4 è¡)\n\nå½åï¼nginxè¯»è¯·æ±è¿æ¥ å½åï¼nginxåååºè¿åç»å®¢æ·ç«¯ ç®åæå¤å°ç©ºé²å®¢æ·ç«¯è¯·æ±è¿æ¥\n\n\n# ä»£çè½¬åè¿æ¥æ¿æ¢\n\nå¤å¶location ^~/api/upload {\n    rewrite ^/(.*)$ /wfs/v1/upload break;\n    proxy_pass http://wfs-api;\n}\n\n\n1\n2\n3\n4\n\n\n\n# ssléç½®\n\nè¶ææ¬ä¼ è¾å®å¨åè®®ï¼ç¼©åï¼httpsï¼è±è¯­ï¼hypertext transfer protocol secureï¼æ¯è¶ææ¬ä¼ è¾åè®®åssl/tlsçç»åï¼ç¨ä»¥æä¾å å¯éè®¯åå¯¹ç½ç»æå¡å¨èº«ä»½çé´å®ãhttpsè¿æ¥ç»å¸¸è¢«ç¨äºä¸ç»´ç½ä¸çäº¤ææ¯ä»åä¼ä¸ä¿¡æ¯ç³»ç»ä¸­ææä¿¡æ¯çä¼ è¾ãhttpsä¸åºä¸å¨rfc 2660ä¸­å®ä¹çå®å¨è¶ææ¬ä¼ è¾åè®®ï¼s-httpï¼ç¸æ··ãhttps ç®åå·²ç»æ¯æææ³¨ééç§åå®å¨çç½ç«çé¦éï¼éçææ¯çä¸æ­åå±ï¼https ç½ç«å·²ä¸åæ¯å¤§åç½ç«çä¸å©ï¼æææ®éçä¸ªäººç«é¿ååå®¢åå¯ä»¥èªå·±å¨ææ­å»ºä¸ä¸ªå®å¨çå å¯çç½ç«ã\n\nåå»ºsslè¯ä¹¦ï¼å¦æä½ è´­ä¹°çè¯ä¹¦ï¼å°±å¯ä»¥ç´æ¥ä¸è½½\n\nå¤å¶sudo mkdir /etc/nginx/ssl\n# åå»ºäºæææ100å¹´ï¼å å¯å¼ºåº¦ä¸ºrsa2048çsslå¯é¥keyåx509è¯ä¹¦æä»¶ã\nsudo openssl req -x509 -nodes -days 36500 -newkey rsa:2048 -keyout /etc/nginx/ssl/nginx.key -out /etc/nginx/ssl/nginx.crt\n# ä¸é¢å½ä»¤ï¼ä¼æä¸é¢éè¦å¡«ååå®¹\ncountry name (2 letter code) [au]:us\nstate or province name (full name) [some-state]:new york\nlocality name (eg, city) []:new york city\norganization name (eg, company) [internet widgits pty ltd]:bouncy castles, inc.\norganizational unit name (eg, section) []:ministry of water slides\ncommon name (e.g. server fqdn or your name) []:your_domain.com\nemail address []:admin@your_domain.com\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nåå»ºèªç­¾è¯ä¹¦\n\nå¤å¶é¦åï¼åå»ºè¯ä¹¦åç§é¥çç®å½\n# mkdir -p /etc/nginx/cert\n# cd /etc/nginx/cert\nåå»ºæå¡å¨ç§é¥ï¼å½ä»¤ä¼è®©ä½ è¾å¥ä¸ä¸ªå£ä»¤ï¼\n# openssl genrsa -des3 -out nginx.key 2048\nåå»ºç­¾åè¯·æ±çè¯ä¹¦ï¼csrï¼ï¼\n# openssl req -new -key nginx.key -out nginx.csr\nå¨å è½½sslæ¯æçnginxå¹¶ä½¿ç¨ä¸è¿°ç§é¥æ¶é¤å»å¿é¡»çå£ä»¤ï¼\n# cp nginx.key nginx.key.org\n# openssl rsa -in nginx.key.org -out nginx.key\næåæ è®°è¯ä¹¦ä½¿ç¨ä¸è¿°ç§é¥åcsrï¼\n# openssl x509 -req -days 365 -in nginx.csr -signkey nginx.key -out nginx.crt\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥çç®ånginxç¼è¯éé¡¹\n\nå¤å¶sbin/nginx -v\n\n\n1\n\n\nè¾åºä¸é¢åå®¹\n\nå¤å¶nginx version: nginx/1.7.8\nbuilt by gcc 4.4.7 20120313 (red hat 4.4.7-4) (gcc)\ntls sni support enabled\nconfigure arguments: --prefix=/usr/local/nginx-1.7.8 --with-http_ssl_module --with-http_spdy_module --with-http_stub_status_module --with-pcre\n\n\n1\n2\n3\n4\n\n\nå¦æä¾èµçæ¨¡åä¸å­å¨ï¼å¯ä»¥è¿å¥å®è£ç®å½ï¼è¾å¥ä¸é¢å½ä»¤éæ°ç¼è¯å®è£ã\n\nå¤å¶./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module\n\n\n1\n\n\nè¿è¡å®æä¹åè¿éè¦make (ä¸ç¨make install)\n\nå¤å¶# å¤ä»½nginxçäºè¿å¶æä»¶\ncp -rf /usr/local/nginx/sbin/nginxã /usr/local/nginx/sbin/nginx.bak\n# è¦çnginxçäºè¿å¶æä»¶\ncp -rf objs/nginx   /usr/local/nginx/sbin/\n\n\n1\n2\n3\n4\n\n\nhttps server\n\nå¤å¶server {\n    listen       443 ssl;\n    server_name  localhost;\n\n    ssl_certificate /etc/nginx/ssl/nginx.crt;\n    ssl_certificate_key /etc/nginx/ssl/nginx.key;\n    # ç¦æ­¢å¨headerä¸­åºç°æå¡å¨çæ¬ï¼é²æ­¢é»å®¢å©ç¨çæ¬æ¼æ´æ»å»\n    server_tokens off;\n    # è®¾ç½®ssl/tlsä¼è¯ç¼å­çç±»ååå¤§å°ãå¦æè®¾ç½®äºè¿ä¸ªåæ°ä¸è¬æ¯sharedï¼buildinå¯è½ä¼åæ°åå­ç¢çï¼é»è®¤æ¯noneï¼åoffå·®ä¸å¤ï¼åç¨ç¼å­ãå¦shared:ssl:10mè¡¨ç¤ºæææçnginxå·¥ä½è¿ç¨å±äº«sslä¼è¯ç¼å­ï¼å®ç½ä»ç»è¯´1må¯ä»¥å­æ¾çº¦4000ä¸ªsessionsã \n    ssl_session_cache    shared:ssl:1m; \n\n    # å®¢æ·ç«¯å¯ä»¥éç¨ä¼è¯ç¼å­ä¸­sslåæ°çè¿ææ¶é´ï¼åç½ç³»ç»é»è®¤5åéå¤ªç­äºï¼å¯ä»¥è®¾æ30må³30åéçè³4hã\n    ssl_session_timeout  5m; \n\n    # éæ©å å¯å¥ä»¶ï¼ä¸åçæµè§å¨ææ¯æçå¥ä»¶ï¼åé¡ºåºï¼å¯è½ä¼ä¸åã\n    # è¿éæå®çæ¯opensslåºè½å¤è¯å«çåæ³ï¼ä½ å¯ä»¥éè¿ openssl -v cipher \'rc4:high:!anull:!md5\'ï¼åé¢æ¯ä½ ææå®çå¥ä»¶å å¯ç®æ³ï¼ æ¥çææ¯æç®æ³ã\n    ssl_ciphers  high:!anull:!md5;\n\n    # è®¾ç½®ååå å¯ç®æ³æ¶ï¼ä¼åä½¿ç¨æä»¬æå¡ç«¯çå å¯å¥ä»¶ï¼èä¸æ¯å®¢æ·ç«¯æµè§å¨çå å¯å¥ä»¶ã\n    ssl_prefer_server_ciphers  on;\n\n    location / {\n        root   html;\n        index  index.html index.htm;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\n\n# å¼ºå¶å°httpéå®åå°https\n\nå¤å¶server {\n    listen       80;\n    server_name  example.com;\n    rewrite ^ https://$http_host$request_uri? permanent;    # å¼ºå¶å°httpéå®åå°https\n    # å¨éè¯¯é¡µé¢åâæå¡å¨âååºå¤´å­æ®µä¸­å¯ç¨æç¦ç¨åå°nginxçæ¬ã é²æ­¢é»å®¢å©ç¨çæ¬æ¼æ´æ»å»\n    server_tokens off;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# ä¸¤ä¸ªèæä¸»æº\n\nçº¯éæ-html æ¯æ\n\nå¤å¶http {\n    server {\n        listen          80;\n        server_name     www.domain1.com;\n        access_log      logs/domain1.access.log main;\n        location / {\n            index index.html;\n            root  /var/www/domain1.com/htdocs;\n        }\n    }\n    server {\n        listen          80;\n        server_name     www.domain2.com;\n        access_log      logs/domain2.access.log main;\n        location / {\n            index index.html;\n            root  /var/www/domain2.com/htdocs;\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# èæä¸»æºæ åéç½®\n\nå¤å¶http {\n  server {\n    listen          80 default;\n    server_name     _ *;\n    access_log      logs/default.access.log main;\n    location / {\n       index index.html;\n       root  /var/www/default/htdocs;\n    }\n  }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# ç¬è«è¿æ»¤\n\næ ¹æ® user-agent è¿æ»¤è¯·æ±ï¼éè¿ä¸ä¸ªç®åçæ­£åè¡¨è¾¾å¼ï¼å°±å¯ä»¥è¿æ»¤ä¸ç¬¦åè¦æ±çç¬è«è¯·æ±(åçº§ç¬è«)ã\n\n> ~* è¡¨ç¤ºä¸åºåå¤§å°åçæ­£åå¹é\n\nå¤å¶location / {\n    if ($http_user_agent ~* "python|curl|java|wget|httpclient|okhttp") {\n        return 503;\n    }\n    # æ­£å¸¸å¤ç\n    # ...\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# é²çé¾\n\nå¤å¶location ~* \\.(gif|jpg|png|swf|flv)$ {\n   root html\n   valid_referers none blocked *.nginxcn.com;\n   if ($invalid_referer) {\n     rewrite ^/ www.nginx.cn\n     #return 404;\n   }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# èæç®å½éç½®\n\naliasæå®çç®å½æ¯åç¡®çï¼rootæ¯æå®ç®å½çä¸çº§ç®å½ï¼å¹¶ä¸è¯¥ä¸çº§ç®å½è¦å«ælocationæå®åç§°çååç®å½ã\n\nå¤å¶location /img/ {\n    alias /var/www/image/;\n}\n# è®¿é®/img/ç®å½éé¢çæä»¶æ¶ï¼ningxä¼èªå¨å»/var/www/image/ç®å½æ¾æä»¶\nlocation /img/ {\n    root /var/www/image;\n}\n# è®¿é®/img/ç®å½ä¸çæä»¶æ¶ï¼nginxä¼å»/var/www/image/img/ç®å½ä¸æ¾æä»¶ã]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# é²çå¾éç½®\n\nå¤å¶location ~ \\/public\\/(css|js|img)\\/.*\\.(js|css|gif|jpg|jpeg|png|bmp|swf) {\n    valid_referers none blocked *.jslite.io;\n    if ($invalid_referer) {\n        rewrite ^/  http://wangchujiang.com/piratesp.png;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# å±è½.gitç­æä»¶\n\nå¤å¶location ~ (.git|.gitattributes|.gitignore|.svn) {\n    deny all;\n}\n\n\n1\n2\n3\n\n\n\n# ååè·¯å¾å ä¸å éè¦é½è½æ­£å¸¸è®¿é®\n\nå¤å¶http://wangchujiang.com/api/index.php?a=1&name=wcj\n                                  ^ æåç¼\n\nhttp://wangchujiang.com/api/index?a=1&name=wcj\n                                 ^ æ²¡æåç¼\n\n\n1\n2\n3\n4\n5\n\n\nnginx rewriteè§åå¦ä¸ï¼\n\nå¤å¶rewrite ^/(.*)/$ /index.php?/$1 permanent;\nif (!-d $request_filename){\n        set $rule_1 1$rule_1;\n}\nif (!-f $request_filename){\n        set $rule_1 2$rule_1;\n}\nif ($rule_1 = "21"){\n        rewrite ^/ /index.php last;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n\n# éè¯¯é®é¢\n\nå¤å¶the plain http request was sent to https port\n\n\n1\n\n\nè§£å³åæ³ï¼fastcgi_param https $https if_not_empty æ·»å è¿æ¡è§åï¼\n\nå¤å¶server {\n    listen 443 ssl; # æ³¨æè¿æ¡è§å\n    server_name  my.domain.com;\n    \n    fastcgi_param https $https if_not_empty;\n    fastcgi_param https on;\n\n    ssl_certificate /etc/ssl/certs/your.pem;\n    ssl_certificate_key /etc/ssl/private/your.key;\n\n    location / {\n        # your config here...\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# nginx æ¨¡å\n\n * nginx office hours ä¸ä¸ª nginx æ¨¡åï¼åè®¸æ¨ä»å¨åå¬æ¶é´åæä¾è®¿é®è®¿é®ç½ç«ã\n\n\n# ç²¾åæç« åè\n\n * è´è½½åè¡¡åççè§£æ\n\n * nginxæ³ååè§£æï¼å®ç°å¤ä¸ªäºçº§åå\n\n * æ·±å¥ nginx: æä»¬å¦ä½è®¾è®¡æ§è½åæ©å±\n\n * inside nginx: how we designed for performance & scale\n\n * nginxå¼åä»å¥é¨å°ç²¾é\n\n * nginxçä¼åä¸é²çé¾\n\n * å®æå¼åä¸ä¸ªnginxæ©å± (nginx module)\n\n * nginx+keepalived(åæºç­å¤)æ­å»ºé«å¯ç¨è´è½½åè¡¡ç¯å¢(ha)\n\n * nginx å¹³æ»åçº§\n\n * nginxææ°æ¨¡åângx_http_mirror_moduleåæå¯ä»¥åçæ¬åå¸åçé¢åéªè¯ï¼è¿è¡æµéæ¾å¤§åçåæµç­ç­\n   \n   åæé¾æ¥https://www.viayc.com/2019/03/13/nginx%e9%85%8d%e7%bd%ae%e6%95%99%e7%a8%8b/',charsets:{cjk:!0}},{title:"nginxå¸¸ç¨éç½®",frontmatter:{title:"nginxå¸¸ç¨éç½®",date:"2023-02-09T20:26:18.000Z",permalink:"/pages/df9ea8/",categories:["è¿ç»´","ä¸­é´ä»¶","nginx"],tags:[null],readingShow:"top",description:"èæä¸»æºçä¸ç§æ¹å¼ï¼åºäºç«¯å£ãIPå°åãåå",meta:[{name:"twitter:title",content:"nginxå¸¸ç¨éç½®"},{name:"twitter:description",content:"èæä¸»æºçä¸ç§æ¹å¼ï¼åºäºç«¯å£ãIPå°åãåå"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.nginx/02.nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE.html"},{property:"og:type",content:"article"},{property:"og:title",content:"nginxå¸¸ç¨éç½®"},{property:"og:description",content:"èæä¸»æºçä¸ç§æ¹å¼ï¼åºäºç«¯å£ãIPå°åãåå"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.nginx/02.nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-09T20:26:18.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"nginxå¸¸ç¨éç½®"},{itemprop:"description",content:"èæä¸»æºçä¸ç§æ¹å¼ï¼åºäºç«¯å£ãIPå°åãåå"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/01.nginx/02.nginx%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE.html",relativePath:"04.è¿ç»´/03.ä¸­é´ä»¶/01.nginx/02.nginxå¸¸ç¨éç½®.md",key:"v-74be9f5b",path:"/pages/df9ea8/",headers:[{level:2,title:"èæä¸»æº",slug:"èæä¸»æº",normalizedTitle:"èæä¸»æº",charIndex:2},{level:2,title:"nginxè´è½½åè¡¡",slug:"nginxè´è½½åè¡¡",normalizedTitle:"nginxè´è½½åè¡¡",charIndex:295},{level:2,title:"ååä»£ç",slug:"ååä»£ç",normalizedTitle:"ååä»£ç",charIndex:640},{level:2,title:"locationè§å",slug:"locationè§å",normalizedTitle:"locationè§å",charIndex:2128},{level:2,title:"è¯ä¹¦",slug:"è¯ä¹¦",normalizedTitle:"è¯ä¹¦",charIndex:3734},{level:2,title:"æ¥å¿",slug:"æ¥å¿",normalizedTitle:"æ¥å¿",charIndex:5144},{level:2,title:"phpéç½®",slug:"phpéç½®",normalizedTitle:"phpéç½®",charIndex:5445},{level:2,title:"æ¨¡å",slug:"æ¨¡å",normalizedTitle:"æ¨¡å",charIndex:5725},{level:2,title:"è·³è½¬ãéå®å",slug:"è·³è½¬ãéå®å",normalizedTitle:"è·³è½¬ãéå®å",charIndex:6004},{level:2,title:"èæç®å½",slug:"èæç®å½",normalizedTitle:"èæç®å½",charIndex:7841},{level:2,title:"nginxè·¨å",slug:"nginxè·¨å",normalizedTitle:"nginxè·¨å",charIndex:7906},{level:3,title:"é²æ­¢ååæ¶æè§£æ",slug:"é²æ­¢ååæ¶æè§£æ",normalizedTitle:"é²æ­¢ååæ¶æè§£æ",charIndex:14121},{level:3,title:"ç½ç«ç½®ç°",slug:"ç½ç«ç½®ç°",normalizedTitle:"ç½ç«ç½®ç°",charIndex:14473}],headersStr:"èæä¸»æº nginxè´è½½åè¡¡ ååä»£ç locationè§å è¯ä¹¦ æ¥å¿ phpéç½® æ¨¡å è·³è½¬ãéå®å èæç®å½ nginxè·¨å é²æ­¢ååæ¶æè§£æ ç½ç«ç½®ç°",content:'# èæä¸»æº\n\nèæä¸»æºçä¸ç§æ¹å¼ï¼åºäºç«¯å£ãIPå°åãåå\n\nserver {\n\nlisten 80;\n\nserver_name www.accp.com;\n\ncharset utf-8;\n\naccess_log logs/www.accp.com.access.log;\n\nlocation / {\n\nroot /var/www/html/accp;\n\nindex index.html index.htm;\n\n}\n\nerror_page 500 502 503 504 /50x.html;\n\nlocation = /50x.html {\n\nroot html;\n\n}\n\n}\n\n\n# nginxè´è½½åè¡¡\n\nupstream cluster {\n\nip_hash; #å¦æä½ çç³»ç»ä¸­æ²¡æä½¿ç¨ç¬¬ä¸æ¹ç¼å­ç®¡çå·¥å· ,å»ºè®®ä½¿ç¨æ­¤æ¹å¼\n\nserver 192.168.1.210:80 weight=5;\n\nserver 192.168.1.211:80 weight=3;\n\nserver 192.168.1.212:80 weight=1;\n\n}\n\nupstream dxTreasureIsland_http { server dal05iis39.sl.dx weight=1 max_fails=1 fail_timeout=45s; server iis01.zl.dx:8093 weight=1 max_fails=1 fail_timeout=45s; }\n\n\n# ååä»£ç\n\nâ location / {\nâ proxy_pass http://localhost:8000/;\nâ proxy_redirect off;\nâ proxy_set_header Host $http_host;\nâ proxy_set_header X-Real-IP $remote_addr;\nâ proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\nâ location / {\nâ proxy_pass http://172.18.184.130:10085;\nâ proxy_set_header Host $host;\nâ proxy_set_header X-Real-IP $remote_addr;\nâ proxy_redirect http:// $scheme://; #ä»¥ä¸æä»¤ä¼å°åç«¯ååºheader locationåå®¹ä¸­çhttp://æ¿æ¢æç¨æ·ç«¯åè®®https://\nâ proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\nâ }\n\nlocation / {\n\nproxy_pass http://baidunode;\n\nproxy_set_header X-Forwarded-Proto $scheme;\nproxy_set_header Host $host; #HTTP header ä¸­ç Host å«ä¹ä¸ºæè¯·æ±çç®çä¸»æºåãå½ nginx ä½ä¸ºååä»£çä½¿ç¨ï¼èåç«¯çå® web æå¡å¨è®¾ç½®æç±»ä¼¼ é²çé¾åè½\n\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; #HTTP header ä¸­ç X_Forward_For è¡¨ç¤ºè¯¥æ¡ http è¯·æ±æ¯ç±è°åèµ·ç\n\nproxy_set_header X-Real-IP $remote_addr;\n proxy_redirect off;\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nå¸¸ç¨çä»£ç\n\n    location / {\n        proxy_pass         http://localhost:8000/;\n        proxy_set_header   Host             $http_host;\n        proxy_set_header   X-Real-IP        $remote_addr;\n        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nproxy_redirectçä½ç¨\n\nproxy_redirect è¯¥æä»¤ç¨æ¥ä¿®æ¹è¢«ä»£çæå¡å¨è¿åçååºå¤´ä¸­çLocationå¤´ååârefreshâå¤´åã\n\n>  1. proxy_redirect æ§å°å æ°å°å;\n> \n>  2. proxy_redirect default; #é»è®¤éç½®\n> \n>  3. proxy_redirect off; #å³é­éå®å\n\n\n# locationè§å\n\néç½®location /wandouå¯ä»¥å¹é/wandoudouduoè¯·æ±ï¼ä¹å¯ä»¥å¹é/wandou*/duoduoç­ç­ï¼åªè¦ä»¥wandouå¼å¤´çç®å½é½å¯ä»¥å¹éå°ãèlocation /wandou/å¿é¡»ç²¾ç¡®å¹é/wandou/è¿ä¸ªç®å½çè¯·æ±,ä¸è½å¹é/wandouduoduo/æ/wandou*/duoduoç­è¯·æ±ã\n\nç¬¬ä¸ç§ï¼å "/" location /wddd/ { proxy_pass http://127.0.0.1:8080/; } æµè¯ç»æï¼è¯·æ±è¢«ä»£çè·³è½¬å°ï¼http://127.0.0.1:8080/index.html ç¬¬äºç§: ä¸å "/" location /wddd/ {\nproxy_pass http://127.0.0.1:8080; } æµè¯ç»æï¼è¯·æ±è¢«ä»£çè·³è½¬å°ï¼http://127.0.0.1:8080/wddd/index.html ç¬¬ä¸ç§: å¢å ç®å½å "/" location /wddd/ {\nproxy_pass http://127.0.0.1:8080/sun/; } æµè¯ç»æï¼è¯·æ±è¢«ä»£çè·³è½¬å°ï¼http://127.0.0.1:8080/sun/index.html ç¬¬åç§ï¼å¢å ç®å½ä¸å "/" location /wddd/ { proxy_pass http://127.0.0.1:8080/sun; } æµè¯ç»æï¼è¯·æ±è¢«ä»£çè·³è½¬å°ï¼http://127.0.0.1:8080/sun/index.html æ»ç» locationç®å½åå "/",åªè½å¹éç®å½ï¼ä¸å â/âä¸ä»å¯ä»¥å¹éç®å½è¿å¯¹ç®å½è¿è¡æ¨¡ç³å¹éãèproxy_passæ è®ºå ä¸å â/â,ä»£çè·³è½¬å°åé½ç´æ¥æ¼æ¥\n\nç¬¦å·   è¯´æ\n~    æ­£åå¹éï¼åºåå¤§å°å\n~*   æ­£åå¹éï¼ä¸åºåå¤§å°å\n^~   æ®éå­ç¬¦å¹éï¼å¦æè¯¥éé¡¹å¹éï¼åï¼åªå¹éæ¹éé¡¹ï¼ä¸ååä¸å¹éå¶ä»éé¡¹\n=    æ®éå­ç¬¦å¹éï¼ç²¾ç¡®å¹é\n@    å®ä¹ä¸ä¸ªå½åç locationï¼ç¨äºåé¨å®åï¼ä¾å¦ error_pageï¼try_files\n\nç¬¦å·@ä½¿ç¨ä¾å­\n\nserver {\n    listen 80;\n    client_max_body_size 100M;\n    keepalive_timeout 5;\n    root /app/static;\n    location /backend {\n    rewrite ^/backend/(.*) /$1 break;\n    try_files $uri @proxy_to_app;\n    }\n    location / {\n    try_files $uri @proxy_to_app;\n    }\n    location @proxy_to_spp {\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_set_header   X-Real-IP        $remote_addr;\n        proxy_redirect off;\n        proxy_pass http://app_server;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nnginxç¦æ­¢ãåè®¸è®¿é®æäºåç¼çæä»¶ location ~* .(ini|cfg|dwt|lbi)$ {\ndeny all;\n}\n\n\n# è¯ä¹¦\n\nssl_certificate /etc/ssl/private/.crt; ssl_certificate_key /etc/ssl/private/.key; ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers HIGH:!ADH:!aNULL:!eNULL:!MD5:!DSS:!DH:!RC4; ssl_prefer_server_ciphers on;\n\nserver {\n    listen 443;\n    listen 80;\n    server_name m.goldmanfutures.com;\n    ssl on;\n    ssl_certificate      /etc/nginx/cert/m.goldmanfutures.com/m.goldmanfutures.com_chain.crt;\n    ssl_certificate_key  /etc/nginx/cert/m.goldmanfutures.com/m.goldmanfutures.com_key.key;\n    proxy_ssl_session_reuse   off;\n    ssl_session_cache         shared:SSL:1m;\n    ssl_session_timeout       5m;\n    ssl_ciphers               ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\n    ssl_protocols             TLSv1 TLSv1.1 TLSv1.2;\n    ssl_prefer_server_ciphers on;\n    client_max_body_size 1g;\n    client_body_buffer_size 1m;\n        if ($scheme = http) {\n                rewrite ^(.*)$ https://m.goldmanfutures.com$1 permanent;\n        }\n\n\n    index   index.html index.htm index.php;\n    location / {\n        proxy_pass   http://172.31.186.20:10584/;\n        proxy_set_header Host      $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# æ¥å¿\n\nâ access_log /var/log/nginx/jenkins.dx.com.access.log;\nâ error_log /var/log/nginx/jenkins.dx.com.errors.log;\nâ\n\nlog_format main \'$remote_addr - $remote_user [$time_local] "$request" \'\n \'$status $body_bytes_sent "$http_referer" \'\n \'"$http_user_agent" "$http_x_forwarded_for"\';\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# phpéç½®\n\nâ location ~ \\.php$ {\nâ root /data/erp5/website/erp5.pdvee.com/public;\nâ index index.php;\nâ fastcgi_pass 192.168.14.20:9005;\nâ fastcgi_index index.php;\nâ fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\nâ include fastcgi_params;\nâ }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# æ¨¡å\n\nconcatæ¨¡åï¼Nginx concatéè¿åå¹¶éææä»¶æ¥åå°httpè¯·æ±æ°æ¥è¾¾å°ä¼ååç«¯æ§è½ï¼å¯ä»¥å¨ä¸å®ç¨åº¦ä¸è½åå°webæå¡å¨çååã\n\nlocation / {\n concat on;\n concat_max_files 100;\n concat_unique off;\n concat_ignore_file_error on;\n if (!-e $request_filename) {\n rewrite ^(.*)$ /index.php?s=/$1 last;\n break;\n }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# è·³è½¬ãéå®å\n\nâ if ($host ~ ^www\\.dealextreme.com\\.com$) {\nâ rewrite ^(.*)$ $scheme://www.dx.com permanent;\nâ }\nif ($scheme = http) {\n            rewrite ^(.*)$ https://www.dx.com$1 permanent;\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\nserver { listen 80; server_name www.zzppjj.top zzppjj.top;\n\n    location ~* / {\n            rewrite ^(.*)$ https://www.zzppjj.top$1 permanent;\n    }\n\n\n1\n2\n3\n\n\n}\n\nserver {\n    listen 80;\n    server_name getpro-h5-business.goingf.hk getpro-php-business.goingf.hk;\n\n\n\n    location / {\n        rewrite ^ https://$http_host$request_uri? permanent;    # force redirect http to https\n        return 301 https://$http_host$request_uri;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\néå®åå°å¦å¤ä¸å°æå¡å¨ç¤ºä¾ï¼ï¼æ¥æ¾ç®å½ä¸æ¯å¦å­å¨æä»¶ï¼å¦æä¸å­å¨è½¬å°@new_uploadsä¸ï¼new_uploadså¯¹åºä»£çå°172.17.0.101ä¸ï¼\n\nlocation ^~ /uploads/ { root /data/weiwend/weiwang; try_files $uri @new_uploads; }\n\nlocation @new_uploads {\n    proxy_redirect off;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_pass http://172.17.0.101:80;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * å° /api/v1/game/data?id= æ°ç½ç«è·¯å¾å°åæ å°å° http://gameid.escape.com/api/v1/new_game/ èç½ç«ç API ä¸é¢ï¼ç»å¼åæä¾è·åæ¸¸æç¨æ·ä¿¡æ¯çæ¥å£\n\nserver { listen 80; server_name gameid.escape.com;\n\naccess_log /var/log/nginx/gameid.nginx.access.log  netdata;\nerror_log  /var/log/nginx/gameid.nginx.error.log   error;\n\nlocation / {\n    return 404;\n}\n\nlocation /api/v1/ {\n    proxy_pass_header Server;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Scheme $scheme;\n    proxy_http_version 1.1;\n    if ($request_uri ~* "/api/v1/game/data\\?id=(.*)") {\n        set $id $1;\n        rewrite .* /api/v1/new_game/$id break;\n        proxy_pass http://gameid.escape.com;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n}\n\n\n# èæç®å½\n\nlocation /media { alias /usr/share/nginx/html/media;\n}\n\n\n# nginxè·¨å\n\n     #æ¯å¦åè®¸è¯·æ±å¸¦æéªè¯ä¿¡æ¯\n     add_header Access-Control-Allow-Credentials true;\n     #åè®¸è·¨åè®¿é®çåå,å¯ä»¥æ¯ä¸ä¸ªåçåè¡¨ï¼ä¹å¯ä»¥æ¯ééç¬¦*\n     add_header Access-Control-Allow-Origin  $allow_url;\n     #åè®¸èæ¬è®¿é®çè¿åå¤´\n     add_header Access-Control-Allow-Headers \'x-requested-with,content-type,Cache-Control,Pragma,Date,x-timestamp\';\n     #åè®¸ä½¿ç¨çè¯·æ±æ¹æ³ï¼ä»¥éå·éå¼\n     add_header Access-Control-Allow-Methods \'POST,GET,OPTIONS,PUT,DELETE\';\n     #åè®¸èªå®ä¹çå¤´é¨ï¼ä»¥éå·éå¼,å¤§å°åä¸ææ\n     add_header Access-Control-Expose-Headers \'WWW-Authenticate,Server-Authorization\';\n     #P3Pæ¯æè·¨åcookieæä½\n     add_header P3P \'policyref="/w3c/p3p.xml", CP="NOI DSP PSAa OUR BUS IND ONL UNI COM NAV INT LOC"\';\n     add_header test  1;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\néæ±ä¸ºæµè§å¨è®¿é®Bçæ¶åè¦ç´æ¥æ¾ç¤ºAçä¸»é¡µï¼è¿æ ·å¯¹Aåä¸ä¸ªä»£çï¼æµè§å¨çURLè¿æ¯Bå¹¶ä¸æ¯éå®åå°Aã\n\nå¨Açnginxä¸­å å¥ä¸ä¸åå®¹\n\nlocation /api/ {\n\nadd_header Access-Control-Allow-Origin *;\n\nadd_header Access-Control-Allow-Credentials \'true\';\n\nadd_header Access-Control-Allow-Methods \'GET, POST, OPTIONS\';\n\nadd_header Access-Control-Allow-Headers \'Origin, X-Requested-With, Content-Type, Accept\';\n\nproxy_pass http://gateway_proxy/;\n\n\n# phpéç½®\n\nserver {\n        listen 80;\n        listen 8888;\n\n        server_name  api.erp.pdvee.com;\n\n        access_log /var/log/nginx/api.erp.pdvee.com.access.log site_log2;\n        error_log  /var/log/nginx/api.erp.pdvee.com.errors.log;\n\n        proxy_set_header Host $host;\n        proxy_set_header Real-IP $remote_addr;\n        proxy_set_header Region $geoip_country_code;\n        proxy_set_header X-Forwarded-For $remote_addr;\n\n        root /data/erp/website/erp.pdvee.com;\n        index index.php index.html index.htm;\n\n\n      keepalive_timeout 18000s;\n        client_body_timeout 18000s;\n        client_header_timeout 18000s;\n        proxy_connect_timeout 18000s;\n        proxy_send_timeout 18000s;\n        proxy_read_timeout 18000s;\n\n\n    fastcgi_connect_timeout 18000;\n    fastcgi_send_timeout 18000;\n    fastcgi_read_timeout 18000;\n    fastcgi_buffer_size 256k;\n    fastcgi_buffers 8 256k;\n    fastcgi_busy_buffers_size 256k;\n    fastcgi_temp_file_write_size 256k;\n    ##\n    client_max_body_size 2048m;        \n    client_body_buffer_size 256k;\n\n\n\n\n        location / {\n#        proxy_cache my_cache;\n#        proxy_cache_revalidate on;\n                concat on;\n                concat_max_files 100;\n                concat_unique off;\n#                concat_ignore_file_error on;\n            if (!-e $request_filename) {\n            rewrite ^(.*)$ /index.php?s=/$1 last;\n            break;\n           }\n\n        }\n\n        location ~ \\.php$ {\n            root /data/website/erp.pdvee.com;\n            index index.php;\n            fastcgi_pass   192.168.14.13:9001;\n            fastcgi_index  index.php;\n            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n            include        fastcgi_params;\n        }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n\n\nå¨å±åé\n\n$bytes_sent             åéç»å®¢æ·ç«¯çå­èæ°\n$connection             è¿æ¥åºåå·\n$connection_requests    å½åéè¿è¿æ¥ååºçè¯·æ±æ°é\n$content_length         âContent-Lengthâ è¯·æ±å¤´å­æ®µ\n$content_type           âContent-Typeâ è¯·æ±å¤´å­æ®µ\n$cookie_name            cookieåç§°\n$document_root          å½åè¯·æ±çææ¡£æ ¹ç®å½æå«å\n$uri                    è¯·æ±ä¸­çå½åURI(ä¸å¸¦è¯·æ±åæ°ï¼åæ°ä½äº$args)ï¼å¯ä»¥ä¸åäºæµè§å¨ä¼ éç$request_uriçå¼ï¼å®å¯ä»¥éè¿åé¨éå®åï¼æèä½¿ç¨indexæä»¤è¿è¡ä¿®æ¹ï¼$uriä¸åå«ä¸»æºåï¼å¦â/foo/bar.htmlâã\n$document_uri           å $uri\n$host                   ä¼åçº§å¦ä¸ï¼HTTPè¯·æ±è¡çä¸»æºå>âHOSTâè¯·æ±å¤´å­æ®µ>ç¬¦åè¯·æ±çæå¡å¨å\n$hostname               ä¸»æºå\n$http_name              å¹éä»»æè¯·æ±å¤´å­æ®µï¼ åéåä¸­çååé¨åânameâå¯ä»¥æ¿æ¢æä»»æè¯·æ±å¤´å­æ®µï¼å¦å¨éç½®æä»¶ä¸­éè¦è·åhttpè¯·æ±å¤´ï¼âAccept-Languageâï¼é£ä¹å°âï¼âæ¿æ¢ä¸ºä¸åçº¿ï¼å¤§åå­æ¯æ¿æ¢ä¸ºå°åï¼å½¢å¦ï¼$http_accept_languageå³å¯ã\n$https                  å¦æå¼å¯äºSSLå®å¨æ¨¡å¼ï¼å¼ä¸ºâonâï¼å¦åä¸ºç©ºå­ç¬¦ä¸²ã\n$is_args                å¦æè¯·æ±ä¸­æåæ°ï¼å¼ä¸ºâ?âï¼å¦åä¸ºç©ºå­ç¬¦ä¸²ã\n$limit_rate             ç¨äºè®¾ç½®ååºçéåº¦éå¶\n$nginx_version          nginxçæ¬\n$pid                    å·¥ä½è¿ç¨çPID\n$pipe                   å¦æè¯·æ±æ¥èªç®¡ééä¿¡ï¼å¼ä¸ºâpâï¼å¦åä¸ºâ.â (1.3.12, 1.2.7)\n$proxy_protocol_addr    è·åä»£çè®¿é®æå¡å¨çå®¢æ·ç«¯å°åï¼å¦ææ¯ç´æ¥è®¿é®ï¼è¯¥å¼ä¸ºç©ºå­ç¬¦ä¸²ã\n$realpath_root          å½åè¯·æ±çææ¡£æ ¹ç®å½æå«åççå®è·¯å¾ï¼ä¼å°ææç¬¦å·è¿æ¥è½¬æ¢ä¸ºçå®è·¯å¾ã\n$msec                   ä»¥ç§ä¸ºåä½çæ¶é´ï¼æ¥å¿åå¥æ¶çæ¯«ç§åè¾¨ç\n$request_length         è¯·æ±é¿åº¦ï¼åæ¬è¯·æ±è¡ï¼æ é¢åè¯·æ±ä¸»ä½ï¼\n$request_method         HTTPè¯·æ±æ¹æ³ï¼éå¸¸ä¸ºâGETâæâPOSTâ\n$request_time           å¤çå®¢æ·ç«¯è¯·æ±ä½¿ç¨çæ¶é´;ä»è¯»åå®¢æ·ç«¯çç¬¬ä¸ä¸ªå­èå¼å§è®¡æ¶ã\n$request_uri            è¿ä¸ªåéç­äºåå«ä¸äºå®¢æ·ç«¯è¯·æ±åæ°çåå§URIï¼å®æ æ³ä¿®æ¹ï¼è¯·æ¥ç$uriæ´æ¹æéåURIï¼ä¸åå«ä¸»æºåï¼ä¾å¦ï¼â/cnphp/test.php?arg=freemouseâã\n$request_time           ä»¥æ¯«ç§åè¾¨çè¯·æ±å¤çæ¶é´ï¼ä»¥ç§ä¸ºåä½; ä»å®¢æ·ç«¯è¯»åç¬¬ä¸ä¸ªå­èä¹é´çæ¶é´å¹¶å¨æåä¸ä¸ªå­èåéå°å®¢æ·ç«¯åè¿è¡æ¥å¿åå¥\n$status                 ååºç¶æç \n$time_local             æ¬å°æ¶é´éç¨éç¨æ¥å¿æ ¼å¼\n$arg_name               è¯·æ±ä¸­ççåæ°åï¼å³â?âåé¢çarg_name=arg_valueå½¢å¼çarg_name\n$args                   è¯·æ±ä¸­çåæ°å¼\n$binary_remote_addr     å®¢æ·ç«¯å°åçäºè¿å¶å½¢å¼, åºå®é¿åº¦ä¸º4ä¸ªå­è\n$body_bytes_sent        ä¼ è¾ç»å®¢æ·ç«¯çå­èæ°ï¼ååºå¤´ä¸è®¡ç®å¨åï¼è¿ä¸ªåéåApacheçmod_log_configæ¨¡åä¸­çâ%Bâåæ°ä¿æå¼å®¹\n$remote_addr            å®¢æ·ç«¯å°å\n$remote_port            å®¢æ·ç«¯ç«¯å£\n$remote_user            ç¨äºHTTPåºç¡è®¤è¯æå¡çç¨æ·å\n$request                å®¢æ·ç«¯è¯·æ±å°å\n$request_body           å®¢æ·ç«¯çè¯·æ±ä¸»ä½ï¼æ­¤åéå¯å¨locationä¸­ä½¿ç¨ï¼å°è¯·æ±ä¸»ä½éè¿proxy_pass, fastcgi_pass, uwsgi_pass, å scgi_passä¼ éç»ä¸ä¸çº§çä»£çæå¡å¨ã\n$request_body_file      å°å®¢æ·ç«¯è¯·æ±ä¸»ä½ä¿å­å¨ä¸´æ¶æä»¶ä¸­ãæä»¶å¤çç»æåï¼æ­¤æä»¶éå é¤ãå¦æéè¦ä¹ä¸å¼å¯æ­¤åè½ï¼éè¦è®¾ç½®client_body_in_file_onlyãå¦æå°æ¬¡æä»¶ä¼ éç»åç«¯çä»£çæå¡å¨ï¼éè¦ç¦ç¨request bodyï¼å³è®¾ç½®proxy_pass_request_body offï¼fastcgi_pass_request_body off, uwsgi_pass_request_body off, or scgi_pass_request_body off ã\n$request_completion     å¦æè¯·æ±æåï¼å¼ä¸ºâOKâï¼å¦æè¯·æ±æªå®ææèè¯·æ±ä¸æ¯ä¸ä¸ªèå´è¯·æ±çæåä¸é¨åï¼åä¸ºç©ºã\n$request_filename       å½åè¿æ¥è¯·æ±çæä»¶è·¯å¾ï¼ç±rootæaliasæä»¤ä¸URIè¯·æ±çæã\n$scheme                 è¯·æ±ä½¿ç¨çWebåè®®, âhttpâ æ âhttpsâ\n$sent_http_name         å¯ä»¥è®¾ç½®ä»»æhttpååºå¤´å­æ®µï¼ åéåä¸­çååé¨åânameâå¯ä»¥æ¿æ¢æä»»æååºå¤´å­æ®µï¼å¦éè¦è®¾ç½®ååºå¤´Content-lengthï¼é£ä¹å°âï¼âæ¿æ¢ä¸ºä¸åçº¿ï¼å¤§åå­æ¯æ¿æ¢ä¸ºå°åï¼å½¢å¦ï¼$sent_http_content_length 4096å³å¯ã\n$server_addr            æå¡å¨ç«¯å°åï¼éè¦æ³¨æçæ¯ï¼ä¸ºäºé¿åè®¿é®linuxç³»ç»åæ ¸ï¼åºå°ipå°åæåè®¾ç½®å¨éç½®æä»¶ä¸­ã\n$server_name            æå¡å¨åï¼åå\n$server_port            æå¡å¨ç«¯å£\n$server_protocol        æå¡å¨çHTTPçæ¬, éå¸¸ä¸º âHTTP/1.0â æ âHTTP/1.1â\n$tcpinfo_rtt, $tcpinfo_rttvar, $tcpinfo_snd_cwnd, $tcpinfo_rcv_space å®¢æ·ç«¯TCPè¿æ¥çå·ä½ä¿¡æ¯\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n############\n\nnginxä¸­$hostã$http_hostå$proxy_hoståºå«\n$host    ä¸æ¾ç¤ºç«¯å£       æµè§å¨è¯·æ±çipï¼ä¸æ¾ç¤ºç«¯å£\n$http_host ç«¯å£å­å¨åæ¾ç¤º        æµè§å¨è¯·æ±çipåç«¯å£å·\n$proxy_host    é»è®¤80ç«¯å£ä¸æ¾ç¤ºï¼å¶å®æ¾ç¤º    è¢«ä»£çæå¡çipåç«¯å£å·\n\n\n1\n2\n3\n4\n\n\n\n# é²æ­¢ååæ¶æè§£æ\n\nserver {\n\nlisten 80 default_server;\n\nserver_name _;\n\nreturn 404;\n\n}\n\nserver { listen 443 default_server; server_name _; ssl on; return 444; }\n\nå¤§æ¦è§£éå¦ä¸:\n\ndefault_serverï¼é»è®¤ååéç½®ï¼å¦ææ¾ä¸å°ï¼ä¼èªå¨å¹é\n\nserver_name _: æ æååå¹é\n\nreturn 444: éæ åç¶æç ï¼æ¯Nginxæå¡å¨æ©å±çHttpéè¯¯ç¶æç ï¼æå¡å¨ä¸åå®¢æ·ç«¯è¿åä»»ä½ä¿¡æ¯ï¼å¹¶å³é­è¿æ¥, æ­å¼å®¢æ·ç«¯åæå¡å¨çè¿æ¥ï¼é²æ­¢æ¶æè½¯ä»¶æ»å»å¨è\n\nä¸ãéç½®ä¸é¢å°ä¸»éç½®æä»¶åã\n\néå¯å¨nginx ï¼å°±ä¼ä¸ºæä»¬å±è½æ¶æè®¿é®äºã\n\n\n# ç½ç«ç½®ç°\n\nsub_filter  \'</head>\'  \'<style type="text/css">html {-webkit-filter: grayscale(.95);}</style></head>\';\n    sub_filter_once on; \n\n\n1\n2\n',normalizedContent:'# èæä¸»æº\n\nèæä¸»æºçä¸ç§æ¹å¼ï¼åºäºç«¯å£ãipå°åãåå\n\nserver {\n\nlisten 80;\n\nserver_name www.accp.com;\n\ncharset utf-8;\n\naccess_log logs/www.accp.com.access.log;\n\nlocation / {\n\nroot /var/www/html/accp;\n\nindex index.html index.htm;\n\n}\n\nerror_page 500 502 503 504 /50x.html;\n\nlocation = /50x.html {\n\nroot html;\n\n}\n\n}\n\n\n# nginxè´è½½åè¡¡\n\nupstream cluster {\n\nip_hash; #å¦æä½ çç³»ç»ä¸­æ²¡æä½¿ç¨ç¬¬ä¸æ¹ç¼å­ç®¡çå·¥å· ,å»ºè®®ä½¿ç¨æ­¤æ¹å¼\n\nserver 192.168.1.210:80 weight=5;\n\nserver 192.168.1.211:80 weight=3;\n\nserver 192.168.1.212:80 weight=1;\n\n}\n\nupstream dxtreasureisland_http { server dal05iis39.sl.dx weight=1 max_fails=1 fail_timeout=45s; server iis01.zl.dx:8093 weight=1 max_fails=1 fail_timeout=45s; }\n\n\n# ååä»£ç\n\nâ location / {\nâ proxy_pass http://localhost:8000/;\nâ proxy_redirect off;\nâ proxy_set_header host $http_host;\nâ proxy_set_header x-real-ip $remote_addr;\nâ proxy_set_header x-forwarded-for $proxy_add_x_forwarded_for;\nâ location / {\nâ proxy_pass http://172.18.184.130:10085;\nâ proxy_set_header host $host;\nâ proxy_set_header x-real-ip $remote_addr;\nâ proxy_redirect http:// $scheme://; #ä»¥ä¸æä»¤ä¼å°åç«¯ååºheader locationåå®¹ä¸­çhttp://æ¿æ¢æç¨æ·ç«¯åè®®https://\nâ proxy_set_header x-forwarded-for $proxy_add_x_forwarded_for;\n\nâ }\n\nlocation / {\n\nproxy_pass http://baidunode;\n\nproxy_set_header x-forwarded-proto $scheme;\nproxy_set_header host $host; #http header ä¸­ç host å«ä¹ä¸ºæè¯·æ±çç®çä¸»æºåãå½ nginx ä½ä¸ºååä»£çä½¿ç¨ï¼èåç«¯çå® web æå¡å¨è®¾ç½®æç±»ä¼¼ é²çé¾åè½\n\nproxy_set_header x-forwarded-for $proxy_add_x_forwarded_for; #http header ä¸­ç x_forward_for è¡¨ç¤ºè¯¥æ¡ http è¯·æ±æ¯ç±è°åèµ·ç\n\nproxy_set_header x-real-ip $remote_addr;\n proxy_redirect off;\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\nå¸¸ç¨çä»£ç\n\n    location / {\n        proxy_pass         http://localhost:8000/;\n        proxy_set_header   host             $http_host;\n        proxy_set_header   x-real-ip        $remote_addr;\n        proxy_set_header   x-forwarded-for  $proxy_add_x_forwarded_for;\n        proxy_set_header x-forwarded-proto $scheme;\n    }\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nproxy_redirectçä½ç¨\n\nproxy_redirect è¯¥æä»¤ç¨æ¥ä¿®æ¹è¢«ä»£çæå¡å¨è¿åçååºå¤´ä¸­çlocationå¤´ååârefreshâå¤´åã\n\n>  1. proxy_redirect æ§å°å æ°å°å;\n> \n>  2. proxy_redirect default; #é»è®¤éç½®\n> \n>  3. proxy_redirect off; #å³é­éå®å\n\n\n# locationè§å\n\néç½®location /wandouå¯ä»¥å¹é/wandoudouduoè¯·æ±ï¼ä¹å¯ä»¥å¹é/wandou*/duoduoç­ç­ï¼åªè¦ä»¥wandouå¼å¤´çç®å½é½å¯ä»¥å¹éå°ãèlocation /wandou/å¿é¡»ç²¾ç¡®å¹é/wandou/è¿ä¸ªç®å½çè¯·æ±,ä¸è½å¹é/wandouduoduo/æ/wandou*/duoduoç­è¯·æ±ã\n\nç¬¬ä¸ç§ï¼å "/" location /wddd/ { proxy_pass http://127.0.0.1:8080/; } æµè¯ç»æï¼è¯·æ±è¢«ä»£çè·³è½¬å°ï¼http://127.0.0.1:8080/index.html ç¬¬äºç§: ä¸å "/" location /wddd/ {\nproxy_pass http://127.0.0.1:8080; } æµè¯ç»æï¼è¯·æ±è¢«ä»£çè·³è½¬å°ï¼http://127.0.0.1:8080/wddd/index.html ç¬¬ä¸ç§: å¢å ç®å½å "/" location /wddd/ {\nproxy_pass http://127.0.0.1:8080/sun/; } æµè¯ç»æï¼è¯·æ±è¢«ä»£çè·³è½¬å°ï¼http://127.0.0.1:8080/sun/index.html ç¬¬åç§ï¼å¢å ç®å½ä¸å "/" location /wddd/ { proxy_pass http://127.0.0.1:8080/sun; } æµè¯ç»æï¼è¯·æ±è¢«ä»£çè·³è½¬å°ï¼http://127.0.0.1:8080/sun/index.html æ»ç» locationç®å½åå "/",åªè½å¹éç®å½ï¼ä¸å â/âä¸ä»å¯ä»¥å¹éç®å½è¿å¯¹ç®å½è¿è¡æ¨¡ç³å¹éãèproxy_passæ è®ºå ä¸å â/â,ä»£çè·³è½¬å°åé½ç´æ¥æ¼æ¥\n\nç¬¦å·   è¯´æ\n~    æ­£åå¹éï¼åºåå¤§å°å\n~*   æ­£åå¹éï¼ä¸åºåå¤§å°å\n^~   æ®éå­ç¬¦å¹éï¼å¦æè¯¥éé¡¹å¹éï¼åï¼åªå¹éæ¹éé¡¹ï¼ä¸ååä¸å¹éå¶ä»éé¡¹\n=    æ®éå­ç¬¦å¹éï¼ç²¾ç¡®å¹é\n@    å®ä¹ä¸ä¸ªå½åç locationï¼ç¨äºåé¨å®åï¼ä¾å¦ error_pageï¼try_files\n\nç¬¦å·@ä½¿ç¨ä¾å­\n\nserver {\n    listen 80;\n    client_max_body_size 100m;\n    keepalive_timeout 5;\n    root /app/static;\n    location /backend {\n    rewrite ^/backend/(.*) /$1 break;\n    try_files $uri @proxy_to_app;\n    }\n    location / {\n    try_files $uri @proxy_to_app;\n    }\n    location @proxy_to_spp {\n        proxy_set_header x-forwarded-proto $scheme;\n        proxy_set_header x-forwarded-for $proxy_add_x_forwarded_for;\n        proxy_set_header host $http_host;\n        proxy_set_header   x-real-ip        $remote_addr;\n        proxy_redirect off;\n        proxy_pass http://app_server;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nnginxç¦æ­¢ãåè®¸è®¿é®æäºåç¼çæä»¶ location ~* .(ini|cfg|dwt|lbi)$ {\ndeny all;\n}\n\n\n# è¯ä¹¦\n\nssl_certificate /etc/ssl/private/.crt; ssl_certificate_key /etc/ssl/private/.key; ssl_session_timeout 5m; ssl_protocols tlsv1 tlsv1.1 tlsv1.2; ssl_ciphers high:!adh:!anull:!enull:!md5:!dss:!dh:!rc4; ssl_prefer_server_ciphers on;\n\nserver {\n    listen 443;\n    listen 80;\n    server_name m.goldmanfutures.com;\n    ssl on;\n    ssl_certificate      /etc/nginx/cert/m.goldmanfutures.com/m.goldmanfutures.com_chain.crt;\n    ssl_certificate_key  /etc/nginx/cert/m.goldmanfutures.com/m.goldmanfutures.com_key.key;\n    proxy_ssl_session_reuse   off;\n    ssl_session_cache         shared:ssl:1m;\n    ssl_session_timeout       5m;\n    ssl_ciphers               ecdhe-rsa-aes128-gcm-sha256:ecdhe:ecdh:aes:high:!null:!anull:!md5:!adh:!rc4;\n    ssl_protocols             tlsv1 tlsv1.1 tlsv1.2;\n    ssl_prefer_server_ciphers on;\n    client_max_body_size 1g;\n    client_body_buffer_size 1m;\n        if ($scheme = http) {\n                rewrite ^(.*)$ https://m.goldmanfutures.com$1 permanent;\n        }\n\n\n    index   index.html index.htm index.php;\n    location / {\n        proxy_pass   http://172.31.186.20:10584/;\n        proxy_set_header host      $host;\n        proxy_set_header x-real-ip $remote_addr;\n        proxy_set_header x-forwarded-proto $scheme;\n        proxy_set_header x-forwarded-for $proxy_add_x_forwarded_for;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\n\n# æ¥å¿\n\nâ access_log /var/log/nginx/jenkins.dx.com.access.log;\nâ error_log /var/log/nginx/jenkins.dx.com.errors.log;\nâ\n\nlog_format main \'$remote_addr - $remote_user [$time_local] "$request" \'\n \'$status $body_bytes_sent "$http_referer" \'\n \'"$http_user_agent" "$http_x_forwarded_for"\';\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n\n# phpéç½®\n\nâ location ~ \\.php$ {\nâ root /data/erp5/website/erp5.pdvee.com/public;\nâ index index.php;\nâ fastcgi_pass 192.168.14.20:9005;\nâ fastcgi_index index.php;\nâ fastcgi_param script_filename $document_root$fastcgi_script_name;\nâ include fastcgi_params;\nâ }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# æ¨¡å\n\nconcatæ¨¡åï¼nginx concatéè¿åå¹¶éææä»¶æ¥åå°httpè¯·æ±æ°æ¥è¾¾å°ä¼ååç«¯æ§è½ï¼å¯ä»¥å¨ä¸å®ç¨åº¦ä¸è½åå°webæå¡å¨çååã\n\nlocation / {\n concat on;\n concat_max_files 100;\n concat_unique off;\n concat_ignore_file_error on;\n if (!-e $request_filename) {\n rewrite ^(.*)$ /index.php?s=/$1 last;\n break;\n }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# è·³è½¬ãéå®å\n\nâ if ($host ~ ^www\\.dealextreme.com\\.com$) {\nâ rewrite ^(.*)$ $scheme://www.dx.com permanent;\nâ }\nif ($scheme = http) {\n            rewrite ^(.*)$ https://www.dx.com$1 permanent;\n    }\n\n\n1\n2\n3\n4\n5\n6\n\n\nserver { listen 80; server_name www.zzppjj.top zzppjj.top;\n\n    location ~* / {\n            rewrite ^(.*)$ https://www.zzppjj.top$1 permanent;\n    }\n\n\n1\n2\n3\n\n\n}\n\nserver {\n    listen 80;\n    server_name getpro-h5-business.goingf.hk getpro-php-business.goingf.hk;\n\n\n\n    location / {\n        rewrite ^ https://$http_host$request_uri? permanent;    # force redirect http to https\n        return 301 https://$http_host$request_uri;\n    }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\néå®åå°å¦å¤ä¸å°æå¡å¨ç¤ºä¾ï¼ï¼æ¥æ¾ç®å½ä¸æ¯å¦å­å¨æä»¶ï¼å¦æä¸å­å¨è½¬å°@new_uploadsä¸ï¼new_uploadså¯¹åºä»£çå°172.17.0.101ä¸ï¼\n\nlocation ^~ /uploads/ { root /data/weiwend/weiwang; try_files $uri @new_uploads; }\n\nlocation @new_uploads {\n    proxy_redirect off;\n    proxy_set_header host $host;\n    proxy_set_header x-real-ip $remote_addr;\n    proxy_set_header x-forwarded-for $proxy_add_x_forwarded_for;\n    proxy_pass http://172.17.0.101:80;\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n * å° /api/v1/game/data?id= æ°ç½ç«è·¯å¾å°åæ å°å° http://gameid.escape.com/api/v1/new_game/ èç½ç«ç api ä¸é¢ï¼ç»å¼åæä¾è·åæ¸¸æç¨æ·ä¿¡æ¯çæ¥å£\n\nserver { listen 80; server_name gameid.escape.com;\n\naccess_log /var/log/nginx/gameid.nginx.access.log  netdata;\nerror_log  /var/log/nginx/gameid.nginx.error.log   error;\n\nlocation / {\n    return 404;\n}\n\nlocation /api/v1/ {\n    proxy_pass_header server;\n    proxy_set_header host $http_host;\n    proxy_set_header x-real-ip $remote_addr;\n    proxy_set_header x-scheme $scheme;\n    proxy_http_version 1.1;\n    if ($request_uri ~* "/api/v1/game/data\\?id=(.*)") {\n        set $id $1;\n        rewrite .* /api/v1/new_game/$id break;\n        proxy_pass http://gameid.escape.com;\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n}\n\n\n# èæç®å½\n\nlocation /media { alias /usr/share/nginx/html/media;\n}\n\n\n# nginxè·¨å\n\n     #æ¯å¦åè®¸è¯·æ±å¸¦æéªè¯ä¿¡æ¯\n     add_header access-control-allow-credentials true;\n     #åè®¸è·¨åè®¿é®çåå,å¯ä»¥æ¯ä¸ä¸ªåçåè¡¨ï¼ä¹å¯ä»¥æ¯ééç¬¦*\n     add_header access-control-allow-origin  $allow_url;\n     #åè®¸èæ¬è®¿é®çè¿åå¤´\n     add_header access-control-allow-headers \'x-requested-with,content-type,cache-control,pragma,date,x-timestamp\';\n     #åè®¸ä½¿ç¨çè¯·æ±æ¹æ³ï¼ä»¥éå·éå¼\n     add_header access-control-allow-methods \'post,get,options,put,delete\';\n     #åè®¸èªå®ä¹çå¤´é¨ï¼ä»¥éå·éå¼,å¤§å°åä¸ææ\n     add_header access-control-expose-headers \'www-authenticate,server-authorization\';\n     #p3pæ¯æè·¨åcookieæä½\n     add_header p3p \'policyref="/w3c/p3p.xml", cp="noi dsp psaa our bus ind onl uni com nav int loc"\';\n     add_header test  1;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\néæ±ä¸ºæµè§å¨è®¿é®bçæ¶åè¦ç´æ¥æ¾ç¤ºaçä¸»é¡µï¼è¿æ ·å¯¹aåä¸ä¸ªä»£çï¼æµè§å¨çurlè¿æ¯bå¹¶ä¸æ¯éå®åå°aã\n\nå¨açnginxä¸­å å¥ä¸ä¸åå®¹\n\nlocation /api/ {\n\nadd_header access-control-allow-origin *;\n\nadd_header access-control-allow-credentials \'true\';\n\nadd_header access-control-allow-methods \'get, post, options\';\n\nadd_header access-control-allow-headers \'origin, x-requested-with, content-type, accept\';\n\nproxy_pass http://gateway_proxy/;\n\n\n# phpéç½®\n\nserver {\n        listen 80;\n        listen 8888;\n\n        server_name  api.erp.pdvee.com;\n\n        access_log /var/log/nginx/api.erp.pdvee.com.access.log site_log2;\n        error_log  /var/log/nginx/api.erp.pdvee.com.errors.log;\n\n        proxy_set_header host $host;\n        proxy_set_header real-ip $remote_addr;\n        proxy_set_header region $geoip_country_code;\n        proxy_set_header x-forwarded-for $remote_addr;\n\n        root /data/erp/website/erp.pdvee.com;\n        index index.php index.html index.htm;\n\n\n      keepalive_timeout 18000s;\n        client_body_timeout 18000s;\n        client_header_timeout 18000s;\n        proxy_connect_timeout 18000s;\n        proxy_send_timeout 18000s;\n        proxy_read_timeout 18000s;\n\n\n    fastcgi_connect_timeout 18000;\n    fastcgi_send_timeout 18000;\n    fastcgi_read_timeout 18000;\n    fastcgi_buffer_size 256k;\n    fastcgi_buffers 8 256k;\n    fastcgi_busy_buffers_size 256k;\n    fastcgi_temp_file_write_size 256k;\n    ##\n    client_max_body_size 2048m;        \n    client_body_buffer_size 256k;\n\n\n\n\n        location / {\n#        proxy_cache my_cache;\n#        proxy_cache_revalidate on;\n                concat on;\n                concat_max_files 100;\n                concat_unique off;\n#                concat_ignore_file_error on;\n            if (!-e $request_filename) {\n            rewrite ^(.*)$ /index.php?s=/$1 last;\n            break;\n           }\n\n        }\n\n        location ~ \\.php$ {\n            root /data/website/erp.pdvee.com;\n            index index.php;\n            fastcgi_pass   192.168.14.13:9001;\n            fastcgi_index  index.php;\n            fastcgi_param  script_filename  $document_root$fastcgi_script_name;\n            include        fastcgi_params;\n        }\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n\n\nå¨å±åé\n\n$bytes_sent             åéç»å®¢æ·ç«¯çå­èæ°\n$connection             è¿æ¥åºåå·\n$connection_requests    å½åéè¿è¿æ¥ååºçè¯·æ±æ°é\n$content_length         âcontent-lengthâ è¯·æ±å¤´å­æ®µ\n$content_type           âcontent-typeâ è¯·æ±å¤´å­æ®µ\n$cookie_name            cookieåç§°\n$document_root          å½åè¯·æ±çææ¡£æ ¹ç®å½æå«å\n$uri                    è¯·æ±ä¸­çå½åuri(ä¸å¸¦è¯·æ±åæ°ï¼åæ°ä½äº$args)ï¼å¯ä»¥ä¸åäºæµè§å¨ä¼ éç$request_uriçå¼ï¼å®å¯ä»¥éè¿åé¨éå®åï¼æèä½¿ç¨indexæä»¤è¿è¡ä¿®æ¹ï¼$uriä¸åå«ä¸»æºåï¼å¦â/foo/bar.htmlâã\n$document_uri           å $uri\n$host                   ä¼åçº§å¦ä¸ï¼httpè¯·æ±è¡çä¸»æºå>âhostâè¯·æ±å¤´å­æ®µ>ç¬¦åè¯·æ±çæå¡å¨å\n$hostname               ä¸»æºå\n$http_name              å¹éä»»æè¯·æ±å¤´å­æ®µï¼ åéåä¸­çååé¨åânameâå¯ä»¥æ¿æ¢æä»»æè¯·æ±å¤´å­æ®µï¼å¦å¨éç½®æä»¶ä¸­éè¦è·åhttpè¯·æ±å¤´ï¼âaccept-languageâï¼é£ä¹å°âï¼âæ¿æ¢ä¸ºä¸åçº¿ï¼å¤§åå­æ¯æ¿æ¢ä¸ºå°åï¼å½¢å¦ï¼$http_accept_languageå³å¯ã\n$https                  å¦æå¼å¯äºsslå®å¨æ¨¡å¼ï¼å¼ä¸ºâonâï¼å¦åä¸ºç©ºå­ç¬¦ä¸²ã\n$is_args                å¦æè¯·æ±ä¸­æåæ°ï¼å¼ä¸ºâ?âï¼å¦åä¸ºç©ºå­ç¬¦ä¸²ã\n$limit_rate             ç¨äºè®¾ç½®ååºçéåº¦éå¶\n$nginx_version          nginxçæ¬\n$pid                    å·¥ä½è¿ç¨çpid\n$pipe                   å¦æè¯·æ±æ¥èªç®¡ééä¿¡ï¼å¼ä¸ºâpâï¼å¦åä¸ºâ.â (1.3.12, 1.2.7)\n$proxy_protocol_addr    è·åä»£çè®¿é®æå¡å¨çå®¢æ·ç«¯å°åï¼å¦ææ¯ç´æ¥è®¿é®ï¼è¯¥å¼ä¸ºç©ºå­ç¬¦ä¸²ã\n$realpath_root          å½åè¯·æ±çææ¡£æ ¹ç®å½æå«åççå®è·¯å¾ï¼ä¼å°ææç¬¦å·è¿æ¥è½¬æ¢ä¸ºçå®è·¯å¾ã\n$msec                   ä»¥ç§ä¸ºåä½çæ¶é´ï¼æ¥å¿åå¥æ¶çæ¯«ç§åè¾¨ç\n$request_length         è¯·æ±é¿åº¦ï¼åæ¬è¯·æ±è¡ï¼æ é¢åè¯·æ±ä¸»ä½ï¼\n$request_method         httpè¯·æ±æ¹æ³ï¼éå¸¸ä¸ºâgetâæâpostâ\n$request_time           å¤çå®¢æ·ç«¯è¯·æ±ä½¿ç¨çæ¶é´;ä»è¯»åå®¢æ·ç«¯çç¬¬ä¸ä¸ªå­èå¼å§è®¡æ¶ã\n$request_uri            è¿ä¸ªåéç­äºåå«ä¸äºå®¢æ·ç«¯è¯·æ±åæ°çåå§uriï¼å®æ æ³ä¿®æ¹ï¼è¯·æ¥ç$uriæ´æ¹æéåuriï¼ä¸åå«ä¸»æºåï¼ä¾å¦ï¼â/cnphp/test.php?arg=freemouseâã\n$request_time           ä»¥æ¯«ç§åè¾¨çè¯·æ±å¤çæ¶é´ï¼ä»¥ç§ä¸ºåä½; ä»å®¢æ·ç«¯è¯»åç¬¬ä¸ä¸ªå­èä¹é´çæ¶é´å¹¶å¨æåä¸ä¸ªå­èåéå°å®¢æ·ç«¯åè¿è¡æ¥å¿åå¥\n$status                 ååºç¶æç \n$time_local             æ¬å°æ¶é´éç¨éç¨æ¥å¿æ ¼å¼\n$arg_name               è¯·æ±ä¸­ççåæ°åï¼å³â?âåé¢çarg_name=arg_valueå½¢å¼çarg_name\n$args                   è¯·æ±ä¸­çåæ°å¼\n$binary_remote_addr     å®¢æ·ç«¯å°åçäºè¿å¶å½¢å¼, åºå®é¿åº¦ä¸º4ä¸ªå­è\n$body_bytes_sent        ä¼ è¾ç»å®¢æ·ç«¯çå­èæ°ï¼ååºå¤´ä¸è®¡ç®å¨åï¼è¿ä¸ªåéåapacheçmod_log_configæ¨¡åä¸­çâ%bâåæ°ä¿æå¼å®¹\n$remote_addr            å®¢æ·ç«¯å°å\n$remote_port            å®¢æ·ç«¯ç«¯å£\n$remote_user            ç¨äºhttpåºç¡è®¤è¯æå¡çç¨æ·å\n$request                å®¢æ·ç«¯è¯·æ±å°å\n$request_body           å®¢æ·ç«¯çè¯·æ±ä¸»ä½ï¼æ­¤åéå¯å¨locationä¸­ä½¿ç¨ï¼å°è¯·æ±ä¸»ä½éè¿proxy_pass, fastcgi_pass, uwsgi_pass, å scgi_passä¼ éç»ä¸ä¸çº§çä»£çæå¡å¨ã\n$request_body_file      å°å®¢æ·ç«¯è¯·æ±ä¸»ä½ä¿å­å¨ä¸´æ¶æä»¶ä¸­ãæä»¶å¤çç»æåï¼æ­¤æä»¶éå é¤ãå¦æéè¦ä¹ä¸å¼å¯æ­¤åè½ï¼éè¦è®¾ç½®client_body_in_file_onlyãå¦æå°æ¬¡æä»¶ä¼ éç»åç«¯çä»£çæå¡å¨ï¼éè¦ç¦ç¨request bodyï¼å³è®¾ç½®proxy_pass_request_body offï¼fastcgi_pass_request_body off, uwsgi_pass_request_body off, or scgi_pass_request_body off ã\n$request_completion     å¦æè¯·æ±æåï¼å¼ä¸ºâokâï¼å¦æè¯·æ±æªå®ææèè¯·æ±ä¸æ¯ä¸ä¸ªèå´è¯·æ±çæåä¸é¨åï¼åä¸ºç©ºã\n$request_filename       å½åè¿æ¥è¯·æ±çæä»¶è·¯å¾ï¼ç±rootæaliasæä»¤ä¸uriè¯·æ±çæã\n$scheme                 è¯·æ±ä½¿ç¨çwebåè®®, âhttpâ æ âhttpsâ\n$sent_http_name         å¯ä»¥è®¾ç½®ä»»æhttpååºå¤´å­æ®µï¼ åéåä¸­çååé¨åânameâå¯ä»¥æ¿æ¢æä»»æååºå¤´å­æ®µï¼å¦éè¦è®¾ç½®ååºå¤´content-lengthï¼é£ä¹å°âï¼âæ¿æ¢ä¸ºä¸åçº¿ï¼å¤§åå­æ¯æ¿æ¢ä¸ºå°åï¼å½¢å¦ï¼$sent_http_content_length 4096å³å¯ã\n$server_addr            æå¡å¨ç«¯å°åï¼éè¦æ³¨æçæ¯ï¼ä¸ºäºé¿åè®¿é®linuxç³»ç»åæ ¸ï¼åºå°ipå°åæåè®¾ç½®å¨éç½®æä»¶ä¸­ã\n$server_name            æå¡å¨åï¼åå\n$server_port            æå¡å¨ç«¯å£\n$server_protocol        æå¡å¨çhttpçæ¬, éå¸¸ä¸º âhttp/1.0â æ âhttp/1.1â\n$tcpinfo_rtt, $tcpinfo_rttvar, $tcpinfo_snd_cwnd, $tcpinfo_rcv_space å®¢æ·ç«¯tcpè¿æ¥çå·ä½ä¿¡æ¯\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n############\n\nnginxä¸­$hostã$http_hostå$proxy_hoståºå«\n$host    ä¸æ¾ç¤ºç«¯å£       æµè§å¨è¯·æ±çipï¼ä¸æ¾ç¤ºç«¯å£\n$http_host ç«¯å£å­å¨åæ¾ç¤º        æµè§å¨è¯·æ±çipåç«¯å£å·\n$proxy_host    é»è®¤80ç«¯å£ä¸æ¾ç¤ºï¼å¶å®æ¾ç¤º    è¢«ä»£çæå¡çipåç«¯å£å·\n\n\n1\n2\n3\n4\n\n\n\n# é²æ­¢ååæ¶æè§£æ\n\nserver {\n\nlisten 80 default_server;\n\nserver_name _;\n\nreturn 404;\n\n}\n\nserver { listen 443 default_server; server_name _; ssl on; return 444; }\n\nå¤§æ¦è§£éå¦ä¸:\n\ndefault_serverï¼é»è®¤ååéç½®ï¼å¦ææ¾ä¸å°ï¼ä¼èªå¨å¹é\n\nserver_name _: æ æååå¹é\n\nreturn 444: éæ åç¶æç ï¼æ¯nginxæå¡å¨æ©å±çhttpéè¯¯ç¶æç ï¼æå¡å¨ä¸åå®¢æ·ç«¯è¿åä»»ä½ä¿¡æ¯ï¼å¹¶å³é­è¿æ¥, æ­å¼å®¢æ·ç«¯åæå¡å¨çè¿æ¥ï¼é²æ­¢æ¶æè½¯ä»¶æ»å»å¨è\n\nä¸ãéç½®ä¸é¢å°ä¸»éç½®æä»¶åã\n\néå¯å¨nginx ï¼å°±ä¼ä¸ºæä»¬å±è½æ¶æè®¿é®äºã\n\n\n# ç½ç«ç½®ç°\n\nsub_filter  \'</head>\'  \'<style type="text/css">html {-webkit-filter: grayscale(.95);}</style></head>\';\n    sub_filter_once on; \n\n\n1\n2\n',charsets:{cjk:!0}},{title:"kafkaä»ç»åå¸¸è§æä½",frontmatter:{title:"kafkaä»ç»åå¸¸è§æä½",date:"2023-02-23T09:16:02.000Z",permalink:"/pages/98b071/",categories:["è¿ç»´","ä¸­é´ä»¶","kafka"],tags:[null],readingShow:"top",description:"RabbitMQï¼ç¨äºå®æ¶çï¼å¯¹å¯é æ§è¦æ±è¾é«çæ¶æ¯ä¼ éä¸ã",meta:[{name:"twitter:title",content:"kafkaä»ç»åå¸¸è§æä½"},{name:"twitter:description",content:"RabbitMQï¼ç¨äºå®æ¶çï¼å¯¹å¯é æ§è¦æ±è¾é«çæ¶æ¯ä¼ éä¸ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/02.kafka/01.kafka%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C.html"},{property:"og:type",content:"article"},{property:"og:title",content:"kafkaä»ç»åå¸¸è§æä½"},{property:"og:description",content:"RabbitMQï¼ç¨äºå®æ¶çï¼å¯¹å¯é æ§è¦æ±è¾é«çæ¶æ¯ä¼ éä¸ã"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/02.kafka/01.kafka%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-23T09:16:02.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"kafkaä»ç»åå¸¸è§æä½"},{itemprop:"description",content:"RabbitMQï¼ç¨äºå®æ¶çï¼å¯¹å¯é æ§è¦æ±è¾é«çæ¶æ¯ä¼ éä¸ã"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/02.kafka/01.kafka%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C.html",relativePath:"04.è¿ç»´/03.ä¸­é´ä»¶/02.kafka/01.kafkaä»ç»åå¸¸è§æä½.md",key:"v-38030407",path:"/pages/98b071/",headers:[{level:2,title:"1.åºç¨åºæ¯æ¹é¢",slug:"_1-åºç¨åºæ¯æ¹é¢",normalizedTitle:"1.åºç¨åºæ¯æ¹é¢",charIndex:2},{level:2,title:"2.æ¶ææ¨¡åæ¹é¢",slug:"_2-æ¶ææ¨¡åæ¹é¢",normalizedTitle:"2.æ¶ææ¨¡åæ¹é¢",charIndex:78},{level:2,title:"3.ååéæ¹é¢",slug:"_3-ååéæ¹é¢",normalizedTitle:"3.ååéæ¹é¢",charIndex:176},{level:2,title:"4.éç¾¤è´è½½åè¡¡æ¹é¢",slug:"_4-éç¾¤è´è½½åè¡¡æ¹é¢",normalizedTitle:"4.éç¾¤è´è½½åè¡¡æ¹é¢",charIndex:305},{level:2,title:"5.kafkaå¸¸è§æä½",slug:"_5-kafkaå¸¸è§æä½",normalizedTitle:"5.kafkaå¸¸è§æä½",charIndex:2143}],headersStr:"1.åºç¨åºæ¯æ¹é¢ 2.æ¶ææ¨¡åæ¹é¢ 3.ååéæ¹é¢ 4.éç¾¤è´è½½åè¡¡æ¹é¢ 5.kafkaå¸¸è§æä½",content:"# 1.åºç¨åºæ¯æ¹é¢\n\nRabbitMQï¼ç¨äºå®æ¶çï¼å¯¹å¯é æ§è¦æ±è¾é«çæ¶æ¯ä¼ éä¸ã\n\nkafkaï¼ç¨äºå¤äºæ´»è·çæµå¼æ°æ®ï¼å¤§æ°æ®éçæ°æ®å¤çä¸ã\n\n\n# 2.æ¶ææ¨¡åæ¹é¢\n\nproducerï¼brokerï¼consumer\n\nRabbitMQï¼ä»¥brokerä¸ºä¸­å¿ï¼ææ¶æ¯çç¡®è®¤æºå¶\n\nkafkaï¼ä»¥consumerä¸ºä¸­å¿ï¼æ æ¶æ¯çç¡®è®¤æºå¶\n\n\n# 3.ååéæ¹é¢\n\nRabbitMQï¼æ¯ææ¶æ¯çå¯é çä¼ éï¼æ¯æäºå¡ï¼ä¸æ¯ææ¹éæä½ï¼åºäºå­å¨çå¯é æ§çè¦æ±å­å¨å¯ä»¥éç¨åå­æç¡¬çï¼ååéå°ã\n\nkafkaï¼åé¨éç¨æ¶æ¯çæ¹éå¤çï¼æ°æ®çå­å¨åè·åæ¯æ¬å°ç£çé¡ºåºæ¹éæä½ï¼æ¶æ¯å¤ççæçé«ï¼ååéé«ã\n\n\n# 4.éç¾¤è´è½½åè¡¡æ¹é¢\n\nRabbitMQï¼æ¬èº«ä¸æ¯æè´è½½åè¡¡ï¼éè¦loadbalancerçæ¯æ\n\nkafkaï¼éç¨zookeeperå¯¹éç¾¤ä¸­çbrokerï¼consumerè¿è¡ç®¡çï¼å¯ä»¥æ³¨åtopicå°zookeeperä¸ï¼éè¿zookeeperçåè°æºå¶ï¼producerä¿å­å¯¹åºçtopicçbrokerä¿¡æ¯ï¼å¯ä»¥éæºæèè½®è¯¢åéå°brokerä¸ï¼producerå¯ä»¥åºäºè¯­ä¹æå®åçï¼æ¶æ¯åéå°brokerçæä¸ªåçä¸ã\n\nkafkaåæºçæ­å»º\n\nä¸è½½kafka_2.13-2.6.0.tgzå®è£å\n\ntar -zxf kafka_2.13-2.6.0.tgz\n\nmv kafka_2.13-2.6.0/ kafka\n\nèªå¸¦çZookeeperç¨åºèæ¬ä¸éç½®æä»¶åä¸åçZookeeperç¨æä¸åãkafkaèªå¸¦çZookeeperç¨åºå¨binç®å½ä¸çzookeeper-server-start.shèæ¬è¿è¡å¯å¨ï¼zookeeper-server-stop.shèæ¬è¿è¡åæ­¢ãå¦å¤Zookeeperçéå¶æä»¶å¨è·¯å¾config/zookeeper.propertiesï¼å¦ææéè¦å¯ä»¥ä¿®æ¹å¶ä¸­çåæ°ã\n\né¦åå¼ºè°ä¸ç¹ï¼kafkaçæ¥å¿ç®å½åzookeeperæ°æ®ç®å½ï¼è¿ä¸¤é¡¹é»è®¤æ¾å¨tmpç®å½ï¼ètmpç®å½ä¸­åå®¹ä¼ééå¯èä¸¢å¤±,æä»¥æä»¬éå°çæ¶åæå¥½èªå®ä¹ä¸ä¸ªè·¯å¾ã zookeeper.properties éç½®ä¸º\n\ndataDir=/data/kafka/data/kfkzookeeper clientPort=2181 admin.enableServer=false tickTime=2000 initLimit=10 syncLimit=5 server.1=172.168.199.223:2888:3888\n\nzookeeperéç½®myidæä»¶ ä¸å°æå¡å¨é½è¦å¨å¶zookeeperæ°æ®ç®å½dataDirä¸åå»ºä¸ä¸ªmyidæä»¶ï¼æä»¶ååªéå¡«å¥ä¸è¿°éç½®æä»¶ä¸­broker idçå¼ï¼ä½ä¸ºéç¾¤è¯å«æ è¯ãä»¥å¶ä¸­ä¸å°192.168.11.21æå¡å¨ä¸ºä¾ï¼\n\n[root@host-192-168-11-21 ~]# cd /data/kafka/data/kfkzookeeper [root@host-192-168-11-21 kfkzookeeper]# echo 1 > myid åå»ºå¥½åï¼æ¥çä¸ä¸ï¼æ²¡é®é¢ï¼myidéé¢åªæä¸ä¸ªæ°å¼\n\nkafkaéç½®æä»¶\n\nè¿å¥kafka/configç®å½ä¸ï¼åèå¦ä¸ä¿®æ¹server.propertiesæä»¶\n\nbroker.id=1 delete.topic.enable=true num.network.threads=3 num.io.threads=8 socket.send.buffer.bytes=102400 socket.receive.buffer.bytes=102400 socket.request.max.bytes=104857600 log.dirs=/data/kafka/data/kafka num.partitions=3 num.recovery.threads.per.data.dir=1 offsets.topic.replication.factor=3 transaction.state.log.replication.factor=3 transaction.state.log.min.isr=3 log.retention.hours=168 log.segment.bytes=1073741824 log.retention.check.interval.ms=300000 zookeeper.connect=172.168.199.223:2181 zookeeper.connection.timeout.ms=60000 group.initial.rebalance.delay.ms=0\n\nå¯å¨zookeeperæå¡\n\nbin/zookeeper-server-start.sh -daemon config/zookeeper.properties\n\nå¯å¨kafka\n\nbin/kafka-server-start.sh -daemon config/server.properties\n\næ¥çjavaé¡¹ç®è¿ç¨\n\njps\n\n\n# 5.kafkaå¸¸è§æä½\n\nå¯å¨Zookeeper\n\nbin/zookeeper-server-start.sh -daemon config/zookeeper.properties\n\nå³é­ Zookeeper\n\nbin/zookeeper-server-stop.sh -daemon config/zookeeper.properties\n\nå¯å¨kafka\n\nbin/kafka-server-start.sh -daemon config/server.properties\n\nå³é­kafka\n\nbin/kafka-server-stop.sh config/server.properties\n\nåå»ºtopic\n\n--partitionsæå®ååºæ° --replication-factor æå®ååºæ°çå¯æ¬\n\nbin/kafka-topics.sh --create --zookeeper 192.168.11.21:2181 --replication-factor 3 --partitions 3 --topic test\n\n./kafka-topics.sh --create --zookeeper 172.168.199.223:2181 --replication-factor 1 --partitions 1 --topic fgbp-log-pro\n\næ¥çtopicåè¡¨\n\nbin/kafka-topics.sh --list --zookeeper 192.168.11.21:2181\n\næ¥çtopicè¯¦æ\n\nbin/kafka-topics.sh --zookeeper 192.168.11.21:2181 --describe --topic test\n\nåå»ºçäº§èï¼å¨ä¸å°æå¡å¨\n\nbin/kafka-console-producer.sh --broker-list 192.168.11.21:9092 --topic test\n\nåå»ºæ¶è´¹èï¼å¨å¦ä¸å°æå¡å¨\n\nbin/kafka-console-consumer.sh --bootstrap-server 192.168.11.22:9092 --topic test\n\nå é¤topic\n\nbin/kafka-topics.sh --zookeeper 192.168.11.22:2181 --delete --topic test\n\næ¥çkafka topicæ°æ®åå®¹\n\nkafka-console-consumer.sh --bootstrap-server kafka-node-0:9093 kafka-node-1:9094 kafka-node-2:9095 --from-beginning --topic gaoyingfutures_bars_live",normalizedContent:"# 1.åºç¨åºæ¯æ¹é¢\n\nrabbitmqï¼ç¨äºå®æ¶çï¼å¯¹å¯é æ§è¦æ±è¾é«çæ¶æ¯ä¼ éä¸ã\n\nkafkaï¼ç¨äºå¤äºæ´»è·çæµå¼æ°æ®ï¼å¤§æ°æ®éçæ°æ®å¤çä¸ã\n\n\n# 2.æ¶ææ¨¡åæ¹é¢\n\nproducerï¼brokerï¼consumer\n\nrabbitmqï¼ä»¥brokerä¸ºä¸­å¿ï¼ææ¶æ¯çç¡®è®¤æºå¶\n\nkafkaï¼ä»¥consumerä¸ºä¸­å¿ï¼æ æ¶æ¯çç¡®è®¤æºå¶\n\n\n# 3.ååéæ¹é¢\n\nrabbitmqï¼æ¯ææ¶æ¯çå¯é çä¼ éï¼æ¯æäºå¡ï¼ä¸æ¯ææ¹éæä½ï¼åºäºå­å¨çå¯é æ§çè¦æ±å­å¨å¯ä»¥éç¨åå­æç¡¬çï¼ååéå°ã\n\nkafkaï¼åé¨éç¨æ¶æ¯çæ¹éå¤çï¼æ°æ®çå­å¨åè·åæ¯æ¬å°ç£çé¡ºåºæ¹éæä½ï¼æ¶æ¯å¤ççæçé«ï¼ååéé«ã\n\n\n# 4.éç¾¤è´è½½åè¡¡æ¹é¢\n\nrabbitmqï¼æ¬èº«ä¸æ¯æè´è½½åè¡¡ï¼éè¦loadbalancerçæ¯æ\n\nkafkaï¼éç¨zookeeperå¯¹éç¾¤ä¸­çbrokerï¼consumerè¿è¡ç®¡çï¼å¯ä»¥æ³¨åtopicå°zookeeperä¸ï¼éè¿zookeeperçåè°æºå¶ï¼producerä¿å­å¯¹åºçtopicçbrokerä¿¡æ¯ï¼å¯ä»¥éæºæèè½®è¯¢åéå°brokerä¸ï¼producerå¯ä»¥åºäºè¯­ä¹æå®åçï¼æ¶æ¯åéå°brokerçæä¸ªåçä¸ã\n\nkafkaåæºçæ­å»º\n\nä¸è½½kafka_2.13-2.6.0.tgzå®è£å\n\ntar -zxf kafka_2.13-2.6.0.tgz\n\nmv kafka_2.13-2.6.0/ kafka\n\nèªå¸¦çzookeeperç¨åºèæ¬ä¸éç½®æä»¶åä¸åçzookeeperç¨æä¸åãkafkaèªå¸¦çzookeeperç¨åºå¨binç®å½ä¸çzookeeper-server-start.shèæ¬è¿è¡å¯å¨ï¼zookeeper-server-stop.shèæ¬è¿è¡åæ­¢ãå¦å¤zookeeperçéå¶æä»¶å¨è·¯å¾config/zookeeper.propertiesï¼å¦ææéè¦å¯ä»¥ä¿®æ¹å¶ä¸­çåæ°ã\n\né¦åå¼ºè°ä¸ç¹ï¼kafkaçæ¥å¿ç®å½åzookeeperæ°æ®ç®å½ï¼è¿ä¸¤é¡¹é»è®¤æ¾å¨tmpç®å½ï¼ètmpç®å½ä¸­åå®¹ä¼ééå¯èä¸¢å¤±,æä»¥æä»¬éå°çæ¶åæå¥½èªå®ä¹ä¸ä¸ªè·¯å¾ã zookeeper.properties éç½®ä¸º\n\ndatadir=/data/kafka/data/kfkzookeeper clientport=2181 admin.enableserver=false ticktime=2000 initlimit=10 synclimit=5 server.1=172.168.199.223:2888:3888\n\nzookeeperéç½®myidæä»¶ ä¸å°æå¡å¨é½è¦å¨å¶zookeeperæ°æ®ç®å½datadirä¸åå»ºä¸ä¸ªmyidæä»¶ï¼æä»¶ååªéå¡«å¥ä¸è¿°éç½®æä»¶ä¸­broker idçå¼ï¼ä½ä¸ºéç¾¤è¯å«æ è¯ãä»¥å¶ä¸­ä¸å°192.168.11.21æå¡å¨ä¸ºä¾ï¼\n\n[root@host-192-168-11-21 ~]# cd /data/kafka/data/kfkzookeeper [root@host-192-168-11-21 kfkzookeeper]# echo 1 > myid åå»ºå¥½åï¼æ¥çä¸ä¸ï¼æ²¡é®é¢ï¼myidéé¢åªæä¸ä¸ªæ°å¼\n\nkafkaéç½®æä»¶\n\nè¿å¥kafka/configç®å½ä¸ï¼åèå¦ä¸ä¿®æ¹server.propertiesæä»¶\n\nbroker.id=1 delete.topic.enable=true num.network.threads=3 num.io.threads=8 socket.send.buffer.bytes=102400 socket.receive.buffer.bytes=102400 socket.request.max.bytes=104857600 log.dirs=/data/kafka/data/kafka num.partitions=3 num.recovery.threads.per.data.dir=1 offsets.topic.replication.factor=3 transaction.state.log.replication.factor=3 transaction.state.log.min.isr=3 log.retention.hours=168 log.segment.bytes=1073741824 log.retention.check.interval.ms=300000 zookeeper.connect=172.168.199.223:2181 zookeeper.connection.timeout.ms=60000 group.initial.rebalance.delay.ms=0\n\nå¯å¨zookeeperæå¡\n\nbin/zookeeper-server-start.sh -daemon config/zookeeper.properties\n\nå¯å¨kafka\n\nbin/kafka-server-start.sh -daemon config/server.properties\n\næ¥çjavaé¡¹ç®è¿ç¨\n\njps\n\n\n# 5.kafkaå¸¸è§æä½\n\nå¯å¨zookeeper\n\nbin/zookeeper-server-start.sh -daemon config/zookeeper.properties\n\nå³é­ zookeeper\n\nbin/zookeeper-server-stop.sh -daemon config/zookeeper.properties\n\nå¯å¨kafka\n\nbin/kafka-server-start.sh -daemon config/server.properties\n\nå³é­kafka\n\nbin/kafka-server-stop.sh config/server.properties\n\nåå»ºtopic\n\n--partitionsæå®ååºæ° --replication-factor æå®ååºæ°çå¯æ¬\n\nbin/kafka-topics.sh --create --zookeeper 192.168.11.21:2181 --replication-factor 3 --partitions 3 --topic test\n\n./kafka-topics.sh --create --zookeeper 172.168.199.223:2181 --replication-factor 1 --partitions 1 --topic fgbp-log-pro\n\næ¥çtopicåè¡¨\n\nbin/kafka-topics.sh --list --zookeeper 192.168.11.21:2181\n\næ¥çtopicè¯¦æ\n\nbin/kafka-topics.sh --zookeeper 192.168.11.21:2181 --describe --topic test\n\nåå»ºçäº§èï¼å¨ä¸å°æå¡å¨\n\nbin/kafka-console-producer.sh --broker-list 192.168.11.21:9092 --topic test\n\nåå»ºæ¶è´¹èï¼å¨å¦ä¸å°æå¡å¨\n\nbin/kafka-console-consumer.sh --bootstrap-server 192.168.11.22:9092 --topic test\n\nå é¤topic\n\nbin/kafka-topics.sh --zookeeper 192.168.11.22:2181 --delete --topic test\n\næ¥çkafka topicæ°æ®åå®¹\n\nkafka-console-consumer.sh --bootstrap-server kafka-node-0:9093 kafka-node-1:9094 kafka-node-2:9095 --from-beginning --topic gaoyingfutures_bars_live",charsets:{cjk:!0}},{title:"docker-composeå®è£kafkaéç¾¤",frontmatter:{title:"docker-composeå®è£kafkaéç¾¤",date:"2023-01-13T16:48:12.000Z",permalink:"/pages/43f361/",categories:["è¿ç»´","ç³»ç»"],tags:[null],readingShow:"top",description:'version: "3"',meta:[{name:"twitter:title",content:"docker-composeå®è£kafkaéç¾¤"},{name:"twitter:description",content:'version: "3"'},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/02.kafka/02.docker-compose%E5%AE%89%E8%A3%85kafka%E9%9B%86%E7%BE%A4.html"},{property:"og:type",content:"article"},{property:"og:title",content:"docker-composeå®è£kafkaéç¾¤"},{property:"og:description",content:'version: "3"'},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/02.kafka/02.docker-compose%E5%AE%89%E8%A3%85kafka%E9%9B%86%E7%BE%A4.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-13T16:48:12.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"docker-composeå®è£kafkaéç¾¤"},{itemprop:"description",content:'version: "3"'}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/02.kafka/02.docker-compose%E5%AE%89%E8%A3%85kafka%E9%9B%86%E7%BE%A4.html",relativePath:"04.è¿ç»´/03.ä¸­é´ä»¶/02.kafka/02.docker-composeå®è£kafkaéç¾¤.md",key:"v-0576e07d",path:"/pages/43f361/",headers:[{level:3,title:"å®è£æä»¶",slug:"å®è£æä»¶",normalizedTitle:"å®è£æä»¶",charIndex:2}],headersStr:"å®è£æä»¶",content:'# å®è£æä»¶\n\nversion: "3"\n\nservices:\n  zookeeper:\n    image: zookeeper\n    container_name: zookeeper\n    ports:\n      - 2181:2181\n    volumes:\n      - /data/zookeeper/data:/data\n      - /data/zookeeper/datalog:/datalog\n      - /data/zookeeper/logs:/logs\n    restart: always\n\n  kafka_node_0:\n    depends_on:\n      - zookeeper\n    container_name: kafka-node-0\n    image: wurstmeister/kafka\n    environment:\n      KAFKA_BROKER_ID: 0\n      KAFKA_ZOOKEEPER_CONNECT: 172.16.30.247:2181\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://xxx:9093\n      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9093\n      KAFKA_NUM_PARTITIONS: 3\n      KAFKA_DEFAULT_REPLICATION_FACTOR: 2\n    ports:\n      - 9093:9093\n    volumes:\n      - /data/kafka/node_0:/kafka\n    restart: unless-stopped\n\n  kafka_node_1:\n    depends_on:\n      - kafka_node_0\n    container_name: kafka-node-1\n    image: wurstmeister/kafka\n    environment:\n      KAFKA_BROKER_ID: 1\n      KAFKA_ZOOKEEPER_CONNECT: 172.16.30.247:2181\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://xxx:9094\n      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9094\n      KAFKA_NUM_PARTITIONS: 3\n      KAFKA_DEFAULT_REPLICATION_FACTOR: 2\n    ports:\n      - 9094:9094\n    volumes:\n      - /data/kafka/node_1:/kafka\n    restart: unless-stopped\n\n  kafka_node_2:\n    depends_on:\n      - kafka_node_1\n    container_name: kafka-node-2\n    image: wurstmeister/kafka\n    environment:\n      KAFKA_BROKER_ID: 2\n      KAFKA_ZOOKEEPER_CONNECT: 172.16.30.247:2181\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://xxx:9095\n      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9095\n      KAFKA_NUM_PARTITIONS: 3\n      KAFKA_DEFAULT_REPLICATION_FACTOR: 2\n    ports:\n      - 9095:9095\n    volumes:\n      - /data/kafka/node_2:/kafka\n    restart: unless-stopped\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n',normalizedContent:'# å®è£æä»¶\n\nversion: "3"\n\nservices:\n  zookeeper:\n    image: zookeeper\n    container_name: zookeeper\n    ports:\n      - 2181:2181\n    volumes:\n      - /data/zookeeper/data:/data\n      - /data/zookeeper/datalog:/datalog\n      - /data/zookeeper/logs:/logs\n    restart: always\n\n  kafka_node_0:\n    depends_on:\n      - zookeeper\n    container_name: kafka-node-0\n    image: wurstmeister/kafka\n    environment:\n      kafka_broker_id: 0\n      kafka_zookeeper_connect: 172.16.30.247:2181\n      kafka_advertised_listeners: plaintext://xxx:9093\n      kafka_listeners: plaintext://0.0.0.0:9093\n      kafka_num_partitions: 3\n      kafka_default_replication_factor: 2\n    ports:\n      - 9093:9093\n    volumes:\n      - /data/kafka/node_0:/kafka\n    restart: unless-stopped\n\n  kafka_node_1:\n    depends_on:\n      - kafka_node_0\n    container_name: kafka-node-1\n    image: wurstmeister/kafka\n    environment:\n      kafka_broker_id: 1\n      kafka_zookeeper_connect: 172.16.30.247:2181\n      kafka_advertised_listeners: plaintext://xxx:9094\n      kafka_listeners: plaintext://0.0.0.0:9094\n      kafka_num_partitions: 3\n      kafka_default_replication_factor: 2\n    ports:\n      - 9094:9094\n    volumes:\n      - /data/kafka/node_1:/kafka\n    restart: unless-stopped\n\n  kafka_node_2:\n    depends_on:\n      - kafka_node_1\n    container_name: kafka-node-2\n    image: wurstmeister/kafka\n    environment:\n      kafka_broker_id: 2\n      kafka_zookeeper_connect: 172.16.30.247:2181\n      kafka_advertised_listeners: plaintext://xxx:9095\n      kafka_listeners: plaintext://0.0.0.0:9095\n      kafka_num_partitions: 3\n      kafka_default_replication_factor: 2\n    ports:\n      - 9095:9095\n    volumes:\n      - /data/kafka/node_2:/kafka\n    restart: unless-stopped\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n',charsets:{cjk:!0}},{title:"kafkaå·¥ä½åç",frontmatter:{title:"kafkaå·¥ä½åç",date:"2023-03-01T14:14:49.000Z",permalink:"/pages/b73d79/",categories:["è¿ç»´","ä¸­é´ä»¶","kafka"],tags:[null],readingShow:"top",description:"ç®å½",meta:[{name:"image",content:"http://pic.zzppjj.top/LightPicture/2023/03/24f8307f8bf0c110.png"},{name:"twitter:title",content:"kafkaå·¥ä½åç"},{name:"twitter:description",content:"ç®å½"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://pic.zzppjj.top/LightPicture/2023/03/24f8307f8bf0c110.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/02.kafka/03.kafka%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html"},{property:"og:type",content:"article"},{property:"og:title",content:"kafkaå·¥ä½åç"},{property:"og:description",content:"ç®å½"},{property:"og:image",content:"http://pic.zzppjj.top/LightPicture/2023/03/24f8307f8bf0c110.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/02.kafka/03.kafka%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-03-01T14:14:49.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"kafkaå·¥ä½åç"},{itemprop:"description",content:"ç®å½"},{itemprop:"image",content:"http://pic.zzppjj.top/LightPicture/2023/03/24f8307f8bf0c110.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/02.kafka/03.kafka%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html",relativePath:"04.è¿ç»´/03.ä¸­é´ä»¶/02.kafka/03.kafkaå·¥ä½åç.md",key:"v-8488e3a8",path:"/pages/b73d79/",headers:[{level:2,title:"Kafkaç³»ç»çè§è²",slug:"kafkaç³»ç»çè§è²",normalizedTitle:"kafkaç³»ç»çè§è²",charIndex:530},{level:2,title:"TopicãPartitionåReplicaçå³ç³»",slug:"topicãpartitionåreplicaçå³ç³»",normalizedTitle:"topicãpartitionåreplicaçå³ç³»",charIndex:1972},{level:2,title:"é®é¢",slug:"é®é¢",normalizedTitle:"é®é¢",charIndex:2674},{level:2,title:"zookeeperå­å¨ç»æ",slug:"zookeeperå­å¨ç»æ",normalizedTitle:"zookeeperå­å¨ç»æ",charIndex:2865}],headersStr:"Kafkaç³»ç»çè§è² TopicãPartitionåReplicaçå³ç³» é®é¢ zookeeperå­å¨ç»æ",content:"# kafkaå·¥ä½åç\n\nç®å½\n\n * http://www.aboutyun.com/thread-11895-1-1.html\n * kafkaå¥é¨ï¼ç®ä»ãä½¿ç¨åºæ¯ãè®¾è®¡åçãä¸»è¦éç½®åéç¾¤æ­å»ºï¼è½¬ï¼:http://www.cnblogs.com/likehua/p/3999538.html\n * apache kafkaç³»åä¹å¨zookeeperä¸­å­å¨ç»æï¼http://blog.csdn.net/strawbingo/article/details/45484139\n * Kafkaæä»¶å­å¨æºå¶é£äºäº:http://www.open-open.com/lib/view/open1421150566328.html\n * apache kafkaç³»åä¹server.propertieséç½®æä»¶åæ°è¯´æ:http://blog.csdn.net/lizhitao/article/details/25667831\n * kafkaå¥é¨:http://bit1129.iteye.com/blog/2174791\n * Kafka è®¾è®¡ä¸åçè¯¦è§£:Kafka è®¾è®¡ä¸åçè¯¦è§£_kafkaè®¾è®¡åç_Heaven-Wangçåå®¢-CSDNåå®¢\n\n\n# Kafkaç³»ç»çè§è²\n\n * Broker ï¼ä¸å°kafkaæå¡å¨å°±æ¯ä¸ä¸ªbrokerãä¸ä¸ªéç¾¤ç±å¤ä¸ªbrokerç»æãä¸ä¸ªbrokerå¯ä»¥å®¹çº³å¤ä¸ªtopic\n * topicï¼ å¯ä»¥çè§£ä¸ºä¸ä¸ªMQæ¶æ¯éåçåå­\n * Partitionï¼\n   * ä¸ºäºå®ç°æ©å±æ§ï¼ä¸ä¸ªéå¸¸å¤§çtopicå¯ä»¥åå¸å°å¤ä¸ª brokerï¼å³æå¡å¨ï¼ä¸ï¼ä¸ä¸ªtopicå¯ä»¥åä¸ºå¤ä¸ªpartitionï¼æ¯ä¸ªpartitionæ¯ä¸ä¸ªæåºçéåã\n   * partitionä¸­çæ¯æ¡æ¶æ¯é½ä¼è¢«åéä¸ä¸ªæåºçidï¼offsetï¼ãkafkaåªä¿è¯æä¸ä¸ªpartitionä¸­çé¡ºåºå°æ¶æ¯åç»consumerï¼ä¸ä¿è¯ä¸ä¸ªtopicçæ´ä½ ï¼å¤ä¸ªpartitioné´ï¼çé¡ºåºã\n   * ä¹å°±æ¯è¯´ï¼ä¸ä¸ªtopicå¨éç¾¤ä¸­å¯ä»¥æå¤ä¸ªpartitionï¼é£ä¹ååºçç­ç¥æ¯ä»ä¹ï¼(æ¶æ¯åéå°åªä¸ªååºä¸ï¼æä¸¤ç§åºæ¬çç­ç¥ï¼ä¸æ¯éç¨Key Hashç®æ³ï¼ä¸æ¯éç¨Round Robinç®æ³)\n\n\n\n * Offsetï¼kafkaçå­å¨æä»¶é½æ¯æç§offset.kafkaæ¥å½åï¼ç¨offsetååå­çå¥½å¤æ¯æ¹ä¾¿æ¥æ¾ãä¾å¦ä½ æ³æ¾ä½äº2049çä½ç½®ï¼åªè¦æ¾å°2048.kafkaçæä»¶å³å¯ãå½ç¶the first offsetå°±æ¯00000000000.kafka\n * Producer ï¼æ¶æ¯çäº§èï¼å°±æ¯åkafka brokeråæ¶æ¯çå®¢æ·ç«¯ã\n * Consumer ï¼æ¶æ¯æ¶è´¹èï¼åkafka brokeråæ¶æ¯çå®¢æ·ç«¯\n\n\n\n * Consumer Group ï¼CGï¼ï¼\n   \n   * æ¶æ¯ç³»ç»æä¸¤ç±»ï¼ä¸æ¯å¹¿æ­ï¼äºæ¯è®¢éåå¸ãå¹¿æ­æ¯ææ¶æ¯åéç»ææçæ¶è´¹èï¼åå¸è®¢éæ¯ææ¶æ¯åªåéç»è®¢éèãKafkaéè¿Consumer Groupç»åå®ç°äºè¿ä¸¤ç§æºå¶ï¼ å®ç°ä¸ä¸ªtopicæ¶æ¯å¹¿æ­ï¼åç»ææçconsumerï¼ååæ­ï¼åç»ä»»æä¸ä¸ªconsumerï¼ãä¸ä¸ªtopicå¯ä»¥æå¤ä¸ªCGã\n   * topicçæ¶æ¯ä¼å¤å¶ï¼ä¸æ¯ççå¤å¶ï¼æ¯æ¦å¿µä¸çï¼å°ææçCGï¼ä½æ¯ä¸ªCGåªä¼ææ¶æ¯åç»è¯¥CGä¸­çä¸ä¸ª consumerï¼è¿æ¯å®ç°ä¸ä¸ªTopicå¤Consumerçå³é®ç¹ï¼ä¸ºä¸ä¸ªTopicå®ä¹ä¸ä¸ªCGï¼CGä¸å®ä¹å¤ä¸ªConsumerï¼ãå¦æéè¦å®ç°å¹¿æ­ï¼åªè¦æ¯ä¸ªconsumeræä¸ä¸ªç¬ç«çCGå°±å¯ä»¥äºãè¦å®ç°åæ­åªè¦ææçconsumerå¨åä¸ä¸ªCGãç¨CGè¿å¯ä»¥å°consumerè¿è¡èªç±çåç»èä¸éè¦å¤æ¬¡åéæ¶æ¯å°ä¸åçtopicã\n   * å¸åçåºç¨åºæ¯æ¯ï¼å¤ä¸ªConsumeræ¥è¯»åä¸ä¸ªTopic(çæ³æåµä¸æ¯ä¸ä¸ªConsumerè¯»åTopicçä¸ä¸ªPartitionï¼,é£ä¹å¯ä»¥è®©è¿äºConsumerå±äºåä¸ä¸ªConsumer Groupå³å¯å®ç°æ¶æ¯çå¤Consumerå¹¶è¡å¤çï¼åçæ¯Kafkaå°ä¸ä¸ªæ¶æ¯åå¸åºå»åï¼ConsumerGroupä¸­çConsumerså¯ä»¥éè¿Round Robinçæ¹å¼è¿è¡æ¶è´¹(Consumersä¹é´çè´è½½åè¡¡ä½¿ç¨Zookeeperæ¥å®ç°)\n   \n   \n\nA two server Kafka cluster hosting four partitions (P0-P3) with two consumer groups. Consumer group A has two consumer instances and group B has four.\n\n\n# TopicãPartitionåReplicaçå³ç³»\n\n\n\nå¦ä¸å¾ï¼ä¸ä¸ªTopicæåä¸ªPartitionï¼æ¯ä¸ªPartitionä¸¤ä¸ªreplicationã\n\nZookeeperå¨Kakfaä¸­æ®æ¼çè§è²Kafkaå°åæ°æ®ä¿¡æ¯ä¿å­å¨Zookeeperä¸­ï¼ä½æ¯åéç»Topicæ¬èº«çæ°æ®æ¯ä¸ä¼åå°Zkä¸çï¼å¦åZkå°±ç¯äºã\n\n * kafkaä½¿ç¨zookeeperæ¥å®ç°å¨æçéç¾¤æ©å±ï¼ä¸éè¦æ´æ¹å®¢æ·ç«¯ï¼produceråconsumerï¼çéç½®ãbrokerä¼å¨zookeeperæ³¨åå¹¶ä¿æç¸å³çåæ°æ®ï¼topicï¼partitionä¿¡æ¯ç­ï¼æ´æ°ã\n * èå®¢æ·ç«¯ä¼å¨zookeeperä¸æ³¨åç¸å³çwatcherãä¸æ¦zookeeperåçååï¼å®¢æ·ç«¯è½åæ¶æç¥å¹¶ä½åºç¸åºè°æ´ãè¿æ ·å°±ä¿è¯äºæ·»å æå»é¤brokeræ¶ï¼åbrokeré´ä»è½èªå¨å®ç°è´è½½åè¡¡ãè¿éçå®¢æ·ç«¯æçæ¯Kafkaçæ¶æ¯çäº§ç«¯(Producer)åæ¶æ¯æ¶è´¹ç«¯(Consumer)\n * Brokerç«¯ä½¿ç¨zookeeperæ¥æ³¨åbrokerä¿¡æ¯ï¼ä»¥åçæµpartition leaderå­æ´»æ§ã\n * Consumerç«¯ä½¿ç¨zookeeperç¨æ¥æ³¨åconsumerä¿¡æ¯ï¼å¶ä¸­åæ¬consumeræ¶è´¹çpartitionåè¡¨ç­ï¼åæ¶ä¹ç¨æ¥åç°brokeråè¡¨ï¼å¹¶åpartition leaderå»ºç«socketè¿æ¥ï¼å¹¶è·åæ¶æ¯ã\n * ZookeeperåProduceræ²¡æå»ºç«å³ç³»ï¼åªåBrokersãConsumerså»ºç«å³ç³»ä»¥å®ç°è´è½½åè¡¡ï¼å³åä¸ä¸ªConsumer Groupä¸­çConsumerså¯ä»¥å®ç°è´è½½åè¡¡ã\n\n\n# é®é¢\n\n * Topicæå¤ä¸ªPartitionï¼é£ä¹æ¶æ¯åéå°æä¸ªPartitionçä¾æ®æ¯ä»ä¹ï¼\n   * Key HashæèRound Robin\n * å¦ä½æ¥çä¸ä¸ªTopicæå¤å°ä¸ªPartitionï¼\n   * ä½¿ç¨kakfa-topic.sh --list topic topicName --zookeeper zookeeper.servers.list\n\n\n# zookeeperå­å¨ç»æ\n\n * åæï¼apache kafkaç³»åä¹å¨zookeeperä¸­å­å¨ç»æ_strawbingoçåå®¢-CSDNåå®¢\n   \n   [zk: localhost:2181(CONNECTED) 0] ls / [admin, consumers, config, brokers]\n\n",normalizedContent:"# kafkaå·¥ä½åç\n\nç®å½\n\n * http://www.aboutyun.com/thread-11895-1-1.html\n * kafkaå¥é¨ï¼ç®ä»ãä½¿ç¨åºæ¯ãè®¾è®¡åçãä¸»è¦éç½®åéç¾¤æ­å»ºï¼è½¬ï¼:http://www.cnblogs.com/likehua/p/3999538.html\n * apache kafkaç³»åä¹å¨zookeeperä¸­å­å¨ç»æï¼http://blog.csdn.net/strawbingo/article/details/45484139\n * kafkaæä»¶å­å¨æºå¶é£äºäº:http://www.open-open.com/lib/view/open1421150566328.html\n * apache kafkaç³»åä¹server.propertieséç½®æä»¶åæ°è¯´æ:http://blog.csdn.net/lizhitao/article/details/25667831\n * kafkaå¥é¨:http://bit1129.iteye.com/blog/2174791\n * kafka è®¾è®¡ä¸åçè¯¦è§£:kafka è®¾è®¡ä¸åçè¯¦è§£_kafkaè®¾è®¡åç_heaven-wangçåå®¢-csdnåå®¢\n\n\n# kafkaç³»ç»çè§è²\n\n * broker ï¼ä¸å°kafkaæå¡å¨å°±æ¯ä¸ä¸ªbrokerãä¸ä¸ªéç¾¤ç±å¤ä¸ªbrokerç»æãä¸ä¸ªbrokerå¯ä»¥å®¹çº³å¤ä¸ªtopic\n * topicï¼ å¯ä»¥çè§£ä¸ºä¸ä¸ªmqæ¶æ¯éåçåå­\n * partitionï¼\n   * ä¸ºäºå®ç°æ©å±æ§ï¼ä¸ä¸ªéå¸¸å¤§çtopicå¯ä»¥åå¸å°å¤ä¸ª brokerï¼å³æå¡å¨ï¼ä¸ï¼ä¸ä¸ªtopicå¯ä»¥åä¸ºå¤ä¸ªpartitionï¼æ¯ä¸ªpartitionæ¯ä¸ä¸ªæåºçéåã\n   * partitionä¸­çæ¯æ¡æ¶æ¯é½ä¼è¢«åéä¸ä¸ªæåºçidï¼offsetï¼ãkafkaåªä¿è¯æä¸ä¸ªpartitionä¸­çé¡ºåºå°æ¶æ¯åç»consumerï¼ä¸ä¿è¯ä¸ä¸ªtopicçæ´ä½ ï¼å¤ä¸ªpartitioné´ï¼çé¡ºåºã\n   * ä¹å°±æ¯è¯´ï¼ä¸ä¸ªtopicå¨éç¾¤ä¸­å¯ä»¥æå¤ä¸ªpartitionï¼é£ä¹ååºçç­ç¥æ¯ä»ä¹ï¼(æ¶æ¯åéå°åªä¸ªååºä¸ï¼æä¸¤ç§åºæ¬çç­ç¥ï¼ä¸æ¯éç¨key hashç®æ³ï¼ä¸æ¯éç¨round robinç®æ³)\n\n\n\n * offsetï¼kafkaçå­å¨æä»¶é½æ¯æç§offset.kafkaæ¥å½åï¼ç¨offsetååå­çå¥½å¤æ¯æ¹ä¾¿æ¥æ¾ãä¾å¦ä½ æ³æ¾ä½äº2049çä½ç½®ï¼åªè¦æ¾å°2048.kafkaçæä»¶å³å¯ãå½ç¶the first offsetå°±æ¯00000000000.kafka\n * producer ï¼æ¶æ¯çäº§èï¼å°±æ¯åkafka brokeråæ¶æ¯çå®¢æ·ç«¯ã\n * consumer ï¼æ¶æ¯æ¶è´¹èï¼åkafka brokeråæ¶æ¯çå®¢æ·ç«¯\n\n\n\n * consumer group ï¼cgï¼ï¼\n   \n   * æ¶æ¯ç³»ç»æä¸¤ç±»ï¼ä¸æ¯å¹¿æ­ï¼äºæ¯è®¢éåå¸ãå¹¿æ­æ¯ææ¶æ¯åéç»ææçæ¶è´¹èï¼åå¸è®¢éæ¯ææ¶æ¯åªåéç»è®¢éèãkafkaéè¿consumer groupç»åå®ç°äºè¿ä¸¤ç§æºå¶ï¼ å®ç°ä¸ä¸ªtopicæ¶æ¯å¹¿æ­ï¼åç»ææçconsumerï¼ååæ­ï¼åç»ä»»æä¸ä¸ªconsumerï¼ãä¸ä¸ªtopicå¯ä»¥æå¤ä¸ªcgã\n   * topicçæ¶æ¯ä¼å¤å¶ï¼ä¸æ¯ççå¤å¶ï¼æ¯æ¦å¿µä¸çï¼å°ææçcgï¼ä½æ¯ä¸ªcgåªä¼ææ¶æ¯åç»è¯¥cgä¸­çä¸ä¸ª consumerï¼è¿æ¯å®ç°ä¸ä¸ªtopicå¤consumerçå³é®ç¹ï¼ä¸ºä¸ä¸ªtopicå®ä¹ä¸ä¸ªcgï¼cgä¸å®ä¹å¤ä¸ªconsumerï¼ãå¦æéè¦å®ç°å¹¿æ­ï¼åªè¦æ¯ä¸ªconsumeræä¸ä¸ªç¬ç«çcgå°±å¯ä»¥äºãè¦å®ç°åæ­åªè¦ææçconsumerå¨åä¸ä¸ªcgãç¨cgè¿å¯ä»¥å°consumerè¿è¡èªç±çåç»èä¸éè¦å¤æ¬¡åéæ¶æ¯å°ä¸åçtopicã\n   * å¸åçåºç¨åºæ¯æ¯ï¼å¤ä¸ªconsumeræ¥è¯»åä¸ä¸ªtopic(çæ³æåµä¸æ¯ä¸ä¸ªconsumerè¯»åtopicçä¸ä¸ªpartitionï¼,é£ä¹å¯ä»¥è®©è¿äºconsumerå±äºåä¸ä¸ªconsumer groupå³å¯å®ç°æ¶æ¯çå¤consumerå¹¶è¡å¤çï¼åçæ¯kafkaå°ä¸ä¸ªæ¶æ¯åå¸åºå»åï¼consumergroupä¸­çconsumerså¯ä»¥éè¿round robinçæ¹å¼è¿è¡æ¶è´¹(consumersä¹é´çè´è½½åè¡¡ä½¿ç¨zookeeperæ¥å®ç°)\n   \n   \n\na two server kafka cluster hosting four partitions (p0-p3) with two consumer groups. consumer group a has two consumer instances and group b has four.\n\n\n# topicãpartitionåreplicaçå³ç³»\n\n\n\nå¦ä¸å¾ï¼ä¸ä¸ªtopicæåä¸ªpartitionï¼æ¯ä¸ªpartitionä¸¤ä¸ªreplicationã\n\nzookeeperå¨kakfaä¸­æ®æ¼çè§è²kafkaå°åæ°æ®ä¿¡æ¯ä¿å­å¨zookeeperä¸­ï¼ä½æ¯åéç»topicæ¬èº«çæ°æ®æ¯ä¸ä¼åå°zkä¸çï¼å¦åzkå°±ç¯äºã\n\n * kafkaä½¿ç¨zookeeperæ¥å®ç°å¨æçéç¾¤æ©å±ï¼ä¸éè¦æ´æ¹å®¢æ·ç«¯ï¼produceråconsumerï¼çéç½®ãbrokerä¼å¨zookeeperæ³¨åå¹¶ä¿æç¸å³çåæ°æ®ï¼topicï¼partitionä¿¡æ¯ç­ï¼æ´æ°ã\n * èå®¢æ·ç«¯ä¼å¨zookeeperä¸æ³¨åç¸å³çwatcherãä¸æ¦zookeeperåçååï¼å®¢æ·ç«¯è½åæ¶æç¥å¹¶ä½åºç¸åºè°æ´ãè¿æ ·å°±ä¿è¯äºæ·»å æå»é¤brokeræ¶ï¼åbrokeré´ä»è½èªå¨å®ç°è´è½½åè¡¡ãè¿éçå®¢æ·ç«¯æçæ¯kafkaçæ¶æ¯çäº§ç«¯(producer)åæ¶æ¯æ¶è´¹ç«¯(consumer)\n * brokerç«¯ä½¿ç¨zookeeperæ¥æ³¨åbrokerä¿¡æ¯ï¼ä»¥åçæµpartition leaderå­æ´»æ§ã\n * consumerç«¯ä½¿ç¨zookeeperç¨æ¥æ³¨åconsumerä¿¡æ¯ï¼å¶ä¸­åæ¬consumeræ¶è´¹çpartitionåè¡¨ç­ï¼åæ¶ä¹ç¨æ¥åç°brokeråè¡¨ï¼å¹¶åpartition leaderå»ºç«socketè¿æ¥ï¼å¹¶è·åæ¶æ¯ã\n * zookeeperåproduceræ²¡æå»ºç«å³ç³»ï¼åªåbrokersãconsumerså»ºç«å³ç³»ä»¥å®ç°è´è½½åè¡¡ï¼å³åä¸ä¸ªconsumer groupä¸­çconsumerså¯ä»¥å®ç°è´è½½åè¡¡ã\n\n\n# é®é¢\n\n * topicæå¤ä¸ªpartitionï¼é£ä¹æ¶æ¯åéå°æä¸ªpartitionçä¾æ®æ¯ä»ä¹ï¼\n   * key hashæèround robin\n * å¦ä½æ¥çä¸ä¸ªtopicæå¤å°ä¸ªpartitionï¼\n   * ä½¿ç¨kakfa-topic.sh --list topic topicname --zookeeper zookeeper.servers.list\n\n\n# zookeeperå­å¨ç»æ\n\n * åæï¼apache kafkaç³»åä¹å¨zookeeperä¸­å­å¨ç»æ_strawbingoçåå®¢-csdnåå®¢\n   \n   [zk: localhost:2181(connected) 0] ls / [admin, consumers, config, brokers]\n\n",charsets:{cjk:!0}},{title:"apolloé¨ç½²",frontmatter:{title:"apolloé¨ç½²",date:"2022-12-15T19:20:45.000Z",permalink:"/pages/fd6cf8/",categories:["è¿ç»´","ç¨åº"],tags:[null],readingShow:"top",description:"æ¬ææ¡£ä»ç»äºå¦ä½æç§åå¸å¼é¨ç½²çæ¹å¼ç¼è¯ãæåãé¨ç½²Apolloéç½®ä¸­å¿ï¼ä»èå¯ä»¥å¨å¼åãæµè¯ãçäº§ç­ç¯å¢åå«é¨ç½²è¿è¡ã",meta:[{name:"twitter:title",content:"apolloé¨ç½²"},{name:"twitter:description",content:"æ¬ææ¡£ä»ç»äºå¦ä½æç§åå¸å¼é¨ç½²çæ¹å¼ç¼è¯ãæåãé¨ç½²Apolloéç½®ä¸­å¿ï¼ä»èå¯ä»¥å¨å¼åãæµè¯ãçäº§ç­ç¯å¢åå«é¨ç½²è¿è¡ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.apollo%E9%83%A8%E7%BD%B2.html"},{property:"og:type",content:"article"},{property:"og:title",content:"apolloé¨ç½²"},{property:"og:description",content:"æ¬ææ¡£ä»ç»äºå¦ä½æç§åå¸å¼é¨ç½²çæ¹å¼ç¼è¯ãæåãé¨ç½²Apolloéç½®ä¸­å¿ï¼ä»èå¯ä»¥å¨å¼åãæµè¯ãçäº§ç­ç¯å¢åå«é¨ç½²è¿è¡ã"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.apollo%E9%83%A8%E7%BD%B2.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T19:20:45.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"apolloé¨ç½²"},{itemprop:"description",content:"æ¬ææ¡£ä»ç»äºå¦ä½æç§åå¸å¼é¨ç½²çæ¹å¼ç¼è¯ãæåãé¨ç½²Apolloéç½®ä¸­å¿ï¼ä»èå¯ä»¥å¨å¼åãæµè¯ãçäº§ç­ç¯å¢åå«é¨ç½²è¿è¡ã"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/03.%E4%B8%AD%E9%97%B4%E4%BB%B6/03.apollo%E9%83%A8%E7%BD%B2.html",relativePath:"04.è¿ç»´/03.ä¸­é´ä»¶/03.apolloé¨ç½².md",key:"v-515e9f9a",path:"/pages/fd6cf8/",headersStr:null,content:'æ¬ææ¡£ä»ç»äºå¦ä½æç§åå¸å¼é¨ç½²çæ¹å¼ç¼è¯ãæåãé¨ç½²Apolloéç½®ä¸­å¿ï¼ä»èå¯ä»¥å¨å¼åãæµè¯ãçäº§ç­ç¯å¢åå«é¨ç½²è¿è¡ã\n\nä¸ãåå¤å·¥ä½\n\n1.1 è¿è¡æ¶ç¯å¢\n\n1.1.1 OS\n\næå¡ç«¯åºäºSpring Bootï¼å¯å¨èæ¬çè®ºä¸æ¯æææLinuxåè¡çï¼å»ºè®®CentOS 7\n\n1.1.2 Java\n\n * Apolloæå¡ç«¯ï¼1.8+\n * Apolloå®¢æ·ç«¯ï¼1.7+\n\nç±äºéè¦åæ¶è¿è¡æå¡ç«¯åå®¢æ·ç«¯ï¼æä»¥å»ºè®®å®è£Java 1.8+ã\n\nå¯¹äºApolloå®¢æ·ç«¯ï¼è¿è¡æ¶ç¯å¢åªéè¦1.7+å³å¯ã\n\næ³¨ï¼å¯¹äºApolloå®¢æ·ç«¯ï¼å¦ææéè¦çè¯ï¼å¯ä»¥åå°éä»£ç ä¿®æ¹æ¥éçº§å°Java 1.6\n\nå¨éç½®å¥½åï¼å¯ä»¥éè¿å¦ä¸å½ä»¤æ£æ¥ï¼\n\njava -version\n\næ ·ä¾è¾åºï¼\n\njava version "1.8.0_74"\n\nJava(TM) SE Runtime Environment (build 1.8.0_74-b02)\n\nJava HotSpot(TM) 64-Bit Server VM (build 25.74-b02, mixed mode)\n\n1.2 Mysql\n\n * çæ¬è¦æ±ï¼5.6.5+\n\nApolloçè¡¨ç»æå¯¹timestampä½¿ç¨äºå¤ä¸ªdefaultå£°æï¼æä»¥éè¦5.6.5ä»¥ä¸çæ¬ã\n\nè¿æ¥ä¸MySQLåï¼å¯ä»¥éè¿å¦ä¸å½ä»¤æ£æ¥ï¼\n\nSHOW VARIABLES WHERE Variable_name = \'version\';ç¹å»å¤å¶éè¯¯å¤å¶æå\n\n                \nVariable_name   Value\nversion         5.7.11\n\n1.3 ç¯å¢\n\nåå¸å¼é¨ç½²éè¦äºåç¡®å®é¨ç½²çç¯å¢ä»¥åé¨ç½²æ¹å¼ã\n\nApolloç®åæ¯æä»¥ä¸ç¯å¢ï¼\n\n * DEV\n\n * å¼åç¯å¢\n\n * FAT\n\n * æµè¯ç¯å¢ï¼ç¸å½äºalphaç¯å¢(åè½æµè¯)\n\n * UAT\n\n * éæç¯å¢ï¼ç¸å½äºbetaç¯å¢ï¼åå½æµè¯ï¼\n\n * PRO\n\n * çäº§ç¯å¢\n\nå¦æå¸ææ·»å èªå®ä¹çç¯å¢åç§°ï¼å·ä½æ­¥éª¤å¯ä»¥åèPortalå¦ä½å¢å ç¯å¢\n\n1.4 ç½ç»ç­ç¥\n\nåå¸å¼é¨ç½²çæ¶åï¼apollo-configserviceåapollo-adminserviceéè¦æèªå·±çIPåç«¯å£æ³¨åå°Meta Serverï¼apollo-configserviceæ¬èº«ï¼ã\n\nApolloå®¢æ·ç«¯åPortalä¼ä»Meta Serverè·åæå¡çå°åï¼IP+ç«¯å£ï¼ï¼ç¶åéè¿æå¡å°åç´æ¥è®¿é®ã\n\néè¦æ³¨æçæ¯ï¼apollo-configserviceåapollo-adminserviceæ¯åºäºåç½å¯ä¿¡ç½ç»è®¾è®¡çï¼æä»¥åºäºå®å¨èèï¼è¯·ä¸è¦å°apollo-configserviceåapollo-adminserviceç´æ¥æ´é²å¨å¬ç½ã\n\næä»¥å¦æå®éé¨ç½²çæºå¨æå¤åç½å¡ï¼å¦dockerï¼ï¼æèå­å¨æäºç½å¡çIPæ¯Apolloå®¢æ·ç«¯åPortalæ æ³è®¿é®çï¼å¦ç½ç»å®å¨éå¶ï¼ï¼é£ä¹æä»¬å°±éè¦å¨apollo-configserviceåapollo-adminserviceä¸­åç¸å³éç½®æ¥è§£å³è¿éæ§é®é¢ã\n\n1.4.1 å¿½ç¥æäºç½å¡\n\nå¯ä»¥åå«ä¿®æ¹apollo-configserviceåapollo-adminserviceçstartup.shï¼éè¿JVM System Propertyä¼ å¥-Dåæ°ï¼ä¹å¯ä»¥éè¿OS Environment Variableä¼ å¥ï¼ä¸é¢çä¾å­ä¼ædocker0åvethå¼å¤´çç½å¡å¨æ³¨åå°Eurekaæ¶å¿½ç¥æã\n\nJVM System Propertyç¤ºä¾ï¼\n\n-Dspring.cloud.inetutils.ignoredInterfaces[0]=docker0\n\n-Dspring.cloud.inetutils.ignoredInterfaces[1]=veth.*\n\nOS Environment Variableç¤ºä¾ï¼\n\nSPRING_CLOUD_INETUTILS_IGNORED_INTERFACES[0]=docker0\n\nSPRING_CLOUD_INETUTILS_IGNORED_INTERFACES[1]=veth.*\n\n1.4.2 æå®è¦æ³¨åçip\n\nå¯ä»¥åå«ä¿®æ¹apollo-configserviceåapollo-adminserviceçstartup.shï¼éè¿JVM System Propertyä¼ å¥-Dåæ°ï¼ä¹å¯ä»¥éè¿OS Environment Variableä¼ å¥ï¼ä¸é¢çä¾å­ä¼æå®æ³¨åçIPä¸º1.2.3.4ã\n\nJVM System Propertyç¤ºä¾ï¼\n\n-Deureka.instance.ip-address=1.2.3.4\n\nOS Environment Variableç¤ºä¾ï¼\n\nEUREKA_INSTANCE_IP_ADDRESS=1.2.3.4\n\n1.4.3 æå®è¦æ³¨åçurl\n\nå¯ä»¥åå«ä¿®æ¹apollo-configserviceåapollo-adminserviceçstartup.shï¼éè¿JVM System Propertyä¼ å¥-Dåæ°ï¼ä¹å¯ä»¥éè¿OS Environment Variableä¼ å¥ï¼ä¸é¢çä¾å­ä¼æå®æ³¨åçURLä¸ºhttp://1.2.3.4:8080ã\n\nJVM System Propertyç¤ºä¾ï¼\n\n-Deureka.instance.homePageUrl=http://1.2.3.4:8080\n\n-Deureka.instance.preferIpAddress=false\n\nOS Environment Variableç¤ºä¾ï¼\n\nEUREKA_INSTANCE_HOME_PAGE_URL=http://1.2.3.4:8080\n\nEUREKA_INSTANCE_PREFER_IP_ADDRESS=false\n\n1.4.4 ç´æ¥æå®apollo-configserviceå°å\n\nå¦æApolloé¨ç½²å¨å¬æäºä¸ï¼æ¬å°å¼åç¯å¢æ æ³è¿æ¥ï¼ä½åéè¦åå¼åæµè¯çè¯ï¼å®¢æ·ç«¯å¯ä»¥åçº§å°0.11.0çæ¬åä»¥ä¸ï¼ç¶åéç½®è·³è¿Apollo Meta Serveræå¡åç°\n\näº é¨ç½²æ­¥éª¤\n\né¨ç½²æ­¥éª¤æ»ä½è¿æ¯æ¯è¾ç®åçï¼Apolloçå¯ä¸ä¾èµæ¯æ°æ®åºï¼æä»¥éè¦é¦åææ°æ®åºåå¤å¥½ï¼ç¶åæ ¹æ®å®éæåµï¼éæ©ä¸åçé¨ç½²æ¹å¼ï¼\n\n2.1 åå»ºæ°æ®åº\n\nApolloæå¡ç«¯å±éè¦ä¸¤ä¸ªæ°æ®åºï¼ApolloPortalDBåApolloConfigDBï¼æä»¬ææ°æ®åºãè¡¨çåå»ºåæ ·ä¾æ°æ®é½åå«åå¤äºsqlæä»¶ï¼åªéè¦å¯¼å¥æ°æ®åºå³å¯ã\n\néè¦æ³¨æçæ¯ApolloPortalDBåªéè¦å¨çäº§ç¯å¢é¨ç½²ä¸ä¸ªå³å¯ï¼èApolloConfigDBéè¦å¨æ¯ä¸ªç¯å¢é¨ç½²ä¸å¥ï¼å¦fatãuatåproåå«é¨ç½²3å¥ApolloConfigDBã\n\næ³¨æï¼å¦æä½ æ¬å°å·²ç»åå»ºè¿Apolloæ°æ®åºï¼è¯·æ³¨æå¤ä»½æ°æ®ãæä»¬åå¤çsqlæä»¶ä¼æ¸ç©ºApolloç¸å³çè¡¨ã\n\n2.1.1 åå»ºApolloPortalDB\n\nå¯ä»¥æ ¹æ®å®éæåµéæ©éè¿æå¨å¯¼å¥SQL\n\n2.1.1.1 æå¨å¯¼å¥sqlåå»º\n\néè¿åç§MySQLå®¢æ·ç«¯å¯¼å¥apolloportaldb.sqlå³å¯ã\n\nä»¥MySQLåçå®¢æ·ç«¯ä¸ºä¾ï¼\n\nsource /your_local_path/scripts/sql/apolloportaldb.sql\n\n2.1.1.2 éªè¯\n\nå¯¼å¥æååï¼å¯ä»¥éè¿æ§è¡ä»¥ä¸sqlè¯­å¥æ¥éªè¯ï¼\n\nselect Id, Key, Value, Comment from ApolloPortalDB.ServerConfig limit 1;ç¹å»å¤å¶éè¯¯å¤å¶æå\n\n                                  \nId   Key                  Value   Comment\n1    apollo.portal.envs   dev     å¯æ¯æçç¯å¢åè¡¨\n\næ³¨ï¼ApolloPortalDBåªéè¦å¨çäº§ç¯å¢é¨ç½²ä¸ä¸ªå³å¯\n\n2.1.2 åå»ºapolloconfigdb\n\nå¯ä»¥æ ¹æ®å®éæåµéæ©éè¿æå¨å¯¼å¥SQL\n\n2.1.2.1 æå¨å¯¼å¥sql\n\néè¿åç§MySQLå®¢æ·ç«¯å¯¼å¥apolloconfigdb.sqlå³å¯ã\n\nä»¥MySQLåçå®¢æ·ç«¯ä¸ºä¾ï¼\n\nsource /your_local_path/scripts/sql/apolloconfigdb.sql\n\n2.1.2.2 éªè¯\n\nå¯¼å¥æååï¼å¯ä»¥éè¿æ§è¡ä»¥ä¸sqlè¯­å¥æ¥éªè¯ï¼\n\nselect Id, Key, Value, Comment from ApolloConfigDB.ServerConfig limit 1;ç¹å»å¤å¶éè¯¯å¤å¶æå\n\n                                                          \nId   Key                  Value                           Comment\n1    eureka.service.url   http://127.0.0.1:8080/eureka/   Eurekaæå¡Url\n\næ³¨ï¼ApolloConfigDBéè¦å¨æ¯ä¸ªç¯å¢é¨ç½²ä¸å¥ï¼å¦fatãuatåproåå«é¨ç½²3å¥ApolloConfigDB\n\n2.1.2.3 ä»å«çç¯å¢å¯¼å¥apolloconfigdbæ°æ®\n\nå¦ææ¯å¨æ°é¨ç½²çApolloéç½®ä¸­å¿ï¼è¯·å¿½ç¥æ­¤æ­¥ã\n\nå¦æä¸æ¯å¨æ°é¨ç½²çApolloéç½®ä¸­å¿ï¼æ¯å¦å·²ç»ä½¿ç¨äºä¸æ®µæ¶é´ï¼è¿æ¶å¨Apolloéç½®ä¸­å¿å·²ç»åå»ºäºä¸å°é¡¹ç®ä»¥ånamespaceç­ï¼é£ä¹å¨æ°ç¯å¢ä¸­çApolloConfigDBä¸­éè¦ä»å¶å®æ­£å¸¸è¿è¡çç¯å¢ä¸­å¯¼å¥å¿è¦çé¡¹ç®æ°æ®ã\n\nä¸»è¦æ¶åApolloConfigDBçä¸é¢4å¼ è¡¨ï¼ä¸é¢åæ¶éä¸éè¦å¯¼å¥çæ°æ®æ¥è¯¢è¯­å¥ï¼\n\n 1. App\n\n * å¯¼å¥å¨é¨çApp\n * å¦ï¼insert into æ°ç¯å¢çApolloConfigDB.App select * from å¶å®ç¯å¢çApolloConfigDB.App where IsDeleted = 0;\n\n 2. AppNamespace\n\n * å¯¼å¥å¨é¨çAppNamespace\n * å¦ï¼insert into æ°ç¯å¢çApolloConfigDB.AppNamespace select * from å¶å®ç¯å¢çApolloConfigDB.AppNamespace where IsDeleted = 0;\n\n 3. Cluster\n\n * å¯¼å¥é»è®¤çdefaultéç¾¤\n * å¦ï¼insert into æ°ç¯å¢çApolloConfigDB.Cluster select * from å¶å®ç¯å¢çApolloConfigDB.Cluster where Name = \'default\' and IsDeleted = 0;\n\n 4. Namespace\n\n * å¯¼å¥é»è®¤çdefaultéç¾¤ä¸­çnamespace\n * å¦ï¼insert into æ°ç¯å¢çApolloConfigDB.Namespace select * from å¶å®ç¯å¢çApolloConfigDB.Namespace where ClusterName = \'default\' and IsDeleted = 0;\n\nåæ¶ä¹å«å¿äºéç¥ç¨æ·å¨æ°çç¯å¢ç»èªå·±çé¡¹ç®è®¾ç½®æ­£ç¡®çéç½®ä¿¡æ¯ï¼å°¤å¶æ¯ä¸äºå½±åé¢æ¯è¾å¤§çå¬å±namespaceéç½®ã\n\nå¦ææ¯ä¸ºæ­£å¨è¿è¡çç¯å¢è¿ç§»æ°æ®ï¼å»ºè®®è¿ç§»å®éå¯ä¸ä¸config serviceï¼å ä¸ºconfig serviceä¸­æappnamespaceçç¼å­æ°æ®\n\n2.1.3 è°æ´æå¡ç«¯éç½®\n\nApolloèªèº«çä¸äºéç½®æ¯æ¾å¨æ°æ®åºéé¢çï¼æä»¥éè¦éå¯¹å®éæåµåä¸äºè°æ´ï¼å·ä½åæ°è¯´æè¯·åèä¸ãæå¡ç«¯éç½®è¯´æã\n\nå¤§é¨åéç½®å¯ä»¥åä½¿ç¨é»è®¤å¼ï¼ä¸è¿ apollo.portal.envs å eureka.service.url è¯·å¡å¿éç½®æ­£ç¡®ååè¿è¡ä¸é¢çé¨ç½²æ­¥éª¤ã\n\n2.2 èææº/ç©çæºé¨ç½²\n\n2.2.1 è·åå®è£å\n\nå¯ä»¥éè¿ä¸¤ç§æ¹å¼è·åå®è£åï¼\n\n 1. ç´æ¥ä¸è½½å®è£å\n\n * ä»GitHub Releaseé¡µé¢ä¸è½½é¢åæå¥½çå®è£å\n * å¦æå¯¹Apolloçä»£ç æ²¡æå®å¶éæ±ï¼å»ºè®®ä½¿ç¨è¿ç§æ¹å¼ï¼å¯ä»¥çå»æ¬å°æåçè¿ç¨\n\n 2. éè¿æºç æå»º\n\n * ä»GitHub Releaseé¡µé¢ä¸è½½Source codeåæç´æ¥cloneæºç åå¨æ¬å°æå»º\n * å¦æéè¦å¯¹Apolloçåå®å¶å¼åï¼éè¦ä½¿ç¨è¿ç§æ¹å¼\n\n2.2.1.1 ç´æ¥ä¸è½½å®è£å\n\n2.2.1.1.1 è·åapollo-configserviceãapollo-adminserviceãapollo-portalå®è£å\n\nä»GitHub Releaseé¡µé¢ä¸è½½ææ°çæ¬çapollo-configservice-x.x.x-github.zipãapollo-adminservice-x.x.x-github.zipåapollo-portal-x.x.x-github.zipå³å¯ã\n\n2.2.1.1.2 éç½®æ°æ®åºè¿æ¥ä¿¡æ¯\n\nApolloæå¡ç«¯éè¦ç¥éå¦ä½è¿æ¥å°ä½ åé¢åå»ºçæ°æ®åºï¼æ°æ®åºè¿æ¥ä¸²ä¿¡æ¯ä½äºä¸ä¸æ­¥ä¸è½½çåç¼©åä¸­çconfig/application-github.propertiesä¸­ã\n\n2.2.1.1.2.1 éç½®apollo-configserviceçæ°æ®åºè¿æ¥ä¿¡æ¯\n\n 1. è§£åapollo-configservice-x.x.x-github.zip\n 2. ç¨ç¨åºåä¸ç¨ç¼è¾å¨ï¼å¦vimï¼notepad++ï¼sublimeç­ï¼æå¼configç®å½ä¸çapplication-github.propertiesæä»¶\n 3. å¡«åæ­£ç¡®çApolloConfigDBæ°æ®åºè¿æ¥ä¸²ä¿¡æ¯ï¼æ³¨æç¨æ·ååå¯ç åé¢ä¸è¦æç©ºæ ¼!\n 4. ä¿®æ¹å®çææå¦ä¸ï¼\n\n\n# DataSource\n\nspring.datasource.url = jdbc:mysql://localhost:3306/ApolloConfigDB?useSSL=false&characterEncoding=utf8\n\nspring.datasource.username = someuser\n\nspring.datasource.password = somepwdç¹å»å¤å¶éè¯¯å¤å¶æå\n\næ³¨ï¼ç±äºApolloConfigDBå¨æ¯ä¸ªç¯å¢é½æé¨ç½²ï¼æä»¥å¯¹ä¸åçç¯å¢config-serviceéè¦éç½®å¯¹åºç¯å¢çæ°æ®åºåæ°\n\n2.2.1.1.2.2 éç½®apollo-adminserviceçæ°æ®åºè¿æ¥ä¿¡æ¯\n\n 1. è§£åapollo-adminservice-x.x.x-github.zip\n 2. ç¨ç¨åºåä¸ç¨ç¼è¾å¨ï¼å¦vimï¼notepad++ï¼sublimeç­ï¼æå¼configç®å½ä¸çapplication-github.propertiesæä»¶\n 3. å¡«åæ­£ç¡®çApolloConfigDBæ°æ®åºè¿æ¥ä¸²ä¿¡æ¯ï¼æ³¨æç¨æ·ååå¯ç åé¢ä¸è¦æç©ºæ ¼!\n 4. ä¿®æ¹å®çææå¦ä¸ï¼\n\n\n# DataSource\n\nspring.datasource.url = jdbc:mysql://localhost:3306/ApolloConfigDB?useSSL=false&characterEncoding=utf8\n\nspring.datasource.username = someuser\n\nspring.datasource.password = somepwdç¹å»å¤å¶éè¯¯å¤å¶æå\n\næ³¨ï¼ç±äºApolloConfigDBå¨æ¯ä¸ªç¯å¢é½æé¨ç½²ï¼æä»¥å¯¹ä¸åçç¯å¢admin-serviceéè¦éç½®å¯¹åºç¯å¢çæ°æ®åºåæ°\n\n2.2.1.1.2.3 éç½®apollo-portalçæ°æ®åºè¿æ¥ä¿¡æ¯\n\n 1. è§£åapollo-portal-x.x.x-github.zip\n 2. ç¨ç¨åºåä¸ç¨ç¼è¾å¨ï¼å¦vimï¼notepad++ï¼sublimeç­ï¼æå¼configç®å½ä¸çapplication-github.propertiesæä»¶\n 3. å¡«åæ­£ç¡®çApolloPortalDBæ°æ®åºè¿æ¥ä¸²ä¿¡æ¯ï¼æ³¨æç¨æ·ååå¯ç åé¢ä¸è¦æç©ºæ ¼!\n 4. ä¿®æ¹å®çææå¦ä¸ï¼\n\n\n# DataSource\n\nspring.datasource.url = jdbc:mysql://localhost:3306/ApolloPortalDB?useSSL=false&characterEncoding=utf8\n\nspring.datasource.username = someuser\n\nspring.datasource.password = somepwdç¹å»å¤å¶éè¯¯å¤å¶æå\n\n2.2.1.1.2.4 éç½®apollo-portalçmeta serviceä¿¡æ¯\n\nApollo Portaléè¦å¨ä¸åçç¯å¢è®¿é®ä¸åçmeta service(apollo-configservice)å°åï¼æä»¥æä»¬éè¦å¨éç½®ä¸­æä¾è¿äºä¿¡æ¯ãé»è®¤æåµä¸ï¼meta serviceåconfig serviceæ¯é¨ç½²å¨åä¸ä¸ªJVMè¿ç¨ï¼æä»¥meta serviceçå°åå°±æ¯config serviceçå°åã\n\nå¯¹äº1.6.0åä»¥ä¸çæ¬ï¼å¯ä»¥éè¿ApolloPortalDB.ServerConfigä¸­çéç½®é¡¹æ¥éç½®Meta Serviceå°åï¼è¯¦è§apollo.portal.meta.servers - åç¯å¢Meta Serviceåè¡¨\n\nä½¿ç¨ç¨åºåä¸ç¨ç¼è¾å¨ï¼å¦vimï¼notepad++ï¼sublimeç­ï¼æå¼apollo-portal-x.x.x-github.zipä¸­configç®å½ä¸çapollo-env.propertiesæä»¶ã\n\nåè®¾DEVçapollo-configserviceæªç»å®ååï¼å°åæ¯1.1.1.1:8080ï¼FATçapollo-configserviceç»å®äºååapollo.fat.xxx.comï¼UATçapollo-configserviceç»å®äºååapollo.uat.xxx.comï¼PROçapollo-configserviceç»å®äºååapollo.xxx.comï¼é£ä¹å¯ä»¥å¦ä¸ä¿®æ¹åç¯å¢meta serviceæå¡å°åï¼æ ¼å¼ä¸º${env}.meta=http://${config-service-url:port}ï¼å¦ææä¸ªç¯å¢ä¸éè¦ï¼ä¹å¯ä»¥ç´æ¥å é¤å¯¹åºçéç½®é¡¹ï¼å¦lpt.metaï¼ï¼\n\ndev.meta=http://1.1.1.1:8080\n\nfat.meta=http://apollo.fat.xxx.com\n\nuat.meta=http://apollo.uat.xxx.com\n\npro.meta=http://apollo.xxx.comç¹å»å¤å¶éè¯¯å¤å¶æå\n\né¤äºéè¿apollo-env.propertiesæ¹å¼éç½®meta serviceä»¥å¤ï¼apolloä¹æ¯æå¨è¿è¡æ¶æå®meta serviceï¼ä¼åçº§æ¯apollo-env.propertiesé«ï¼ï¼\n\n 1. éè¿Java System Property\n\n${env}_meta\n\n * å¯ä»¥éè¿JavaçSystem Property ${env}_metaæ¥æå®\n\n * å¦java -Ddev_meta=http://config-service-url -jar xxx.jar\n\n * ä¹å¯ä»¥éè¿ç¨åºæå®ï¼å¦System.setProperty("dev_meta", "http://config-service-url");\n\n 2. éè¿æä½ç³»ç»çSystem Environment\n\n${ENV}_META\n\n * å¦DEV_META=http://config-service-url\n * æ³¨ækeyä¸ºå¨å¤§åï¼ä¸ä¸­é´æ¯_åé\n\næ³¨1: ä¸ºäºå®ç°meta serviceçé«å¯ç¨ï¼æ¨èéè¿SLBï¼Software Load Balancerï¼åå¨æè´è½½åè¡¡\n\næ³¨2: meta serviceå°åä¹å¯ä»¥å¡«å¥IPï¼0.11.0çæ¬ä¹ååªæ¯æå¡«å¥ä¸ä¸ªIPãä»0.11.0çæ¬å¼å§æ¯æå¡«å¥ä»¥éå·åéçå¤ä¸ªå°åï¼PR #1214ï¼ï¼å¦http://1.1.1.1:8080,http://2.2.2.2:8080ï¼ä¸è¿çäº§ç¯å¢è¿æ¯å»ºè®®ä½¿ç¨ååï¼èµ°slbï¼ï¼å ä¸ºæºå¨æ©å®¹ãç¼©å®¹ç­é½å¯è½å¯¼è´IPåè¡¨çååã\n\n2.2.1.2 éè¿æºç æå»º\n\n2.2.1.2.1 éç½®æ°æ®åºè¿æ¥ä¿¡æ¯\n\nApolloæå¡ç«¯éè¦ç¥éå¦ä½è¿æ¥å°ä½ åé¢åå»ºçæ°æ®åºï¼æä»¥éè¦ç¼è¾scripts/build.shï¼ä¿®æ¹ApolloPortalDBåApolloConfigDBç¸å³çæ°æ®åºè¿æ¥ä¸²ä¿¡æ¯ã\n\næ³¨æï¼å¡«å¥çç¨æ·éè¦å·å¤å¯¹ApolloPortalDBåApolloConfigDBæ°æ®çè¯»åæéã\n\n#apollo config db info\n\napollo_config_db_url=jdbc:mysql://localhost:3306/ApolloConfigDB?useSSL=false&characterEncoding=utf8\n\napollo_config_db_username=ç¨æ·å\n\napollo_config_db_password=å¯ç ï¼å¦ææ²¡æå¯ç ï¼çç©ºå³å¯ï¼\n\n\n# apollo portal db info\n\napollo_portal_db_url=jdbc:mysql://localhost:3306/ApolloPortalDB?useSSL=false&characterEncoding=utf8\n\napollo_portal_db_username=ç¨æ·å\n\napollo_portal_db_password=å¯ç ï¼å¦ææ²¡æå¯ç ï¼çç©ºå³å¯ï¼ç¹å»å¤å¶éè¯¯å¤å¶æå\n\næ³¨1ï¼ç±äºApolloConfigDBå¨æ¯ä¸ªç¯å¢é½æé¨ç½²ï¼æä»¥å¯¹ä¸åçç¯å¢config-serviceåadmin-serviceéè¦ä½¿ç¨ä¸åçæ°æ®åºåæ°æä¸åçåï¼portalåªéè¦æä¸æ¬¡åå³å¯\n\næ³¨2ï¼å¦æä¸æ³config-serviceåadmin-serviceæ¯ä¸ªç¯å¢æä¸ä¸ªåçè¯ï¼ä¹å¯ä»¥éè¿è¿è¡æ¶ä¼ å¥æ°æ®åºè¿æ¥ä¸²ä¿¡æ¯å®ç°ï¼å·ä½å¯ä»¥åè Issue 869\n\næ³¨3ï¼æ¯ä¸ªç¯å¢é½éè¦ç¬ç«é¨ç½²ä¸å¥config-serviceãadmin-serviceåApolloConfigDB\n\n2.2.1.2.2 éç½®åç¯å¢meta serviceå°å\n\nApollo Portaléè¦å¨ä¸åçç¯å¢è®¿é®ä¸åçmeta service(apollo-configservice)å°åï¼æä»¥éè¦å¨æåæ¶æä¾è¿äºä¿¡æ¯ã\n\nåè®¾DEVçapollo-configserviceæªç»å®ååï¼å°åæ¯1.1.1.1:8080ï¼FATçapollo-configserviceç»å®äºååapollo.fat.xxx.comï¼UATçapollo-configserviceç»å®äºååapollo.uat.xxx.comï¼PROçapollo-configserviceç»å®äºååapollo.xxx.comï¼é£ä¹ç¼è¾scripts/build.shï¼å¦ä¸ä¿®æ¹åç¯å¢meta serviceæå¡å°åï¼æ ¼å¼ä¸º${env}_meta=http://${config-service-url:port}ï¼å¦ææä¸ªç¯å¢ä¸éè¦ï¼ä¹å¯ä»¥ç´æ¥å é¤å¯¹åºçéç½®é¡¹ï¼\n\ndev_meta=http://1.1.1.1:8080\n\nfat_meta=http://apollo.fat.xxx.com\n\nuat_meta=http://apollo.uat.xxx.com\n\npro_meta=http://apollo.xxx.com\n\nMETA_SERVERS_OPTS="-Ddev_meta=$dev_meta -Dfat_meta=$fat_meta -Duat_meta=$uat_meta -Dpro_meta=$pro_meta"\n\né¤äºå¨æåæ¶éç½®meta serviceä»¥å¤ï¼apolloä¹æ¯æå¨è¿è¡æ¶æå®meta serviceï¼\n\n 1. éè¿Java System Property\n\n${env}_meta\n\n * å¯ä»¥éè¿JavaçSystem Property ${env}_metaæ¥æå®\n\n * å¦java -Ddev_meta=http://config-service-url -jar xxx.jar\n\n * ä¹å¯ä»¥éè¿ç¨åºæå®ï¼å¦System.setProperty("dev_meta", "http://config-service-url");\n\n 2. éè¿æä½ç³»ç»çSystem Environment\n\n${ENV}_META\n\n * å¦DEV_META=http://config-service-url\n * æ³¨ækeyä¸ºå¨å¤§åï¼ä¸ä¸­é´æ¯_åé\n\næ³¨1: ä¸ºäºå®ç°meta serviceçé«å¯ç¨ï¼æ¨èéè¿SLBï¼Software Load Balancerï¼åå¨æè´è½½åè¡¡\n\næ³¨2: meta serviceå°åä¹å¯ä»¥å¡«å¥IPï¼0.11.0çæ¬ä¹ååªæ¯æå¡«å¥ä¸ä¸ªIPãä»0.11.0çæ¬å¼å§æ¯æå¡«å¥ä»¥éå·åéçå¤ä¸ªå°åï¼PR #1214ï¼ï¼å¦http://1.1.1.1:8080,http://2.2.2.2:8080ï¼ä¸è¿çäº§ç¯å¢è¿æ¯å»ºè®®ä½¿ç¨ååï¼èµ°slbï¼ï¼å ä¸ºæºå¨æ©å®¹ãç¼©å®¹ç­é½å¯è½å¯¼è´IPåè¡¨çååã\n\n2.2.1.2.3 æ§è¡ç¼è¯ãæå\n\nåå®ä¸è¿°éç½®åï¼å°±å¯ä»¥æ§è¡ç¼è¯åæåäºã\n\næ³¨ï¼åæ¬¡ç¼è¯ä¼ä»Mavenä¸­å¤®ä»åºä¸è½½ä¸å°ä¾èµï¼å¦æç½ç»æåµä¸ä½³æ¶å¾å®¹æåºéï¼å»ºè®®ä½¿ç¨å½åçMavenä»åºæºï¼æ¯å¦é¿éäºMavenéå\n\n./build.sh\n\nè¯¥èæ¬ä¼ä¾æ¬¡æåapollo-configservice, apollo-adminservice, apollo-portalã\n\næ³¨ï¼ç±äºApolloConfigDBå¨æ¯ä¸ªç¯å¢é½æé¨ç½²ï¼æä»¥å¯¹ä¸åç¯å¢çconfig-serviceåadmin-serviceéè¦ä½¿ç¨ä¸åçæ°æ®åºè¿æ¥ä¿¡æ¯æä¸åçåï¼portalåªéè¦æä¸æ¬¡åå³å¯\n\n2.2.1.2.4 è·åapollo-configserviceå®è£å\n\nä½äºapollo-configservice/target/ç®å½ä¸çapollo-configservice-x.x.x-github.zip\n\néè¦æ³¨æçæ¯ç±äºApolloConfigDBå¨æ¯ä¸ªç¯å¢é½æé¨ç½²ï¼æä»¥å¯¹ä¸åç¯å¢çconfig-serviceéè¦ä½¿ç¨ä¸åçæ°æ®åºåæ°æä¸åçåååå«é¨ç½²\n\n2.2.1.2.5 è·åapollo-adminserviceå®è£å\n\nä½äºapollo-adminservice/target/ç®å½ä¸çapollo-adminservice-x.x.x-github.zip\n\néè¦æ³¨æçæ¯ç±äºApolloConfigDBå¨æ¯ä¸ªç¯å¢é½æé¨ç½²ï¼æä»¥å¯¹ä¸åç¯å¢çadmin-serviceéè¦ä½¿ç¨ä¸åçæ°æ®åºåæ°æä¸åçåååå«é¨ç½²\n\n2.2.1.2.6 è·åapollo-portalå®è£å\n\nä½äºapollo-portal/target/ç®å½ä¸çapollo-portal-x.x.x-github.zip\n\n2.2.1.2.7 å¯ç¨å¤é¨nacosæå¡æ³¨åä¸­å¿æ¿æ¢åç½®eureka\n\n 1. ä¿®æ¹build.sh/build.batï¼å°config-serviceåadmin-serviceçmavenç¼è¯å½ä»¤æ´æ¹ä¸º\n\nmvn clean package -Pgithub,nacos-discovery -DskipTests -pl apollo-configservice,apollo-adminservice -am -Dapollo_profile=github,nacos-discovery -Dspring_datasource_url=$apollo_config_db_url -Dspring_datasource_username=$apollo_config_db_username -Dspring_datasource_password=$apollo_config_db_passwordç¹å»å¤å¶éè¯¯å¤å¶æå\n\n 2. åå«ä¿®æ¹apollo-configserviceåapollo-adminserviceå®è£åä¸­configç®å½ä¸çapplication-github.propertiesï¼éç½®nacosæå¡å¨å°å\n\nnacos.discovery.server-addr=127.0.0.1:8848\n\n\n# æ´å¤ nacos éç½®\n\nnacos.discovery.access-key=\n\nnacos.discovery.username=\n\nnacos.discovery.password=\n\nnacos.discovery.secret-key=\n\nnacos.discovery.namespace=\n\nnacos.discovery.context-path=\n\n2.2.1.2.8 å¯ç¨å¤é¨Consulæå¡æ³¨åä¸­å¿æ¿æ¢åç½®eureka\n\n 1. ä¿®æ¹build.sh/build.batï¼å°config-serviceåadmin-serviceçmavenç¼è¯å½ä»¤æ´æ¹ä¸º\n\nmvn clean package -Pgithub -DskipTests -pl apollo-configservice,apollo-adminservice -am -Dapollo_profile=github,consul-discovery -Dspring_datasource_url=$apollo_config_db_url -Dspring_datasource_username=$apollo_config_db_username -Dspring_datasource_password=$apollo_config_db_password\n\n 2. åå«ä¿®æ¹apollo-configserviceåapollo-adminserviceå®è£åä¸­configç®å½ä¸çapplication-github.propertiesï¼éç½®consulæå¡å¨å°å\n\nspring.cloud.consul.host=127.0.0.1\n\nspring.cloud.consul.port=8500ç¹\n\n2.2.2 é¨ç½²Apolloæå¡ç«¯\n\n2.2.2.1 é¨ç½²apollo-configservice\n\nå°å¯¹åºç¯å¢çapollo-configservice-x.x.x-github.zipä¸ä¼ å°æå¡å¨ä¸ï¼è§£ååæ§è¡scripts/startup.shå³å¯ãå¦éåæ­¢æå¡ï¼æ§è¡scripts/shutdown.sh.\n\nè®°å¾å¨scripts/startup.shä¸­æç§å®éçç¯å¢è®¾ç½®ä¸ä¸ªJVMåå­ï¼ä»¥ä¸æ¯æä»¬çé»è®¤è®¾ç½®ï¼ä¾åèï¼\n\nexport JAVA_OPTS="-server -Xms6144m -Xmx6144m -Xss256k -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=384m -XX:NewSize=4096m -XX:MaxNewSize=4096m -XX:SurvivorRatio=18"ç¹å»å¤å¶éè¯¯å¤å¶æå\n\næ³¨1ï¼å¦æéè¦ä¿®æ¹JVMåæ°ï¼å¯ä»¥ä¿®æ¹scripts/startup.shçJAVA_OPTSé¨åã\n\næ³¨2ï¼å¦è¦è°æ´æå¡çæ¥å¿è¾åºè·¯å¾ï¼å¯ä»¥ä¿®æ¹scripts/startup.shåapollo-configservice.confä¸­çLOG_DIRã\n\næ³¨3ï¼å¦è¦è°æ´æå¡ççå¬ç«¯å£ï¼å¯ä»¥ä¿®æ¹scripts/startup.shä¸­çSERVER_PORTãå¦å¤apollo-configserviceåæ¶æ¿æmeta serverèè´£ï¼å¦æè¦ä¿®æ¹ç«¯å£ï¼æ³¨æè¦åæ¶ApolloConfigDB.ServerConfigè¡¨ä¸­çeureka.service.urléç½®é¡¹ä»¥åapollo-portalåapollo-clientä¸­çä½¿ç¨å°çmeta serverä¿¡æ¯ï¼è¯¦è§ï¼2.2.1.1.2.4 éç½®apollo-portalçmeta serviceä¿¡æ¯å1.2.2 Apollo Meta Serverã\n\næ³¨4ï¼å¦æApolloConfigDB.ServerConfigçeureka.service.urlåªéäºå½åæ­£å¨å¯å¨çæºå¨çè¯ï¼å¨å¯å¨apollo-configserviceçè¿ç¨ä¸­ä¼å¨æ¥å¿ä¸­è¾åºeurekaæ³¨åå¤±è´¥çä¿¡æ¯ï¼å¦com.sun.jersey.api.client.ClientHandlerException: java.net.ConnectException: Connection refusedãéè¦æ³¨æçæ¯ï¼è¿ä¸ªæ¯é¢æçæåµï¼å ä¸ºapollo-configserviceéè¦åMeta Serverï¼å®èªå·±ï¼æ³¨åæå¡ï¼ä½æ¯å ä¸ºå¨å¯å¨è¿ç¨ä¸­ï¼èªå·±è¿æ²¡èµ·æ¥ï¼æä»¥ä¼æ¥è¿ä¸ªéãåé¢ä¼è¿è¡éè¯çå¨ä½ï¼æä»¥ç­èªå·±æå¡èµ·æ¥åå°±ä¼æ³¨åæ­£å¸¸äºã\n\næ³¨5ï¼å¦æä½ çå°äºè¿éï¼ç¸ä¿¡ä½ ä¸å®æ¯ä¸ä¸ªç»å¿éè¯»ææ¡£çäººï¼èä¸ç¦»æåå°±å·®ä¸ç¹ç¹äºï¼ç»§ç»­å æ²¹ï¼åºè¯¥å¾å¿«å°±è½å®æApolloçåå¸å¼é¨ç½²äºï¼ä¸è¿ä½ æ¯å¦ææè§Apolloçåå¸å¼é¨ç½²æ­¥éª¤æç¹ç¹çï¼æ¯å¦æå¥å»ºè®®æ³è¦åä½èè¯´ï¼å¦æç­æ¡æ¯è¯å®çè¯ï¼è¯·ç§»æ­¥ #1424ï¼æå¾ä½ çå»ºè®®ï¼\n\n2.2.2.2 é¨ç½²apollo-adminservice\n\nå°å¯¹åºç¯å¢çapollo-adminservice-x.x.x-github.zipä¸ä¼ å°æå¡å¨ä¸ï¼è§£ååæ§è¡scripts/startup.shå³å¯ãå¦éåæ­¢æå¡ï¼æ§è¡scripts/shutdown.sh.\n\nè®°å¾å¨scripts/startup.shä¸­æç§å®éçç¯å¢è®¾ç½®ä¸ä¸ªJVMåå­ï¼ä»¥ä¸æ¯æä»¬çé»è®¤è®¾ç½®ï¼ä¾åèï¼\n\nexport JAVA_OPTS="-server -Xms2560m -Xmx2560m -Xss256k -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=384m -XX:NewSize=1024m -XX:MaxNewSize=1024m -XX:SurvivorRatio=22"\n\næ³¨1ï¼å¦æéè¦ä¿®æ¹JVMåæ°ï¼å¯ä»¥ä¿®æ¹scripts/startup.shçJAVA_OPTSé¨åã\n\næ³¨2ï¼å¦è¦è°æ´æå¡çæ¥å¿è¾åºè·¯å¾ï¼å¯ä»¥ä¿®æ¹scripts/startup.shåapollo-adminservice.confä¸­çLOG_DIRã\n\næ³¨3ï¼å¦è¦è°æ´æå¡ççå¬ç«¯å£ï¼å¯ä»¥ä¿®æ¹scripts/startup.shä¸­çSERVER_PORTã\n\n2.2.2.3 é¨ç½²apollo-portal\n\nå°apollo-portal-x.x.x-github.zipä¸ä¼ å°æå¡å¨ä¸ï¼è§£ååæ§è¡scripts/startup.shå³å¯ãå¦éåæ­¢æå¡ï¼æ§è¡scripts/shutdown.sh.\n\nè®°å¾å¨startup.shä¸­æç§å®éçç¯å¢è®¾ç½®ä¸ä¸ªJVMåå­ï¼ä»¥ä¸æ¯æä»¬çé»è®¤è®¾ç½®ï¼ä¾åèï¼\n\nexport JAVA_OPTS="-server -Xms4096m -Xmx4096m -Xss256k -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=384m -XX:NewSize=1536m -XX:MaxNewSize=1536m -XX:SurvivorRatio=22"\n\næ³¨1ï¼å¦æéè¦ä¿®æ¹JVMåæ°ï¼å¯ä»¥ä¿®æ¹scripts/startup.shçJAVA_OPTSé¨åã\n\næ³¨2ï¼å¦è¦è°æ´æå¡çæ¥å¿è¾åºè·¯å¾ï¼å¯ä»¥ä¿®æ¹scripts/startup.shåapollo-portal.confä¸­çLOG_DIRã\n\næ³¨3ï¼å¦è¦è°æ´æå¡ççå¬ç«¯å£ï¼å¯ä»¥ä¿®æ¹scripts/startup.shä¸­çSERVER_PORTã',normalizedContent:'æ¬ææ¡£ä»ç»äºå¦ä½æç§åå¸å¼é¨ç½²çæ¹å¼ç¼è¯ãæåãé¨ç½²apolloéç½®ä¸­å¿ï¼ä»èå¯ä»¥å¨å¼åãæµè¯ãçäº§ç­ç¯å¢åå«é¨ç½²è¿è¡ã\n\nä¸ãåå¤å·¥ä½\n\n1.1 è¿è¡æ¶ç¯å¢\n\n1.1.1 os\n\næå¡ç«¯åºäºspring bootï¼å¯å¨èæ¬çè®ºä¸æ¯ææælinuxåè¡çï¼å»ºè®®centos 7\n\n1.1.2 java\n\n * apolloæå¡ç«¯ï¼1.8+\n * apolloå®¢æ·ç«¯ï¼1.7+\n\nç±äºéè¦åæ¶è¿è¡æå¡ç«¯åå®¢æ·ç«¯ï¼æä»¥å»ºè®®å®è£java 1.8+ã\n\nå¯¹äºapolloå®¢æ·ç«¯ï¼è¿è¡æ¶ç¯å¢åªéè¦1.7+å³å¯ã\n\næ³¨ï¼å¯¹äºapolloå®¢æ·ç«¯ï¼å¦ææéè¦çè¯ï¼å¯ä»¥åå°éä»£ç ä¿®æ¹æ¥éçº§å°java 1.6\n\nå¨éç½®å¥½åï¼å¯ä»¥éè¿å¦ä¸å½ä»¤æ£æ¥ï¼\n\njava -version\n\næ ·ä¾è¾åºï¼\n\njava version "1.8.0_74"\n\njava(tm) se runtime environment (build 1.8.0_74-b02)\n\njava hotspot(tm) 64-bit server vm (build 25.74-b02, mixed mode)\n\n1.2 mysql\n\n * çæ¬è¦æ±ï¼5.6.5+\n\napolloçè¡¨ç»æå¯¹timestampä½¿ç¨äºå¤ä¸ªdefaultå£°æï¼æä»¥éè¦5.6.5ä»¥ä¸çæ¬ã\n\nè¿æ¥ä¸mysqlåï¼å¯ä»¥éè¿å¦ä¸å½ä»¤æ£æ¥ï¼\n\nshow variables where variable_name = \'version\';ç¹å»å¤å¶éè¯¯å¤å¶æå\n\n                \nvariable_name   value\nversion         5.7.11\n\n1.3 ç¯å¢\n\nåå¸å¼é¨ç½²éè¦äºåç¡®å®é¨ç½²çç¯å¢ä»¥åé¨ç½²æ¹å¼ã\n\napolloç®åæ¯æä»¥ä¸ç¯å¢ï¼\n\n * dev\n\n * å¼åç¯å¢\n\n * fat\n\n * æµè¯ç¯å¢ï¼ç¸å½äºalphaç¯å¢(åè½æµè¯)\n\n * uat\n\n * éæç¯å¢ï¼ç¸å½äºbetaç¯å¢ï¼åå½æµè¯ï¼\n\n * pro\n\n * çäº§ç¯å¢\n\nå¦æå¸ææ·»å èªå®ä¹çç¯å¢åç§°ï¼å·ä½æ­¥éª¤å¯ä»¥åèportalå¦ä½å¢å ç¯å¢\n\n1.4 ç½ç»ç­ç¥\n\nåå¸å¼é¨ç½²çæ¶åï¼apollo-configserviceåapollo-adminserviceéè¦æèªå·±çipåç«¯å£æ³¨åå°meta serverï¼apollo-configserviceæ¬èº«ï¼ã\n\napolloå®¢æ·ç«¯åportalä¼ä»meta serverè·åæå¡çå°åï¼ip+ç«¯å£ï¼ï¼ç¶åéè¿æå¡å°åç´æ¥è®¿é®ã\n\néè¦æ³¨æçæ¯ï¼apollo-configserviceåapollo-adminserviceæ¯åºäºåç½å¯ä¿¡ç½ç»è®¾è®¡çï¼æä»¥åºäºå®å¨èèï¼è¯·ä¸è¦å°apollo-configserviceåapollo-adminserviceç´æ¥æ´é²å¨å¬ç½ã\n\næä»¥å¦æå®éé¨ç½²çæºå¨æå¤åç½å¡ï¼å¦dockerï¼ï¼æèå­å¨æäºç½å¡çipæ¯apolloå®¢æ·ç«¯åportalæ æ³è®¿é®çï¼å¦ç½ç»å®å¨éå¶ï¼ï¼é£ä¹æä»¬å°±éè¦å¨apollo-configserviceåapollo-adminserviceä¸­åç¸å³éç½®æ¥è§£å³è¿éæ§é®é¢ã\n\n1.4.1 å¿½ç¥æäºç½å¡\n\nå¯ä»¥åå«ä¿®æ¹apollo-configserviceåapollo-adminserviceçstartup.shï¼éè¿jvm system propertyä¼ å¥-dåæ°ï¼ä¹å¯ä»¥éè¿os environment variableä¼ å¥ï¼ä¸é¢çä¾å­ä¼ædocker0åvethå¼å¤´çç½å¡å¨æ³¨åå°eurekaæ¶å¿½ç¥æã\n\njvm system propertyç¤ºä¾ï¼\n\n-dspring.cloud.inetutils.ignoredinterfaces[0]=docker0\n\n-dspring.cloud.inetutils.ignoredinterfaces[1]=veth.*\n\nos environment variableç¤ºä¾ï¼\n\nspring_cloud_inetutils_ignored_interfaces[0]=docker0\n\nspring_cloud_inetutils_ignored_interfaces[1]=veth.*\n\n1.4.2 æå®è¦æ³¨åçip\n\nå¯ä»¥åå«ä¿®æ¹apollo-configserviceåapollo-adminserviceçstartup.shï¼éè¿jvm system propertyä¼ å¥-dåæ°ï¼ä¹å¯ä»¥éè¿os environment variableä¼ å¥ï¼ä¸é¢çä¾å­ä¼æå®æ³¨åçipä¸º1.2.3.4ã\n\njvm system propertyç¤ºä¾ï¼\n\n-deureka.instance.ip-address=1.2.3.4\n\nos environment variableç¤ºä¾ï¼\n\neureka_instance_ip_address=1.2.3.4\n\n1.4.3 æå®è¦æ³¨åçurl\n\nå¯ä»¥åå«ä¿®æ¹apollo-configserviceåapollo-adminserviceçstartup.shï¼éè¿jvm system propertyä¼ å¥-dåæ°ï¼ä¹å¯ä»¥éè¿os environment variableä¼ å¥ï¼ä¸é¢çä¾å­ä¼æå®æ³¨åçurlä¸ºhttp://1.2.3.4:8080ã\n\njvm system propertyç¤ºä¾ï¼\n\n-deureka.instance.homepageurl=http://1.2.3.4:8080\n\n-deureka.instance.preferipaddress=false\n\nos environment variableç¤ºä¾ï¼\n\neureka_instance_home_page_url=http://1.2.3.4:8080\n\neureka_instance_prefer_ip_address=false\n\n1.4.4 ç´æ¥æå®apollo-configserviceå°å\n\nå¦æapolloé¨ç½²å¨å¬æäºä¸ï¼æ¬å°å¼åç¯å¢æ æ³è¿æ¥ï¼ä½åéè¦åå¼åæµè¯çè¯ï¼å®¢æ·ç«¯å¯ä»¥åçº§å°0.11.0çæ¬åä»¥ä¸ï¼ç¶åéç½®è·³è¿apollo meta serveræå¡åç°\n\näº é¨ç½²æ­¥éª¤\n\né¨ç½²æ­¥éª¤æ»ä½è¿æ¯æ¯è¾ç®åçï¼apolloçå¯ä¸ä¾èµæ¯æ°æ®åºï¼æä»¥éè¦é¦åææ°æ®åºåå¤å¥½ï¼ç¶åæ ¹æ®å®éæåµï¼éæ©ä¸åçé¨ç½²æ¹å¼ï¼\n\n2.1 åå»ºæ°æ®åº\n\napolloæå¡ç«¯å±éè¦ä¸¤ä¸ªæ°æ®åºï¼apolloportaldbåapolloconfigdbï¼æä»¬ææ°æ®åºãè¡¨çåå»ºåæ ·ä¾æ°æ®é½åå«åå¤äºsqlæä»¶ï¼åªéè¦å¯¼å¥æ°æ®åºå³å¯ã\n\néè¦æ³¨æçæ¯apolloportaldbåªéè¦å¨çäº§ç¯å¢é¨ç½²ä¸ä¸ªå³å¯ï¼èapolloconfigdbéè¦å¨æ¯ä¸ªç¯å¢é¨ç½²ä¸å¥ï¼å¦fatãuatåproåå«é¨ç½²3å¥apolloconfigdbã\n\næ³¨æï¼å¦æä½ æ¬å°å·²ç»åå»ºè¿apolloæ°æ®åºï¼è¯·æ³¨æå¤ä»½æ°æ®ãæä»¬åå¤çsqlæä»¶ä¼æ¸ç©ºapolloç¸å³çè¡¨ã\n\n2.1.1 åå»ºapolloportaldb\n\nå¯ä»¥æ ¹æ®å®éæåµéæ©éè¿æå¨å¯¼å¥sql\n\n2.1.1.1 æå¨å¯¼å¥sqlåå»º\n\néè¿åç§mysqlå®¢æ·ç«¯å¯¼å¥apolloportaldb.sqlå³å¯ã\n\nä»¥mysqlåçå®¢æ·ç«¯ä¸ºä¾ï¼\n\nsource /your_local_path/scripts/sql/apolloportaldb.sql\n\n2.1.1.2 éªè¯\n\nå¯¼å¥æååï¼å¯ä»¥éè¿æ§è¡ä»¥ä¸sqlè¯­å¥æ¥éªè¯ï¼\n\nselect id, key, value, comment from apolloportaldb.serverconfig limit 1;ç¹å»å¤å¶éè¯¯å¤å¶æå\n\n                                  \nid   key                  value   comment\n1    apollo.portal.envs   dev     å¯æ¯æçç¯å¢åè¡¨\n\næ³¨ï¼apolloportaldbåªéè¦å¨çäº§ç¯å¢é¨ç½²ä¸ä¸ªå³å¯\n\n2.1.2 åå»ºapolloconfigdb\n\nå¯ä»¥æ ¹æ®å®éæåµéæ©éè¿æå¨å¯¼å¥sql\n\n2.1.2.1 æå¨å¯¼å¥sql\n\néè¿åç§mysqlå®¢æ·ç«¯å¯¼å¥apolloconfigdb.sqlå³å¯ã\n\nä»¥mysqlåçå®¢æ·ç«¯ä¸ºä¾ï¼\n\nsource /your_local_path/scripts/sql/apolloconfigdb.sql\n\n2.1.2.2 éªè¯\n\nå¯¼å¥æååï¼å¯ä»¥éè¿æ§è¡ä»¥ä¸sqlè¯­å¥æ¥éªè¯ï¼\n\nselect id, key, value, comment from apolloconfigdb.serverconfig limit 1;ç¹å»å¤å¶éè¯¯å¤å¶æå\n\n                                                          \nid   key                  value                           comment\n1    eureka.service.url   http://127.0.0.1:8080/eureka/   eurekaæå¡url\n\næ³¨ï¼apolloconfigdbéè¦å¨æ¯ä¸ªç¯å¢é¨ç½²ä¸å¥ï¼å¦fatãuatåproåå«é¨ç½²3å¥apolloconfigdb\n\n2.1.2.3 ä»å«çç¯å¢å¯¼å¥apolloconfigdbæ°æ®\n\nå¦ææ¯å¨æ°é¨ç½²çapolloéç½®ä¸­å¿ï¼è¯·å¿½ç¥æ­¤æ­¥ã\n\nå¦æä¸æ¯å¨æ°é¨ç½²çapolloéç½®ä¸­å¿ï¼æ¯å¦å·²ç»ä½¿ç¨äºä¸æ®µæ¶é´ï¼è¿æ¶å¨apolloéç½®ä¸­å¿å·²ç»åå»ºäºä¸å°é¡¹ç®ä»¥ånamespaceç­ï¼é£ä¹å¨æ°ç¯å¢ä¸­çapolloconfigdbä¸­éè¦ä»å¶å®æ­£å¸¸è¿è¡çç¯å¢ä¸­å¯¼å¥å¿è¦çé¡¹ç®æ°æ®ã\n\nä¸»è¦æ¶åapolloconfigdbçä¸é¢4å¼ è¡¨ï¼ä¸é¢åæ¶éä¸éè¦å¯¼å¥çæ°æ®æ¥è¯¢è¯­å¥ï¼\n\n 1. app\n\n * å¯¼å¥å¨é¨çapp\n * å¦ï¼insert into æ°ç¯å¢çapolloconfigdb.app select * from å¶å®ç¯å¢çapolloconfigdb.app where isdeleted = 0;\n\n 2. appnamespace\n\n * å¯¼å¥å¨é¨çappnamespace\n * å¦ï¼insert into æ°ç¯å¢çapolloconfigdb.appnamespace select * from å¶å®ç¯å¢çapolloconfigdb.appnamespace where isdeleted = 0;\n\n 3. cluster\n\n * å¯¼å¥é»è®¤çdefaultéç¾¤\n * å¦ï¼insert into æ°ç¯å¢çapolloconfigdb.cluster select * from å¶å®ç¯å¢çapolloconfigdb.cluster where name = \'default\' and isdeleted = 0;\n\n 4. namespace\n\n * å¯¼å¥é»è®¤çdefaultéç¾¤ä¸­çnamespace\n * å¦ï¼insert into æ°ç¯å¢çapolloconfigdb.namespace select * from å¶å®ç¯å¢çapolloconfigdb.namespace where clustername = \'default\' and isdeleted = 0;\n\nåæ¶ä¹å«å¿äºéç¥ç¨æ·å¨æ°çç¯å¢ç»èªå·±çé¡¹ç®è®¾ç½®æ­£ç¡®çéç½®ä¿¡æ¯ï¼å°¤å¶æ¯ä¸äºå½±åé¢æ¯è¾å¤§çå¬å±namespaceéç½®ã\n\nå¦ææ¯ä¸ºæ­£å¨è¿è¡çç¯å¢è¿ç§»æ°æ®ï¼å»ºè®®è¿ç§»å®éå¯ä¸ä¸config serviceï¼å ä¸ºconfig serviceä¸­æappnamespaceçç¼å­æ°æ®\n\n2.1.3 è°æ´æå¡ç«¯éç½®\n\napolloèªèº«çä¸äºéç½®æ¯æ¾å¨æ°æ®åºéé¢çï¼æä»¥éè¦éå¯¹å®éæåµåä¸äºè°æ´ï¼å·ä½åæ°è¯´æè¯·åèä¸ãæå¡ç«¯éç½®è¯´æã\n\nå¤§é¨åéç½®å¯ä»¥åä½¿ç¨é»è®¤å¼ï¼ä¸è¿ apollo.portal.envs å eureka.service.url è¯·å¡å¿éç½®æ­£ç¡®ååè¿è¡ä¸é¢çé¨ç½²æ­¥éª¤ã\n\n2.2 èææº/ç©çæºé¨ç½²\n\n2.2.1 è·åå®è£å\n\nå¯ä»¥éè¿ä¸¤ç§æ¹å¼è·åå®è£åï¼\n\n 1. ç´æ¥ä¸è½½å®è£å\n\n * ä»github releaseé¡µé¢ä¸è½½é¢åæå¥½çå®è£å\n * å¦æå¯¹apolloçä»£ç æ²¡æå®å¶éæ±ï¼å»ºè®®ä½¿ç¨è¿ç§æ¹å¼ï¼å¯ä»¥çå»æ¬å°æåçè¿ç¨\n\n 2. éè¿æºç æå»º\n\n * ä»github releaseé¡µé¢ä¸è½½source codeåæç´æ¥cloneæºç åå¨æ¬å°æå»º\n * å¦æéè¦å¯¹apolloçåå®å¶å¼åï¼éè¦ä½¿ç¨è¿ç§æ¹å¼\n\n2.2.1.1 ç´æ¥ä¸è½½å®è£å\n\n2.2.1.1.1 è·åapollo-configserviceãapollo-adminserviceãapollo-portalå®è£å\n\nä»github releaseé¡µé¢ä¸è½½ææ°çæ¬çapollo-configservice-x.x.x-github.zipãapollo-adminservice-x.x.x-github.zipåapollo-portal-x.x.x-github.zipå³å¯ã\n\n2.2.1.1.2 éç½®æ°æ®åºè¿æ¥ä¿¡æ¯\n\napolloæå¡ç«¯éè¦ç¥éå¦ä½è¿æ¥å°ä½ åé¢åå»ºçæ°æ®åºï¼æ°æ®åºè¿æ¥ä¸²ä¿¡æ¯ä½äºä¸ä¸æ­¥ä¸è½½çåç¼©åä¸­çconfig/application-github.propertiesä¸­ã\n\n2.2.1.1.2.1 éç½®apollo-configserviceçæ°æ®åºè¿æ¥ä¿¡æ¯\n\n 1. è§£åapollo-configservice-x.x.x-github.zip\n 2. ç¨ç¨åºåä¸ç¨ç¼è¾å¨ï¼å¦vimï¼notepad++ï¼sublimeç­ï¼æå¼configç®å½ä¸çapplication-github.propertiesæä»¶\n 3. å¡«åæ­£ç¡®çapolloconfigdbæ°æ®åºè¿æ¥ä¸²ä¿¡æ¯ï¼æ³¨æç¨æ·ååå¯ç åé¢ä¸è¦æç©ºæ ¼!\n 4. ä¿®æ¹å®çææå¦ä¸ï¼\n\n\n# datasource\n\nspring.datasource.url = jdbc:mysql://localhost:3306/apolloconfigdb?usessl=false&characterencoding=utf8\n\nspring.datasource.username = someuser\n\nspring.datasource.password = somepwdç¹å»å¤å¶éè¯¯å¤å¶æå\n\næ³¨ï¼ç±äºapolloconfigdbå¨æ¯ä¸ªç¯å¢é½æé¨ç½²ï¼æä»¥å¯¹ä¸åçç¯å¢config-serviceéè¦éç½®å¯¹åºç¯å¢çæ°æ®åºåæ°\n\n2.2.1.1.2.2 éç½®apollo-adminserviceçæ°æ®åºè¿æ¥ä¿¡æ¯\n\n 1. è§£åapollo-adminservice-x.x.x-github.zip\n 2. ç¨ç¨åºåä¸ç¨ç¼è¾å¨ï¼å¦vimï¼notepad++ï¼sublimeç­ï¼æå¼configç®å½ä¸çapplication-github.propertiesæä»¶\n 3. å¡«åæ­£ç¡®çapolloconfigdbæ°æ®åºè¿æ¥ä¸²ä¿¡æ¯ï¼æ³¨æç¨æ·ååå¯ç åé¢ä¸è¦æç©ºæ ¼!\n 4. ä¿®æ¹å®çææå¦ä¸ï¼\n\n\n# datasource\n\nspring.datasource.url = jdbc:mysql://localhost:3306/apolloconfigdb?usessl=false&characterencoding=utf8\n\nspring.datasource.username = someuser\n\nspring.datasource.password = somepwdç¹å»å¤å¶éè¯¯å¤å¶æå\n\næ³¨ï¼ç±äºapolloconfigdbå¨æ¯ä¸ªç¯å¢é½æé¨ç½²ï¼æä»¥å¯¹ä¸åçç¯å¢admin-serviceéè¦éç½®å¯¹åºç¯å¢çæ°æ®åºåæ°\n\n2.2.1.1.2.3 éç½®apollo-portalçæ°æ®åºè¿æ¥ä¿¡æ¯\n\n 1. è§£åapollo-portal-x.x.x-github.zip\n 2. ç¨ç¨åºåä¸ç¨ç¼è¾å¨ï¼å¦vimï¼notepad++ï¼sublimeç­ï¼æå¼configç®å½ä¸çapplication-github.propertiesæä»¶\n 3. å¡«åæ­£ç¡®çapolloportaldbæ°æ®åºè¿æ¥ä¸²ä¿¡æ¯ï¼æ³¨æç¨æ·ååå¯ç åé¢ä¸è¦æç©ºæ ¼!\n 4. ä¿®æ¹å®çææå¦ä¸ï¼\n\n\n# datasource\n\nspring.datasource.url = jdbc:mysql://localhost:3306/apolloportaldb?usessl=false&characterencoding=utf8\n\nspring.datasource.username = someuser\n\nspring.datasource.password = somepwdç¹å»å¤å¶éè¯¯å¤å¶æå\n\n2.2.1.1.2.4 éç½®apollo-portalçmeta serviceä¿¡æ¯\n\napollo portaléè¦å¨ä¸åçç¯å¢è®¿é®ä¸åçmeta service(apollo-configservice)å°åï¼æä»¥æä»¬éè¦å¨éç½®ä¸­æä¾è¿äºä¿¡æ¯ãé»è®¤æåµä¸ï¼meta serviceåconfig serviceæ¯é¨ç½²å¨åä¸ä¸ªjvmè¿ç¨ï¼æä»¥meta serviceçå°åå°±æ¯config serviceçå°åã\n\nå¯¹äº1.6.0åä»¥ä¸çæ¬ï¼å¯ä»¥éè¿apolloportaldb.serverconfigä¸­çéç½®é¡¹æ¥éç½®meta serviceå°åï¼è¯¦è§apollo.portal.meta.servers - åç¯å¢meta serviceåè¡¨\n\nä½¿ç¨ç¨åºåä¸ç¨ç¼è¾å¨ï¼å¦vimï¼notepad++ï¼sublimeç­ï¼æå¼apollo-portal-x.x.x-github.zipä¸­configç®å½ä¸çapollo-env.propertiesæä»¶ã\n\nåè®¾devçapollo-configserviceæªç»å®ååï¼å°åæ¯1.1.1.1:8080ï¼fatçapollo-configserviceç»å®äºååapollo.fat.xxx.comï¼uatçapollo-configserviceç»å®äºååapollo.uat.xxx.comï¼proçapollo-configserviceç»å®äºååapollo.xxx.comï¼é£ä¹å¯ä»¥å¦ä¸ä¿®æ¹åç¯å¢meta serviceæå¡å°åï¼æ ¼å¼ä¸º${env}.meta=http://${config-service-url:port}ï¼å¦ææä¸ªç¯å¢ä¸éè¦ï¼ä¹å¯ä»¥ç´æ¥å é¤å¯¹åºçéç½®é¡¹ï¼å¦lpt.metaï¼ï¼\n\ndev.meta=http://1.1.1.1:8080\n\nfat.meta=http://apollo.fat.xxx.com\n\nuat.meta=http://apollo.uat.xxx.com\n\npro.meta=http://apollo.xxx.comç¹å»å¤å¶éè¯¯å¤å¶æå\n\né¤äºéè¿apollo-env.propertiesæ¹å¼éç½®meta serviceä»¥å¤ï¼apolloä¹æ¯æå¨è¿è¡æ¶æå®meta serviceï¼ä¼åçº§æ¯apollo-env.propertiesé«ï¼ï¼\n\n 1. éè¿java system property\n\n${env}_meta\n\n * å¯ä»¥éè¿javaçsystem property ${env}_metaæ¥æå®\n\n * å¦java -ddev_meta=http://config-service-url -jar xxx.jar\n\n * ä¹å¯ä»¥éè¿ç¨åºæå®ï¼å¦system.setproperty("dev_meta", "http://config-service-url");\n\n 2. éè¿æä½ç³»ç»çsystem environment\n\n${env}_meta\n\n * å¦dev_meta=http://config-service-url\n * æ³¨ækeyä¸ºå¨å¤§åï¼ä¸ä¸­é´æ¯_åé\n\næ³¨1: ä¸ºäºå®ç°meta serviceçé«å¯ç¨ï¼æ¨èéè¿slbï¼software load balancerï¼åå¨æè´è½½åè¡¡\n\næ³¨2: meta serviceå°åä¹å¯ä»¥å¡«å¥ipï¼0.11.0çæ¬ä¹ååªæ¯æå¡«å¥ä¸ä¸ªipãä»0.11.0çæ¬å¼å§æ¯æå¡«å¥ä»¥éå·åéçå¤ä¸ªå°åï¼pr #1214ï¼ï¼å¦http://1.1.1.1:8080,http://2.2.2.2:8080ï¼ä¸è¿çäº§ç¯å¢è¿æ¯å»ºè®®ä½¿ç¨ååï¼èµ°slbï¼ï¼å ä¸ºæºå¨æ©å®¹ãç¼©å®¹ç­é½å¯è½å¯¼è´ipåè¡¨çååã\n\n2.2.1.2 éè¿æºç æå»º\n\n2.2.1.2.1 éç½®æ°æ®åºè¿æ¥ä¿¡æ¯\n\napolloæå¡ç«¯éè¦ç¥éå¦ä½è¿æ¥å°ä½ åé¢åå»ºçæ°æ®åºï¼æä»¥éè¦ç¼è¾scripts/build.shï¼ä¿®æ¹apolloportaldbåapolloconfigdbç¸å³çæ°æ®åºè¿æ¥ä¸²ä¿¡æ¯ã\n\næ³¨æï¼å¡«å¥çç¨æ·éè¦å·å¤å¯¹apolloportaldbåapolloconfigdbæ°æ®çè¯»åæéã\n\n#apollo config db info\n\napollo_config_db_url=jdbc:mysql://localhost:3306/apolloconfigdb?usessl=false&characterencoding=utf8\n\napollo_config_db_username=ç¨æ·å\n\napollo_config_db_password=å¯ç ï¼å¦ææ²¡æå¯ç ï¼çç©ºå³å¯ï¼\n\n\n# apollo portal db info\n\napollo_portal_db_url=jdbc:mysql://localhost:3306/apolloportaldb?usessl=false&characterencoding=utf8\n\napollo_portal_db_username=ç¨æ·å\n\napollo_portal_db_password=å¯ç ï¼å¦ææ²¡æå¯ç ï¼çç©ºå³å¯ï¼ç¹å»å¤å¶éè¯¯å¤å¶æå\n\næ³¨1ï¼ç±äºapolloconfigdbå¨æ¯ä¸ªç¯å¢é½æé¨ç½²ï¼æä»¥å¯¹ä¸åçç¯å¢config-serviceåadmin-serviceéè¦ä½¿ç¨ä¸åçæ°æ®åºåæ°æä¸åçåï¼portalåªéè¦æä¸æ¬¡åå³å¯\n\næ³¨2ï¼å¦æä¸æ³config-serviceåadmin-serviceæ¯ä¸ªç¯å¢æä¸ä¸ªåçè¯ï¼ä¹å¯ä»¥éè¿è¿è¡æ¶ä¼ å¥æ°æ®åºè¿æ¥ä¸²ä¿¡æ¯å®ç°ï¼å·ä½å¯ä»¥åè issue 869\n\næ³¨3ï¼æ¯ä¸ªç¯å¢é½éè¦ç¬ç«é¨ç½²ä¸å¥config-serviceãadmin-serviceåapolloconfigdb\n\n2.2.1.2.2 éç½®åç¯å¢meta serviceå°å\n\napollo portaléè¦å¨ä¸åçç¯å¢è®¿é®ä¸åçmeta service(apollo-configservice)å°åï¼æä»¥éè¦å¨æåæ¶æä¾è¿äºä¿¡æ¯ã\n\nåè®¾devçapollo-configserviceæªç»å®ååï¼å°åæ¯1.1.1.1:8080ï¼fatçapollo-configserviceç»å®äºååapollo.fat.xxx.comï¼uatçapollo-configserviceç»å®äºååapollo.uat.xxx.comï¼proçapollo-configserviceç»å®äºååapollo.xxx.comï¼é£ä¹ç¼è¾scripts/build.shï¼å¦ä¸ä¿®æ¹åç¯å¢meta serviceæå¡å°åï¼æ ¼å¼ä¸º${env}_meta=http://${config-service-url:port}ï¼å¦ææä¸ªç¯å¢ä¸éè¦ï¼ä¹å¯ä»¥ç´æ¥å é¤å¯¹åºçéç½®é¡¹ï¼\n\ndev_meta=http://1.1.1.1:8080\n\nfat_meta=http://apollo.fat.xxx.com\n\nuat_meta=http://apollo.uat.xxx.com\n\npro_meta=http://apollo.xxx.com\n\nmeta_servers_opts="-ddev_meta=$dev_meta -dfat_meta=$fat_meta -duat_meta=$uat_meta -dpro_meta=$pro_meta"\n\né¤äºå¨æåæ¶éç½®meta serviceä»¥å¤ï¼apolloä¹æ¯æå¨è¿è¡æ¶æå®meta serviceï¼\n\n 1. éè¿java system property\n\n${env}_meta\n\n * å¯ä»¥éè¿javaçsystem property ${env}_metaæ¥æå®\n\n * å¦java -ddev_meta=http://config-service-url -jar xxx.jar\n\n * ä¹å¯ä»¥éè¿ç¨åºæå®ï¼å¦system.setproperty("dev_meta", "http://config-service-url");\n\n 2. éè¿æä½ç³»ç»çsystem environment\n\n${env}_meta\n\n * å¦dev_meta=http://config-service-url\n * æ³¨ækeyä¸ºå¨å¤§åï¼ä¸ä¸­é´æ¯_åé\n\næ³¨1: ä¸ºäºå®ç°meta serviceçé«å¯ç¨ï¼æ¨èéè¿slbï¼software load balancerï¼åå¨æè´è½½åè¡¡\n\næ³¨2: meta serviceå°åä¹å¯ä»¥å¡«å¥ipï¼0.11.0çæ¬ä¹ååªæ¯æå¡«å¥ä¸ä¸ªipãä»0.11.0çæ¬å¼å§æ¯æå¡«å¥ä»¥éå·åéçå¤ä¸ªå°åï¼pr #1214ï¼ï¼å¦http://1.1.1.1:8080,http://2.2.2.2:8080ï¼ä¸è¿çäº§ç¯å¢è¿æ¯å»ºè®®ä½¿ç¨ååï¼èµ°slbï¼ï¼å ä¸ºæºå¨æ©å®¹ãç¼©å®¹ç­é½å¯è½å¯¼è´ipåè¡¨çååã\n\n2.2.1.2.3 æ§è¡ç¼è¯ãæå\n\nåå®ä¸è¿°éç½®åï¼å°±å¯ä»¥æ§è¡ç¼è¯åæåäºã\n\næ³¨ï¼åæ¬¡ç¼è¯ä¼ä»mavenä¸­å¤®ä»åºä¸è½½ä¸å°ä¾èµï¼å¦æç½ç»æåµä¸ä½³æ¶å¾å®¹æåºéï¼å»ºè®®ä½¿ç¨å½åçmavenä»åºæºï¼æ¯å¦é¿éäºmavenéå\n\n./build.sh\n\nè¯¥èæ¬ä¼ä¾æ¬¡æåapollo-configservice, apollo-adminservice, apollo-portalã\n\næ³¨ï¼ç±äºapolloconfigdbå¨æ¯ä¸ªç¯å¢é½æé¨ç½²ï¼æä»¥å¯¹ä¸åç¯å¢çconfig-serviceåadmin-serviceéè¦ä½¿ç¨ä¸åçæ°æ®åºè¿æ¥ä¿¡æ¯æä¸åçåï¼portalåªéè¦æä¸æ¬¡åå³å¯\n\n2.2.1.2.4 è·åapollo-configserviceå®è£å\n\nä½äºapollo-configservice/target/ç®å½ä¸çapollo-configservice-x.x.x-github.zip\n\néè¦æ³¨æçæ¯ç±äºapolloconfigdbå¨æ¯ä¸ªç¯å¢é½æé¨ç½²ï¼æä»¥å¯¹ä¸åç¯å¢çconfig-serviceéè¦ä½¿ç¨ä¸åçæ°æ®åºåæ°æä¸åçåååå«é¨ç½²\n\n2.2.1.2.5 è·åapollo-adminserviceå®è£å\n\nä½äºapollo-adminservice/target/ç®å½ä¸çapollo-adminservice-x.x.x-github.zip\n\néè¦æ³¨æçæ¯ç±äºapolloconfigdbå¨æ¯ä¸ªç¯å¢é½æé¨ç½²ï¼æä»¥å¯¹ä¸åç¯å¢çadmin-serviceéè¦ä½¿ç¨ä¸åçæ°æ®åºåæ°æä¸åçåååå«é¨ç½²\n\n2.2.1.2.6 è·åapollo-portalå®è£å\n\nä½äºapollo-portal/target/ç®å½ä¸çapollo-portal-x.x.x-github.zip\n\n2.2.1.2.7 å¯ç¨å¤é¨nacosæå¡æ³¨åä¸­å¿æ¿æ¢åç½®eureka\n\n 1. ä¿®æ¹build.sh/build.batï¼å°config-serviceåadmin-serviceçmavenç¼è¯å½ä»¤æ´æ¹ä¸º\n\nmvn clean package -pgithub,nacos-discovery -dskiptests -pl apollo-configservice,apollo-adminservice -am -dapollo_profile=github,nacos-discovery -dspring_datasource_url=$apollo_config_db_url -dspring_datasource_username=$apollo_config_db_username -dspring_datasource_password=$apollo_config_db_passwordç¹å»å¤å¶éè¯¯å¤å¶æå\n\n 2. åå«ä¿®æ¹apollo-configserviceåapollo-adminserviceå®è£åä¸­configç®å½ä¸çapplication-github.propertiesï¼éç½®nacosæå¡å¨å°å\n\nnacos.discovery.server-addr=127.0.0.1:8848\n\n\n# æ´å¤ nacos éç½®\n\nnacos.discovery.access-key=\n\nnacos.discovery.username=\n\nnacos.discovery.password=\n\nnacos.discovery.secret-key=\n\nnacos.discovery.namespace=\n\nnacos.discovery.context-path=\n\n2.2.1.2.8 å¯ç¨å¤é¨consulæå¡æ³¨åä¸­å¿æ¿æ¢åç½®eureka\n\n 1. ä¿®æ¹build.sh/build.batï¼å°config-serviceåadmin-serviceçmavenç¼è¯å½ä»¤æ´æ¹ä¸º\n\nmvn clean package -pgithub -dskiptests -pl apollo-configservice,apollo-adminservice -am -dapollo_profile=github,consul-discovery -dspring_datasource_url=$apollo_config_db_url -dspring_datasource_username=$apollo_config_db_username -dspring_datasource_password=$apollo_config_db_password\n\n 2. åå«ä¿®æ¹apollo-configserviceåapollo-adminserviceå®è£åä¸­configç®å½ä¸çapplication-github.propertiesï¼éç½®consulæå¡å¨å°å\n\nspring.cloud.consul.host=127.0.0.1\n\nspring.cloud.consul.port=8500ç¹\n\n2.2.2 é¨ç½²apolloæå¡ç«¯\n\n2.2.2.1 é¨ç½²apollo-configservice\n\nå°å¯¹åºç¯å¢çapollo-configservice-x.x.x-github.zipä¸ä¼ å°æå¡å¨ä¸ï¼è§£ååæ§è¡scripts/startup.shå³å¯ãå¦éåæ­¢æå¡ï¼æ§è¡scripts/shutdown.sh.\n\nè®°å¾å¨scripts/startup.shä¸­æç§å®éçç¯å¢è®¾ç½®ä¸ä¸ªjvmåå­ï¼ä»¥ä¸æ¯æä»¬çé»è®¤è®¾ç½®ï¼ä¾åèï¼\n\nexport java_opts="-server -xms6144m -xmx6144m -xss256k -xx:metaspacesize=128m -xx:maxmetaspacesize=384m -xx:newsize=4096m -xx:maxnewsize=4096m -xx:survivorratio=18"ç¹å»å¤å¶éè¯¯å¤å¶æå\n\næ³¨1ï¼å¦æéè¦ä¿®æ¹jvmåæ°ï¼å¯ä»¥ä¿®æ¹scripts/startup.shçjava_optsé¨åã\n\næ³¨2ï¼å¦è¦è°æ´æå¡çæ¥å¿è¾åºè·¯å¾ï¼å¯ä»¥ä¿®æ¹scripts/startup.shåapollo-configservice.confä¸­çlog_dirã\n\næ³¨3ï¼å¦è¦è°æ´æå¡ççå¬ç«¯å£ï¼å¯ä»¥ä¿®æ¹scripts/startup.shä¸­çserver_portãå¦å¤apollo-configserviceåæ¶æ¿æmeta serverèè´£ï¼å¦æè¦ä¿®æ¹ç«¯å£ï¼æ³¨æè¦åæ¶apolloconfigdb.serverconfigè¡¨ä¸­çeureka.service.urléç½®é¡¹ä»¥åapollo-portalåapollo-clientä¸­çä½¿ç¨å°çmeta serverä¿¡æ¯ï¼è¯¦è§ï¼2.2.1.1.2.4 éç½®apollo-portalçmeta serviceä¿¡æ¯å1.2.2 apollo meta serverã\n\næ³¨4ï¼å¦æapolloconfigdb.serverconfigçeureka.service.urlåªéäºå½åæ­£å¨å¯å¨çæºå¨çè¯ï¼å¨å¯å¨apollo-configserviceçè¿ç¨ä¸­ä¼å¨æ¥å¿ä¸­è¾åºeurekaæ³¨åå¤±è´¥çä¿¡æ¯ï¼å¦com.sun.jersey.api.client.clienthandlerexception: java.net.connectexception: connection refusedãéè¦æ³¨æçæ¯ï¼è¿ä¸ªæ¯é¢æçæåµï¼å ä¸ºapollo-configserviceéè¦åmeta serverï¼å®èªå·±ï¼æ³¨åæå¡ï¼ä½æ¯å ä¸ºå¨å¯å¨è¿ç¨ä¸­ï¼èªå·±è¿æ²¡èµ·æ¥ï¼æä»¥ä¼æ¥è¿ä¸ªéãåé¢ä¼è¿è¡éè¯çå¨ä½ï¼æä»¥ç­èªå·±æå¡èµ·æ¥åå°±ä¼æ³¨åæ­£å¸¸äºã\n\næ³¨5ï¼å¦æä½ çå°äºè¿éï¼ç¸ä¿¡ä½ ä¸å®æ¯ä¸ä¸ªç»å¿éè¯»ææ¡£çäººï¼èä¸ç¦»æåå°±å·®ä¸ç¹ç¹äºï¼ç»§ç»­å æ²¹ï¼åºè¯¥å¾å¿«å°±è½å®æapolloçåå¸å¼é¨ç½²äºï¼ä¸è¿ä½ æ¯å¦ææè§apolloçåå¸å¼é¨ç½²æ­¥éª¤æç¹ç¹çï¼æ¯å¦æå¥å»ºè®®æ³è¦åä½èè¯´ï¼å¦æç­æ¡æ¯è¯å®çè¯ï¼è¯·ç§»æ­¥ #1424ï¼æå¾ä½ çå»ºè®®ï¼\n\n2.2.2.2 é¨ç½²apollo-adminservice\n\nå°å¯¹åºç¯å¢çapollo-adminservice-x.x.x-github.zipä¸ä¼ å°æå¡å¨ä¸ï¼è§£ååæ§è¡scripts/startup.shå³å¯ãå¦éåæ­¢æå¡ï¼æ§è¡scripts/shutdown.sh.\n\nè®°å¾å¨scripts/startup.shä¸­æç§å®éçç¯å¢è®¾ç½®ä¸ä¸ªjvmåå­ï¼ä»¥ä¸æ¯æä»¬çé»è®¤è®¾ç½®ï¼ä¾åèï¼\n\nexport java_opts="-server -xms2560m -xmx2560m -xss256k -xx:metaspacesize=128m -xx:maxmetaspacesize=384m -xx:newsize=1024m -xx:maxnewsize=1024m -xx:survivorratio=22"\n\næ³¨1ï¼å¦æéè¦ä¿®æ¹jvmåæ°ï¼å¯ä»¥ä¿®æ¹scripts/startup.shçjava_optsé¨åã\n\næ³¨2ï¼å¦è¦è°æ´æå¡çæ¥å¿è¾åºè·¯å¾ï¼å¯ä»¥ä¿®æ¹scripts/startup.shåapollo-adminservice.confä¸­çlog_dirã\n\næ³¨3ï¼å¦è¦è°æ´æå¡ççå¬ç«¯å£ï¼å¯ä»¥ä¿®æ¹scripts/startup.shä¸­çserver_portã\n\n2.2.2.3 é¨ç½²apollo-portal\n\nå°apollo-portal-x.x.x-github.zipä¸ä¼ å°æå¡å¨ä¸ï¼è§£ååæ§è¡scripts/startup.shå³å¯ãå¦éåæ­¢æå¡ï¼æ§è¡scripts/shutdown.sh.\n\nè®°å¾å¨startup.shä¸­æç§å®éçç¯å¢è®¾ç½®ä¸ä¸ªjvmåå­ï¼ä»¥ä¸æ¯æä»¬çé»è®¤è®¾ç½®ï¼ä¾åèï¼\n\nexport java_opts="-server -xms4096m -xmx4096m -xss256k -xx:metaspacesize=128m -xx:maxmetaspacesize=384m -xx:newsize=1536m -xx:maxnewsize=1536m -xx:survivorratio=22"\n\næ³¨1ï¼å¦æéè¦ä¿®æ¹jvmåæ°ï¼å¯ä»¥ä¿®æ¹scripts/startup.shçjava_optsé¨åã\n\næ³¨2ï¼å¦è¦è°æ´æå¡çæ¥å¿è¾åºè·¯å¾ï¼å¯ä»¥ä¿®æ¹scripts/startup.shåapollo-portal.confä¸­çlog_dirã\n\næ³¨3ï¼å¦è¦è°æ´æå¡ççå¬ç«¯å£ï¼å¯ä»¥ä¿®æ¹scripts/startup.shä¸­çserver_portã',charsets:{cjk:!0}},{title:"ç½ç»å·¥å·",frontmatter:{title:"ç½ç»å·¥å·",date:"2023-02-20T09:33:21.000Z",permalink:"/pages/38ce88/",categories:["è¿ç»´","ç½ç»"],tags:[null],readingShow:"top",description:"å¨çº¿ DNS æ£æµ ---online nslookup",meta:[{name:"twitter:title",content:"ç½ç»å·¥å·"},{name:"twitter:description",content:"å¨çº¿ DNS æ£æµ ---online nslookup"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/04.%E7%BD%91%E7%BB%9C/03.%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ç½ç»å·¥å·"},{property:"og:description",content:"å¨çº¿ DNS æ£æµ ---online nslookup"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/04.%E7%BD%91%E7%BB%9C/03.%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-20T09:33:21.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ç½ç»å·¥å·"},{itemprop:"description",content:"å¨çº¿ DNS æ£æµ ---online nslookup"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/04.%E7%BD%91%E7%BB%9C/03.%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7.html",relativePath:"04.è¿ç»´/04.ç½ç»/03.ç½ç»å·¥å·.md",key:"v-66a7ae24",path:"/pages/38ce88/",headers:[{level:3,title:"ç½ç»å·¥å·",slug:"ç½ç»å·¥å·",normalizedTitle:"ç½ç»å·¥å·",charIndex:2}],headersStr:"ç½ç»å·¥å·",content:"# ç½ç»å·¥å·\n\nå¨çº¿ DNS æ£æµ ---online nslookup\n\nhttps://www.nslookup.io/\n\nå¨çpingæ£æµ ---ping.pe\n\nhttps://ping.pe/\n\nåå° wegt æ£æµ ---ç½ç«æµéå·¥å·boce.com\n\nhttps://www.boce.com/\n\nåå° + é¨åå¸¸è§æµ·å¤å°åº wegt æ£æµ ---ç½ç«æµé 17ce.com\n\nhttps://www.17ce.com/\n\näºä¿¡æä¾ç SSL/TLS è¯ä¹¦æ£æµ ---è¯ä¹¦æ£æµmyssl.com\n\nhttps://myssl.com/\n\nå¶å®å·¥å·ï¼GitHub - saveweb/tools: Save The Web Project æä½¿ç¨çå·¥å·åè¡¨",normalizedContent:"# ç½ç»å·¥å·\n\nå¨çº¿ dns æ£æµ ---online nslookup\n\nhttps://www.nslookup.io/\n\nå¨çpingæ£æµ ---ping.pe\n\nhttps://ping.pe/\n\nåå° wegt æ£æµ ---ç½ç«æµéå·¥å·boce.com\n\nhttps://www.boce.com/\n\nåå° + é¨åå¸¸è§æµ·å¤å°åº wegt æ£æµ ---ç½ç«æµé 17ce.com\n\nhttps://www.17ce.com/\n\näºä¿¡æä¾ç ssl/tls è¯ä¹¦æ£æµ ---è¯ä¹¦æ£æµmyssl.com\n\nhttps://myssl.com/\n\nå¶å®å·¥å·ï¼github - saveweb/tools: save the web project æä½¿ç¨çå·¥å·åè¡¨",charsets:{cjk:!0}},{title:"ç½ç»ä»£ç",frontmatter:{title:"ç½ç»ä»£ç",date:"2023-02-20T09:19:56.000Z",permalink:"/pages/5933ee/",categories:["è¿ç»´","ç½ç»"],tags:[null],readingShow:"top",description:"ï¼Proxy Server ï¼ç¨äºä»£æ¿ä¸ä¸ªä¸»æºä¸å¶å®ä¸»æºè¿è¡éä¿¡ã",meta:[{name:"twitter:title",content:"ç½ç»ä»£ç"},{name:"twitter:description",content:"ï¼Proxy Server ï¼ç¨äºä»£æ¿ä¸ä¸ªä¸»æºä¸å¶å®ä¸»æºè¿è¡éä¿¡ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/04.%E7%BD%91%E7%BB%9C/02.%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ç½ç»ä»£ç"},{property:"og:description",content:"ï¼Proxy Server ï¼ç¨äºä»£æ¿ä¸ä¸ªä¸»æºä¸å¶å®ä¸»æºè¿è¡éä¿¡ã"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/04.%E7%BD%91%E7%BB%9C/02.%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-20T09:19:56.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ç½ç»ä»£ç"},{itemprop:"description",content:"ï¼Proxy Server ï¼ç¨äºä»£æ¿ä¸ä¸ªä¸»æºä¸å¶å®ä¸»æºè¿è¡éä¿¡ã"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/04.%E7%BD%91%E7%BB%9C/02.%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html",relativePath:"04.è¿ç»´/04.ç½ç»/02.ç½ç»ä»£ç.md",key:"v-084ed8e0",path:"/pages/5933ee/",headers:[{level:2,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8)ä»£çæå¡å¨",slug:"ä»£çæå¡å¨",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#%e4%bb%a3%e7%90%86%e6%9c%8d%e5%8a%a1%e5%99%a8" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>ä»£çæå¡å¨',charIndex:null},{level:3,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#squid)Squid",slug:"squid",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#squid" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>squid',charIndex:null},{level:4,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E9%83%A8%E7%BD%B2)é¨ç½²",slug:"é¨ç½²",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#%e9%83%a8%e7%bd%b2" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>é¨ç½²',charIndex:null},{level:4,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E9%85%8D%E7%BD%AE)éç½®",slug:"éç½®",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#%e9%85%8d%e7%bd%ae" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>éç½®',charIndex:null},{level:3,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#socks5)SOCKS5",slug:"socks5",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#socks5" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>socks5',charIndex:null},{level:3,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#shadowsocks)Shadowsocks",slug:"shadowsocks",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#shadowsocks" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>shadowsocks',charIndex:null},{level:4,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#shadowsocks-libev)Shadowsocks-libev",slug:"shadowsocks-libev",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#shadowsocks-libev" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>shadowsocks-libev',charIndex:null},{level:4,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#shadowsocks-rust)Shadowsocks-rust",slug:"shadowsocks-rust",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#shadowsocks-rust" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>shadowsocks-rust',charIndex:null},{level:4,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E5%AE%A2%E6%88%B7%E7%AB%AF)å®¢æ·ç«¯",slug:"å®¢æ·ç«¯",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#%e5%ae%a2%e6%88%b7%e7%ab%af" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>å®¢æ·ç«¯',charIndex:null},{level:3,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#v2ray)V2Ray",slug:"v2ray",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#v2ray" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>v2ray',charIndex:null},{level:3,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#trojan)Trojan",slug:"trojan",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#trojan" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>trojan',charIndex:null},{level:2,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E4%BB%A3%E7%90%86%E5%AE%A2%E6%88%B7%E7%AB%AF)ä»£çå®¢æ·ç«¯",slug:"ä»£çå®¢æ·ç«¯",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#%e4%bb%a3%e7%90%86%e5%ae%a2%e6%88%b7%e7%ab%af" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>ä»£çå®¢æ·ç«¯',charIndex:null},{level:3,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#proxifier)Proxifier",slug:"proxifier",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#proxifier" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>proxifier',charIndex:null},{level:3,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#proxychains)ProxyChains",slug:"proxychains",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#proxychains" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>proxychains',charIndex:null},{level:3,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#redsocks)redsocks",slug:"redsocks",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#redsocks" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>redsocks',charIndex:null},{level:3,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#clash)Clash",slug:"clash",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#clash" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>clash',charIndex:null},{level:2,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86)ååä»£ç",slug:"ååä»£ç",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#%e5%8f%8d%e5%90%91%e4%bb%a3%e7%90%86" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>ååä»£ç',charIndex:null},{level:3,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#lvs)LVS",slug:"lvs",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#lvs" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>lvs',charIndex:null},{level:3,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#frp)frp",slug:"frp",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#frp" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>frp',charIndex:null},{level:2,title:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#vpn)VPN",slug:"vpn",normalizedTitle:'<a href="https://leohsiao.com/linux/%e7%bd%91%e7%bb%9c/%e7%bd%91%e7%bb%9c%e4%bb%a3%e7%90%86.html#vpn" target="_blank" rel="noopener noreferrer">#<outboundlink/></a>vpn',charIndex:null}],headersStr:"[#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8)ä»£çæå¡å¨ [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#squid)Squid [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E9%83%A8%E7%BD%B2)é¨ç½² [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E9%85%8D%E7%BD%AE)éç½® [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#socks5)SOCKS5 [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#shadowsocks)Shadowsocks [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#shadowsocks-libev)Shadowsocks-libev [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#shadowsocks-rust)Shadowsocks-rust [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E5%AE%A2%E6%88%B7%E7%AB%AF)å®¢æ·ç«¯ [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#v2ray)V2Ray [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#trojan)Trojan [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E4%BB%A3%E7%90%86%E5%AE%A2%E6%88%B7%E7%AB%AF)ä»£çå®¢æ·ç«¯ [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#proxifier)Proxifier [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#proxychains)ProxyChains [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#redsocks)redsocks [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#clash)Clash [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86)ååä»£ç [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#lvs)LVS [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#frp)frp [#](https://leohsiao.com/Linux/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E4%BB%A3%E7%90%86.html#vpn)VPN",content:'# #ä»£çæå¡å¨\n\nï¼Proxy Server ï¼ç¨äºä»£æ¿ä¸ä¸ªä¸»æºä¸å¶å®ä¸»æºè¿è¡éä¿¡ã\n\n * å·¥ä½å¨ä¼è¯å±ï¼ä»£çåºç¨å±çæ¶æ¯ã\n * æåè®®åç±»ï¼\n   * SSH ä»£ç\n   * FTP ä»£ç\n   * HTTP ä»£ç\n   * HTTPS ä»£ç\n   * SOCKS ä»£çï¼å¨ç§°ä¸º SOCKetS ï¼å·¥ä½å¨åºç¨å±ä¸ä¼ è¾å±ä¹é´ï¼æ¯ HTTP ä»£çæ´åºå±ãæ´å¿«ã\n     * SOCKS4 åªæ¯æ TCP è¿æ¥ï¼è SOCKS5 è¿æ¯æ UDP è¿æ¥ãå¯ç è®¤è¯ã\n     * FTPãHTTPãSOCKS ä»£çé½æ¯ææéä¿¡ï¼è SSHãHTTPSãshadowsocks ä»£çæ¯å å¯éä¿¡ã\n * æä»£çåååç±»ï¼\n   * æ­£åä»£ç ï¼ä¾§éäºä»£æ¿å®¢æ·ç«¯ï¼åæå¡å¨ååºè®¿é®è¯·æ±ã\n   * ååä»£ç ï¼ä¾§éäºä»£æ¿æå¡å¨ï¼æ¥æ¶å®¢æ·ç«¯çè®¿é®è¯·æ±ã\n * ç¨éï¼\n   * å¯ä»¥ä½¿å®¢æ·ç«¯è®¿é®å°æäºä»£çæå¡å¨æè½è®¿é®çç½ç»ï¼å VPN çåè½ã\n   * å¯ä»¥æä»»é²ç«å¢ï¼è¿æ»¤å®¢æ·ç«¯åéãæ¥æ¶çæ°æ®ã\n   * å¯ä»¥å¨ææ´æ¹å°å®¢æ·ç«¯çæµéè½¬åå°åªä¸ªæå¡å¨ï¼æ¯å¦å®ç°è´è½½åè¡¡ã\n   * å¯ä»¥éç¦»æå¡å¨ä¸å®¢æ·ç«¯ï¼ä½¿å¾æå¡å¨ä¸ç¥éå®¢æ·ç«¯ççå® IP ãå®¢æ·ç«¯ä¸ç¥éæå¡å¨ççå® IP ã\n * ç¼ºç¹ï¼\n   * å®¢æ·ç«¯çéä¿¡æ°æ®é½è¦ç»è¿ä»£çæå¡å¨ï¼å¯è½è¢«çå¬ãç¯¡æ¹ã\n\n\n# #Squid\n\nï¼ä¸ä¸ªä»£çæå¡å¨ï¼éç¨ C++ å¼åã\n\n * å®ç½(opens new window)\n * æ¯æ FTPãHTTPãHTTPS ä»£çåè®®ã\n * å¸¸ç¨ä½ç®åç HTTP æ­£åä»£çæå¡å¨ã\n * ä¹å¯ç¨äºååä»£çï¼ç¼å­ HTTP æå¡å¨çååºæ¥æï¼ä½æ¯ Nginx çåè½å°ã\n\n# #é¨ç½²\n\n * ç¨ yum å®è£ï¼\n   \n   yum install squid\n   systemctl start squid\n   systemctl enable squid\n   \n   \n   1\n   2\n   3\n   \n\n * æèç¨ docker-compose é¨ç½²ï¼\n   \n   version: \'3\'\n   \n   services:\n     squid:\n       container_name: squid\n       image: sameersbn/squid:3.5.27-2\n       restart: unless-stopped\n       ports:\n         - 3128:3128\n       volumes:\n         - ./conf:/etc/squid/\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   \n\n# #éç½®\n\nç¨ yum å®è£ Squid æ¶ï¼å¼å¯æ­£åä»£ççæ­¥éª¤ï¼\n\n 1. ç¼è¾éç½®æä»¶Â /etc/squid/squid.confÂ ï¼\n    \n    http_port 3128\n    \n    # å®ä¹ä¸ä¸ª acl ç»ï¼åä¸º local_ip ï¼æåæº IP ä¸º 10.0.0.1/24 çæµé\n    # acl local_ip src 10.0.0.1/24\n    \n    # å®ä¹ä¸ä¸ª acl ç»ï¼ç¨å¯ç æä»¶è¿è¡èº«ä»½è®¤è¯\n    auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd\n    acl auth_user proxy_auth REQUIRED\n    \n    # åè®¸æå® acl ç»çæµé\n    # http_access allow local_ip\n    http_access allow auth_user\n    # ç¦æ­¢å©ä¸çæææµé\n    http_access deny all\n    \n    # ä¸ç¼å­ææååºæ¥æ\n    cache deny all\n    \n    # é»è®¤ä¼å¨ HTTP è¯·æ± Headers ä¸­å å¥ X-Forwarded-For ï¼å£°æå®¢æ·ç«¯ççå® IP ãè¿éå é¤è¯¥ Header\n    forwarded_for delete\n    \n    # è®°å½è®¿é®æ¥å¿\n    access_log /var/log/squid/access.log squid\n    # æ¯é 30 å¤©ç¿»è½¬ä¸æ¬¡æ¥å¿\n    logfile_rotate 30\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    7\n    8\n    9\n    10\n    11\n    12\n    13\n    14\n    15\n    16\n    17\n    18\n    19\n    20\n    21\n    22\n    23\n    24\n    25\n    \n\n 2. çæå¯ç æä»¶ï¼\n    \n    yum install httpd-tools\n    htpasswd -cb /etc/squid/passwd leo ******\n    \n    \n    1\n    2\n    \n\n 3. æµè¯ä½¿ç¨è¯¥ä»£çï¼\n    \n    systemctl restart squid\n    curl -x http://leo:******@127.0.0.1:3128 cip.cc\n    \n    \n    1\n    2\n    \n\n\n# #SOCKS5\n\n * ç¨ docker-compose é¨ç½²ä¸ä¸ª SOCKS5 æå¡å¨ï¼\n   \n   version: \'3\'\n   \n   services:\n     socks5:\n       container_name: socks5\n       image: serjs/go-socks5-proxy\n       restart: unless-stopped\n       environment:\n         PROXY_USER: root\n         PROXY_PASSWORD: ******\n       ports:\n         - 1080:1080\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   \n   * è¯¥éåéç¨ Golang å¼åï¼è¯¦è§å®æ¹ææ¡£Â (opens new window)ã\n\n\n# #Shadowsocks\n\nï¼ä¸ç§åºäº SOCKS5 åè®®çä»£çåè®®ï¼ç®ç§°ä¸º ss ï¼å¸¸ç¨äºå®ç° VPN ã\n\n * å®æ¹ææ¡£(opens new window)\n * æ¯æè®¾ç½®å¯ç ãå å¯ä¼ è¾æ°æ®ã\n * åçï¼\n   1. å¨ä¸å°ä¸»æºä¸è¿è¡ ss æå¡å¨ã\n   2. å¨æ¬æºè¿è¡ ss å®¢æ·ç«¯ï¼å°æ¬æºçæµéåéå° ss æå¡å¨ï¼è¢«å®ä»£çè½¬åã\n * ShadowsocksR ï¼ç®ç§°ä¸º SSR ï¼æ¯ shadowsocks çååé¡¹ç®ã\n\n# #Shadowsocks-libev\n\nï¼ä¸ä¸ª ss ä»£çæå¡å¨è½¯ä»¶ã\n\n * äº 2015 å¹´åå¸ï¼éç¨ C è¯­è¨å¼åï¼äº 2020 å¹´åæ­¢æ´æ°ã\n\n * æ¯æ AEAD Cipher å å¯ç®æ³ã\n\n * æ¯æ Obfs æ··æ·ï¼å¯ä»¥å° ss æµéä¼ªè£æ http æµéã\n\n * ç¨ Docker é¨ç½²æå¡å¨ï¼\n   \n   docker run -d --name shadowsocks \\\n           --restart unless-stopped \\\n           -p 8388:8388 \\\n           shadowsocks/shadowsocks-libev:v3.3.5 \\\n           ss-server -s 0.0.0.0 -k ****** -m aes-256-gcm\n   \n   \n   1\n   2\n   3\n   4\n   5\n   \n   \n   æå¡å¨çå½ä»¤ï¼\n   \n   ss-server               # å¯å¨æå¡å¨\n           -c config.json  # ä½¿ç¨æå®çéç½®æä»¶\n           -s 0.0.0.0      # è®¾ç½®æå¡å¨çå¬ç IP\n           -p 8388         # è®¾ç½®æå¡å¨çå¬çç«¯å£\n           -k ******       # è®¾ç½®æå¡å¨çè®¤è¯å¯ç \n           -m aes-256-gcm  # è®¾ç½®æå¡å¨çå å¯æ¹å¼\n           -v              # æ¾ç¤ºè¯¦ç»æ¥å¿\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   \n\n# #Shadowsocks-rust\n\nï¼ä¸ä¸ª ss ä»£çæå¡å¨è½¯ä»¶ã\n\n * ç¨ Docker é¨ç½²æå¡å¨ï¼\n   \n   docker run -d --name ssserver-rust \\\n           --restart unless-stopped \\\n           -p 8388:8388 \\\n           -v /root/shadowsocks-rust/config.json:/etc/shadowsocks-rust/config.json \\\n           ghcr.io/shadowsocks/ssserver-rust:v1.14.3\n   \n   \n   1\n   2\n   3\n   4\n   5\n   \n   \n   éç½®æä»¶ç¤ºä¾ï¼\n   \n   {\n       "server": "0.0.0.0",\n       "server_port": 8388,\n       "password": "******",\n       "method": "chacha20-ietf-poly1305",\n       "fast_open": false\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   \n\n# #å®¢æ·ç«¯\n\nWindows ç ss å®¢æ·ç«¯Â (opens new window)ï¼\n\n * è¿è¡ ss å®¢æ·ç«¯ä¹åï¼å®ä¼è¿æ¥å° ss æå¡å¨ï¼åæ¶å¨æ¬æºçå¬ä¸ä¸ªä»£çç«¯å£ã\n * æ¬æºçè¿ç¨å¯ä»¥éè¿ HTTPãSocket ä»£çåè®®ï¼å°æ°æ®åéå°è¯¥ä»£çç«¯å£ï¼ç¶å ss å®¢æ·ç«¯ä¼å°è¿äºæ°æ®è½¬åå° ss æå¡å¨ï¼å®ç°æ­£åä»£çã\n * ä¹å¯ä»¥å¼å¯ ss å®¢æ·ç«¯çå¨å±æ¨¡å¼ï¼ä»£çæ¬æºçæææµéã\n\nLinux ç ss å®¢æ·ç«¯ ï¼\n\n * å®æ¯ä¸ä¸ªå½ä»¤è¡å·¥å·ï¼åè½è¾å°ï¼ä¸è½è¿æ¥å¤ä¸ª ss æå¡å¨ï¼å¨æ¬æºæä¾çä»£çç«¯å£åªæ¯æ Socket åè®®ã\n\n * é¨ç½²ç¤ºä¾ï¼\n   \n   # å®è£\n   pip3 install shadowsocks\n   \n   # ç¼è¾éç½®æä»¶\n   cat > ss.json <<EOF{    "server": "10.0.0.1",    "server_port": 8388,    "local_address": "127.0.0.1",    "local_port": 8388,    "password": "******",    "timeout": 5,    "method": "aes-256-cfb"}EOF\n   \n   # å¯å¨å®¢æ·ç«¯\n   sslocal -c ss.json -d start\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   \n   \n   ä¸ä¸ª sslocal å®¢æ·ç«¯åªè½è¿æ¥ä¸ä¸ª ss æå¡å¨ã\n\n * å¯ä»¥åè¿è¡ä»£çæå¡å¨ privoxy ï¼çå¬ä¸ä¸ª HTTP ä»£çç«¯å£ï¼å°è¯¥ç«¯å£çæµéè½¬åå° Socket ä»£çç«¯å£ã\n   \n   # å®è£\n   yum install -y privoxy\n   systemctl start privoxy\n   systemctl enable privoxy\n   \n   # ç¼è¾éç½®æä»¶\n   sed \'/listen-address  127.0.0.1:8118/d\' /etc/privoxy/config -i\n   cat >> /etc/privoxy/config <<EOFlisten-address  0.0.0.0:8118# å° HTTP è¯·æ±è½¬åå°è¯¥ä»£çforward-socks5  /   127.0.0.1:8388 .# ç¬¬ä¸ä¸ªå­æ®µä¸º url_pattern ï¼åå¼ä¸º / åå¹éææ HTTP è¯·æ±# ç¬¬äºãä¸ä¸ªå­æ®µä¸ºä»£çãç¶çº§ä»£çï¼åå¼ä¸º . åè¡¨ç¤ºå¿½ç¥# ä¸ä»£çè¿äº HTTP è¯·æ±forward         10.*.*.*/      .forward         127.*.*.*/     .forward         172.16.*.*/    .forward         192.168.*.*/   .EOF\n   \n   # éå¯\n   systemctl restart privoxy\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   \n   \n   è¯ç¨è¯¥ä»£çï¼\n   \n   curl -x 127.0.0.1:8118 google.com\n   \n   \n   1\n   \n\n\n# #V2Ray\n\nï¼ä¸ä¸ªä»£çæå¡å¨ï¼æ¯ ss çåè½æ´å¤ã\n\n * GitHub(opens new window)\n\n * äº 2019 å¹´åå¸ï¼éç¨ Goalng è¯­è¨å¼åãæ¯ Project V ç¤¾åºç åçä¸»è¦è½¯ä»¶ï¼åæ¥æ¹åä¸º v2fly ã\n\n * V2Ray æå¡å¨çæµéåä¸ºä¸¤ä¸ªæ¹åï¼\n   \n   * inbounds ï¼å¥ç«æµéï¼å³å®¢æ·ç«¯åéå° V2Ray çæµéã\n     * å®¢æ·ç«¯å¯ä½¿ç¨ V2Ray ååç VMess ä»£çåè®®ï¼ä¹å¼å®¹ HTTPãShadowsocks ç­ä»£çåè®®ã\n   * outbounds ï¼åºç«æµéï¼å³ V2Ray å°å®¢æ·ç«¯çæµéè½¬åå°æä¸ªç½ç«ã\n\n * ç¨ Docker é¨ç½²æå¡å¨ï¼\n   \n   docker run -d --name v2fly \\\n           --restart unless-stopped \\\n           -v /root/v2fly/config.json:/etc/v2fly/config.json \\\n           -p 80:80 \\\n           v2fly/v2fly-core:v5.1.0 \\\n           run -c /etc/v2fly/config.json\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   \n   \n   éç½®æä»¶ç¤ºä¾ï¼\n   \n   {\n     "inbounds": [{\n       "port": 80,\n       "protocol": "vmess",\n       "settings": {\n         // åªåè®¸è¿äº id çå®¢æ·ç«¯è¿æ¥\n         "clients": [{ "id": "******" }]\n       }\n     }],\n     "outbounds": [{\n       "protocol": "freedom",\n       "settings": {}\n     }]\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   \n\n * å¨ Windows ä¸å¸¸ç¨çå®¢æ·ç«¯è½¯ä»¶æ¯Â v2rayNÂ (opens new window)ã\n\n\n# #Trojan\n\nï¼ä¸ä¸ªä»£çæå¡å¨ãè½å å¯éä¿¡ï¼å¹¶ä¼ªè£æäºèç½å¸¸è§ç HTTPS æµéã\n\n * äº 2019 å¹´åå¸ï¼éç¨ C++ è¯­è¨å¼åã\n\n\n# #ä»£çå®¢æ·ç«¯\n\n * æçç¨åºä¸æ¯æä½¿ç¨ä»£çï¼æçç¨åºåªæ¯æä½¿ç¨ HTTP ç­ç®åçä»£çåè®®ãå æ­¤å»ºè®®å®è£ä¸ä¸ªä¸ç¨çä»£çå®¢æ·ç«¯ï¼éè¿ä¸¤ç§æ¹å¼ä»£çå¶å®ç¨åºçæµéï¼\n   * éæä»£çï¼Transparent proxyï¼ï¼\n     * æ¦æªå¶å®ç¨åºååºçæµéï¼è½¬åå°ä»£çæå¡å¨ãå¶å®ç¨åºä¸ä¼æç¥å°ä»£çï¼ä¸éè¦ä¸»å¨ä½¿ç¨ä»£çã\n   * è½¬æ¢ä»£çåè®®ï¼\n     * éè¿æç§ä»£çåè®®è¿æ¥å°ä»£çæå¡å¨ï¼åå¨æ¬æºçå¬ä¸ä¸ªéç¨ HTTP ç­ç®åä»£çåè®®çç«¯å£ï¼å°è¯¥ç«¯å£æ¶å°çæµéè½¬åå°ä»£çæå¡å¨ã\n     * æ­¤æ¶ï¼å·æä»£çåè½çç¨åºï¼ä¸è¬é½è½éè¿è¯¥ç«¯å£ä½¿ç¨ä»£çãä½æ²¡æä»£çåè½çç¨åºï¼ä¾ç¶ä¸è½ä½¿ç¨ä»£çã\n\n\n# #Proxifier\n\nï¼ä¸ä¸ª GUI å·¥å·ï¼ç¨ä½ä»£çå®¢æ·ç«¯ï¼æ¶è´¹ã\n\n * ç¹ç¹ï¼\n   * æ¯æ WindowsãMacOS ç³»ç»ï¼ä¸æ¯æ Linux ã\n   * æ¯æ HTTPãHTTPSãSOCKS4ãSOCKS5 ä»£çåè®®ã\n   * æ¯æéæä»£çãåçå¦ä¸ï¼\n     * Windows ç³»ç»ä¸ï¼ä¸è¬ç¨åºéè¦è°ç¨ Winsock API è¿è¡ Socket éä¿¡ã\n     * Winsock æä¾äº LSPï¼Layered Service Providerï¼ åè½ï¼åè®¸ç¨åºèªå®ä¹ä¸ä¸ª LSP DLL åºï¼å¨ä¸è¬ç¨åºè°ç¨ Winsock API æ¶è¢«å è½½ï¼ä»èå¯ä»¥å«æå¶æµéã\n   * æ¯æçµæ´»çä»£çè§åï¼å°æä¸ªç¨åºååæ IP:Port ç TCP åï¼è½¬åå°æä¸ªä»£çæå¡å¨ãæ¯æééç¬¦ã\n   * æ¯æç¨å¤ä¸ªä»£çæå¡å¨ç»æä»£çé¾ã\n * ç¨æ³ï¼\n   1. å®è£ Proxifier å¹¶å¯å¨ã\n   2. æ·»å ä»£çæå¡å¨ã\n   3. æ·»å ä»£çè§åã\n   4. ä¿æ Proxifier è¿è¡ï¼å³å¯ä»£çæ¬æºç¨åºçæµéã\n\n\n# #ProxyChains\n\nï¼ä¸ä¸ª Unix ç³»ç»çå½ä»¤è¡å·¥å·ï¼éç¨ C è¯­è¨å¼åï¼ç¨ä½ä»£çå®¢æ·ç«¯ã\n\n * GitHub(opens new window)\n * æ¯æéæä»£çãåçå¦ä¸ï¼\n   1. å£°æç¯å¢åé LD_PRELOAD ï¼è®©ç¨åºå¨å¯¼å¥ DLL åºæ¶ï¼ä¼åå¯¼å¥ libproxychains4.so åºã\n   2. å¨ libproxychains4.so åºä¸­ï¼éåå³äº Socket éä¿¡çå½æ°ï¼å°ç¨åºååºç TCP æµéè½¬åå°ä»£çæå¡å¨ã\n * ç¼ºç¹ï¼\n   * åªè½ä»£ç TCP æµéï¼ä¸æ¯æ UDPãICMP ã\n   * åªè½ä»£çæå®çç¨åºï¼ä¸è½ä»£çç³»ç»ææè¿ç¨ã\n   * åªè½ä»£çéç¨å¨æé¾æ¥åºçç¨åºã\n     * Chrome æµè§å¨å¨æ²çä¸­è¿è¡ç½é¡µï¼ä¹ä¸ä¼è¢«ä»£çã\n\nç¨æ³ï¼\n\n 1. å®è£ï¼\n    \n    wget https://github.com/rofl0r/proxychains-ng/archive/refs/tags/v4.14.tar.gz\n    tar -zxvf v4.14.tar.gz\n    cd proxychains-ng-4.14\n    ./configure --prefix=/usr --sysconfdir=/etc\n    make\n    make install\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    \n\n 2. ç¼è¾éç½®æä»¶ /etc/proxychains.conf ï¼ç¤ºä¾ï¼\n    \n    quiet_mode          # å®éæ¨¡å¼ï¼è¿è¡æ¶ä¸è¾åºè¿ç¨ä¿¡æ¯\n    dynamic_chain       # èªå¨éç¨ ProxyList ä¸­å¯ç¨çä»£çï¼ä¸æé¡ºåº\n    proxy_dns           # å° DNS è¯·æ±ä¹ä»£ç\n    \n    # åæ¶ä»£çååæå® IP çæ°æ®å\n    localnet 127.0.0.0/255.0.0.0\n    localnet 10.0.0.0/255.0.0.0\n    localnet 172.16.0.0/255.240.0.0\n    localnet 192.168.0.0/255.255.0.0\n    \n    # åéæ°æ®åæ¶ï¼ä¿®æ¹ç®æ  IP:Port\n    dnat 1.1.1.1:80  1.1.1.2:443\n    dnat 1.1.1.1:443 1.1.1.2\n    dnat 1.1.1.1     1.1.1.2\n    \n    # å£°æä¸ç»ä»£çæå¡å¨ï¼æ¯æ HTTPãSOCKS4ãSOCKS5 ä»£çåè®®ï¼æ¯æè®¾ç½®è´¦å·å¯ç \n    [ProxyList]\n    http    127.0.0.1   3128\n    socks5  127.0.0.1   1080  root  ******\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    7\n    8\n    9\n    10\n    11\n    12\n    13\n    14\n    15\n    16\n    17\n    18\n    19\n    \n\n 3. æ§è¡å½ä»¤ï¼\n    \n    proxychains4 curl cip.cc  # å¨ä»£çä¸æ§è¡ä¸æ¡å½ä»¤\n    proxychains4 bash         # åå»ºä¸ä¸ª shell ï¼å¨å¶ä¸­æ§è¡çå½ä»¤é½éç¨ä»£ç\n    \n    \n    1\n    2\n    \n\n\n# #redsocks\n\nï¼ä¸ä¸ª Linux ç³»ç»çå½ä»¤è¡å·¥å·ï¼éç¨ C è¯­è¨å¼åï¼ç¨ä½ä»£çå®¢æ·ç«¯ã\n\n * GitHub(opens new window)\n * æ¯æéæä»£çãåçå¦ä¸ï¼\n   1. redsocks è¿æ¥å°ä»£çæå¡å¨ï¼å¹¶å¨æ¬æºçå¬ä¸ä¸ªç«¯å£ï¼å°è¯¥ç«¯å£æ¶å°çæµéè½¬åå°ä»£çæå¡å¨ã\n   2. ç¨æ·æå¨éç½® iptables é²ç«å¢è§åï¼å°æ¬æºååºç TCP æµééå®åå° redsocks ç«¯å£ã\n * ç¼ºç¹ï¼\n   * éè¦æå¨éç½® iptables è§åï¼æ¯è¾éº»ç¦ã\n   * æäºç¨åºå¯è½æ è§ iptables è§åã\n\nç¨æ³ï¼\n\n 1. ç¨ apt å®è£ï¼\n    \n    apt install redsocks\n    \n    \n    1\n    \n    \n    æèæå¨ç¼è¯åå®è£ï¼\n    \n    git clone https://github.com/darkk/redsocks\n    cd redsocks\n    make\n    cp redsocks /usr/bin/redsocks\n    \n    \n    1\n    2\n    3\n    4\n    \n\n 2. ç¼è¾éç½®æä»¶ /etc/redsocks.conf ï¼ç¤ºä¾ï¼\n    \n    base {\n       log_debug  = off;\n       log_info   = on;\n       log        = stderr;    # æ¥å¿çä¿å­ä½ç½®ï¼å¯æ¹ä¸º "file:/var/log/redsocks.log" æä»¶\n       daemon     = on;\n       redirector = iptables;\n    }\n    \n    redsocks {\n       // å¨æ¬æºçå¬çç«¯å£\n       local_ip   = 127.0.0.1;\n       local_port = 12345;\n    \n       // è¦è¿æ¥çä»£çæå¡å¨\n       ip       = 10.0.0.1;\n       port     = 1080;\n       type     = socks5;\n       login    = <username>;\n       password = <password>;\n    }\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    7\n    8\n    9\n    10\n    11\n    12\n    13\n    14\n    15\n    16\n    17\n    18\n    19\n    20\n    \n    * å¯ä»¥å®ä¹å¤ä¸ª redsocks{} ä»£çéç½®ã\n\n 3. ç¨ systemctl ä¿æè¿è¡ï¼\n    \n    systemctl restart redsocks\n    systemctl enable  redsocks\n    \n    \n    1\n    2\n    \n    \n    æèæå¨å¯å¨ï¼\n    \n    redsocks -c /etc/redsocks.conf\n    \n    \n    1\n    \n\n 4. æ·»å  iptables è§åï¼\n    \n    iptables -t nat -A OUTPUT -p tcp -d 192.168.1.0/24 -j REDIRECT --to-ports 12345   # ç¼è¾ nat è¡¨ï¼å°æ¬æºååºçæäºæµééå®å REDSOCKS ç«¯å£\n    iptables -t nat -L OUTPUT   # æ¥ç iptables è§å\n    \n    \n    1\n    2\n    \n    \n    ç³»ç»éå¯æ¶ä¼éç½® iptables è§åãå æ­¤å»ºè®®å°éç½® iptables çå½ä»¤ä¿å­ä¸ºä¸ä¸ª shell èæ¬ï¼æ¯æ¬¡ç³»ç»éå¯æ¶æ§è¡å®ã\n\n\n# #Clash\n\nï¼ä¸ä¸ªéç¨çä»£çå®¢æ·ç«¯ï¼éç¨ Golang å¼åã\n\n * GitHub(opens new window)\n * æ¯æ HTTPãSOCKSãShadowsocksãVmess ç­å¤ç§ä»£çåè®®ã\n * æ¯æ LinuxãMacOSãWindowsãAndroid ç³»ç»ã\n * å¨ Linux ç³»ç»ä¸æ¯æéæä»£çã\n   * åçä¸ redsocks ç±»ä¼¼ï¼éè¦æå¨éç½® iptables è§åã\n\n\n# #ååä»£ç\n\nå®ç°ååä»£ççå¸¸è§å·¥å·ï¼\n\n * LVS\n * F5\n   * ï¼ä¸ä¸ªéè¿ç¡¬ä»¶å®ç°è´è½½åè¡¡çæå¡å¨ï¼åºäº BIG-IP åè®®ã\n * HAProxy\n   * ï¼ä¸ä¸ªååä»£çæå¡å¨ï¼å¯ä»¥å®ç°ç¬¬åå±ç TCP ä»£çãç¬¬ä¸å±ç HTTP ä»£çã\n * Nginx\n   * ï¼ä¸ä¸ªååä»£çæå¡å¨ï¼å¯ä»¥å®ç°ç¬¬åå±ç TCP ä»£çãç¬¬ä¸å±ç HTTP ä»£çã\n * frp\n\n\n# #LVS\n\nï¼Linux èææå¡å¨ï¼Linux Virtual Serverï¼ï¼æ¯ Linux çä¸ä¸ªåæ ¸æ¨¡åï¼éè¿è½¬å TCP/UDP æ°æ®åï¼å®ç°ç¬¬åå±çååä»£çã\n\n * LVS å·¥ä½å¨åæ ¸æï¼æ¯ Nginx ç­ç¨æ·æä»£ççæ§è½æ´é«ã\n\n * åçï¼\n   \n   * åå»ºä¸äº IPVSï¼IP Virtual Serverï¼ä½ä¸ºè´è½½åè¡¡å¨ã\n     * æ¯ä¸ª IPVS ç»å®ä¸ä¸ª Virtual IP ï¼ç§°ä¸º VIP ã\n     * æ¯ä¸ª IPVS è´è´£å°å°è®¿é® VIP ç TCPãUDP æµéååä»£çå°æäºåç«¯ç Real Server IP ï¼ç§°ä¸º RIP ã\n   * éç½® iptables è§åï¼å°è®¿é® VIP çæµéäº¤ç» IPVS å¤çã\n\n * æå¤ç§ååä»£çæ¨¡å¼ï¼\n   \n   * NAT æ¨¡å¼\n     * ï¼è½¬åè¯·æ±æ¥æç»åç«¯æ¶è¿è¡ DNAT ï¼è½¬åååºæ¥æç»å®¢æ·ç«¯æ¶è¿è¡ SNAT ï¼å®ç°éæä»£çã\n   * TUN æ¨¡å¼\n     * ï¼å°å®¢æ·ç«¯çè¯·æ±æ¥æéè¿ IP é§éï¼Tunnelï¼è½¬åç»åç«¯ï¼èåç«¯ç´æ¥è¿åååºæ¥æç»å®¢æ·ç«¯ã\n     * æ¯ NAT æ¨¡å¼çéåº¦æ´å¿«ã\n   * DR æ¨¡å¼\n     * ï¼éè¿æ¹åè¯·æ±æ¥æçç®æ  MAC å°åï¼å°å®è½¬åç»åç«¯ãèåç«¯ç´æ¥è¿åååºæ¥æç»å®¢æ·ç«¯ã\n     * æ¯ TUN æ¨¡å¼çéåº¦æ´å¿«ï¼ä½éè¦åç«¯æä¸ä¸ªç¬ç«çç½å¡ã\n\n * æ¯æå¤ç§è´è½½åè¡¡ç®æ³ï¼\n   \n   rr    # round robinï¼è½®è¯¢ï¼ï¼å°è¯·æ±æ¥æè½®æµè½¬åç»åä¸ªåç«¯ï¼ä½¿å¾æ¯ä¸ªåç«¯æ¶å°çè¯·æ±æ°å·®ä¸å¤ç¸ç­ãè¿æ¯é»è®¤ç­ç¥\n   wrr   # weight round robinï¼å æè½®è¯¢ï¼ï¼ç»æ¯ä¸ªåç«¯è®¾ç½®æéï¼æéæ´å¤§çåç«¯ï¼æ´å¤§æ¦çæ¶å°è¯·æ±\n   \n   sh    # source hashing ï¼è®¡ç®è¯·æ±æ¥æçæº IP çåå¸å¼ï¼å°åå¸å¼ç¸åçè¯·æ±è½¬åç»åä¸ä¸ªåç«¯\n   dh    # destination hashing ï¼è®¡ç®æ¥æçç®æ  IP çåå¸å¼\n   \n   lc    # least connectionï¼æå°è¿æ¥ï¼ï¼çæ§æ¯ä¸ªåç«¯çå½å TCP è¿æ¥æ°ï¼å°è¯·æ±è½¬åç»è¿æ¥æ°æå°çåç«¯\n   wlc   # weight least connectionï¼å æç lc ï¼\n   \n   lblc  # locality based least connectionsï¼åºäºå±é¨çæå°è¿æ¥ï¼ï¼è®°å½æ¯ä¸ªè¯·æ±çç®æ  IP ä¸ä¸æ¬¡ä½¿ç¨çåç«¯ï¼ä½ä¸ºè½¬åè§åï¼å¦æç®æ åç«¯è´è½½è¿å¤§ï¼åéç¨ lc ç®æ³\n   lblcr # locality based least connections with replicationï¼å¸¦å¤å¶ç lblc ï¼ï¼è®°å½æ¯ä¸ªè¯·æ±çç®æ  IP ä½¿ç¨çä¸ç»åç«¯ï¼éç¨ lc ä»ç»ä¸­éåºä¸ä¸ªåç«¯\n   \n   sed   # shortest expected delay ï¼çæ§æ¯ä¸ªåç«¯çå¹³åååºèæ¶ï¼å°è¯·æ±è½¬åç»èæ¶æç­çåç«¯\n   nq    # never queue ï¼ä¼åå°è¯·æ±è½¬åç»å½åè¿æ¥æ°ä¸º 0 çåç«¯ï¼å¦æä¸å­å¨è¿æ ·çåç«¯ï¼åéç¨ sed ç®æ³\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   \n\n\n# #frp\n\nï¼ä¸ä¸ªå½ä»¤è¡å·¥å·ï¼æä¾äºååä»£çãåç½ç©¿éçåè½ã\n\n * GitHub(opens new window)\n * éç¨ Golang å¼åã\n * æ¯æ TCPãUDPãHTTPãHTTPS ç­å¤ç§ä»£çåè®®ã\n * éç¨ C/S æ¶æå·¥ä½ã\n   * frps ï¼æå¡å¨ï¼é¨ç½²å¨ä»»ä¸ä¸»æºä¸ï¼ä¸éè®¿é®å¤é¨ï¼åªéè¢« frpcãç¨æ·è®¿é®ã\n     * frps æå¨ä¸»æºéå¸¸æ¥æä¸ä¸ªåºå®çå¤ç½ IP ï¼ä¾å¤ç½ç¨æ·è®¿é®ã\n     * ç¨æ·å frps åéç½ç»åæ¶ï¼ä¼åè¢« frps è½¬åå° frpc ï¼åè¢« frpc è½¬åå°åç½æå¡ã\n   * frpc ï¼å®¢æ·ç«¯ï¼é¨ç½²å¨ä»»ä¸ä¸»æºä¸ï¼ä¸éè¢«å¤é¨è®¿é®ï¼åªéè®¿é®å° frpsãåç½æå¡ã\n\nä¾ï¼\n\n 1. ç»å½ä¸å°ä¸»æºï¼ä¸è½½ frp çåè¡çï¼ç¼è¾éç½®æä»¶ frps.ini ï¼\n    \n    [common]\n    bind_port = 7000        # è®© frps çå¬ä¸ä¸ªç«¯å£ï¼ä¾ frpc è®¿é®ï¼ç¨äºå®ä»¬åé¨éä¿¡\n    token = xxxxxx          # ç¨äº frpc ä¸ frps ä¹é´çè®¤è¯\n    \n    \n    1\n    2\n    3\n    \n    \n    å¯å¨æå¡å¨ï¼\n    \n    ./frps -c frps.ini\n    \n    \n    1\n    \n    \n    æèç¨ docker-compose é¨ç½²ï¼\n    \n    version: \'3\'\n    \n    services:\n     frps:\n       container_name: frps\n       image: snowdreamtech/frps:0.37.0\n       restart: unless-stopped\n       ports:\n         - 7000:7000\n       volumes:\n         - ./frps.ini:/etc/frp/frps.ini\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    7\n    8\n    9\n    10\n    11\n    \n\n 2. ç»å½å¦ä¸ä¸ªä¸»æºï¼ç¼è¾éç½®æä»¶ frpc.ini ï¼\n    \n    [common]\n    server_addr = 1.1.1.1   # frps çå°å\n    server_port = 7000\n    token = xxxxxx\n    \n    # å®ä¹ä¸ä¸ªååä»£çï¼åç§°èªå®ä¹\n    [proxy1]\n    type = tcp                  # ä»£ççç±»å\n    local_ip = 10.0.0.1\n    local_port = 80-90,443\n    remote_port = 80-90,443     # è®© frps çå¬ remote_port ç«¯å£ï¼ä¾ç¨æ·è®¿é®ï¼å¹¶å°è¯¥ç«¯å£æ¶å°çç½ç»åè½¬åå° local_ip:local_port\n    # bandwidth_limit = 1MB     # éå¶å¸¦å®½ï¼é»è®¤æ éå¶\n    # use_compression = false   # frpc ä¸ frps ä¹é´éä¿¡æ¶ï¼æ¯å¦åç¼©\n    # use_encryption = false    # frpc ä¸ frps ä¹é´éä¿¡æ¶ï¼æ¯å¦å å¯\n    \n    # å¯ä»¥å®ä¹å¤ä¸ªååä»£ç\n    [proxy2]\n    ...\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    7\n    8\n    9\n    10\n    11\n    12\n    13\n    14\n    15\n    16\n    17\n    18\n    \n    \n    å¯å¨å®¢æ·ç«¯ï¼\n    \n    ./frpc -c frpc.ini\n    \n    \n    1\n    \n    \n    æèç¨ docker-compose é¨ç½²ï¼\n    \n    version: \'3\'\n    \n    services:\n     frpc:\n       container_name: frpc\n       image: snowdreamtech/frpc:0.37.0\n       restart: unless-stopped\n       volumes:\n         - ./frpc.ini:/etc/frp/frpc.ini\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    7\n    8\n    9\n    \n\n 3. è®©ç¨æ·è®¿é® frps çååä»£çç«¯å£ï¼\n    \n    curl 1.1.1.1:10080\n    \n    \n    1\n    \n\n\n# #VPN\n\nï¼èæç§æç½ç»ï¼Virtual Private Networkï¼ï¼æç±å¬ç½ä¸çå å°ä¸»æºç»æä¸ä¸ªèæçç§æç½ç»ã\n\n * å¸¸ç¨äºå®ç°æ­£åä»£çãæ¯å¦æä¸ªæºæ¿çåä¸ªæå¡å¨ä¸æ´é²å°å¬ç½ï¼ä½æºæ¿çç½å³æ´é²å°å¬ç½ï¼ç¨æ·å¯éè¿å¬ç½è¿æ¥è¯¥ç½å³ï¼ä»èè®¿é®è¯¥æºæ¿çåç½æå¡å¨ã\n * VPN è½¯ä»¶ä¸ä»£çè½¯ä»¶ç±»ä¼¼ï¼ä¸è¿éå¸¸ä¼è½¬åå®¢æ·ç«¯æ´ä¸ªä¸»æºçæµéãå å¯éä¿¡åå®¹ï¼èä»£çè½¯ä»¶ä¸ä¸å®æä¾è¿äºåè½ã\n\nåæé¾æ¥ï¼ç½ç»ä»£ç | LeoHsiao\'s Notes',normalizedContent:'# #ä»£çæå¡å¨\n\nï¼proxy server ï¼ç¨äºä»£æ¿ä¸ä¸ªä¸»æºä¸å¶å®ä¸»æºè¿è¡éä¿¡ã\n\n * å·¥ä½å¨ä¼è¯å±ï¼ä»£çåºç¨å±çæ¶æ¯ã\n * æåè®®åç±»ï¼\n   * ssh ä»£ç\n   * ftp ä»£ç\n   * http ä»£ç\n   * https ä»£ç\n   * socks ä»£çï¼å¨ç§°ä¸º sockets ï¼å·¥ä½å¨åºç¨å±ä¸ä¼ è¾å±ä¹é´ï¼æ¯ http ä»£çæ´åºå±ãæ´å¿«ã\n     * socks4 åªæ¯æ tcp è¿æ¥ï¼è socks5 è¿æ¯æ udp è¿æ¥ãå¯ç è®¤è¯ã\n     * ftpãhttpãsocks ä»£çé½æ¯ææéä¿¡ï¼è sshãhttpsãshadowsocks ä»£çæ¯å å¯éä¿¡ã\n * æä»£çåååç±»ï¼\n   * æ­£åä»£ç ï¼ä¾§éäºä»£æ¿å®¢æ·ç«¯ï¼åæå¡å¨ååºè®¿é®è¯·æ±ã\n   * ååä»£ç ï¼ä¾§éäºä»£æ¿æå¡å¨ï¼æ¥æ¶å®¢æ·ç«¯çè®¿é®è¯·æ±ã\n * ç¨éï¼\n   * å¯ä»¥ä½¿å®¢æ·ç«¯è®¿é®å°æäºä»£çæå¡å¨æè½è®¿é®çç½ç»ï¼å vpn çåè½ã\n   * å¯ä»¥æä»»é²ç«å¢ï¼è¿æ»¤å®¢æ·ç«¯åéãæ¥æ¶çæ°æ®ã\n   * å¯ä»¥å¨ææ´æ¹å°å®¢æ·ç«¯çæµéè½¬åå°åªä¸ªæå¡å¨ï¼æ¯å¦å®ç°è´è½½åè¡¡ã\n   * å¯ä»¥éç¦»æå¡å¨ä¸å®¢æ·ç«¯ï¼ä½¿å¾æå¡å¨ä¸ç¥éå®¢æ·ç«¯ççå® ip ãå®¢æ·ç«¯ä¸ç¥éæå¡å¨ççå® ip ã\n * ç¼ºç¹ï¼\n   * å®¢æ·ç«¯çéä¿¡æ°æ®é½è¦ç»è¿ä»£çæå¡å¨ï¼å¯è½è¢«çå¬ãç¯¡æ¹ã\n\n\n# #squid\n\nï¼ä¸ä¸ªä»£çæå¡å¨ï¼éç¨ c++ å¼åã\n\n * å®ç½(opens new window)\n * æ¯æ ftpãhttpãhttps ä»£çåè®®ã\n * å¸¸ç¨ä½ç®åç http æ­£åä»£çæå¡å¨ã\n * ä¹å¯ç¨äºååä»£çï¼ç¼å­ http æå¡å¨çååºæ¥æï¼ä½æ¯ nginx çåè½å°ã\n\n# #é¨ç½²\n\n * ç¨ yum å®è£ï¼\n   \n   yum install squid\n   systemctl start squid\n   systemctl enable squid\n   \n   \n   1\n   2\n   3\n   \n\n * æèç¨ docker-compose é¨ç½²ï¼\n   \n   version: \'3\'\n   \n   services:\n     squid:\n       container_name: squid\n       image: sameersbn/squid:3.5.27-2\n       restart: unless-stopped\n       ports:\n         - 3128:3128\n       volumes:\n         - ./conf:/etc/squid/\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   \n\n# #éç½®\n\nç¨ yum å®è£ squid æ¶ï¼å¼å¯æ­£åä»£ççæ­¥éª¤ï¼\n\n 1. ç¼è¾éç½®æä»¶Â /etc/squid/squid.confÂ ï¼\n    \n    http_port 3128\n    \n    # å®ä¹ä¸ä¸ª acl ç»ï¼åä¸º local_ip ï¼æåæº ip ä¸º 10.0.0.1/24 çæµé\n    # acl local_ip src 10.0.0.1/24\n    \n    # å®ä¹ä¸ä¸ª acl ç»ï¼ç¨å¯ç æä»¶è¿è¡èº«ä»½è®¤è¯\n    auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd\n    acl auth_user proxy_auth required\n    \n    # åè®¸æå® acl ç»çæµé\n    # http_access allow local_ip\n    http_access allow auth_user\n    # ç¦æ­¢å©ä¸çæææµé\n    http_access deny all\n    \n    # ä¸ç¼å­ææååºæ¥æ\n    cache deny all\n    \n    # é»è®¤ä¼å¨ http è¯·æ± headers ä¸­å å¥ x-forwarded-for ï¼å£°æå®¢æ·ç«¯ççå® ip ãè¿éå é¤è¯¥ header\n    forwarded_for delete\n    \n    # è®°å½è®¿é®æ¥å¿\n    access_log /var/log/squid/access.log squid\n    # æ¯é 30 å¤©ç¿»è½¬ä¸æ¬¡æ¥å¿\n    logfile_rotate 30\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    7\n    8\n    9\n    10\n    11\n    12\n    13\n    14\n    15\n    16\n    17\n    18\n    19\n    20\n    21\n    22\n    23\n    24\n    25\n    \n\n 2. çæå¯ç æä»¶ï¼\n    \n    yum install httpd-tools\n    htpasswd -cb /etc/squid/passwd leo ******\n    \n    \n    1\n    2\n    \n\n 3. æµè¯ä½¿ç¨è¯¥ä»£çï¼\n    \n    systemctl restart squid\n    curl -x http://leo:******@127.0.0.1:3128 cip.cc\n    \n    \n    1\n    2\n    \n\n\n# #socks5\n\n * ç¨ docker-compose é¨ç½²ä¸ä¸ª socks5 æå¡å¨ï¼\n   \n   version: \'3\'\n   \n   services:\n     socks5:\n       container_name: socks5\n       image: serjs/go-socks5-proxy\n       restart: unless-stopped\n       environment:\n         proxy_user: root\n         proxy_password: ******\n       ports:\n         - 1080:1080\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   \n   * è¯¥éåéç¨ golang å¼åï¼è¯¦è§å®æ¹ææ¡£Â (opens new window)ã\n\n\n# #shadowsocks\n\nï¼ä¸ç§åºäº socks5 åè®®çä»£çåè®®ï¼ç®ç§°ä¸º ss ï¼å¸¸ç¨äºå®ç° vpn ã\n\n * å®æ¹ææ¡£(opens new window)\n * æ¯æè®¾ç½®å¯ç ãå å¯ä¼ è¾æ°æ®ã\n * åçï¼\n   1. å¨ä¸å°ä¸»æºä¸è¿è¡ ss æå¡å¨ã\n   2. å¨æ¬æºè¿è¡ ss å®¢æ·ç«¯ï¼å°æ¬æºçæµéåéå° ss æå¡å¨ï¼è¢«å®ä»£çè½¬åã\n * shadowsocksr ï¼ç®ç§°ä¸º ssr ï¼æ¯ shadowsocks çååé¡¹ç®ã\n\n# #shadowsocks-libev\n\nï¼ä¸ä¸ª ss ä»£çæå¡å¨è½¯ä»¶ã\n\n * äº 2015 å¹´åå¸ï¼éç¨ c è¯­è¨å¼åï¼äº 2020 å¹´åæ­¢æ´æ°ã\n\n * æ¯æ aead cipher å å¯ç®æ³ã\n\n * æ¯æ obfs æ··æ·ï¼å¯ä»¥å° ss æµéä¼ªè£æ http æµéã\n\n * ç¨ docker é¨ç½²æå¡å¨ï¼\n   \n   docker run -d --name shadowsocks \\\n           --restart unless-stopped \\\n           -p 8388:8388 \\\n           shadowsocks/shadowsocks-libev:v3.3.5 \\\n           ss-server -s 0.0.0.0 -k ****** -m aes-256-gcm\n   \n   \n   1\n   2\n   3\n   4\n   5\n   \n   \n   æå¡å¨çå½ä»¤ï¼\n   \n   ss-server               # å¯å¨æå¡å¨\n           -c config.json  # ä½¿ç¨æå®çéç½®æä»¶\n           -s 0.0.0.0      # è®¾ç½®æå¡å¨çå¬ç ip\n           -p 8388         # è®¾ç½®æå¡å¨çå¬çç«¯å£\n           -k ******       # è®¾ç½®æå¡å¨çè®¤è¯å¯ç \n           -m aes-256-gcm  # è®¾ç½®æå¡å¨çå å¯æ¹å¼\n           -v              # æ¾ç¤ºè¯¦ç»æ¥å¿\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   \n\n# #shadowsocks-rust\n\nï¼ä¸ä¸ª ss ä»£çæå¡å¨è½¯ä»¶ã\n\n * ç¨ docker é¨ç½²æå¡å¨ï¼\n   \n   docker run -d --name ssserver-rust \\\n           --restart unless-stopped \\\n           -p 8388:8388 \\\n           -v /root/shadowsocks-rust/config.json:/etc/shadowsocks-rust/config.json \\\n           ghcr.io/shadowsocks/ssserver-rust:v1.14.3\n   \n   \n   1\n   2\n   3\n   4\n   5\n   \n   \n   éç½®æä»¶ç¤ºä¾ï¼\n   \n   {\n       "server": "0.0.0.0",\n       "server_port": 8388,\n       "password": "******",\n       "method": "chacha20-ietf-poly1305",\n       "fast_open": false\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   \n\n# #å®¢æ·ç«¯\n\nwindows ç ss å®¢æ·ç«¯Â (opens new window)ï¼\n\n * è¿è¡ ss å®¢æ·ç«¯ä¹åï¼å®ä¼è¿æ¥å° ss æå¡å¨ï¼åæ¶å¨æ¬æºçå¬ä¸ä¸ªä»£çç«¯å£ã\n * æ¬æºçè¿ç¨å¯ä»¥éè¿ httpãsocket ä»£çåè®®ï¼å°æ°æ®åéå°è¯¥ä»£çç«¯å£ï¼ç¶å ss å®¢æ·ç«¯ä¼å°è¿äºæ°æ®è½¬åå° ss æå¡å¨ï¼å®ç°æ­£åä»£çã\n * ä¹å¯ä»¥å¼å¯ ss å®¢æ·ç«¯çå¨å±æ¨¡å¼ï¼ä»£çæ¬æºçæææµéã\n\nlinux ç ss å®¢æ·ç«¯ ï¼\n\n * å®æ¯ä¸ä¸ªå½ä»¤è¡å·¥å·ï¼åè½è¾å°ï¼ä¸è½è¿æ¥å¤ä¸ª ss æå¡å¨ï¼å¨æ¬æºæä¾çä»£çç«¯å£åªæ¯æ socket åè®®ã\n\n * é¨ç½²ç¤ºä¾ï¼\n   \n   # å®è£\n   pip3 install shadowsocks\n   \n   # ç¼è¾éç½®æä»¶\n   cat > ss.json <<eof{    "server": "10.0.0.1",    "server_port": 8388,    "local_address": "127.0.0.1",    "local_port": 8388,    "password": "******",    "timeout": 5,    "method": "aes-256-cfb"}eof\n   \n   # å¯å¨å®¢æ·ç«¯\n   sslocal -c ss.json -d start\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   \n   \n   ä¸ä¸ª sslocal å®¢æ·ç«¯åªè½è¿æ¥ä¸ä¸ª ss æå¡å¨ã\n\n * å¯ä»¥åè¿è¡ä»£çæå¡å¨ privoxy ï¼çå¬ä¸ä¸ª http ä»£çç«¯å£ï¼å°è¯¥ç«¯å£çæµéè½¬åå° socket ä»£çç«¯å£ã\n   \n   # å®è£\n   yum install -y privoxy\n   systemctl start privoxy\n   systemctl enable privoxy\n   \n   # ç¼è¾éç½®æä»¶\n   sed \'/listen-address  127.0.0.1:8118/d\' /etc/privoxy/config -i\n   cat >> /etc/privoxy/config <<eoflisten-address  0.0.0.0:8118# å° http è¯·æ±è½¬åå°è¯¥ä»£çforward-socks5  /   127.0.0.1:8388 .# ç¬¬ä¸ä¸ªå­æ®µä¸º url_pattern ï¼åå¼ä¸º / åå¹éææ http è¯·æ±# ç¬¬äºãä¸ä¸ªå­æ®µä¸ºä»£çãç¶çº§ä»£çï¼åå¼ä¸º . åè¡¨ç¤ºå¿½ç¥# ä¸ä»£çè¿äº http è¯·æ±forward         10.*.*.*/      .forward         127.*.*.*/     .forward         172.16.*.*/    .forward         192.168.*.*/   .eof\n   \n   # éå¯\n   systemctl restart privoxy\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   \n   \n   è¯ç¨è¯¥ä»£çï¼\n   \n   curl -x 127.0.0.1:8118 google.com\n   \n   \n   1\n   \n\n\n# #v2ray\n\nï¼ä¸ä¸ªä»£çæå¡å¨ï¼æ¯ ss çåè½æ´å¤ã\n\n * github(opens new window)\n\n * äº 2019 å¹´åå¸ï¼éç¨ goalng è¯­è¨å¼åãæ¯ project v ç¤¾åºç åçä¸»è¦è½¯ä»¶ï¼åæ¥æ¹åä¸º v2fly ã\n\n * v2ray æå¡å¨çæµéåä¸ºä¸¤ä¸ªæ¹åï¼\n   \n   * inbounds ï¼å¥ç«æµéï¼å³å®¢æ·ç«¯åéå° v2ray çæµéã\n     * å®¢æ·ç«¯å¯ä½¿ç¨ v2ray ååç vmess ä»£çåè®®ï¼ä¹å¼å®¹ httpãshadowsocks ç­ä»£çåè®®ã\n   * outbounds ï¼åºç«æµéï¼å³ v2ray å°å®¢æ·ç«¯çæµéè½¬åå°æä¸ªç½ç«ã\n\n * ç¨ docker é¨ç½²æå¡å¨ï¼\n   \n   docker run -d --name v2fly \\\n           --restart unless-stopped \\\n           -v /root/v2fly/config.json:/etc/v2fly/config.json \\\n           -p 80:80 \\\n           v2fly/v2fly-core:v5.1.0 \\\n           run -c /etc/v2fly/config.json\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   \n   \n   éç½®æä»¶ç¤ºä¾ï¼\n   \n   {\n     "inbounds": [{\n       "port": 80,\n       "protocol": "vmess",\n       "settings": {\n         // åªåè®¸è¿äº id çå®¢æ·ç«¯è¿æ¥\n         "clients": [{ "id": "******" }]\n       }\n     }],\n     "outbounds": [{\n       "protocol": "freedom",\n       "settings": {}\n     }]\n   }\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   \n\n * å¨ windows ä¸å¸¸ç¨çå®¢æ·ç«¯è½¯ä»¶æ¯Â v2raynÂ (opens new window)ã\n\n\n# #trojan\n\nï¼ä¸ä¸ªä»£çæå¡å¨ãè½å å¯éä¿¡ï¼å¹¶ä¼ªè£æäºèç½å¸¸è§ç https æµéã\n\n * äº 2019 å¹´åå¸ï¼éç¨ c++ è¯­è¨å¼åã\n\n\n# #ä»£çå®¢æ·ç«¯\n\n * æçç¨åºä¸æ¯æä½¿ç¨ä»£çï¼æçç¨åºåªæ¯æä½¿ç¨ http ç­ç®åçä»£çåè®®ãå æ­¤å»ºè®®å®è£ä¸ä¸ªä¸ç¨çä»£çå®¢æ·ç«¯ï¼éè¿ä¸¤ç§æ¹å¼ä»£çå¶å®ç¨åºçæµéï¼\n   * éæä»£çï¼transparent proxyï¼ï¼\n     * æ¦æªå¶å®ç¨åºååºçæµéï¼è½¬åå°ä»£çæå¡å¨ãå¶å®ç¨åºä¸ä¼æç¥å°ä»£çï¼ä¸éè¦ä¸»å¨ä½¿ç¨ä»£çã\n   * è½¬æ¢ä»£çåè®®ï¼\n     * éè¿æç§ä»£çåè®®è¿æ¥å°ä»£çæå¡å¨ï¼åå¨æ¬æºçå¬ä¸ä¸ªéç¨ http ç­ç®åä»£çåè®®çç«¯å£ï¼å°è¯¥ç«¯å£æ¶å°çæµéè½¬åå°ä»£çæå¡å¨ã\n     * æ­¤æ¶ï¼å·æä»£çåè½çç¨åºï¼ä¸è¬é½è½éè¿è¯¥ç«¯å£ä½¿ç¨ä»£çãä½æ²¡æä»£çåè½çç¨åºï¼ä¾ç¶ä¸è½ä½¿ç¨ä»£çã\n\n\n# #proxifier\n\nï¼ä¸ä¸ª gui å·¥å·ï¼ç¨ä½ä»£çå®¢æ·ç«¯ï¼æ¶è´¹ã\n\n * ç¹ç¹ï¼\n   * æ¯æ windowsãmacos ç³»ç»ï¼ä¸æ¯æ linux ã\n   * æ¯æ httpãhttpsãsocks4ãsocks5 ä»£çåè®®ã\n   * æ¯æéæä»£çãåçå¦ä¸ï¼\n     * windows ç³»ç»ä¸ï¼ä¸è¬ç¨åºéè¦è°ç¨ winsock api è¿è¡ socket éä¿¡ã\n     * winsock æä¾äº lspï¼layered service providerï¼ åè½ï¼åè®¸ç¨åºèªå®ä¹ä¸ä¸ª lsp dll åºï¼å¨ä¸è¬ç¨åºè°ç¨ winsock api æ¶è¢«å è½½ï¼ä»èå¯ä»¥å«æå¶æµéã\n   * æ¯æçµæ´»çä»£çè§åï¼å°æä¸ªç¨åºååæ ip:port ç tcp åï¼è½¬åå°æä¸ªä»£çæå¡å¨ãæ¯æééç¬¦ã\n   * æ¯æç¨å¤ä¸ªä»£çæå¡å¨ç»æä»£çé¾ã\n * ç¨æ³ï¼\n   1. å®è£ proxifier å¹¶å¯å¨ã\n   2. æ·»å ä»£çæå¡å¨ã\n   3. æ·»å ä»£çè§åã\n   4. ä¿æ proxifier è¿è¡ï¼å³å¯ä»£çæ¬æºç¨åºçæµéã\n\n\n# #proxychains\n\nï¼ä¸ä¸ª unix ç³»ç»çå½ä»¤è¡å·¥å·ï¼éç¨ c è¯­è¨å¼åï¼ç¨ä½ä»£çå®¢æ·ç«¯ã\n\n * github(opens new window)\n * æ¯æéæä»£çãåçå¦ä¸ï¼\n   1. å£°æç¯å¢åé ld_preload ï¼è®©ç¨åºå¨å¯¼å¥ dll åºæ¶ï¼ä¼åå¯¼å¥ libproxychains4.so åºã\n   2. å¨ libproxychains4.so åºä¸­ï¼éåå³äº socket éä¿¡çå½æ°ï¼å°ç¨åºååºç tcp æµéè½¬åå°ä»£çæå¡å¨ã\n * ç¼ºç¹ï¼\n   * åªè½ä»£ç tcp æµéï¼ä¸æ¯æ udpãicmp ã\n   * åªè½ä»£çæå®çç¨åºï¼ä¸è½ä»£çç³»ç»ææè¿ç¨ã\n   * åªè½ä»£çéç¨å¨æé¾æ¥åºçç¨åºã\n     * chrome æµè§å¨å¨æ²çä¸­è¿è¡ç½é¡µï¼ä¹ä¸ä¼è¢«ä»£çã\n\nç¨æ³ï¼\n\n 1. å®è£ï¼\n    \n    wget https://github.com/rofl0r/proxychains-ng/archive/refs/tags/v4.14.tar.gz\n    tar -zxvf v4.14.tar.gz\n    cd proxychains-ng-4.14\n    ./configure --prefix=/usr --sysconfdir=/etc\n    make\n    make install\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    \n\n 2. ç¼è¾éç½®æä»¶ /etc/proxychains.conf ï¼ç¤ºä¾ï¼\n    \n    quiet_mode          # å®éæ¨¡å¼ï¼è¿è¡æ¶ä¸è¾åºè¿ç¨ä¿¡æ¯\n    dynamic_chain       # èªå¨éç¨ proxylist ä¸­å¯ç¨çä»£çï¼ä¸æé¡ºåº\n    proxy_dns           # å° dns è¯·æ±ä¹ä»£ç\n    \n    # åæ¶ä»£çååæå® ip çæ°æ®å\n    localnet 127.0.0.0/255.0.0.0\n    localnet 10.0.0.0/255.0.0.0\n    localnet 172.16.0.0/255.240.0.0\n    localnet 192.168.0.0/255.255.0.0\n    \n    # åéæ°æ®åæ¶ï¼ä¿®æ¹ç®æ  ip:port\n    dnat 1.1.1.1:80  1.1.1.2:443\n    dnat 1.1.1.1:443 1.1.1.2\n    dnat 1.1.1.1     1.1.1.2\n    \n    # å£°æä¸ç»ä»£çæå¡å¨ï¼æ¯æ httpãsocks4ãsocks5 ä»£çåè®®ï¼æ¯æè®¾ç½®è´¦å·å¯ç \n    [proxylist]\n    http    127.0.0.1   3128\n    socks5  127.0.0.1   1080  root  ******\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    7\n    8\n    9\n    10\n    11\n    12\n    13\n    14\n    15\n    16\n    17\n    18\n    19\n    \n\n 3. æ§è¡å½ä»¤ï¼\n    \n    proxychains4 curl cip.cc  # å¨ä»£çä¸æ§è¡ä¸æ¡å½ä»¤\n    proxychains4 bash         # åå»ºä¸ä¸ª shell ï¼å¨å¶ä¸­æ§è¡çå½ä»¤é½éç¨ä»£ç\n    \n    \n    1\n    2\n    \n\n\n# #redsocks\n\nï¼ä¸ä¸ª linux ç³»ç»çå½ä»¤è¡å·¥å·ï¼éç¨ c è¯­è¨å¼åï¼ç¨ä½ä»£çå®¢æ·ç«¯ã\n\n * github(opens new window)\n * æ¯æéæä»£çãåçå¦ä¸ï¼\n   1. redsocks è¿æ¥å°ä»£çæå¡å¨ï¼å¹¶å¨æ¬æºçå¬ä¸ä¸ªç«¯å£ï¼å°è¯¥ç«¯å£æ¶å°çæµéè½¬åå°ä»£çæå¡å¨ã\n   2. ç¨æ·æå¨éç½® iptables é²ç«å¢è§åï¼å°æ¬æºååºç tcp æµééå®åå° redsocks ç«¯å£ã\n * ç¼ºç¹ï¼\n   * éè¦æå¨éç½® iptables è§åï¼æ¯è¾éº»ç¦ã\n   * æäºç¨åºå¯è½æ è§ iptables è§åã\n\nç¨æ³ï¼\n\n 1. ç¨ apt å®è£ï¼\n    \n    apt install redsocks\n    \n    \n    1\n    \n    \n    æèæå¨ç¼è¯åå®è£ï¼\n    \n    git clone https://github.com/darkk/redsocks\n    cd redsocks\n    make\n    cp redsocks /usr/bin/redsocks\n    \n    \n    1\n    2\n    3\n    4\n    \n\n 2. ç¼è¾éç½®æä»¶ /etc/redsocks.conf ï¼ç¤ºä¾ï¼\n    \n    base {\n       log_debug  = off;\n       log_info   = on;\n       log        = stderr;    # æ¥å¿çä¿å­ä½ç½®ï¼å¯æ¹ä¸º "file:/var/log/redsocks.log" æä»¶\n       daemon     = on;\n       redirector = iptables;\n    }\n    \n    redsocks {\n       // å¨æ¬æºçå¬çç«¯å£\n       local_ip   = 127.0.0.1;\n       local_port = 12345;\n    \n       // è¦è¿æ¥çä»£çæå¡å¨\n       ip       = 10.0.0.1;\n       port     = 1080;\n       type     = socks5;\n       login    = <username>;\n       password = <password>;\n    }\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    7\n    8\n    9\n    10\n    11\n    12\n    13\n    14\n    15\n    16\n    17\n    18\n    19\n    20\n    \n    * å¯ä»¥å®ä¹å¤ä¸ª redsocks{} ä»£çéç½®ã\n\n 3. ç¨ systemctl ä¿æè¿è¡ï¼\n    \n    systemctl restart redsocks\n    systemctl enable  redsocks\n    \n    \n    1\n    2\n    \n    \n    æèæå¨å¯å¨ï¼\n    \n    redsocks -c /etc/redsocks.conf\n    \n    \n    1\n    \n\n 4. æ·»å  iptables è§åï¼\n    \n    iptables -t nat -a output -p tcp -d 192.168.1.0/24 -j redirect --to-ports 12345   # ç¼è¾ nat è¡¨ï¼å°æ¬æºååºçæäºæµééå®å redsocks ç«¯å£\n    iptables -t nat -l output   # æ¥ç iptables è§å\n    \n    \n    1\n    2\n    \n    \n    ç³»ç»éå¯æ¶ä¼éç½® iptables è§åãå æ­¤å»ºè®®å°éç½® iptables çå½ä»¤ä¿å­ä¸ºä¸ä¸ª shell èæ¬ï¼æ¯æ¬¡ç³»ç»éå¯æ¶æ§è¡å®ã\n\n\n# #clash\n\nï¼ä¸ä¸ªéç¨çä»£çå®¢æ·ç«¯ï¼éç¨ golang å¼åã\n\n * github(opens new window)\n * æ¯æ httpãsocksãshadowsocksãvmess ç­å¤ç§ä»£çåè®®ã\n * æ¯æ linuxãmacosãwindowsãandroid ç³»ç»ã\n * å¨ linux ç³»ç»ä¸æ¯æéæä»£çã\n   * åçä¸ redsocks ç±»ä¼¼ï¼éè¦æå¨éç½® iptables è§åã\n\n\n# #ååä»£ç\n\nå®ç°ååä»£ççå¸¸è§å·¥å·ï¼\n\n * lvs\n * f5\n   * ï¼ä¸ä¸ªéè¿ç¡¬ä»¶å®ç°è´è½½åè¡¡çæå¡å¨ï¼åºäº big-ip åè®®ã\n * haproxy\n   * ï¼ä¸ä¸ªååä»£çæå¡å¨ï¼å¯ä»¥å®ç°ç¬¬åå±ç tcp ä»£çãç¬¬ä¸å±ç http ä»£çã\n * nginx\n   * ï¼ä¸ä¸ªååä»£çæå¡å¨ï¼å¯ä»¥å®ç°ç¬¬åå±ç tcp ä»£çãç¬¬ä¸å±ç http ä»£çã\n * frp\n\n\n# #lvs\n\nï¼linux èææå¡å¨ï¼linux virtual serverï¼ï¼æ¯ linux çä¸ä¸ªåæ ¸æ¨¡åï¼éè¿è½¬å tcp/udp æ°æ®åï¼å®ç°ç¬¬åå±çååä»£çã\n\n * lvs å·¥ä½å¨åæ ¸æï¼æ¯ nginx ç­ç¨æ·æä»£ççæ§è½æ´é«ã\n\n * åçï¼\n   \n   * åå»ºä¸äº ipvsï¼ip virtual serverï¼ä½ä¸ºè´è½½åè¡¡å¨ã\n     * æ¯ä¸ª ipvs ç»å®ä¸ä¸ª virtual ip ï¼ç§°ä¸º vip ã\n     * æ¯ä¸ª ipvs è´è´£å°å°è®¿é® vip ç tcpãudp æµéååä»£çå°æäºåç«¯ç real server ip ï¼ç§°ä¸º rip ã\n   * éç½® iptables è§åï¼å°è®¿é® vip çæµéäº¤ç» ipvs å¤çã\n\n * æå¤ç§ååä»£çæ¨¡å¼ï¼\n   \n   * nat æ¨¡å¼\n     * ï¼è½¬åè¯·æ±æ¥æç»åç«¯æ¶è¿è¡ dnat ï¼è½¬åååºæ¥æç»å®¢æ·ç«¯æ¶è¿è¡ snat ï¼å®ç°éæä»£çã\n   * tun æ¨¡å¼\n     * ï¼å°å®¢æ·ç«¯çè¯·æ±æ¥æéè¿ ip é§éï¼tunnelï¼è½¬åç»åç«¯ï¼èåç«¯ç´æ¥è¿åååºæ¥æç»å®¢æ·ç«¯ã\n     * æ¯ nat æ¨¡å¼çéåº¦æ´å¿«ã\n   * dr æ¨¡å¼\n     * ï¼éè¿æ¹åè¯·æ±æ¥æçç®æ  mac å°åï¼å°å®è½¬åç»åç«¯ãèåç«¯ç´æ¥è¿åååºæ¥æç»å®¢æ·ç«¯ã\n     * æ¯ tun æ¨¡å¼çéåº¦æ´å¿«ï¼ä½éè¦åç«¯æä¸ä¸ªç¬ç«çç½å¡ã\n\n * æ¯æå¤ç§è´è½½åè¡¡ç®æ³ï¼\n   \n   rr    # round robinï¼è½®è¯¢ï¼ï¼å°è¯·æ±æ¥æè½®æµè½¬åç»åä¸ªåç«¯ï¼ä½¿å¾æ¯ä¸ªåç«¯æ¶å°çè¯·æ±æ°å·®ä¸å¤ç¸ç­ãè¿æ¯é»è®¤ç­ç¥\n   wrr   # weight round robinï¼å æè½®è¯¢ï¼ï¼ç»æ¯ä¸ªåç«¯è®¾ç½®æéï¼æéæ´å¤§çåç«¯ï¼æ´å¤§æ¦çæ¶å°è¯·æ±\n   \n   sh    # source hashing ï¼è®¡ç®è¯·æ±æ¥æçæº ip çåå¸å¼ï¼å°åå¸å¼ç¸åçè¯·æ±è½¬åç»åä¸ä¸ªåç«¯\n   dh    # destination hashing ï¼è®¡ç®æ¥æçç®æ  ip çåå¸å¼\n   \n   lc    # least connectionï¼æå°è¿æ¥ï¼ï¼çæ§æ¯ä¸ªåç«¯çå½å tcp è¿æ¥æ°ï¼å°è¯·æ±è½¬åç»è¿æ¥æ°æå°çåç«¯\n   wlc   # weight least connectionï¼å æç lc ï¼\n   \n   lblc  # locality based least connectionsï¼åºäºå±é¨çæå°è¿æ¥ï¼ï¼è®°å½æ¯ä¸ªè¯·æ±çç®æ  ip ä¸ä¸æ¬¡ä½¿ç¨çåç«¯ï¼ä½ä¸ºè½¬åè§åï¼å¦æç®æ åç«¯è´è½½è¿å¤§ï¼åéç¨ lc ç®æ³\n   lblcr # locality based least connections with replicationï¼å¸¦å¤å¶ç lblc ï¼ï¼è®°å½æ¯ä¸ªè¯·æ±çç®æ  ip ä½¿ç¨çä¸ç»åç«¯ï¼éç¨ lc ä»ç»ä¸­éåºä¸ä¸ªåç«¯\n   \n   sed   # shortest expected delay ï¼çæ§æ¯ä¸ªåç«¯çå¹³åååºèæ¶ï¼å°è¯·æ±è½¬åç»èæ¶æç­çåç«¯\n   nq    # never queue ï¼ä¼åå°è¯·æ±è½¬åç»å½åè¿æ¥æ°ä¸º 0 çåç«¯ï¼å¦æä¸å­å¨è¿æ ·çåç«¯ï¼åéç¨ sed ç®æ³\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   \n\n\n# #frp\n\nï¼ä¸ä¸ªå½ä»¤è¡å·¥å·ï¼æä¾äºååä»£çãåç½ç©¿éçåè½ã\n\n * github(opens new window)\n * éç¨ golang å¼åã\n * æ¯æ tcpãudpãhttpãhttps ç­å¤ç§ä»£çåè®®ã\n * éç¨ c/s æ¶æå·¥ä½ã\n   * frps ï¼æå¡å¨ï¼é¨ç½²å¨ä»»ä¸ä¸»æºä¸ï¼ä¸éè®¿é®å¤é¨ï¼åªéè¢« frpcãç¨æ·è®¿é®ã\n     * frps æå¨ä¸»æºéå¸¸æ¥æä¸ä¸ªåºå®çå¤ç½ ip ï¼ä¾å¤ç½ç¨æ·è®¿é®ã\n     * ç¨æ·å frps åéç½ç»åæ¶ï¼ä¼åè¢« frps è½¬åå° frpc ï¼åè¢« frpc è½¬åå°åç½æå¡ã\n   * frpc ï¼å®¢æ·ç«¯ï¼é¨ç½²å¨ä»»ä¸ä¸»æºä¸ï¼ä¸éè¢«å¤é¨è®¿é®ï¼åªéè®¿é®å° frpsãåç½æå¡ã\n\nä¾ï¼\n\n 1. ç»å½ä¸å°ä¸»æºï¼ä¸è½½ frp çåè¡çï¼ç¼è¾éç½®æä»¶ frps.ini ï¼\n    \n    [common]\n    bind_port = 7000        # è®© frps çå¬ä¸ä¸ªç«¯å£ï¼ä¾ frpc è®¿é®ï¼ç¨äºå®ä»¬åé¨éä¿¡\n    token = xxxxxx          # ç¨äº frpc ä¸ frps ä¹é´çè®¤è¯\n    \n    \n    1\n    2\n    3\n    \n    \n    å¯å¨æå¡å¨ï¼\n    \n    ./frps -c frps.ini\n    \n    \n    1\n    \n    \n    æèç¨ docker-compose é¨ç½²ï¼\n    \n    version: \'3\'\n    \n    services:\n     frps:\n       container_name: frps\n       image: snowdreamtech/frps:0.37.0\n       restart: unless-stopped\n       ports:\n         - 7000:7000\n       volumes:\n         - ./frps.ini:/etc/frp/frps.ini\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    7\n    8\n    9\n    10\n    11\n    \n\n 2. ç»å½å¦ä¸ä¸ªä¸»æºï¼ç¼è¾éç½®æä»¶ frpc.ini ï¼\n    \n    [common]\n    server_addr = 1.1.1.1   # frps çå°å\n    server_port = 7000\n    token = xxxxxx\n    \n    # å®ä¹ä¸ä¸ªååä»£çï¼åç§°èªå®ä¹\n    [proxy1]\n    type = tcp                  # ä»£ççç±»å\n    local_ip = 10.0.0.1\n    local_port = 80-90,443\n    remote_port = 80-90,443     # è®© frps çå¬ remote_port ç«¯å£ï¼ä¾ç¨æ·è®¿é®ï¼å¹¶å°è¯¥ç«¯å£æ¶å°çç½ç»åè½¬åå° local_ip:local_port\n    # bandwidth_limit = 1mb     # éå¶å¸¦å®½ï¼é»è®¤æ éå¶\n    # use_compression = false   # frpc ä¸ frps ä¹é´éä¿¡æ¶ï¼æ¯å¦åç¼©\n    # use_encryption = false    # frpc ä¸ frps ä¹é´éä¿¡æ¶ï¼æ¯å¦å å¯\n    \n    # å¯ä»¥å®ä¹å¤ä¸ªååä»£ç\n    [proxy2]\n    ...\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    7\n    8\n    9\n    10\n    11\n    12\n    13\n    14\n    15\n    16\n    17\n    18\n    \n    \n    å¯å¨å®¢æ·ç«¯ï¼\n    \n    ./frpc -c frpc.ini\n    \n    \n    1\n    \n    \n    æèç¨ docker-compose é¨ç½²ï¼\n    \n    version: \'3\'\n    \n    services:\n     frpc:\n       container_name: frpc\n       image: snowdreamtech/frpc:0.37.0\n       restart: unless-stopped\n       volumes:\n         - ./frpc.ini:/etc/frp/frpc.ini\n    \n    \n    1\n    2\n    3\n    4\n    5\n    6\n    7\n    8\n    9\n    \n\n 3. è®©ç¨æ·è®¿é® frps çååä»£çç«¯å£ï¼\n    \n    curl 1.1.1.1:10080\n    \n    \n    1\n    \n\n\n# #vpn\n\nï¼èæç§æç½ç»ï¼virtual private networkï¼ï¼æç±å¬ç½ä¸çå å°ä¸»æºç»æä¸ä¸ªèæçç§æç½ç»ã\n\n * å¸¸ç¨äºå®ç°æ­£åä»£çãæ¯å¦æä¸ªæºæ¿çåä¸ªæå¡å¨ä¸æ´é²å°å¬ç½ï¼ä½æºæ¿çç½å³æ´é²å°å¬ç½ï¼ç¨æ·å¯éè¿å¬ç½è¿æ¥è¯¥ç½å³ï¼ä»èè®¿é®è¯¥æºæ¿çåç½æå¡å¨ã\n * vpn è½¯ä»¶ä¸ä»£çè½¯ä»¶ç±»ä¼¼ï¼ä¸è¿éå¸¸ä¼è½¬åå®¢æ·ç«¯æ´ä¸ªä¸»æºçæµéãå å¯éä¿¡åå®¹ï¼èä»£çè½¯ä»¶ä¸ä¸å®æä¾è¿äºåè½ã\n\nåæé¾æ¥ï¼ç½ç»ä»£ç | leohsiao\'s notes',charsets:{cjk:!0}},{title:"dockeré¨ç½²openvas",frontmatter:{title:"dockeré¨ç½²openvas",date:"2022-12-15T19:21:33.000Z",permalink:"/pages/7f4bdd/",categories:["è¿ç»´","å®å¨"],tags:[null],readingShow:"top",description:"å­¦å®å¨çäººæ³å¿é½ç¥éopenvasï¼ä»æ¯ä¸ä¸ªå¼æºçç¦»çº¿æ¼æ´è¯ä¼°ç³»ç»ï¼æéå¸¸ä¸°å¯çæ¼æ´åºãä¸è¿è¿ä¹æ¯è®©äººç¦æ¼çä¸ä¸ªå°æ¹ï¼æä¸°å¯çæ¼æ´åºç¶ååæ¯ç¦»çº¿çå°±ä»£è¡¨å®è£çæ¶åè¦ä¸è½½å¾å¤å¾å¤æ°æ®åãåopenvasæ¬èº«å°±è¦ä¸è½½1Gçå®è£åï¼æ´æ°æ¼æ´åºçæ¶åè¿æä¸è½½1Gçå éç¹æ¯openvasçä¸è½½æå¡å¨å¨å½å¤ï¼å¯¹æä»¬è¿ç§æé¿åä¿æ¤çè¯æ°æ¥è¯´å°±æ¯10å Kçä¸è½½éåº¦\næè¿æ æé´çå°githubä¸é¢æä¸ªopenvasçå¼æºé¡¹ç®ï¼æopenvasæåæä¸ä¸ªdockerå®¹å¨ï¼é¨ç½²åªéè¦å¯å¨ä¸ä¸ªå®¹å¨ï¼å¿«éï¼æ¹ä¾¿è¿ä¸å ç©ºé´ãgithubé¡¹ç®å°åï¼https://github.com/mikesplain/openvas-docker",meta:[{name:"image",content:"https://img-blog.csdnimg.cn/20181107134156923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3doYXRkYXk=,size_16,color_FFFFFF,t_70"},{name:"twitter:title",content:"dockeré¨ç½²openvas"},{name:"twitter:description",content:"å­¦å®å¨çäººæ³å¿é½ç¥éopenvasï¼ä»æ¯ä¸ä¸ªå¼æºçç¦»çº¿æ¼æ´è¯ä¼°ç³»ç»ï¼æéå¸¸ä¸°å¯çæ¼æ´åºãä¸è¿è¿ä¹æ¯è®©äººç¦æ¼çä¸ä¸ªå°æ¹ï¼æä¸°å¯çæ¼æ´åºç¶ååæ¯ç¦»çº¿çå°±ä»£è¡¨å®è£çæ¶åè¦ä¸è½½å¾å¤å¾å¤æ°æ®åãåopenvasæ¬èº«å°±è¦ä¸è½½1Gçå®è£åï¼æ´æ°æ¼æ´åºçæ¶åè¿æä¸è½½1Gçå éç¹æ¯openvasçä¸è½½æå¡å¨å¨å½å¤ï¼å¯¹æä»¬è¿ç§æé¿åä¿æ¤çè¯æ°æ¥è¯´å°±æ¯10å Kçä¸è½½éåº¦\næè¿æ æé´çå°githubä¸é¢æä¸ªopenvasçå¼æºé¡¹ç®ï¼æopenvasæåæä¸ä¸ªdockerå®¹å¨ï¼é¨ç½²åªéè¦å¯å¨ä¸ä¸ªå®¹å¨ï¼å¿«éï¼æ¹ä¾¿è¿ä¸å ç©ºé´ãgithubé¡¹ç®å°åï¼https://github.com/mikesplain/openvas-docker"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://img-blog.csdnimg.cn/20181107134156923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3doYXRkYXk=,size_16,color_FFFFFF,t_70"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/05.%E5%AE%89%E5%85%A8/01.docker%E9%83%A8%E7%BD%B2openvas.html"},{property:"og:type",content:"article"},{property:"og:title",content:"dockeré¨ç½²openvas"},{property:"og:description",content:"å­¦å®å¨çäººæ³å¿é½ç¥éopenvasï¼ä»æ¯ä¸ä¸ªå¼æºçç¦»çº¿æ¼æ´è¯ä¼°ç³»ç»ï¼æéå¸¸ä¸°å¯çæ¼æ´åºãä¸è¿è¿ä¹æ¯è®©äººç¦æ¼çä¸ä¸ªå°æ¹ï¼æä¸°å¯çæ¼æ´åºç¶ååæ¯ç¦»çº¿çå°±ä»£è¡¨å®è£çæ¶åè¦ä¸è½½å¾å¤å¾å¤æ°æ®åãåopenvasæ¬èº«å°±è¦ä¸è½½1Gçå®è£åï¼æ´æ°æ¼æ´åºçæ¶åè¿æä¸è½½1Gçå éç¹æ¯openvasçä¸è½½æå¡å¨å¨å½å¤ï¼å¯¹æä»¬è¿ç§æé¿åä¿æ¤çè¯æ°æ¥è¯´å°±æ¯10å Kçä¸è½½éåº¦\næè¿æ æé´çå°githubä¸é¢æä¸ªopenvasçå¼æºé¡¹ç®ï¼æopenvasæåæä¸ä¸ªdockerå®¹å¨ï¼é¨ç½²åªéè¦å¯å¨ä¸ä¸ªå®¹å¨ï¼å¿«éï¼æ¹ä¾¿è¿ä¸å ç©ºé´ãgithubé¡¹ç®å°åï¼https://github.com/mikesplain/openvas-docker"},{property:"og:image",content:"https://img-blog.csdnimg.cn/20181107134156923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3doYXRkYXk=,size_16,color_FFFFFF,t_70"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/05.%E5%AE%89%E5%85%A8/01.docker%E9%83%A8%E7%BD%B2openvas.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T19:21:33.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"dockeré¨ç½²openvas"},{itemprop:"description",content:"å­¦å®å¨çäººæ³å¿é½ç¥éopenvasï¼ä»æ¯ä¸ä¸ªå¼æºçç¦»çº¿æ¼æ´è¯ä¼°ç³»ç»ï¼æéå¸¸ä¸°å¯çæ¼æ´åºãä¸è¿è¿ä¹æ¯è®©äººç¦æ¼çä¸ä¸ªå°æ¹ï¼æä¸°å¯çæ¼æ´åºç¶ååæ¯ç¦»çº¿çå°±ä»£è¡¨å®è£çæ¶åè¦ä¸è½½å¾å¤å¾å¤æ°æ®åãåopenvasæ¬èº«å°±è¦ä¸è½½1Gçå®è£åï¼æ´æ°æ¼æ´åºçæ¶åè¿æä¸è½½1Gçå éç¹æ¯openvasçä¸è½½æå¡å¨å¨å½å¤ï¼å¯¹æä»¬è¿ç§æé¿åä¿æ¤çè¯æ°æ¥è¯´å°±æ¯10å Kçä¸è½½éåº¦\næè¿æ æé´çå°githubä¸é¢æä¸ªopenvasçå¼æºé¡¹ç®ï¼æopenvasæåæä¸ä¸ªdockerå®¹å¨ï¼é¨ç½²åªéè¦å¯å¨ä¸ä¸ªå®¹å¨ï¼å¿«éï¼æ¹ä¾¿è¿ä¸å ç©ºé´ãgithubé¡¹ç®å°åï¼https://github.com/mikesplain/openvas-docker"},{itemprop:"image",content:"https://img-blog.csdnimg.cn/20181107134156923.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3doYXRkYXk=,size_16,color_FFFFFF,t_70"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/05.%E5%AE%89%E5%85%A8/01.docker%E9%83%A8%E7%BD%B2openvas.html",relativePath:"04.è¿ç»´/05.å®å¨/01.dockeré¨ç½²openvas.md",key:"v-9198a8e6",path:"/pages/7f4bdd/",headersStr:null,content:"å­¦å®å¨çäººæ³å¿é½ç¥éopenvasï¼ä»æ¯ä¸ä¸ªå¼æºçç¦»çº¿æ¼æ´è¯ä¼°ç³»ç»ï¼æéå¸¸ä¸°å¯çæ¼æ´åºãä¸è¿è¿ä¹æ¯è®©äººç¦æ¼çä¸ä¸ªå°æ¹ï¼æä¸°å¯çæ¼æ´åºç¶ååæ¯ç¦»çº¿çå°±ä»£è¡¨å®è£çæ¶åè¦ä¸è½½å¾å¤å¾å¤æ°æ®åãåopenvasæ¬èº«å°±è¦ä¸è½½1Gçå®è£åï¼æ´æ°æ¼æ´åºçæ¶åè¿æä¸è½½1Gçå éç¹æ¯openvasçä¸è½½æå¡å¨å¨å½å¤ï¼å¯¹æä»¬è¿ç§æé¿åä¿æ¤çè¯æ°æ¥è¯´å°±æ¯10å Kçä¸è½½éåº¦\næè¿æ æé´çå°githubä¸é¢æä¸ªopenvasçå¼æºé¡¹ç®ï¼æopenvasæåæä¸ä¸ªdockerå®¹å¨ï¼é¨ç½²åªéè¦å¯å¨ä¸ä¸ªå®¹å¨ï¼å¿«éï¼æ¹ä¾¿è¿ä¸å ç©ºé´ãgithubé¡¹ç®å°åï¼https://github.com/mikesplain/openvas-docker\n\n1ï¼é¦åä½ è¦å®è£ä¸ªdocker\næºå®è£å¾ç®åï¼Debianï¼apt install lxc-dockerï¼Centosï¼yum install docker-io\n\n2ï¼æç´¢å®¹å¨ï¼\nroot@controller-node:~#docker search openvas\n\n\n\n3ï¼ä¸è½½openvas9çæ¬çå®¹å¨ï¼\nroot@controller-node:~#docker pull mikesplain/openvas:9\n\n\n\n4ï¼åå°è¿è¡å®¹å¨ç¶åæ å°443ç«¯å£ï¼\næ³¨æå¦æå®¿ä¸»æº443ç«¯å£æå¨ä½¿ç¨åºæ å°å°å¶ä»ç«¯å£\nroot@controller-node:~#docker run -d -p 443:443 --name openvas mikesplain/openvas:9\næ³¨ï¼å¯å¨å®¹å¨ååç°å®å¾å®¹æå¨æ«æçæ¶åæå®¿ä¸»æºè¿ç¨è·æ»¡ï¼æå¥½éå¶ä¸èµæºä½¿ç¨\nroot@controller-node:~#docker run --cpuset-cpus=4 -m 8192M -d -p 443:443 --name openvas mikesplain/openvas:9\n\n\n\nå¥½äºï¼ç°å¨æä»¬çopenvasç¯å¢å·²ç»é¨ç½²å¥½äºï¼å¨ç¨ä¸å°åå°æ¶.\nç°å¨æä»¬è®¿é®å®¿ä¸»æºçwebå°±å¯ä»¥è¿å¥openvas webäº\nhttps://127.0.0.1 é»è®¤è´¦å·:admin é»è®¤å¯ç ï¼admin\n\nå¦ææ³å¨å±åç½è®¿é®å®¿ä¸»æºä¸­çdocker openvas éè¦è®¾ç½® openvas çdns hostname å·ä½å¦ä¸\n\ndocker run -d -p 443:443 -e PUBLIC_HOSTNAME=192.168.6.141 --name openvas mikesplain/openvas\n\n\n1\n\n\nè¿è¦è®¾ç½®å®¿ä¸»æºé²ç«å¢ centos7 å³é­é²ç«å¢å½ä»¤ï¼systemctl stop firewalld.service\n\nå¶ä¸­192.168.6.141æ¯å®¿ä¸»æºçIP è¿æ ·è®¾ç½®ååå±åç½å°±å¯ä»¥è®¿é®openvasäº\n\ndocker ä¸­çopenvaså¯å¨éè¦ä¸ç¹æ¶é´ ç­å¾ä¸åéåè®¿é® ä»¥ä¸ç½å\n\nhttps://192.168.6.141 é»è®¤è´¦å·:admin é»è®¤å¯ç ï¼admin",normalizedContent:"å­¦å®å¨çäººæ³å¿é½ç¥éopenvasï¼ä»æ¯ä¸ä¸ªå¼æºçç¦»çº¿æ¼æ´è¯ä¼°ç³»ç»ï¼æéå¸¸ä¸°å¯çæ¼æ´åºãä¸è¿è¿ä¹æ¯è®©äººç¦æ¼çä¸ä¸ªå°æ¹ï¼æä¸°å¯çæ¼æ´åºç¶ååæ¯ç¦»çº¿çå°±ä»£è¡¨å®è£çæ¶åè¦ä¸è½½å¾å¤å¾å¤æ°æ®åãåopenvasæ¬èº«å°±è¦ä¸è½½1gçå®è£åï¼æ´æ°æ¼æ´åºçæ¶åè¿æä¸è½½1gçå éç¹æ¯openvasçä¸è½½æå¡å¨å¨å½å¤ï¼å¯¹æä»¬è¿ç§æé¿åä¿æ¤çè¯æ°æ¥è¯´å°±æ¯10å kçä¸è½½éåº¦\næè¿æ æé´çå°githubä¸é¢æä¸ªopenvasçå¼æºé¡¹ç®ï¼æopenvasæåæä¸ä¸ªdockerå®¹å¨ï¼é¨ç½²åªéè¦å¯å¨ä¸ä¸ªå®¹å¨ï¼å¿«éï¼æ¹ä¾¿è¿ä¸å ç©ºé´ãgithubé¡¹ç®å°åï¼https://github.com/mikesplain/openvas-docker\n\n1ï¼é¦åä½ è¦å®è£ä¸ªdocker\næºå®è£å¾ç®åï¼debianï¼apt install lxc-dockerï¼centosï¼yum install docker-io\n\n2ï¼æç´¢å®¹å¨ï¼\nroot@controller-node:~#docker search openvas\n\n\n\n3ï¼ä¸è½½openvas9çæ¬çå®¹å¨ï¼\nroot@controller-node:~#docker pull mikesplain/openvas:9\n\n\n\n4ï¼åå°è¿è¡å®¹å¨ç¶åæ å°443ç«¯å£ï¼\næ³¨æå¦æå®¿ä¸»æº443ç«¯å£æå¨ä½¿ç¨åºæ å°å°å¶ä»ç«¯å£\nroot@controller-node:~#docker run -d -p 443:443 --name openvas mikesplain/openvas:9\næ³¨ï¼å¯å¨å®¹å¨ååç°å®å¾å®¹æå¨æ«æçæ¶åæå®¿ä¸»æºè¿ç¨è·æ»¡ï¼æå¥½éå¶ä¸èµæºä½¿ç¨\nroot@controller-node:~#docker run --cpuset-cpus=4 -m 8192m -d -p 443:443 --name openvas mikesplain/openvas:9\n\n\n\nå¥½äºï¼ç°å¨æä»¬çopenvasç¯å¢å·²ç»é¨ç½²å¥½äºï¼å¨ç¨ä¸å°åå°æ¶.\nç°å¨æä»¬è®¿é®å®¿ä¸»æºçwebå°±å¯ä»¥è¿å¥openvas webäº\nhttps://127.0.0.1 é»è®¤è´¦å·:admin é»è®¤å¯ç ï¼admin\n\nå¦ææ³å¨å±åç½è®¿é®å®¿ä¸»æºä¸­çdocker openvas éè¦è®¾ç½® openvas çdns hostname å·ä½å¦ä¸\n\ndocker run -d -p 443:443 -e public_hostname=192.168.6.141 --name openvas mikesplain/openvas\n\n\n1\n\n\nè¿è¦è®¾ç½®å®¿ä¸»æºé²ç«å¢ centos7 å³é­é²ç«å¢å½ä»¤ï¼systemctl stop firewalld.service\n\nå¶ä¸­192.168.6.141æ¯å®¿ä¸»æºçip è¿æ ·è®¾ç½®ååå±åç½å°±å¯ä»¥è®¿é®openvasäº\n\ndocker ä¸­çopenvaså¯å¨éè¦ä¸ç¹æ¶é´ ç­å¾ä¸åéåè®¿é® ä»¥ä¸ç½å\n\nhttps://192.168.6.141 é»è®¤è´¦å·:admin é»è®¤å¯ç ï¼admin",charsets:{cjk:!0}},{title:"æåå·¥å· tcpdump ç¨æ³è¯´æ",frontmatter:{title:"æåå·¥å· tcpdump ç¨æ³è¯´æ",date:"2022-12-15T19:00:25.000Z",permalink:"/pages/2f613d/",categories:["è¿ç»´","ç½ç»"],tags:[null],readingShow:"top",description:"tcpdumpéç¨å½ä»¤è¡æ¹å¼å¯¹æ¥å£çæ°æ®åè¿è¡ç­éæåï¼å¶ä¸°å¯ç¹æ§è¡¨ç°å¨çµæ´»çè¡¨è¾¾å¼ä¸ã",meta:[{name:"twitter:title",content:"æåå·¥å· tcpdump ç¨æ³è¯´æ"},{name:"twitter:description",content:"tcpdumpéç¨å½ä»¤è¡æ¹å¼å¯¹æ¥å£çæ°æ®åè¿è¡ç­éæåï¼å¶ä¸°å¯ç¹æ§è¡¨ç°å¨çµæ´»çè¡¨è¾¾å¼ä¸ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/04.%E7%BD%91%E7%BB%9C/01.%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7%20tcpdump%20%E7%94%A8%E6%B3%95%E8%AF%B4%E6%98%8E.html"},{property:"og:type",content:"article"},{property:"og:title",content:"æåå·¥å· tcpdump ç¨æ³è¯´æ"},{property:"og:description",content:"tcpdumpéç¨å½ä»¤è¡æ¹å¼å¯¹æ¥å£çæ°æ®åè¿è¡ç­éæåï¼å¶ä¸°å¯ç¹æ§è¡¨ç°å¨çµæ´»çè¡¨è¾¾å¼ä¸ã"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/04.%E7%BD%91%E7%BB%9C/01.%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7%20tcpdump%20%E7%94%A8%E6%B3%95%E8%AF%B4%E6%98%8E.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T19:00:25.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"æåå·¥å· tcpdump ç¨æ³è¯´æ"},{itemprop:"description",content:"tcpdumpéç¨å½ä»¤è¡æ¹å¼å¯¹æ¥å£çæ°æ®åè¿è¡ç­éæåï¼å¶ä¸°å¯ç¹æ§è¡¨ç°å¨çµæ´»çè¡¨è¾¾å¼ä¸ã"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/04.%E7%BD%91%E7%BB%9C/01.%E6%8A%93%E5%8C%85%E5%B7%A5%E5%85%B7%20tcpdump%20%E7%94%A8%E6%B3%95%E8%AF%B4%E6%98%8E.html",relativePath:"04.è¿ç»´/04.ç½ç»/01.æåå·¥å· tcpdump ç¨æ³è¯´æ.md",key:"v-28967f21",path:"/pages/2f613d/",headersStr:null,content:'tcpdumpéç¨å½ä»¤è¡æ¹å¼å¯¹æ¥å£çæ°æ®åè¿è¡ç­éæåï¼å¶ä¸°å¯ç¹æ§è¡¨ç°å¨çµæ´»çè¡¨è¾¾å¼ä¸ã\n\nä¸å¸¦ä»»ä½éé¡¹çtcpdumpï¼é»è®¤ä¼æåç¬¬ä¸ä¸ªç½ç»æ¥å£ï¼ä¸åªæå°tcpdumpè¿ç¨ç»æ­¢æä¼åæ­¢æåã\n\nä¾å¦ï¼\n\nshell>Â tcpdumpÂ -nnÂ -iÂ eth0Â icmp\n\nä¸é¢æ¯è¯¦ç»çtcpdumpç¨æ³ã\n\n1.1 tcpdumpéé¡¹\n\nå®çå½ä»¤æ ¼å¼ä¸ºï¼\n\ntcpdumpÂ [Â -DenNqvXÂ ]Â [Â -cÂ countÂ ]Â [Â -FÂ fileÂ ]Â [Â -iÂ interfaceÂ ]Â [Â -rÂ fileÂ ]\n\n[Â -sÂ snaplenÂ ]Â [Â -wÂ fileÂ ]Â [Â expressionÂ ]\n\næåéé¡¹ï¼\n\n-cï¼æå®è¦æåçåæ°éãæ³¨æï¼æ¯æç»è¦è·åè¿ä¹å¤ä¸ªåãä¾å¦ï¼æå®"-c 10"å°è·å10ä¸ªåï¼ä½å¯è½å·²ç»å¤çäº100ä¸ªåï¼åªä¸è¿åªæ10ä¸ªåæ¯æ»¡è¶³æ¡ä»¶çåã\n\n-i interfaceï¼æå®tcpdumpéè¦çå¬çæ¥å£ãè¥æªæå®è¯¥éé¡¹ï¼å°ä»ç³»ç»æ¥å£åè¡¨ä¸­æå¯»ç¼å·æå°çå·²éç½®å¥½çæ¥å£(ä¸åæ¬loopbackæ¥å£ï¼è¦æåloopbackæ¥å£ä½¿ç¨tcpdump -i lo)ï¼\n\nï¼ä¸æ¦æ¾å°ç¬¬ä¸ä¸ªç¬¦åæ¡ä»¶çæ¥å£ï¼æå¯»é©¬ä¸ç»æãå¯ä»¥ä½¿ç¨\'any\'å³é®å­è¡¨ç¤ºææç½ç»æ¥å£ã\n\n-nï¼å¯¹å°åä»¥æ°å­æ¹å¼æ¾å¼ï¼å¦åæ¾å¼ä¸ºä¸»æºåï¼ä¹å°±æ¯è¯´-néé¡¹ä¸åä¸»æºåè§£æã\n\n-nnï¼é¤äº-nçä½ç¨å¤ï¼è¿æç«¯å£æ¾ç¤ºä¸ºæ°å¼ï¼å¦åæ¾ç¤ºç«¯å£æå¡åã\n\n-Nï¼ä¸æå°åºhostçååé¨åãä¾å¦tcpdumpå°ä¼æå°\'nic\'èä¸æ¯\'nic.ddn.mil\'ã\n\n-Pï¼æå®è¦æåçåæ¯æµå¥è¿æ¯æµåºçåãå¯ä»¥ç»å®çå¼ä¸º"in"ã"out"å"inout"ï¼é»è®¤ä¸º"inout"ã\n\n-s lenï¼è®¾ç½®tcpdumpçæ°æ®åæåé¿åº¦ä¸ºlenï¼å¦æä¸è®¾ç½®é»è®¤å°ä¼æ¯65535å­èãå¯¹äºè¦æåçæ°æ®åè¾å¤§æ¶ï¼é¿åº¦è®¾ç½®ä¸å¤å¯è½ä¼äº§çåæªæ­ï¼è¥åºç°åæªæ­ï¼\n\nï¼è¾åºè¡ä¸­ä¼åºç°"[|proto]"çæ å¿(protoå®éä¼æ¾ç¤ºä¸ºåè®®å)ãä½æ¯æålenè¶é¿ï¼åçå¤çæ¶é´è¶é¿ï¼å¹¶ä¸ä¼åå°tcpdumpå¯ç¼å­çæ°æ®åçæ°éï¼\n\nï¼ä»èä¼å¯¼è´æ°æ®åçä¸¢å¤±ï¼æä»¥å¨è½æåæä»¬æ³è¦çåçåæä¸ï¼æåé¿åº¦è¶å°è¶å¥½ã\n\nè¾åºéé¡¹ï¼\n\n-eï¼è¾åºçæ¯è¡ä¸­é½å°åæ¬æ°æ®é¾è·¯å±å¤´é¨ä¿¡æ¯ï¼ä¾å¦æºMACåç®æ MACã\n\n-qï¼å¿«éæå°è¾åºãå³æå°å¾å°çåè®®ç¸å³ä¿¡æ¯ï¼ä»èè¾åºè¡é½æ¯è¾ç®ç­ã\n\n-Xï¼è¾åºåçå¤´é¨æ°æ®ï¼ä¼ä»¥16è¿å¶åASCIIä¸¤ç§æ¹å¼åæ¶è¾åºã\n\n-XXï¼è¾åºåçå¤´é¨æ°æ®ï¼ä¼ä»¥16è¿å¶åASCIIä¸¤ç§æ¹å¼åæ¶è¾åºï¼æ´è¯¦ç»ã\n\n-vï¼å½åæåæå°çæ¶åï¼äº§çè¯¦ç»çè¾åºã\n\n-vvï¼äº§çæ¯-væ´è¯¦ç»çè¾åºã\n\n-vvvï¼äº§çæ¯-vvæ´è¯¦ç»çè¾åºã\n\nå¶ä»åè½æ§éé¡¹ï¼\n\n-Dï¼ååºå¯ç¨äºæåçæ¥å£ãå°ä¼ååºæ¥å£çæ°å¼ç¼å·åæ¥å£åï¼å®ä»¬é½å¯ä»¥ç¨äº"-i"åã\n\n-Fï¼ä»æä»¶ä¸­è¯»åæåçè¡¨è¾¾å¼ãè¥ä½¿ç¨è¯¥éé¡¹ï¼åå½ä»¤è¡ä¸­ç»å®çå¶ä»è¡¨è¾¾å¼é½å°å¤±æã\n\n-wï¼å°æåæ°æ®è¾åºå°æä»¶ä¸­èä¸æ¯æ åè¾åºãå¯ä»¥åæ¶éå"-G time"éé¡¹ä½¿å¾è¾åºæä»¶æ¯timeç§å°±èªå¨åæ¢å°å¦ä¸ä¸ªæä»¶ãå¯éè¿"-r"éé¡¹è½½å¥è¿äºæä»¶ä»¥è¿è¡åæåæå°ã\n\n-rï¼ä»ç»å®çæ°æ®åæä»¶ä¸­è¯»åæ°æ®ãä½¿ç¨"-"è¡¨ç¤ºä»æ åè¾å¥ä¸­è¯»åã\n\næä»¥å¸¸ç¨çéé¡¹ä¹å°±è¿å ä¸ªï¼\n\n * tcpdump -D\n * tcpdump -c num -i int -nn -XX -vvv\n\n1.2 tcpdumpè¡¨è¾¾å¼\n\nè¡¨è¾¾å¼ç¨äºç­éè¾åºåªäºç±»åçæ°æ®åï¼å¦ææ²¡æç»å®è¡¨è¾¾å¼ï¼ææçæ°æ®åé½å°è¾åºï¼å¦ååªè¾åºè¡¨è¾¾å¼ä¸ºtrueçåãå¨è¡¨è¾¾å¼ä¸­åºç°çshellåå­ç¬¦å»ºè®®ä½¿ç¨åå¼å·åå´ã\n\ntcpdumpçè¡¨è¾¾å¼ç±ä¸ä¸ªæå¤ä¸ª"åå"ç»æï¼æ¯ä¸ªååä¸è¬åå«IDçä¿®é¥°ç¬¦åä¸ä¸ªID(æ°å­æåç§°)ãæä¸ç§ä¿®é¥°ç¬¦ï¼\n\n(1).typeï¼æå®IDçç±»åã\n\nå¯ä»¥ç»å®çå¼æhost/net/port/portrangeãä¾å¦"host foo"ï¼"net 128.3"ï¼"port 20"ï¼"portrange 6000-6008"ãé»è®¤çtypeä¸ºhostã\n\n(2).dirï¼æå®IDçæ¹åã\n\nå¯ä»¥ç»å®çå¼åæ¬src/dst/src or dst/src and dstï¼é»è®¤ä¸ºsrc or dstãä¾å¦ï¼"src foo"è¡¨ç¤ºæºä¸»æºä¸ºfooçæ°æ®åï¼"dst net 128.3"è¡¨ç¤ºç®æ ç½ç»ä¸º128.3çæ°æ®åï¼"src or dst port 22"è¡¨ç¤ºæºæç®çç«¯å£ä¸º22çæ°æ®åã\n\n(3).protoï¼éè¿ç»å®åè®®éå®å¹éçæ°æ®åç±»åã\n\nå¸¸ç¨çåè®®ætcp/udp/arp/ip/ether/icmpç­ï¼è¥æªç»å®åè®®ç±»åï¼åå¹éææå¯è½çç±»åãä¾å¦"tcp port 21"ï¼"udp portrange 7000-7009"ã\n\næä»¥ï¼ä¸ä¸ªåºæ¬çè¡¨è¾¾å¼ååæ ¼å¼ä¸º"proto dir type ID"\n\né¤äºä½¿ç¨ä¿®é¥°ç¬¦åIDç»æçè¡¨è¾¾å¼ååï¼è¿æå³é®å­è¡¨è¾¾å¼ååï¼gatewayï¼broadcastï¼lessï¼greaterä»¥åç®æ¯è¡¨è¾¾å¼ã\n\nè¡¨è¾¾å¼ååä¹é´å¯ä»¥ä½¿ç¨æä½ç¬¦" and / && / or / || / not / ! "è¿è¡è¿æ¥ï¼ä»èç»æå¤æçæ¡ä»¶è¡¨è¾¾å¼ãå¦"host foo and not port ftp and not port ftp-data"ï¼è¿è¡¨ç¤ºç­éçæ°æ®åè¦æ»¡è¶³"ä¸»æºä¸ºfooä¸ç«¯å£ä¸æ¯ftp(ç«¯å£21)åftp-data(ç«¯å£20)çå"ï¼å¸¸ç¨ç«¯å£ååå­çå¯¹åºå³ç³»å¯å¨linuxç³»ç»ä¸­ç/etc/serviceæä»¶ä¸­æ¾å°ã\n\nå¦å¤ï¼åæ ·çä¿®é¥°ç¬¦å¯çç¥ï¼å¦"tcp dst port ftp or ftp-data or domain"ä¸"tcp dst port ftp or tcp dst port ftp-data or tcp dst port domain"æä¹ç¸åï¼é½è¡¨ç¤ºåçåè®®ä¸ºtcpä¸ç®çç«¯å£ä¸ºftpæftp-dataædomain(ç«¯å£53)ã\n\nä½¿ç¨æ¬å·"()"å¯ä»¥æ¹åè¡¨è¾¾å¼çä¼åçº§ï¼ä½éè¦æ³¨æçæ¯æ¬å·ä¼è¢«shellè§£éï¼æä»¥åºè¯¥ä½¿ç¨åæçº¿""è½¬ä¹ä¸º"()"ï¼å¨éè¦çæ¶åï¼è¿éè¦åå´å¨å¼å·ä¸­ã\n\n1.3 tcpdumpç¤ºä¾\n\næ³¨æï¼tcpdumpåªè½æåæµç»æ¬æºçæ°æ®åã\n\n(1).é»è®¤å¯å¨\n\ntcpdump\n\né»è®¤æåµä¸ï¼ç´æ¥å¯å¨tcpdumpå°çè§ç¬¬ä¸ä¸ªç½ç»æ¥å£(éloå£)ä¸æææµéçæ°æ®åãè¿æ ·æåçç»æä¼éå¸¸å¤ï¼æ»å¨éå¸¸å¿«ã\n\n(2).çè§æå®ç½ç»æ¥å£çæ°æ®å\n\ntcpdumpÂ -iÂ eth1\n\nå¦æä¸æå®ç½å¡ï¼é»è®¤tcpdumpåªä¼çè§ç¬¬ä¸ä¸ªç½ç»æ¥å£ï¼å¦eth0ã\n\n(3).çè§æå®ä¸»æºçæ°æ®åï¼ä¾å¦ææè¿å¥æç¦»å¼longshuaiçæ°æ®å\n\ntcpdumpÂ hostÂ longshuai\n\n(4).æå°helios<--\x3ehotæhelios<--\x3eaceä¹é´éä¿¡çæ°æ®å\n\ntcpdumpÂ hostÂ heliosÂ andÂ (Â hotÂ orÂ aceÂ )\n\n(5).æå°aceä¸ä»»ä½å¶ä»ä¸»æºä¹é´éä¿¡çIPæ°æ®å,ä½ä¸åæ¬ä¸heliosä¹é´çæ°æ®å\n\ntcpdumpÂ ipÂ hostÂ aceÂ andÂ notÂ helios\n\n(6).æªè·ä¸»æºhostnameåéçæææ°æ®\n\ntcpdumpÂ srcÂ hostÂ hostname\n\n(7).çè§ææåéå°ä¸»æºhostnameçæ°æ®å\n\ntcpdumpÂ dstÂ hostÂ hostname\n\n(8).çè§æå®ä¸»æºåç«¯å£çæ°æ®å\n\ntcpdumpÂ tcpÂ portÂ 22Â andÂ hostÂ hostname\n\n(9).å¯¹æ¬æºçudp 123ç«¯å£è¿è¡çè§(123ä¸ºntpçæå¡ç«¯å£)\n\ntcpdumpÂ udpÂ portÂ 123\n\n(10).çè§æå®ç½ç»çæ°æ®åï¼å¦æ¬æºä¸192.168ç½æ®µéä¿¡çæ°æ®åï¼"-c 10"è¡¨ç¤ºåªæå10ä¸ªå\n\ntcpdumpÂ -cÂ 10Â netÂ 192.168\n\n(11).æå°ææéè¿ç½å³snupçftpæ°æ®å(æ³¨æ,è¡¨è¾¾å¼è¢«åå¼å·æ¬èµ·æ¥äº,è¿å¯ä»¥é²æ­¢shellå¯¹å¶ä¸­çæ¬å·è¿è¡éè¯¯è§£æ)\n\nshell>Â tcpdumpÂ \'gatewayÂ snupÂ andÂ (portÂ ftpÂ orÂ ftp-data)\'\n\n(12).æåpingå\n\n[root@server2Â ~]#Â tcpdumpÂ -cÂ 5Â -nnÂ -iÂ eth0Â icmp\n\ntcpdump:Â verboseÂ outputÂ suppressed,Â useÂ -vÂ orÂ -vvÂ forÂ fullÂ protocolÂ decode\n\nlisteningÂ onÂ eth0,Â link-typeÂ EN10MBÂ (Ethernet),Â captureÂ sizeÂ 65535Â bytes\n\n12:11:23.273638Â IPÂ 192.168.100.70Â >Â 192.168.100.62:Â ICMPÂ echoÂ request,Â idÂ 16422,Â seqÂ 10,Â lengthÂ 64\n\n12:11:23.273666Â IPÂ 192.168.100.62Â >Â 192.168.100.70:Â ICMPÂ echoÂ reply,Â idÂ 16422,Â seqÂ 10,Â lengthÂ 64\n\n12:11:24.356915Â IPÂ 192.168.100.70Â >Â 192.168.100.62:Â ICMPÂ echoÂ request,Â idÂ 16422,Â seqÂ 11,Â lengthÂ 64\n\n12:11:24.356936Â IPÂ 192.168.100.62Â >Â 192.168.100.70:Â ICMPÂ echoÂ reply,Â idÂ 16422,Â seqÂ 11,Â lengthÂ 64\n\n12:11:25.440887Â IPÂ 192.168.100.70Â >Â 192.168.100.62:Â ICMPÂ echoÂ request,Â idÂ 16422,Â seqÂ 12,Â lengthÂ 64\n\npacketsÂ captured\n\npacketsÂ receivedÂ byÂ filter\n\npacketsÂ droppedÂ byÂ kernel\n\nå¦ææç¡®è¦æåä¸»æºä¸º192.168.100.70å¯¹æ¬æºçpingï¼åä½¿ç¨andæä½ç¬¦ã\n\n[root@server2Â ~]#Â tcpdumpÂ -cÂ 5Â -nnÂ -iÂ eth0Â icmpÂ andÂ srcÂ 192.168.100.62\n\ntcpdump:Â verboseÂ outputÂ suppressed,Â useÂ -vÂ orÂ -vvÂ forÂ fullÂ protocolÂ decode\n\nlisteningÂ onÂ eth0,Â link-typeÂ EN10MBÂ (Ethernet),Â captureÂ sizeÂ 65535Â bytes\n\n12:09:29.957132Â IPÂ 192.168.100.70Â >Â 192.168.100.62:Â ICMPÂ echoÂ request,Â idÂ 16166,Â seqÂ 1,Â lengthÂ 64\n\n12:09:31.041035Â IPÂ 192.168.100.70Â >Â 192.168.100.62:Â ICMPÂ echoÂ request,Â idÂ 16166,Â seqÂ 2,Â lengthÂ 64\n\n12:09:32.124562Â IPÂ 192.168.100.70Â >Â 192.168.100.62:Â ICMPÂ echoÂ request,Â idÂ 16166,Â seqÂ 3,Â lengthÂ 64\n\n12:09:33.208514Â IPÂ 192.168.100.70Â >Â 192.168.100.62:Â ICMPÂ echoÂ request,Â idÂ 16166,Â seqÂ 4,Â lengthÂ 64\n\n12:09:34.292222Â IPÂ 192.168.100.70Â >Â 192.168.100.62:Â ICMPÂ echoÂ request,Â idÂ 16166,Â seqÂ 5,Â lengthÂ 64\n\npacketsÂ captured\n\npacketsÂ receivedÂ byÂ filter\n\npacketsÂ droppedÂ byÂ kernel\n\næ³¨æä¸è½ç´æ¥åicmp src 192.168.100.70ï¼å ä¸ºicmpåè®®ä¸æ¯æç´æ¥åºç¨hostè¿ä¸ªtypeã\n\n(13).æåå°æ¬æº22ç«¯å£å\n\n[root@server2Â ~]#Â tcpdumpÂ -cÂ 10Â -nnÂ -iÂ eth0Â tcpÂ dstÂ portÂ 22\n\ntcpdump:Â verboseÂ outputÂ suppressed,Â useÂ -vÂ orÂ -vvÂ forÂ fullÂ protocolÂ decode\n\nlisteningÂ onÂ eth0,Â link-typeÂ EN10MBÂ (Ethernet),Â captureÂ sizeÂ 65535Â bytes\n\n12:06:57.574293Â IPÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â FlagsÂ [.],Â ackÂ 535528834,Â winÂ 2053,Â lengthÂ 0\n\n12:06:57.629125Â IPÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â FlagsÂ [.],Â ackÂ 193,Â winÂ 2052,Â lengthÂ 0\n\n12:06:57.684688Â IPÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â FlagsÂ [.],Â ackÂ 385,Â winÂ 2051,Â lengthÂ 0\n\n12:06:57.738977Â IPÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â FlagsÂ [.],Â ackÂ 577,Â winÂ 2050,Â lengthÂ 0\n\n12:06:57.794305Â IPÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â FlagsÂ [.],Â ackÂ 769,Â winÂ 2050,Â lengthÂ 0\n\n12:06:57.848720Â IPÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â FlagsÂ [.],Â ackÂ 961,Â winÂ 2049,Â lengthÂ 0\n\n12:06:57.904057Â IPÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â FlagsÂ [.],Â ackÂ 1153,Â winÂ 2048,Â lengthÂ 0\n\n12:06:57.958477Â IPÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â FlagsÂ [.],Â ackÂ 1345,Â winÂ 2047,Â lengthÂ 0\n\n12:06:58.014338Â IPÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â FlagsÂ [.],Â ackÂ 1537,Â winÂ 2053,Â lengthÂ 0\n\n12:06:58.069361Â IPÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â FlagsÂ [.],Â ackÂ 1729,Â winÂ 2052,Â lengthÂ 0\n\npacketsÂ captured\n\npacketsÂ receivedÂ byÂ filter\n\npacketsÂ droppedÂ byÂ kernel\n\n(14).è§£æåæ°æ®\n\n[root@server2Â ~]#Â tcpdumpÂ -cÂ 2Â -qÂ -XXÂ -vvvÂ -nnÂ -iÂ eth0Â tcpÂ dstÂ portÂ 22\n\ntcpdump:Â listeningÂ onÂ eth0,Â link-typeÂ EN10MBÂ (Ethernet),Â captureÂ sizeÂ 65535Â bytes\n\n12:15:54.788812Â IPÂ (tosÂ 0x0,Â ttlÂ 64,Â idÂ 19303,Â offsetÂ 0,Â flagsÂ [DF],Â protoÂ TCPÂ (6),Â lengthÂ 40)\n\n192.168.100.1.5788Â >Â 192.168.100.62.22:Â tcpÂ 0\n\n0x0000:Â Â 000cÂ 2908Â 9234Â 0050Â 56c0Â 0008Â 0800Â 4500Â Â ..)..4.PV.....E.\n\n0x0010:Â Â 0028Â 4b67Â 4000Â 4006Â a5d8Â c0a8Â 6401Â c0a8Â Â .(Kg@.@.....d...\n\n0x0020:Â Â 643eÂ 169cÂ 0016Â 2426Â 5fd6Â 1fecÂ 2b62Â 5010Â Â d>....$&_...+bP.\n\n0x0030:Â Â 0803Â 7844Â 0000Â 0000Â 0000Â 0000Â Â Â Â Â Â Â Â Â Â Â Â ..xD........\n\n12:15:54.842641Â IPÂ (tosÂ 0x0,Â ttlÂ 64,Â idÂ 19304,Â offsetÂ 0,Â flagsÂ [DF],Â protoÂ TCPÂ (6),Â lengthÂ 40)\n\n192.168.100.1.5788Â >Â 192.168.100.62.22:Â tcpÂ 0\n\n0x0000:Â Â 000cÂ 2908Â 9234Â 0050Â 56c0Â 0008Â 0800Â 4500Â Â ..)..4.PV.....E.\n\n0x0010:Â Â 0028Â 4b68Â 4000Â 4006Â a5d7Â c0a8Â 6401Â c0a8Â Â .(Kh@.@.....d...\n\n0x0020:Â Â 643eÂ 169cÂ 0016Â 2426Â 5fd6Â 1fecÂ 2d62Â 5010Â Â d>....$&_...-bP.\n\n0x0030:Â Â 0801Â 7646Â 0000Â 0000Â 0000Â 0000Â Â Â Â Â Â Â Â Â Â Â Â ..vF........\n\npacketsÂ captured\n\npacketsÂ receivedÂ byÂ filter\n\npacketsÂ droppedÂ byÂ kernel\n\næ»çæ¥è¯´ï¼tcpdumpå¯¹åºæ¬çæ°æ®åæåæ¹æ³è¿æ¯è¾ç®åçãåªè¦ææ¡æéçå ä¸ªéé¡¹(-nn -XX -vvv -i -c -q)ï¼åç»åè¡¨è¾¾å¼å³å¯ã',normalizedContent:'tcpdumpéç¨å½ä»¤è¡æ¹å¼å¯¹æ¥å£çæ°æ®åè¿è¡ç­éæåï¼å¶ä¸°å¯ç¹æ§è¡¨ç°å¨çµæ´»çè¡¨è¾¾å¼ä¸ã\n\nä¸å¸¦ä»»ä½éé¡¹çtcpdumpï¼é»è®¤ä¼æåç¬¬ä¸ä¸ªç½ç»æ¥å£ï¼ä¸åªæå°tcpdumpè¿ç¨ç»æ­¢æä¼åæ­¢æåã\n\nä¾å¦ï¼\n\nshell>Â tcpdumpÂ -nnÂ -iÂ eth0Â icmp\n\nä¸é¢æ¯è¯¦ç»çtcpdumpç¨æ³ã\n\n1.1 tcpdumpéé¡¹\n\nå®çå½ä»¤æ ¼å¼ä¸ºï¼\n\ntcpdumpÂ [Â -dennqvxÂ ]Â [Â -cÂ countÂ ]Â [Â -fÂ fileÂ ]Â [Â -iÂ interfaceÂ ]Â [Â -rÂ fileÂ ]\n\n[Â -sÂ snaplenÂ ]Â [Â -wÂ fileÂ ]Â [Â expressionÂ ]\n\næåéé¡¹ï¼\n\n-cï¼æå®è¦æåçåæ°éãæ³¨æï¼æ¯æç»è¦è·åè¿ä¹å¤ä¸ªåãä¾å¦ï¼æå®"-c 10"å°è·å10ä¸ªåï¼ä½å¯è½å·²ç»å¤çäº100ä¸ªåï¼åªä¸è¿åªæ10ä¸ªåæ¯æ»¡è¶³æ¡ä»¶çåã\n\n-i interfaceï¼æå®tcpdumpéè¦çå¬çæ¥å£ãè¥æªæå®è¯¥éé¡¹ï¼å°ä»ç³»ç»æ¥å£åè¡¨ä¸­æå¯»ç¼å·æå°çå·²éç½®å¥½çæ¥å£(ä¸åæ¬loopbackæ¥å£ï¼è¦æåloopbackæ¥å£ä½¿ç¨tcpdump -i lo)ï¼\n\nï¼ä¸æ¦æ¾å°ç¬¬ä¸ä¸ªç¬¦åæ¡ä»¶çæ¥å£ï¼æå¯»é©¬ä¸ç»æãå¯ä»¥ä½¿ç¨\'any\'å³é®å­è¡¨ç¤ºææç½ç»æ¥å£ã\n\n-nï¼å¯¹å°åä»¥æ°å­æ¹å¼æ¾å¼ï¼å¦åæ¾å¼ä¸ºä¸»æºåï¼ä¹å°±æ¯è¯´-néé¡¹ä¸åä¸»æºåè§£æã\n\n-nnï¼é¤äº-nçä½ç¨å¤ï¼è¿æç«¯å£æ¾ç¤ºä¸ºæ°å¼ï¼å¦åæ¾ç¤ºç«¯å£æå¡åã\n\n-nï¼ä¸æå°åºhostçååé¨åãä¾å¦tcpdumpå°ä¼æå°\'nic\'èä¸æ¯\'nic.ddn.mil\'ã\n\n-pï¼æå®è¦æåçåæ¯æµå¥è¿æ¯æµåºçåãå¯ä»¥ç»å®çå¼ä¸º"in"ã"out"å"inout"ï¼é»è®¤ä¸º"inout"ã\n\n-s lenï¼è®¾ç½®tcpdumpçæ°æ®åæåé¿åº¦ä¸ºlenï¼å¦æä¸è®¾ç½®é»è®¤å°ä¼æ¯65535å­èãå¯¹äºè¦æåçæ°æ®åè¾å¤§æ¶ï¼é¿åº¦è®¾ç½®ä¸å¤å¯è½ä¼äº§çåæªæ­ï¼è¥åºç°åæªæ­ï¼\n\nï¼è¾åºè¡ä¸­ä¼åºç°"[|proto]"çæ å¿(protoå®éä¼æ¾ç¤ºä¸ºåè®®å)ãä½æ¯æålenè¶é¿ï¼åçå¤çæ¶é´è¶é¿ï¼å¹¶ä¸ä¼åå°tcpdumpå¯ç¼å­çæ°æ®åçæ°éï¼\n\nï¼ä»èä¼å¯¼è´æ°æ®åçä¸¢å¤±ï¼æä»¥å¨è½æåæä»¬æ³è¦çåçåæä¸ï¼æåé¿åº¦è¶å°è¶å¥½ã\n\nè¾åºéé¡¹ï¼\n\n-eï¼è¾åºçæ¯è¡ä¸­é½å°åæ¬æ°æ®é¾è·¯å±å¤´é¨ä¿¡æ¯ï¼ä¾å¦æºmacåç®æ macã\n\n-qï¼å¿«éæå°è¾åºãå³æå°å¾å°çåè®®ç¸å³ä¿¡æ¯ï¼ä»èè¾åºè¡é½æ¯è¾ç®ç­ã\n\n-xï¼è¾åºåçå¤´é¨æ°æ®ï¼ä¼ä»¥16è¿å¶åasciiä¸¤ç§æ¹å¼åæ¶è¾åºã\n\n-xxï¼è¾åºåçå¤´é¨æ°æ®ï¼ä¼ä»¥16è¿å¶åasciiä¸¤ç§æ¹å¼åæ¶è¾åºï¼æ´è¯¦ç»ã\n\n-vï¼å½åæåæå°çæ¶åï¼äº§çè¯¦ç»çè¾åºã\n\n-vvï¼äº§çæ¯-væ´è¯¦ç»çè¾åºã\n\n-vvvï¼äº§çæ¯-vvæ´è¯¦ç»çè¾åºã\n\nå¶ä»åè½æ§éé¡¹ï¼\n\n-dï¼ååºå¯ç¨äºæåçæ¥å£ãå°ä¼ååºæ¥å£çæ°å¼ç¼å·åæ¥å£åï¼å®ä»¬é½å¯ä»¥ç¨äº"-i"åã\n\n-fï¼ä»æä»¶ä¸­è¯»åæåçè¡¨è¾¾å¼ãè¥ä½¿ç¨è¯¥éé¡¹ï¼åå½ä»¤è¡ä¸­ç»å®çå¶ä»è¡¨è¾¾å¼é½å°å¤±æã\n\n-wï¼å°æåæ°æ®è¾åºå°æä»¶ä¸­èä¸æ¯æ åè¾åºãå¯ä»¥åæ¶éå"-g time"éé¡¹ä½¿å¾è¾åºæä»¶æ¯timeç§å°±èªå¨åæ¢å°å¦ä¸ä¸ªæä»¶ãå¯éè¿"-r"éé¡¹è½½å¥è¿äºæä»¶ä»¥è¿è¡åæåæå°ã\n\n-rï¼ä»ç»å®çæ°æ®åæä»¶ä¸­è¯»åæ°æ®ãä½¿ç¨"-"è¡¨ç¤ºä»æ åè¾å¥ä¸­è¯»åã\n\næä»¥å¸¸ç¨çéé¡¹ä¹å°±è¿å ä¸ªï¼\n\n * tcpdump -d\n * tcpdump -c num -i int -nn -xx -vvv\n\n1.2 tcpdumpè¡¨è¾¾å¼\n\nè¡¨è¾¾å¼ç¨äºç­éè¾åºåªäºç±»åçæ°æ®åï¼å¦ææ²¡æç»å®è¡¨è¾¾å¼ï¼ææçæ°æ®åé½å°è¾åºï¼å¦ååªè¾åºè¡¨è¾¾å¼ä¸ºtrueçåãå¨è¡¨è¾¾å¼ä¸­åºç°çshellåå­ç¬¦å»ºè®®ä½¿ç¨åå¼å·åå´ã\n\ntcpdumpçè¡¨è¾¾å¼ç±ä¸ä¸ªæå¤ä¸ª"åå"ç»æï¼æ¯ä¸ªååä¸è¬åå«idçä¿®é¥°ç¬¦åä¸ä¸ªid(æ°å­æåç§°)ãæä¸ç§ä¿®é¥°ç¬¦ï¼\n\n(1).typeï¼æå®idçç±»åã\n\nå¯ä»¥ç»å®çå¼æhost/net/port/portrangeãä¾å¦"host foo"ï¼"net 128.3"ï¼"port 20"ï¼"portrange 6000-6008"ãé»è®¤çtypeä¸ºhostã\n\n(2).dirï¼æå®idçæ¹åã\n\nå¯ä»¥ç»å®çå¼åæ¬src/dst/src or dst/src and dstï¼é»è®¤ä¸ºsrc or dstãä¾å¦ï¼"src foo"è¡¨ç¤ºæºä¸»æºä¸ºfooçæ°æ®åï¼"dst net 128.3"è¡¨ç¤ºç®æ ç½ç»ä¸º128.3çæ°æ®åï¼"src or dst port 22"è¡¨ç¤ºæºæç®çç«¯å£ä¸º22çæ°æ®åã\n\n(3).protoï¼éè¿ç»å®åè®®éå®å¹éçæ°æ®åç±»åã\n\nå¸¸ç¨çåè®®ætcp/udp/arp/ip/ether/icmpç­ï¼è¥æªç»å®åè®®ç±»åï¼åå¹éææå¯è½çç±»åãä¾å¦"tcp port 21"ï¼"udp portrange 7000-7009"ã\n\næä»¥ï¼ä¸ä¸ªåºæ¬çè¡¨è¾¾å¼ååæ ¼å¼ä¸º"proto dir type id"\n\né¤äºä½¿ç¨ä¿®é¥°ç¬¦åidç»æçè¡¨è¾¾å¼ååï¼è¿æå³é®å­è¡¨è¾¾å¼ååï¼gatewayï¼broadcastï¼lessï¼greaterä»¥åç®æ¯è¡¨è¾¾å¼ã\n\nè¡¨è¾¾å¼ååä¹é´å¯ä»¥ä½¿ç¨æä½ç¬¦" and / && / or / || / not / ! "è¿è¡è¿æ¥ï¼ä»èç»æå¤æçæ¡ä»¶è¡¨è¾¾å¼ãå¦"host foo and not port ftp and not port ftp-data"ï¼è¿è¡¨ç¤ºç­éçæ°æ®åè¦æ»¡è¶³"ä¸»æºä¸ºfooä¸ç«¯å£ä¸æ¯ftp(ç«¯å£21)åftp-data(ç«¯å£20)çå"ï¼å¸¸ç¨ç«¯å£ååå­çå¯¹åºå³ç³»å¯å¨linuxç³»ç»ä¸­ç/etc/serviceæä»¶ä¸­æ¾å°ã\n\nå¦å¤ï¼åæ ·çä¿®é¥°ç¬¦å¯çç¥ï¼å¦"tcp dst port ftp or ftp-data or domain"ä¸"tcp dst port ftp or tcp dst port ftp-data or tcp dst port domain"æä¹ç¸åï¼é½è¡¨ç¤ºåçåè®®ä¸ºtcpä¸ç®çç«¯å£ä¸ºftpæftp-dataædomain(ç«¯å£53)ã\n\nä½¿ç¨æ¬å·"()"å¯ä»¥æ¹åè¡¨è¾¾å¼çä¼åçº§ï¼ä½éè¦æ³¨æçæ¯æ¬å·ä¼è¢«shellè§£éï¼æä»¥åºè¯¥ä½¿ç¨åæçº¿""è½¬ä¹ä¸º"()"ï¼å¨éè¦çæ¶åï¼è¿éè¦åå´å¨å¼å·ä¸­ã\n\n1.3 tcpdumpç¤ºä¾\n\næ³¨æï¼tcpdumpåªè½æåæµç»æ¬æºçæ°æ®åã\n\n(1).é»è®¤å¯å¨\n\ntcpdump\n\né»è®¤æåµä¸ï¼ç´æ¥å¯å¨tcpdumpå°çè§ç¬¬ä¸ä¸ªç½ç»æ¥å£(éloå£)ä¸æææµéçæ°æ®åãè¿æ ·æåçç»æä¼éå¸¸å¤ï¼æ»å¨éå¸¸å¿«ã\n\n(2).çè§æå®ç½ç»æ¥å£çæ°æ®å\n\ntcpdumpÂ -iÂ eth1\n\nå¦æä¸æå®ç½å¡ï¼é»è®¤tcpdumpåªä¼çè§ç¬¬ä¸ä¸ªç½ç»æ¥å£ï¼å¦eth0ã\n\n(3).çè§æå®ä¸»æºçæ°æ®åï¼ä¾å¦ææè¿å¥æç¦»å¼longshuaiçæ°æ®å\n\ntcpdumpÂ hostÂ longshuai\n\n(4).æå°helios<--\x3ehotæhelios<--\x3eaceä¹é´éä¿¡çæ°æ®å\n\ntcpdumpÂ hostÂ heliosÂ andÂ (Â hotÂ orÂ aceÂ )\n\n(5).æå°aceä¸ä»»ä½å¶ä»ä¸»æºä¹é´éä¿¡çipæ°æ®å,ä½ä¸åæ¬ä¸heliosä¹é´çæ°æ®å\n\ntcpdumpÂ ipÂ hostÂ aceÂ andÂ notÂ helios\n\n(6).æªè·ä¸»æºhostnameåéçæææ°æ®\n\ntcpdumpÂ srcÂ hostÂ hostname\n\n(7).çè§ææåéå°ä¸»æºhostnameçæ°æ®å\n\ntcpdumpÂ dstÂ hostÂ hostname\n\n(8).çè§æå®ä¸»æºåç«¯å£çæ°æ®å\n\ntcpdumpÂ tcpÂ portÂ 22Â andÂ hostÂ hostname\n\n(9).å¯¹æ¬æºçudp 123ç«¯å£è¿è¡çè§(123ä¸ºntpçæå¡ç«¯å£)\n\ntcpdumpÂ udpÂ portÂ 123\n\n(10).çè§æå®ç½ç»çæ°æ®åï¼å¦æ¬æºä¸192.168ç½æ®µéä¿¡çæ°æ®åï¼"-c 10"è¡¨ç¤ºåªæå10ä¸ªå\n\ntcpdumpÂ -cÂ 10Â netÂ 192.168\n\n(11).æå°ææéè¿ç½å³snupçftpæ°æ®å(æ³¨æ,è¡¨è¾¾å¼è¢«åå¼å·æ¬èµ·æ¥äº,è¿å¯ä»¥é²æ­¢shellå¯¹å¶ä¸­çæ¬å·è¿è¡éè¯¯è§£æ)\n\nshell>Â tcpdumpÂ \'gatewayÂ snupÂ andÂ (portÂ ftpÂ orÂ ftp-data)\'\n\n(12).æåpingå\n\n[root@server2Â ~]#Â tcpdumpÂ -cÂ 5Â -nnÂ -iÂ eth0Â icmp\n\ntcpdump:Â verboseÂ outputÂ suppressed,Â useÂ -vÂ orÂ -vvÂ forÂ fullÂ protocolÂ decode\n\nlisteningÂ onÂ eth0,Â link-typeÂ en10mbÂ (ethernet),Â captureÂ sizeÂ 65535Â bytes\n\n12:11:23.273638Â ipÂ 192.168.100.70Â >Â 192.168.100.62:Â icmpÂ echoÂ request,Â idÂ 16422,Â seqÂ 10,Â lengthÂ 64\n\n12:11:23.273666Â ipÂ 192.168.100.62Â >Â 192.168.100.70:Â icmpÂ echoÂ reply,Â idÂ 16422,Â seqÂ 10,Â lengthÂ 64\n\n12:11:24.356915Â ipÂ 192.168.100.70Â >Â 192.168.100.62:Â icmpÂ echoÂ request,Â idÂ 16422,Â seqÂ 11,Â lengthÂ 64\n\n12:11:24.356936Â ipÂ 192.168.100.62Â >Â 192.168.100.70:Â icmpÂ echoÂ reply,Â idÂ 16422,Â seqÂ 11,Â lengthÂ 64\n\n12:11:25.440887Â ipÂ 192.168.100.70Â >Â 192.168.100.62:Â icmpÂ echoÂ request,Â idÂ 16422,Â seqÂ 12,Â lengthÂ 64\n\npacketsÂ captured\n\npacketsÂ receivedÂ byÂ filter\n\npacketsÂ droppedÂ byÂ kernel\n\nå¦ææç¡®è¦æåä¸»æºä¸º192.168.100.70å¯¹æ¬æºçpingï¼åä½¿ç¨andæä½ç¬¦ã\n\n[root@server2Â ~]#Â tcpdumpÂ -cÂ 5Â -nnÂ -iÂ eth0Â icmpÂ andÂ srcÂ 192.168.100.62\n\ntcpdump:Â verboseÂ outputÂ suppressed,Â useÂ -vÂ orÂ -vvÂ forÂ fullÂ protocolÂ decode\n\nlisteningÂ onÂ eth0,Â link-typeÂ en10mbÂ (ethernet),Â captureÂ sizeÂ 65535Â bytes\n\n12:09:29.957132Â ipÂ 192.168.100.70Â >Â 192.168.100.62:Â icmpÂ echoÂ request,Â idÂ 16166,Â seqÂ 1,Â lengthÂ 64\n\n12:09:31.041035Â ipÂ 192.168.100.70Â >Â 192.168.100.62:Â icmpÂ echoÂ request,Â idÂ 16166,Â seqÂ 2,Â lengthÂ 64\n\n12:09:32.124562Â ipÂ 192.168.100.70Â >Â 192.168.100.62:Â icmpÂ echoÂ request,Â idÂ 16166,Â seqÂ 3,Â lengthÂ 64\n\n12:09:33.208514Â ipÂ 192.168.100.70Â >Â 192.168.100.62:Â icmpÂ echoÂ request,Â idÂ 16166,Â seqÂ 4,Â lengthÂ 64\n\n12:09:34.292222Â ipÂ 192.168.100.70Â >Â 192.168.100.62:Â icmpÂ echoÂ request,Â idÂ 16166,Â seqÂ 5,Â lengthÂ 64\n\npacketsÂ captured\n\npacketsÂ receivedÂ byÂ filter\n\npacketsÂ droppedÂ byÂ kernel\n\næ³¨æä¸è½ç´æ¥åicmp src 192.168.100.70ï¼å ä¸ºicmpåè®®ä¸æ¯æç´æ¥åºç¨hostè¿ä¸ªtypeã\n\n(13).æåå°æ¬æº22ç«¯å£å\n\n[root@server2Â ~]#Â tcpdumpÂ -cÂ 10Â -nnÂ -iÂ eth0Â tcpÂ dstÂ portÂ 22\n\ntcpdump:Â verboseÂ outputÂ suppressed,Â useÂ -vÂ orÂ -vvÂ forÂ fullÂ protocolÂ decode\n\nlisteningÂ onÂ eth0,Â link-typeÂ en10mbÂ (ethernet),Â captureÂ sizeÂ 65535Â bytes\n\n12:06:57.574293Â ipÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â flagsÂ [.],Â ackÂ 535528834,Â winÂ 2053,Â lengthÂ 0\n\n12:06:57.629125Â ipÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â flagsÂ [.],Â ackÂ 193,Â winÂ 2052,Â lengthÂ 0\n\n12:06:57.684688Â ipÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â flagsÂ [.],Â ackÂ 385,Â winÂ 2051,Â lengthÂ 0\n\n12:06:57.738977Â ipÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â flagsÂ [.],Â ackÂ 577,Â winÂ 2050,Â lengthÂ 0\n\n12:06:57.794305Â ipÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â flagsÂ [.],Â ackÂ 769,Â winÂ 2050,Â lengthÂ 0\n\n12:06:57.848720Â ipÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â flagsÂ [.],Â ackÂ 961,Â winÂ 2049,Â lengthÂ 0\n\n12:06:57.904057Â ipÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â flagsÂ [.],Â ackÂ 1153,Â winÂ 2048,Â lengthÂ 0\n\n12:06:57.958477Â ipÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â flagsÂ [.],Â ackÂ 1345,Â winÂ 2047,Â lengthÂ 0\n\n12:06:58.014338Â ipÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â flagsÂ [.],Â ackÂ 1537,Â winÂ 2053,Â lengthÂ 0\n\n12:06:58.069361Â ipÂ 192.168.100.1.5788Â >Â 192.168.100.62.22:Â flagsÂ [.],Â ackÂ 1729,Â winÂ 2052,Â lengthÂ 0\n\npacketsÂ captured\n\npacketsÂ receivedÂ byÂ filter\n\npacketsÂ droppedÂ byÂ kernel\n\n(14).è§£æåæ°æ®\n\n[root@server2Â ~]#Â tcpdumpÂ -cÂ 2Â -qÂ -xxÂ -vvvÂ -nnÂ -iÂ eth0Â tcpÂ dstÂ portÂ 22\n\ntcpdump:Â listeningÂ onÂ eth0,Â link-typeÂ en10mbÂ (ethernet),Â captureÂ sizeÂ 65535Â bytes\n\n12:15:54.788812Â ipÂ (tosÂ 0x0,Â ttlÂ 64,Â idÂ 19303,Â offsetÂ 0,Â flagsÂ [df],Â protoÂ tcpÂ (6),Â lengthÂ 40)\n\n192.168.100.1.5788Â >Â 192.168.100.62.22:Â tcpÂ 0\n\n0x0000:Â Â 000cÂ 2908Â 9234Â 0050Â 56c0Â 0008Â 0800Â 4500Â Â ..)..4.pv.....e.\n\n0x0010:Â Â 0028Â 4b67Â 4000Â 4006Â a5d8Â c0a8Â 6401Â c0a8Â Â .(kg@.@.....d...\n\n0x0020:Â Â 643eÂ 169cÂ 0016Â 2426Â 5fd6Â 1fecÂ 2b62Â 5010Â Â d>....$&_...+bp.\n\n0x0030:Â Â 0803Â 7844Â 0000Â 0000Â 0000Â 0000Â Â Â Â Â Â Â Â Â Â Â Â ..xd........\n\n12:15:54.842641Â ipÂ (tosÂ 0x0,Â ttlÂ 64,Â idÂ 19304,Â offsetÂ 0,Â flagsÂ [df],Â protoÂ tcpÂ (6),Â lengthÂ 40)\n\n192.168.100.1.5788Â >Â 192.168.100.62.22:Â tcpÂ 0\n\n0x0000:Â Â 000cÂ 2908Â 9234Â 0050Â 56c0Â 0008Â 0800Â 4500Â Â ..)..4.pv.....e.\n\n0x0010:Â Â 0028Â 4b68Â 4000Â 4006Â a5d7Â c0a8Â 6401Â c0a8Â Â .(kh@.@.....d...\n\n0x0020:Â Â 643eÂ 169cÂ 0016Â 2426Â 5fd6Â 1fecÂ 2d62Â 5010Â Â d>....$&_...-bp.\n\n0x0030:Â Â 0801Â 7646Â 0000Â 0000Â 0000Â 0000Â Â Â Â Â Â Â Â Â Â Â Â ..vf........\n\npacketsÂ captured\n\npacketsÂ receivedÂ byÂ filter\n\npacketsÂ droppedÂ byÂ kernel\n\næ»çæ¥è¯´ï¼tcpdumpå¯¹åºæ¬çæ°æ®åæåæ¹æ³è¿æ¯è¾ç®åçãåªè¦ææ¡æéçå ä¸ªéé¡¹(-nn -xx -vvv -i -c -q)ï¼åç»åè¡¨è¾¾å¼å³å¯ã',charsets:{cjk:!0}},{title:"sshå®å¨",frontmatter:{title:"sshå®å¨",date:"2023-02-24T15:44:20.000Z",permalink:"/pages/3913e5/",categories:["è¿ç»´","å®å¨"],tags:[null],readingShow:"top",description:"sed -i '$a AllowUsers CR@192.168.1.12 root@192.168.1.12' /etc/ssh/sshd_config ;\\\nsystemctl restart sshd\n`",meta:[{name:"twitter:title",content:"sshå®å¨"},{name:"twitter:description",content:"sed -i '$a AllowUsers CR@192.168.1.12 root@192.168.1.12' /etc/ssh/sshd_config ;\\\nsystemctl restart sshd\n`"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/05.%E5%AE%89%E5%85%A8/03.ssh%E5%AE%89%E5%85%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"sshå®å¨"},{property:"og:description",content:"sed -i '$a AllowUsers CR@192.168.1.12 root@192.168.1.12' /etc/ssh/sshd_config ;\\\nsystemctl restart sshd\n`"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/05.%E5%AE%89%E5%85%A8/03.ssh%E5%AE%89%E5%85%A8.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-24T15:44:20.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"sshå®å¨"},{itemprop:"description",content:"sed -i '$a AllowUsers CR@192.168.1.12 root@192.168.1.12' /etc/ssh/sshd_config ;\\\nsystemctl restart sshd\n`"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/05.%E5%AE%89%E5%85%A8/03.ssh%E5%AE%89%E5%85%A8.html",relativePath:"04.è¿ç»´/05.å®å¨/03.sshå®å¨.md",key:"v-44bb153f",path:"/pages/3913e5/",headers:[{level:2,title:"1ãåªåè®¸æç¨æ·ä»æå® IP å°åç»é",slug:"_1ãåªåè®¸æç¨æ·ä»æå®-ip-å°åç»é",normalizedTitle:"1ãåªåè®¸æç¨æ·ä»æå® ip å°åç»é",charIndex:2},{level:2,title:"2ãè®¾ç½® SSH ç©ºé²è¶æ¶éåºæ¶é´",slug:"_2ãè®¾ç½®-ssh-ç©ºé²è¶æ¶éåºæ¶é´",normalizedTitle:"2ãè®¾ç½® ssh ç©ºé²è¶æ¶éåºæ¶é´",charIndex:138},{level:2,title:"3ã éå¶ç»éè®¿é®å°è¯çéªè¯æ¬¡æ°",slug:"_3ã-éå¶ç»éè®¿é®å°è¯çéªè¯æ¬¡æ°",normalizedTitle:"3ã éå¶ç»éè®¿é®å°è¯çéªè¯æ¬¡æ°",charIndex:374},{level:2,title:"4ãåè®¸ root ç¨æ·ç»å½",slug:"_4ãåè®¸-root-ç¨æ·ç»å½",normalizedTitle:"4ãåè®¸ root ç¨æ·ç»å½",charIndex:417},{level:2,title:"5ãè®¾ç½®ç»å½æ¹å¼",slug:"_5ãè®¾ç½®ç»å½æ¹å¼",normalizedTitle:"5ãè®¾ç½®ç»å½æ¹å¼",charIndex:544},{level:2,title:"6ãç¦æ­¢ä½¿ç¨ç©ºç½å¯ç ç¨æ·è®¿é®",slug:"_6ãç¦æ­¢ä½¿ç¨ç©ºç½å¯ç ç¨æ·è®¿é®",normalizedTitle:"6ãç¦æ­¢ä½¿ç¨ç©ºç½å¯ç ç¨æ·è®¿é®",charIndex:705},{level:2,title:"7ãSSH ç»å½äºä»¶éç¥è³ ntfy",slug:"_7ãssh-ç»å½äºä»¶éç¥è³-ntfy",normalizedTitle:"7ãssh ç»å½äºä»¶éç¥è³ ntfy",charIndex:754}],headersStr:"1ãåªåè®¸æç¨æ·ä»æå® IP å°åç»é 2ãè®¾ç½® SSH ç©ºé²è¶æ¶éåºæ¶é´ 3ã éå¶ç»éè®¿é®å°è¯çéªè¯æ¬¡æ° 4ãåè®¸ root ç¨æ·ç»å½ 5ãè®¾ç½®ç»å½æ¹å¼ 6ãç¦æ­¢ä½¿ç¨ç©ºç½å¯ç ç¨æ·è®¿é® 7ãSSH ç»å½äºä»¶éç¥è³ ntfy",content:"# 1ãåªåè®¸æç¨æ·ä»æå® IP å°åç»é\n\nsed -i '$a AllowUsers CR@192.168.1.12 root@192.168.1.12' /etc/ssh/sshd_config ;\\\nsystemctl restart sshd\n\n\n1\n2\n\n\n\n# 2ãè®¾ç½® SSH ç©ºé²è¶æ¶éåºæ¶é´\n\n/etc/ssh/sshd_config\n\n#ClientAliveInterval 0\n#ClientAliveCountMax 3\nä¿®æ¹æ\nClientAliveInterval 30    #ï¼æ¯30ç§å¾å®¢æ·ç«¯åéä¼è¯è¯·æ±ï¼ä¿æè¿æ¥ï¼\nClientAliveCountMax 3     #ï¼å»ææ³¨éå³å¯ï¼3è¡¨ç¤ºéè¿3æ¬¡å¤±è´¥åï¼éå¯SSHä¼è¯ï¼\n\n\n1\n2\n3\n4\n5\n\n\nsystemctl restart sshd\n\n\n# 3ã éå¶ç»éè®¿é®å°è¯çéªè¯æ¬¡æ°\n\nMaxAuthTries 20\n\n\n1\n\n\n\n# 4ãåè®¸ root ç¨æ·ç»å½\n\nsed -i 's/PermitRootLogin no/PermitRootLogin yes/g'  /etc/ssh/sshd_config ;\\\nsystemctl restart sshd\n\n\n1\n2\n\n\n\n# 5ãè®¾ç½®ç»å½æ¹å¼\n\n# AuthorizedKeysFile   .ssh/authorized_keys   //å¬é¥å¬é¥è®¤è¯æä»¶\n# PubkeyAuthentication yes   //å¯ä»¥ä½¿ç¨å¬é¥ç»å½\n# PasswordAuthentication no  //ä¸åè®¸ä½¿ç¨å¯ç ç»å½\n\n\n1\n2\n3\n\n\n\n# 6ãç¦æ­¢ä½¿ç¨ç©ºç½å¯ç ç¨æ·è®¿é®\n\nPermitEmptyPasswords no\n\n\n1\n\n\n\n# 7ãSSH ç»å½äºä»¶éç¥è³ ntfy\n\n/etc/pam.d/sshd\n\nsession optional pam_exec.so /usr/local/bin/ntfy-ssh-login.sh\n\n\n1\n\n\nntfy-ssh-login.sh\n\n#!/bin/bash\nTOPIC_URL=http://test.curiouser.top:18070/ssh-notify\nif [ \"${PAM_TYPE}\" = \"open_session\" ]; then\n  curl -H tags:warning -H prio:high -d \"SSH login to $(hostname): ${PAM_USER} from ${PAM_RHOST}\" \"${TOPIC_URL}\"\nfi\n\n\n\n1\n2\n3\n4\n5\n6\n\n\né¨ç½²ç§æç ntfy\n\nntfy_server:\n  image: 'binwiederhier/ntfy'\n  restart: always\n  container_name: ntfy_server\n  command: serve --config /etc/ntfy/server.yml --cache-file /var/cache/ntfy/cache.db --listen-http :18070\n  ports:\n    - '18070:18070'\n  volumes:\n    - '/data/ntfy/data:/var/cache/ntfy'\n    - '/data/ntfy/config:/etc/ntfy'\n    - '/data/ntfy/data:/var/lib/ntfy/'\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n----------------------------------------\n\nåæé¾æ¥ï¼\n\nsshå®å¨ | Gaoyufu 's blog",normalizedContent:"# 1ãåªåè®¸æç¨æ·ä»æå® ip å°åç»é\n\nsed -i '$a allowusers cr@192.168.1.12 root@192.168.1.12' /etc/ssh/sshd_config ;\\\nsystemctl restart sshd\n\n\n1\n2\n\n\n\n# 2ãè®¾ç½® ssh ç©ºé²è¶æ¶éåºæ¶é´\n\n/etc/ssh/sshd_config\n\n#clientaliveinterval 0\n#clientalivecountmax 3\nä¿®æ¹æ\nclientaliveinterval 30    #ï¼æ¯30ç§å¾å®¢æ·ç«¯åéä¼è¯è¯·æ±ï¼ä¿æè¿æ¥ï¼\nclientalivecountmax 3     #ï¼å»ææ³¨éå³å¯ï¼3è¡¨ç¤ºéè¿3æ¬¡å¤±è´¥åï¼éå¯sshä¼è¯ï¼\n\n\n1\n2\n3\n4\n5\n\n\nsystemctl restart sshd\n\n\n# 3ã éå¶ç»éè®¿é®å°è¯çéªè¯æ¬¡æ°\n\nmaxauthtries 20\n\n\n1\n\n\n\n# 4ãåè®¸ root ç¨æ·ç»å½\n\nsed -i 's/permitrootlogin no/permitrootlogin yes/g'  /etc/ssh/sshd_config ;\\\nsystemctl restart sshd\n\n\n1\n2\n\n\n\n# 5ãè®¾ç½®ç»å½æ¹å¼\n\n# authorizedkeysfile   .ssh/authorized_keys   //å¬é¥å¬é¥è®¤è¯æä»¶\n# pubkeyauthentication yes   //å¯ä»¥ä½¿ç¨å¬é¥ç»å½\n# passwordauthentication no  //ä¸åè®¸ä½¿ç¨å¯ç ç»å½\n\n\n1\n2\n3\n\n\n\n# 6ãç¦æ­¢ä½¿ç¨ç©ºç½å¯ç ç¨æ·è®¿é®\n\npermitemptypasswords no\n\n\n1\n\n\n\n# 7ãssh ç»å½äºä»¶éç¥è³ ntfy\n\n/etc/pam.d/sshd\n\nsession optional pam_exec.so /usr/local/bin/ntfy-ssh-login.sh\n\n\n1\n\n\nntfy-ssh-login.sh\n\n#!/bin/bash\ntopic_url=http://test.curiouser.top:18070/ssh-notify\nif [ \"${pam_type}\" = \"open_session\" ]; then\n  curl -h tags:warning -h prio:high -d \"ssh login to $(hostname): ${pam_user} from ${pam_rhost}\" \"${topic_url}\"\nfi\n\n\n\n1\n2\n3\n4\n5\n6\n\n\né¨ç½²ç§æç ntfy\n\nntfy_server:\n  image: 'binwiederhier/ntfy'\n  restart: always\n  container_name: ntfy_server\n  command: serve --config /etc/ntfy/server.yml --cache-file /var/cache/ntfy/cache.db --listen-http :18070\n  ports:\n    - '18070:18070'\n  volumes:\n    - '/data/ntfy/data:/var/cache/ntfy'\n    - '/data/ntfy/config:/etc/ntfy'\n    - '/data/ntfy/data:/var/lib/ntfy/'\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n----------------------------------------\n\nåæé¾æ¥ï¼\n\nsshå®å¨ | gaoyufu 's blog",charsets:{cjk:!0}},{title:"ç½å¸½å­è®²webå®å¨",frontmatter:{title:"ç½å¸½å­è®²webå®å¨",date:"2023-02-24T15:38:46.000Z",permalink:"/pages/fcba46/",categories:["è¿ç»´","å®å¨"],tags:[null],readingShow:"top",description:"ä¿¡ä»»",meta:[{name:"twitter:title",content:"ç½å¸½å­è®²webå®å¨"},{name:"twitter:description",content:"ä¿¡ä»»"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/05.%E5%AE%89%E5%85%A8/02.%E7%99%BD%E5%B8%BD%E5%AD%90%E8%AE%B2web%E5%AE%89%E5%85%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ç½å¸½å­è®²webå®å¨"},{property:"og:description",content:"ä¿¡ä»»"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/05.%E5%AE%89%E5%85%A8/02.%E7%99%BD%E5%B8%BD%E5%AD%90%E8%AE%B2web%E5%AE%89%E5%85%A8.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-24T15:38:46.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ç½å¸½å­è®²webå®å¨"},{itemprop:"description",content:"ä¿¡ä»»"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/05.%E5%AE%89%E5%85%A8/02.%E7%99%BD%E5%B8%BD%E5%AD%90%E8%AE%B2web%E5%AE%89%E5%85%A8.html",relativePath:"04.è¿ç»´/05.å®å¨/02.ç½å¸½å­è®²webå®å¨.md",key:"v-0cf4e9e4",path:"/pages/fcba46/",headers:[{level:2,title:"å®å¨é®é¢çæ¬è´¨",slug:"å®å¨é®é¢çæ¬è´¨",normalizedTitle:"å®å¨é®é¢çæ¬è´¨",charIndex:2},{level:2,title:"å®å¨ä¸è¦ç´ ",slug:"å®å¨ä¸è¦ç´ ",normalizedTitle:"å®å¨ä¸è¦ç´ ",charIndex:18},{level:2,title:"å®å¨è¯ä¼°çè¿ç¨",slug:"å®å¨è¯ä¼°çè¿ç¨",normalizedTitle:"å®å¨è¯ä¼°çè¿ç¨",charIndex:144},{level:2,title:"äºèç½å®å¨çæ ¸å¿é®é¢",slug:"äºèç½å®å¨çæ ¸å¿é®é¢",normalizedTitle:"äºèç½å®å¨çæ ¸å¿é®é¢",charIndex:182},{level:2,title:"å¨èåé£é©",slug:"å¨èåé£é©",normalizedTitle:"å¨èåé£é©",charIndex:203},{level:2,title:"å¨èåæ STRIDE æ¨¡å",slug:"å¨èåæ-stride-æ¨¡å",normalizedTitle:"å¨èåæ stride æ¨¡å",charIndex:242},{level:2,title:"é£é©åæ DREAD æ¨¡å",slug:"é£é©åæ-dread-æ¨¡å",normalizedTitle:"é£é©åæ dread æ¨¡å",charIndex:588},{level:2,title:"Secure By Default åå",slug:"secure-by-default-åå",normalizedTitle:"secure by default åå",charIndex:1077},{level:2,title:"çºµæ·±é²å¾¡åå",slug:"çºµæ·±é²å¾¡åå",normalizedTitle:"çºµæ·±é²å¾¡åå",charIndex:1164},{level:2,title:"æ°æ®ä¸ä»£ç åç¦»åå",slug:"æ°æ®ä¸ä»£ç åç¦»åå",normalizedTitle:"æ°æ®ä¸ä»£ç åç¦»åå",charIndex:1280},{level:2,title:"ä¸å¯é¢æµæ§åå",slug:"ä¸å¯é¢æµæ§åå",normalizedTitle:"ä¸å¯é¢æµæ§åå",charIndex:1341},{level:2,title:"æµè§å¨å®å¨",slug:"æµè§å¨å®å¨",normalizedTitle:"æµè§å¨å®å¨",charIndex:1377},{level:3,title:"åæºç­ç¥",slug:"åæºç­ç¥",normalizedTitle:"åæºç­ç¥",charIndex:1387},{level:3,title:"æµè§å¨æ²ç®±",slug:"æµè§å¨æ²ç®±",normalizedTitle:"æµè§å¨æ²ç®±",charIndex:1523},{level:3,title:"æ¶æç½åæ¦æª",slug:"æ¶æç½åæ¦æª",normalizedTitle:"æ¶æç½åæ¦æª",charIndex:1648},{level:2,title:"è·¨ç«èæ¬æ»å»ï¼XSSï¼",slug:"è·¨ç«èæ¬æ»å»-xss",normalizedTitle:"è·¨ç«èæ¬æ»å»ï¼xssï¼",charIndex:1742},{level:2,title:"XSS æ»å»ç±»å",slug:"xss-æ»å»ç±»å",normalizedTitle:"xss æ»å»ç±»å",charIndex:1846}],headersStr:"å®å¨é®é¢çæ¬è´¨ å®å¨ä¸è¦ç´  å®å¨è¯ä¼°çè¿ç¨ äºèç½å®å¨çæ ¸å¿é®é¢ å¨èåé£é© å¨èåæ STRIDE æ¨¡å é£é©åæ DREAD æ¨¡å Secure By Default åå çºµæ·±é²å¾¡åå æ°æ®ä¸ä»£ç åç¦»åå ä¸å¯é¢æµæ§åå æµè§å¨å®å¨ åæºç­ç¥ æµè§å¨æ²ç®± æ¶æç½åæ¦æª è·¨ç«èæ¬æ»å»ï¼XSSï¼ XSS æ»å»ç±»å",content:"# å®å¨é®é¢çæ¬è´¨\n\nä¿¡ä»»\n\n\n# å®å¨ä¸è¦ç´ \n\næºå¯æ§ï¼Confidentialityï¼ãå®æ´æ§ï¼Integrityï¼ãå¯ç¨æ§ï¼Avaliabilityï¼\n\næºå¯æ§è¦æ±ä¿æ¤æ°æ®åå®¹ä¸è½æ³é²ã\n\nå®æ´æ§è¦æ±æ°æ®åå®¹æ¯å®æ´çãæ²¡æè¢«ç¯¡æ¹çã\n\nå¯ç¨æ§è¦æ±ä¿æ¤èµæºæ¯ âééèå¾âã\n\n\n# å®å¨è¯ä¼°çè¿ç¨\n\nèµäº§ç­çº§ååãå¨èåæãé£é©åæãç¡®è®¤è§£å³æ¹æ¡ã\n\n\n# äºèç½å®å¨çæ ¸å¿é®é¢\n\næ°æ®å®å¨\n\n\n# å¨èåé£é©\n\nå¯è½é æå±å®³çæ¥æºç§°ä¸ºå¨èï¼å¯è½ä¼åºç°çæå¤±ç§°ä¸ºé£é©ã\n\n\n# å¨èåæ STRIDE æ¨¡å\n\nå¨è                             å®ä¹         å¯¹åºçå®å¨å±æ§\nSpoofingï¼ä¼ªè£ï¼                   ååä»äººèº«ä»½     è®¤è¯\nTamperingï¼ç¯¡æ¹ï¼                  ä¿®æ¹æ°æ®æä»£ç     å®æ´æ§\nRepudiationï¼æµèµï¼                å¦ä»½åè¿çäºæ    ä¸å¯æµèµæ§\nInformationDisclosureï¼ä¿¡æ¯æ³é²ï¼    æºå¯ä¿¡æ¯æ³é²     æºå¯æ§\nDenial of Serviceï¼æç»æå¡ï¼        æç»æå¡       å¯ç¨æ§\nElevation of Privilegeï¼æåæéï¼   æªç»ææè·å¾è®¸å¯   ææ\n\n\n# é£é©åæ DREAD æ¨¡å\n\nç­çº§                 é«ï¼3ï¼                      ä¸­ï¼2ï¼                    ä½ï¼1ï¼\nDamage Potential   è·åå®å¨éªè¯æéï¼æ§è¡ç®¡çåæä½ï¼éæ³ä¸ä¼ æä»¶   æ³é²ææä¿¡æ¯                  æ³é²å¶ä»ä¿¡æ¯\nReproducibility    æ»å»èå¯ä»¥éæåæ¬¡æ»å»               æ»å»èå¯ä»¥éå¤æ»å»ï¼ä½ææ¶é´éå¶        æ»å»èå¾é¾éå¤æ»å»è¿ç¨\nExploitability     åå­¦èå¨ç­æåè½ææ¡æ»å»æ¹æ³            çç»çæ»å»èæè½å®æè¿æ¬¡æ»å»          æ¼æ´å©ç¨æ¡ä»¶éå¸¸èå»\nAffected users     ææç¨æ·ï¼é»è®¤éç½®ï¼å³é®ç¨æ·            é¨åç¨æ·ï¼éé»è®¤éç½®              æå°æ°ç¨æ·ï¼å¿åç¨æ·\nDiscoverability    æ¼æ´å¾æ¾ç¼ï¼æ»å»æ¡ä»¶å¾å®¹æè·å¾           å¨ç§æåºåï¼é¨åäººè½çå°ï¼éè¦æ·±å¥æææ¼æ´   åç°è¯¥æ¼æ´æå¶å°é¾\n\n\n# Secure By Default åå\n\nç½ååãé»ååï¼å¦ææ´å¤çä½¿ç¨ç½ååï¼é£ä¹ç³»ç»å°±ä¼åå¾æ´å®å¨\n\næå°æéååï¼è¦æ±åªæäºä¸»ä½å¿è¦çæéï¼èä¸è¦è¿åº¦ææã\n\n\n# çºµæ·±é²å¾¡åå\n\nçºµæ·±é²å¾¡åå«ä¸¤å±å«ä¹ï¼é¦åï¼è¦å¨åä¸ªä¸åå±é¢ãä¸åæ¹é¢å®æ½å®å¨æ¹æ¡ï¼é¿ååºç°çæ¼ï¼ä¸åå®å¨æ¹æ¡ä¹é´éè¦ç¸äºéåï¼ææä¸ä¸ªæ´ä½ï¼å¶æ¬¡ï¼è¦å¨æ­£ç¡®çå°æ¹åæ­£ç¡®çäºæï¼å³ï¼å¨è§£å³æ ¹æ¬é®é¢çå°æ¹å®æ½éå¯¹æ§çå®å¨æ¹æ¡ã\n\n\n# æ°æ®ä¸ä»£ç åç¦»åå\n\nç¨åºå¨æ æèå ä¸­ï¼å°ç¨æ·æ°æ®å½åä»£ç æ§è¡ï¼æ··æ·äºä»£ç ä¸æ°æ®çè¾¹çï¼ä»èå¯¼è´å®å¨é®é¢çåçã\n\n\n# ä¸å¯é¢æµæ§åå\n\néè¿ä½¿æ°æ®ä¸å¯é¢æµè¾¾å°è®©æ»å»æ¹æ³å¤±æçææã\n\n\n# æµè§å¨å®å¨\n\n\n# åæºç­ç¥\n\nå®ç¨äºéå¶ä¸ä¸ª origin çææ¡£æèå®å è½½çèæ¬å¦ä½è½ä¸å¦ä¸ä¸ªæºçèµæºè¿è¡äº¤äºãå®è½å¸®å©é»éæ¶æææ¡£ï¼åå°å¯è½è¢«æ»å»çåªä»ã\n\næµè§å¨çåæºç­ç¥ï¼éå¶äºæ¥èªä¸åæºç âdocumentâ æèæ¬ï¼å¯¹å½å âdocumentâ è¯»åæè®¾ç½®æäºå±æ§ã\n\n\n# æµè§å¨æ²ç®±\n\nè®©ä¸å¯ä¿¡ä»»çä»£ç è¿è¡å¨ä¸å®çç¯å¢ä¸­ï¼éå¶ä¸å¯ä¿¡ä»»çä»£ç è®¿é®éç¦»åºä¹å¤çèµæºãå¦æä¸å®è¦è·¨è¶ Sandbox è¾¹çäº§çæ°æ®äº¤æ¢ï¼ååªè½éè¿æå®çæ°æ®ééï¼æ¯å¦ç»è¿å°è£ç API æ¥å®æï¼å¨è¿äº API ä¸­ä¼ä¸¥æ ¼æ£æ¥è¯·æ±çåæ³æ§ã\n\n\n# æ¶æç½åæ¦æª\n\næ¶æç½åæ¦æªçå·¥ä½åçå¾ç®åï¼ä¸è¬é½æ¯æµè§å¨å¨ææ§å°ä»æå¡å¨ç«¯è·åä¸ä»½ææ°çæ¶æç½åé»ååï¼å¦æç¨æ·ä¸ç½æ¶è®¿é®çç½åå­å¨äºæ­¤é»ååä¸­ï¼æµè§å¨å°±ä¼å¼¹åºä¸ä¸ªè­¦åé¡µé¢ã\n\n\n# è·¨ç«èæ¬æ»å»ï¼XSSï¼\n\nè·¨ç«èæ¬æ»å»ï¼è±æå¨ç§°æ¯ Cross Site Scriptï¼éå¸¸æé»å®¢éè¿ âTHML æ³¨å¥â ç¯¡æ¹äºç½é¡µï¼æå¥äºæ¶æçèæ¬ï¼ä»èå¨ç¨æ·æµè§ç½é¡µæ¶ï¼æ§å¶æµè§å¨çä¸ç§æ»å»ã\n\n\n# XSS æ»å»ç±»å\n\nç¬¬ä¸ç§ï¼åå°åæ»å»ãæç¨æ·è¾å¥çæ°æ® âåå°â ç»æµè§å¨ã\n\nç¬¬äºç§ï¼å­å¨åæ»å»ãæç¨æ·è¾å¥çæ°æ® âå­å¨â å¨æå¡å¨ç«¯ã\n\nç¬¬ä¸ç§ï¼DOM Based XSSãéè¿ä¿®æ¹é¡µé¢ç DOM ç¹å½¢æ XSSã\n\n----------------------------------------\n\nåæé¾æ¥ï¼ç½å¸½å­è®²webå®å¨ | Gaoyufu 's blog",normalizedContent:"# å®å¨é®é¢çæ¬è´¨\n\nä¿¡ä»»\n\n\n# å®å¨ä¸è¦ç´ \n\næºå¯æ§ï¼confidentialityï¼ãå®æ´æ§ï¼integrityï¼ãå¯ç¨æ§ï¼avaliabilityï¼\n\næºå¯æ§è¦æ±ä¿æ¤æ°æ®åå®¹ä¸è½æ³é²ã\n\nå®æ´æ§è¦æ±æ°æ®åå®¹æ¯å®æ´çãæ²¡æè¢«ç¯¡æ¹çã\n\nå¯ç¨æ§è¦æ±ä¿æ¤èµæºæ¯ âééèå¾âã\n\n\n# å®å¨è¯ä¼°çè¿ç¨\n\nèµäº§ç­çº§ååãå¨èåæãé£é©åæãç¡®è®¤è§£å³æ¹æ¡ã\n\n\n# äºèç½å®å¨çæ ¸å¿é®é¢\n\næ°æ®å®å¨\n\n\n# å¨èåé£é©\n\nå¯è½é æå±å®³çæ¥æºç§°ä¸ºå¨èï¼å¯è½ä¼åºç°çæå¤±ç§°ä¸ºé£é©ã\n\n\n# å¨èåæ stride æ¨¡å\n\nå¨è                             å®ä¹         å¯¹åºçå®å¨å±æ§\nspoofingï¼ä¼ªè£ï¼                   ååä»äººèº«ä»½     è®¤è¯\ntamperingï¼ç¯¡æ¹ï¼                  ä¿®æ¹æ°æ®æä»£ç     å®æ´æ§\nrepudiationï¼æµèµï¼                å¦ä»½åè¿çäºæ    ä¸å¯æµèµæ§\ninformationdisclosureï¼ä¿¡æ¯æ³é²ï¼    æºå¯ä¿¡æ¯æ³é²     æºå¯æ§\ndenial of serviceï¼æç»æå¡ï¼        æç»æå¡       å¯ç¨æ§\nelevation of privilegeï¼æåæéï¼   æªç»ææè·å¾è®¸å¯   ææ\n\n\n# é£é©åæ dread æ¨¡å\n\nç­çº§                 é«ï¼3ï¼                      ä¸­ï¼2ï¼                    ä½ï¼1ï¼\ndamage potential   è·åå®å¨éªè¯æéï¼æ§è¡ç®¡çåæä½ï¼éæ³ä¸ä¼ æä»¶   æ³é²ææä¿¡æ¯                  æ³é²å¶ä»ä¿¡æ¯\nreproducibility    æ»å»èå¯ä»¥éæåæ¬¡æ»å»               æ»å»èå¯ä»¥éå¤æ»å»ï¼ä½ææ¶é´éå¶        æ»å»èå¾é¾éå¤æ»å»è¿ç¨\nexploitability     åå­¦èå¨ç­æåè½ææ¡æ»å»æ¹æ³            çç»çæ»å»èæè½å®æè¿æ¬¡æ»å»          æ¼æ´å©ç¨æ¡ä»¶éå¸¸èå»\naffected users     ææç¨æ·ï¼é»è®¤éç½®ï¼å³é®ç¨æ·            é¨åç¨æ·ï¼éé»è®¤éç½®              æå°æ°ç¨æ·ï¼å¿åç¨æ·\ndiscoverability    æ¼æ´å¾æ¾ç¼ï¼æ»å»æ¡ä»¶å¾å®¹æè·å¾           å¨ç§æåºåï¼é¨åäººè½çå°ï¼éè¦æ·±å¥æææ¼æ´   åç°è¯¥æ¼æ´æå¶å°é¾\n\n\n# secure by default åå\n\nç½ååãé»ååï¼å¦ææ´å¤çä½¿ç¨ç½ååï¼é£ä¹ç³»ç»å°±ä¼åå¾æ´å®å¨\n\næå°æéååï¼è¦æ±åªæäºä¸»ä½å¿è¦çæéï¼èä¸è¦è¿åº¦ææã\n\n\n# çºµæ·±é²å¾¡åå\n\nçºµæ·±é²å¾¡åå«ä¸¤å±å«ä¹ï¼é¦åï¼è¦å¨åä¸ªä¸åå±é¢ãä¸åæ¹é¢å®æ½å®å¨æ¹æ¡ï¼é¿ååºç°çæ¼ï¼ä¸åå®å¨æ¹æ¡ä¹é´éè¦ç¸äºéåï¼ææä¸ä¸ªæ´ä½ï¼å¶æ¬¡ï¼è¦å¨æ­£ç¡®çå°æ¹åæ­£ç¡®çäºæï¼å³ï¼å¨è§£å³æ ¹æ¬é®é¢çå°æ¹å®æ½éå¯¹æ§çå®å¨æ¹æ¡ã\n\n\n# æ°æ®ä¸ä»£ç åç¦»åå\n\nç¨åºå¨æ æèå ä¸­ï¼å°ç¨æ·æ°æ®å½åä»£ç æ§è¡ï¼æ··æ·äºä»£ç ä¸æ°æ®çè¾¹çï¼ä»èå¯¼è´å®å¨é®é¢çåçã\n\n\n# ä¸å¯é¢æµæ§åå\n\néè¿ä½¿æ°æ®ä¸å¯é¢æµè¾¾å°è®©æ»å»æ¹æ³å¤±æçææã\n\n\n# æµè§å¨å®å¨\n\n\n# åæºç­ç¥\n\nå®ç¨äºéå¶ä¸ä¸ª origin çææ¡£æèå®å è½½çèæ¬å¦ä½è½ä¸å¦ä¸ä¸ªæºçèµæºè¿è¡äº¤äºãå®è½å¸®å©é»éæ¶æææ¡£ï¼åå°å¯è½è¢«æ»å»çåªä»ã\n\næµè§å¨çåæºç­ç¥ï¼éå¶äºæ¥èªä¸åæºç âdocumentâ æèæ¬ï¼å¯¹å½å âdocumentâ è¯»åæè®¾ç½®æäºå±æ§ã\n\n\n# æµè§å¨æ²ç®±\n\nè®©ä¸å¯ä¿¡ä»»çä»£ç è¿è¡å¨ä¸å®çç¯å¢ä¸­ï¼éå¶ä¸å¯ä¿¡ä»»çä»£ç è®¿é®éç¦»åºä¹å¤çèµæºãå¦æä¸å®è¦è·¨è¶ sandbox è¾¹çäº§çæ°æ®äº¤æ¢ï¼ååªè½éè¿æå®çæ°æ®ééï¼æ¯å¦ç»è¿å°è£ç api æ¥å®æï¼å¨è¿äº api ä¸­ä¼ä¸¥æ ¼æ£æ¥è¯·æ±çåæ³æ§ã\n\n\n# æ¶æç½åæ¦æª\n\næ¶æç½åæ¦æªçå·¥ä½åçå¾ç®åï¼ä¸è¬é½æ¯æµè§å¨å¨ææ§å°ä»æå¡å¨ç«¯è·åä¸ä»½ææ°çæ¶æç½åé»ååï¼å¦æç¨æ·ä¸ç½æ¶è®¿é®çç½åå­å¨äºæ­¤é»ååä¸­ï¼æµè§å¨å°±ä¼å¼¹åºä¸ä¸ªè­¦åé¡µé¢ã\n\n\n# è·¨ç«èæ¬æ»å»ï¼xssï¼\n\nè·¨ç«èæ¬æ»å»ï¼è±æå¨ç§°æ¯ cross site scriptï¼éå¸¸æé»å®¢éè¿ âthml æ³¨å¥â ç¯¡æ¹äºç½é¡µï¼æå¥äºæ¶æçèæ¬ï¼ä»èå¨ç¨æ·æµè§ç½é¡µæ¶ï¼æ§å¶æµè§å¨çä¸ç§æ»å»ã\n\n\n# xss æ»å»ç±»å\n\nç¬¬ä¸ç§ï¼åå°åæ»å»ãæç¨æ·è¾å¥çæ°æ® âåå°â ç»æµè§å¨ã\n\nç¬¬äºç§ï¼å­å¨åæ»å»ãæç¨æ·è¾å¥çæ°æ® âå­å¨â å¨æå¡å¨ç«¯ã\n\nç¬¬ä¸ç§ï¼dom based xssãéè¿ä¿®æ¹é¡µé¢ç dom ç¹å½¢æ xssã\n\n----------------------------------------\n\nåæé¾æ¥ï¼ç½å¸½å­è®²webå®å¨ | gaoyufu 's blog",charsets:{cjk:!0}},{title:"ç³»ç»å®å¨ååºç¨åºç¡",frontmatter:{title:"ç³»ç»å®å¨ååºç¨åºç¡",date:"2023-02-24T15:49:26.000Z",permalink:"/pages/8dcd54/",categories:["è¿ç»´","å®å¨"],tags:[null],readingShow:"top",description:'grep "/sbin/nologin$" /etc/passwdÂ // æ¥æ¾ç»å½ Shell æ¯ /sbin/nologin çç¨æ·',meta:[{name:"image",content:"http://pic.zzppjj.top/LightPicture/2023/02/94ab7e82c75e5eff.png"},{name:"twitter:title",content:"ç³»ç»å®å¨ååºç¨åºç¡"},{name:"twitter:description",content:'grep "/sbin/nologin$" /etc/passwdÂ // æ¥æ¾ç»å½ Shell æ¯ /sbin/nologin çç¨æ·'},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://pic.zzppjj.top/LightPicture/2023/02/94ab7e82c75e5eff.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/05.%E5%AE%89%E5%85%A8/04.%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8F%8A%E5%BA%94%E7%94%A8%E5%9F%BA%E7%A1%80.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ç³»ç»å®å¨ååºç¨åºç¡"},{property:"og:description",content:'grep "/sbin/nologin$" /etc/passwdÂ // æ¥æ¾ç»å½ Shell æ¯ /sbin/nologin çç¨æ·'},{property:"og:image",content:"http://pic.zzppjj.top/LightPicture/2023/02/94ab7e82c75e5eff.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/05.%E5%AE%89%E5%85%A8/04.%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8F%8A%E5%BA%94%E7%94%A8%E5%9F%BA%E7%A1%80.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-24T15:49:26.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ç³»ç»å®å¨ååºç¨åºç¡"},{itemprop:"description",content:'grep "/sbin/nologin$" /etc/passwdÂ // æ¥æ¾ç»å½ Shell æ¯ /sbin/nologin çç¨æ·'},{itemprop:"image",content:"http://pic.zzppjj.top/LightPicture/2023/02/94ab7e82c75e5eff.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/05.%E5%AE%89%E5%85%A8/04.%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%8F%8A%E5%BA%94%E7%94%A8%E5%9F%BA%E7%A1%80.html",relativePath:"04.è¿ç»´/05.å®å¨/04.ç³»ç»å®å¨ååºç¨åºç¡.md",key:"v-c30db28e",path:"/pages/8dcd54/",headers:[{level:2,title:"ä¸ãè´¦å·å®å¨æ§å¶",slug:"ä¸ãè´¦å·å®å¨æ§å¶",normalizedTitle:"ä¸ãè´¦å·å®å¨æ§å¶",charIndex:2},{level:3,title:"1ãåºæ¬å®å¨æªæ½",slug:"_1ãåºæ¬å®å¨æªæ½",normalizedTitle:"1ãåºæ¬å®å¨æªæ½",charIndex:15},{level:4,title:"1ãç³»ç»è´¦å·æ¸ç",slug:"_1ãç³»ç»è´¦å·æ¸ç",normalizedTitle:"1ãç³»ç»è´¦å·æ¸ç",charIndex:27},{level:4,title:"2ãå¯ç å®å¨æ§å¶",slug:"_2ãå¯ç å®å¨æ§å¶",normalizedTitle:"2ãå¯ç å®å¨æ§å¶",charIndex:358},{level:4,title:"3ãå½ä»¤åå²ãèªå¨æ³¨é",slug:"_3ãå½ä»¤åå²ãèªå¨æ³¨é",normalizedTitle:"3ãå½ä»¤åå²ãèªå¨æ³¨é",charIndex:961},{level:3,title:"2ãç¨æ·åæ¢ä¸ææ",slug:"_2ãç¨æ·åæ¢ä¸ææ",normalizedTitle:"2ãç¨æ·åæ¢ä¸ææ",charIndex:1355},{level:4,title:"1ãsu å½ä»¤ï¼åæ¢ç¨æ·",slug:"_1ãsu-å½ä»¤-åæ¢ç¨æ·",normalizedTitle:"1ãsu å½ä»¤ï¼åæ¢ç¨æ·",charIndex:1368},{level:3,title:"2ã ç¨æ·å¸å·éå¶",slug:"_2ã-ç¨æ·å¸å·éå¶",normalizedTitle:"2ã ç¨æ·å¸å·éå¶",charIndex:1955},{level:2,title:"äºãç³»ç»å¼å¯¼åç»å½æ§å¶",slug:"äºãç³»ç»å¼å¯¼åç»å½æ§å¶",normalizedTitle:"äºãç³»ç»å¼å¯¼åç»å½æ§å¶",charIndex:3373},{level:3,title:"1ãå¼å³æºå®å¨æ§å¶",slug:"_1ãå¼å³æºå®å¨æ§å¶",normalizedTitle:"1ãå¼å³æºå®å¨æ§å¶",charIndex:3389},{level:4,title:"1ãè°æ´ BIOS å¼å¯¼è®¾ç½®",slug:"_1ãè°æ´-bios-å¼å¯¼è®¾ç½®",normalizedTitle:"1ãè°æ´ bios å¼å¯¼è®¾ç½®",charIndex:3402},{level:4,title:"2ãç¦æ­¢ Ctrl+Alt+Del å¿«æ·é®éå¯",slug:"_2ãç¦æ­¢-ctrl-alt-del-å¿«æ·é®éå¯",normalizedTitle:"2ãç¦æ­¢ ctrl+alt+del å¿«æ·é®éå¯",charIndex:3569},{level:4,title:"3ãéå¶æ´æ¹ GRUB å¼å¯¼åæ°",slug:"_3ãéå¶æ´æ¹-grub-å¼å¯¼åæ°",normalizedTitle:"3ãéå¶æ´æ¹ grub å¼å¯¼åæ°",charIndex:3921},{level:3,title:"2ãç»ç«¯ç»å½æ§å¶",slug:"_2ãç»ç«¯ç»å½æ§å¶",normalizedTitle:"2ãç»ç«¯ç»å½æ§å¶",charIndex:5472},{level:2,title:"",slug:"",normalizedTitle:"",charIndex:0},{level:3,title:"1ãå¼±å£ä»¤æ£æµ ââJohn the Ripper",slug:"_1ãå¼±å£ä»¤æ£æµ-john-the-ripper",normalizedTitle:"1ãå¼±å£ä»¤æ£æµ ââjohn the ripper",charIndex:5731},{level:3,title:"2ãç½ç»æ«æ ââNMAP",slug:"_2ãç½ç»æ«æ-nmap",normalizedTitle:"2ãç½ç»æ«æ âânmap",charIndex:5830},{level:4,title:"1ãå®è£ NMAP è½¯ä»¶å",slug:"_1ãå®è£-nmap-è½¯ä»¶å",normalizedTitle:"1ãå®è£ nmap è½¯ä»¶å",charIndex:5847}],headersStr:"ä¸ãè´¦å·å®å¨æ§å¶ 1ãåºæ¬å®å¨æªæ½ 1ãç³»ç»è´¦å·æ¸ç 2ãå¯ç å®å¨æ§å¶ 3ãå½ä»¤åå²ãèªå¨æ³¨é 2ãç¨æ·åæ¢ä¸ææ 1ãsu å½ä»¤ï¼åæ¢ç¨æ· 2ã ç¨æ·å¸å·éå¶ äºãç³»ç»å¼å¯¼åç»å½æ§å¶ 1ãå¼å³æºå®å¨æ§å¶ 1ãè°æ´ BIOS å¼å¯¼è®¾ç½® 2ãç¦æ­¢ Ctrl+Alt+Del å¿«æ·é®éå¯ 3ãéå¶æ´æ¹ GRUB å¼å¯¼åæ° 2ãç»ç«¯ç»å½æ§å¶  1ãå¼±å£ä»¤æ£æµ ââJohn the Ripper 2ãç½ç»æ«æ ââNMAP 1ãå®è£ NMAP è½¯ä»¶å",content:'# ä¸ãè´¦å·å®å¨æ§å¶\n\n\n# 1ãåºæ¬å®å¨æªæ½\n\n# 1ãç³»ç»è´¦å·æ¸ç\n\ngrep "/sbin/nologin$" /etc/passwdÂ // æ¥æ¾ç»å½ Shell æ¯ /sbin/nologin çç¨æ·\n\nusermod -LÂ è´¦å·åç§°Â // éå®è´¦å·\n\npasswd -SÂ è´¦å·åç§°Â // æ¥çè´¦å·ç¶æ\n\nusermod -UÂ è´¦å·åç§°Â // è§£éè´¦å·\n\nchattr +i /etc/passwd /etc/shadowÂ // éå®æä»¶\n\nIsattr /etc/passwd /etc/shadowÂ // æ¥çä¸ºéå®çç¶æ\n\nchattr -i /etc/passwd /etc/shadowÂ // è§£éæä»¶\n\nIsattr /etc/passwd /etc/shadowÂ // æ¥çä¸ºè§£éçç¶æ\n\n# 2ãå¯ç å®å¨æ§å¶\n\n/etc/pam.d/password-auth\n\npassword    requisite     pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type=  difok=1 minlen=8 ucredit=-1 lcredit=-1 dcredit=-1 \n\n\n\n1\n2\n\n * difok= å®ä¹æ°å¯ç ä¸­å¿é¡»è¦æå ä¸ªå­ç¬¦åæ§å¯ç ä¸å\n * minlen = æ°å¯ç çæå°é¿åº¦\n * ucredit= æ°å¯ç ä¸­å¯ä»¥åå«çå¤§åå­æ¯çæå¤§æ°ç®ã-1 è³å°ä¸ä¸ª\n * lcredit = æ°å¯ç ä¸­å¯ä»¥åå«çå°åå­æ¯çæå¤§æ°\n * dcredit = å®æ°å¯ç ä¸­å¯ä»¥åå«çæ°å­çæå¤§æ°ç®\n\næ³¨ï¼è¿ä¸ªå¯ç å¼ºåº¦çè®¾å®åªå¯¹ "æ®éç¨æ·" æéå¶ä½ç¨ï¼root ç¨æ·æ è®ºä¿®æ¹èªå·±çå¯ç è¿æ¯ä¿®æ¹æ®éç¨æ·çæ¶åï¼ä¸ç¬¦åå¼ºåº¦è®¾ç½®ä¾ç¶å¯ä»¥è®¾ç½®æå\n\n1ãå°å¯ç çæææè®¾ä¸º 30 å¤©ï¼\n\n# vim /etc/login.defs              //éç¨äºæ°å»ºçç¨æ·\nPASS_MAX_DAYS   30\n# chage -M 30 lisi             //éç¨äºå·²æçç¨æ·\n\n\n\n1\n2\n3\n4\n\n\n2ãå¼ºå¶è¦æ±ç¨æ·ä¸æ¬¡ç»å½æ¶éè®¾å¯ç \n\n# chage -d 0 lisi\n\n\n1\n\n\n# 3ãå½ä»¤åå²ãèªå¨æ³¨é\n\n1ãè®¾ç½®æå¤åªè®°å½ 200 æ¡åå²å½ä»¤\n\n# vim /etc/profile             //éç¨äºæ°ç»å½ç¨æ·\nHISTSIZE=200\n# export HISTSIZE=200             //éç¨äºå½åç¨æ·\n\n\n1\n2\n3\n\n\n2ãå½ç¨æ·éåºå·²ç»å½ Bash ç¯å¢ä»¥åï¼æè®°å½çåå²å½ä»¤å°èªå¨æ¸ç©º\n\n# vim ~/.bash_logout \nhistory -c\nclear\n\n\n1\n2\n3\n\n\n3ãå½è¶è¿æå®çæ¶é´æ²¡æä»»ä½è¾å¥æ¶å³èªå¨æ³¨éç»ç«¯ï¼é²ç½®è¶æ¶ç±åé TMOUT æ¥æ§å¶ï¼é»è®¤åä½ä¸ºç§ä¼°ï¼\n\n# vim /etc/profile             //éç¨äºæ°ç»å½ç¨æ·\nexport TMOUT=600\n# export TMOUT=600             //éç¨äºå½åç¨æ·\n\n\n1\n2\n3\n\n\n\n# 2ãç¨æ·åæ¢ä¸ææ\n\n# 1ãsu å½ä»¤ï¼åæ¢ç¨æ·\n\n# su - root\n\n\n1\n\n\nåå©äº pam_wheel è®¤è¯æ¨¡åï¼åªåè®¸æä¸ªå«ç¨æ·ä½¿ç¨ su å½ä»¤è¿è¡åæ¢\n\nå°ææä½¿ç¨ su å½ä»¤çç¨æ·æ·»å å° wheel ç»ï¼ä¿®æ¹ /etc/pam. d/su è®¤è¯éç½®ä»¥å¯ç¨ pam_wheel è®¤è¯\n\n# gpasswd -a zhangsan wheel\næ­£å¨å°ç¨æ·âzhangsanâå å¥å°âwheelâç»ä¸­\n# grep wheel /etc/group\nwheel:x:10:lisi,zhangsan\n# vim /etc/pam.d/su\nauth            required        pam_wheel.so use_uid             //å»ææ­¤è¡å¼å¤´çï¼å·\n\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå¯ç¨ pam_wheel è®¤è¯ä»¥åï¼æªå å¥å° wheel ç»åçå¶ä»ç¨æ·å°æ æ³ä½¿ç¨ su å½ä»¤\n\n# su - zhangsan\n[zhangsan@localhost ~]$ su - root\nå¯ç ï¼\nä¸ä¸æ¬¡ç»å½ï¼å 7æ 16 20:31:08 CST 2020pts/0 ä¸\n# su - wangwu\n[wangwu@localhost ~]$ su - root\nå¯ç ï¼\nsu: æç»æé\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# 2ã ç¨æ·å¸å·éå¶\n\n * /etc/login.defsÂ éç½®æä»¶æ¯è®¾ç½®ç¨æ·å¸å·éå¶çæä»¶ï¼å¯éç½®å¯ç çæå¤§è¿æå¤©æ°ï¼å¯ç çæå¤§é¿åº¦çº¦æç­åå®¹ã\n\n * è¯¥æä»¶éçéç½®å¯¹ root ç¨æ·æ æãæ­¤æä»¶ä¸­çéç½®ä¸Â /etc/passwdÂ åÂ /etc/shadowÂ æä»¶ä¸­çç¨æ·ä¿¡æ¯æå²çªæ¶ï¼ç³»ç»ä¼ä»¥Â /etc/passwdÂ åÂ /etc/shadowÂ ä¸ºåã\n\n * /etc/login.defsÂ æä»¶ç¨äºå¨ Linux åå»ºç¨æ·æ¶ï¼å¯¹ç¨æ·çä¸äºåºæ¬å±æ§åé»è®¤è®¾ç½®ï¼ä¾å¦æå®ç¨æ· UID å GID çèå´ï¼ç¨æ·çè¿ææ¶é´ï¼å¯ç çæå¤§é¿åº¦ï¼ç­ç­ã\n\nè®¾ç½®é¡¹                        å«ä¹\nMAIL_DIR /var/spool/mail   åå»ºç¨æ·æ¶ï¼ç³»ç»ä¼å¨ç®å½ /var/spool/mail ä¸­åå»ºä¸ä¸ªç¨æ·é®ç®±ï¼æ¯å¦ lamp ç¨æ·çé®ç®±æ¯\n                           /var/spool/mail/lampã\nPASS_MAX_DAYS 99999        å¯ç æææï¼99999 æ¯èª 1970 å¹´ 1 æ 1 æ¥èµ·å¯ç ææçå¤©æ°ï¼ç¸å½äº 273 å¹´ï¼å¯çè§£ä¸ºå¯ç å§ç»ææã\nPASS_MIN_DAYS 0            è¡¨ç¤ºèªä¸æ¬¡ä¿®æ¹å¯ç ä»¥æ¥ï¼æå°éå¤å°å¤©åç¨æ·æè½åæ¬¡ä¿®æ¹å¯ç ï¼é»è®¤å¼æ¯ 0ã\nPASS_MIN_LEN 5             æå®å¯ç çæå°é¿åº¦ï¼é»è®¤ä¸å°äº 5 ä½ï¼ä½æ¯ç°å¨ç¨æ·ç»å½æ¶éªè¯å·²ç»è¢« PAM æ¨¡ååä»£ï¼æä»¥è¿ä¸ªéé¡¹å¹¶ä¸çæã\nPASS_WARN_AGE 7            æå®å¨å¯ç å°æåå¤å°å¤©ï¼ç³»ç»å°±å¼å§éè¿ç¨æ·å¯ç å³å°å°æï¼é»è®¤ä¸º 7 å¤©ã\nUID_MIN 500                æå®æå° UID ä¸º 500ï¼ä¹å°±æ¯è¯´ï¼æ·»å ç¨æ·æ¶ï¼é»è®¤ UID ä» 500 å¼å§ãæ³¨æï¼å¦ææå·¥æå®äºä¸ä¸ªç¨æ·ç\n                           UID æ¯ 550ï¼é£ä¹ä¸ä¸ä¸ªåå»ºçç¨æ·ç UID å°±ä¼ä» 551 å¼å§ï¼åªæ 500~549 ä¹é´ç UID\n                           æ²¡æä½¿ç¨ã\nUID_MAX 60000              æå®ç¨æ·æå¤§ç UID ä¸º 60000ã\nGID_MIN 500                æå®æå° GID ä¸º 500ï¼ä¹å°±æ¯å¨æ·»å ç»æ¶ï¼ç»ç GID ä» 500 å¼å§ã\nGID_MAX 60000              ç¨æ· GID æå¤§ä¸º 60000ã\nCREATE_HOME yes            æå®å¨åå»ºç¨æ·æ¶ï¼æ¯å¦åæ¶åå»ºç¨æ·ä¸»ç®å½ï¼yes è¡¨ç¤ºåå»ºï¼no åä¸åå»ºï¼é»è®¤æ¯ yesã\nUMASK 077                  ç¨æ·ä¸»ç®å½çæéé»è®¤è®¾ç½®ä¸º 077ã\nUSERGROUPS_ENAB yes        æå®å é¤ç¨æ·çæ¶åæ¯å¦åæ¶å é¤ç¨æ·ç»ï¼åå¤å°è¯´ï¼è¿éæçæ¯å é¤ç¨æ·çåå§ç»ï¼æ­¤é¡¹çé»è®¤å¼ä¸º yesã\nENCRYPT_METHOD SHA512      æå®ç¨æ·å¯ç éç¨çå å¯è§åï¼é»è®¤éç¨ SHA512ï¼è¿æ¯æ°çå¯ç å å¯æ¨¡å¼ï¼ååç Linux åªè½ç¨ DES æ MD5\n                           å å¯ã\n\n\n# äºãç³»ç»å¼å¯¼åç»å½æ§å¶\n\n\n# 1ãå¼å³æºå®å¨æ§å¶\n\n# 1ãè°æ´ BIOS å¼å¯¼è®¾ç½®\n\n * ï¼1ï¼å°ç¬¬ä¸ä¼åå¼å¯¼è®¾å¤ (First Boot Device) è®¾ä¸ºå½åç³»ç»æå¨ç£çã\n * ï¼2ï¼ç¦æ­¢ä»å¶ä»è®¾å¤ (å¦åçãU çãç½ç»ç­) å¼å¯¼ç³»ç»ï¼å¯¹åºçé¡¹è®¾ä¸º "Disabled"ã\n * ï¼3ï¼å° BOS çå®å¨çº§å«æ¹ä¸º "setup"ï¼å¹¶è®¾ç½®å¥½ç®¡çå¯ç ï¼ä»¥é²æ­¢æªææçä¿®æ¹ã\n\n# 2ãç¦æ­¢ Ctrl+Alt+Del å¿«æ·é®éå¯\n\n# systemctl mask ctrl-alt-del.target              //ç¦æ­¢Ctrl+Alt+Delå¿«æ·é®éå¯\nCreated symlink from /etc/systemd/system/ctrl-alt-del.target to /dev/null.\n# systemctl daemon-reload              //å·æ°éç½®\n# systemctl unmask ctrl-alt-del.target             //å¼å¯Ctrl+Alt+Delå¿«æ·é®éå¯\n# systemctl daemon-reload             //å·æ°éç½®\n\n\n1\n2\n3\n4\n5\n\n\n# 3ãéå¶æ´æ¹ GRUB å¼å¯¼åæ°\n\n# grub2-mkpasswd-pbkdf2 \nè¾å¥å£ä»¤ï¼\nReenter password: \nPBKDF2 hash of your password is grub.pbkdf2.sha512.10000.0231854D0AD301240629102B62FCFB09E7347E7E3254E34ACE0186A41BA65A2A749B6A5F59AC37B6431649D5D0F3238CFC2ED92C407468C0CE2B29C2F3FFF9A8.1906AC682652E7EEC736AC3F4E866D2C5038EB4AED72D980331CE80ED4D05A9929F043A5EB7190FD3775294CE50FCFA745C16E783A93E52F77E0D3A9695C246A\n# cp /boot/grub2/grub.cfg /boot/grub2/grub.cfg.bak\n# cp /etc/grub.d/00_header /etc/grub.d/00_header.bak\n# vim /etc/grub.d/00_header\n......\ncat<<  EOF\nset superusers = "root"\npassword_pbkdf2 root grub.pbkdf2.sha512.10000.0231854D0AD301240629102B62FCFB09E7347E7E3254E34ACE0186A41BA65A2A749B6A5F59AC37B6431649D5D0F3238CFC2ED92C407468C0CE2B29C2F3FFF9A8.1906AC682652E7EEC736AC3F4E866D2C5038EB4AED72D980331CE80ED4D05A9929F043A5EB7190FD3775294CE50FCFA745C16E783A93E52F77E0D3A9695C246A\nEOF\n# grub2-mkconfig -o /boot/grub2/grub.cfg\nGenerating grub configuration file ...\nFound linux image: /boot/vmlinuz-3.10.0-1127.8.2.el7.x86_64\nFound initrd image: /boot/initramfs-3.10.0-1127.8.2.el7.x86_64.img\nFound linux image: /boot/vmlinuz-3.10.0-1062.18.1.el7.x86_64\nFound initrd image: /boot/initramfs-3.10.0-1062.18.1.el7.x86_64.img\nFound linux image: /boot/vmlinuz-3.10.0-957.el7.x86_64\nFound initrd image: /boot/initramfs-3.10.0-957.el7.x86_64.img\nFound linux image: /boot/vmlinuz-0-rescue-fc8e001937cb4a35b289459e53090806\nFound initrd image: /boot/initramfs-0-rescue-fc8e001937cb4a35b289459e53090806.img\ndone\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# 2ãç»ç«¯ç»å½æ§å¶\n\n1ãç¦æ­¢ root ç¨æ·ç»å½\n\n# vim /etc/securetty             //ç¦æ­¢rootç¨æ·ä»tty5ãtty6ç»å½\ntty1\ntty2\ntty3\ntty4\n#tty5\n#tty6\ntty7\ntty8\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n2ãç¦æ­¢æ®éç¨æ·ç»å½ï¼root ç¨æ·ä¸åéå¶ï¼ï¼å½æå¨å é¤ /etc/nologin æä»¶æèéæ°å¯å¨ä¸»æºä»¥åï¼å³å¯æ¢å¤æ­£å¸¸ã\n\n# touch /etc/nologin\n\n\n1\n\n\n\n#\n\nä¸ãå¼±å£ä»¤æ£æµãç«¯å£æ«æ\n\n\n# 1ãå¼±å£ä»¤æ£æµ ââJohn the Ripper\n\nå®è£ John the Ripper\n\n\n\n\n\næ¥çå·²ç ´è§£åºçè´¦æ·åè¡¨\n\n\n\nä½¿ç¨å¯ç å­å¸æä»¶\n\næ¸ç©ºå·±ç ´è§£åºçè´¦æ·åè¡¨åéæ°åæ\n\n\n\n\n# 2ãç½ç»æ«æ ââNMAP\n\n# 1ãå®è£ NMAP è½¯ä»¶å\n\n# yum -y install nmap\n\n\n1\n\n\n1\n\nåæ°    è¯´æ                                  åæ°    è¯´æ\n-p    æå®æ«æçç«¯å£                             -n    ç¦ç¨åå DNS è§£æï¼ä»¥å å¿«æ«æéåº¦ï¼\n-sS   æ¥çç®æ ç«¯å£æ¯å¦æ­£å¨çå¬ï¼å¹¶ç«å³æ­å¼è¿æ¥ï¼å¦åè®¤ä¸ºç®æ ç«¯å£å¹¶æªå¼æ¾   -sT   æ¥çç®æ ç«¯å£æ­£å¨çå¬æå¡ï¼å¦åè®¤ä¸ºç®æ ç«¯å£å¹¶æªå¼æ¾\n-sF   é´æ¥æ£æµé²ç«å¢çå¥å£®æ§                         -sU   æ¢æµç®æ ä¸»æºæä¾åªäº UDP æå¡\n-sP   å¿«éå¤æ­ç®æ ä¸»æºæ¯å¦å­æ´»                        -P0   è·³è¿ ping æ£æµ\n\næ«æå¸¸ç¨ç TCP ç«¯å£\n\n\n\næ«æå¸¸ç¨ç UDP ç«¯å£\n\n\n\nä¾å¦ï¼\n\næ£æ¥ 192.168.4.0/24 ç½æ®µä¸­æåªäºä¸»æºæä¾ FTP æå¡ï¼nmap -p 21 192.168.4.0/24\n\næ£æµ 192.168.4.0/24 ç½æ®µä¸­æåªäºå­æ´»ä¸»æºï¼è½ ping é)ï¼nmap -n -sP 192.168.4.0/24\n\næ£æµ IP å°åä½äº 192.168.4.100-200 çä¸»æºæ¯å¦å¼å¯æä»¶å±äº«æå¡ï¼nmap -p 139ï¼445 192.168.4.100-200',normalizedContent:'# ä¸ãè´¦å·å®å¨æ§å¶\n\n\n# 1ãåºæ¬å®å¨æªæ½\n\n# 1ãç³»ç»è´¦å·æ¸ç\n\ngrep "/sbin/nologin$" /etc/passwdÂ // æ¥æ¾ç»å½ shell æ¯ /sbin/nologin çç¨æ·\n\nusermod -lÂ è´¦å·åç§°Â // éå®è´¦å·\n\npasswd -sÂ è´¦å·åç§°Â // æ¥çè´¦å·ç¶æ\n\nusermod -uÂ è´¦å·åç§°Â // è§£éè´¦å·\n\nchattr +i /etc/passwd /etc/shadowÂ // éå®æä»¶\n\nisattr /etc/passwd /etc/shadowÂ // æ¥çä¸ºéå®çç¶æ\n\nchattr -i /etc/passwd /etc/shadowÂ // è§£éæä»¶\n\nisattr /etc/passwd /etc/shadowÂ // æ¥çä¸ºè§£éçç¶æ\n\n# 2ãå¯ç å®å¨æ§å¶\n\n/etc/pam.d/password-auth\n\npassword    requisite     pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type=  difok=1 minlen=8 ucredit=-1 lcredit=-1 dcredit=-1 \n\n\n\n1\n2\n\n * difok= å®ä¹æ°å¯ç ä¸­å¿é¡»è¦æå ä¸ªå­ç¬¦åæ§å¯ç ä¸å\n * minlen = æ°å¯ç çæå°é¿åº¦\n * ucredit= æ°å¯ç ä¸­å¯ä»¥åå«çå¤§åå­æ¯çæå¤§æ°ç®ã-1 è³å°ä¸ä¸ª\n * lcredit = æ°å¯ç ä¸­å¯ä»¥åå«çå°åå­æ¯çæå¤§æ°\n * dcredit = å®æ°å¯ç ä¸­å¯ä»¥åå«çæ°å­çæå¤§æ°ç®\n\næ³¨ï¼è¿ä¸ªå¯ç å¼ºåº¦çè®¾å®åªå¯¹ "æ®éç¨æ·" æéå¶ä½ç¨ï¼root ç¨æ·æ è®ºä¿®æ¹èªå·±çå¯ç è¿æ¯ä¿®æ¹æ®éç¨æ·çæ¶åï¼ä¸ç¬¦åå¼ºåº¦è®¾ç½®ä¾ç¶å¯ä»¥è®¾ç½®æå\n\n1ãå°å¯ç çæææè®¾ä¸º 30 å¤©ï¼\n\n# vim /etc/login.defs              //éç¨äºæ°å»ºçç¨æ·\npass_max_days   30\n# chage -m 30 lisi             //éç¨äºå·²æçç¨æ·\n\n\n\n1\n2\n3\n4\n\n\n2ãå¼ºå¶è¦æ±ç¨æ·ä¸æ¬¡ç»å½æ¶éè®¾å¯ç \n\n# chage -d 0 lisi\n\n\n1\n\n\n# 3ãå½ä»¤åå²ãèªå¨æ³¨é\n\n1ãè®¾ç½®æå¤åªè®°å½ 200 æ¡åå²å½ä»¤\n\n# vim /etc/profile             //éç¨äºæ°ç»å½ç¨æ·\nhistsize=200\n# export histsize=200             //éç¨äºå½åç¨æ·\n\n\n1\n2\n3\n\n\n2ãå½ç¨æ·éåºå·²ç»å½ bash ç¯å¢ä»¥åï¼æè®°å½çåå²å½ä»¤å°èªå¨æ¸ç©º\n\n# vim ~/.bash_logout \nhistory -c\nclear\n\n\n1\n2\n3\n\n\n3ãå½è¶è¿æå®çæ¶é´æ²¡æä»»ä½è¾å¥æ¶å³èªå¨æ³¨éç»ç«¯ï¼é²ç½®è¶æ¶ç±åé tmout æ¥æ§å¶ï¼é»è®¤åä½ä¸ºç§ä¼°ï¼\n\n# vim /etc/profile             //éç¨äºæ°ç»å½ç¨æ·\nexport tmout=600\n# export tmout=600             //éç¨äºå½åç¨æ·\n\n\n1\n2\n3\n\n\n\n# 2ãç¨æ·åæ¢ä¸ææ\n\n# 1ãsu å½ä»¤ï¼åæ¢ç¨æ·\n\n# su - root\n\n\n1\n\n\nåå©äº pam_wheel è®¤è¯æ¨¡åï¼åªåè®¸æä¸ªå«ç¨æ·ä½¿ç¨ su å½ä»¤è¿è¡åæ¢\n\nå°ææä½¿ç¨ su å½ä»¤çç¨æ·æ·»å å° wheel ç»ï¼ä¿®æ¹ /etc/pam. d/su è®¤è¯éç½®ä»¥å¯ç¨ pam_wheel è®¤è¯\n\n# gpasswd -a zhangsan wheel\næ­£å¨å°ç¨æ·âzhangsanâå å¥å°âwheelâç»ä¸­\n# grep wheel /etc/group\nwheel:x:10:lisi,zhangsan\n# vim /etc/pam.d/su\nauth            required        pam_wheel.so use_uid             //å»ææ­¤è¡å¼å¤´çï¼å·\n\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå¯ç¨ pam_wheel è®¤è¯ä»¥åï¼æªå å¥å° wheel ç»åçå¶ä»ç¨æ·å°æ æ³ä½¿ç¨ su å½ä»¤\n\n# su - zhangsan\n[zhangsan@localhost ~]$ su - root\nå¯ç ï¼\nä¸ä¸æ¬¡ç»å½ï¼å 7æ 16 20:31:08 cst 2020pts/0 ä¸\n# su - wangwu\n[wangwu@localhost ~]$ su - root\nå¯ç ï¼\nsu: æç»æé\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# 2ã ç¨æ·å¸å·éå¶\n\n * /etc/login.defsÂ éç½®æä»¶æ¯è®¾ç½®ç¨æ·å¸å·éå¶çæä»¶ï¼å¯éç½®å¯ç çæå¤§è¿æå¤©æ°ï¼å¯ç çæå¤§é¿åº¦çº¦æç­åå®¹ã\n\n * è¯¥æä»¶éçéç½®å¯¹ root ç¨æ·æ æãæ­¤æä»¶ä¸­çéç½®ä¸Â /etc/passwdÂ åÂ /etc/shadowÂ æä»¶ä¸­çç¨æ·ä¿¡æ¯æå²çªæ¶ï¼ç³»ç»ä¼ä»¥Â /etc/passwdÂ åÂ /etc/shadowÂ ä¸ºåã\n\n * /etc/login.defsÂ æä»¶ç¨äºå¨ linux åå»ºç¨æ·æ¶ï¼å¯¹ç¨æ·çä¸äºåºæ¬å±æ§åé»è®¤è®¾ç½®ï¼ä¾å¦æå®ç¨æ· uid å gid çèå´ï¼ç¨æ·çè¿ææ¶é´ï¼å¯ç çæå¤§é¿åº¦ï¼ç­ç­ã\n\nè®¾ç½®é¡¹                        å«ä¹\nmail_dir /var/spool/mail   åå»ºç¨æ·æ¶ï¼ç³»ç»ä¼å¨ç®å½ /var/spool/mail ä¸­åå»ºä¸ä¸ªç¨æ·é®ç®±ï¼æ¯å¦ lamp ç¨æ·çé®ç®±æ¯\n                           /var/spool/mail/lampã\npass_max_days 99999        å¯ç æææï¼99999 æ¯èª 1970 å¹´ 1 æ 1 æ¥èµ·å¯ç ææçå¤©æ°ï¼ç¸å½äº 273 å¹´ï¼å¯çè§£ä¸ºå¯ç å§ç»ææã\npass_min_days 0            è¡¨ç¤ºèªä¸æ¬¡ä¿®æ¹å¯ç ä»¥æ¥ï¼æå°éå¤å°å¤©åç¨æ·æè½åæ¬¡ä¿®æ¹å¯ç ï¼é»è®¤å¼æ¯ 0ã\npass_min_len 5             æå®å¯ç çæå°é¿åº¦ï¼é»è®¤ä¸å°äº 5 ä½ï¼ä½æ¯ç°å¨ç¨æ·ç»å½æ¶éªè¯å·²ç»è¢« pam æ¨¡ååä»£ï¼æä»¥è¿ä¸ªéé¡¹å¹¶ä¸çæã\npass_warn_age 7            æå®å¨å¯ç å°æåå¤å°å¤©ï¼ç³»ç»å°±å¼å§éè¿ç¨æ·å¯ç å³å°å°æï¼é»è®¤ä¸º 7 å¤©ã\nuid_min 500                æå®æå° uid ä¸º 500ï¼ä¹å°±æ¯è¯´ï¼æ·»å ç¨æ·æ¶ï¼é»è®¤ uid ä» 500 å¼å§ãæ³¨æï¼å¦ææå·¥æå®äºä¸ä¸ªç¨æ·ç\n                           uid æ¯ 550ï¼é£ä¹ä¸ä¸ä¸ªåå»ºçç¨æ·ç uid å°±ä¼ä» 551 å¼å§ï¼åªæ 500~549 ä¹é´ç uid\n                           æ²¡æä½¿ç¨ã\nuid_max 60000              æå®ç¨æ·æå¤§ç uid ä¸º 60000ã\ngid_min 500                æå®æå° gid ä¸º 500ï¼ä¹å°±æ¯å¨æ·»å ç»æ¶ï¼ç»ç gid ä» 500 å¼å§ã\ngid_max 60000              ç¨æ· gid æå¤§ä¸º 60000ã\ncreate_home yes            æå®å¨åå»ºç¨æ·æ¶ï¼æ¯å¦åæ¶åå»ºç¨æ·ä¸»ç®å½ï¼yes è¡¨ç¤ºåå»ºï¼no åä¸åå»ºï¼é»è®¤æ¯ yesã\numask 077                  ç¨æ·ä¸»ç®å½çæéé»è®¤è®¾ç½®ä¸º 077ã\nusergroups_enab yes        æå®å é¤ç¨æ·çæ¶åæ¯å¦åæ¶å é¤ç¨æ·ç»ï¼åå¤å°è¯´ï¼è¿éæçæ¯å é¤ç¨æ·çåå§ç»ï¼æ­¤é¡¹çé»è®¤å¼ä¸º yesã\nencrypt_method sha512      æå®ç¨æ·å¯ç éç¨çå å¯è§åï¼é»è®¤éç¨ sha512ï¼è¿æ¯æ°çå¯ç å å¯æ¨¡å¼ï¼ååç linux åªè½ç¨ des æ md5\n                           å å¯ã\n\n\n# äºãç³»ç»å¼å¯¼åç»å½æ§å¶\n\n\n# 1ãå¼å³æºå®å¨æ§å¶\n\n# 1ãè°æ´ bios å¼å¯¼è®¾ç½®\n\n * ï¼1ï¼å°ç¬¬ä¸ä¼åå¼å¯¼è®¾å¤ (first boot device) è®¾ä¸ºå½åç³»ç»æå¨ç£çã\n * ï¼2ï¼ç¦æ­¢ä»å¶ä»è®¾å¤ (å¦åçãu çãç½ç»ç­) å¼å¯¼ç³»ç»ï¼å¯¹åºçé¡¹è®¾ä¸º "disabled"ã\n * ï¼3ï¼å° bos çå®å¨çº§å«æ¹ä¸º "setup"ï¼å¹¶è®¾ç½®å¥½ç®¡çå¯ç ï¼ä»¥é²æ­¢æªææçä¿®æ¹ã\n\n# 2ãç¦æ­¢ ctrl+alt+del å¿«æ·é®éå¯\n\n# systemctl mask ctrl-alt-del.target              //ç¦æ­¢ctrl+alt+delå¿«æ·é®éå¯\ncreated symlink from /etc/systemd/system/ctrl-alt-del.target to /dev/null.\n# systemctl daemon-reload              //å·æ°éç½®\n# systemctl unmask ctrl-alt-del.target             //å¼å¯ctrl+alt+delå¿«æ·é®éå¯\n# systemctl daemon-reload             //å·æ°éç½®\n\n\n1\n2\n3\n4\n5\n\n\n# 3ãéå¶æ´æ¹ grub å¼å¯¼åæ°\n\n# grub2-mkpasswd-pbkdf2 \nè¾å¥å£ä»¤ï¼\nreenter password: \npbkdf2 hash of your password is grub.pbkdf2.sha512.10000.0231854d0ad301240629102b62fcfb09e7347e7e3254e34ace0186a41ba65a2a749b6a5f59ac37b6431649d5d0f3238cfc2ed92c407468c0ce2b29c2f3fff9a8.1906ac682652e7eec736ac3f4e866d2c5038eb4aed72d980331ce80ed4d05a9929f043a5eb7190fd3775294ce50fcfa745c16e783a93e52f77e0d3a9695c246a\n# cp /boot/grub2/grub.cfg /boot/grub2/grub.cfg.bak\n# cp /etc/grub.d/00_header /etc/grub.d/00_header.bak\n# vim /etc/grub.d/00_header\n......\ncat<<  eof\nset superusers = "root"\npassword_pbkdf2 root grub.pbkdf2.sha512.10000.0231854d0ad301240629102b62fcfb09e7347e7e3254e34ace0186a41ba65a2a749b6a5f59ac37b6431649d5d0f3238cfc2ed92c407468c0ce2b29c2f3fff9a8.1906ac682652e7eec736ac3f4e866d2c5038eb4aed72d980331ce80ed4d05a9929f043a5eb7190fd3775294ce50fcfa745c16e783a93e52f77e0d3a9695c246a\neof\n# grub2-mkconfig -o /boot/grub2/grub.cfg\ngenerating grub configuration file ...\nfound linux image: /boot/vmlinuz-3.10.0-1127.8.2.el7.x86_64\nfound initrd image: /boot/initramfs-3.10.0-1127.8.2.el7.x86_64.img\nfound linux image: /boot/vmlinuz-3.10.0-1062.18.1.el7.x86_64\nfound initrd image: /boot/initramfs-3.10.0-1062.18.1.el7.x86_64.img\nfound linux image: /boot/vmlinuz-3.10.0-957.el7.x86_64\nfound initrd image: /boot/initramfs-3.10.0-957.el7.x86_64.img\nfound linux image: /boot/vmlinuz-0-rescue-fc8e001937cb4a35b289459e53090806\nfound initrd image: /boot/initramfs-0-rescue-fc8e001937cb4a35b289459e53090806.img\ndone\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# 2ãç»ç«¯ç»å½æ§å¶\n\n1ãç¦æ­¢ root ç¨æ·ç»å½\n\n# vim /etc/securetty             //ç¦æ­¢rootç¨æ·ä»tty5ãtty6ç»å½\ntty1\ntty2\ntty3\ntty4\n#tty5\n#tty6\ntty7\ntty8\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n2ãç¦æ­¢æ®éç¨æ·ç»å½ï¼root ç¨æ·ä¸åéå¶ï¼ï¼å½æå¨å é¤ /etc/nologin æä»¶æèéæ°å¯å¨ä¸»æºä»¥åï¼å³å¯æ¢å¤æ­£å¸¸ã\n\n# touch /etc/nologin\n\n\n1\n\n\n\n#\n\nä¸ãå¼±å£ä»¤æ£æµãç«¯å£æ«æ\n\n\n# 1ãå¼±å£ä»¤æ£æµ ââjohn the ripper\n\nå®è£ john the ripper\n\n\n\n\n\næ¥çå·²ç ´è§£åºçè´¦æ·åè¡¨\n\n\n\nä½¿ç¨å¯ç å­å¸æä»¶\n\næ¸ç©ºå·±ç ´è§£åºçè´¦æ·åè¡¨åéæ°åæ\n\n\n\n\n# 2ãç½ç»æ«æ âânmap\n\n# 1ãå®è£ nmap è½¯ä»¶å\n\n# yum -y install nmap\n\n\n1\n\n\n1\n\nåæ°    è¯´æ                                  åæ°    è¯´æ\n-p    æå®æ«æçç«¯å£                             -n    ç¦ç¨åå dns è§£æï¼ä»¥å å¿«æ«æéåº¦ï¼\n-ss   æ¥çç®æ ç«¯å£æ¯å¦æ­£å¨çå¬ï¼å¹¶ç«å³æ­å¼è¿æ¥ï¼å¦åè®¤ä¸ºç®æ ç«¯å£å¹¶æªå¼æ¾   -st   æ¥çç®æ ç«¯å£æ­£å¨çå¬æå¡ï¼å¦åè®¤ä¸ºç®æ ç«¯å£å¹¶æªå¼æ¾\n-sf   é´æ¥æ£æµé²ç«å¢çå¥å£®æ§                         -su   æ¢æµç®æ ä¸»æºæä¾åªäº udp æå¡\n-sp   å¿«éå¤æ­ç®æ ä¸»æºæ¯å¦å­æ´»                        -p0   è·³è¿ ping æ£æµ\n\næ«æå¸¸ç¨ç tcp ç«¯å£\n\n\n\næ«æå¸¸ç¨ç udp ç«¯å£\n\n\n\nä¾å¦ï¼\n\næ£æ¥ 192.168.4.0/24 ç½æ®µä¸­æåªäºä¸»æºæä¾ ftp æå¡ï¼nmap -p 21 192.168.4.0/24\n\næ£æµ 192.168.4.0/24 ç½æ®µä¸­æåªäºå­æ´»ä¸»æºï¼è½ ping é)ï¼nmap -n -sp 192.168.4.0/24\n\næ£æµ ip å°åä½äº 192.168.4.100-200 çä¸»æºæ¯å¦å¼å¯æä»¶å±äº«æå¡ï¼nmap -p 139ï¼445 192.168.4.100-200',charsets:{cjk:!0}},{title:"fastdfs",frontmatter:{title:"fastdfs",categories:"fastdfs",tags:["åå¸å¼æä»¶ç³»ç»"],date:"2022-12-09T20:47:55.000Z",permalink:"/pages/988870/",readingShow:"top",description:"ç®å½",meta:[{name:"image",content:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011144153840-1185141903.png"},{name:"twitter:title",content:"fastdfs"},{name:"twitter:description",content:"ç®å½"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011144153840-1185141903.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/06.%E5%AD%98%E5%82%A8/01.fastdfs.html"},{property:"og:type",content:"article"},{property:"og:title",content:"fastdfs"},{property:"og:description",content:"ç®å½"},{property:"og:image",content:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011144153840-1185141903.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/06.%E5%AD%98%E5%82%A8/01.fastdfs.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:47:55.000Z"},{property:"article:tag",content:"åå¸å¼æä»¶ç³»ç»"},{itemprop:"name",content:"fastdfs"},{itemprop:"description",content:"ç®å½"},{itemprop:"image",content:"https://images2017.cnblogs.com/blog/856154/201710/856154-20171011144153840-1185141903.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/06.%E5%AD%98%E5%82%A8/01.fastdfs.html",relativePath:"04.è¿ç»´/06.å­å¨/01.fastdfs.md",key:"v-477589d8",path:"/pages/988870/",headers:[{level:2,title:"ä¸ãFastDFSä»ç»",slug:"ä¸ãfastdfsä»ç»",normalizedTitle:"ä¸ãfastdfsä»ç»",charIndex:30},{level:3,title:"1ãç®ä»",slug:"_1ãç®ä»",normalizedTitle:"1ãç®ä»",charIndex:45},{level:3,title:"2ãFastDFSçå­å¨ç­ç¥",slug:"_2ãfastdfsçå­å¨ç­ç¥",normalizedTitle:"2ãfastdfsçå­å¨ç­ç¥",charIndex:53},{level:3,title:"3ãFastDFSçä¸ä¼ è¿ç¨",slug:"_3ãfastdfsçä¸ä¼ è¿ç¨",normalizedTitle:"3ãfastdfsçä¸ä¼ è¿ç¨",charIndex:71},{level:3,title:"4ãFastDFSçæä»¶åæ­¥",slug:"_4ãfastdfsçæä»¶åæ­¥",normalizedTitle:"4ãfastdfsçæä»¶åæ­¥",charIndex:89},{level:3,title:"5ãFastDFSçæä»¶ä¸è½½",slug:"_5ãfastdfsçæä»¶ä¸è½½",normalizedTitle:"5ãfastdfsçæä»¶ä¸è½½",charIndex:107},{level:2,title:"äºãå®è£FastDFSç¯å¢",slug:"äºãå®è£fastdfsç¯å¢",normalizedTitle:"äºãå®è£fastdfsç¯å¢",charIndex:125},{level:3,title:"0ãåè¨",slug:"_0ãåè¨",normalizedTitle:"0ãåè¨",charIndex:144},{level:3,title:"1ãä¸è½½å®è£ libfastcommon",slug:"_1ãä¸è½½å®è£-libfastcommon",normalizedTitle:"1ãä¸è½½å®è£ libfastcommon",charIndex:154},{level:3,title:"2ãä¸è½½å®è£FastDFS",slug:"_2ãä¸è½½å®è£fastdfs",normalizedTitle:"2ãä¸è½½å®è£fastdfs",charIndex:180},{level:3,title:"3ãéç½®FastDFSè·è¸ªå¨(Tracker)",slug:"_3ãéç½®fastdfsè·è¸ªå¨-tracker",normalizedTitle:"3ãéç½®fastdfsè·è¸ªå¨(tracker)",charIndex:199},{level:3,title:"4ãéç½® FastDFS å­å¨ (Storage)",slug:"_4ãéç½®-fastdfs-å­å¨-storage",normalizedTitle:"4ãéç½® fastdfs å­å¨ (storage)",charIndex:228},{level:3,title:"5ãæä»¶ä¸ä¼ æµè¯",slug:"_5ãæä»¶ä¸ä¼ æµè¯",normalizedTitle:"5ãæä»¶ä¸ä¼ æµè¯",charIndex:259},{level:2,title:"ä¸ãå®è£Nginx",slug:"ä¸ãå®è£nginx",normalizedTitle:"ä¸ãå®è£nginx",charIndex:271},{level:3,title:"1ãå®è£nginxæéç¯å¢",slug:"_1ãå®è£nginxæéç¯å¢",normalizedTitle:"1ãå®è£nginxæéç¯å¢",charIndex:286},{level:3,title:"2ãå®è£Nginx",slug:"_2ãå®è£nginx",normalizedTitle:"2ãå®è£nginx",charIndex:307},{level:3,title:"3ãè®¿é®æä»¶",slug:"_3ãè®¿é®æä»¶",normalizedTitle:"3ãè®¿é®æä»¶",charIndex:322},{level:2,title:"åãFastDFS éç½® Nginx æ¨¡å",slug:"åãfastdfs-éç½®-nginx-æ¨¡å",normalizedTitle:"åãfastdfs éç½® nginx æ¨¡å",charIndex:332},{level:3,title:"1ãå®è£éç½®Nginxæ¨¡å",slug:"_1ãå®è£éç½®nginxæ¨¡å",normalizedTitle:"1ãå®è£éç½®nginxæ¨¡å",charIndex:359},{level:2,title:"äºãJavaå®¢æ·ç«¯",slug:"äºãjavaå®¢æ·ç«¯",normalizedTitle:"äºãjavaå®¢æ·ç«¯",charIndex:376},{level:3,title:"1ãé¦åéè¦æ­å»º FastDFS å®¢æ·ç«¯Javaå¼åç¯å¢",slug:"_1ãé¦åéè¦æ­å»º-fastdfs-å®¢æ·ç«¯javaå¼åç¯å¢",normalizedTitle:"1ãé¦åéè¦æ­å»º fastdfs å®¢æ·ç«¯javaå¼åç¯å¢",charIndex:391},{level:3,title:"2ãå®¢æ·ç«¯API",slug:"_2ãå®¢æ·ç«¯api",normalizedTitle:"2ãå®¢æ·ç«¯api",charIndex:425},{level:3,title:"å­ãæéæ§å¶",slug:"å­ãæéæ§å¶",normalizedTitle:"å­ãæéæ§å¶",charIndex:439}],headersStr:"ä¸ãFastDFSä»ç» 1ãç®ä» 2ãFastDFSçå­å¨ç­ç¥ 3ãFastDFSçä¸ä¼ è¿ç¨ 4ãFastDFSçæä»¶åæ­¥ 5ãFastDFSçæä»¶ä¸è½½ äºãå®è£FastDFSç¯å¢ 0ãåè¨ 1ãä¸è½½å®è£ libfastcommon 2ãä¸è½½å®è£FastDFS 3ãéç½®FastDFSè·è¸ªå¨(Tracker) 4ãéç½® FastDFS å­å¨ (Storage) 5ãæä»¶ä¸ä¼ æµè¯ ä¸ãå®è£Nginx 1ãå®è£nginxæéç¯å¢ 2ãå®è£Nginx 3ãè®¿é®æä»¶ åãFastDFS éç½® Nginx æ¨¡å 1ãå®è£éç½®Nginxæ¨¡å äºãJavaå®¢æ·ç«¯ 1ãé¦åéè¦æ­å»º FastDFS å®¢æ·ç«¯Javaå¼åç¯å¢ 2ãå®¢æ·ç«¯API å­ãæéæ§å¶",content:'# ç¨FastDFSä¸æ­¥æ­¥æ­å»ºæä»¶ç®¡çç³»ç»\n\nç®å½\n\n * ä¸ãFastDFSä»ç»\n * 1ãç®ä»\n * 2ãFastDFSçå­å¨ç­ç¥\n * 3ãFastDFSçä¸ä¼ è¿ç¨\n * 4ãFastDFSçæä»¶åæ­¥\n * 5ãFastDFSçæä»¶ä¸è½½\n * äºãå®è£FastDFSç¯å¢\n   * 0ãåè¨\n   * 1ãä¸è½½å®è£ libfastcommon\n   * 2ãä¸è½½å®è£FastDFS\n   * 3ãéç½®FastDFSè·è¸ªå¨(Tracker)\n   * 4ãéç½® FastDFS å­å¨ (Storage)\n   * 5ãæä»¶ä¸ä¼ æµè¯\n * ä¸ãå®è£Nginx\n   * 1ãå®è£nginxæéç¯å¢ãã\n   * 2ãå®è£Nginx\n   * 3ãè®¿é®æä»¶\n * åãFastDFS éç½® Nginx æ¨¡å\n   * 1ãå®è£éç½®Nginxæ¨¡å\n * äºãJavaå®¢æ·ç«¯\n   * 1ãé¦åéè¦æ­å»º FastDFS å®¢æ·ç«¯Javaå¼åç¯å¢\n   * 2ãå®¢æ·ç«¯API\n   * å­ãæéæ§å¶\n\n----------------------------------------\n\nåå°é¡¶é¨\n\n\n# ä¸ãFastDFSä»ç»\n\nFastDFSå¼æºå°åï¼https://github.com/happyfish100\n\nåèï¼åå¸å¼æä»¶ç³»ç»FastDFSè®¾è®¡åç\n\nåèï¼FastDFSåå¸å¼æä»¶ç³»ç»\n\nä¸ªäººå°è£çFastDFS Java APIï¼https://github.com/bojiangzhou/lyyzoo-fastdfs-java\n\n\n# 1ãç®ä»\n\nFastDFS æ¯ä¸ä¸ªå¼æºçé«æ§è½åå¸å¼æä»¶ç³»ç»ï¼DFSï¼ã å®çä¸»è¦åè½åæ¬ï¼æä»¶å­å¨ï¼æä»¶åæ­¥åæä»¶è®¿é®ï¼ä»¥åé«å®¹éåè´è½½å¹³è¡¡ãä¸»è¦è§£å³äºæµ·éæ°æ®å­å¨é®é¢ï¼ç¹å«éåä»¥ä¸­å°æä»¶ï¼å»ºè®®èå´ï¼4KB < file_size <500MBï¼ä¸ºè½½ä½çå¨çº¿æå¡ã\n\nFastDFS ç³»ç»æä¸ä¸ªè§è²ï¼è·è¸ªæå¡å¨(Tracker Server)ãå­å¨æå¡å¨(Storage Server)åå®¢æ·ç«¯(Client)ã\n\nTracker Serverï¼è·è¸ªæå¡å¨ï¼ä¸»è¦åè°åº¦å·¥ä½ï¼èµ·å°åè¡¡çä½ç¨ï¼è´è´£ç®¡çææç storage serverå groupï¼æ¯ä¸ª storage å¨å¯å¨åä¼è¿æ¥ Trackerï¼åç¥èªå·±æå± group ç­ä¿¡æ¯ï¼å¹¶ä¿æå¨ææ§å¿è·³ã\n\nStorage Serverï¼å­å¨æå¡å¨ï¼ä¸»è¦æä¾å®¹éåå¤ä»½æå¡ï¼ä»¥ group ä¸ºåä½ï¼æ¯ä¸ª group åå¯ä»¥æå¤å° storage serverï¼æ°æ®äºä¸ºå¤ä»½ã\n\nClientï¼å®¢æ·ç«¯ï¼ä¸ä¼ ä¸è½½æ°æ®çæå¡å¨ï¼ä¹å°±æ¯æä»¬èªå·±çé¡¹ç®æé¨ç½²å¨çæå¡å¨ã\n\n\n\n\n# 2ãFastDFSçå­å¨ç­ç¥\n\nä¸ºäºæ¯æå¤§å®¹éï¼å­å¨èç¹ï¼æå¡å¨ï¼éç¨äºåå·ï¼æåç»ï¼çç»ç»æ¹å¼ãå­å¨ç³»ç»ç±ä¸ä¸ªæå¤ä¸ªå·ç»æï¼å·ä¸å·ä¹é´çæä»¶æ¯ç¸äºç¬ç«çï¼ææå·çæä»¶å®¹éç´¯å å°±æ¯æ´ä¸ªå­å¨ç³»ç»ä¸­çæä»¶å®¹éãä¸ä¸ªå·å¯ä»¥ç±ä¸å°æå¤å°å­å¨æå¡å¨ç»æï¼ä¸ä¸ªå·ä¸çå­å¨æå¡å¨ä¸­çæä»¶é½æ¯ç¸åçï¼å·ä¸­çå¤å°å­å¨æå¡å¨èµ·å°äºåä½å¤ä»½åè´è½½åè¡¡çä½ç¨ã\n\nå¨å·ä¸­å¢å æå¡å¨æ¶ï¼åæ­¥å·²æçæä»¶ç±ç³»ç»èªå¨å®æï¼åæ­¥å®æåï¼ç³»ç»èªå¨å°æ°å¢æå¡å¨åæ¢å°çº¿ä¸æä¾æå¡ãå½å­å¨ç©ºé´ä¸è¶³æå³å°èå°½æ¶ï¼å¯ä»¥å¨ææ·»å å·ãåªéè¦å¢å ä¸å°æå¤å°æå¡å¨ï¼å¹¶å°å®ä»¬éç½®ä¸ºä¸ä¸ªæ°çå·ï¼è¿æ ·å°±æ©å¤§äºå­å¨ç³»ç»çå®¹éã\n\n\n# 3ãFastDFSçä¸ä¼ è¿ç¨\n\nFastDFSåä½¿ç¨èæä¾åºæ¬æä»¶è®¿é®æ¥å£ï¼æ¯å¦uploadãdownloadãappendãdeleteç­ï¼ä»¥å®¢æ·ç«¯åºçæ¹å¼æä¾ç»ç¨æ·ä½¿ç¨ã\n\nStorage Serverä¼å®æçåTracker Serveråéèªå·±çå­å¨ä¿¡æ¯ãå½Tracker Server Clusterä¸­çTracker Serverä¸æ­¢ä¸ä¸ªæ¶ï¼åä¸ªTrackerä¹é´çå³ç³»æ¯å¯¹ç­çï¼æä»¥å®¢æ·ç«¯ä¸ä¼ æ¶å¯ä»¥éæ©ä»»æä¸ä¸ªTrackerã\n\nå½Trackeræ¶å°å®¢æ·ç«¯ä¸ä¼ æä»¶çè¯·æ±æ¶ï¼ä¼ä¸ºè¯¥æä»¶åéä¸ä¸ªå¯ä»¥å­å¨æä»¶çgroupï¼å½éå®äºgroupåå°±è¦å³å®ç»å®¢æ·ç«¯åégroupä¸­çåªä¸ä¸ªstorage serverãå½åéå¥½storage serveråï¼å®¢æ·ç«¯åstorageåéåæä»¶è¯·æ±ï¼storageå°ä¼ä¸ºæä»¶åéä¸ä¸ªæ°æ®å­å¨ç®å½ãç¶åä¸ºæä»¶åéä¸ä¸ªfileidï¼æåæ ¹æ®ä»¥ä¸çä¿¡æ¯çææä»¶åå­å¨æä»¶ã\n\n\n\n\n# 4ãFastDFSçæä»¶åæ­¥\n\nåæä»¶æ¶ï¼å®¢æ·ç«¯å°æä»¶åè³groupåä¸ä¸ªstorage serverå³è®¤ä¸ºåæä»¶æåï¼storage serveråå®æä»¶åï¼ä¼ç±åå°çº¿ç¨å°æä»¶åæ­¥è³ågroupåå¶ä»çstorage serverã\n\næ¯ä¸ªstorageåæä»¶åï¼åæ¶ä¼åä¸ä»½binlogï¼binlogéä¸åå«æä»¶æ°æ®ï¼åªåå«æä»¶åç­åä¿¡æ¯ï¼è¿ä»½binlogç¨äºåå°åæ­¥ï¼storageä¼è®°å½ågroupåå¶ä»storageåæ­¥çè¿åº¦ï¼ä»¥ä¾¿éå¯åè½æ¥ä¸æ¬¡çè¿åº¦ç»§ç»­åæ­¥ï¼è¿åº¦ä»¥æ¶é´æ³çæ¹å¼è¿è¡è®°å½ï¼æä»¥æå¥½è½ä¿è¯éç¾¤åææserverçæ¶éä¿æåæ­¥ã\n\nstorageçåæ­¥è¿åº¦ä¼ä½ä¸ºåæ°æ®çä¸é¨åæ±æ¥å°trackerä¸ï¼trackeå¨éæ©è¯»storageçæ¶åä¼ä»¥åæ­¥è¿åº¦ä½ä¸ºåèã\n\n\n# 5ãFastDFSçæä»¶ä¸è½½\n\nå®¢æ·ç«¯uploadfileæååï¼ä¼æ¿å°ä¸ä¸ªstorageçæçæä»¶åï¼æ¥ä¸æ¥å®¢æ·ç«¯æ ¹æ®è¿ä¸ªæä»¶åå³å¯è®¿é®å°è¯¥æä»¶ã\n\n\n\nè·upload fileä¸æ ·ï¼å¨downloadfileæ¶å®¢æ·ç«¯å¯ä»¥éæ©ä»»ætracker serverãtrackeråédownloadè¯·æ±ç»æä¸ªtrackerï¼å¿é¡»å¸¦ä¸æä»¶åä¿¡æ¯ï¼trackeä»æä»¶åä¸­è§£æåºæä»¶çgroupãå¤§å°ãåå»ºæ¶é´ç­ä¿¡æ¯ï¼ç¶åä¸ºè¯¥è¯·æ±éæ©ä¸ä¸ªstorageç¨æ¥æå¡è¯»è¯·æ±ã\n\nåå°é¡¶é¨\n\n\n# äºãå®è£FastDFSç¯å¢\n\n\n# 0ãåè¨\n\næä½ç¯å¢ï¼CentOS7 X64ï¼ä»¥ä¸æä½é½æ¯åæºç¯å¢ã\n\nææææçå®è£åä¸è½½å°/softpackages/ä¸ï¼è§£åå°å½åç®å½ã\n\nååä¸ä»¶äºï¼ä¿®æ¹hostsï¼å°æä»¶æå¡å¨çipä¸ååæ å°(åæºTrackerServerç¯å¢)ï¼å ä¸ºåé¢å¾å¤éç½®éé¢é½éè¦å»éç½®æå¡å¨å°åï¼ipåäºï¼å°±åªéè¦ä¿®æ¹hostså³å¯ã\n\n# vim /etc/hosts\n\nå¢å å¦ä¸ä¸è¡ï¼è¿æ¯æçIP\n192.168.51.128 file.ljzsg.com\n\nå¦æè¦æ¬æºè®¿é®èææºï¼å¨C:\\Windows\\System32\\drivers\\etc\\hostsä¸­åæ ·å¢å ä¸è¡\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 1ãä¸è½½å®è£ libfastcommon\n\nlibfastcommonæ¯ä» FastDFS å FastDHT ä¸­æååºæ¥çå¬å± C å½æ°åºï¼åºç¡ç¯å¢ï¼å®è£å³å¯ ã\n\nâ  ä¸è½½libfastcommon\n\n# wget https://github.com/happyfish100/libfastcommon/archive/V1.0.7.tar.gz\n\n\n1\n\n\nâ¡ è§£å\n\n# tar -zxvf V1.0.7.tar.gz\n# cd libfastcommon-1.0.7\n\n\n1\n2\n\n\nâ¢ ç¼è¯ãå®è£\n\n# ./make.sh\n# ./make.sh install\n\n\n1\n2\n\n\nâ£ libfastcommon.so å®è£å°äº/usr/lib64/libfastcommon.soï¼ä½æ¯FastDFSä¸»ç¨åºè®¾ç½®çlibç®å½æ¯/usr/local/libï¼æä»¥éè¦åå»ºè½¯é¾æ¥ã\n\n# ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so\n# ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so\n# ln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so\n# ln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so \n\n\n1\n2\n3\n4\n\n\n\n# 2ãä¸è½½å®è£FastDFS\n\nâ  ä¸è½½FastDFS\n\n# wget https://github.com/happyfish100/fastdfs/archive/V5.05.tar.gz\n\n\n1\n\n\nâ¡ è§£å\n\n# tar -zxvf V5.05.tar.gz\n# cd fastdfs-5.05\n\n\n1\n2\n\n\nâ¢ ç¼è¯ãå®è£\n\n# ./make.sh\n# ./make.sh install\n\n\n1\n2\n\n\nâ£ é»è®¤å®è£æ¹å¼å®è£åçç¸åºæä»¶ä¸ç®å½ ããAãæå¡èæ¬ï¼\n\n/etc/init.d/fdfs_storaged\n/etc/init.d/fdfs_tracker\n\n\n1\n2\n\n\nBãéç½®æä»¶ï¼è¿ä¸ä¸ªæ¯ä½èç»çæ ·ä¾éç½®æä»¶ï¼ :\n\n/etc/fdfs/client.conf.sample\n/etc/fdfs/storage.conf.sample\n/etc/fdfs/tracker.conf.sample\n\n\n1\n2\n3\n\n\nCãå½ä»¤å·¥å·å¨ /usr/bin/ ç®å½ä¸ï¼\n\n[](javascript:void(0)ð\n\nfdfs_appender_test\nfdfs_appender_test1\nfdfs_append_file\nfdfs_crc32\nfdfs_delete_file\nfdfs_download_file\nfdfs_file_info\nfdfs_monitor\nfdfs_storaged\nfdfs_test\nfdfs_test1\nfdfs_trackerd\nfdfs_upload_appender\nfdfs_upload_file\nstop.sh\nrestart.sh \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n[](javascript:void(0)ð\n\nâ¤ FastDFS æå¡èæ¬è®¾ç½®ç bin ç®å½æ¯ /usr/local/binï¼ ä½å®éå½ä»¤å®è£å¨ /usr/bin/ ä¸ã\n\nä¸¤ç§æ¹å¼ï¼\n\nã ä¸æ¯ä¿®æ¹FastDFS æå¡èæ¬ä¸­ç¸åºçå½ä»¤è·¯å¾ï¼ä¹å°±æ¯æ /etc/init.d/fdfs_storaged å /etc/init.d/fdfs_tracker ä¸¤ä¸ªèæ¬ä¸­ç /usr/local/bin ä¿®æ¹æ /usr/binã\n\n# vim fdfs_trackerd ããããä½¿ç¨æ¥æ¾æ¿æ¢å½ä»¤è¿ç»ä¸ä¿®æ¹:%s+/usr/local/bin+/usr/bin ãããã# vim fdfs_storaged ããããä½¿ç¨æ¥æ¾æ¿æ¢å½ä»¤è¿ç»ä¸ä¿®æ¹:%s+/usr/local/bin+/usr/bin\n\n\n\nã äºæ¯å»ºç« /usr/bin å° /usr/local/bin çè½¯é¾æ¥ï¼ææ¯ç¨è¿ç§æ¹å¼ã\n\n# ln -s /usr/bin/fdfs_trackerd   /usr/local/bin\n# ln -s /usr/bin/fdfs_storaged   /usr/local/bin\n# ln -s /usr/bin/stop.sh         /usr/local/bin\n# ln -s /usr/bin/restart.sh      /usr/local/bin\n\n\n1\n2\n3\n4\n\n\n\n# 3ãéç½®FastDFSè·è¸ªå¨(Tracker)\n\néç½®æä»¶è¯¦ç»è¯´æåèï¼FastDFS éç½®æä»¶è¯¦è§£\n\nâ  è¿å¥ /etc/fdfsï¼å¤å¶ FastDFS è·è¸ªå¨æ ·ä¾éç½®æä»¶ tracker.conf.sampleï¼å¹¶éå½åä¸º tracker.confã\n\n# cd /etc/fdfs\n# cp tracker.conf.sample tracker.conf\n# vim tracker.conf\n\n\n1\n2\n3\n\n\nâ¡ ç¼è¾tracker.conf ï¼æ çº¢çéè¦ä¿®æ¹ä¸ï¼å¶å®çé»è®¤å³å¯ã\n\n[](javascript:void(0)ð\n\n# éç½®æä»¶æ¯å¦ä¸çæï¼false ä¸ºçæ\ndisabled=false\n# æä¾æå¡çç«¯å£\nport=22122\n# Tracker æ°æ®åæ¥å¿ç®å½å°å(æ ¹ç®å½å¿é¡»å­å¨,å­ç®å½ä¼èªå¨åå»º)\nbase_path=/ljzsg/fastdfs/tracker\n# HTTP æå¡ç«¯å£\nhttp.server_port=80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n[](javascript:void(0)ð\n\nâ¢ åå»ºtrackeråºç¡æ°æ®ç®å½ï¼å³base_pathå¯¹åºçç®å½\n\n# mkdir -p /ljzsg/fastdfs/tracker\n\n\n1\n\n\nâ£ é²ç«å¢ä¸­æå¼è·è¸ªç«¯å£ï¼é»è®¤ç22122ï¼\n\n[](javascript:void(0)ð\n\n# vim /etc/sysconfig/iptables\næ·»å å¦ä¸ç«¯å£è¡ï¼\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 22122 -j ACCEPT\néå¯é²ç«å¢ï¼\n# service iptables restart\n\n\n1\n2\n3\n4\n5\n\n\n[](javascript:void(0)ð\n\nâ¤ å¯å¨Tracker\n\nåæ¬¡æåå¯å¨ï¼ä¼å¨ /ljzsg/fdfsdfs/tracker/ (éç½®çbase_path)ä¸åå»º dataãlogs ä¸¤ä¸ªç®å½ã\n\nå¯ä»¥ç¨è¿ç§æ¹å¼å¯å¨\n# /etc/init.d/fdfs_trackerd start\n\nä¹å¯ä»¥ç¨è¿ç§æ¹å¼å¯å¨ï¼åææ¯ä¸é¢åå»ºäºè½¯é¾æ¥ï¼åé¢é½ç¨è¿ç§æ¹å¼\n# service fdfs_trackerd start\n\n\n1\n2\n3\n4\n5\n\n\næ¥ç FastDFS Tracker æ¯å¦å·²æåå¯å¨ ï¼22122ç«¯å£æ­£å¨è¢«çå¬ï¼åç®æ¯Trackeræå¡å®è£æåã\n\n# netstat -unltp|grep fdfs\n\n\n1\n\n\n\n\nå³é­Trackerå½ä»¤ï¼\n\n# service fdfs_trackerd stop\n\n\n1\n\n\nâ¥ è®¾ç½®Trackerå¼æºå¯å¨\n\n# chkconfig fdfs_trackerd on\n\næèï¼\n# vim /etc/rc.d/rc.local\nå å¥éç½®ï¼\n/etc/init.d/fdfs_trackerd start \n\n\n1\n2\n3\n4\n5\n6\n\n\nâ¦ tracker server ç®å½åæä»¶ç»æ\n\nTrackeræå¡å¯å¨æååï¼ä¼å¨base_pathä¸åå»ºdataãlogsä¸¤ä¸ªç®å½ãç®å½ç»æå¦ä¸ï¼\n\n${base_path}\n  |__data\n  |   |__storage_groups.datï¼å­å¨åç»ä¿¡æ¯\n  |   |__storage_servers.datï¼å­å¨æå¡å¨åè¡¨\n  |__logs\n  |   |__trackerd.logï¼ tracker server æ¥å¿æä»¶ \n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 4ãéç½® FastDFS å­å¨ (Storage)\n\nâ  è¿å¥ /etc/fdfs ç®å½ï¼å¤å¶ FastDFS å­å¨å¨æ ·ä¾éç½®æä»¶ storage.conf.sampleï¼å¹¶éå½åä¸º storage.conf\n\n# cd /etc/fdfs\n# cp storage.conf.sample storage.conf# vim storage.conf\n\n\n1\n2\n\n\nâ¡ ç¼è¾storage.conf\n\næ çº¢çéè¦ä¿®æ¹ï¼å¶å®çé»è®¤å³å¯ã\n\n[](javascript:void(0)ð\n\n# éç½®æä»¶æ¯å¦ä¸çæï¼false ä¸ºçæ\ndisabled=false \n\n# æå®æ­¤ storage server æå¨ ç»(å·)\ngroup_name=group1\n\n# storage server æå¡ç«¯å£\nport=23000\n\n# å¿è·³é´éæ¶é´ï¼åä½ä¸ºç§ (è¿éæ¯æä¸»å¨å tracker server åéå¿è·³)\nheart_beat_interval=30\n\n# Storage æ°æ®åæ¥å¿ç®å½å°å(æ ¹ç®å½å¿é¡»å­å¨ï¼å­ç®å½ä¼èªå¨çæ)\nbase_path=/ljzsg/fastdfs/storage\n\n# å­æ¾æä»¶æ¶ storage server æ¯æå¤ä¸ªè·¯å¾ãè¿ééç½®å­æ¾æä»¶çåºè·¯å¾æ°ç®ï¼éå¸¸åªéä¸ä¸ªç®å½ã\nstore_path_count=1\n\n\n# éä¸éç½® store_path_count ä¸ªè·¯å¾ï¼ç´¢å¼å·åºäº 0ã\n# å¦æä¸éç½® store_path0ï¼é£å®å°±å base_path å¯¹åºçè·¯å¾ä¸æ ·ã\nstore_path0=/ljzsg/fastdfs/file\n\n# FastDFS å­å¨æä»¶æ¶ï¼éç¨äºä¸¤çº§ç®å½ãè¿ééç½®å­æ¾æä»¶çç®å½ä¸ªæ°ã \n# å¦ææ¬åæ°åªä¸º Nï¼å¦ï¼ 256ï¼ï¼é£ä¹ storage server å¨åæ¬¡è¿è¡æ¶ï¼ä¼å¨ store_path ä¸èªå¨åå»º N * N ä¸ªå­æ¾æä»¶çå­ç®å½ã\nsubdir_count_per_path=256\n\n# tracker_server çåè¡¨ ï¼ä¼ä¸»å¨è¿æ¥ tracker_server\n# æå¤ä¸ª tracker server æ¶ï¼æ¯ä¸ª tracker server åä¸è¡\ntracker_server=file.ljzsg.com:22122# åè®¸ç³»ç»åæ­¥çæ¶é´æ®µ (é»è®¤æ¯å¨å¤©) ãä¸è¬ç¨äºé¿åé«å³°åæ­¥äº§çä¸äºé®é¢èè®¾å®ãsync_start_time=00:00sync_end_time=23:59\n# è®¿é®ç«¯å£\nhttp.server_port=80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n[](javascript:void(0)ð\n\nâ¢ åå»ºStorageåºç¡æ°æ®ç®å½ï¼å¯¹åºbase_pathç®å½\n\n# mkdir -p /ljzsg/fastdfs/storage\n\n# è¿æ¯éç½®çstore_path0è·¯å¾\n# mkdir -p /ljzsg/fastdfs/file\n\n\n1\n2\n3\n4\n\n\nâ£ é²ç«å¢ä¸­æå¼å­å¨å¨ç«¯å£ï¼é»è®¤ç 23000ï¼\n\n[](javascript:void(0)ð\n\n# vim /etc/sysconfig/iptables\n\næ·»å å¦ä¸ç«¯å£è¡ï¼\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 23000 -j ACCEPT\n\néå¯é²ç«å¢ï¼\n# service iptables restart\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n[](javascript:void(0)ð\n\n\n\nâ¤ å¯å¨ Storage\n\nå¯å¨Storageåç¡®ä¿Trackeræ¯å¯å¨çãåæ¬¡å¯å¨æåï¼ä¼å¨ /ljzsg/fastdfs/storage ç®å½ä¸åå»º dataã logs ä¸¤ä¸ªç®å½ã\n\nå¯ä»¥ç¨è¿ç§æ¹å¼å¯å¨\n# /etc/init.d/fdfs_storaged start\n\nä¹å¯ä»¥ç¨è¿ç§æ¹å¼ï¼åé¢é½ç¨è¿ç§\n# service fdfs_storaged start\n\n\n1\n2\n3\n4\n5\n\n\næ¥ç Storage æ¯å¦æåå¯å¨ï¼23000 ç«¯å£æ­£å¨è¢«çå¬ï¼å°±ç® Storage å¯å¨æåã\n\n# netstat -unltp|grep fdfs\n\n\n1\n\n\n\n\nå³é­Storageå½ä»¤ï¼\n\n# service fdfs_storaged stop\n\n\n1\n\n\næ¥çStorageåTrackeræ¯å¦å¨éä¿¡ï¼\n\n/usr/bin/fdfs_monitor /etc/fdfs/storage.conf\n\n\n1\n\n\n\n\nâ¥ è®¾ç½® Storage å¼æºå¯å¨\n\n# chkconfig fdfs_storaged on\næèï¼\n# vim /etc/rc.d/rc.local\nå å¥éç½®ï¼\n/etc/init.d/fdfs_storaged start\n\n\n1\n2\n3\n4\n5\n\n\nâ¦ Storage ç®å½\n\nå Trackerï¼Storage å¯å¨æååï¼å¨base_path ä¸åå»ºäºdataãlogsç®å½ï¼è®°å½ç Storage Server çä¿¡æ¯ã\n\nå¨ store_path0 ç®å½ä¸ï¼åå»ºäºN*Nä¸ªå­ç®å½ï¼\n\n\n\n\n# 5ãæä»¶ä¸ä¼ æµè¯\n\nâ  ä¿®æ¹ Tracker æå¡å¨ä¸­çå®¢æ·ç«¯éç½®æä»¶\n\n# cd /etc/fdfs\n# cp client.conf.sample client.conf\n# vim client.conf\n\n\n1\n2\n3\n\n\nä¿®æ¹å¦ä¸éç½®å³å¯ï¼å¶å®é»è®¤ã\n\n# Client çæ°æ®åæ¥å¿ç®å½\nbase_path=/ljzsg/fastdfs/client\n\n# Trackerç«¯å£\ntracker_server=file.ljzsg.com:22122\n\n\n1\n2\n3\n4\n5\n\n\nâ¡ ä¸ä¼ æµè¯\n\nå¨linuxåé¨æ§è¡å¦ä¸å½ä»¤ä¸ä¼  namei.jpeg å¾ç\n\n# /usr/bin/fdfs_upload_file /etc/fdfs/client.conf namei.jpeg\n\n\n1\n\n\nä¸ä¼ æååè¿åæä»¶IDå·ï¼group1/M00/00/00/wKgz6lnduTeAMdrcAAEoRmXZPp870.jpeg\n\n\n\nè¿åçæä»¶IDç±groupãå­å¨ç®å½ãä¸¤çº§å­ç®å½ãfileidãæä»¶åç¼åï¼ç±å®¢æ·ç«¯æå®ï¼ä¸»è¦ç¨äºåºåæä»¶ç±»åï¼æ¼æ¥èæã\n\n\n\nåå°é¡¶é¨\n\n\n# ä¸ãå®è£Nginx\n\nä¸é¢å°æä»¶ä¸ä¼ æåäºï¼ä½æä»¬æ æ³ä¸è½½ãå æ­¤å®è£Nginxä½ä¸ºæå¡å¨ä»¥æ¯æHttpæ¹å¼è®¿é®æä»¶ãåæ¶ï¼åé¢å®è£FastDFSçNginxæ¨¡åä¹éè¦Nginxç¯å¢ã\n\nNginxåªéè¦å®è£å°StorageServeræå¨çæå¡å¨å³å¯ï¼ç¨äºè®¿é®æä»¶ãæè¿éç±äºæ¯åæºï¼TrackerServeråStorageServerå¨ä¸å°æå¡å¨ä¸ã\n\n\n# 1ãå®è£nginxæéç¯å¢\n\nâ  gcc å®è£\n\n# yum install gcc-c++\n\n\n1\n\n\nâ¡ PCRE pcre-devel å®è£\n\n# yum install -y pcre pcre-devel\n\n\n1\n\n\nâ¢ zlib å®è£\n\n# yum install -y zlib zlib-devel\n\n\n1\n\n\nâ£ OpenSSL å®è£\n\n# yum install -y openssl openssl-devel\n\n\n1\n\n\n\n# 2ãå®è£Nginx\n\nâ  ä¸è½½nginx\n\n# wget -c https://nginx.org/download/nginx-1.12.1.tar.gz\n\n\n1\n\n\nâ¡ è§£å\n\n# tar -zxvf nginx-1.12.1.tar.gz\n# cd nginx-1.12.1\n\n\n1\n2\n\n\nâ¢ ä½¿ç¨é»è®¤éç½®\n\n# ./configure\n\n\n1\n\n\nâ£ ç¼è¯ãå®è£\n\n# make\n# make install\n\n\n1\n2\n\n\nâ¤ å¯å¨nginx\n\n[](javascript:void(0)ð\n\n# cd /usr/local/nginx/sbin/\n# ./nginx \n\nå¶å®å½ä»¤\n# ./nginx -s stop\n# ./nginx -s quit\n# ./nginx -s reload\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n[](javascript:void(0)ð\n\nâ¥ è®¾ç½®å¼æºå¯å¨\n\n[](javascript:void(0)ð\n\n# vim /etc/rc.local\n\næ·»å ä¸è¡ï¼\n/usr/local/nginx/sbin/nginx# è®¾ç½®æ§è¡æé# chmod 755 rc.local\n\n\n1\n2\n3\n4\n\n\n[](javascript:void(0)ð\n\nâ¦ æ¥çnginxççæ¬åæ¨¡å\n\n/usr/local/nginx/sbin/nginx -V\n\n\n1\n\n\n\n\nâ§ é²ç«å¢ä¸­æå¼Nginxç«¯å£ï¼é»è®¤ç 80ï¼\n\næ·»å åå°±è½å¨æ¬æºä½¿ç¨80ç«¯å£è®¿é®äºã\n\n[](javascript:void(0)ð\n\n# vim /etc/sysconfig/iptables\n\næ·»å å¦ä¸ç«¯å£è¡ï¼\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT\n\néå¯é²ç«å¢ï¼\n# service iptables restart\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n[](javascript:void(0)ð\n\n\n\n\n# 3ãè®¿é®æä»¶\n\nç®åçæµè¯è®¿é®æä»¶\n\nâ  ä¿®æ¹nginx.conf\n\n[](javascript:void(0)ð\n\n# vim /usr/local/nginx/conf/nginx.conf\n\næ·»å å¦ä¸è¡ï¼å° /group1/M00 æ å°å° /ljzsg/fastdfs/file/data\nlocation /group1/M00 {\n    alias /ljzsg/fastdfs/file/data;\n}# éå¯nginx# /usr/local/nginx/sbin/nginx -s reload\n\n\n1\n2\n3\n4\n5\n6\n\n\n[](javascript:void(0)ð\n\n\n\nâ¡ å¨æµè§å¨è®¿é®ä¹åä¸ä¼ çå¾çãæåã\n\nhttp://file.ljzsg.com/group1/M00/00/00/wKgz6lnduTeAMdrcAAEoRmXZPp870.jpeg\n\nåå°é¡¶é¨\n\n\n# åãFastDFS éç½® Nginx æ¨¡å\n\n\n# 1ãå®è£éç½®Nginxæ¨¡å\n\nâ  fastdfs-nginx-module æ¨¡åè¯´æ\n\nFastDFS éè¿ Tracker æå¡å¨ï¼å°æä»¶æ¾å¨ Storage æå¡å¨å­å¨ï¼ ä½æ¯åç»å­å¨æå¡å¨ä¹é´éè¦è¿è¡æä»¶å¤å¶ï¼ æåæ­¥å»¶è¿çé®é¢ã\n\nåè®¾ Tracker æå¡å¨å°æä»¶ä¸ä¼ å°äº 192.168.51.128ï¼ä¸ä¼ æååæä»¶ IDå·²ç»è¿åç»å®¢æ·ç«¯ã\n\næ­¤æ¶ FastDFS å­å¨éç¾¤æºå¶ä¼å°è¿ä¸ªæä»¶åæ­¥å°åç»å­å¨ 192.168.51.129ï¼å¨æä»¶è¿æ²¡æå¤å¶å®æçæåµä¸ï¼å®¢æ·ç«¯å¦æç¨è¿ä¸ªæä»¶ ID å¨ 192.168.51.129 ä¸åæä»¶,å°±ä¼åºç°æä»¶æ æ³è®¿é®çéè¯¯ã\n\nè fastdfs-nginx-module å¯ä»¥éå®åæä»¶é¾æ¥å°æºæå¡å¨åæä»¶ï¼é¿åå®¢æ·ç«¯ç±äºå¤å¶å»¶è¿å¯¼è´çæä»¶æ æ³è®¿é®éè¯¯ã\n\nâ¡ ä¸è½½ fastdfs-nginx-moduleãè§£å\n\n[](javascript:void(0)ð\n\n# è¿éä¸ºå¥è¿ä¹é¿ä¸ä¸²å¢ï¼å ä¸ºææ°ççmasterä¸å½ånginxæäºçæ¬é®é¢ã\n# wget https://github.com/happyfish100/fastdfs-nginx-module/archive/5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip\n\n# è§£å\n# unzip 5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip\n\n# éå½å\n# mv fastdfs-nginx-module-5e5f3566bbfa57418b5506aaefbe107a42c9fcb1  fastdfs-nginx-module-master\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n[](javascript:void(0)ð\n\nâ¢ éç½®Nginx\n\nå¨nginxä¸­æ·»å æ¨¡å\n\n[](javascript:void(0)ð\n\n# ååænginxæå¡# /usr/local/nginx/sbin/nginx -s stopè¿å¥è§£ååç®å½\n# cd /softpackages/nginx-1.12.1/\n\n# æ·»å æ¨¡å\n# ./configure --add-module=../fastdfs-nginx-module-master/src\n\néæ°ç¼è¯ãå®è£\n# make && make install\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n[](javascript:void(0)ð\n\nâ£ æ¥çNginxçæ¨¡å\n\n# /usr/local/nginx/sbin/nginx -V\n\n\n1\n\n\næä¸é¢è¿ä¸ªå°±è¯´ææ·»å æ¨¡åæå\n\n\n\nâ¤ å¤å¶ fastdfs-nginx-module æºç ä¸­çéç½®æä»¶å°/etc/fdfs ç®å½ï¼ å¹¶ä¿®æ¹\n\n# cd /softpackages/fastdfs-nginx-module-master/src\n\n# cp mod_fastdfs.conf /etc/fdfs/\n\n\n1\n2\n3\n\n\nä¿®æ¹å¦ä¸éç½®ï¼å¶å®é»è®¤\n\n[](javascript:void(0)ð\n\n# è¿æ¥è¶æ¶æ¶é´connect_timeout=10\n\n# Tracker Server\ntracker_server=file.ljzsg.com:22122\n# StorageServer é»è®¤ç«¯å£\nstorage_server_port=23000\n\n# å¦ææä»¶IDçuriä¸­åå«/group**ï¼åè¦è®¾ç½®ä¸ºtrue\nurl_have_group_name = true\n\n# Storage éç½®çstore_path0è·¯å¾ï¼å¿é¡»åstorage.confä¸­çä¸è´\nstore_path0=/ljzsg/fastdfs/file\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n[](javascript:void(0)ð\n\nâ¥ å¤å¶ FastDFS çé¨åéç½®æä»¶å°/etc/fdfs ç®å½\n\n# cd /softpackages/fastdfs-5.05/conf/\n\n# cp anti-steal.jpg http.conf mime.types /etc/fdfs/\n\n\n1\n2\n3\n\n\nâ¦ éç½®nginxï¼ä¿®æ¹nginx.conf\n\n# vim /usr/local/nginx/conf/nginx.conf\n\n\n1\n\n\nä¿®æ¹éç½®ï¼å¶å®çé»è®¤\n\nå¨80ç«¯å£ä¸æ·»å fastdfs-nginxæ¨¡å\n\nlocation ~/group([0-9])/M00 {\n    ngx_fastdfs_module;\n}\n\n\n1\n2\n3\n\n\n\n\næ³¨æï¼\n\nlisten 80 ç«¯å£å¼æ¯è¦ä¸ /etc/fdfs/storage.conf ä¸­ç http.server_port=80 (åé¢æ¹æ80äº)ç¸å¯¹åºãå¦ææ¹æå¶å®ç«¯å£ï¼åéè¦ç»ä¸ï¼åæ¶å¨é²ç«å¢ä¸­æå¼è¯¥ç«¯å£ã\n\nlocation çéç½®ï¼å¦ææå¤ä¸ªgroupåéç½®location ~/group([0-9])/M00 ï¼æ²¡æåä¸ç¨égroupã\n\nâ§ å¨/ljzsg/fastdfs/file æä»¶å­å¨ç®å½ä¸åå»ºè½¯è¿æ¥ï¼å°å¶é¾æ¥å°å®éå­æ¾æ°æ®çç®å½ï¼è¿ä¸æ­¥å¯ä»¥çç¥ã\n\n# ln -s /ljzsg/fastdfs/file/data/ /ljzsg/fastdfs/file/data/M00 \n\n\n1\n\n\nâ¨ å¯å¨nginx\n\n# /usr/local/nginx/sbin/nginx\n\n\n1\n\n\næå°å¤å¦ä¸å°±ç®éç½®æå\n\n\n\nâ© å¨å°åæ è®¿é®ã\n\nè½ä¸è½½æä»¶å°±ç®å®è£æåãæ³¨æåç¬¬ä¸ç¹ä¸­ç´æ¥ä½¿ç¨nginxè·¯ç±è®¿é®ä¸åçæ¯ï¼è¿ééç½® fastdfs-nginx-module æ¨¡åï¼å¯ä»¥éå®åæä»¶é¾æ¥å°æºæå¡å¨åæä»¶ã\n\nhttp://file.ljzsg.com/group1/M00/00/00/wKgz6lnduTeAMdrcAAEoRmXZPp870.jpeg\n\næç»é¨ç½²ç»æå¾(ççå¾)ï¼å¯ä»¥æç§ä¸é¢çç»ææ­å»ºç¯å¢ã\n\n\n\nåå°é¡¶é¨\n\n\n# äºãJavaå®¢æ·ç«¯\n\nåé¢æä»¶ç³»ç»å¹³å°æ­å»ºå¥½äºï¼ç°å¨å°±è¦åå®¢æ·ç«¯ä»£ç å¨ç³»ç»ä¸­å®ç°ä¸ä¼ ä¸è½½ï¼è¿éåªæ¯ç®åçæµè¯ä»£ç ã\n\n\n# 1ãé¦åéè¦æ­å»º FastDFS å®¢æ·ç«¯Javaå¼åç¯å¢\n\nâ  é¡¹ç®ä¸­ä½¿ç¨mavenè¿è¡ä¾èµç®¡çï¼å¯ä»¥å¨pom.xmlä¸­å¼å¥å¦ä¸ä¾èµå³å¯ï¼\n\n<dependency>\n   <groupId>net.oschina.zcx7878</groupId>\n   <artifactId>fastdfs-client-java</artifactId>\n   <version>1.27.0.0</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\nå¶å®çæ¹å¼ï¼åèå®æ¹ææ¡£ï¼https://github.com/happyfish100/fastdfs-client-java\n\nâ¡ å¼å¥éç½®æä»¶\n\nå¯ç´æ¥å¤å¶åä¸ç fastdfs-client.properties.sample æè fdfs_client.conf.sampleï¼å°ä½ çé¡¹ç®ä¸­ï¼å»æ.sampleã\n\n\n\næè¿éç´æ¥å¤å¶ fastdfs-client.properties.sample ä¸­çéç½®å°é¡¹ç®éç½®æä»¶ config.properties ä¸­ï¼ä¿®æ¹tracker_serversãåªéè¦å è½½è¿ä¸ªéç½®æä»¶å³å¯\n\n\n\n\n# 2ãå®¢æ·ç«¯API\n\nä¸ªäººå°è£çFastDFS Java APIä»¥åæ­¥å°githubï¼https://github.com/bojiangzhou/lyyzoo-fastdfs-java.git\n\n\n# å­ãæéæ§å¶\n\nåé¢ä½¿ç¨nginxæ¯æhttpæ¹å¼è®¿é®æä»¶ï¼ä½ææäººé½è½ç´æ¥è®¿é®è¿ä¸ªæä»¶æå¡å¨äºï¼æä»¥åä¸ä¸æéæ§å¶ã\n\nFastDFSçæéæ§å¶æ¯å¨æå¡ç«¯å¼å¯tokenéªè¯ï¼å®¢æ·ç«¯æ ¹æ®æä»¶åãå½åunixæ¶é´æ³ãç§é¥è·åtokenï¼å¨å°åä¸­å¸¦ä¸tokenåæ°å³å¯éè¿httpæ¹å¼è®¿é®æä»¶ã\n\nâ  æå¡ç«¯å¼å¯tokenéªè¯\n\n[](javascript:void(0)ð\n\nä¿®æ¹http.conf\n# vim /etc/fdfs/http.conf\n\nè®¾ç½®ä¸ºtrueè¡¨ç¤ºå¼å¯tokenéªè¯\nhttp.anti_steal.check_token=trueè®¾ç½®tokenå¤±æçæ¶é´åä½ä¸ºç§(s)http.anti_steal.token_ttl=1800\nå¯é¥ï¼è·å®¢æ·ç«¯éç½®æä»¶çfastdfs.http_secret_keyä¿æä¸è´\nhttp.anti_steal.secret_key=FASTDFS1234567890\n\nå¦ætokenæ£æ¥å¤±è´¥ï¼è¿åçé¡µé¢\nhttp.anti_steal.token_check_fail=/ljzsg/fastdfs/page/403.html\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n[](javascript:void(0)ð\n\nè®°å¾éå¯æå¡ã\n\nâ¡ éç½®å®¢æ·ç«¯\n\nå®¢æ·ç«¯åªéè¦è®¾ç½®å¦ä¸ä¸¤ä¸ªåæ°å³å¯ï¼ä¸¤è¾¹çå¯é¥ä¿æä¸è´ã\n\n# token é²çé¾åè½\nfastdfs.http_anti_steal_token=true\n# å¯é¥\nfastdfs.http_secret_key=FASTDFS1234567890\n\n\n1\n2\n3\n4\n\n\nâ¢ å®¢æ·ç«¯çætoken\n\nè®¿é®æä»¶éè¦å¸¦ä¸çæçtokenä»¥åunixæ¶é´æ³ï¼æä»¥è¿åçtokenæ¯tokenåæ¶é´æ³çæ¼æ¥ã\n\nä¹åï¼å°tokenæ¼æ¥å¨å°ååå³å¯è®¿é®ï¼file.ljzsg.com/group1/M00/00/00/wKgzgFnkaXqAIfXyAAEoRmXZPp878.jpeg?token=078d370098b03e9020b82c829c205e1f&ts=1508141521\n\n[](javascript:void(0)ð\n\n 1     /**\n 2      * è·åè®¿é®æå¡å¨çtokenï¼æ¼æ¥å°å°ååé¢\n 3      *\n 4      * @param filepath æä»¶è·¯å¾ group1/M00/00/00/wKgzgFnkTPyAIAUGAAEoRmXZPp876.jpeg\n 5      * @param httpSecretKey å¯é¥\n 6      * @return è¿åtokenï¼å¦ï¼ token=078d370098b03e9020b82c829c205e1f&ts=1508141521\n 7      */\n 8     public static String getToken(String filepath, String httpSecretKey){\n 9         // unix seconds\n10         int ts = (int) Instant.now().getEpochSecond();\n11         // token\n12         String token = "null";\n13         try {\n14             token = ProtoCommon.getToken(getFilename(filepath), ts, httpSecretKey);\n15         } catch (UnsupportedEncodingException e) {\n16             e.printStackTrace();\n17         } catch (NoSuchAlgorithmException e) {\n18             e.printStackTrace();\n19         } catch (MyException e) {\n20             e.printStackTrace();\n21         }\n22 \n23         StringBuilder sb = new StringBuilder();\n24         sb.append("token=").append(token);\n25         sb.append("&ts=").append(ts);\n26 \n27         return sb.toString();\n28     }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n[](javascript:void(0)ð\n\nâ£ æ³¨æäºé¡¹\n\nå¦æçæçtokenéªè¯æ æ³éè¿ï¼è¯·è¿è¡å¦ä¸ä¸¤é¡¹æ£æ¥ï¼ ããA. ç¡®è®¤è°ç¨tokençæå½æ°(ProtoCommon.getToken)ï¼ä¼ éçæä»¶IDä¸­æ²¡æåå«group nameãä¼ éçæä»¶IDæ ¼å¼å½¢å¦ï¼M00/00/00/wKgzgFnkTPyAIAUGAAEoRmXZPp876.jpeg\n\nB. ç¡®è®¤æå¡å¨æ¶é´åºæ¬æ¯ä¸è´çï¼æ³¨ææå¡å¨æ¶é´ä¸è½ç¸å·®å¤ªå¤ï¼ä¸è¦ç¸å·®å°åéçº§å«ã\n\nâ¤ å¯¹æ¯ä¸åç°ï¼å¦æç³»ç»æä»¶éç§æ§è¾é«ï¼å¯ä»¥ç´æ¥éè¿fastdfs-clientæä¾çAPIå»è®¿é®å³å¯ï¼ä¸ç¨åéç½®Nginxèµ°httpè®¿é®ãéç½®Nginxçä¸»è¦ç®çæ¯ä¸ºäºå¿«éè®¿é®æå¡å¨çæä»¶(å¦å¾ç)ï¼å¦æè¿è¦å æééªè¯ï¼åéè¦å®¢æ·ç«¯çætokenï¼å¶å®å·²ç»æ²¡æå¤å¤§æä¹ã\n\nå³é®æ¯ï¼è¿éææ²¡æ¾å°FastDFSå¦ä½å¯¹é¨åèµæºå tokenéªè¯ï¼é¨åå¼æ¾ãæç¥éçè¿è¯·çè¨ã\n\n----------------------------------------\n\nOKï¼ä»¥ä¸å°±æ¯åæºä¸­ä½¿ç¨FastDFSæ­å»ºæä»¶ç³»ç»å¹¶ä¸ä¼ ä¸è½½çè¿ç¨ã\n\nå®ï¼ï¼ï¼\n\nåæé¾æ¥ï¼https://www.cnblogs.com/chiangchou/p/fastdfs.html',normalizedContent:'# ç¨fastdfsä¸æ­¥æ­¥æ­å»ºæä»¶ç®¡çç³»ç»\n\nç®å½\n\n * ä¸ãfastdfsä»ç»\n * 1ãç®ä»\n * 2ãfastdfsçå­å¨ç­ç¥\n * 3ãfastdfsçä¸ä¼ è¿ç¨\n * 4ãfastdfsçæä»¶åæ­¥\n * 5ãfastdfsçæä»¶ä¸è½½\n * äºãå®è£fastdfsç¯å¢\n   * 0ãåè¨\n   * 1ãä¸è½½å®è£ libfastcommon\n   * 2ãä¸è½½å®è£fastdfs\n   * 3ãéç½®fastdfsè·è¸ªå¨(tracker)\n   * 4ãéç½® fastdfs å­å¨ (storage)\n   * 5ãæä»¶ä¸ä¼ æµè¯\n * ä¸ãå®è£nginx\n   * 1ãå®è£nginxæéç¯å¢ãã\n   * 2ãå®è£nginx\n   * 3ãè®¿é®æä»¶\n * åãfastdfs éç½® nginx æ¨¡å\n   * 1ãå®è£éç½®nginxæ¨¡å\n * äºãjavaå®¢æ·ç«¯\n   * 1ãé¦åéè¦æ­å»º fastdfs å®¢æ·ç«¯javaå¼åç¯å¢\n   * 2ãå®¢æ·ç«¯api\n   * å­ãæéæ§å¶\n\n----------------------------------------\n\nåå°é¡¶é¨\n\n\n# ä¸ãfastdfsä»ç»\n\nfastdfså¼æºå°åï¼https://github.com/happyfish100\n\nåèï¼åå¸å¼æä»¶ç³»ç»fastdfsè®¾è®¡åç\n\nåèï¼fastdfsåå¸å¼æä»¶ç³»ç»\n\nä¸ªäººå°è£çfastdfs java apiï¼https://github.com/bojiangzhou/lyyzoo-fastdfs-java\n\n\n# 1ãç®ä»\n\nfastdfs æ¯ä¸ä¸ªå¼æºçé«æ§è½åå¸å¼æä»¶ç³»ç»ï¼dfsï¼ã å®çä¸»è¦åè½åæ¬ï¼æä»¶å­å¨ï¼æä»¶åæ­¥åæä»¶è®¿é®ï¼ä»¥åé«å®¹éåè´è½½å¹³è¡¡ãä¸»è¦è§£å³äºæµ·éæ°æ®å­å¨é®é¢ï¼ç¹å«éåä»¥ä¸­å°æä»¶ï¼å»ºè®®èå´ï¼4kb < file_size <500mbï¼ä¸ºè½½ä½çå¨çº¿æå¡ã\n\nfastdfs ç³»ç»æä¸ä¸ªè§è²ï¼è·è¸ªæå¡å¨(tracker server)ãå­å¨æå¡å¨(storage server)åå®¢æ·ç«¯(client)ã\n\ntracker serverï¼è·è¸ªæå¡å¨ï¼ä¸»è¦åè°åº¦å·¥ä½ï¼èµ·å°åè¡¡çä½ç¨ï¼è´è´£ç®¡çææç storage serverå groupï¼æ¯ä¸ª storage å¨å¯å¨åä¼è¿æ¥ trackerï¼åç¥èªå·±æå± group ç­ä¿¡æ¯ï¼å¹¶ä¿æå¨ææ§å¿è·³ã\n\nstorage serverï¼å­å¨æå¡å¨ï¼ä¸»è¦æä¾å®¹éåå¤ä»½æå¡ï¼ä»¥ group ä¸ºåä½ï¼æ¯ä¸ª group åå¯ä»¥æå¤å° storage serverï¼æ°æ®äºä¸ºå¤ä»½ã\n\nclientï¼å®¢æ·ç«¯ï¼ä¸ä¼ ä¸è½½æ°æ®çæå¡å¨ï¼ä¹å°±æ¯æä»¬èªå·±çé¡¹ç®æé¨ç½²å¨çæå¡å¨ã\n\n\n\n\n# 2ãfastdfsçå­å¨ç­ç¥\n\nä¸ºäºæ¯æå¤§å®¹éï¼å­å¨èç¹ï¼æå¡å¨ï¼éç¨äºåå·ï¼æåç»ï¼çç»ç»æ¹å¼ãå­å¨ç³»ç»ç±ä¸ä¸ªæå¤ä¸ªå·ç»æï¼å·ä¸å·ä¹é´çæä»¶æ¯ç¸äºç¬ç«çï¼ææå·çæä»¶å®¹éç´¯å å°±æ¯æ´ä¸ªå­å¨ç³»ç»ä¸­çæä»¶å®¹éãä¸ä¸ªå·å¯ä»¥ç±ä¸å°æå¤å°å­å¨æå¡å¨ç»æï¼ä¸ä¸ªå·ä¸çå­å¨æå¡å¨ä¸­çæä»¶é½æ¯ç¸åçï¼å·ä¸­çå¤å°å­å¨æå¡å¨èµ·å°äºåä½å¤ä»½åè´è½½åè¡¡çä½ç¨ã\n\nå¨å·ä¸­å¢å æå¡å¨æ¶ï¼åæ­¥å·²æçæä»¶ç±ç³»ç»èªå¨å®æï¼åæ­¥å®æåï¼ç³»ç»èªå¨å°æ°å¢æå¡å¨åæ¢å°çº¿ä¸æä¾æå¡ãå½å­å¨ç©ºé´ä¸è¶³æå³å°èå°½æ¶ï¼å¯ä»¥å¨ææ·»å å·ãåªéè¦å¢å ä¸å°æå¤å°æå¡å¨ï¼å¹¶å°å®ä»¬éç½®ä¸ºä¸ä¸ªæ°çå·ï¼è¿æ ·å°±æ©å¤§äºå­å¨ç³»ç»çå®¹éã\n\n\n# 3ãfastdfsçä¸ä¼ è¿ç¨\n\nfastdfsåä½¿ç¨èæä¾åºæ¬æä»¶è®¿é®æ¥å£ï¼æ¯å¦uploadãdownloadãappendãdeleteç­ï¼ä»¥å®¢æ·ç«¯åºçæ¹å¼æä¾ç»ç¨æ·ä½¿ç¨ã\n\nstorage serverä¼å®æçåtracker serveråéèªå·±çå­å¨ä¿¡æ¯ãå½tracker server clusterä¸­çtracker serverä¸æ­¢ä¸ä¸ªæ¶ï¼åä¸ªtrackerä¹é´çå³ç³»æ¯å¯¹ç­çï¼æä»¥å®¢æ·ç«¯ä¸ä¼ æ¶å¯ä»¥éæ©ä»»æä¸ä¸ªtrackerã\n\nå½trackeræ¶å°å®¢æ·ç«¯ä¸ä¼ æä»¶çè¯·æ±æ¶ï¼ä¼ä¸ºè¯¥æä»¶åéä¸ä¸ªå¯ä»¥å­å¨æä»¶çgroupï¼å½éå®äºgroupåå°±è¦å³å®ç»å®¢æ·ç«¯åégroupä¸­çåªä¸ä¸ªstorage serverãå½åéå¥½storage serveråï¼å®¢æ·ç«¯åstorageåéåæä»¶è¯·æ±ï¼storageå°ä¼ä¸ºæä»¶åéä¸ä¸ªæ°æ®å­å¨ç®å½ãç¶åä¸ºæä»¶åéä¸ä¸ªfileidï¼æåæ ¹æ®ä»¥ä¸çä¿¡æ¯çææä»¶åå­å¨æä»¶ã\n\n\n\n\n# 4ãfastdfsçæä»¶åæ­¥\n\nåæä»¶æ¶ï¼å®¢æ·ç«¯å°æä»¶åè³groupåä¸ä¸ªstorage serverå³è®¤ä¸ºåæä»¶æåï¼storage serveråå®æä»¶åï¼ä¼ç±åå°çº¿ç¨å°æä»¶åæ­¥è³ågroupåå¶ä»çstorage serverã\n\næ¯ä¸ªstorageåæä»¶åï¼åæ¶ä¼åä¸ä»½binlogï¼binlogéä¸åå«æä»¶æ°æ®ï¼åªåå«æä»¶åç­åä¿¡æ¯ï¼è¿ä»½binlogç¨äºåå°åæ­¥ï¼storageä¼è®°å½ågroupåå¶ä»storageåæ­¥çè¿åº¦ï¼ä»¥ä¾¿éå¯åè½æ¥ä¸æ¬¡çè¿åº¦ç»§ç»­åæ­¥ï¼è¿åº¦ä»¥æ¶é´æ³çæ¹å¼è¿è¡è®°å½ï¼æä»¥æå¥½è½ä¿è¯éç¾¤åææserverçæ¶éä¿æåæ­¥ã\n\nstorageçåæ­¥è¿åº¦ä¼ä½ä¸ºåæ°æ®çä¸é¨åæ±æ¥å°trackerä¸ï¼trackeå¨éæ©è¯»storageçæ¶åä¼ä»¥åæ­¥è¿åº¦ä½ä¸ºåèã\n\n\n# 5ãfastdfsçæä»¶ä¸è½½\n\nå®¢æ·ç«¯uploadfileæååï¼ä¼æ¿å°ä¸ä¸ªstorageçæçæä»¶åï¼æ¥ä¸æ¥å®¢æ·ç«¯æ ¹æ®è¿ä¸ªæä»¶åå³å¯è®¿é®å°è¯¥æä»¶ã\n\n\n\nè·upload fileä¸æ ·ï¼å¨downloadfileæ¶å®¢æ·ç«¯å¯ä»¥éæ©ä»»ætracker serverãtrackeråédownloadè¯·æ±ç»æä¸ªtrackerï¼å¿é¡»å¸¦ä¸æä»¶åä¿¡æ¯ï¼trackeä»æä»¶åä¸­è§£æåºæä»¶çgroupãå¤§å°ãåå»ºæ¶é´ç­ä¿¡æ¯ï¼ç¶åä¸ºè¯¥è¯·æ±éæ©ä¸ä¸ªstorageç¨æ¥æå¡è¯»è¯·æ±ã\n\nåå°é¡¶é¨\n\n\n# äºãå®è£fastdfsç¯å¢\n\n\n# 0ãåè¨\n\næä½ç¯å¢ï¼centos7 x64ï¼ä»¥ä¸æä½é½æ¯åæºç¯å¢ã\n\nææææçå®è£åä¸è½½å°/softpackages/ä¸ï¼è§£åå°å½åç®å½ã\n\nååä¸ä»¶äºï¼ä¿®æ¹hostsï¼å°æä»¶æå¡å¨çipä¸ååæ å°(åæºtrackerserverç¯å¢)ï¼å ä¸ºåé¢å¾å¤éç½®éé¢é½éè¦å»éç½®æå¡å¨å°åï¼ipåäºï¼å°±åªéè¦ä¿®æ¹hostså³å¯ã\n\n# vim /etc/hosts\n\nå¢å å¦ä¸ä¸è¡ï¼è¿æ¯æçip\n192.168.51.128 file.ljzsg.com\n\nå¦æè¦æ¬æºè®¿é®èææºï¼å¨c:\\windows\\system32\\drivers\\etc\\hostsä¸­åæ ·å¢å ä¸è¡\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 1ãä¸è½½å®è£ libfastcommon\n\nlibfastcommonæ¯ä» fastdfs å fastdht ä¸­æååºæ¥çå¬å± c å½æ°åºï¼åºç¡ç¯å¢ï¼å®è£å³å¯ ã\n\nâ  ä¸è½½libfastcommon\n\n# wget https://github.com/happyfish100/libfastcommon/archive/v1.0.7.tar.gz\n\n\n1\n\n\nâ¡ è§£å\n\n# tar -zxvf v1.0.7.tar.gz\n# cd libfastcommon-1.0.7\n\n\n1\n2\n\n\nâ¢ ç¼è¯ãå®è£\n\n# ./make.sh\n# ./make.sh install\n\n\n1\n2\n\n\nâ£ libfastcommon.so å®è£å°äº/usr/lib64/libfastcommon.soï¼ä½æ¯fastdfsä¸»ç¨åºè®¾ç½®çlibç®å½æ¯/usr/local/libï¼æä»¥éè¦åå»ºè½¯é¾æ¥ã\n\n# ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so\n# ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so\n# ln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so\n# ln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so \n\n\n1\n2\n3\n4\n\n\n\n# 2ãä¸è½½å®è£fastdfs\n\nâ  ä¸è½½fastdfs\n\n# wget https://github.com/happyfish100/fastdfs/archive/v5.05.tar.gz\n\n\n1\n\n\nâ¡ è§£å\n\n# tar -zxvf v5.05.tar.gz\n# cd fastdfs-5.05\n\n\n1\n2\n\n\nâ¢ ç¼è¯ãå®è£\n\n# ./make.sh\n# ./make.sh install\n\n\n1\n2\n\n\nâ£ é»è®¤å®è£æ¹å¼å®è£åçç¸åºæä»¶ä¸ç®å½ ããaãæå¡èæ¬ï¼\n\n/etc/init.d/fdfs_storaged\n/etc/init.d/fdfs_tracker\n\n\n1\n2\n\n\nbãéç½®æä»¶ï¼è¿ä¸ä¸ªæ¯ä½èç»çæ ·ä¾éç½®æä»¶ï¼ :\n\n/etc/fdfs/client.conf.sample\n/etc/fdfs/storage.conf.sample\n/etc/fdfs/tracker.conf.sample\n\n\n1\n2\n3\n\n\ncãå½ä»¤å·¥å·å¨ /usr/bin/ ç®å½ä¸ï¼\n\n[](javascript:void(0)ð\n\nfdfs_appender_test\nfdfs_appender_test1\nfdfs_append_file\nfdfs_crc32\nfdfs_delete_file\nfdfs_download_file\nfdfs_file_info\nfdfs_monitor\nfdfs_storaged\nfdfs_test\nfdfs_test1\nfdfs_trackerd\nfdfs_upload_appender\nfdfs_upload_file\nstop.sh\nrestart.sh \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n[](javascript:void(0)ð\n\nâ¤ fastdfs æå¡èæ¬è®¾ç½®ç bin ç®å½æ¯ /usr/local/binï¼ ä½å®éå½ä»¤å®è£å¨ /usr/bin/ ä¸ã\n\nä¸¤ç§æ¹å¼ï¼\n\nã ä¸æ¯ä¿®æ¹fastdfs æå¡èæ¬ä¸­ç¸åºçå½ä»¤è·¯å¾ï¼ä¹å°±æ¯æ /etc/init.d/fdfs_storaged å /etc/init.d/fdfs_tracker ä¸¤ä¸ªèæ¬ä¸­ç /usr/local/bin ä¿®æ¹æ /usr/binã\n\n# vim fdfs_trackerd ããããä½¿ç¨æ¥æ¾æ¿æ¢å½ä»¤è¿ç»ä¸ä¿®æ¹:%s+/usr/local/bin+/usr/bin ãããã# vim fdfs_storaged ããããä½¿ç¨æ¥æ¾æ¿æ¢å½ä»¤è¿ç»ä¸ä¿®æ¹:%s+/usr/local/bin+/usr/bin\n\n\n\nã äºæ¯å»ºç« /usr/bin å° /usr/local/bin çè½¯é¾æ¥ï¼ææ¯ç¨è¿ç§æ¹å¼ã\n\n# ln -s /usr/bin/fdfs_trackerd   /usr/local/bin\n# ln -s /usr/bin/fdfs_storaged   /usr/local/bin\n# ln -s /usr/bin/stop.sh         /usr/local/bin\n# ln -s /usr/bin/restart.sh      /usr/local/bin\n\n\n1\n2\n3\n4\n\n\n\n# 3ãéç½®fastdfsè·è¸ªå¨(tracker)\n\néç½®æä»¶è¯¦ç»è¯´æåèï¼fastdfs éç½®æä»¶è¯¦è§£\n\nâ  è¿å¥ /etc/fdfsï¼å¤å¶ fastdfs è·è¸ªå¨æ ·ä¾éç½®æä»¶ tracker.conf.sampleï¼å¹¶éå½åä¸º tracker.confã\n\n# cd /etc/fdfs\n# cp tracker.conf.sample tracker.conf\n# vim tracker.conf\n\n\n1\n2\n3\n\n\nâ¡ ç¼è¾tracker.conf ï¼æ çº¢çéè¦ä¿®æ¹ä¸ï¼å¶å®çé»è®¤å³å¯ã\n\n[](javascript:void(0)ð\n\n# éç½®æä»¶æ¯å¦ä¸çæï¼false ä¸ºçæ\ndisabled=false\n# æä¾æå¡çç«¯å£\nport=22122\n# tracker æ°æ®åæ¥å¿ç®å½å°å(æ ¹ç®å½å¿é¡»å­å¨,å­ç®å½ä¼èªå¨åå»º)\nbase_path=/ljzsg/fastdfs/tracker\n# http æå¡ç«¯å£\nhttp.server_port=80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n[](javascript:void(0)ð\n\nâ¢ åå»ºtrackeråºç¡æ°æ®ç®å½ï¼å³base_pathå¯¹åºçç®å½\n\n# mkdir -p /ljzsg/fastdfs/tracker\n\n\n1\n\n\nâ£ é²ç«å¢ä¸­æå¼è·è¸ªç«¯å£ï¼é»è®¤ç22122ï¼\n\n[](javascript:void(0)ð\n\n# vim /etc/sysconfig/iptables\næ·»å å¦ä¸ç«¯å£è¡ï¼\n-a input -m state --state new -m tcp -p tcp --dport 22122 -j accept\néå¯é²ç«å¢ï¼\n# service iptables restart\n\n\n1\n2\n3\n4\n5\n\n\n[](javascript:void(0)ð\n\nâ¤ å¯å¨tracker\n\nåæ¬¡æåå¯å¨ï¼ä¼å¨ /ljzsg/fdfsdfs/tracker/ (éç½®çbase_path)ä¸åå»º dataãlogs ä¸¤ä¸ªç®å½ã\n\nå¯ä»¥ç¨è¿ç§æ¹å¼å¯å¨\n# /etc/init.d/fdfs_trackerd start\n\nä¹å¯ä»¥ç¨è¿ç§æ¹å¼å¯å¨ï¼åææ¯ä¸é¢åå»ºäºè½¯é¾æ¥ï¼åé¢é½ç¨è¿ç§æ¹å¼\n# service fdfs_trackerd start\n\n\n1\n2\n3\n4\n5\n\n\næ¥ç fastdfs tracker æ¯å¦å·²æåå¯å¨ ï¼22122ç«¯å£æ­£å¨è¢«çå¬ï¼åç®æ¯trackeræå¡å®è£æåã\n\n# netstat -unltp|grep fdfs\n\n\n1\n\n\n\n\nå³é­trackerå½ä»¤ï¼\n\n# service fdfs_trackerd stop\n\n\n1\n\n\nâ¥ è®¾ç½®trackerå¼æºå¯å¨\n\n# chkconfig fdfs_trackerd on\n\næèï¼\n# vim /etc/rc.d/rc.local\nå å¥éç½®ï¼\n/etc/init.d/fdfs_trackerd start \n\n\n1\n2\n3\n4\n5\n6\n\n\nâ¦ tracker server ç®å½åæä»¶ç»æ\n\ntrackeræå¡å¯å¨æååï¼ä¼å¨base_pathä¸åå»ºdataãlogsä¸¤ä¸ªç®å½ãç®å½ç»æå¦ä¸ï¼\n\n${base_path}\n  |__data\n  |   |__storage_groups.datï¼å­å¨åç»ä¿¡æ¯\n  |   |__storage_servers.datï¼å­å¨æå¡å¨åè¡¨\n  |__logs\n  |   |__trackerd.logï¼ tracker server æ¥å¿æä»¶ \n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 4ãéç½® fastdfs å­å¨ (storage)\n\nâ  è¿å¥ /etc/fdfs ç®å½ï¼å¤å¶ fastdfs å­å¨å¨æ ·ä¾éç½®æä»¶ storage.conf.sampleï¼å¹¶éå½åä¸º storage.conf\n\n# cd /etc/fdfs\n# cp storage.conf.sample storage.conf# vim storage.conf\n\n\n1\n2\n\n\nâ¡ ç¼è¾storage.conf\n\næ çº¢çéè¦ä¿®æ¹ï¼å¶å®çé»è®¤å³å¯ã\n\n[](javascript:void(0)ð\n\n# éç½®æä»¶æ¯å¦ä¸çæï¼false ä¸ºçæ\ndisabled=false \n\n# æå®æ­¤ storage server æå¨ ç»(å·)\ngroup_name=group1\n\n# storage server æå¡ç«¯å£\nport=23000\n\n# å¿è·³é´éæ¶é´ï¼åä½ä¸ºç§ (è¿éæ¯æä¸»å¨å tracker server åéå¿è·³)\nheart_beat_interval=30\n\n# storage æ°æ®åæ¥å¿ç®å½å°å(æ ¹ç®å½å¿é¡»å­å¨ï¼å­ç®å½ä¼èªå¨çæ)\nbase_path=/ljzsg/fastdfs/storage\n\n# å­æ¾æä»¶æ¶ storage server æ¯æå¤ä¸ªè·¯å¾ãè¿ééç½®å­æ¾æä»¶çåºè·¯å¾æ°ç®ï¼éå¸¸åªéä¸ä¸ªç®å½ã\nstore_path_count=1\n\n\n# éä¸éç½® store_path_count ä¸ªè·¯å¾ï¼ç´¢å¼å·åºäº 0ã\n# å¦æä¸éç½® store_path0ï¼é£å®å°±å base_path å¯¹åºçè·¯å¾ä¸æ ·ã\nstore_path0=/ljzsg/fastdfs/file\n\n# fastdfs å­å¨æä»¶æ¶ï¼éç¨äºä¸¤çº§ç®å½ãè¿ééç½®å­æ¾æä»¶çç®å½ä¸ªæ°ã \n# å¦ææ¬åæ°åªä¸º nï¼å¦ï¼ 256ï¼ï¼é£ä¹ storage server å¨åæ¬¡è¿è¡æ¶ï¼ä¼å¨ store_path ä¸èªå¨åå»º n * n ä¸ªå­æ¾æä»¶çå­ç®å½ã\nsubdir_count_per_path=256\n\n# tracker_server çåè¡¨ ï¼ä¼ä¸»å¨è¿æ¥ tracker_server\n# æå¤ä¸ª tracker server æ¶ï¼æ¯ä¸ª tracker server åä¸è¡\ntracker_server=file.ljzsg.com:22122# åè®¸ç³»ç»åæ­¥çæ¶é´æ®µ (é»è®¤æ¯å¨å¤©) ãä¸è¬ç¨äºé¿åé«å³°åæ­¥äº§çä¸äºé®é¢èè®¾å®ãsync_start_time=00:00sync_end_time=23:59\n# è®¿é®ç«¯å£\nhttp.server_port=80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\n[](javascript:void(0)ð\n\nâ¢ åå»ºstorageåºç¡æ°æ®ç®å½ï¼å¯¹åºbase_pathç®å½\n\n# mkdir -p /ljzsg/fastdfs/storage\n\n# è¿æ¯éç½®çstore_path0è·¯å¾\n# mkdir -p /ljzsg/fastdfs/file\n\n\n1\n2\n3\n4\n\n\nâ£ é²ç«å¢ä¸­æå¼å­å¨å¨ç«¯å£ï¼é»è®¤ç 23000ï¼\n\n[](javascript:void(0)ð\n\n# vim /etc/sysconfig/iptables\n\næ·»å å¦ä¸ç«¯å£è¡ï¼\n-a input -m state --state new -m tcp -p tcp --dport 23000 -j accept\n\néå¯é²ç«å¢ï¼\n# service iptables restart\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n[](javascript:void(0)ð\n\n\n\nâ¤ å¯å¨ storage\n\nå¯å¨storageåç¡®ä¿trackeræ¯å¯å¨çãåæ¬¡å¯å¨æåï¼ä¼å¨ /ljzsg/fastdfs/storage ç®å½ä¸åå»º dataã logs ä¸¤ä¸ªç®å½ã\n\nå¯ä»¥ç¨è¿ç§æ¹å¼å¯å¨\n# /etc/init.d/fdfs_storaged start\n\nä¹å¯ä»¥ç¨è¿ç§æ¹å¼ï¼åé¢é½ç¨è¿ç§\n# service fdfs_storaged start\n\n\n1\n2\n3\n4\n5\n\n\næ¥ç storage æ¯å¦æåå¯å¨ï¼23000 ç«¯å£æ­£å¨è¢«çå¬ï¼å°±ç® storage å¯å¨æåã\n\n# netstat -unltp|grep fdfs\n\n\n1\n\n\n\n\nå³é­storageå½ä»¤ï¼\n\n# service fdfs_storaged stop\n\n\n1\n\n\næ¥çstorageåtrackeræ¯å¦å¨éä¿¡ï¼\n\n/usr/bin/fdfs_monitor /etc/fdfs/storage.conf\n\n\n1\n\n\n\n\nâ¥ è®¾ç½® storage å¼æºå¯å¨\n\n# chkconfig fdfs_storaged on\næèï¼\n# vim /etc/rc.d/rc.local\nå å¥éç½®ï¼\n/etc/init.d/fdfs_storaged start\n\n\n1\n2\n3\n4\n5\n\n\nâ¦ storage ç®å½\n\nå trackerï¼storage å¯å¨æååï¼å¨base_path ä¸åå»ºäºdataãlogsç®å½ï¼è®°å½ç storage server çä¿¡æ¯ã\n\nå¨ store_path0 ç®å½ä¸ï¼åå»ºäºn*nä¸ªå­ç®å½ï¼\n\n\n\n\n# 5ãæä»¶ä¸ä¼ æµè¯\n\nâ  ä¿®æ¹ tracker æå¡å¨ä¸­çå®¢æ·ç«¯éç½®æä»¶\n\n# cd /etc/fdfs\n# cp client.conf.sample client.conf\n# vim client.conf\n\n\n1\n2\n3\n\n\nä¿®æ¹å¦ä¸éç½®å³å¯ï¼å¶å®é»è®¤ã\n\n# client çæ°æ®åæ¥å¿ç®å½\nbase_path=/ljzsg/fastdfs/client\n\n# trackerç«¯å£\ntracker_server=file.ljzsg.com:22122\n\n\n1\n2\n3\n4\n5\n\n\nâ¡ ä¸ä¼ æµè¯\n\nå¨linuxåé¨æ§è¡å¦ä¸å½ä»¤ä¸ä¼  namei.jpeg å¾ç\n\n# /usr/bin/fdfs_upload_file /etc/fdfs/client.conf namei.jpeg\n\n\n1\n\n\nä¸ä¼ æååè¿åæä»¶idå·ï¼group1/m00/00/00/wkgz6lnduteamdrcaaeormxzpp870.jpeg\n\n\n\nè¿åçæä»¶idç±groupãå­å¨ç®å½ãä¸¤çº§å­ç®å½ãfileidãæä»¶åç¼åï¼ç±å®¢æ·ç«¯æå®ï¼ä¸»è¦ç¨äºåºåæä»¶ç±»åï¼æ¼æ¥èæã\n\n\n\nåå°é¡¶é¨\n\n\n# ä¸ãå®è£nginx\n\nä¸é¢å°æä»¶ä¸ä¼ æåäºï¼ä½æä»¬æ æ³ä¸è½½ãå æ­¤å®è£nginxä½ä¸ºæå¡å¨ä»¥æ¯æhttpæ¹å¼è®¿é®æä»¶ãåæ¶ï¼åé¢å®è£fastdfsçnginxæ¨¡åä¹éè¦nginxç¯å¢ã\n\nnginxåªéè¦å®è£å°storageserveræå¨çæå¡å¨å³å¯ï¼ç¨äºè®¿é®æä»¶ãæè¿éç±äºæ¯åæºï¼trackerserveråstorageserverå¨ä¸å°æå¡å¨ä¸ã\n\n\n# 1ãå®è£nginxæéç¯å¢\n\nâ  gcc å®è£\n\n# yum install gcc-c++\n\n\n1\n\n\nâ¡ pcre pcre-devel å®è£\n\n# yum install -y pcre pcre-devel\n\n\n1\n\n\nâ¢ zlib å®è£\n\n# yum install -y zlib zlib-devel\n\n\n1\n\n\nâ£ openssl å®è£\n\n# yum install -y openssl openssl-devel\n\n\n1\n\n\n\n# 2ãå®è£nginx\n\nâ  ä¸è½½nginx\n\n# wget -c https://nginx.org/download/nginx-1.12.1.tar.gz\n\n\n1\n\n\nâ¡ è§£å\n\n# tar -zxvf nginx-1.12.1.tar.gz\n# cd nginx-1.12.1\n\n\n1\n2\n\n\nâ¢ ä½¿ç¨é»è®¤éç½®\n\n# ./configure\n\n\n1\n\n\nâ£ ç¼è¯ãå®è£\n\n# make\n# make install\n\n\n1\n2\n\n\nâ¤ å¯å¨nginx\n\n[](javascript:void(0)ð\n\n# cd /usr/local/nginx/sbin/\n# ./nginx \n\nå¶å®å½ä»¤\n# ./nginx -s stop\n# ./nginx -s quit\n# ./nginx -s reload\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n[](javascript:void(0)ð\n\nâ¥ è®¾ç½®å¼æºå¯å¨\n\n[](javascript:void(0)ð\n\n# vim /etc/rc.local\n\næ·»å ä¸è¡ï¼\n/usr/local/nginx/sbin/nginx# è®¾ç½®æ§è¡æé# chmod 755 rc.local\n\n\n1\n2\n3\n4\n\n\n[](javascript:void(0)ð\n\nâ¦ æ¥çnginxççæ¬åæ¨¡å\n\n/usr/local/nginx/sbin/nginx -v\n\n\n1\n\n\n\n\nâ§ é²ç«å¢ä¸­æå¼nginxç«¯å£ï¼é»è®¤ç 80ï¼\n\næ·»å åå°±è½å¨æ¬æºä½¿ç¨80ç«¯å£è®¿é®äºã\n\n[](javascript:void(0)ð\n\n# vim /etc/sysconfig/iptables\n\næ·»å å¦ä¸ç«¯å£è¡ï¼\n-a input -m state --state new -m tcp -p tcp --dport 80 -j accept\n\néå¯é²ç«å¢ï¼\n# service iptables restart\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n[](javascript:void(0)ð\n\n\n\n\n# 3ãè®¿é®æä»¶\n\nç®åçæµè¯è®¿é®æä»¶\n\nâ  ä¿®æ¹nginx.conf\n\n[](javascript:void(0)ð\n\n# vim /usr/local/nginx/conf/nginx.conf\n\næ·»å å¦ä¸è¡ï¼å° /group1/m00 æ å°å° /ljzsg/fastdfs/file/data\nlocation /group1/m00 {\n    alias /ljzsg/fastdfs/file/data;\n}# éå¯nginx# /usr/local/nginx/sbin/nginx -s reload\n\n\n1\n2\n3\n4\n5\n6\n\n\n[](javascript:void(0)ð\n\n\n\nâ¡ å¨æµè§å¨è®¿é®ä¹åä¸ä¼ çå¾çãæåã\n\nhttp://file.ljzsg.com/group1/m00/00/00/wkgz6lnduteamdrcaaeormxzpp870.jpeg\n\nåå°é¡¶é¨\n\n\n# åãfastdfs éç½® nginx æ¨¡å\n\n\n# 1ãå®è£éç½®nginxæ¨¡å\n\nâ  fastdfs-nginx-module æ¨¡åè¯´æ\n\nfastdfs éè¿ tracker æå¡å¨ï¼å°æä»¶æ¾å¨ storage æå¡å¨å­å¨ï¼ ä½æ¯åç»å­å¨æå¡å¨ä¹é´éè¦è¿è¡æä»¶å¤å¶ï¼ æåæ­¥å»¶è¿çé®é¢ã\n\nåè®¾ tracker æå¡å¨å°æä»¶ä¸ä¼ å°äº 192.168.51.128ï¼ä¸ä¼ æååæä»¶ idå·²ç»è¿åç»å®¢æ·ç«¯ã\n\næ­¤æ¶ fastdfs å­å¨éç¾¤æºå¶ä¼å°è¿ä¸ªæä»¶åæ­¥å°åç»å­å¨ 192.168.51.129ï¼å¨æä»¶è¿æ²¡æå¤å¶å®æçæåµä¸ï¼å®¢æ·ç«¯å¦æç¨è¿ä¸ªæä»¶ id å¨ 192.168.51.129 ä¸åæä»¶,å°±ä¼åºç°æä»¶æ æ³è®¿é®çéè¯¯ã\n\nè fastdfs-nginx-module å¯ä»¥éå®åæä»¶é¾æ¥å°æºæå¡å¨åæä»¶ï¼é¿åå®¢æ·ç«¯ç±äºå¤å¶å»¶è¿å¯¼è´çæä»¶æ æ³è®¿é®éè¯¯ã\n\nâ¡ ä¸è½½ fastdfs-nginx-moduleãè§£å\n\n[](javascript:void(0)ð\n\n# è¿éä¸ºå¥è¿ä¹é¿ä¸ä¸²å¢ï¼å ä¸ºææ°ççmasterä¸å½ånginxæäºçæ¬é®é¢ã\n# wget https://github.com/happyfish100/fastdfs-nginx-module/archive/5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip\n\n# è§£å\n# unzip 5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip\n\n# éå½å\n# mv fastdfs-nginx-module-5e5f3566bbfa57418b5506aaefbe107a42c9fcb1  fastdfs-nginx-module-master\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n[](javascript:void(0)ð\n\nâ¢ éç½®nginx\n\nå¨nginxä¸­æ·»å æ¨¡å\n\n[](javascript:void(0)ð\n\n# ååænginxæå¡# /usr/local/nginx/sbin/nginx -s stopè¿å¥è§£ååç®å½\n# cd /softpackages/nginx-1.12.1/\n\n# æ·»å æ¨¡å\n# ./configure --add-module=../fastdfs-nginx-module-master/src\n\néæ°ç¼è¯ãå®è£\n# make && make install\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n[](javascript:void(0)ð\n\nâ£ æ¥çnginxçæ¨¡å\n\n# /usr/local/nginx/sbin/nginx -v\n\n\n1\n\n\næä¸é¢è¿ä¸ªå°±è¯´ææ·»å æ¨¡åæå\n\n\n\nâ¤ å¤å¶ fastdfs-nginx-module æºç ä¸­çéç½®æä»¶å°/etc/fdfs ç®å½ï¼ å¹¶ä¿®æ¹\n\n# cd /softpackages/fastdfs-nginx-module-master/src\n\n# cp mod_fastdfs.conf /etc/fdfs/\n\n\n1\n2\n3\n\n\nä¿®æ¹å¦ä¸éç½®ï¼å¶å®é»è®¤\n\n[](javascript:void(0)ð\n\n# è¿æ¥è¶æ¶æ¶é´connect_timeout=10\n\n# tracker server\ntracker_server=file.ljzsg.com:22122\n# storageserver é»è®¤ç«¯å£\nstorage_server_port=23000\n\n# å¦ææä»¶idçuriä¸­åå«/group**ï¼åè¦è®¾ç½®ä¸ºtrue\nurl_have_group_name = true\n\n# storage éç½®çstore_path0è·¯å¾ï¼å¿é¡»åstorage.confä¸­çä¸è´\nstore_path0=/ljzsg/fastdfs/file\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n[](javascript:void(0)ð\n\nâ¥ å¤å¶ fastdfs çé¨åéç½®æä»¶å°/etc/fdfs ç®å½\n\n# cd /softpackages/fastdfs-5.05/conf/\n\n# cp anti-steal.jpg http.conf mime.types /etc/fdfs/\n\n\n1\n2\n3\n\n\nâ¦ éç½®nginxï¼ä¿®æ¹nginx.conf\n\n# vim /usr/local/nginx/conf/nginx.conf\n\n\n1\n\n\nä¿®æ¹éç½®ï¼å¶å®çé»è®¤\n\nå¨80ç«¯å£ä¸æ·»å fastdfs-nginxæ¨¡å\n\nlocation ~/group([0-9])/m00 {\n    ngx_fastdfs_module;\n}\n\n\n1\n2\n3\n\n\n\n\næ³¨æï¼\n\nlisten 80 ç«¯å£å¼æ¯è¦ä¸ /etc/fdfs/storage.conf ä¸­ç http.server_port=80 (åé¢æ¹æ80äº)ç¸å¯¹åºãå¦ææ¹æå¶å®ç«¯å£ï¼åéè¦ç»ä¸ï¼åæ¶å¨é²ç«å¢ä¸­æå¼è¯¥ç«¯å£ã\n\nlocation çéç½®ï¼å¦ææå¤ä¸ªgroupåéç½®location ~/group([0-9])/m00 ï¼æ²¡æåä¸ç¨égroupã\n\nâ§ å¨/ljzsg/fastdfs/file æä»¶å­å¨ç®å½ä¸åå»ºè½¯è¿æ¥ï¼å°å¶é¾æ¥å°å®éå­æ¾æ°æ®çç®å½ï¼è¿ä¸æ­¥å¯ä»¥çç¥ã\n\n# ln -s /ljzsg/fastdfs/file/data/ /ljzsg/fastdfs/file/data/m00 \n\n\n1\n\n\nâ¨ å¯å¨nginx\n\n# /usr/local/nginx/sbin/nginx\n\n\n1\n\n\næå°å¤å¦ä¸å°±ç®éç½®æå\n\n\n\nâ© å¨å°åæ è®¿é®ã\n\nè½ä¸è½½æä»¶å°±ç®å®è£æåãæ³¨æåç¬¬ä¸ç¹ä¸­ç´æ¥ä½¿ç¨nginxè·¯ç±è®¿é®ä¸åçæ¯ï¼è¿ééç½® fastdfs-nginx-module æ¨¡åï¼å¯ä»¥éå®åæä»¶é¾æ¥å°æºæå¡å¨åæä»¶ã\n\nhttp://file.ljzsg.com/group1/m00/00/00/wkgz6lnduteamdrcaaeormxzpp870.jpeg\n\næç»é¨ç½²ç»æå¾(ççå¾)ï¼å¯ä»¥æç§ä¸é¢çç»ææ­å»ºç¯å¢ã\n\n\n\nåå°é¡¶é¨\n\n\n# äºãjavaå®¢æ·ç«¯\n\nåé¢æä»¶ç³»ç»å¹³å°æ­å»ºå¥½äºï¼ç°å¨å°±è¦åå®¢æ·ç«¯ä»£ç å¨ç³»ç»ä¸­å®ç°ä¸ä¼ ä¸è½½ï¼è¿éåªæ¯ç®åçæµè¯ä»£ç ã\n\n\n# 1ãé¦åéè¦æ­å»º fastdfs å®¢æ·ç«¯javaå¼åç¯å¢\n\nâ  é¡¹ç®ä¸­ä½¿ç¨mavenè¿è¡ä¾èµç®¡çï¼å¯ä»¥å¨pom.xmlä¸­å¼å¥å¦ä¸ä¾èµå³å¯ï¼\n\n<dependency>\n   <groupid>net.oschina.zcx7878</groupid>\n   <artifactid>fastdfs-client-java</artifactid>\n   <version>1.27.0.0</version>\n</dependency>\n\n\n1\n2\n3\n4\n5\n\n\nå¶å®çæ¹å¼ï¼åèå®æ¹ææ¡£ï¼https://github.com/happyfish100/fastdfs-client-java\n\nâ¡ å¼å¥éç½®æä»¶\n\nå¯ç´æ¥å¤å¶åä¸ç fastdfs-client.properties.sample æè fdfs_client.conf.sampleï¼å°ä½ çé¡¹ç®ä¸­ï¼å»æ.sampleã\n\n\n\næè¿éç´æ¥å¤å¶ fastdfs-client.properties.sample ä¸­çéç½®å°é¡¹ç®éç½®æä»¶ config.properties ä¸­ï¼ä¿®æ¹tracker_serversãåªéè¦å è½½è¿ä¸ªéç½®æä»¶å³å¯\n\n\n\n\n# 2ãå®¢æ·ç«¯api\n\nä¸ªäººå°è£çfastdfs java apiä»¥åæ­¥å°githubï¼https://github.com/bojiangzhou/lyyzoo-fastdfs-java.git\n\n\n# å­ãæéæ§å¶\n\nåé¢ä½¿ç¨nginxæ¯æhttpæ¹å¼è®¿é®æä»¶ï¼ä½ææäººé½è½ç´æ¥è®¿é®è¿ä¸ªæä»¶æå¡å¨äºï¼æä»¥åä¸ä¸æéæ§å¶ã\n\nfastdfsçæéæ§å¶æ¯å¨æå¡ç«¯å¼å¯tokenéªè¯ï¼å®¢æ·ç«¯æ ¹æ®æä»¶åãå½åunixæ¶é´æ³ãç§é¥è·åtokenï¼å¨å°åä¸­å¸¦ä¸tokenåæ°å³å¯éè¿httpæ¹å¼è®¿é®æä»¶ã\n\nâ  æå¡ç«¯å¼å¯tokenéªè¯\n\n[](javascript:void(0)ð\n\nä¿®æ¹http.conf\n# vim /etc/fdfs/http.conf\n\nè®¾ç½®ä¸ºtrueè¡¨ç¤ºå¼å¯tokenéªè¯\nhttp.anti_steal.check_token=trueè®¾ç½®tokenå¤±æçæ¶é´åä½ä¸ºç§(s)http.anti_steal.token_ttl=1800\nå¯é¥ï¼è·å®¢æ·ç«¯éç½®æä»¶çfastdfs.http_secret_keyä¿æä¸è´\nhttp.anti_steal.secret_key=fastdfs1234567890\n\nå¦ætokenæ£æ¥å¤±è´¥ï¼è¿åçé¡µé¢\nhttp.anti_steal.token_check_fail=/ljzsg/fastdfs/page/403.html\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n[](javascript:void(0)ð\n\nè®°å¾éå¯æå¡ã\n\nâ¡ éç½®å®¢æ·ç«¯\n\nå®¢æ·ç«¯åªéè¦è®¾ç½®å¦ä¸ä¸¤ä¸ªåæ°å³å¯ï¼ä¸¤è¾¹çå¯é¥ä¿æä¸è´ã\n\n# token é²çé¾åè½\nfastdfs.http_anti_steal_token=true\n# å¯é¥\nfastdfs.http_secret_key=fastdfs1234567890\n\n\n1\n2\n3\n4\n\n\nâ¢ å®¢æ·ç«¯çætoken\n\nè®¿é®æä»¶éè¦å¸¦ä¸çæçtokenä»¥åunixæ¶é´æ³ï¼æä»¥è¿åçtokenæ¯tokenåæ¶é´æ³çæ¼æ¥ã\n\nä¹åï¼å°tokenæ¼æ¥å¨å°ååå³å¯è®¿é®ï¼file.ljzsg.com/group1/m00/00/00/wkgzgfnkaxqaifxyaaeormxzpp878.jpeg?token=078d370098b03e9020b82c829c205e1f&ts=1508141521\n\n[](javascript:void(0)ð\n\n 1     /**\n 2      * è·åè®¿é®æå¡å¨çtokenï¼æ¼æ¥å°å°ååé¢\n 3      *\n 4      * @param filepath æä»¶è·¯å¾ group1/m00/00/00/wkgzgfnktpyaiaugaaeormxzpp876.jpeg\n 5      * @param httpsecretkey å¯é¥\n 6      * @return è¿åtokenï¼å¦ï¼ token=078d370098b03e9020b82c829c205e1f&ts=1508141521\n 7      */\n 8     public static string gettoken(string filepath, string httpsecretkey){\n 9         // unix seconds\n10         int ts = (int) instant.now().getepochsecond();\n11         // token\n12         string token = "null";\n13         try {\n14             token = protocommon.gettoken(getfilename(filepath), ts, httpsecretkey);\n15         } catch (unsupportedencodingexception e) {\n16             e.printstacktrace();\n17         } catch (nosuchalgorithmexception e) {\n18             e.printstacktrace();\n19         } catch (myexception e) {\n20             e.printstacktrace();\n21         }\n22 \n23         stringbuilder sb = new stringbuilder();\n24         sb.append("token=").append(token);\n25         sb.append("&ts=").append(ts);\n26 \n27         return sb.tostring();\n28     }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n[](javascript:void(0)ð\n\nâ£ æ³¨æäºé¡¹\n\nå¦æçæçtokenéªè¯æ æ³éè¿ï¼è¯·è¿è¡å¦ä¸ä¸¤é¡¹æ£æ¥ï¼ ããa. ç¡®è®¤è°ç¨tokençæå½æ°(protocommon.gettoken)ï¼ä¼ éçæä»¶idä¸­æ²¡æåå«group nameãä¼ éçæä»¶idæ ¼å¼å½¢å¦ï¼m00/00/00/wkgzgfnktpyaiaugaaeormxzpp876.jpeg\n\nb. ç¡®è®¤æå¡å¨æ¶é´åºæ¬æ¯ä¸è´çï¼æ³¨ææå¡å¨æ¶é´ä¸è½ç¸å·®å¤ªå¤ï¼ä¸è¦ç¸å·®å°åéçº§å«ã\n\nâ¤ å¯¹æ¯ä¸åç°ï¼å¦æç³»ç»æä»¶éç§æ§è¾é«ï¼å¯ä»¥ç´æ¥éè¿fastdfs-clientæä¾çapiå»è®¿é®å³å¯ï¼ä¸ç¨åéç½®nginxèµ°httpè®¿é®ãéç½®nginxçä¸»è¦ç®çæ¯ä¸ºäºå¿«éè®¿é®æå¡å¨çæä»¶(å¦å¾ç)ï¼å¦æè¿è¦å æééªè¯ï¼åéè¦å®¢æ·ç«¯çætokenï¼å¶å®å·²ç»æ²¡æå¤å¤§æä¹ã\n\nå³é®æ¯ï¼è¿éææ²¡æ¾å°fastdfså¦ä½å¯¹é¨åèµæºå tokenéªè¯ï¼é¨åå¼æ¾ãæç¥éçè¿è¯·çè¨ã\n\n----------------------------------------\n\nokï¼ä»¥ä¸å°±æ¯åæºä¸­ä½¿ç¨fastdfsæ­å»ºæä»¶ç³»ç»å¹¶ä¸ä¼ ä¸è½½çè¿ç¨ã\n\nå®ï¼ï¼ï¼\n\nåæé¾æ¥ï¼https://www.cnblogs.com/chiangchou/p/fastdfs.html',charsets:{cjk:!0}},{title:"é¨ç½²cephéç¾¤ Nautilusç",frontmatter:{title:"é¨ç½²cephéç¾¤ Nautilusç",date:"2023-03-01T15:47:49.000Z",permalink:"/pages/88a4de/",categories:["è¿ç»´","å­å¨","ceph"],tags:[null],readingShow:"top",description:"å­¦ä¹ cephç¬¬ä¸å¤©ï¼è®°å½ä¸cephéç¾¤é¨ç½²è¿ç¨",meta:[{name:"image",content:"http://pic.zzppjj.top/LightPicture/2023/03/60bf4e01f6c60c66.png"},{name:"twitter:title",content:"é¨ç½²cephéç¾¤ Nautilusç"},{name:"twitter:description",content:"å­¦ä¹ cephç¬¬ä¸å¤©ï¼è®°å½ä¸cephéç¾¤é¨ç½²è¿ç¨"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://pic.zzppjj.top/LightPicture/2023/03/60bf4e01f6c60c66.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/06.%E5%AD%98%E5%82%A8/03.ceph/01.%E9%83%A8%E7%BD%B2ceph%E9%9B%86%E7%BE%A4%20Nautilus%E7%89%88.html"},{property:"og:type",content:"article"},{property:"og:title",content:"é¨ç½²cephéç¾¤ Nautilusç"},{property:"og:description",content:"å­¦ä¹ cephç¬¬ä¸å¤©ï¼è®°å½ä¸cephéç¾¤é¨ç½²è¿ç¨"},{property:"og:image",content:"http://pic.zzppjj.top/LightPicture/2023/03/60bf4e01f6c60c66.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/06.%E5%AD%98%E5%82%A8/03.ceph/01.%E9%83%A8%E7%BD%B2ceph%E9%9B%86%E7%BE%A4%20Nautilus%E7%89%88.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-03-01T15:47:49.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"é¨ç½²cephéç¾¤ Nautilusç"},{itemprop:"description",content:"å­¦ä¹ cephç¬¬ä¸å¤©ï¼è®°å½ä¸cephéç¾¤é¨ç½²è¿ç¨"},{itemprop:"image",content:"http://pic.zzppjj.top/LightPicture/2023/03/60bf4e01f6c60c66.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/06.%E5%AD%98%E5%82%A8/03.ceph/01.%E9%83%A8%E7%BD%B2ceph%E9%9B%86%E7%BE%A4%20Nautilus%E7%89%88.html",relativePath:"04.è¿ç»´/06.å­å¨/03.ceph/01.é¨ç½²cephéç¾¤ Nautilusç.md",key:"v-0bebf3bd",path:"/pages/88a4de/",headers:[{level:3,title:"cephç®ä»",slug:"cephç®ä»",normalizedTitle:"cephç®ä»",charIndex:86},{level:4,title:"cephæ¶æ",slug:"cephæ¶æ",normalizedTitle:"cephæ¶æ",charIndex:96},{level:4,title:"CephÂ æ¯æä¸ç§æ¥å£",slug:"ceph-æ¯æä¸ç§æ¥å£",normalizedTitle:"cephÂ æ¯æä¸ç§æ¥å£",charIndex:108},{level:4,title:"cephä¸»è¦ç¹ç¹",slug:"cephä¸»è¦ç¹ç¹",normalizedTitle:"cephä¸»è¦ç¹ç¹",charIndex:215},{level:4,title:"cephæ ¸å¿ç»ä»¶åå¶ä½ç¨",slug:"cephæ ¸å¿ç»ä»¶åå¶ä½ç¨",normalizedTitle:"cephæ ¸å¿ç»ä»¶åå¶ä½ç¨",charIndex:291},{level:4,title:"cephåºç¨åºæ¯",slug:"cephåºç¨åºæ¯",normalizedTitle:"cephåºç¨åºæ¯",charIndex:1231},{level:3,title:"ç¯å¢åå¤",slug:"ç¯å¢åå¤",normalizedTitle:"ç¯å¢åå¤",charIndex:2156},{level:3,title:"ç³»ç»åå§å",slug:"ç³»ç»åå§å",normalizedTitle:"ç³»ç»åå§å",charIndex:2558},{level:4,title:"å³é­é²ç«å¢åselinux",slug:"å³é­é²ç«å¢åselinux",normalizedTitle:"å³é­é²ç«å¢åselinux",charIndex:2603},{level:4,title:"ä¿®æ¹ä¸»æºå",slug:"ä¿®æ¹ä¸»æºå",normalizedTitle:"ä¿®æ¹ä¸»æºå",charIndex:2855},{level:4,title:"éç½®hostsè§£æè®°å½",slug:"éç½®hostsè§£æè®°å½",normalizedTitle:"éç½®hostsè§£æè®°å½",charIndex:2981},{level:4,title:"è°æ´åæ ¸åæ°",slug:"è°æ´åæ ¸åæ°",normalizedTitle:"è°æ´åæ ¸åæ°",charIndex:3115},{level:4,title:"è°æ´æå¤§å¯æå¼æä»¶æ°",slug:"è°æ´æå¤§å¯æå¼æä»¶æ°",normalizedTitle:"è°æ´æå¤§å¯æå¼æä»¶æ°",charIndex:4326},{level:4,title:"éç½®ntp",slug:"éç½®ntp",normalizedTitle:"éç½®ntp",charIndex:4648},{level:5,title:"éç½®ntpæå¡ç«¯",slug:"éç½®ntpæå¡ç«¯",normalizedTitle:"éç½®ntpæå¡ç«¯",charIndex:4657},{level:5,title:"å¶ä»èç¹åæ­¥æ§å¶èç¹æ¶é´",slug:"å¶ä»èç¹åæ­¥æ§å¶èç¹æ¶é´",normalizedTitle:"å¶ä»èç¹åæ­¥æ§å¶èç¹æ¶é´",charIndex:5034},{level:4,title:"éç½®yumæº",slug:"éç½®yumæº",normalizedTitle:"éç½®yumæº",charIndex:5424},{level:4,title:"å®è£åºç¡å·¥å·",slug:"å®è£åºç¡å·¥å·",normalizedTitle:"å®è£åºç¡å·¥å·",charIndex:6118},{level:4,title:"éç½®åå¯ç»å½å°å¶ä»èç¹",slug:"éç½®åå¯ç»å½å°å¶ä»èç¹",normalizedTitle:"éç½®åå¯ç»å½å°å¶ä»èç¹",charIndex:6246},{level:3,title:"é¨ç½²cephéç¾¤",slug:"é¨ç½²cephéç¾¤",normalizedTitle:"é¨ç½²cephéç¾¤",charIndex:6362},{level:4,title:"é¨ç½²admin",slug:"é¨ç½²admin",normalizedTitle:"é¨ç½²admin",charIndex:6415},{level:5,title:"å®è£cephè½¯ä»¶å",slug:"å®è£cephè½¯ä»¶å",normalizedTitle:"å®è£cephè½¯ä»¶å",charIndex:7258},{level:5,title:"åå§åmonitor",slug:"åå§åmonitor",normalizedTitle:"åå§åmonitor",charIndex:7419},{level:5,title:"æ·è´adminçç§é¥æä»¶",slug:"æ·è´adminçç§é¥æä»¶",normalizedTitle:"æ·è´adminçç§é¥æä»¶",charIndex:7513},{level:5,title:"ç¡®è®¤éç¾¤ç¶æ",slug:"ç¡®è®¤éç¾¤ç¶æ",normalizedTitle:"ç¡®è®¤éç¾¤ç¶æ",charIndex:7627},{level:4,title:"é¨ç½²manager",slug:"é¨ç½²manager",normalizedTitle:"é¨ç½²manager",charIndex:8022},{level:4,title:"åå»ºä¸ä¸ªOSD",slug:"åå»ºä¸ä¸ªosd",normalizedTitle:"åå»ºä¸ä¸ªosd",charIndex:8596},{level:3,title:"cephéç¾¤æ©å®¹",slug:"cephéç¾¤æ©å®¹",normalizedTitle:"cephéç¾¤æ©å®¹",charIndex:9868},{level:4,title:"æ©å®¹monitorèç¹",slug:"æ©å®¹monitorèç¹",normalizedTitle:"æ©å®¹monitorèç¹",charIndex:9880},{level:5,title:"æ©å®¹ç¬¬ä¸ä¸ªmonitorèç¹",slug:"æ©å®¹ç¬¬ä¸ä¸ªmonitorèç¹",normalizedTitle:"æ©å®¹ç¬¬ä¸ä¸ªmonitorèç¹",charIndex:10057},{level:5,title:"æ©å®¹ç¬¬äºä¸ªmonitorèç¹",slug:"æ©å®¹ç¬¬äºä¸ªmonitorèç¹",normalizedTitle:"æ©å®¹ç¬¬äºä¸ªmonitorèç¹",charIndex:12596},{level:4,title:"æ£æ¥cephéç¾¤ç¶æ",slug:"æ£æ¥cephéç¾¤ç¶æ",normalizedTitle:"æ£æ¥cephéç¾¤ç¶æ",charIndex:13080},{level:4,title:"æ©å®¹managerèç¹",slug:"æ©å®¹managerèç¹",normalizedTitle:"æ©å®¹managerèç¹",charIndex:14400}],headersStr:"cephç®ä» cephæ¶æ CephÂ æ¯æä¸ç§æ¥å£ cephä¸»è¦ç¹ç¹ cephæ ¸å¿ç»ä»¶åå¶ä½ç¨ cephåºç¨åºæ¯ ç¯å¢åå¤ ç³»ç»åå§å å³é­é²ç«å¢åselinux ä¿®æ¹ä¸»æºå éç½®hostsè§£æè®°å½ è°æ´åæ ¸åæ° è°æ´æå¤§å¯æå¼æä»¶æ° éç½®ntp éç½®ntpæå¡ç«¯ å¶ä»èç¹åæ­¥æ§å¶èç¹æ¶é´ éç½®yumæº å®è£åºç¡å·¥å· éç½®åå¯ç»å½å°å¶ä»èç¹ é¨ç½²cephéç¾¤ é¨ç½²admin å®è£cephè½¯ä»¶å åå§åmonitor æ·è´adminçç§é¥æä»¶ ç¡®è®¤éç¾¤ç¶æ é¨ç½²manager åå»ºä¸ä¸ªOSD cephéç¾¤æ©å®¹ æ©å®¹monitorèç¹ æ©å®¹ç¬¬ä¸ä¸ªmonitorèç¹ æ©å®¹ç¬¬äºä¸ªmonitorèç¹ æ£æ¥cephéç¾¤ç¶æ æ©å®¹managerèç¹",content:'å­¦ä¹ cephç¬¬ä¸å¤©ï¼è®°å½ä¸cephéç¾¤é¨ç½²è¿ç¨\n\nåèææ¡£ï¼\n\n * å®æ¹ææ¡£ã\n * cephåºæ¬æ¦å¿µãåçãæ¶æä»ç»\n * ãåæãCephç³»ç»æ¶æä¸åºæ¬æ¦å¿µ\n\n\n# cephç®ä»\n\n# cephæ¶æ\n\n\n\n# CephÂ æ¯æä¸ç§æ¥å£\n\n>  * Objectï¼æåççAPIï¼èä¸ä¹å¼å®¹ Swift å S3 ç API\n>  * Blockï¼æ¯æç²¾ç®éç½®ãå¿«ç§ãåé\n>  * Fileï¼Posix æ¥å£ï¼æ¯æå¿«ç§\n\n# cephä¸»è¦ç¹ç¹\n\n>  * ç»ä¸å­å¨\n>  * æ ä»»ä½åç¹æé\n>  * æ°æ®å¤ä»½åä½\n>  * å­å¨å®¹éå¯æ©å±\n>  * èªå¨å®¹éåæéèªæ\n\n# cephæ ¸å¿ç»ä»¶åå¶ä½ç¨\n\n> å¨Cephå­å¨éç¾¤ä¸­ï¼åå«äºä¸å¤§è§è²ç»ä»¶ï¼ä»ä»¬å¨Cephå­å¨éç¾¤ä¸­è¡¨ç°ä¸º3ä¸ªå®æ¤è¿ç¨ï¼åå«æ¯CephÂ OSDãMonitorãManagersãå½ç¶è¿æå¶ä»çåè½ç»ä»¶ï¼ä½æ¯æä¸»è¦çæ¯è¿ä¸ä¸ªã\n> \n>  * CephÂ OSDï¼Â CephçOSDï¼Object Storage Deviceï¼å®æ¤è¿ç¨ãä¸»è¦åè½åæ¬ï¼å­å¨æ°æ®ãå¯æ¬æ°æ®å¤çãæ°æ®æ¢å¤ãæ°æ®åè¡¥ãå¹³è¡¡æ°æ®åå¸ï¼å¹¶å°æ°æ®ç¸å³çä¸äºçæ§ä¿¡æ¯æä¾ç»CephÂ Moniter,ä»¥ä¾¿CephÂ Moniteræ¥æ£æ¥å¶ä»OSDçå¿è·³ç¶æãä¸ä¸ªCephÂ OSDå­å¨éç¾¤ï¼è¦æ±è³å°ä¸¤ä¸ªCephÂ OSD,æè½ææçä¿å­ä¸¤ä»½æ°æ®ãæ³¨æï¼è¿éçä¸¤ä¸ªCephÂ OSDæ¯æè¿è¡å¨ä¸¤å°ç©çæå¡å¨ä¸ï¼å¹¶ä¸æ¯å¨ä¸å°ç©çæå¡å¨ä¸è¿è¡ä¸¤ä¸ªCephÂ OSDçå®æ¤è¿ç¨ãéå¸¸ï¼åä½åé«å¯ç¨æ§è³å°éè¦3ä¸ªCephÂ OSDã\n>  * Monitorï¼Â CephçMonitorå®æ¤è¿ç¨ï¼ä¸»è¦åè½æ¯ç»´æ¤éç¾¤ç¶æçè¡¨ç»ï¼è¿ä¸ªè¡¨ç»ä¸­åå«äºå¤å¼ è¡¨ï¼å¶ä¸­æMoniter mapãOSD mapãPG(Placement Group) mapãCRUSH mapã è¿äºæ å°æ¯Cephå®æ¤è¿ç¨ä¹é´ç¸äºåè°çå³é®ç°ç¶æã çè§å¨è¿è´è´£ç®¡çå®æ¤è¿ç¨åå®¢æ·ç«¯ä¹é´çèº«ä»½éªè¯ã éå¸¸éè¦è³å°ä¸ä¸ªçè§å¨æ¥å®ç°åä½åé«å¯ç¨æ§ã\n>  * Managersï¼Â CephçManagersï¼CephÂ Managerï¼ï¼å®æ¤è¿ç¨ï¼ceph-mgrï¼è´è´£è·è¸ªè¿è¡æ¶é´ææ åCephç¾¤éçå½åç¶æï¼åæ¬å­å¨å©ç¨çï¼å½åæ§è½ææ åç³»ç»è´è½½ãÂ CephÂ Managerå®æ¤ç¨åºè¿æç®¡åºäºpythonçæä»¶æ¥ç®¡çåå¬å¼Cephéç¾¤ä¿¡æ¯ï¼åæ¬åºäºWebçä»ªè¡¨æ¿åREST APIã éå¸¸ï¼è³å°æä¸¤åManageréè¦é«å¯ç¨æ§ã\n>  * MDSï¼Â CephçMDSï¼Metadata Serverï¼å®æ¤è¿ç¨ï¼ä¸»è¦ä¿å­çæ¯Cephæä»¶ç³»ç»çåæ°æ®ãæ³¨æï¼å¯¹äºCephçåè®¾å¤åCephå¯¹è±¡å­å¨é½ä¸éè¦CephÂ MDSå®æ¤è¿ç¨ãCephÂ MDSä¸ºåºäºPOSIXæä»¶ç³»ç»çç¨æ·æä¾äºä¸äºåºç¡å½ä»¤çæ§è¡ï¼æ¯å¦lsãfindç­ï¼è¿æ ·å¯ä»¥å¾å¤§ç¨åº¦éä½Cephå­å¨éç¾¤çååã\n\n# cephåºç¨åºæ¯\n\n> Cephçåºç¨åºæ¯ä¸»è¦ç±å®çæ¶æç¡®å®ï¼Cephæä¾å¯¹è±¡å­å¨ãåå­å¨åæä»¶å­å¨ï¼ä¸»è¦ç±ä»¥ä¸4ç§åºç¨åºæ¯ï¼\n> \n>  * LIBRADOSåºç¨ï¼ éä¿çè¯´ï¼Libradosæä¾äºåºç¨ç¨åºå¯¹RADOSçç´æ¥è®¿é®ï¼ç®åLibradoså·²ç»æä¾äºå¯¹CãC++ãJavaãPythonãRubyåPHPçæ¯æãå®æ¯æåä¸ªåé¡¹çåå­æä½ï¼å¦åæ¶æ´æ°æ°æ®åå±æ§ãCASæä½ï¼åæ¶æå¯¹è±¡ç²åº¦çå¿«ç§æä½ãå®çå®ç°æ¯åºäºRADOSçæä»¶APIï¼ä¹å°±æ¯å¨RADOSä¸è¿è¡çå°è£åºã\n>  * RADOSGWåºç¨ï¼ è¿ç±»åºç¨åºäºLibradosä¹ä¸ï¼å¢å äºHTTPåè®®ï¼æä¾RESTfulæ¥å£å¹¶ä¸å¼å®¹S3ãSwfitæ¥å£ãRADOSGWå°Cephéç¾¤ä½ä¸ºåå¸å¼å¯¹è±¡å­å¨ï¼å¯¹å¤æä¾æå¡ã\n>  * RBDåºç¨ï¼ è¿ç±»åºç¨ä¹æ¯åºäºLibradosä¹ä¸çï¼ç»åä¸ºä¸é¢ä¸¤ç§åºç¨åºæ¯ã\n>    * ç¬¬ä¸ç§åºç¨åºæ¯ä¸ºèææºæä¾åè®¾å¤ãéè¿Librbdå¯ä»¥åå»ºä¸ä¸ªåè®¾å¤ï¼Containerï¼ï¼ç¶åéè¿QEMU/KVMéå å°VMä¸ãéè¿ContaineråVMçè§£è¦ï¼ä½¿å¾åè®¾å¤å¯ä»¥è¢«ç»å®å°ä¸åçVMä¸ã\n>    * ç¬¬äºç§åºç¨åºæ¯ä¸ºä¸»æºæä¾åè®¾å¤ãè¿ç§åºæ¯æ¯ä¼ ç»æä¹ä¸ççè§£çåå­å¨ã\n>    * ä»¥ä¸ä¸¤ç§æ¹å¼é½æ¯å°ä¸ä¸ªèæçåè®¾å¤åçå­å¨å¨RADOSä¸­ï¼é½ä¼å©ç¨æ°æ®æ¡å¸¦åæé«æ°æ®å¹¶è¡ä¼ è¾ï¼é½æ¯æåè®¾å¤çå¿«ç§ãCOWï¼Copy-On-Writeï¼åéãæéè¦çæ¯RBDè¿æ¯æLive migrationã\n>  * CephFSï¼Cephæä»¶ç³»ç»ï¼åºç¨ï¼ è¿ç±»åºç¨æ¯åºäºRADOSå®ç°çPBçº§åå¸å¼æä»¶ç³»ç»ï¼å¶ä¸­å¼å¥MDSï¼Meta Date Serverï¼,å®ä¸»è¦ä¸ºå¼å®¹POSIXæä»¶ç³»ç»æä¾åæ°æ®ï¼æ¯å¦æä»¶ç®å½åæä»¶åæ°æ®ãåæ¶MDSä¼å°åæ°æ®å­å¨å¨RADOSä¸­ï¼è¿æ ·åæ°æ®æ¬èº«ä¹è¾¾å°äºå¹¶è¡åï¼å¯ä»¥å¤§å¤§å å¿«æä»¶æä½çéåº¦ãMDSæ¬èº«ä¸ä¸ºClientæä¾æ°æ®æä»¶ï¼åªä¸ºClientæä¾å¯¹åæ°æ®çæä½ãå½Clientæå¼ä¸ä¸ªæä»¶æ¶ï¼ä¼æ¥è¯¢å¹¶æ´æ°MDSç¸åºçåæ°æ®ï¼å¦æä»¶åæ¬çå¯¹è±¡ä¿¡æ¯ï¼ï¼ç¶ååæ ¹æ®æä¾çå¯¹è±¡ä¿¡æ¯ç´æ¥ä»RADOSä¸­å¾å°æä»¶æ°æ®ã\n\n\n# ç¯å¢åå¤\n\nOS           HOSTNAME          IP                              ROLES\nCentos 7.5   pod4-core-20-10   192.168.20.10 / 192.168.30.10   ceph-deployãmonitorãManagersãrgwãmds\nCentos 7.5   pod4-core-20-5    192.168.20.5 / 192.168.30.5     monitorãManagersãrgwãmds\nCentos 7.5   pod4-core-20-6    192.168.20.6 / 192.168.30.6     monitorãManagersãrgwãmds\n\næ³¨ï¼æ¯ä¸ªèç¹æä¸¤åç¡¬çãä¸¤åç½å¡ä»¥ä¾¿æµè¯ï¼ä½¿ç¨ceph-deployå·¥å·é¨ç½²cephå­å¨ã\n\n\n# ç³»ç»åå§å\n\nç³»ç»åå§åè¿ä¸å°èçæææä½ï¼æ²¡æç¹å«æ³¨æçï¼åéå¨ææèç¹ä¸æ§è¡ã\n\n# å³é­é²ç«å¢åselinux\n\n# å³é²ç«å¢\n$ systemctl stop firewalld && systemctl disable firewalld\n\n# å³selinux\nsetenforce 0\nsed -i \'s#^SELINUX=.*#SELINUX=disabled#g\' /etc/selinux/config\nsed -i \'s#^SELINUX=.*#SELINUX=disabled#g\' /etc/sysconfig/selinux\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# ä¿®æ¹ä¸»æºå\n\n# å° HOSTNAME æ¿æ¢ä¸ºä½ å®éä¸»æºå\n$ hostnamectl set-hostname HOSTNAME\n\n\n# ææèç¹æ§è¡å·æ°çæ\nbash\nsource /etc/profile\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# éç½®hostsè§£æè®°å½\n\n$ cat >> /etc/hosts << EOF192.168.20.10 pod4-core-20-10192.168.20.5 pod4-core-20-5192.168.20.6 pod4-core-20-6EOF\n\n\n1\n\n\n# è°æ´åæ ¸åæ°\n\n$ cat > /etc/sysctl.conf << EOFkernel.sysrq = 0kernel.core_uses_pid = 1fs.file-max=655360kernel.msgmnb = 65536kernel.msgmax = 65536kernel.shmmax = 68719476736kernel.shmall = 4294967296kernel.pid_max = 655360net.ipv4.tcp_tw_reuse = 1net.ipv4.tcp_tw_recycle = 0net.ipv4.tcp_max_tw_buckets = 262144net.ipv4.tcp_fin_timeout = 30net.ipv4.tcp_timestamps = 0net.ipv4.tcp_sack = 1net.ipv4.tcp_window_scaling = 1net.ipv4.tcp_ecn = 0net.ipv4.tcp_keepalive_time = 600net.ipv4.tcp_keepalive_intvl = 30net.ipv4.tcp_keepalive_probes = 3net.ipv4.tcp_max_orphans = 655360net.ipv4.tcp_max_syn_backlog = 262144net.ipv4.tcp_mem = 65536 131072 262144net.ipv4.udp_mem = 65536 131072 262144net.ipv4.tcp_rmem = 4096 87380 16777216net.ipv4.tcp_wmem = 4096 16384 16777216net.ipv4.ip_local_port_range = 1024 65535net.ipv4.route.gc_timeout = 100# ç¦æ­¢icmpéå®åæ¥ænet.ipv4.conf.all.accept_redirects = 0# ç¦æ­¢icmpæºè·¯ç±net.ipv4.conf.all.accept_source_route = 0net.core.somaxconn = 65535net.core.rmem_default = 8388608net.core.wmem_default = 8388608net.core.rmem_max = 16777216net.core.wmem_max = 16777216net.core.netdev_max_backlog = 262144vm.swappiness = 3vm.overcommit_memory = 1vm.max_map_count = 262144EOF\n\n# å·æ°çæ\nsysctl -p\n\n\n1\n2\n3\n4\n\n\n# è°æ´æå¤§å¯æå¼æä»¶æ°\n\n$ mv /etc/security/limits.conf{,.bak}\ncat > /etc/security/limits.conf  << EOF*                -       nofile          650000*                -       memlock         unlimited*                -       stack           655360*                -       nproc           unlimitedEOF\n\n\n1\n2\n\n\n> æ§è¡æ­¤æä½åï¼éè¦éæ°æå¼ç»ç«¯ï¼æå¯çæã\n\n# éç½®ntp\n\n# éç½®ntpæå¡ç«¯\n\nå¨pod4-core-20-10ä¸æ§è¡è¿äºæ­¥éª¤ã\n\n# å®è£è½¯ä»¶å\n$ yum -y install chrony\n\n# ç¼è¾éç½®æä»¶\n$ mv /etc/chrony.conf{,.bak}\ncat > /etc/chrony.conf << EOFbindcmdaddress 0.0.0.0server ntp.aliyun.com iburstallow 192.168.20.0/24driftfile /var/lib/chrony/driftmakestep 1.0 3rtcsynclogdir /var/log/chronyEOF\n\n# å¯å¨chronyd\nsystemctl enable chronyd && systemctl restart chronyd \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# å¶ä»èç¹åæ­¥æ§å¶èç¹æ¶é´\n\nå¨å¶ä»ææèç¹æ§è¡æ­¤æä½ã\n\n# å®è£è½¯ä»¶å\n$ yum -y install chrony\n\n# ç¼è¾éç½®æä»¶\n$ mv /etc/chrony.conf{,.bak}\ncat > /etc/chrony.conf << EOFserver pod4-core-20-10 iburstdriftfile /var/lib/chrony/driftmakestep 1.0 3rtcsynclogdir /var/log/chronyEOF\n$ systemctl enable chronyd && systemctl restart chronyd \n\n# æå¥½åæå¨æµè¯ä¸ï¼å¯ä»¥åæ­¥æ¶é´\n$ yum -y install ntp\n$ ntpdate -u 192.168.20.10\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n# éç½®yumæº\n\n# æ´æ¢ä¸ºé¿éäºæº\n$ mkdir /etc/yum.repos.d/bak\nmv /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak/\n\nwget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo\nwget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\nyum clean all && yum makecache fast\n\n# éç½®ceph-nautilusæº\ncat > /etc/yum.repos.d/ceph.repo << "EOF"[ceph-norch]name=ceph-norchbaseurl=https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/noarch/enabled=1gpgcheck=0[ceph-x86_64]name=ceph-x86_64 baseurl=https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/enabled=1gpgcheck=0EOF\nyum clean all\nyum makecache fast\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥ä¸æ¥çæä½ï¼å¦ææ²¡æç¹æ®è¯´æï¼åå¨Â pod4-core-20-10èç¹æ§è¡ã\n\n# å®è£åºç¡å·¥å·\n\n$ yum -y install python-setuptools ceph-deploy\n\n$ ceph-deploy --version     # ç¡®ä¿ceph-deployçæ¬ä¸º2.0.1\n2.0.1\n\n\n1\n2\n3\n4\n\n\n# éç½®åå¯ç»å½å°å¶ä»èç¹\n\n$ ssh-keygen -t rsa -q\nfor i in 5 6 10;do ssh-copy-id pod4-core-20-$i;done     # æ ¹æ®æç¤ºè¾å¥ç¸åºå¯ç \n\n\n1\n2\n\n\n\n# é¨ç½²cephéç¾¤\n\næ¥ä¸æ¥çæä½ï¼å¦ææ²¡æç¹æ®è¯´æï¼åå¨Â pod4-core-20-10èç¹æ§è¡ã\n\n# é¨ç½²admin\n\nåå»ºä¸ä¸ªCephÂ Monitoråä¸ä¸ªCephÂ OSDå®æ¤è¿ç¨çCephå­å¨éç¾¤ãéç¾¤è¾¾å°ç¶æåï¼éè¿æ·»å ç¬¬åä¸ªCephÂ OSDå®æ¤ç¨åºï¼ä¸ä¸ªåæ°æ®æå¡å¨åä¸¤ä¸ªä»¥ä¸çCephÂ Monitorså¯¹å¶è¿è¡æ©å±ã\n\n$ mkdir my-cluster && cd my-cluster\n$ ceph-deploy new --public-network 192.168.20.0/24 \\\n  --cluster-network 192.168.30.0/24 pod4-core-20-10\n\n# --public-networkï¼å¯¹å¤ç½ç»ï¼ç¨äºå®¢æ·ç«¯è®¿é®\n# --cluster-networkï¼éç¾¤åé¨ä¿¡æ¯åæ­¥ç½ç»\n# pod4-core-20-10ï¼å°æ­¤èç¹è®¾ç½®ä¸ºMonitorèç¹\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸è¿°å½ä»¤æ§è¡åï¼è¾åºå¦ä¸ï¼\n\n\n\n$ ls    # å½ä»¤æ§è¡æååï¼ä¼çæéç½®æä»¶ãæ¥å¿æä»¶ãç§é¥æä»¶\nceph.conf  ceph-deploy-ceph.log  ceph.mon.keyring\n$ cat ceph.conf        # çæçéç½®æä»¶åå®¹å¦ä¸\n# å¦ææéè¯¯ä¹å¤ï¼å¯ä»¥æ ¹æ®èªå·±å®éæåµä¿®æ¹\n[global]\nfsid = 634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\npublic_network = 192.168.20.0/24\ncluster_network = 192.168.30.0/24\nmon_initial_members = pod4-core-20-10\nmon_host = 192.168.20.10\nauth_cluster_required = cephx\nauth_service_required = cephx\nauth_client_required = cephx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# å®è£cephè½¯ä»¶å\n\nä»å®è£cephè½¯ä»¶åæ­¤æä½å¨ææèç¹æ§è¡\n\n# ä¸è¦ä½¿ç¨å®æ¹æä¾ç ceph-deploy install å½ä»¤è¿è¡å®è£ï¼å®ä¼èªå·±åéç½®yumæºï¼å®è£è¾æ¢\n$ yum -y install ceph ceph-mon ceph-mgr ceph-radosgw ceph-mds\n\n\n1\n2\n\n\n# åå§åmonitor\n\næ¥ä¸æ¥çæä½ï¼å¦ææ²¡æç¹æ®è¯´æï¼åå¨Â pod4-core-20-10èç¹æ§è¡ã\n\n$ ceph-deploy mon create-initial\n\n\n1\n\n\n# æ·è´adminçç§é¥æä»¶\n\n# adminåé¢æå®cephéç¾¤ä¸­çææèç¹\n$ ceph-deploy admin pod4-core-20-10 pod4-core-20-5 pod4-core-20-6\n\n\n1\n2\n\n\n# ç¡®è®¤éç¾¤ç¶æ\n\n$ ceph -s\n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: HEALTH_OK\n\n  services:\n    mon: 1 daemons, quorum pod4-core-20-10 (age 2m)  # åå«ä¸ä¸ªmonitor\n    mgr: no daemons active\n    osd: 0 osds: 0 up, 0 in\n\n  data:\n    pools:   0 pools, 0 pgs\n    objects: 0 objects, 0 B\n    usage:   0 B used, 0 B / 0 B avail\n    pgs:     \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n# é¨ç½²manager\n\n# å°managerå®æ¤ç¨åºé¨ç½²å¨ pod4-core-20-10\n$ ceph-deploy mgr create pod4-core-20-10\n\n\n$ ceph -s     # æ¥çéç¾¤ç¶æ\n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: HEALTH_WARN\n            OSD count 0 < osd_pool_default_size 3\n\n  services:\n    mon: 1 daemons, quorum pod4-core-20-10 (age 8m)\n    mgr: pod4-core-20-10(active, since 41s)     # æ°å¢ä¸ä¸ªmanagerèç¹\n    osd: 0 osds: 0 up, 0 in\n\n  data:\n    pools:   0 pools, 0 pgs\n    objects: 0 objects, 0 B\n    usage:   0 B used, 0 B / 0 B avail\n    pgs:  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# åå»ºä¸ä¸ªOSD\n\næ¯ä¸ªæºå¨è³å°éè¦ä¸åå¨æ°ç¡¬çï¼ç¡®ä¿æ²¡æè¢«æ ¼å¼åè¿ã\n\n$ ceph-deploy osd create --data /dev/sdb pod4-core-20-10\nceph-deploy osd create --data /dev/sdb pod4-core-20-5\nceph-deploy osd create --data /dev/sdb pod4-core-20-6\n\n$ ceph -s      # æ¥çéç¾¤ç¶æ\n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: HEALTH_OK\n\n  services:\n    mon: 1 daemons, quorum pod4-core-20-10 (age 14m)\n    mgr: pod4-core-20-10(active, since 6m)\n    osd: 3 osds: 3 up (since 30s), 3 in (since 30s)     # åå«äºä¸ä¸ªosd\n\n  data:\n    pools:   0 pools, 0 pgs\n    objects: 0 objects, 0 B\n    usage:   3.0 GiB used, 57 GiB / 60 GiB avail\n    pgs:     \n\n\n$ ceph osd tree       # æ¥çosdè¯¦ç»ä¿¡æ¯\nID CLASS WEIGHT  TYPE NAME                STATUS REWEIGHT PRI-AFF \n-1       0.05846 root default                                     \n-3       0.01949     host pod4-core-20-10                         \n 0   hdd 0.01949         osd.0                up  1.00000 1.00000 \n-5       0.01949     host pod4-core-20-5                          \n 1   hdd 0.01949         osd.1                up  1.00000 1.00000 \n-7       0.01949     host pod4-core-20-6                          \n 2   hdd 0.01949         osd.2                up  1.00000 1.00000 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\n\n# cephéç¾¤æ©å®¹\n\n# æ©å®¹monitorèç¹\n\nä¸ä¸ªCephå­å¨éç¾¤è³å°éè¦ä¸ä¸ªCephÂ MonitoråCephÂ Manageræè½è¿è¡ãä¸ºäºè·å¾é«å¯ç¨æ§ï¼Cephå­å¨ç¾¤ééå¸¸è¿è¡å¤ä¸ªCephÂ Monitorï¼è¿æ ·å¯ä»¥é¿ååç¹æéã\n\nCephä½¿ç¨Paxosç®æ³ï¼èç¹æ°éæå¥½æ¯å¥æ°ï¼å³ï¼å¤§äºN / 2ï¼å¶ä¸­Næ¯Monitorçæ°éï¼æè½å½¢æä»²è£ãå°½ç®¡è¿ä¸æ¯å¿éçã\n\n# æ©å®¹ç¬¬ä¸ä¸ªmonitorèç¹\n\n# æ·»å  pod4-core-20-5ä¸ºmonitorèç¹\n$ ceph-deploy mon add pod4-core-20-5\n\n$ ceph quorum_status --format json-pretty  # æ£æ¥ä»²è£ç¶æ\n\n{\n    "election_epoch": 8,\n    "quorum": [\n        0,\n        1\n    ],\n    "quorum_names": [     # å å¥ä»²è£çèç¹\n        "pod4-core-20-10",\n        "pod4-core-20-5"\n    ],\n    "quorum_leader_name": "pod4-core-20-10",      # å½åleader\n    "quorum_age": 210,\n    "monmap": {\n        "epoch": 2,\n        "fsid": "634fc0a4-d2bd-4f14-af6b-421ecbb89ba6",\n        "modified": "2021-02-21 15:46:00.889286",\n        "created": "2021-02-21 15:21:30.739161",\n        "min_mon_release": 14,\n        "min_mon_release_name": "nautilus",\n        "features": {\n            "persistent": [\n                "kraken",\n                "luminous",\n                "mimic",\n                "osdmap-prune",\n                "nautilus"\n            ],\n            "optional": []\n        },\n        "mons": [\n            {\n                "rank": 0,\n                "name": "pod4-core-20-10",\n                "public_addrs": {\n                    "addrvec": [\n                        {\n                            "type": "v2",\n                            "addr": "192.168.20.10:3300",\n                            "nonce": 0\n                        },\n                        {\n                            "type": "v1",\n                            "addr": "192.168.20.10:6789",\n                            "nonce": 0\n                        }\n                    ]\n                },\n                "addr": "192.168.20.10:6789/0",\n                "public_addr": "192.168.20.10:6789/0"\n            },\n            {\n                "rank": 1,\n                "name": "pod4-core-20-5",\n                "public_addrs": {\n                    "addrvec": [\n                        {\n                            "type": "v2",\n                            "addr": "192.168.20.5:3300",\n                            "nonce": 0\n                        },\n                        {\n                            "type": "v1",\n                            "addr": "192.168.20.5:6789",\n                            "nonce": 0\n                        }\n                    ]\n                },\n                "addr": "192.168.20.5:6789/0",\n                "public_addr": "192.168.20.5:6789/0"\n            }\n        ]\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n\n\n# æ©å®¹ç¬¬äºä¸ªmonitorèç¹\n\n# æ·»å  pod4-core-20-6ä¸ºmonitorèç¹\n$ ceph-deploy mon add pod4-core-20-6\n\n# ç¡®è®¤ä¸ä¸ªèç¹å å¥ä»²è£\n$ ceph quorum_status --format json-pretty\n\n{\n    "election_epoch": 12,\n    "quorum": [\n        0,\n        1,\n        2\n    ],\n    "quorum_names": [\n        "pod4-core-20-10",\n        "pod4-core-20-5",\n        "pod4-core-20-6"\n    ],\n    "quorum_leader_name": "pod4-core-20-10",\n    "quorum_age": 30,\n\n      ....... # çç¥é¨åè¾åº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# æ£æ¥cephéç¾¤ç¶æ\n\n$ ceph -s\n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: HEALTH_OK\n\n  services:     #ç¡®ä¿æä¸ä¸ªmonitor\n    mon: 3 daemons, quorum pod4-core-20-10,pod4-core-20-5,pod4-core-20-6 (age 64s)\n    mgr: pod4-core-20-10(active, since 25m)\n    osd: 3 osds: 3 up (since 19m), 3 in (since 19m)\n\n  data:\n    pools:   0 pools, 0 pgs\n    objects: 0 objects, 0 B\n    usage:   3.0 GiB used, 57 GiB / 60 GiB avail\n    pgs: \n\n$ ceph mon stat     # ä¹å¯ä»¥åç¬æ¥çmonitorç¶æ\ne3: 3 mons at {pod4-core-20-10=[v2:192.168.20.10:3300/0,v1:192.168.20.10:6789/0],\npod4-core-20-5=[v2:192.168.20.5:3300/0,v1:192.168.20.5:6789/0],\npod4-core-20-6=[v2:192.168.20.6:3300/0,v1:192.168.20.6:6789/0]}, \nelection epoch 12, leader 0 pod4-core-20-10, quorum 0,1,2 \npod4-core-20-10,pod4-core-20-5,pod4-core-20-6\n\n$ ceph mon dump     # dumpæ¥çmonitorç¶æ\ndumped monmap epoch 3\nepoch 3\nfsid 634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\nlast_changed 2021-02-21 15:53:36.055686\ncreated 2021-02-21 15:21:30.739161\nmin_mon_release 14 (nautilus)\n0: [v2:192.168.20.10:3300/0,v1:192.168.20.10:6789/0] mon.pod4-core-20-10\n1: [v2:192.168.20.5:3300/0,v1:192.168.20.5:6789/0] mon.pod4-core-20-5\n2: [v2:192.168.20.6:3300/0,v1:192.168.20.6:6789/0] mon.pod4-core-20-6\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\n# æ©å®¹managerèç¹\n\nCephÂ Managerå®æ¤è¿ç¨ä»¥ active/standby æ¨¡å¼è¿è¡ãå½åactiveèç¹å®æºåï¼å¤äºstandbyç¶æçä¼èªå¨æåä¸ºactiveèç¹ã\n\n# å°pod4-core-20-5ãpod4-core-20-6æ·»å å°manageréç¾¤\n$ ceph-deploy mgr create pod4-core-20-5 pod4-core-20-6\n\n# æ·»å æååï¼ç¡®è®¤éç¾¤ç¶æ\n$ ceph -s      \n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: HEALTH_OK\n\n  services:\n    mon: 3 daemons, quorum pod4-core-20-10,pod4-core-20-5,pod4-core-20-6 (age 8m)\n    mgr: pod4-core-20-10(active, since 32m), standbys: pod4-core-20-5, pod4-core-20-6\n    osd: 3 osds: 3 up (since 26m), 3 in (since 26m)\n\n  data:\n    pools:   0 pools, 0 pgs\n    objects: 0 objects, 0 B\n    usage:   3.0 GiB used, 57 GiB / 60 GiB avail\n    pgs:     \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nè³æ­¤ï¼cephéç¾¤é¨ç½²å®æã\n\n----------------------------------------\n\nåæé¾æ¥ï¼\n\nhttps://lvjianzhao.gitee.io/lvjianzhao/posts/6010b413/?highlight=ceph\n\n> ',normalizedContent:'å­¦ä¹ cephç¬¬ä¸å¤©ï¼è®°å½ä¸cephéç¾¤é¨ç½²è¿ç¨\n\nåèææ¡£ï¼\n\n * å®æ¹ææ¡£ã\n * cephåºæ¬æ¦å¿µãåçãæ¶æä»ç»\n * ãåæãcephç³»ç»æ¶æä¸åºæ¬æ¦å¿µ\n\n\n# cephç®ä»\n\n# cephæ¶æ\n\n\n\n# cephÂ æ¯æä¸ç§æ¥å£\n\n>  * objectï¼æåççapiï¼èä¸ä¹å¼å®¹ swift å s3 ç api\n>  * blockï¼æ¯æç²¾ç®éç½®ãå¿«ç§ãåé\n>  * fileï¼posix æ¥å£ï¼æ¯æå¿«ç§\n\n# cephä¸»è¦ç¹ç¹\n\n>  * ç»ä¸å­å¨\n>  * æ ä»»ä½åç¹æé\n>  * æ°æ®å¤ä»½åä½\n>  * å­å¨å®¹éå¯æ©å±\n>  * èªå¨å®¹éåæéèªæ\n\n# cephæ ¸å¿ç»ä»¶åå¶ä½ç¨\n\n> å¨cephå­å¨éç¾¤ä¸­ï¼åå«äºä¸å¤§è§è²ç»ä»¶ï¼ä»ä»¬å¨cephå­å¨éç¾¤ä¸­è¡¨ç°ä¸º3ä¸ªå®æ¤è¿ç¨ï¼åå«æ¯cephÂ osdãmonitorãmanagersãå½ç¶è¿æå¶ä»çåè½ç»ä»¶ï¼ä½æ¯æä¸»è¦çæ¯è¿ä¸ä¸ªã\n> \n>  * cephÂ osdï¼Â cephçosdï¼object storage deviceï¼å®æ¤è¿ç¨ãä¸»è¦åè½åæ¬ï¼å­å¨æ°æ®ãå¯æ¬æ°æ®å¤çãæ°æ®æ¢å¤ãæ°æ®åè¡¥ãå¹³è¡¡æ°æ®åå¸ï¼å¹¶å°æ°æ®ç¸å³çä¸äºçæ§ä¿¡æ¯æä¾ç»cephÂ moniter,ä»¥ä¾¿cephÂ moniteræ¥æ£æ¥å¶ä»osdçå¿è·³ç¶æãä¸ä¸ªcephÂ osdå­å¨éç¾¤ï¼è¦æ±è³å°ä¸¤ä¸ªcephÂ osd,æè½ææçä¿å­ä¸¤ä»½æ°æ®ãæ³¨æï¼è¿éçä¸¤ä¸ªcephÂ osdæ¯æè¿è¡å¨ä¸¤å°ç©çæå¡å¨ä¸ï¼å¹¶ä¸æ¯å¨ä¸å°ç©çæå¡å¨ä¸è¿è¡ä¸¤ä¸ªcephÂ osdçå®æ¤è¿ç¨ãéå¸¸ï¼åä½åé«å¯ç¨æ§è³å°éè¦3ä¸ªcephÂ osdã\n>  * monitorï¼Â cephçmonitorå®æ¤è¿ç¨ï¼ä¸»è¦åè½æ¯ç»´æ¤éç¾¤ç¶æçè¡¨ç»ï¼è¿ä¸ªè¡¨ç»ä¸­åå«äºå¤å¼ è¡¨ï¼å¶ä¸­æmoniter mapãosd mapãpg(placement group) mapãcrush mapã è¿äºæ å°æ¯cephå®æ¤è¿ç¨ä¹é´ç¸äºåè°çå³é®ç°ç¶æã çè§å¨è¿è´è´£ç®¡çå®æ¤è¿ç¨åå®¢æ·ç«¯ä¹é´çèº«ä»½éªè¯ã éå¸¸éè¦è³å°ä¸ä¸ªçè§å¨æ¥å®ç°åä½åé«å¯ç¨æ§ã\n>  * managersï¼Â cephçmanagersï¼cephÂ managerï¼ï¼å®æ¤è¿ç¨ï¼ceph-mgrï¼è´è´£è·è¸ªè¿è¡æ¶é´ææ åcephç¾¤éçå½åç¶æï¼åæ¬å­å¨å©ç¨çï¼å½åæ§è½ææ åç³»ç»è´è½½ãÂ cephÂ managerå®æ¤ç¨åºè¿æç®¡åºäºpythonçæä»¶æ¥ç®¡çåå¬å¼cephéç¾¤ä¿¡æ¯ï¼åæ¬åºäºwebçä»ªè¡¨æ¿årest apiã éå¸¸ï¼è³å°æä¸¤åmanageréè¦é«å¯ç¨æ§ã\n>  * mdsï¼Â cephçmdsï¼metadata serverï¼å®æ¤è¿ç¨ï¼ä¸»è¦ä¿å­çæ¯cephæä»¶ç³»ç»çåæ°æ®ãæ³¨æï¼å¯¹äºcephçåè®¾å¤åcephå¯¹è±¡å­å¨é½ä¸éè¦cephÂ mdså®æ¤è¿ç¨ãcephÂ mdsä¸ºåºäºposixæä»¶ç³»ç»çç¨æ·æä¾äºä¸äºåºç¡å½ä»¤çæ§è¡ï¼æ¯å¦lsãfindç­ï¼è¿æ ·å¯ä»¥å¾å¤§ç¨åº¦éä½cephå­å¨éç¾¤çååã\n\n# cephåºç¨åºæ¯\n\n> cephçåºç¨åºæ¯ä¸»è¦ç±å®çæ¶æç¡®å®ï¼cephæä¾å¯¹è±¡å­å¨ãåå­å¨åæä»¶å­å¨ï¼ä¸»è¦ç±ä»¥ä¸4ç§åºç¨åºæ¯ï¼\n> \n>  * libradosåºç¨ï¼ éä¿çè¯´ï¼libradosæä¾äºåºç¨ç¨åºå¯¹radosçç´æ¥è®¿é®ï¼ç®ålibradoså·²ç»æä¾äºå¯¹cãc++ãjavaãpythonãrubyåphpçæ¯æãå®æ¯æåä¸ªåé¡¹çåå­æä½ï¼å¦åæ¶æ´æ°æ°æ®åå±æ§ãcasæä½ï¼åæ¶æå¯¹è±¡ç²åº¦çå¿«ç§æä½ãå®çå®ç°æ¯åºäºradosçæä»¶apiï¼ä¹å°±æ¯å¨radosä¸è¿è¡çå°è£åºã\n>  * radosgwåºç¨ï¼ è¿ç±»åºç¨åºäºlibradosä¹ä¸ï¼å¢å äºhttpåè®®ï¼æä¾restfulæ¥å£å¹¶ä¸å¼å®¹s3ãswfitæ¥å£ãradosgwå°cephéç¾¤ä½ä¸ºåå¸å¼å¯¹è±¡å­å¨ï¼å¯¹å¤æä¾æå¡ã\n>  * rbdåºç¨ï¼ è¿ç±»åºç¨ä¹æ¯åºäºlibradosä¹ä¸çï¼ç»åä¸ºä¸é¢ä¸¤ç§åºç¨åºæ¯ã\n>    * ç¬¬ä¸ç§åºç¨åºæ¯ä¸ºèææºæä¾åè®¾å¤ãéè¿librbdå¯ä»¥åå»ºä¸ä¸ªåè®¾å¤ï¼containerï¼ï¼ç¶åéè¿qemu/kvméå å°vmä¸ãéè¿containeråvmçè§£è¦ï¼ä½¿å¾åè®¾å¤å¯ä»¥è¢«ç»å®å°ä¸åçvmä¸ã\n>    * ç¬¬äºç§åºç¨åºæ¯ä¸ºä¸»æºæä¾åè®¾å¤ãè¿ç§åºæ¯æ¯ä¼ ç»æä¹ä¸ççè§£çåå­å¨ã\n>    * ä»¥ä¸ä¸¤ç§æ¹å¼é½æ¯å°ä¸ä¸ªèæçåè®¾å¤åçå­å¨å¨radosä¸­ï¼é½ä¼å©ç¨æ°æ®æ¡å¸¦åæé«æ°æ®å¹¶è¡ä¼ è¾ï¼é½æ¯æåè®¾å¤çå¿«ç§ãcowï¼copy-on-writeï¼åéãæéè¦çæ¯rbdè¿æ¯ælive migrationã\n>  * cephfsï¼cephæä»¶ç³»ç»ï¼åºç¨ï¼ è¿ç±»åºç¨æ¯åºäºradoså®ç°çpbçº§åå¸å¼æä»¶ç³»ç»ï¼å¶ä¸­å¼å¥mdsï¼meta date serverï¼,å®ä¸»è¦ä¸ºå¼å®¹posixæä»¶ç³»ç»æä¾åæ°æ®ï¼æ¯å¦æä»¶ç®å½åæä»¶åæ°æ®ãåæ¶mdsä¼å°åæ°æ®å­å¨å¨radosä¸­ï¼è¿æ ·åæ°æ®æ¬èº«ä¹è¾¾å°äºå¹¶è¡åï¼å¯ä»¥å¤§å¤§å å¿«æä»¶æä½çéåº¦ãmdsæ¬èº«ä¸ä¸ºclientæä¾æ°æ®æä»¶ï¼åªä¸ºclientæä¾å¯¹åæ°æ®çæä½ãå½clientæå¼ä¸ä¸ªæä»¶æ¶ï¼ä¼æ¥è¯¢å¹¶æ´æ°mdsç¸åºçåæ°æ®ï¼å¦æä»¶åæ¬çå¯¹è±¡ä¿¡æ¯ï¼ï¼ç¶ååæ ¹æ®æä¾çå¯¹è±¡ä¿¡æ¯ç´æ¥ä»radosä¸­å¾å°æä»¶æ°æ®ã\n\n\n# ç¯å¢åå¤\n\nos           hostname          ip                              roles\ncentos 7.5   pod4-core-20-10   192.168.20.10 / 192.168.30.10   ceph-deployãmonitorãmanagersãrgwãmds\ncentos 7.5   pod4-core-20-5    192.168.20.5 / 192.168.30.5     monitorãmanagersãrgwãmds\ncentos 7.5   pod4-core-20-6    192.168.20.6 / 192.168.30.6     monitorãmanagersãrgwãmds\n\næ³¨ï¼æ¯ä¸ªèç¹æä¸¤åç¡¬çãä¸¤åç½å¡ä»¥ä¾¿æµè¯ï¼ä½¿ç¨ceph-deployå·¥å·é¨ç½²cephå­å¨ã\n\n\n# ç³»ç»åå§å\n\nç³»ç»åå§åè¿ä¸å°èçæææä½ï¼æ²¡æç¹å«æ³¨æçï¼åéå¨ææèç¹ä¸æ§è¡ã\n\n# å³é­é²ç«å¢åselinux\n\n# å³é²ç«å¢\n$ systemctl stop firewalld && systemctl disable firewalld\n\n# å³selinux\nsetenforce 0\nsed -i \'s#^selinux=.*#selinux=disabled#g\' /etc/selinux/config\nsed -i \'s#^selinux=.*#selinux=disabled#g\' /etc/sysconfig/selinux\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# ä¿®æ¹ä¸»æºå\n\n# å° hostname æ¿æ¢ä¸ºä½ å®éä¸»æºå\n$ hostnamectl set-hostname hostname\n\n\n# ææèç¹æ§è¡å·æ°çæ\nbash\nsource /etc/profile\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# éç½®hostsè§£æè®°å½\n\n$ cat >> /etc/hosts << eof192.168.20.10 pod4-core-20-10192.168.20.5 pod4-core-20-5192.168.20.6 pod4-core-20-6eof\n\n\n1\n\n\n# è°æ´åæ ¸åæ°\n\n$ cat > /etc/sysctl.conf << eofkernel.sysrq = 0kernel.core_uses_pid = 1fs.file-max=655360kernel.msgmnb = 65536kernel.msgmax = 65536kernel.shmmax = 68719476736kernel.shmall = 4294967296kernel.pid_max = 655360net.ipv4.tcp_tw_reuse = 1net.ipv4.tcp_tw_recycle = 0net.ipv4.tcp_max_tw_buckets = 262144net.ipv4.tcp_fin_timeout = 30net.ipv4.tcp_timestamps = 0net.ipv4.tcp_sack = 1net.ipv4.tcp_window_scaling = 1net.ipv4.tcp_ecn = 0net.ipv4.tcp_keepalive_time = 600net.ipv4.tcp_keepalive_intvl = 30net.ipv4.tcp_keepalive_probes = 3net.ipv4.tcp_max_orphans = 655360net.ipv4.tcp_max_syn_backlog = 262144net.ipv4.tcp_mem = 65536 131072 262144net.ipv4.udp_mem = 65536 131072 262144net.ipv4.tcp_rmem = 4096 87380 16777216net.ipv4.tcp_wmem = 4096 16384 16777216net.ipv4.ip_local_port_range = 1024 65535net.ipv4.route.gc_timeout = 100# ç¦æ­¢icmpéå®åæ¥ænet.ipv4.conf.all.accept_redirects = 0# ç¦æ­¢icmpæºè·¯ç±net.ipv4.conf.all.accept_source_route = 0net.core.somaxconn = 65535net.core.rmem_default = 8388608net.core.wmem_default = 8388608net.core.rmem_max = 16777216net.core.wmem_max = 16777216net.core.netdev_max_backlog = 262144vm.swappiness = 3vm.overcommit_memory = 1vm.max_map_count = 262144eof\n\n# å·æ°çæ\nsysctl -p\n\n\n1\n2\n3\n4\n\n\n# è°æ´æå¤§å¯æå¼æä»¶æ°\n\n$ mv /etc/security/limits.conf{,.bak}\ncat > /etc/security/limits.conf  << eof*                -       nofile          650000*                -       memlock         unlimited*                -       stack           655360*                -       nproc           unlimitedeof\n\n\n1\n2\n\n\n> æ§è¡æ­¤æä½åï¼éè¦éæ°æå¼ç»ç«¯ï¼æå¯çæã\n\n# éç½®ntp\n\n# éç½®ntpæå¡ç«¯\n\nå¨pod4-core-20-10ä¸æ§è¡è¿äºæ­¥éª¤ã\n\n# å®è£è½¯ä»¶å\n$ yum -y install chrony\n\n# ç¼è¾éç½®æä»¶\n$ mv /etc/chrony.conf{,.bak}\ncat > /etc/chrony.conf << eofbindcmdaddress 0.0.0.0server ntp.aliyun.com iburstallow 192.168.20.0/24driftfile /var/lib/chrony/driftmakestep 1.0 3rtcsynclogdir /var/log/chronyeof\n\n# å¯å¨chronyd\nsystemctl enable chronyd && systemctl restart chronyd \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# å¶ä»èç¹åæ­¥æ§å¶èç¹æ¶é´\n\nå¨å¶ä»ææèç¹æ§è¡æ­¤æä½ã\n\n# å®è£è½¯ä»¶å\n$ yum -y install chrony\n\n# ç¼è¾éç½®æä»¶\n$ mv /etc/chrony.conf{,.bak}\ncat > /etc/chrony.conf << eofserver pod4-core-20-10 iburstdriftfile /var/lib/chrony/driftmakestep 1.0 3rtcsynclogdir /var/log/chronyeof\n$ systemctl enable chronyd && systemctl restart chronyd \n\n# æå¥½åæå¨æµè¯ä¸ï¼å¯ä»¥åæ­¥æ¶é´\n$ yum -y install ntp\n$ ntpdate -u 192.168.20.10\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n# éç½®yumæº\n\n# æ´æ¢ä¸ºé¿éäºæº\n$ mkdir /etc/yum.repos.d/bak\nmv /etc/yum.repos.d/*.repo /etc/yum.repos.d/bak/\n\nwget -o /etc/yum.repos.d/centos-base.repo https://mirrors.aliyun.com/repo/centos-7.repo\nwget -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\nyum clean all && yum makecache fast\n\n# éç½®ceph-nautilusæº\ncat > /etc/yum.repos.d/ceph.repo << "eof"[ceph-norch]name=ceph-norchbaseurl=https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/noarch/enabled=1gpgcheck=0[ceph-x86_64]name=ceph-x86_64 baseurl=https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/enabled=1gpgcheck=0eof\nyum clean all\nyum makecache fast\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥ä¸æ¥çæä½ï¼å¦ææ²¡æç¹æ®è¯´æï¼åå¨Â pod4-core-20-10èç¹æ§è¡ã\n\n# å®è£åºç¡å·¥å·\n\n$ yum -y install python-setuptools ceph-deploy\n\n$ ceph-deploy --version     # ç¡®ä¿ceph-deployçæ¬ä¸º2.0.1\n2.0.1\n\n\n1\n2\n3\n4\n\n\n# éç½®åå¯ç»å½å°å¶ä»èç¹\n\n$ ssh-keygen -t rsa -q\nfor i in 5 6 10;do ssh-copy-id pod4-core-20-$i;done     # æ ¹æ®æç¤ºè¾å¥ç¸åºå¯ç \n\n\n1\n2\n\n\n\n# é¨ç½²cephéç¾¤\n\næ¥ä¸æ¥çæä½ï¼å¦ææ²¡æç¹æ®è¯´æï¼åå¨Â pod4-core-20-10èç¹æ§è¡ã\n\n# é¨ç½²admin\n\nåå»ºä¸ä¸ªcephÂ monitoråä¸ä¸ªcephÂ osdå®æ¤è¿ç¨çcephå­å¨éç¾¤ãéç¾¤è¾¾å°ç¶æåï¼éè¿æ·»å ç¬¬åä¸ªcephÂ osdå®æ¤ç¨åºï¼ä¸ä¸ªåæ°æ®æå¡å¨åä¸¤ä¸ªä»¥ä¸çcephÂ monitorså¯¹å¶è¿è¡æ©å±ã\n\n$ mkdir my-cluster && cd my-cluster\n$ ceph-deploy new --public-network 192.168.20.0/24 \\\n  --cluster-network 192.168.30.0/24 pod4-core-20-10\n\n# --public-networkï¼å¯¹å¤ç½ç»ï¼ç¨äºå®¢æ·ç«¯è®¿é®\n# --cluster-networkï¼éç¾¤åé¨ä¿¡æ¯åæ­¥ç½ç»\n# pod4-core-20-10ï¼å°æ­¤èç¹è®¾ç½®ä¸ºmonitorèç¹\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nä¸è¿°å½ä»¤æ§è¡åï¼è¾åºå¦ä¸ï¼\n\n\n\n$ ls    # å½ä»¤æ§è¡æååï¼ä¼çæéç½®æä»¶ãæ¥å¿æä»¶ãç§é¥æä»¶\nceph.conf  ceph-deploy-ceph.log  ceph.mon.keyring\n$ cat ceph.conf        # çæçéç½®æä»¶åå®¹å¦ä¸\n# å¦ææéè¯¯ä¹å¤ï¼å¯ä»¥æ ¹æ®èªå·±å®éæåµä¿®æ¹\n[global]\nfsid = 634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\npublic_network = 192.168.20.0/24\ncluster_network = 192.168.30.0/24\nmon_initial_members = pod4-core-20-10\nmon_host = 192.168.20.10\nauth_cluster_required = cephx\nauth_service_required = cephx\nauth_client_required = cephx\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n# å®è£cephè½¯ä»¶å\n\nä»å®è£cephè½¯ä»¶åæ­¤æä½å¨ææèç¹æ§è¡\n\n# ä¸è¦ä½¿ç¨å®æ¹æä¾ç ceph-deploy install å½ä»¤è¿è¡å®è£ï¼å®ä¼èªå·±åéç½®yumæºï¼å®è£è¾æ¢\n$ yum -y install ceph ceph-mon ceph-mgr ceph-radosgw ceph-mds\n\n\n1\n2\n\n\n# åå§åmonitor\n\næ¥ä¸æ¥çæä½ï¼å¦ææ²¡æç¹æ®è¯´æï¼åå¨Â pod4-core-20-10èç¹æ§è¡ã\n\n$ ceph-deploy mon create-initial\n\n\n1\n\n\n# æ·è´adminçç§é¥æä»¶\n\n# adminåé¢æå®cephéç¾¤ä¸­çææèç¹\n$ ceph-deploy admin pod4-core-20-10 pod4-core-20-5 pod4-core-20-6\n\n\n1\n2\n\n\n# ç¡®è®¤éç¾¤ç¶æ\n\n$ ceph -s\n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: health_ok\n\n  services:\n    mon: 1 daemons, quorum pod4-core-20-10 (age 2m)  # åå«ä¸ä¸ªmonitor\n    mgr: no daemons active\n    osd: 0 osds: 0 up, 0 in\n\n  data:\n    pools:   0 pools, 0 pgs\n    objects: 0 objects, 0 b\n    usage:   0 b used, 0 b / 0 b avail\n    pgs:     \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n# é¨ç½²manager\n\n# å°managerå®æ¤ç¨åºé¨ç½²å¨ pod4-core-20-10\n$ ceph-deploy mgr create pod4-core-20-10\n\n\n$ ceph -s     # æ¥çéç¾¤ç¶æ\n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: health_warn\n            osd count 0 < osd_pool_default_size 3\n\n  services:\n    mon: 1 daemons, quorum pod4-core-20-10 (age 8m)\n    mgr: pod4-core-20-10(active, since 41s)     # æ°å¢ä¸ä¸ªmanagerèç¹\n    osd: 0 osds: 0 up, 0 in\n\n  data:\n    pools:   0 pools, 0 pgs\n    objects: 0 objects, 0 b\n    usage:   0 b used, 0 b / 0 b avail\n    pgs:  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n# åå»ºä¸ä¸ªosd\n\næ¯ä¸ªæºå¨è³å°éè¦ä¸åå¨æ°ç¡¬çï¼ç¡®ä¿æ²¡æè¢«æ ¼å¼åè¿ã\n\n$ ceph-deploy osd create --data /dev/sdb pod4-core-20-10\nceph-deploy osd create --data /dev/sdb pod4-core-20-5\nceph-deploy osd create --data /dev/sdb pod4-core-20-6\n\n$ ceph -s      # æ¥çéç¾¤ç¶æ\n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: health_ok\n\n  services:\n    mon: 1 daemons, quorum pod4-core-20-10 (age 14m)\n    mgr: pod4-core-20-10(active, since 6m)\n    osd: 3 osds: 3 up (since 30s), 3 in (since 30s)     # åå«äºä¸ä¸ªosd\n\n  data:\n    pools:   0 pools, 0 pgs\n    objects: 0 objects, 0 b\n    usage:   3.0 gib used, 57 gib / 60 gib avail\n    pgs:     \n\n\n$ ceph osd tree       # æ¥çosdè¯¦ç»ä¿¡æ¯\nid class weight  type name                status reweight pri-aff \n-1       0.05846 root default                                     \n-3       0.01949     host pod4-core-20-10                         \n 0   hdd 0.01949         osd.0                up  1.00000 1.00000 \n-5       0.01949     host pod4-core-20-5                          \n 1   hdd 0.01949         osd.1                up  1.00000 1.00000 \n-7       0.01949     host pod4-core-20-6                          \n 2   hdd 0.01949         osd.2                up  1.00000 1.00000 \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\n\n# cephéç¾¤æ©å®¹\n\n# æ©å®¹monitorèç¹\n\nä¸ä¸ªcephå­å¨éç¾¤è³å°éè¦ä¸ä¸ªcephÂ monitoråcephÂ manageræè½è¿è¡ãä¸ºäºè·å¾é«å¯ç¨æ§ï¼cephå­å¨ç¾¤ééå¸¸è¿è¡å¤ä¸ªcephÂ monitorï¼è¿æ ·å¯ä»¥é¿ååç¹æéã\n\ncephä½¿ç¨paxosç®æ³ï¼èç¹æ°éæå¥½æ¯å¥æ°ï¼å³ï¼å¤§äºn / 2ï¼å¶ä¸­næ¯monitorçæ°éï¼æè½å½¢æä»²è£ãå°½ç®¡è¿ä¸æ¯å¿éçã\n\n# æ©å®¹ç¬¬ä¸ä¸ªmonitorèç¹\n\n# æ·»å  pod4-core-20-5ä¸ºmonitorèç¹\n$ ceph-deploy mon add pod4-core-20-5\n\n$ ceph quorum_status --format json-pretty  # æ£æ¥ä»²è£ç¶æ\n\n{\n    "election_epoch": 8,\n    "quorum": [\n        0,\n        1\n    ],\n    "quorum_names": [     # å å¥ä»²è£çèç¹\n        "pod4-core-20-10",\n        "pod4-core-20-5"\n    ],\n    "quorum_leader_name": "pod4-core-20-10",      # å½åleader\n    "quorum_age": 210,\n    "monmap": {\n        "epoch": 2,\n        "fsid": "634fc0a4-d2bd-4f14-af6b-421ecbb89ba6",\n        "modified": "2021-02-21 15:46:00.889286",\n        "created": "2021-02-21 15:21:30.739161",\n        "min_mon_release": 14,\n        "min_mon_release_name": "nautilus",\n        "features": {\n            "persistent": [\n                "kraken",\n                "luminous",\n                "mimic",\n                "osdmap-prune",\n                "nautilus"\n            ],\n            "optional": []\n        },\n        "mons": [\n            {\n                "rank": 0,\n                "name": "pod4-core-20-10",\n                "public_addrs": {\n                    "addrvec": [\n                        {\n                            "type": "v2",\n                            "addr": "192.168.20.10:3300",\n                            "nonce": 0\n                        },\n                        {\n                            "type": "v1",\n                            "addr": "192.168.20.10:6789",\n                            "nonce": 0\n                        }\n                    ]\n                },\n                "addr": "192.168.20.10:6789/0",\n                "public_addr": "192.168.20.10:6789/0"\n            },\n            {\n                "rank": 1,\n                "name": "pod4-core-20-5",\n                "public_addrs": {\n                    "addrvec": [\n                        {\n                            "type": "v2",\n                            "addr": "192.168.20.5:3300",\n                            "nonce": 0\n                        },\n                        {\n                            "type": "v1",\n                            "addr": "192.168.20.5:6789",\n                            "nonce": 0\n                        }\n                    ]\n                },\n                "addr": "192.168.20.5:6789/0",\n                "public_addr": "192.168.20.5:6789/0"\n            }\n        ]\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n\n\n# æ©å®¹ç¬¬äºä¸ªmonitorèç¹\n\n# æ·»å  pod4-core-20-6ä¸ºmonitorèç¹\n$ ceph-deploy mon add pod4-core-20-6\n\n# ç¡®è®¤ä¸ä¸ªèç¹å å¥ä»²è£\n$ ceph quorum_status --format json-pretty\n\n{\n    "election_epoch": 12,\n    "quorum": [\n        0,\n        1,\n        2\n    ],\n    "quorum_names": [\n        "pod4-core-20-10",\n        "pod4-core-20-5",\n        "pod4-core-20-6"\n    ],\n    "quorum_leader_name": "pod4-core-20-10",\n    "quorum_age": 30,\n\n      ....... # çç¥é¨åè¾åº\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\n# æ£æ¥cephéç¾¤ç¶æ\n\n$ ceph -s\n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: health_ok\n\n  services:     #ç¡®ä¿æä¸ä¸ªmonitor\n    mon: 3 daemons, quorum pod4-core-20-10,pod4-core-20-5,pod4-core-20-6 (age 64s)\n    mgr: pod4-core-20-10(active, since 25m)\n    osd: 3 osds: 3 up (since 19m), 3 in (since 19m)\n\n  data:\n    pools:   0 pools, 0 pgs\n    objects: 0 objects, 0 b\n    usage:   3.0 gib used, 57 gib / 60 gib avail\n    pgs: \n\n$ ceph mon stat     # ä¹å¯ä»¥åç¬æ¥çmonitorç¶æ\ne3: 3 mons at {pod4-core-20-10=[v2:192.168.20.10:3300/0,v1:192.168.20.10:6789/0],\npod4-core-20-5=[v2:192.168.20.5:3300/0,v1:192.168.20.5:6789/0],\npod4-core-20-6=[v2:192.168.20.6:3300/0,v1:192.168.20.6:6789/0]}, \nelection epoch 12, leader 0 pod4-core-20-10, quorum 0,1,2 \npod4-core-20-10,pod4-core-20-5,pod4-core-20-6\n\n$ ceph mon dump     # dumpæ¥çmonitorç¶æ\ndumped monmap epoch 3\nepoch 3\nfsid 634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\nlast_changed 2021-02-21 15:53:36.055686\ncreated 2021-02-21 15:21:30.739161\nmin_mon_release 14 (nautilus)\n0: [v2:192.168.20.10:3300/0,v1:192.168.20.10:6789/0] mon.pod4-core-20-10\n1: [v2:192.168.20.5:3300/0,v1:192.168.20.5:6789/0] mon.pod4-core-20-5\n2: [v2:192.168.20.6:3300/0,v1:192.168.20.6:6789/0] mon.pod4-core-20-6\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\n# æ©å®¹managerèç¹\n\ncephÂ managerå®æ¤è¿ç¨ä»¥ active/standby æ¨¡å¼è¿è¡ãå½åactiveèç¹å®æºåï¼å¤äºstandbyç¶æçä¼èªå¨æåä¸ºactiveèç¹ã\n\n# å°pod4-core-20-5ãpod4-core-20-6æ·»å å°manageréç¾¤\n$ ceph-deploy mgr create pod4-core-20-5 pod4-core-20-6\n\n# æ·»å æååï¼ç¡®è®¤éç¾¤ç¶æ\n$ ceph -s      \n  cluster:\n    id:     634fc0a4-d2bd-4f14-af6b-421ecbb89ba6\n    health: health_ok\n\n  services:\n    mon: 3 daemons, quorum pod4-core-20-10,pod4-core-20-5,pod4-core-20-6 (age 8m)\n    mgr: pod4-core-20-10(active, since 32m), standbys: pod4-core-20-5, pod4-core-20-6\n    osd: 3 osds: 3 up (since 26m), 3 in (since 26m)\n\n  data:\n    pools:   0 pools, 0 pgs\n    objects: 0 objects, 0 b\n    usage:   3.0 gib used, 57 gib / 60 gib avail\n    pgs:     \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nè³æ­¤ï¼cephéç¾¤é¨ç½²å®æã\n\n----------------------------------------\n\nåæé¾æ¥ï¼\n\nhttps://lvjianzhao.gitee.io/lvjianzhao/posts/6010b413/?highlight=ceph\n\n> ',charsets:{cjk:!0}},{title:"glusterfs",frontmatter:{title:"glusterfs",categories:"glusterfs",tags:["åå¸å¼æä»¶ç³»ç»"],date:"2022-12-09T20:47:55.000Z",permalink:"/pages/70e7ad/",readingShow:"top",description:"GlusterFSæä»¶å­å¨ä»ç»",meta:[{name:"twitter:title",content:"glusterfs"},{name:"twitter:description",content:"GlusterFSæä»¶å­å¨ä»ç»"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/06.%E5%AD%98%E5%82%A8/02.glusterfs.html"},{property:"og:type",content:"article"},{property:"og:title",content:"glusterfs"},{property:"og:description",content:"GlusterFSæä»¶å­å¨ä»ç»"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/06.%E5%AD%98%E5%82%A8/02.glusterfs.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:47:55.000Z"},{property:"article:tag",content:"åå¸å¼æä»¶ç³»ç»"},{itemprop:"name",content:"glusterfs"},{itemprop:"description",content:"GlusterFSæä»¶å­å¨ä»ç»"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/06.%E5%AD%98%E5%82%A8/02.glusterfs.html",relativePath:"04.è¿ç»´/06.å­å¨/02.glusterfs.md",key:"v-ed9b282c",path:"/pages/70e7ad/",headersStr:null,content:"GlusterFSæä»¶å­å¨ä»ç»\n\nåæé¾æ¥ï¼https://www.viayc.com/categories/GlusterFS/\n\nè¯´æ\n\nç®ä»\n\n1234567891011   GLUSTERFS æ¯ SCALE-OUT å­å¨è§£å³æ¹æ¡ GLUSTER çæ ¸å¿ï¼å®æ¯ä¸ä¸ªå¼æºçåå¸å¼æä»¶ç³»ç»ï¼\n                å·æå¼ºå¤§çæ¨ªåæ©å±è½åï¼éè¿æ©å±è½å¤æ¯ææ° PB å­å¨å®¹éåå¤çæ°åå®¢æ·ç«¯ã GLUSTERFS åå© TCP/IP æ\n                INFINIBAND RDMA ç½ç»å°ç©çåå¸çå­å¨èµæºèéå¨ä¸èµ·ï¼ä½¿ç¨åä¸å¨å±å½åç©ºé´æ¥ç®¡çæ°æ®ã GLUSTERFS\n                åºäºå¯å å çç¨æ·ç©ºé´è®¾è®¡ï¼å¯ä¸ºåç§ä¸åçæ°æ®è´è½½æä¾ä¼å¼çæ§è½ã GLUSTERFS æ¯æè¿è¡å¨ä»»ä½ IP\n                ç½ç»ä¸çæ ååºç¨ç¨åºçæ åå®¢æ·ç«¯ï¼ç¨æ·å¯ä»¥å¨å¨å±ç»ä¸çå½åç©ºé´ä¸­ä½¿ç¨ NFS/CIFS ç­æ ååè®®æ¥è®¿é®åºç¨æ°æ®ã\n                GLUSTERFS\n                ä½¿å¾ç¨æ·å¯æè±åæçç¬ç«ãé«ææ¬çå°é­å­å¨ç³»ç»ï¼è½å¤å©ç¨æ®éå»ä»·çå­å¨è®¾å¤æ¥é¨ç½²å¯éä¸­ç®¡çãæ¨ªåæ©å±ãèæåçå­å¨æ± ï¼å­å¨å®¹éå¯æ©å±è³\n                TB/PB çº§ã ç®å GLUSTERFS å·²è¢« RED HAT\n                æ¶è´­ï¼å®çå®ç½æ¯ï¼HTTPS://WWW.GLUSTER.ORG/\n                \n\nGlusterFS å¨ä¼ä¸ä¸­çåºç¨åºæ¯\n\nçè®ºåå®è·µä¸åæï¼GlusterFS ç®åä¸»è¦éç¨äºå¤§æä»¶å­å¨åºæ¯ï¼å¯¹äºå°æä»¶å°¤å¶æ¯æµ·éå°æä»¶ï¼å­å¨æçåè®¿é®æ§è½é½è¡¨ç°ä¸ä½³ãå»ºè®®å­æ¾æä»¶å¤§å°å¤§äº 1MB\n\nGlusterFS å®è£\n\nç¯å¢è¯´æ\n\n * CentOS 7\n * GlusterFS\n\n3 å°æºå¨å®è£ GlusterFS ç»æä¸ä¸ªéç¾¤ã\n\n12345678910111213   æå¡å¨ï¼10.1.0.1110.1.0.1210.1.0.13 éç½® HOSTS 10.1.0.11\n                    MANAGER10.1.0.12 NODE-110.1.0.13 NODE-2 CLIENT:10.1.0.10\n                    CLIENT\n                    \n\nå®è£ GlusterFS\n\nCentOS å®è£ GlusterFS éå¸¸çç®å\n\nå¨ä¸ä¸ªèç¹é½å®è£ GlusterFS\n\n12345   # å®è£ GLUSTERFS YUM æºæä»¶#YUM INSTALL CENTOS-RELEASE-GLUSTER #\n        å®è£ GLUSTERFS è½¯ä»¶YUM INSTALL -Y GLUSTERFS GLUSTERFS-SERVER\n        GLUSTERFS-FUSE GLUSTERFS-RDMA\n        \n\nå¯å¨ GlusterFS\n\n1234567891011121314   [ROOT@MANAGER ~]#SYSTEMCTL START\n                      GLUSTERD.SERVICE[ROOT@MANAGER ~]#SYSTEMCTL ENABLE\n                      GLUSTERD.SERVICE[ROOT@MANAGER ~]#SYSTEMCTL STATUS\n                      GLUSTERD.SERVICEâ GLUSTERD.SERVICE - GLUSTERFS, A CLUSTERED\n                      FILE-SYSTEM SERVER LOADED: LOADED\n                      (/USR/LIB/SYSTEMD/SYSTEM/GLUSTERD.SERVICE; DISABLED; VENDOR\n                      PRESET: DISABLED) ACTIVE: ACTIVE (RUNNING) SINCE ä¸\n                      2017-02-27 17:55:56 CST; 11S AGO PROCESS: 5476\n                      EXECSTART=/USR/SBIN/GLUSTERD -P /VAR/RUN/GLUSTERD.PID\n                      --LOG-LEVEL $LOG_LEVEL $GLUSTERD_OPTIONS (CODE=EXITED,\n                      STATUS=0/SUCCESS)MAIN PID: 5477 (GLUSTERD) MEMORY: 15.0M\n                      CGROUP: /SYSTEM.SLICE/GLUSTERD.SERVICE ââ5477\n                      /USR/SBIN/GLUSTERD -P /VAR/RUN/GLUSTERD.PID --LOG-LEVEL INFO\n                      2 æ 27 17:55:56 MEETBILL SYSTEMD[1]: STARTING GLUSTERFS, A\n                      CLUSTERED FILE-SYSTEM SERVER...2 æ 27 17:55:56 MEETBILL\n                      SYSTEMD[1]: STARTED GLUSTERFS, A CLUSTERED FILE-SYSTEM\n                      SERVER.\n                      \n\néç½® GlusterFS\n\nå¨ manager èç¹ä¸éç½®ï¼å° èç¹ å å¥å° éç¾¤ä¸­ã\n\n12345678   [ROOT@MANAGER ~]#GLUSTER PEER PROBE MANAGERPEER PROBE:\n           SUCCESS. PROBE ON LOCALHOST NOT NEEDED [ROOT@MANAGER\n           ~]#GLUSTER PEER PROBE NODE-1PEER PROBE: SUCCESS.\n           [ROOT@MANAGER ~]#GLUSTER PEER PROBE NODE-2PEER PROBE:\n           SUCCESS.\n           \n\næ¥çéç¾¤ç¶æï¼\n\n12345678910   [ROOT@MANAGER ~]#GLUSTER PEER STATUSNUMBER OF PEERS: 2\n              HOSTNAME: NODE-1UUID:\n              41573E8B-EB00-4802-84F0-F923A2C7BE79STATE: PEER IN CLUSTER\n              (CONNECTED) HOSTNAME: NODE-2UUID:\n              DA068E0B-EADA-4A50-94FF-623F630986D7STATE: PEER IN CLUSTER\n              (CONNECTED)\n              \n\nåå»ºæ°æ®å­å¨ç®å½ï¼\n\n123   [ROOT@MANAGER ~]#MKDIR -P /OPT/GLUSTER/DATA[ROOT@NODE-1 ~]#\n      MKDIR -P /OPT/GLUSTER/DATA[ROOT@NODE-2 ~]# MKDIR -P\n      /OPT/GLUSTER/DATA\n      \n\næ¥ç volume ç¶æï¼\n\n12   [ROOT@MANAGER ~]#GLUSTER VOLUME INFONO VOLUMES PRESENT\n     \n\nvolume æ¨¡å¼è¯´æ\n\nä¸ã é»è®¤æ¨¡å¼ï¼æ¢ DHT, ä¹å« åå¸å·ï¼å°æä»¶å·² hash ç®æ³éæºåå¸å° ä¸å°æå¡å¨èç¹ä¸­å­å¨ã\n\n1   GLUSTER VOLUME CREATE TEST-VOLUME SERVER1:/EXP1\n    SERVER2:/EXP2\n    \n\näºã å¤å¶æ¨¡å¼ï¼æ¢ AFR, åå»º volume æ¶å¸¦ replica x æ°éï¼å°æä»¶å¤å¶å° replica x ä¸ªèç¹ä¸­ã\n\n1   GLUSTER VOLUME CREATE TEST-VOLUME REPLICA 2 TRANSPORT TCP\n    SERVER1:/EXP1 SERVER2:/EXP2\n    \n\nä¸ã æ¡å¸¦æ¨¡å¼ï¼æ¢ Striped, åå»º volume æ¶å¸¦ stripe x æ°éï¼ å°æä»¶åå²ææ°æ®åï¼åå«å­å¨å° stripe x ä¸ªèç¹ä¸­ ( ç±»ä¼¼ raid 0 )ã\n\n1   GLUSTER VOLUME CREATE TEST-VOLUME STRIPE 2 TRANSPORT TCP\n    SERVER1:/EXP1 SERVER2:/EXP2\n    \n\nåã åå¸å¼æ¡å¸¦æ¨¡å¼ï¼ç»ååï¼ï¼æå°éè¦ 4 å°æå¡å¨æè½åå»ºã åå»º volume æ¶ stripe 2 server = 4 ä¸ªèç¹ï¼ æ¯ DHT ä¸ Striped çç»ååã\n\n1   GLUSTER VOLUME CREATE TEST-VOLUME STRIPE 2 TRANSPORT TCP\n    SERVER1:/EXP1 SERVER2:/EXP2 SERVER3:/EXP3 SERVER4:/EXP4\n    \n\näºã åå¸å¼å¤å¶æ¨¡å¼ï¼ç»ååï¼, æå°éè¦ 4 å°æå¡å¨æè½åå»ºã åå»º volume æ¶ replica 2 server = 4 ä¸ªèç¹ï¼æ¯ DHT ä¸ AFR çç»ååã\n\n1   GLUSTER VOLUME CREATE TEST-VOLUME REPLICA 2 TRANSPORT TCP\n    SERVER1:/EXP1 SERVER2:/EXP2ãSERVER3:/EXP3 SERVER4:/EXP4\n    \n\nå­ã æ¡å¸¦å¤å¶å·æ¨¡å¼ï¼ç»ååï¼, æå°éè¦ 4 å°æå¡å¨æè½åå»ºã åå»º volume æ¶ stripe 2 replica 2 server = 4 ä¸ªèç¹ï¼ æ¯ Striped ä¸ AFR çç»ååã\n\n1   GLUSTER VOLUME CREATE TEST-VOLUME STRIPE 2 REPLICA 2\n    TRANSPORT TCP SERVER1:/EXP1 SERVER2:/EXP2 SERVER3:/EXP3\n    SERVER4:/EXP4\n    \n\nä¸ã ä¸ç§æ¨¡å¼æ··åï¼è³å°éè¦ 8 å° æå¡å¨æè½åå»ºã stripe 2 replica 2 , æ¯ 4 ä¸ªèç¹ ç»æä¸ä¸ª ç»ã\n\n1   GLUSTER VOLUME CREATE TEST-VOLUME STRIPE 2 REPLICA 2\n    TRANSPORT TCP SERVER1:/EXP1 SERVER2:/EXP2 SERVER3:/EXP3\n    SERVER4:/EXP4 SERVER5:/EXP5 SERVER6:/EXP6 SERVER7:/EXP7\n    SERVER8:/EXP8\n    \n\nåå»º GlusterFS ç£ç\n\n12   [ROOT@MANAGER ~]#GLUSTER VOLUME CREATE MODELS REPLICA 3\n     MANAGER:/OPT/GLUSTER/DATA NODE-1:/OPT/GLUSTER/DATA\n     NODE-2:/OPT/GLUSTER/DATA FORCEVOLUME CREATE: MODELS:\n     SUCCESS: PLEASE START THE VOLUME TO ACCESS DATA\n     \n\nåæ¥ç volume ç¶æï¼\n\n1234567891011121314   [ROOT@MANAGER ~]#GLUSTER VOLUME INFO VOLUME NAME:\n                      MODELSTYPE: REPLICATEVOLUME ID:\n                      E539FF3B-2278-4F3F-A594-1F101EABBF1ESTATUS: CREATEDNUMBER OF\n                      BRICKS: 1 X 3 = 3TRANSPORT-TYPE: TCPBRICKS:BRICK1:\n                      MANAGER:/OPT/GLUSTER/DATABRICK2:\n                      NODE-1:/OPT/GLUSTER/DATABRICK3:\n                      NODE-2:/OPT/GLUSTER/DATAOPTIONS\n                      RECONFIGURED:PERFORMANCE.READDIR-AHEAD: ON\n                      \n\nå¯å¨ models\n\n12   [ROOT@MANAGER ~]#GLUSTER VOLUME START MODELSVOLUME START:\n     MODELS: SUCCESS\n     \n\nGlusterFS å®¢æ·ç«¯\n\né¨ç½² GlusterFS å®¢æ·ç«¯å¹¶ mount GlusterFS æä»¶ç³»ç»\n\n123   [ROOT@CLIENT ~]#YUM INSTALL -Y GLUSTERFS\n      GLUSTERFS-FUSE[ROOT@CLIENT ~]#MKDIR -P\n      /OPT/GFSMNT[ROOT@CLIENT ~]#MOUNT -T GLUSTERFS MANAGER:MODELS\n      /OPT/GFSMNT/\n      \n\n1234567891011   [ROOT@NODE-94 ~]#DF -Hæä»¶ç³»ç» å®¹é å·²ç¨ å¯ç¨ å·²ç¨ %\n                æè½½ç¹/DEV/MAPPER/VG001-ROOT 98G 1.2G 97G 2% /DEVTMPFS 32G 0\n                32G 0% /DEVTMPFS 32G 0 32G 0% /DEV/SHMTMPFS 32G 130M 32G 1%\n                /RUNTMPFS 32G 0 32G 0% /SYS/FS/CGROUP/DEV/MAPPER/VG001-OPT\n                441G 71G 370G 17% /OPT/DEV/SDA2 497M 153M 344M 31%\n                /BOOTTMPFS 6.3G 0 6.3G 0% /RUN/USER/0MANAGER:MODELS 441G 18G\n                424G 4% /OPT/GFSMNT\n                \n\nç»´æ¤\n\n 1. æ¥ç GlusterFS ä¸­ææç volume:\n\n1   [ROOT@MANAGER ~]#GLUSTER VOLUME LIST\n    \n\n 1. å é¤ GlusterFS ç£çï¼\n\n12   [ROOT@MANAGER ~]#GLUSTER VOLUME STOP MODELS #åæ­¢åå­ä¸º MODELS\n     çç£ç[ROOT@MANAGER ~]#GLUSTER VOLUME DELETE MODELS #å é¤åå­ä¸º\n     MODELS çç£ç\n     \n\næ³¨ï¼ å é¤ ç£ç ä»¥åï¼å¿é¡»å é¤ ç£ç ( /opt/gluster/data ) ä¸­ç ï¼ .glusterfs/ .trashcan/ ï¼ç®å½ã\n\nå¦ååå»ºæ° volume ç¸åç ç£ç ä¼åºç°æä»¶ ä¸åå¸ï¼æè ç±»å éä¹± çé®é¢ã\n\n 1. å¸è½½æä¸ªèç¹ GlusterFS ç£ç\n\n1   [ROOT@MANAGER ~]#GLUSTER PEER DETACH NODE-2\n    \n\n 1. è®¾ç½®è®¿é®éå¶ï¼æç§æ¯ä¸ª volume æ¥éå¶\n\n1   [ROOT@MANAGER ~]#GLUSTER VOLUME SET MODELS AUTH.ALLOW\n    10.6.0.,10.7.0.\n    \n\n 1. æ·»å  GlusterFS èç¹ï¼\n\n12   [ROOT@MANAGER ~]#GLUSTER PEER PROBE NODE-3[ROOT@MANAGER\n     ~]#GLUSTER VOLUME ADD-BRICK MODELS NODE-3:/OPT/GLUSTER/DATA\n     \n\næ³¨ï¼å¦ææ¯å¤å¶å·æèæ¡å¸¦å·ï¼åæ¯æ¬¡æ·»å ç Brick æ°å¿é¡»æ¯ replica æè stripe çæ´æ°å\n\n 1. éç½®å·\n\n1   [ROOT@MANAGER ~]# GLUSTER VOLUME SET\n    \n\n 1. ç¼©å®¹ volume:\n\nåå°æ°æ®è¿ç§»å°å¶å®å¯ç¨ç Brickï¼è¿ç§»ç»æåæå°è¯¥ Brick ç§»é¤ï¼\n\n1   [ROOT@MANAGER ~]#GLUSTER VOLUME REMOVE-BRICK MODELS\n    NODE-2:/OPT/GLUSTER/DATA NODE-3:/OPT/GLUSTER/DATA START\n    \n\nå¨æ§è¡äº start ä¹åï¼å¯ä»¥ä½¿ç¨ status å½ä»¤æ¥çç§»é¤è¿åº¦ï¼\n\n1   [ROOT@MANAGER ~]#GLUSTER VOLUME REMOVE-BRICK MODELS\n    NODE-2:/OPT/GLUSTER/DATA NODE-3:/OPT/GLUSTER/DATA STATUS\n    \n\nä¸è¿è¡æ°æ®è¿ç§»ï¼ç´æ¥å é¤è¯¥ Brickï¼\n\n1   [ROOT@MANAGER ~]#GLUSTER VOLUME REMOVE-BRICK MODELS\n    NODE-2:/OPT/GLUSTER/DATA NODE-3:/OPT/GLUSTER/DATA COMMIT\n    \n\næ³¨æï¼å¦ææ¯å¤å¶å·æèæ¡å¸¦å·ï¼åæ¯æ¬¡ç§»é¤ç Brick æ°å¿é¡»æ¯ replica æè stripe çæ´æ°åã\n\næ©å®¹ï¼\n\n1   GLUSTER VOLUME ADD-BRICK MODELS NODE-2:/OPT/GLUSTER/DATA\n    \n\n 1. ä¿®å¤å½ä»¤ï¼\n\n1   [ROOT@MANAGER ~]#GLUSTER VOLUME REPLACE-BRICK MODELS\n    NODE-2:/OPT/GLUSTER/DATA NODE-3:/OPT/GLUSTER/DATA COMMIT\n    -FORCE\n    \n\n 1. è¿ç§» volume:\n\n1   [ROOT@MANAGER ~]#GLUSTER VOLUME REPLACE-BRICK MODELS\n    NODE-2:/OPT/GLUSTER/DATA NODE-3:/OPT/GLUSTER/DATA START\n    \n\npause ä¸ºæåè¿ç§»\n\n1   [ROOT@MANAGER ~]#GLUSTER VOLUME REPLACE-BRICK MODELS\n    NODE-2:/OPT/GLUSTER/DATA NODE-3:/OPT/GLUSTER/DATA PAUSE\n    \n\nabort ä¸ºç»æ­¢è¿ç§»\n\n1   [ROOT@MANAGER ~]#GLUSTER VOLUME REPLACE-BRICK MODELS\n    NODE-2:/OPT/GLUSTER/DATA NODE-3:/OPT/GLUSTER/DATA ABORT\n    \n\nstatus æ¥çè¿ç§»ç¶æ\n\n1   [ROOT@MANAGER ~]#GLUSTER VOLUME REPLACE-BRICK MODELS\n    NODE-2:/OPT/GLUSTER/DATA NODE-3:/OPT/GLUSTER/DATA STATUS\n    \n\nè¿ç§»ç»æåä½¿ç¨ commit æ¥çæ\n\n1   [ROOT@MANAGER ~]#GLUSTER VOLUME REPLACE-BRICK MODELS\n    NODE-2:/OPT/GLUSTER/DATA NODE-3:/OPT/GLUSTER/DATA COMMIT\n    \n\n 1. åè¡¡ volume:\n\n12345   [ROOT@MANAGER ~]#GLUSTER VOLUME MODELS\n        LAY-OUTSTART[ROOT@MANAGER ~]#GLUSTER VOLUME MODELS\n        START[ROOT@MANAGER ~]#GLUSTER VOLUME MODELS\n        STARTFORCE[ROOT@MANAGER ~]#GLUSTER VOLUME MODELS\n        STATUS[ROOT@MANAGER ~]#GLUSTER VOLUME MODELS STOP\n        ",normalizedContent:"glusterfsæä»¶å­å¨ä»ç»\n\nåæé¾æ¥ï¼https://www.viayc.com/categories/glusterfs/\n\nè¯´æ\n\nç®ä»\n\n1234567891011   glusterfs æ¯ scale-out å­å¨è§£å³æ¹æ¡ gluster çæ ¸å¿ï¼å®æ¯ä¸ä¸ªå¼æºçåå¸å¼æä»¶ç³»ç»ï¼\n                å·æå¼ºå¤§çæ¨ªåæ©å±è½åï¼éè¿æ©å±è½å¤æ¯ææ° pb å­å¨å®¹éåå¤çæ°åå®¢æ·ç«¯ã glusterfs åå© tcp/ip æ\n                infiniband rdma ç½ç»å°ç©çåå¸çå­å¨èµæºèéå¨ä¸èµ·ï¼ä½¿ç¨åä¸å¨å±å½åç©ºé´æ¥ç®¡çæ°æ®ã glusterfs\n                åºäºå¯å å çç¨æ·ç©ºé´è®¾è®¡ï¼å¯ä¸ºåç§ä¸åçæ°æ®è´è½½æä¾ä¼å¼çæ§è½ã glusterfs æ¯æè¿è¡å¨ä»»ä½ ip\n                ç½ç»ä¸çæ ååºç¨ç¨åºçæ åå®¢æ·ç«¯ï¼ç¨æ·å¯ä»¥å¨å¨å±ç»ä¸çå½åç©ºé´ä¸­ä½¿ç¨ nfs/cifs ç­æ ååè®®æ¥è®¿é®åºç¨æ°æ®ã\n                glusterfs\n                ä½¿å¾ç¨æ·å¯æè±åæçç¬ç«ãé«ææ¬çå°é­å­å¨ç³»ç»ï¼è½å¤å©ç¨æ®éå»ä»·çå­å¨è®¾å¤æ¥é¨ç½²å¯éä¸­ç®¡çãæ¨ªåæ©å±ãèæåçå­å¨æ± ï¼å­å¨å®¹éå¯æ©å±è³\n                tb/pb çº§ã ç®å glusterfs å·²è¢« red hat\n                æ¶è´­ï¼å®çå®ç½æ¯ï¼https://www.gluster.org/\n                \n\nglusterfs å¨ä¼ä¸ä¸­çåºç¨åºæ¯\n\nçè®ºåå®è·µä¸åæï¼glusterfs ç®åä¸»è¦éç¨äºå¤§æä»¶å­å¨åºæ¯ï¼å¯¹äºå°æä»¶å°¤å¶æ¯æµ·éå°æä»¶ï¼å­å¨æçåè®¿é®æ§è½é½è¡¨ç°ä¸ä½³ãå»ºè®®å­æ¾æä»¶å¤§å°å¤§äº 1mb\n\nglusterfs å®è£\n\nç¯å¢è¯´æ\n\n * centos 7\n * glusterfs\n\n3 å°æºå¨å®è£ glusterfs ç»æä¸ä¸ªéç¾¤ã\n\n12345678910111213   æå¡å¨ï¼10.1.0.1110.1.0.1210.1.0.13 éç½® hosts 10.1.0.11\n                    manager10.1.0.12 node-110.1.0.13 node-2 client:10.1.0.10\n                    client\n                    \n\nå®è£ glusterfs\n\ncentos å®è£ glusterfs éå¸¸çç®å\n\nå¨ä¸ä¸ªèç¹é½å®è£ glusterfs\n\n12345   # å®è£ glusterfs yum æºæä»¶#yum install centos-release-gluster #\n        å®è£ glusterfs è½¯ä»¶yum install -y glusterfs glusterfs-server\n        glusterfs-fuse glusterfs-rdma\n        \n\nå¯å¨ glusterfs\n\n1234567891011121314   [root@manager ~]#systemctl start\n                      glusterd.service[root@manager ~]#systemctl enable\n                      glusterd.service[root@manager ~]#systemctl status\n                      glusterd.serviceâ glusterd.service - glusterfs, a clustered\n                      file-system server loaded: loaded\n                      (/usr/lib/systemd/system/glusterd.service; disabled; vendor\n                      preset: disabled) active: active (running) since ä¸\n                      2017-02-27 17:55:56 cst; 11s ago process: 5476\n                      execstart=/usr/sbin/glusterd -p /var/run/glusterd.pid\n                      --log-level $log_level $glusterd_options (code=exited,\n                      status=0/success)main pid: 5477 (glusterd) memory: 15.0m\n                      cgroup: /system.slice/glusterd.service ââ5477\n                      /usr/sbin/glusterd -p /var/run/glusterd.pid --log-level info\n                      2 æ 27 17:55:56 meetbill systemd[1]: starting glusterfs, a\n                      clustered file-system server...2 æ 27 17:55:56 meetbill\n                      systemd[1]: started glusterfs, a clustered file-system\n                      server.\n                      \n\néç½® glusterfs\n\nå¨ manager èç¹ä¸éç½®ï¼å° èç¹ å å¥å° éç¾¤ä¸­ã\n\n12345678   [root@manager ~]#gluster peer probe managerpeer probe:\n           success. probe on localhost not needed [root@manager\n           ~]#gluster peer probe node-1peer probe: success.\n           [root@manager ~]#gluster peer probe node-2peer probe:\n           success.\n           \n\næ¥çéç¾¤ç¶æï¼\n\n12345678910   [root@manager ~]#gluster peer statusnumber of peers: 2\n              hostname: node-1uuid:\n              41573e8b-eb00-4802-84f0-f923a2c7be79state: peer in cluster\n              (connected) hostname: node-2uuid:\n              da068e0b-eada-4a50-94ff-623f630986d7state: peer in cluster\n              (connected)\n              \n\nåå»ºæ°æ®å­å¨ç®å½ï¼\n\n123   [root@manager ~]#mkdir -p /opt/gluster/data[root@node-1 ~]#\n      mkdir -p /opt/gluster/data[root@node-2 ~]# mkdir -p\n      /opt/gluster/data\n      \n\næ¥ç volume ç¶æï¼\n\n12   [root@manager ~]#gluster volume infono volumes present\n     \n\nvolume æ¨¡å¼è¯´æ\n\nä¸ã é»è®¤æ¨¡å¼ï¼æ¢ dht, ä¹å« åå¸å·ï¼å°æä»¶å·² hash ç®æ³éæºåå¸å° ä¸å°æå¡å¨èç¹ä¸­å­å¨ã\n\n1   gluster volume create test-volume server1:/exp1\n    server2:/exp2\n    \n\näºã å¤å¶æ¨¡å¼ï¼æ¢ afr, åå»º volume æ¶å¸¦ replica x æ°éï¼å°æä»¶å¤å¶å° replica x ä¸ªèç¹ä¸­ã\n\n1   gluster volume create test-volume replica 2 transport tcp\n    server1:/exp1 server2:/exp2\n    \n\nä¸ã æ¡å¸¦æ¨¡å¼ï¼æ¢ striped, åå»º volume æ¶å¸¦ stripe x æ°éï¼ å°æä»¶åå²ææ°æ®åï¼åå«å­å¨å° stripe x ä¸ªèç¹ä¸­ ( ç±»ä¼¼ raid 0 )ã\n\n1   gluster volume create test-volume stripe 2 transport tcp\n    server1:/exp1 server2:/exp2\n    \n\nåã åå¸å¼æ¡å¸¦æ¨¡å¼ï¼ç»ååï¼ï¼æå°éè¦ 4 å°æå¡å¨æè½åå»ºã åå»º volume æ¶ stripe 2 server = 4 ä¸ªèç¹ï¼ æ¯ dht ä¸ striped çç»ååã\n\n1   gluster volume create test-volume stripe 2 transport tcp\n    server1:/exp1 server2:/exp2 server3:/exp3 server4:/exp4\n    \n\näºã åå¸å¼å¤å¶æ¨¡å¼ï¼ç»ååï¼, æå°éè¦ 4 å°æå¡å¨æè½åå»ºã åå»º volume æ¶ replica 2 server = 4 ä¸ªèç¹ï¼æ¯ dht ä¸ afr çç»ååã\n\n1   gluster volume create test-volume replica 2 transport tcp\n    server1:/exp1 server2:/exp2ãserver3:/exp3 server4:/exp4\n    \n\nå­ã æ¡å¸¦å¤å¶å·æ¨¡å¼ï¼ç»ååï¼, æå°éè¦ 4 å°æå¡å¨æè½åå»ºã åå»º volume æ¶ stripe 2 replica 2 server = 4 ä¸ªèç¹ï¼ æ¯ striped ä¸ afr çç»ååã\n\n1   gluster volume create test-volume stripe 2 replica 2\n    transport tcp server1:/exp1 server2:/exp2 server3:/exp3\n    server4:/exp4\n    \n\nä¸ã ä¸ç§æ¨¡å¼æ··åï¼è³å°éè¦ 8 å° æå¡å¨æè½åå»ºã stripe 2 replica 2 , æ¯ 4 ä¸ªèç¹ ç»æä¸ä¸ª ç»ã\n\n1   gluster volume create test-volume stripe 2 replica 2\n    transport tcp server1:/exp1 server2:/exp2 server3:/exp3\n    server4:/exp4 server5:/exp5 server6:/exp6 server7:/exp7\n    server8:/exp8\n    \n\nåå»º glusterfs ç£ç\n\n12   [root@manager ~]#gluster volume create models replica 3\n     manager:/opt/gluster/data node-1:/opt/gluster/data\n     node-2:/opt/gluster/data forcevolume create: models:\n     success: please start the volume to access data\n     \n\nåæ¥ç volume ç¶æï¼\n\n1234567891011121314   [root@manager ~]#gluster volume info volume name:\n                      modelstype: replicatevolume id:\n                      e539ff3b-2278-4f3f-a594-1f101eabbf1estatus: creatednumber of\n                      bricks: 1 x 3 = 3transport-type: tcpbricks:brick1:\n                      manager:/opt/gluster/databrick2:\n                      node-1:/opt/gluster/databrick3:\n                      node-2:/opt/gluster/dataoptions\n                      reconfigured:performance.readdir-ahead: on\n                      \n\nå¯å¨ models\n\n12   [root@manager ~]#gluster volume start modelsvolume start:\n     models: success\n     \n\nglusterfs å®¢æ·ç«¯\n\né¨ç½² glusterfs å®¢æ·ç«¯å¹¶ mount glusterfs æä»¶ç³»ç»\n\n123   [root@client ~]#yum install -y glusterfs\n      glusterfs-fuse[root@client ~]#mkdir -p\n      /opt/gfsmnt[root@client ~]#mount -t glusterfs manager:models\n      /opt/gfsmnt/\n      \n\n1234567891011   [root@node-94 ~]#df -hæä»¶ç³»ç» å®¹é å·²ç¨ å¯ç¨ å·²ç¨ %\n                æè½½ç¹/dev/mapper/vg001-root 98g 1.2g 97g 2% /devtmpfs 32g 0\n                32g 0% /devtmpfs 32g 0 32g 0% /dev/shmtmpfs 32g 130m 32g 1%\n                /runtmpfs 32g 0 32g 0% /sys/fs/cgroup/dev/mapper/vg001-opt\n                441g 71g 370g 17% /opt/dev/sda2 497m 153m 344m 31%\n                /boottmpfs 6.3g 0 6.3g 0% /run/user/0manager:models 441g 18g\n                424g 4% /opt/gfsmnt\n                \n\nç»´æ¤\n\n 1. æ¥ç glusterfs ä¸­ææç volume:\n\n1   [root@manager ~]#gluster volume list\n    \n\n 1. å é¤ glusterfs ç£çï¼\n\n12   [root@manager ~]#gluster volume stop models #åæ­¢åå­ä¸º models\n     çç£ç[root@manager ~]#gluster volume delete models #å é¤åå­ä¸º\n     models çç£ç\n     \n\næ³¨ï¼ å é¤ ç£ç ä»¥åï¼å¿é¡»å é¤ ç£ç ( /opt/gluster/data ) ä¸­ç ï¼ .glusterfs/ .trashcan/ ï¼ç®å½ã\n\nå¦ååå»ºæ° volume ç¸åç ç£ç ä¼åºç°æä»¶ ä¸åå¸ï¼æè ç±»å éä¹± çé®é¢ã\n\n 1. å¸è½½æä¸ªèç¹ glusterfs ç£ç\n\n1   [root@manager ~]#gluster peer detach node-2\n    \n\n 1. è®¾ç½®è®¿é®éå¶ï¼æç§æ¯ä¸ª volume æ¥éå¶\n\n1   [root@manager ~]#gluster volume set models auth.allow\n    10.6.0.,10.7.0.\n    \n\n 1. æ·»å  glusterfs èç¹ï¼\n\n12   [root@manager ~]#gluster peer probe node-3[root@manager\n     ~]#gluster volume add-brick models node-3:/opt/gluster/data\n     \n\næ³¨ï¼å¦ææ¯å¤å¶å·æèæ¡å¸¦å·ï¼åæ¯æ¬¡æ·»å ç brick æ°å¿é¡»æ¯ replica æè stripe çæ´æ°å\n\n 1. éç½®å·\n\n1   [root@manager ~]# gluster volume set\n    \n\n 1. ç¼©å®¹ volume:\n\nåå°æ°æ®è¿ç§»å°å¶å®å¯ç¨ç brickï¼è¿ç§»ç»æåæå°è¯¥ brick ç§»é¤ï¼\n\n1   [root@manager ~]#gluster volume remove-brick models\n    node-2:/opt/gluster/data node-3:/opt/gluster/data start\n    \n\nå¨æ§è¡äº start ä¹åï¼å¯ä»¥ä½¿ç¨ status å½ä»¤æ¥çç§»é¤è¿åº¦ï¼\n\n1   [root@manager ~]#gluster volume remove-brick models\n    node-2:/opt/gluster/data node-3:/opt/gluster/data status\n    \n\nä¸è¿è¡æ°æ®è¿ç§»ï¼ç´æ¥å é¤è¯¥ brickï¼\n\n1   [root@manager ~]#gluster volume remove-brick models\n    node-2:/opt/gluster/data node-3:/opt/gluster/data commit\n    \n\næ³¨æï¼å¦ææ¯å¤å¶å·æèæ¡å¸¦å·ï¼åæ¯æ¬¡ç§»é¤ç brick æ°å¿é¡»æ¯ replica æè stripe çæ´æ°åã\n\næ©å®¹ï¼\n\n1   gluster volume add-brick models node-2:/opt/gluster/data\n    \n\n 1. ä¿®å¤å½ä»¤ï¼\n\n1   [root@manager ~]#gluster volume replace-brick models\n    node-2:/opt/gluster/data node-3:/opt/gluster/data commit\n    -force\n    \n\n 1. è¿ç§» volume:\n\n1   [root@manager ~]#gluster volume replace-brick models\n    node-2:/opt/gluster/data node-3:/opt/gluster/data start\n    \n\npause ä¸ºæåè¿ç§»\n\n1   [root@manager ~]#gluster volume replace-brick models\n    node-2:/opt/gluster/data node-3:/opt/gluster/data pause\n    \n\nabort ä¸ºç»æ­¢è¿ç§»\n\n1   [root@manager ~]#gluster volume replace-brick models\n    node-2:/opt/gluster/data node-3:/opt/gluster/data abort\n    \n\nstatus æ¥çè¿ç§»ç¶æ\n\n1   [root@manager ~]#gluster volume replace-brick models\n    node-2:/opt/gluster/data node-3:/opt/gluster/data status\n    \n\nè¿ç§»ç»æåä½¿ç¨ commit æ¥çæ\n\n1   [root@manager ~]#gluster volume replace-brick models\n    node-2:/opt/gluster/data node-3:/opt/gluster/data commit\n    \n\n 1. åè¡¡ volume:\n\n12345   [root@manager ~]#gluster volume models\n        lay-outstart[root@manager ~]#gluster volume models\n        start[root@manager ~]#gluster volume models\n        startforce[root@manager ~]#gluster volume models\n        status[root@manager ~]#gluster volume models stop\n        ",charsets:{cjk:!0}},{title:"centos7ä¸éç½®firewalldå®ç°natè½¬åè½¯è·¯ç±",frontmatter:{title:"centos7ä¸éç½®firewalldå®ç°natè½¬åè½¯è·¯ç±",date:"2022-12-15T19:03:12.000Z",permalink:"/pages/ce46b6/",categories:["è¿ç»´","é²ç«å¢"],tags:[null],readingShow:"top",description:"å¦æéå DHCP æå¡æå®ç°æ´å¤åè½ã",meta:[{name:"twitter:title",content:"centos7ä¸éç½®firewalldå®ç°natè½¬åè½¯è·¯ç±"},{name:"twitter:description",content:"å¦æéå DHCP æå¡æå®ç°æ´å¤åè½ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/07.%E9%98%B2%E7%81%AB%E5%A2%99/01.centos7%E4%B8%8B%E9%85%8D%E7%BD%AEfirewalld%E5%AE%9E%E7%8E%B0nat%E8%BD%AC%E5%8F%91%E8%BD%AF%E8%B7%AF%E7%94%B1.html"},{property:"og:type",content:"article"},{property:"og:title",content:"centos7ä¸éç½®firewalldå®ç°natè½¬åè½¯è·¯ç±"},{property:"og:description",content:"å¦æéå DHCP æå¡æå®ç°æ´å¤åè½ã"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/07.%E9%98%B2%E7%81%AB%E5%A2%99/01.centos7%E4%B8%8B%E9%85%8D%E7%BD%AEfirewalld%E5%AE%9E%E7%8E%B0nat%E8%BD%AC%E5%8F%91%E8%BD%AF%E8%B7%AF%E7%94%B1.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T19:03:12.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"centos7ä¸éç½®firewalldå®ç°natè½¬åè½¯è·¯ç±"},{itemprop:"description",content:"å¦æéå DHCP æå¡æå®ç°æ´å¤åè½ã"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/07.%E9%98%B2%E7%81%AB%E5%A2%99/01.centos7%E4%B8%8B%E9%85%8D%E7%BD%AEfirewalld%E5%AE%9E%E7%8E%B0nat%E8%BD%AC%E5%8F%91%E8%BD%AF%E8%B7%AF%E7%94%B1.html",relativePath:"04.è¿ç»´/07.é²ç«å¢/01.centos7ä¸éç½®firewalldå®ç°natè½¬åè½¯è·¯ç±.md",key:"v-0a29d12e",path:"/pages/ce46b6/",headersStr:null,content:'å¦æéå DHCP æå¡æå®ç°æ´å¤åè½ã\n\nâ¼ NAT è½¬åè½¯è·¯ç±\n\nå¼å¯ NAT è½¬åä¹åï¼åªè¦æ¬æºå¯ä»¥ä¸ç½ï¼ä¸è®ºæ¯åç½å¡è¿æ¯å¤ç½å¡ï¼å±åç½åçå¶ä»æºå¨å¯ä»¥å°é»è®¤ç½å³è®¾ç½®ä¸ºå·²å¼å¯ NAT è½¬åçæå¡å¨ IP ï¼å³å¯å®ç°ä¸ç½ã\n\nå¼å¯ NAT è½¬å firewall-cmd --permanent --zone=public --add-masquerade # å¼æ¾ DNS ä½¿ç¨ç 53 ç«¯å£ï¼UDP # å¿é¡»ï¼å¦åå¶ä»æºå¨æ æ³è¿è¡ååè§£æ firewall-cmd --zone=public --add-port=80/tcp --permanent # æ£æ¥æ¯å¦åè®¸ NAT è½¬å firewall-cmd --query-masquerade # ç¦æ­¢é²ç«å¢ NAT è½¬å firewall-cmd --remove-masquerade\n\nâ¼ ç«¯å£è½¬å\n\nç«¯å£è½¬åå¯ä»¥å°æå®å°åè®¿é®æå®çç«¯å£æ¶ï¼å°æµéè½¬åè³æå®å°åçæå®ç«¯å£ãè½¬åçç®çå¦æä¸æå® ip çè¯å°±é»è®¤ä¸ºæ¬æºï¼å¦ææå®äº ip å´æ²¡æå®ç«¯å£ï¼åé»è®¤ä½¿ç¨æ¥æºç«¯å£ã\n\nå°80ç«¯å£çæµéè½¬åè³8080 firewall-cmd --add-forward-port=port=80:proto=tcp:toport=8080 # å°80ç«¯å£çæµéè½¬åè³192.168.0.1 firewall-cmd --add-forward-port=proto=80:proto=tcp:toaddr=192.168.0.1 # å°80ç«¯å£çæµéè½¬åè³192.168.0.1ç8080ç«¯å£ firewall-cmd --add-forward-port=proto=80:proto=tcp:toaddr=192.168.0.1:toport=8080\n\n1ãéå¶IPå°åè®¿é®\n\nï¼1ï¼æ¯å¦éå¶IPä¸º192.168.0.200çå°åç¦æ­¢è®¿é®80ç«¯å£å³ç¦æ­¢è®¿é®æºå¨\n\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" reject"\n\nï¼2ï¼éæ°è½½å¥ä¸ä¸é²ç«å¢è®¾ç½®ï¼ä½¿è®¾ç½®çæ\n\nfirewall-cmd --reload\n\nï¼3ï¼æ¥çå·²ç»è®¾ç½®çè§å\n\nfirewall-cmd --zone=public --list-rich-rules\n\n2ãè§£é¤IPå°åéå¶\n\nï¼1ï¼è§£é¤åæè¢«éå¶ç192.168.0.200\n\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" accept"\n\nï¼2ï¼éæ°è½½å¥ä¸ä¸é²ç«å¢è®¾ç½®ï¼ä½¿è®¾ç½®çæ\n\nfirewall-cmd --reload\n\nï¼3ï¼åæ¥çè§åè®¾ç½®åç°å·²ç»æ²¡æ192.168.0.200çéå¶äº\n\nfirewall-cmd --zone=public --list-rich-rules\n\nå¦è®¾ç½®æªçæï¼å¯å°è¯ç´æ¥ç¼è¾è§åæä»¶ï¼å æåæ¥çè®¾ç½®è§åï¼éæ°è½½å¥ä¸ä¸é²ç«å¢å³å¯\n\nvi /etc/firewalld/zones/public.xml\n\néå¶IPå°åæ®µ\n\nï¼1ï¼å¦æä»¬éè¦éå¶10.0.0.0-10.0.0.255è¿ä¸æ´ä¸ªæ®µçIPï¼ç¦æ­¢ä»ä»¬è®¿é®\n\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="10.0.0.0/24" port protocol="tcp" port="80" reject"\n\nå¶ä¸­10.0.0.0/24è¡¨ç¤ºä¸ºä»10.0.0.0è¿ä¸ªIPå¼å§ï¼24ä»£è¡¨å­ç½æ©ç ä¸º255.255.255.0ï¼å±åå«256ä¸ªå°åï¼å³ä»0-255å±256ä¸ªIPï¼å³æ­£å¥½éå¶äºè¿ä¸æ´æ®µçIPå°åï¼å·ä½çè®¾ç½®è§åå¯åèä¸è¡¨\n\néæ°è½½å¥ä¸ä¸é²ç«å¢è®¾ç½®ï¼ä½¿è®¾ç½®çæ\n\nfirewall-cmd --reload\n\nï¼3ï¼æ¥çè§åï¼ç¡®è®¤æ¯å¦çæ\n\nfirewall-cmd --zone=public --list-rich-rules\n\nï¼4ï¼åçï¼æå¼éå¶ä¸º\n\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="10.0.0.0/24" port protocol="tcp" port="80" accept"\n\nfirewall-cmd --reload\n\n#æ¥çææçé²ç«å¢ç­ç¥ï¼å³æ¾ç¤º/etc/firewalld/zones/ä¸çææç­ç¥ï¼\n\nfirewall-cmd --list-all-zones\n\n#åè®¸httpæå¡(å¯¹åºæå¡ç­ç¥ç®å½ï¼/usr/lib/firewalld/services/)\n\nfirewall-cmd --permanent --add-service=http\n\n#å³é­httpæå¡(å¯¹åºæå¡ç­ç¥ç®å½ï¼/usr/lib/firewalld/services/)\n\nfirewall-cmd --permanent --remove-service=http\n\nå°æ¥å£æ·»å å°åºåï¼é»è®¤æ¥å£é½å¨public\n\nfirewall-cmd --zone=public --add-interface=eth0 æ°¸ä¹çæåå ä¸ --permanent ç¶åreloadé²ç«å¢\n\nè®¾ç½®é»è®¤æ¥å£åºå\n\nfirewall-cmd --set-default-zone=public ç«å³çææ ééå¯ firewall-cmd --reload\n\næ¥çé²ç«å¢ç«¯å£å¼å¯ç¶æ\n\nfirewall-cmd --list-ports\n\næ·»å \n\nfirewall-cmdÂ --zone=publicÂ --add-port=80/tcpÂ --permanent\n\nå é¤\n\nfirewall-cmdÂ --zone=publicÂ --remove-port=80/tcpÂ --permanent',normalizedContent:'å¦æéå dhcp æå¡æå®ç°æ´å¤åè½ã\n\nâ¼ nat è½¬åè½¯è·¯ç±\n\nå¼å¯ nat è½¬åä¹åï¼åªè¦æ¬æºå¯ä»¥ä¸ç½ï¼ä¸è®ºæ¯åç½å¡è¿æ¯å¤ç½å¡ï¼å±åç½åçå¶ä»æºå¨å¯ä»¥å°é»è®¤ç½å³è®¾ç½®ä¸ºå·²å¼å¯ nat è½¬åçæå¡å¨ ip ï¼å³å¯å®ç°ä¸ç½ã\n\nå¼å¯ nat è½¬å firewall-cmd --permanent --zone=public --add-masquerade # å¼æ¾ dns ä½¿ç¨ç 53 ç«¯å£ï¼udp # å¿é¡»ï¼å¦åå¶ä»æºå¨æ æ³è¿è¡ååè§£æ firewall-cmd --zone=public --add-port=80/tcp --permanent # æ£æ¥æ¯å¦åè®¸ nat è½¬å firewall-cmd --query-masquerade # ç¦æ­¢é²ç«å¢ nat è½¬å firewall-cmd --remove-masquerade\n\nâ¼ ç«¯å£è½¬å\n\nç«¯å£è½¬åå¯ä»¥å°æå®å°åè®¿é®æå®çç«¯å£æ¶ï¼å°æµéè½¬åè³æå®å°åçæå®ç«¯å£ãè½¬åçç®çå¦æä¸æå® ip çè¯å°±é»è®¤ä¸ºæ¬æºï¼å¦ææå®äº ip å´æ²¡æå®ç«¯å£ï¼åé»è®¤ä½¿ç¨æ¥æºç«¯å£ã\n\nå°80ç«¯å£çæµéè½¬åè³8080 firewall-cmd --add-forward-port=port=80:proto=tcp:toport=8080 # å°80ç«¯å£çæµéè½¬åè³192.168.0.1 firewall-cmd --add-forward-port=proto=80:proto=tcp:toaddr=192.168.0.1 # å°80ç«¯å£çæµéè½¬åè³192.168.0.1ç8080ç«¯å£ firewall-cmd --add-forward-port=proto=80:proto=tcp:toaddr=192.168.0.1:toport=8080\n\n1ãéå¶ipå°åè®¿é®\n\nï¼1ï¼æ¯å¦éå¶ipä¸º192.168.0.200çå°åç¦æ­¢è®¿é®80ç«¯å£å³ç¦æ­¢è®¿é®æºå¨\n\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" reject"\n\nï¼2ï¼éæ°è½½å¥ä¸ä¸é²ç«å¢è®¾ç½®ï¼ä½¿è®¾ç½®çæ\n\nfirewall-cmd --reload\n\nï¼3ï¼æ¥çå·²ç»è®¾ç½®çè§å\n\nfirewall-cmd --zone=public --list-rich-rules\n\n2ãè§£é¤ipå°åéå¶\n\nï¼1ï¼è§£é¤åæè¢«éå¶ç192.168.0.200\n\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="192.168.0.200" port protocol="tcp" port="80" accept"\n\nï¼2ï¼éæ°è½½å¥ä¸ä¸é²ç«å¢è®¾ç½®ï¼ä½¿è®¾ç½®çæ\n\nfirewall-cmd --reload\n\nï¼3ï¼åæ¥çè§åè®¾ç½®åç°å·²ç»æ²¡æ192.168.0.200çéå¶äº\n\nfirewall-cmd --zone=public --list-rich-rules\n\nå¦è®¾ç½®æªçæï¼å¯å°è¯ç´æ¥ç¼è¾è§åæä»¶ï¼å æåæ¥çè®¾ç½®è§åï¼éæ°è½½å¥ä¸ä¸é²ç«å¢å³å¯\n\nvi /etc/firewalld/zones/public.xml\n\néå¶ipå°åæ®µ\n\nï¼1ï¼å¦æä»¬éè¦éå¶10.0.0.0-10.0.0.255è¿ä¸æ´ä¸ªæ®µçipï¼ç¦æ­¢ä»ä»¬è®¿é®\n\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="10.0.0.0/24" port protocol="tcp" port="80" reject"\n\nå¶ä¸­10.0.0.0/24è¡¨ç¤ºä¸ºä»10.0.0.0è¿ä¸ªipå¼å§ï¼24ä»£è¡¨å­ç½æ©ç ä¸º255.255.255.0ï¼å±åå«256ä¸ªå°åï¼å³ä»0-255å±256ä¸ªipï¼å³æ­£å¥½éå¶äºè¿ä¸æ´æ®µçipå°åï¼å·ä½çè®¾ç½®è§åå¯åèä¸è¡¨\n\néæ°è½½å¥ä¸ä¸é²ç«å¢è®¾ç½®ï¼ä½¿è®¾ç½®çæ\n\nfirewall-cmd --reload\n\nï¼3ï¼æ¥çè§åï¼ç¡®è®¤æ¯å¦çæ\n\nfirewall-cmd --zone=public --list-rich-rules\n\nï¼4ï¼åçï¼æå¼éå¶ä¸º\n\nfirewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="10.0.0.0/24" port protocol="tcp" port="80" accept"\n\nfirewall-cmd --reload\n\n#æ¥çææçé²ç«å¢ç­ç¥ï¼å³æ¾ç¤º/etc/firewalld/zones/ä¸çææç­ç¥ï¼\n\nfirewall-cmd --list-all-zones\n\n#åè®¸httpæå¡(å¯¹åºæå¡ç­ç¥ç®å½ï¼/usr/lib/firewalld/services/)\n\nfirewall-cmd --permanent --add-service=http\n\n#å³é­httpæå¡(å¯¹åºæå¡ç­ç¥ç®å½ï¼/usr/lib/firewalld/services/)\n\nfirewall-cmd --permanent --remove-service=http\n\nå°æ¥å£æ·»å å°åºåï¼é»è®¤æ¥å£é½å¨public\n\nfirewall-cmd --zone=public --add-interface=eth0 æ°¸ä¹çæåå ä¸ --permanent ç¶åreloadé²ç«å¢\n\nè®¾ç½®é»è®¤æ¥å£åºå\n\nfirewall-cmd --set-default-zone=public ç«å³çææ ééå¯ firewall-cmd --reload\n\næ¥çé²ç«å¢ç«¯å£å¼å¯ç¶æ\n\nfirewall-cmd --list-ports\n\næ·»å \n\nfirewall-cmdÂ --zone=publicÂ --add-port=80/tcpÂ --permanent\n\nå é¤\n\nfirewall-cmdÂ --zone=publicÂ --remove-port=80/tcpÂ --permanent',charsets:{cjk:!0}},{title:"æ°æ®åºäºè¿å¶å®è£",frontmatter:{title:"æ°æ®åºäºè¿å¶å®è£",categories:"mysql",tags:["mysql"],date:"2022-12-09T20:49:19.000Z",permalink:"/pages/1f5460/",readingShow:"top",description:"MySQL Yumä»åºæä¾äºç¨äºå¨Linuxå¹³å°ä¸å®è£MySQLæå¡å¨ï¼å®¢æ·ç«¯åå¶ä»ç»ä»¶çRPMåãmysql-yumå®è£ä¸è½½å°å",meta:[{name:"image",content:"http://www.sunrisenan.com/uploads/mysql/images/m_f397fc71d88cf7f381987beaeda4b9df_r.png"},{name:"twitter:title",content:"æ°æ®åºäºè¿å¶å®è£"},{name:"twitter:description",content:"MySQL Yumä»åºæä¾äºç¨äºå¨Linuxå¹³å°ä¸å®è£MySQLæå¡å¨ï¼å®¢æ·ç«¯åå¶ä»ç»ä»¶çRPMåãmysql-yumå®è£ä¸è½½å°å"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://www.sunrisenan.com/uploads/mysql/images/m_f397fc71d88cf7f381987beaeda4b9df_r.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/08.%E6%95%B0%E6%8D%AE%E5%BA%93/01.mysql/01.%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85.html"},{property:"og:type",content:"article"},{property:"og:title",content:"æ°æ®åºäºè¿å¶å®è£"},{property:"og:description",content:"MySQL Yumä»åºæä¾äºç¨äºå¨Linuxå¹³å°ä¸å®è£MySQLæå¡å¨ï¼å®¢æ·ç«¯åå¶ä»ç»ä»¶çRPMåãmysql-yumå®è£ä¸è½½å°å"},{property:"og:image",content:"http://www.sunrisenan.com/uploads/mysql/images/m_f397fc71d88cf7f381987beaeda4b9df_r.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/08.%E6%95%B0%E6%8D%AE%E5%BA%93/01.mysql/01.%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:49:19.000Z"},{property:"article:tag",content:"mysql"},{itemprop:"name",content:"æ°æ®åºäºè¿å¶å®è£"},{itemprop:"description",content:"MySQL Yumä»åºæä¾äºç¨äºå¨Linuxå¹³å°ä¸å®è£MySQLæå¡å¨ï¼å®¢æ·ç«¯åå¶ä»ç»ä»¶çRPMåãmysql-yumå®è£ä¸è½½å°å"},{itemprop:"image",content:"http://www.sunrisenan.com/uploads/mysql/images/m_f397fc71d88cf7f381987beaeda4b9df_r.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/08.%E6%95%B0%E6%8D%AE%E5%BA%93/01.mysql/01.%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85.html",relativePath:"04.è¿ç»´/08.æ°æ®åº/01.mysql/01.æ°æ®åºäºè¿å¶å®è£.md",key:"v-09ffdab8",path:"/pages/1f5460/",headers:[{level:2,title:"1.å®è£MySQLä»åºæº",slug:"_1-å®è£mysqlä»åºæº",normalizedTitle:"1.å®è£mysqlä»åºæº",charIndex:153},{level:2,title:"2.éæ©å¹¶å¯ç¨éåå½åå¹³å°çåè¡å",slug:"_2-éæ©å¹¶å¯ç¨éåå½åå¹³å°çåè¡å",normalizedTitle:"2.éæ©å¹¶å¯ç¨éåå½åå¹³å°çåè¡å",charIndex:268},{level:2,title:"3.éè¿ä»¥ä¸å½ä»¤å®è£MySQL, å¹¶å¯å¨MySQL",slug:"_3-éè¿ä»¥ä¸å½ä»¤å®è£mysql-å¹¶å¯å¨mysql",normalizedTitle:"3.éè¿ä»¥ä¸å½ä»¤å®è£mysql, å¹¶å¯å¨mysql",charIndex:812},{level:2,title:"1.åºç¡ç¯å¢åå¤",slug:"_1-åºç¡ç¯å¢åå¤",normalizedTitle:"1.åºç¡ç¯å¢åå¤",charIndex:1683},{level:2,title:"2.ä¸è½½MySQLå¹¶å®è£",slug:"_2-ä¸è½½mysqlå¹¶å®è£",normalizedTitle:"2.ä¸è½½mysqlå¹¶å®è£",charIndex:1972},{level:2,title:"3.è¿è¡MySQLåå§å",slug:"_3-è¿è¡mysqlåå§å",normalizedTitle:"3.è¿è¡mysqlåå§å",charIndex:2261},{level:2,title:"4.å»ºç«MySQLéç½®æä»¶",slug:"_4-å»ºç«mysqléç½®æä»¶",normalizedTitle:"4.å»ºç«mysqléç½®æä»¶",charIndex:2874},{level:2,title:"5.å¯å¨MySQLæ°æ®åº",slug:"_5-å¯å¨mysqlæ°æ®åº",normalizedTitle:"5.å¯å¨mysqlæ°æ®åº",charIndex:3060},{level:2,title:"6.è¿æ¥æ°æ®åºæµè¯",slug:"_6-è¿æ¥æ°æ®åºæµè¯",normalizedTitle:"6.è¿æ¥æ°æ®åºæµè¯",charIndex:3967},{level:2,title:"1.æºç å®è£mysqléè¦ä¾èµcmakeãboost",slug:"_1-æºç å®è£mysqléè¦ä¾èµcmakeãboost",normalizedTitle:"1.æºç å®è£mysqléè¦ä¾èµcmakeãboost",charIndex:5341},{level:2,title:"2.ä¸è½½æºç åå¹¶ç¼è¯MySQL",slug:"_2-ä¸è½½æºç åå¹¶ç¼è¯mysql",normalizedTitle:"2.ä¸è½½æºç åå¹¶ç¼è¯mysql",charIndex:5546},{level:2,title:"3.å®æååºæ¬ä¼å",slug:"_3-å®æååºæ¬ä¼å",normalizedTitle:"3.å®æååºæ¬ä¼å",charIndex:6392},{level:2,title:"4.åå¤MySQLåºç¡éç½®æä»¶",slug:"_4-åå¤mysqlåºç¡éç½®æä»¶",normalizedTitle:"4.åå¤mysqlåºç¡éç½®æä»¶",charIndex:6551},{level:2,title:"5.æ·è´MySQLç¨åºå¯å¨æä»¶",slug:"_5-æ·è´mysqlç¨åºå¯å¨æä»¶",normalizedTitle:"5.æ·è´mysqlç¨åºå¯å¨æä»¶",charIndex:6667},{level:2,title:"6.åå§åMySQL",slug:"_6-åå§åmysql",normalizedTitle:"6.åå§åmysql",charIndex:6871},{level:2,title:"1.æ´æ¹rootå¯ç ",slug:"_1-æ´æ¹rootå¯ç ",normalizedTitle:"1.æ´æ¹rootå¯ç ",charIndex:7281},{level:2,title:"2.å¿è®°mysql rootå¯ç ",slug:"_2-å¿è®°mysql-rootå¯ç ",normalizedTitle:"2.å¿è®°mysql rootå¯ç ",charIndex:7702}],headersStr:"1.å®è£MySQLä»åºæº 2.éæ©å¹¶å¯ç¨éåå½åå¹³å°çåè¡å 3.éè¿ä»¥ä¸å½ä»¤å®è£MySQL, å¹¶å¯å¨MySQL 1.åºç¡ç¯å¢åå¤ 2.ä¸è½½MySQLå¹¶å®è£ 3.è¿è¡MySQLåå§å 4.å»ºç«MySQLéç½®æä»¶ 5.å¯å¨MySQLæ°æ®åº 6.è¿æ¥æ°æ®åºæµè¯ 1.æºç å®è£mysqléè¦ä¾èµcmakeãboost 2.ä¸è½½æºç åå¹¶ç¼è¯MySQL 3.å®æååºæ¬ä¼å 4.åå¤MySQLåºç¡éç½®æä»¶ 5.æ·è´MySQLç¨åºå¯å¨æä»¶ 6.åå§åMySQL 1.æ´æ¹rootå¯ç  2.å¿è®°mysql rootå¯ç ",content:"# æ°æ®åºäºè¿å¶å®è£\n\n\n# 1.YUMå®è£æ°æ®åº\n\nMySQL Yumä»åºæä¾äºç¨äºå¨Linuxå¹³å°ä¸å®è£MySQLæå¡å¨ï¼å®¢æ·ç«¯åå¶ä»ç»ä»¶çRPMåãmysql-yumå®è£ä¸è½½å°å\n\n\n\n\n\n> ä½¿ç¨MySQL Yumä»åºæ¶ï¼é»è®¤éæ©å®è£ææ°çMySQLçæ¬ãå¦æéè¦ä½¿ç¨ä½çæ¬è¯·æå¦ä¸æä½ã\n\n\n# 1.å®è£MySQLä»åºæº\n\n[root@sql ~]# rpm -ivh https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm\n\n\n1\n\n\n\n# 2.éæ©å¹¶å¯ç¨éåå½åå¹³å°çåè¡å\n\n//ååºææMySQLåè¡çä»åº\n[root@sql ~]# yum repolist all|grep mysql\n\n//ç¦ç¨8.0åè¡çä»åº, å¯ç¨5.7åè¡çä»åº\n[root@sql ~]# yum install yum-utils\n[root@sql ~]# yum-config-manager --disable mysql80-community\n[root@sql ~]# yum-config-manager --enable mysql57-community\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n> å¯ä»¥æå¨ç¼è¾/etc/yum.repos.d/mysql-community.repo æä»¶éç½®ä»åº\n\n[mysql57-community]\nname=MySQL 5.7 Community Server\nbaseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/6/$basearch/\nenabled=1\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 3.éè¿ä»¥ä¸å½ä»¤å®è£MySQL, å¹¶å¯å¨MySQL\n\n[root@sql ~]# yum install -y mysql-community-server\n[root@sql ~]# systemctl start mysqld\n[root@sql ~]# systemctl enable mysqld\n\n\n1\n2\n3\n\n\n> MySQLæå¡å¨åå§åï¼ä»éç¨äºMySQL 5.7ï¼å¨æå¡å¨åå§å¯å¨æ¶ï¼å¦ææå¡å¨çæ°æ®ç®å½ä¸ºç©ºï¼åä¼åçä»¥ä¸æåµï¼ â¢ æå¡å¨å·²åå§åã â¢ å¨æ°æ®ç®å½ä¸­çæSSLè¯ä¹¦åå¯é¥æä»¶ã â¢ validate_passwordæä»¶å®è£å¹¶å¯ç¨ã â¢ è¶çº§ç¨æ·å¸æ·ârootâ@âlocalhostâå·²åå»ºã\n\nè¶çº§ç¨æ·çå¯ç è¢«è®¾ç½®å¹¶å­å¨å¨éè¯¯æ¥å¿æä»¶ä¸­ãè¦æ¾ç¤ºå®ï¼è¯·ä½¿ç¨ä»¥ä¸å½ä»¤:\n\n[root@vm-70-160 ~]# grep \"password\" /var/log/mysqld.log \n2018-04-28T07:11:51.589629Z 1 [Note] A temporary password is generated for root@localhost: jHlRHucap3+7\néè¿ä½¿ç¨çæçä¸´æ¶å¯ç ç»å½å¹¶å°½å¿«æ´æ¹rootå¯ç å¹¶ä¸ºè¶çº§ç¨æ·å¸æ·è®¾ç½®èªå®ä¹å¯ç \n[root@vm-70-160 ~]# mysql -uroot -pjHlRHucap3+7\nmysql> ALTER USER 'root'@'localhost' IDENTIFIED BY 'Bgx123.com';\n\n\n1\n2\n3\n4\n5\n\n\n> MySQLçvalidate_passwordæä»¶é»è®¤å®è£ãå°è¦æ±å¯ç è³å°åå«å¤§åãå°åãæ°å­ãç¹æ®å­ç¬¦ãå¹¶ä¸æ»å¯ç é¿åº¦è³å°ä¸º8ä¸ªå­ç¬¦ã\n\n\n# 2.éç¨å®è£æ°æ®åº\n\néç¨äºè¿å¶åç¼è¯æ¹å¼å®è£MySQL, ä¸éè¦å¤æçç¼è¯è®¾ç½®åç¼è¯æ¶é´ç­å¾,è§£åä¸è½½çè½¯ä»¶å,åå§åå³å¯å®æMySQLçå®è£åå¯å¨ãMySQLäºè¿å¶åä¸è½½å°å\n\n\n\nMySQLäºè¿å¶åå®æ¹å®è£æå\n\n\n# 1.åºç¡ç¯å¢åå¤\n\n[root@sql ~]# systemctl stop firewalld\n[root@sql ~]# systemctl disable firewalld\n[root@sql ~]# setenforce 0\n\n//å»ºç«ç¨æ·ä¸ç¸åºç®å½\n[root@sql ~]# groupadd mysql\n[root@sql ~]# useradd -r -g mysql -s /sbin/nologin mysql\n[root@sql ~]# mkdir /soft/src -p && cd /soft/src\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 2.ä¸è½½MySQLå¹¶å®è£\n\n[root@sql src]# wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.22-linux-glibc2.12-x86_64.tar.gz\n[root@sql src]# tar xf mysql-5.7.22-linux-glibc2.12-x86_64.tar.gz -C /soft\n[root@sql src]# ln -s /soft/mysql-5.7.22-linux-glibc2.12-x86_64/ /soft/mysql\n\n\n1\n2\n3\n\n\n\n# 3.è¿è¡MySQLåå§å\n\n//åå»ºåå§åç®å½ä»¥åæ°æ®åºæ°æ®ç®å½\n\n[root@sql ~]# mkdir /soft/mysql/{mysql-file,data}\n[root@sql ~]# chown mysql.mysql /soft/mysql/\n\n//åå§åæ°æ®åº\n[root@sql ~]# /soft/mysql/bin/mysqld --initialize \\\n--user=mysql --basedir=/soft/mysql \\\n--datadir=/soft/mysql/data\n-------\n\n//åå§åæ°æ®åºä¼åè¯é»è®¤ç»éè´¦æ·ä¸å¯ç \n2018-04-28T02:30:33.954980Z 1 [Note] A temporary password is generated for'root@localhost: I,isfqnx.0tO'\n-------\n\n//ä½¿ç¨sslè¿æ¥, åå§ååéæ°ææç®å½æé[å¦ä¸éè¦å¯å¿½ç¥]\n\n[root@sql ~]# /soft/mysql/bin/mysql_ssl_rsa_setup \\\n--datadir=/soft/mysql/data/\n[root@sql ~]# chown -R mysql.mysql /soft/mysql/\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# 4.å»ºç«MySQLéç½®æä»¶\n\n//mysqlå®è£ç®å½åmysqlæ°æ®åºç®å½\n[root@sql ~]# cp /etc/my.cnf /etc/my.cnf_bak\n[root@sql ~]# vim /etc/my.cnf\n[mysqld]\nbasedir=/soft/mysql\ndatadir=/soft/mysql/data\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 5.å¯å¨MySQLæ°æ®åº\n\n//æ¹å¼1,ä½¿ç¨ mysqld_safe \n[root@sql ~]# /soft/mysql/bin/mysqld_safe --user=mysql &\n\n//æ¹å¼2, ä½¿ç¨(systemV)æ¹å¼ç®¡ç, [å¼ºçæ¨è]\n[root@sql ~]# cp /soft/mysql/support-files/mysql.server /etc/init.d/mysqld\n[root@sql ~]# chkconfig --add mysqld\n[root@sql ~]# chkconfig mysqld on\n\n//ä¿®æ¹å®è£ç®å½ä¸æ°æ®å­æ¾ç®å½\n[root@sql ~]# sed -i '/^basedir=/cbasedir=\\/soft\\/mysql' /etc/init.d/mysqld \n[root@sql ~]# sed -i '/^datadir=/cdatadir=\\/soft\\/mysql\\/data' /etc/init.d/mysqld\n\n//å¯å¨æ°æ®åº\n[root@sql ~]# /etc/init.d/mysqld start\nStarting MySQL. SUCCESS!\n\n//æ£æ¥è¿ç¨\n[root@sql ~]# ps aux|grep mysql\n\n//æ£æ¥ç«¯å£\n[root@sql ~]# lsof -i :3306\nCOMMAND  PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nmysqld  2659 mysql   16u  IPv6  28431      0t0  TCP *:mysql (LISTEN)\n[root@sql ~]# ss -lntup|grep 3306\ntcp    LISTEN     0      80 :::3306  :::*   users:((\"mysqld\",pid=2659,fd=16))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n\n# 6.è¿æ¥æ°æ®åºæµè¯\n\n//é»è®¤æåµæ²¡æmysqlå½ä»¤, å¦ææå¯è½ä½¿ç¨è¿yumå®è£, è¿æ ·å®¹æè¿éæ°æ®åº(PATHè·¯å¾å­å¨å½ä»¤æ§è¡ä¼åçº§é®é¢)\n[root@sql ~]# mysql\n-bash: mysql: command not found\n\n//å¯ä»¥éæ©æ·»å è·¯å¾è³PATHä¸­, æèç´æ¥ä½¿ç¨ç»å¯¹è·¯å¾æ§è¡\n[root@sql ~]# echo \"export PATH=$PATH:/soft/mysql/bin\" >> /etc/profile\n[root@sql ~]# source /etc/profile\n\n//ç»éæ°æ®åº\n[root@sql ~]# mysql -uroot -p\"I,isfqnx.0tO\"\n\n//é»è®¤ç³»ç»éç½®æ°æ®åºå¯ç å¿é¡»ä¿®æ¹, å¦åæ æ³ä½¿ç¨æ°æ®åº\nmysql> show databases;\nERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.\n\n//ä¿®æ¹ç³»ç»é»è®¤å¯ç \nmysql> alter user root@'localhost' identified by 'bgx';\nQuery OK, 0 rows affected (0.01 sec)\nmysql> exit;\n\n//éåºåä½¿ç¨æ°å¯ç éæ°ç»å½æ°æ®åº\n[root@sql ~]# mysql -uroot -p\"bgx\"\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n4 rows in set (0.02 sec)\nmysql> exit;\næ³¨æ: å¦æéè¦éæ°åå§å[å¯é]\n\n//å¦æéæ°åå§åä¼å¯¼è´æ°æ®å¨é¨ä¸¢å¤±\n[root@sql ~]# yum install -y psmisc\n[root@sql ~]# killall mysqld\n[root@sql ~]# rm -rf /soft/mysql/data/*\n[root@sql ~]# /soft/mysql/bin/mysqld --initialize --user=mysql \\\n--basedir=/soft/mysql --datadir=/soft/mysql/data\n#å¯ä¸æ§è¡\n[root@sql ~]# /soft/mysql/bin/mysql_ssl_rsa_setup --datadir=/soft/mysql/data\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n\n\n\n# 3.æºç å®è£æ°æ®åº\n\n\n# 1.æºç å®è£mysqléè¦ä¾èµcmakeãboost\n\n[root@sql ~]# yum install libaio-devel gcc gcc-c++ ncurses ncurses-devel cmake -y\n[root@sql ~]# useradd -M -s /sbin/nologin mysql\n[root@sql ~]# mkdir /soft/src/ -p\n\n\n1\n2\n3\n\n\n\n# 2.ä¸è½½æºç åå¹¶ç¼è¯MySQL\n\n[root@sql ~]# wget http://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-boost-5.7.22.tar.gz\n[root@sql ~]# tar xf mysql-boost-5.7.22.tar.gz\n[root@sql ~]# cd mysql-5.7.22/\n[root@sql ~]# cmake -DCMAKE_INSTALL_PREFIX=/soft/mysql-5.7.22 \\\n-DMYSQL_UNIX_ADDR=/soft/mysql-5.7.22/data/mysql.sock \\\n-DMYSQL_DATADIR=/soft/mysql-5.7.22/data \\\n-DSYSCONFDIR=/soft/mysql-5.7.22/conf \\\n-DWITH_MYISAM_STORAGE_ENGINE=0 \\\n-DWITH_INNOBASE_STORAGE_ENGINE=1 \\\n-DWITH_MEMORY_STORAGE_ENGINE=0 \\\n-DWITH_READLINE=1 \\\n-DMYSQL_TCP_PORT=3306 \\\n-DENABLED_LOCAL_INFILE=1 \\\n-DWITH_PARTITION_STORAGE_ENGINE=1 \\\n-DEXTRA_CHARSETS=all \\\n-DDEFAULT_CHARSET=utf8 \\\n-DDEFAULT_COLLATION=utf8_general_ci \\\n-DWITH_BOOST=/soft/package/src/mysql-5.7.22/boost/boost_1_59_0\n[root@sql ~]# make\n[root@sql ~]# make install\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# 3.å®æååºæ¬ä¼å\n\n[root@sql ~]# ln -s /soft/mysql-5.7.22 /soft/mysql\n[root@sql ~]# mkdir /soft/mysql/data\n[root@sql ~]# chown -R mysql.mysql /soft/mysql\n\n\n1\n2\n3\n\n\n\n# 4.åå¤MySQLåºç¡éç½®æä»¶\n\n[root@sql ~]# vim /etc/my.cnf\n[mysqld]\nbasedir=/soft/mysql\ndatadir=/soft/mysql/data\n\n\n1\n2\n3\n4\n\n\n\n# 5.æ·è´MySQLç¨åºå¯å¨æä»¶\n\n//æ·è´å®æ¹åå¤çå¯å¨èæ¬\n[root@sql ~]# cp /soft/mysql/support-files/mysql.server /etc/init.d/mysqld\n\n//æ·»å ä¸ºç³»ç»æå¡, å¹¶è®¾å®å¼æºèªå¯å¨\n[root@sql ~]# chkconfig --add mysqld && chkconfig mysqld on\n\n\n1\n2\n3\n4\n5\n\n\n\n# 6.åå§åMySQL\n\n[root@sql ~]# /soft/mysql/bin/mysqld --initialize-insecure --user=mysql --basedir=/soft/mysql --datadir=/soft/mysql/data\n\n//å¯å¨MySQL\n[root@sql ~]# /etc/init.d/mysqld start\n\n//ä¸ºmysqlå½ä»¤æ·»å ç¯å¢åé,ä»¥ä¾¿åç»­ç®åæ§è¡å½ä»¤\n[root@sql ~]# echo >> \"export PATH=/data/soft/mysql/bin:$PATH\" /etc/profile\n[root@sql ~]# source /etc/profile\n\n//æºç ç¼è¯MySQLé»è®¤rootæ²¡æå¯ç \n[root@sql ~]# mysql\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# 4.åæ´æ°æ®åºå¯ç \n\n\n# 1.æ´æ¹rootå¯ç \n\n//ç¬¬ä¸ç§æ¹å¼, éè¦ç¥éå¯ç \n[root@sql ~]# mysqladmin -uroot -pBgx123.com password 'Bgx111.com'\nWarning: Since password will be sent to server in plain text, use ssl connection to ensure password safety.\n[root@sql ~]# mysql -uroot -pBgx111.com\nmysql>\n\n//ç¬¬äºç§æ¹å¼, ç»å½MySQL, ä¿®æ¹ç¸åºè¡¨\nmysql> update mysql.user set authentication_string=password('Bjtest123.com') where user='root';\nmysql> flush privileges;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# 2.å¿è®°mysql rootå¯ç \n\n[root@sql ~]# vim /etc/my.cnf\n[mysqld]\nskip-grant-tables # æ°å¢è·³è¿ææè¡¨\n\n//éå¯æ°æ®åºçæ\n[root@sql ~]# systemctl restart mysqld\n\n//æ¥çè¡¨å­æ®µ\nmysql> select user,host,authentication_string from mysql.user;\n+---------------+-----------+-------------------------------------------+\n| user          | host      | authentication_string                     |\n+---------------+-----------+-------------------------------------------+\n| root          | localhost | *C786BB788F276CD53317C80C1957E5F5696751F0 |\n| mysql.session | localhost | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |\n| mysql.sys     | localhost | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |\n+---------------+-----------+-------------------------------------------+\n3 rows in set (0.00 sec)\n\n//5.7.6çæ¬åæ´æ°å¯ç æ¹å¼\nmysql> update mysql.user set authentication_string=password('Bgx123.com') where user='root';\nmysql> exit\n\n//5.7.6çæ¬åæ´æ°å¯ç æ¹å¼\nmysql> update mysql.user set password=password('Bgx123.com') where user=\"root\" and host=\"localhost\";\n[root@sql ~]# vim /etc/my.cnf\n[mysqld]\n#skip-grant-tables #æ³¨é\n\n//éå¯æ°æ®åºçæ\n[root@sql ~]# systemctl restart mysqld\n\n//ä½¿ç¨æ°å¯ç ç»å½æ°æ®åº\n[root@sql ~]# mysql -uroot -pBgx123.com\nmysql> \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\nåæé¾æ¥http://www.sunrisenan.com/docs/mysql/mysql-1aofhklc0is34",normalizedContent:"# æ°æ®åºäºè¿å¶å®è£\n\n\n# 1.yumå®è£æ°æ®åº\n\nmysql yumä»åºæä¾äºç¨äºå¨linuxå¹³å°ä¸å®è£mysqlæå¡å¨ï¼å®¢æ·ç«¯åå¶ä»ç»ä»¶çrpmåãmysql-yumå®è£ä¸è½½å°å\n\n\n\n\n\n> ä½¿ç¨mysql yumä»åºæ¶ï¼é»è®¤éæ©å®è£ææ°çmysqlçæ¬ãå¦æéè¦ä½¿ç¨ä½çæ¬è¯·æå¦ä¸æä½ã\n\n\n# 1.å®è£mysqlä»åºæº\n\n[root@sql ~]# rpm -ivh https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm\n\n\n1\n\n\n\n# 2.éæ©å¹¶å¯ç¨éåå½åå¹³å°çåè¡å\n\n//ååºææmysqlåè¡çä»åº\n[root@sql ~]# yum repolist all|grep mysql\n\n//ç¦ç¨8.0åè¡çä»åº, å¯ç¨5.7åè¡çä»åº\n[root@sql ~]# yum install yum-utils\n[root@sql ~]# yum-config-manager --disable mysql80-community\n[root@sql ~]# yum-config-manager --enable mysql57-community\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n> å¯ä»¥æå¨ç¼è¾/etc/yum.repos.d/mysql-community.repo æä»¶éç½®ä»åº\n\n[mysql57-community]\nname=mysql 5.7 community server\nbaseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/6/$basearch/\nenabled=1\ngpgcheck=1\ngpgkey=file:///etc/pki/rpm-gpg/rpm-gpg-key-mysql\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 3.éè¿ä»¥ä¸å½ä»¤å®è£mysql, å¹¶å¯å¨mysql\n\n[root@sql ~]# yum install -y mysql-community-server\n[root@sql ~]# systemctl start mysqld\n[root@sql ~]# systemctl enable mysqld\n\n\n1\n2\n3\n\n\n> mysqlæå¡å¨åå§åï¼ä»éç¨äºmysql 5.7ï¼å¨æå¡å¨åå§å¯å¨æ¶ï¼å¦ææå¡å¨çæ°æ®ç®å½ä¸ºç©ºï¼åä¼åçä»¥ä¸æåµï¼ â¢ æå¡å¨å·²åå§åã â¢ å¨æ°æ®ç®å½ä¸­çæsslè¯ä¹¦åå¯é¥æä»¶ã â¢ validate_passwordæä»¶å®è£å¹¶å¯ç¨ã â¢ è¶çº§ç¨æ·å¸æ·ârootâ@âlocalhostâå·²åå»ºã\n\nè¶çº§ç¨æ·çå¯ç è¢«è®¾ç½®å¹¶å­å¨å¨éè¯¯æ¥å¿æä»¶ä¸­ãè¦æ¾ç¤ºå®ï¼è¯·ä½¿ç¨ä»¥ä¸å½ä»¤:\n\n[root@vm-70-160 ~]# grep \"password\" /var/log/mysqld.log \n2018-04-28t07:11:51.589629z 1 [note] a temporary password is generated for root@localhost: jhlrhucap3+7\néè¿ä½¿ç¨çæçä¸´æ¶å¯ç ç»å½å¹¶å°½å¿«æ´æ¹rootå¯ç å¹¶ä¸ºè¶çº§ç¨æ·å¸æ·è®¾ç½®èªå®ä¹å¯ç \n[root@vm-70-160 ~]# mysql -uroot -pjhlrhucap3+7\nmysql> alter user 'root'@'localhost' identified by 'bgx123.com';\n\n\n1\n2\n3\n4\n5\n\n\n> mysqlçvalidate_passwordæä»¶é»è®¤å®è£ãå°è¦æ±å¯ç è³å°åå«å¤§åãå°åãæ°å­ãç¹æ®å­ç¬¦ãå¹¶ä¸æ»å¯ç é¿åº¦è³å°ä¸º8ä¸ªå­ç¬¦ã\n\n\n# 2.éç¨å®è£æ°æ®åº\n\néç¨äºè¿å¶åç¼è¯æ¹å¼å®è£mysql, ä¸éè¦å¤æçç¼è¯è®¾ç½®åç¼è¯æ¶é´ç­å¾,è§£åä¸è½½çè½¯ä»¶å,åå§åå³å¯å®æmysqlçå®è£åå¯å¨ãmysqläºè¿å¶åä¸è½½å°å\n\n\n\nmysqläºè¿å¶åå®æ¹å®è£æå\n\n\n# 1.åºç¡ç¯å¢åå¤\n\n[root@sql ~]# systemctl stop firewalld\n[root@sql ~]# systemctl disable firewalld\n[root@sql ~]# setenforce 0\n\n//å»ºç«ç¨æ·ä¸ç¸åºç®å½\n[root@sql ~]# groupadd mysql\n[root@sql ~]# useradd -r -g mysql -s /sbin/nologin mysql\n[root@sql ~]# mkdir /soft/src -p && cd /soft/src\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 2.ä¸è½½mysqlå¹¶å®è£\n\n[root@sql src]# wget https://dev.mysql.com/get/downloads/mysql-5.7/mysql-5.7.22-linux-glibc2.12-x86_64.tar.gz\n[root@sql src]# tar xf mysql-5.7.22-linux-glibc2.12-x86_64.tar.gz -c /soft\n[root@sql src]# ln -s /soft/mysql-5.7.22-linux-glibc2.12-x86_64/ /soft/mysql\n\n\n1\n2\n3\n\n\n\n# 3.è¿è¡mysqlåå§å\n\n//åå»ºåå§åç®å½ä»¥åæ°æ®åºæ°æ®ç®å½\n\n[root@sql ~]# mkdir /soft/mysql/{mysql-file,data}\n[root@sql ~]# chown mysql.mysql /soft/mysql/\n\n//åå§åæ°æ®åº\n[root@sql ~]# /soft/mysql/bin/mysqld --initialize \\\n--user=mysql --basedir=/soft/mysql \\\n--datadir=/soft/mysql/data\n-------\n\n//åå§åæ°æ®åºä¼åè¯é»è®¤ç»éè´¦æ·ä¸å¯ç \n2018-04-28t02:30:33.954980z 1 [note] a temporary password is generated for'root@localhost: i,isfqnx.0to'\n-------\n\n//ä½¿ç¨sslè¿æ¥, åå§ååéæ°ææç®å½æé[å¦ä¸éè¦å¯å¿½ç¥]\n\n[root@sql ~]# /soft/mysql/bin/mysql_ssl_rsa_setup \\\n--datadir=/soft/mysql/data/\n[root@sql ~]# chown -r mysql.mysql /soft/mysql/\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n\n# 4.å»ºç«mysqléç½®æä»¶\n\n//mysqlå®è£ç®å½åmysqlæ°æ®åºç®å½\n[root@sql ~]# cp /etc/my.cnf /etc/my.cnf_bak\n[root@sql ~]# vim /etc/my.cnf\n[mysqld]\nbasedir=/soft/mysql\ndatadir=/soft/mysql/data\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 5.å¯å¨mysqlæ°æ®åº\n\n//æ¹å¼1,ä½¿ç¨ mysqld_safe \n[root@sql ~]# /soft/mysql/bin/mysqld_safe --user=mysql &\n\n//æ¹å¼2, ä½¿ç¨(systemv)æ¹å¼ç®¡ç, [å¼ºçæ¨è]\n[root@sql ~]# cp /soft/mysql/support-files/mysql.server /etc/init.d/mysqld\n[root@sql ~]# chkconfig --add mysqld\n[root@sql ~]# chkconfig mysqld on\n\n//ä¿®æ¹å®è£ç®å½ä¸æ°æ®å­æ¾ç®å½\n[root@sql ~]# sed -i '/^basedir=/cbasedir=\\/soft\\/mysql' /etc/init.d/mysqld \n[root@sql ~]# sed -i '/^datadir=/cdatadir=\\/soft\\/mysql\\/data' /etc/init.d/mysqld\n\n//å¯å¨æ°æ®åº\n[root@sql ~]# /etc/init.d/mysqld start\nstarting mysql. success!\n\n//æ£æ¥è¿ç¨\n[root@sql ~]# ps aux|grep mysql\n\n//æ£æ¥ç«¯å£\n[root@sql ~]# lsof -i :3306\ncommand  pid  user   fd   type device size/off node name\nmysqld  2659 mysql   16u  ipv6  28431      0t0  tcp *:mysql (listen)\n[root@sql ~]# ss -lntup|grep 3306\ntcp    listen     0      80 :::3306  :::*   users:((\"mysqld\",pid=2659,fd=16))\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\n\n# 6.è¿æ¥æ°æ®åºæµè¯\n\n//é»è®¤æåµæ²¡æmysqlå½ä»¤, å¦ææå¯è½ä½¿ç¨è¿yumå®è£, è¿æ ·å®¹æè¿éæ°æ®åº(pathè·¯å¾å­å¨å½ä»¤æ§è¡ä¼åçº§é®é¢)\n[root@sql ~]# mysql\n-bash: mysql: command not found\n\n//å¯ä»¥éæ©æ·»å è·¯å¾è³pathä¸­, æèç´æ¥ä½¿ç¨ç»å¯¹è·¯å¾æ§è¡\n[root@sql ~]# echo \"export path=$path:/soft/mysql/bin\" >> /etc/profile\n[root@sql ~]# source /etc/profile\n\n//ç»éæ°æ®åº\n[root@sql ~]# mysql -uroot -p\"i,isfqnx.0to\"\n\n//é»è®¤ç³»ç»éç½®æ°æ®åºå¯ç å¿é¡»ä¿®æ¹, å¦åæ æ³ä½¿ç¨æ°æ®åº\nmysql> show databases;\nerror 1820 (hy000): you must reset your password using alter user statement before executing this statement.\n\n//ä¿®æ¹ç³»ç»é»è®¤å¯ç \nmysql> alter user root@'localhost' identified by 'bgx';\nquery ok, 0 rows affected (0.01 sec)\nmysql> exit;\n\n//éåºåä½¿ç¨æ°å¯ç éæ°ç»å½æ°æ®åº\n[root@sql ~]# mysql -uroot -p\"bgx\"\nmysql> show databases;\n+--------------------+\n| database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n4 rows in set (0.02 sec)\nmysql> exit;\næ³¨æ: å¦æéè¦éæ°åå§å[å¯é]\n\n//å¦æéæ°åå§åä¼å¯¼è´æ°æ®å¨é¨ä¸¢å¤±\n[root@sql ~]# yum install -y psmisc\n[root@sql ~]# killall mysqld\n[root@sql ~]# rm -rf /soft/mysql/data/*\n[root@sql ~]# /soft/mysql/bin/mysqld --initialize --user=mysql \\\n--basedir=/soft/mysql --datadir=/soft/mysql/data\n#å¯ä¸æ§è¡\n[root@sql ~]# /soft/mysql/bin/mysql_ssl_rsa_setup --datadir=/soft/mysql/data\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n\n\n\n# 3.æºç å®è£æ°æ®åº\n\n\n# 1.æºç å®è£mysqléè¦ä¾èµcmakeãboost\n\n[root@sql ~]# yum install libaio-devel gcc gcc-c++ ncurses ncurses-devel cmake -y\n[root@sql ~]# useradd -m -s /sbin/nologin mysql\n[root@sql ~]# mkdir /soft/src/ -p\n\n\n1\n2\n3\n\n\n\n# 2.ä¸è½½æºç åå¹¶ç¼è¯mysql\n\n[root@sql ~]# wget http://dev.mysql.com/get/downloads/mysql-5.7/mysql-boost-5.7.22.tar.gz\n[root@sql ~]# tar xf mysql-boost-5.7.22.tar.gz\n[root@sql ~]# cd mysql-5.7.22/\n[root@sql ~]# cmake -dcmake_install_prefix=/soft/mysql-5.7.22 \\\n-dmysql_unix_addr=/soft/mysql-5.7.22/data/mysql.sock \\\n-dmysql_datadir=/soft/mysql-5.7.22/data \\\n-dsysconfdir=/soft/mysql-5.7.22/conf \\\n-dwith_myisam_storage_engine=0 \\\n-dwith_innobase_storage_engine=1 \\\n-dwith_memory_storage_engine=0 \\\n-dwith_readline=1 \\\n-dmysql_tcp_port=3306 \\\n-denabled_local_infile=1 \\\n-dwith_partition_storage_engine=1 \\\n-dextra_charsets=all \\\n-ddefault_charset=utf8 \\\n-ddefault_collation=utf8_general_ci \\\n-dwith_boost=/soft/package/src/mysql-5.7.22/boost/boost_1_59_0\n[root@sql ~]# make\n[root@sql ~]# make install\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n\n# 3.å®æååºæ¬ä¼å\n\n[root@sql ~]# ln -s /soft/mysql-5.7.22 /soft/mysql\n[root@sql ~]# mkdir /soft/mysql/data\n[root@sql ~]# chown -r mysql.mysql /soft/mysql\n\n\n1\n2\n3\n\n\n\n# 4.åå¤mysqlåºç¡éç½®æä»¶\n\n[root@sql ~]# vim /etc/my.cnf\n[mysqld]\nbasedir=/soft/mysql\ndatadir=/soft/mysql/data\n\n\n1\n2\n3\n4\n\n\n\n# 5.æ·è´mysqlç¨åºå¯å¨æä»¶\n\n//æ·è´å®æ¹åå¤çå¯å¨èæ¬\n[root@sql ~]# cp /soft/mysql/support-files/mysql.server /etc/init.d/mysqld\n\n//æ·»å ä¸ºç³»ç»æå¡, å¹¶è®¾å®å¼æºèªå¯å¨\n[root@sql ~]# chkconfig --add mysqld && chkconfig mysqld on\n\n\n1\n2\n3\n4\n5\n\n\n\n# 6.åå§åmysql\n\n[root@sql ~]# /soft/mysql/bin/mysqld --initialize-insecure --user=mysql --basedir=/soft/mysql --datadir=/soft/mysql/data\n\n//å¯å¨mysql\n[root@sql ~]# /etc/init.d/mysqld start\n\n//ä¸ºmysqlå½ä»¤æ·»å ç¯å¢åé,ä»¥ä¾¿åç»­ç®åæ§è¡å½ä»¤\n[root@sql ~]# echo >> \"export path=/data/soft/mysql/bin:$path\" /etc/profile\n[root@sql ~]# source /etc/profile\n\n//æºç ç¼è¯mysqlé»è®¤rootæ²¡æå¯ç \n[root@sql ~]# mysql\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# 4.åæ´æ°æ®åºå¯ç \n\n\n# 1.æ´æ¹rootå¯ç \n\n//ç¬¬ä¸ç§æ¹å¼, éè¦ç¥éå¯ç \n[root@sql ~]# mysqladmin -uroot -pbgx123.com password 'bgx111.com'\nwarning: since password will be sent to server in plain text, use ssl connection to ensure password safety.\n[root@sql ~]# mysql -uroot -pbgx111.com\nmysql>\n\n//ç¬¬äºç§æ¹å¼, ç»å½mysql, ä¿®æ¹ç¸åºè¡¨\nmysql> update mysql.user set authentication_string=password('bjtest123.com') where user='root';\nmysql> flush privileges;\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# 2.å¿è®°mysql rootå¯ç \n\n[root@sql ~]# vim /etc/my.cnf\n[mysqld]\nskip-grant-tables # æ°å¢è·³è¿ææè¡¨\n\n//éå¯æ°æ®åºçæ\n[root@sql ~]# systemctl restart mysqld\n\n//æ¥çè¡¨å­æ®µ\nmysql> select user,host,authentication_string from mysql.user;\n+---------------+-----------+-------------------------------------------+\n| user          | host      | authentication_string                     |\n+---------------+-----------+-------------------------------------------+\n| root          | localhost | *c786bb788f276cd53317c80c1957e5f5696751f0 |\n| mysql.session | localhost | *thisisnotavalidpasswordthatcanbeusedhere |\n| mysql.sys     | localhost | *thisisnotavalidpasswordthatcanbeusedhere |\n+---------------+-----------+-------------------------------------------+\n3 rows in set (0.00 sec)\n\n//5.7.6çæ¬åæ´æ°å¯ç æ¹å¼\nmysql> update mysql.user set authentication_string=password('bgx123.com') where user='root';\nmysql> exit\n\n//5.7.6çæ¬åæ´æ°å¯ç æ¹å¼\nmysql> update mysql.user set password=password('bgx123.com') where user=\"root\" and host=\"localhost\";\n[root@sql ~]# vim /etc/my.cnf\n[mysqld]\n#skip-grant-tables #æ³¨é\n\n//éå¯æ°æ®åºçæ\n[root@sql ~]# systemctl restart mysqld\n\n//ä½¿ç¨æ°å¯ç ç»å½æ°æ®åº\n[root@sql ~]# mysql -uroot -pbgx123.com\nmysql> \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\nåæé¾æ¥http://www.sunrisenan.com/docs/mysql/mysql-1aofhklc0is34",charsets:{cjk:!0}},{title:"oracleæ°æ®åºå®è£",frontmatter:{title:"oracleæ°æ®åºå®è£",date:"2023-03-01T15:15:52.000Z",permalink:"/pages/e977f3/",categories:["è¿ç»´","æ°æ®åº","oracle"],tags:[null],readingShow:"top",description:"1ãç³»ç»åéç½®è¦æ±",meta:[{name:"image",content:"http://pic.zzppjj.top/LightPicture/2023/03/fccca0cae5d5919e.png"},{name:"twitter:title",content:"oracleæ°æ®åºå®è£"},{name:"twitter:description",content:"1ãç³»ç»åéç½®è¦æ±"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://pic.zzppjj.top/LightPicture/2023/03/fccca0cae5d5919e.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/08.%E6%95%B0%E6%8D%AE%E5%BA%93/03.oracle/01.oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E8%A3%85.html"},{property:"og:type",content:"article"},{property:"og:title",content:"oracleæ°æ®åºå®è£"},{property:"og:description",content:"1ãç³»ç»åéç½®è¦æ±"},{property:"og:image",content:"http://pic.zzppjj.top/LightPicture/2023/03/fccca0cae5d5919e.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/08.%E6%95%B0%E6%8D%AE%E5%BA%93/03.oracle/01.oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E8%A3%85.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-03-01T15:15:52.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"oracleæ°æ®åºå®è£"},{itemprop:"description",content:"1ãç³»ç»åéç½®è¦æ±"},{itemprop:"image",content:"http://pic.zzppjj.top/LightPicture/2023/03/fccca0cae5d5919e.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/08.%E6%95%B0%E6%8D%AE%E5%BA%93/03.oracle/01.oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E8%A3%85.html",relativePath:"04.è¿ç»´/08.æ°æ®åº/03.oracle/01.oracleæ°æ®åºå®è£.md",key:"v-b2ae320e",path:"/pages/e977f3/",headers:[{level:3,title:"ä¸ãå®è£Oracle 12c",slug:"ä¸ãå®è£oracle-12c",normalizedTitle:"ä¸ãå®è£oracle 12c",charIndex:2},{level:4,title:"1ãå®è£åçæ³¨æäºé¡¹",slug:"_1ãå®è£åçæ³¨æäºé¡¹",normalizedTitle:"1ãå®è£åçæ³¨æäºé¡¹",charIndex:20},{level:4,title:"2ãOracle 12cå®è£è¿ç¨",slug:"_2ãoracle-12cå®è£è¿ç¨",normalizedTitle:"2ãoracle 12cå®è£è¿ç¨",charIndex:2688},{level:3,title:"äºãOracle 12cæ°æ®åºçåå»º",slug:"äºãoracle-12cæ°æ®åºçåå»º",normalizedTitle:"äºãoracle 12cæ°æ®åºçåå»º",charIndex:4931},{level:3,title:"ä¸ãOracle 12cæ°æ®åºçå¯å¨ä¸å³é­",slug:"ä¸ãoracle-12cæ°æ®åºçå¯å¨ä¸å³é­",normalizedTitle:"ä¸ãoracle 12cæ°æ®åºçå¯å¨ä¸å³é­",charIndex:5012},{level:4,title:"1ãå¯å¨ã å³é­ Oracle æ°æ®åº",slug:"_1ãå¯å¨ã-å³é­-oracle-æ°æ®åº",normalizedTitle:"1ãå¯å¨ã å³é­ oracle æ°æ®åº",charIndex:5037},{level:4,title:"2ãç®¡ç Oracle çå¬è¿ç¨",slug:"_2ãç®¡ç-oracle-çå¬è¿ç¨",normalizedTitle:"2ãç®¡ç oracle çå¬è¿ç¨",charIndex:5645},{level:3,title:"åãéä»¶",slug:"åãéä»¶",normalizedTitle:"åãéä»¶",charIndex:7189}],headersStr:"ä¸ãå®è£Oracle 12c 1ãå®è£åçæ³¨æäºé¡¹ 2ãOracle 12cå®è£è¿ç¨ äºãOracle 12cæ°æ®åºçåå»º ä¸ãOracle 12cæ°æ®åºçå¯å¨ä¸å³é­ 1ãå¯å¨ã å³é­ Oracle æ°æ®åº 2ãç®¡ç Oracle çå¬è¿ç¨ åãéä»¶",content:'# ä¸ãå®è£Oracle 12c\n\n# 1ãå®è£åçæ³¨æäºé¡¹\n\n1ãç³»ç»åéç½®è¦æ±\n\n> å®è£æ GNOME ä¸­ææ¡é¢ç¯å¢ é²ç«å¢çéç½®éé¡¹è®¾ç½®ä¸ºç¦ç¨ ã SELinuxè®¾ç½®ä¸ºç¦ç¨ ã é»è®¤å®è£è®¾ç½®ä¸ºè½¯ä»¶å¼å ã åæ ¸éæ©3.10.0.54.0.1.e17.x86_64åä»¥ä¸çæ¬ ç©çåå­å¿é¡»é«äº1GBï¼å¯¹äºVMware èææºå»ºè®®ä¸å°äº2GB . äº¤æ¢ç©ºé´ç©çåå­ä¸º1-2GBæ¶ï¼äº¤æ¢ååºä¸ºç©çåå­ç1.5-2åï¼ç©çåå­ä¸º2-16GBæ¶ï¼äº¤æ¢ååºä¸ç©çåå­å¤§å°ç¸åï¼ç©çåå­è¶è¿16GBæ¶ï¼äº¤æ¢ååºä½¿ç¨16GBå°±å¯ä»¥äºã\n\n2ãä¿®æ¹ä¸»æºååIP\n\n# vim /etc/hostname        //ä¿®æ¹ä¸»æºå\nOracle\n# vim /etc/hosts        //æ·»å ä¸»æºIPæ å°\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.1.10 Oracle\n\n\n1\n2\n3\n4\n5\n6\n\n\n3ãè½¯ä»¶ç¯å¢è¦æ±\n\n# yum -y install binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc glibc-devel ksh libaio libaio-devel libgcc libgcc libstdc++ libstdc++-devel libXi libXtst make sysstat unixODBC unixODBC-devel\n\n\n1\n\n\n4ãåæ ¸è¦æ±\n\n# vim /etc/sysctl.conf\n......\nfs.aio-max-nr = 1048576\nfs.file-max  = 6815744\nkernel.shmall =  2097152\nkernel.shmmax =  4294967295\nkernel.shmmni =  4096\nkernel.sem  =   250 32000 100 128\nnet.ipv4.ip_local_port_range  =  9000 65500\nnet.core.rmem_max  = 4194304\nnet.core.rmem_default = 262144\nnet.core.wmem_default = 262144\nnet.core.wmem_max = 1048576\n# sysctl -p\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n5ãOracleç¨æ·ç¯å¢è¦æ± åå»ºåºå®çè¿è¡ç¨æ·oracleï¼å®è£ç»oinstallï¼ç®¡çç»dba\n\n# groupadd -g 54321 oinstall        //åå»ºå®è£ç»ï¼-g ç»IDï¼\n# groupadd -g 54322 dba        //åå»ºç®¡çç»\n# useradd -u 54321 -g oinstall -G dba oracle        //åå»ºè¿è¡ç¨æ·\n# passwd oracle        //è®¾ç½®å¯ç \n# mkdir -p /u01/app/oracle        //å»ºç«åºæ¬ç®å½\n# chown -R oracle:oinstall /u01/app/\n# chmod -R 755 /u01/app/oracle/\n# vim /home/oracle/.bash_profile        //è°æ´oracleç¨æ·çç¯å¢éç½®\n......\numask 022\nORACLE_BASE=/u01/app/oracle        //å®ä¹åºæ¬ç®å½\nORACLE_HOME=/u01/app/oracle/product/12.2.0/dbhome_1/        //å®ä¹å®è£å®¶ç®å½\nORACLE_SID=orcl        // å®ä¹æ°æ®åºå®ä¾åç§°\nNLS_LANG="SIMPLIFIED CHINESE_CHINA".UTF8        // ç¡®å®ä½¿ç¨ä½ç§è¯­è¨ç¯å¢\nPATH=$PATH:$ORACLE_HOME/bin\nLANG=zh_CN.UTF-8\nexport  DISPLAY=:0.0\nexport PATH LANG NLS_LANG ORACLE_BASE ORACLE_HOME ORACLE_SID\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n6ãoracleç¨æ·èµæºéå¶è¦æ±\n\n# vim /etc/pam.d/login\n......\nsession required        /lib/security/pam_limits.so\nsession required        pam_limits.so\n# vim /etc/security/limits.conf\noracle  soft    nproc   2047        //è¿ç¨æ°è½¯éå¶\noracle  hard    nproc   16384        //è¿ç¨æ°ç¡¬éå¶\noracle  soft    nofile  1024        //æä»¶æ°è½¯éå¶\noracle  hard    nofile  65536        //æä»¶æ°ç¡¬éå¶\noracle  soft    stack   10240        //Oracleè½¯å æ éå¶\n# vim /etc/profile\n......\nif      [ $USER = "oracle" ]; then\n        if [ $SHELL = "/bin/ksh" ]; then\n                ulimit -p 16384\n                ulimit -n 65536\n        else\n                ulimit -u 16384 -n 65536\n        fi\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n7ãéæ°å¯å¨ç³»ç»\n\n# 2ãOracle 12cå®è£è¿ç¨\n\nOracleçä¸­æå®æ¹ç½åä¸ºOracle CRM On Demand current releaseï¼å®æ¯æOracle12cå®è£æä»¶çåè´¹ä¸è½½ï¼éæ³¨åè´¦å·)ãè¿éæä»¬ä½¿ç¨åçå®è£ã\n\n# mkdir /tmp/abc\n# cd /media/\n# ls\nlinuxx64_12201_database.zip\n# cp linuxx64_12201_database.zip /tmp/abc/\n# cd /tmp/abc/\n# unzip linuxx64_12201_database.zip \n# xhost +        //ä¸ å®è¦ä»¥rootç¨æ·å¨å¾å½¢ç¯å¢ä¸­æä½\naccess control disabled, clients can connect from any host\n# su - oracle \n$ cd /tmp/abc/database/\n$ export DISPLAY=:0.0        //è®¾ç½®DISPLAYç¯å¢åé\n$ ./runInstaller \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n1ãå¸åå®è£è¿ç¨ å¦æå·²è´­ä¹°Oracle 12cæ°æ®åºçææä¸æå¡å¨è½å¤è¿æ¥Internetï¼å»ºè®®æ­£ç¡®å¡«åçµå­é®ä»¶å°ååOracle Supportå£ä»¤ä»¥ä¾¿åæ¶æ¥æ¶å®æ¹çå®å¨æ´æ°éç¥ã éç½®å®å¨æ´æ°\n\n\n\nå®è£éé¡¹\n\n\n\nç³»ç»ç±»\n\n\n\næ°æ®åºå®è£éé¡¹\n\n\n\nå®è£ç±»å\n\n\n\nå¸åå®è£éç½®\n\n\n\nåå»ºäº§åæ¸å\n\n\n\nåå³æ¡ä»¶æ£æ¥åæ±æ»\n\n\n\nå®è£äº§å\n\n\n\nå®è£å®æ\n\n\n\næ§è¡éç½®èæ¬æ¶åæ¢ä¸ºrootç¨æ·å¹¶ä¾æ¬¡æ§è¡èæ¬æä»¶\n\n# /u01/app/oraInventory/orainstRoot.sh \næ´æ¹æé/u01/app/oraInventory.\næ·»å ç»çè¯»åååå¥æéã\nå é¤å¨å±çè¯»å, åå¥åæ§è¡æéã\n\næ´æ¹ç»å/u01/app/oraInventory å° oinstall.\nèæ¬çæ§è¡å·²å®æã\n# /u01/app/oracle/product/12.2.0/dbhome_1/root.sh         //æç§é»è®¤å¼æä¸¤æ¬¡Enteré®\nPerforming root user operation.\n\nThe following environment variables are set as:\n    ORACLE_OWNER= oracle\n    ORACLE_HOME=  /u01/app/oracle/product/12.2.0/dbhome_1\n\nEnter the full pathname of the local bin directory: [/usr/local/bin]: \n   Copying dbhome to /usr/local/bin ...\n   Copying oraenv to /usr/local/bin ...\n   Copying coraenv to /usr/local/bin ...\n\n\nCreating /etc/oratab file...\nEntries will be added to the /etc/oratab file as needed by\nDatabase Configuration Assistant when a database is created\nFinished running generic part of root script.\nNow product-specific root actions will be performed.\nDo you want to setup Oracle Trace File Analyzer (TFA) now ? yes|[no] : \n\nOracle Trace File Analyzer (TFA - User Mode) is available at :\n    /u01/app/oracle/product/12.2.0/dbhome_1/suptools/tfa/release/tfa_home/bin/tfactl\n\nOR\n\nOracle Trace File Analyzer (TFA - Daemon Mode) can be installed by running this script :\n    /u01/app/oracle/product/12.2.0/dbhome_1/suptools/tfa/release/tfa_home/install/roottfa.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n2ãå®è£flash player\n\nwget http://linuxdownload.adobe.com/adobe-release/adobe-release-x86_64-1.0-1.noarch.rpm\nrpm -ivh adobe-release-x86_64-1.0-1.noarch.rpm\nyum -y install flash-plugin\n\n\n1\n2\n3\n\n\n\n# äºãOracle 12cæ°æ®åºçåå»º\n\n1ãä»¥oracleç¨æ·èº«ä»½è¿è¡å½ä»¤DBCA\n\n$ dbca\n\n\n1\n\n\néæ©æ°æ®åºæä½\n\n\n\nå¡«åæ°æ®åºä¿¡æ¯\n\n\n\n\n# ä¸ãOracle 12cæ°æ®åºçå¯å¨ä¸å³é­\n\n# 1ãå¯å¨ã å³é­ Oracle æ°æ®åº\n\n1ãæ°æ®åºçå¯å¨\n\n$ sqlplus / as sysdba         //ä»¥sysdbaç¨æ·ç»å½\nSQL> startup nomount         //ä»å¯å¨ä¸ä¸ªOracleå®ä¾\nSQL> startup mount         //å¯å¨å®ä¾å¹¶ä¸è£è½½æ°æ®åºï¼ä½æ²¡ææå¼æ°æ®åº\nSQL> startup         //å®æå¯å¨å®ä¾ãè£è½½æ°æ®åºåæå¼æ°æ®åº\n\n\n1\n2\n3\n4\n\n\nå¿é¡»è¿è¡ä¸é¢çä¸¤æ¡å½ä»¤ ï¼ æ°æ®åºæè½æ­£ç¡®å¯å¨\n\nALTER DATABASE MOUNT;         //startup nomountå¯å¨æ¶\nALTER DATABASE OPEN;         //startup nomountå¯å¨æ¶/startup mountå¯å¨æ¶\n\n\n1\n2\n\n\n2ãæ°æ®åºçå³é­\n\nSQL> shutdown normal         //åshutdownï¼ç®åè¿æ¥çææç¨æ·é½ä»æ°æ®åºä¸­éåºåæå¼å§å³é­æ°æ®åº\nSQL> shutdown immediate         //å®å¨ä¸ç¸å¯¹è¾å¿«\nSQL> shutdown transactional         //è®¡åå³é­æ°æ®åº\nSQL> shutdown abort         //ä¼é ææ°æ®ä¸¢å¤±ï¼å¹¶ä¸æ¢å¤æ°æ®åºä¹éè¦è¾é¿æ¶é´\n\n\n1\n2\n3\n4\n\n\n# 2ãç®¡ç Oracle çå¬è¿ç¨\n\nåå¯å¨çå¬ï¼ åå¯å¨æ°æ®åº 1ãå¯å¨çå¬\n\n$ lsnrctl start\n\n\n1\n\n\n2ãå³é­çå¬\n\n$ lsnrctl stop\n\n\n1\n\n\n3ãå¶ä»å½ä»¤\n\n$ lsnrctl status         //æ¥ççå¬è¿ç¨ç¶æ\n$ lsnrctl reload         //éæ°å è½½çå¬è¿ç¨\n$ lsnrctl set         //è®¾ç½®ç¸åºåæ°\n$ lsnrctl show         //æ¥çå½ååæ°çåå¼\n$ lsnrctl help         //æ¾ç¤ºå¸®å©ä¿¡æ¯\n$ lsnrctl version         //æ¾ç¤ºå½åçå¬è¿ç¨çæ¬\n$ lsnrctl change_password         //æ¹åå£ä»¤\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n4ãå¢å æ°ççå¬è¿ç¨\n\n$ vim $ORACLE_HOME/network/admin/listener.ora\nLISTENER =\n  (DESCRIPTION_LIST =\n    (DESCRIPTION =\n      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.1.1)(PORT = 1521))\n      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))\n    )\n  )\nLISTENER1 =\n  (DESCRIPTION_LIST =\n    (DESCRIPTION  =\n      (ADDRESS = (PROTOCOL = TCP) (HOST = Oracle) (PORT = 1522))         //ä¸»æºä¸ºOracleï¼ç«¯å£ä¸º1522\n    )\n  )\n#éææ³¨åæ¨¡å\nSID_LIST_LISTENER =         //SID_LIST_çå¬å\n  (SID_LIST =         \n    (SID_DESC =         \n      (SID NAME = orcl)         //å®ä¾å\n      (ORACLE_HOME = /uO1/app/oracle/product/12.2.0/dbhome_1)         //æ è¯æå¡ä¸»ç®å½ä½ç½®\n      (GLOBAL_DBNAME = orcl)         //å¨å±æ°æ®åºåç§°\n    )\n  )\n$ netstat -lnupt | grep 1522\n(Not all processes could be identified, non-owned process info\n will not be shown, you would have to be root to see it all.)\ntcp6       0      0 :::1522                 :::*                    LISTEN      3725/tnslsnr  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\næ¥è¯¢GLOBAL_DBNAMEä»£ç \n\nSQL> select global_name from global_name;\n\nGLOBAL_NAME\n--------------------------------------------------------------------------------\nORCL\n\n\n1\n2\n3\n4\n5\n\n\n\n# åãéä»¶\n\nå¦ï¼å³äºsqlplusæ¹åé®ä¸è½ç¨çè§£å³æ¹æ³\n\n# yum -y install ncurses* readline*\n# wget https://fossies.org/linux/privat/rlwrap-0.45.2.tar.gz\n# tar zxf rlwrap-0.45.2.tar.gz -C /usr/src/\n# cd /usr/src/rlwrap-0.45.2/\n# ./configure && make && make install\n# vim /home/oracle/.bash_profile\n......\nalias sqlplus=\'rlwrap sqlplus\'\nalias rman=\'rlwrap rman\' \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n----------------------------------------\n\nåæé¾æ¥ï¼æ°æ®åºé¨ç½² | Gaoyufu \'s blog',normalizedContent:'# ä¸ãå®è£oracle 12c\n\n# 1ãå®è£åçæ³¨æäºé¡¹\n\n1ãç³»ç»åéç½®è¦æ±\n\n> å®è£æ gnome ä¸­ææ¡é¢ç¯å¢ é²ç«å¢çéç½®éé¡¹è®¾ç½®ä¸ºç¦ç¨ ã selinuxè®¾ç½®ä¸ºç¦ç¨ ã é»è®¤å®è£è®¾ç½®ä¸ºè½¯ä»¶å¼å ã åæ ¸éæ©3.10.0.54.0.1.e17.x86_64åä»¥ä¸çæ¬ ç©çåå­å¿é¡»é«äº1gbï¼å¯¹äºvmware èææºå»ºè®®ä¸å°äº2gb . äº¤æ¢ç©ºé´ç©çåå­ä¸º1-2gbæ¶ï¼äº¤æ¢ååºä¸ºç©çåå­ç1.5-2åï¼ç©çåå­ä¸º2-16gbæ¶ï¼äº¤æ¢ååºä¸ç©çåå­å¤§å°ç¸åï¼ç©çåå­è¶è¿16gbæ¶ï¼äº¤æ¢ååºä½¿ç¨16gbå°±å¯ä»¥äºã\n\n2ãä¿®æ¹ä¸»æºååip\n\n# vim /etc/hostname        //ä¿®æ¹ä¸»æºå\noracle\n# vim /etc/hosts        //æ·»å ä¸»æºipæ å°\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n192.168.1.10 oracle\n\n\n1\n2\n3\n4\n5\n6\n\n\n3ãè½¯ä»¶ç¯å¢è¦æ±\n\n# yum -y install binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc glibc-devel ksh libaio libaio-devel libgcc libgcc libstdc++ libstdc++-devel libxi libxtst make sysstat unixodbc unixodbc-devel\n\n\n1\n\n\n4ãåæ ¸è¦æ±\n\n# vim /etc/sysctl.conf\n......\nfs.aio-max-nr = 1048576\nfs.file-max  = 6815744\nkernel.shmall =  2097152\nkernel.shmmax =  4294967295\nkernel.shmmni =  4096\nkernel.sem  =   250 32000 100 128\nnet.ipv4.ip_local_port_range  =  9000 65500\nnet.core.rmem_max  = 4194304\nnet.core.rmem_default = 262144\nnet.core.wmem_default = 262144\nnet.core.wmem_max = 1048576\n# sysctl -p\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n5ãoracleç¨æ·ç¯å¢è¦æ± åå»ºåºå®çè¿è¡ç¨æ·oracleï¼å®è£ç»oinstallï¼ç®¡çç»dba\n\n# groupadd -g 54321 oinstall        //åå»ºå®è£ç»ï¼-g ç»idï¼\n# groupadd -g 54322 dba        //åå»ºç®¡çç»\n# useradd -u 54321 -g oinstall -g dba oracle        //åå»ºè¿è¡ç¨æ·\n# passwd oracle        //è®¾ç½®å¯ç \n# mkdir -p /u01/app/oracle        //å»ºç«åºæ¬ç®å½\n# chown -r oracle:oinstall /u01/app/\n# chmod -r 755 /u01/app/oracle/\n# vim /home/oracle/.bash_profile        //è°æ´oracleç¨æ·çç¯å¢éç½®\n......\numask 022\noracle_base=/u01/app/oracle        //å®ä¹åºæ¬ç®å½\noracle_home=/u01/app/oracle/product/12.2.0/dbhome_1/        //å®ä¹å®è£å®¶ç®å½\noracle_sid=orcl        // å®ä¹æ°æ®åºå®ä¾åç§°\nnls_lang="simplified chinese_china".utf8        // ç¡®å®ä½¿ç¨ä½ç§è¯­è¨ç¯å¢\npath=$path:$oracle_home/bin\nlang=zh_cn.utf-8\nexport  display=:0.0\nexport path lang nls_lang oracle_base oracle_home oracle_sid\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\n6ãoracleç¨æ·èµæºéå¶è¦æ±\n\n# vim /etc/pam.d/login\n......\nsession required        /lib/security/pam_limits.so\nsession required        pam_limits.so\n# vim /etc/security/limits.conf\noracle  soft    nproc   2047        //è¿ç¨æ°è½¯éå¶\noracle  hard    nproc   16384        //è¿ç¨æ°ç¡¬éå¶\noracle  soft    nofile  1024        //æä»¶æ°è½¯éå¶\noracle  hard    nofile  65536        //æä»¶æ°ç¡¬éå¶\noracle  soft    stack   10240        //oracleè½¯å æ éå¶\n# vim /etc/profile\n......\nif      [ $user = "oracle" ]; then\n        if [ $shell = "/bin/ksh" ]; then\n                ulimit -p 16384\n                ulimit -n 65536\n        else\n                ulimit -u 16384 -n 65536\n        fi\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\n7ãéæ°å¯å¨ç³»ç»\n\n# 2ãoracle 12cå®è£è¿ç¨\n\noracleçä¸­æå®æ¹ç½åä¸ºoracle crm on demand current releaseï¼å®æ¯æoracle12cå®è£æä»¶çåè´¹ä¸è½½ï¼éæ³¨åè´¦å·)ãè¿éæä»¬ä½¿ç¨åçå®è£ã\n\n# mkdir /tmp/abc\n# cd /media/\n# ls\nlinuxx64_12201_database.zip\n# cp linuxx64_12201_database.zip /tmp/abc/\n# cd /tmp/abc/\n# unzip linuxx64_12201_database.zip \n# xhost +        //ä¸ å®è¦ä»¥rootç¨æ·å¨å¾å½¢ç¯å¢ä¸­æä½\naccess control disabled, clients can connect from any host\n# su - oracle \n$ cd /tmp/abc/database/\n$ export display=:0.0        //è®¾ç½®displayç¯å¢åé\n$ ./runinstaller \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n1ãå¸åå®è£è¿ç¨ å¦æå·²è´­ä¹°oracle 12cæ°æ®åºçææä¸æå¡å¨è½å¤è¿æ¥internetï¼å»ºè®®æ­£ç¡®å¡«åçµå­é®ä»¶å°ååoracle supportå£ä»¤ä»¥ä¾¿åæ¶æ¥æ¶å®æ¹çå®å¨æ´æ°éç¥ã éç½®å®å¨æ´æ°\n\n\n\nå®è£éé¡¹\n\n\n\nç³»ç»ç±»\n\n\n\næ°æ®åºå®è£éé¡¹\n\n\n\nå®è£ç±»å\n\n\n\nå¸åå®è£éç½®\n\n\n\nåå»ºäº§åæ¸å\n\n\n\nåå³æ¡ä»¶æ£æ¥åæ±æ»\n\n\n\nå®è£äº§å\n\n\n\nå®è£å®æ\n\n\n\næ§è¡éç½®èæ¬æ¶åæ¢ä¸ºrootç¨æ·å¹¶ä¾æ¬¡æ§è¡èæ¬æä»¶\n\n# /u01/app/orainventory/orainstroot.sh \næ´æ¹æé/u01/app/orainventory.\næ·»å ç»çè¯»åååå¥æéã\nå é¤å¨å±çè¯»å, åå¥åæ§è¡æéã\n\næ´æ¹ç»å/u01/app/orainventory å° oinstall.\nèæ¬çæ§è¡å·²å®æã\n# /u01/app/oracle/product/12.2.0/dbhome_1/root.sh         //æç§é»è®¤å¼æä¸¤æ¬¡enteré®\nperforming root user operation.\n\nthe following environment variables are set as:\n    oracle_owner= oracle\n    oracle_home=  /u01/app/oracle/product/12.2.0/dbhome_1\n\nenter the full pathname of the local bin directory: [/usr/local/bin]: \n   copying dbhome to /usr/local/bin ...\n   copying oraenv to /usr/local/bin ...\n   copying coraenv to /usr/local/bin ...\n\n\ncreating /etc/oratab file...\nentries will be added to the /etc/oratab file as needed by\ndatabase configuration assistant when a database is created\nfinished running generic part of root script.\nnow product-specific root actions will be performed.\ndo you want to setup oracle trace file analyzer (tfa) now ? yes|[no] : \n\noracle trace file analyzer (tfa - user mode) is available at :\n    /u01/app/oracle/product/12.2.0/dbhome_1/suptools/tfa/release/tfa_home/bin/tfactl\n\nor\n\noracle trace file analyzer (tfa - daemon mode) can be installed by running this script :\n    /u01/app/oracle/product/12.2.0/dbhome_1/suptools/tfa/release/tfa_home/install/roottfa.sh\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n\n\n2ãå®è£flash player\n\nwget http://linuxdownload.adobe.com/adobe-release/adobe-release-x86_64-1.0-1.noarch.rpm\nrpm -ivh adobe-release-x86_64-1.0-1.noarch.rpm\nyum -y install flash-plugin\n\n\n1\n2\n3\n\n\n\n# äºãoracle 12cæ°æ®åºçåå»º\n\n1ãä»¥oracleç¨æ·èº«ä»½è¿è¡å½ä»¤dbca\n\n$ dbca\n\n\n1\n\n\néæ©æ°æ®åºæä½\n\n\n\nå¡«åæ°æ®åºä¿¡æ¯\n\n\n\n\n# ä¸ãoracle 12cæ°æ®åºçå¯å¨ä¸å³é­\n\n# 1ãå¯å¨ã å³é­ oracle æ°æ®åº\n\n1ãæ°æ®åºçå¯å¨\n\n$ sqlplus / as sysdba         //ä»¥sysdbaç¨æ·ç»å½\nsql> startup nomount         //ä»å¯å¨ä¸ä¸ªoracleå®ä¾\nsql> startup mount         //å¯å¨å®ä¾å¹¶ä¸è£è½½æ°æ®åºï¼ä½æ²¡ææå¼æ°æ®åº\nsql> startup         //å®æå¯å¨å®ä¾ãè£è½½æ°æ®åºåæå¼æ°æ®åº\n\n\n1\n2\n3\n4\n\n\nå¿é¡»è¿è¡ä¸é¢çä¸¤æ¡å½ä»¤ ï¼ æ°æ®åºæè½æ­£ç¡®å¯å¨\n\nalter database mount;         //startup nomountå¯å¨æ¶\nalter database open;         //startup nomountå¯å¨æ¶/startup mountå¯å¨æ¶\n\n\n1\n2\n\n\n2ãæ°æ®åºçå³é­\n\nsql> shutdown normal         //åshutdownï¼ç®åè¿æ¥çææç¨æ·é½ä»æ°æ®åºä¸­éåºåæå¼å§å³é­æ°æ®åº\nsql> shutdown immediate         //å®å¨ä¸ç¸å¯¹è¾å¿«\nsql> shutdown transactional         //è®¡åå³é­æ°æ®åº\nsql> shutdown abort         //ä¼é ææ°æ®ä¸¢å¤±ï¼å¹¶ä¸æ¢å¤æ°æ®åºä¹éè¦è¾é¿æ¶é´\n\n\n1\n2\n3\n4\n\n\n# 2ãç®¡ç oracle çå¬è¿ç¨\n\nåå¯å¨çå¬ï¼ åå¯å¨æ°æ®åº 1ãå¯å¨çå¬\n\n$ lsnrctl start\n\n\n1\n\n\n2ãå³é­çå¬\n\n$ lsnrctl stop\n\n\n1\n\n\n3ãå¶ä»å½ä»¤\n\n$ lsnrctl status         //æ¥ççå¬è¿ç¨ç¶æ\n$ lsnrctl reload         //éæ°å è½½çå¬è¿ç¨\n$ lsnrctl set         //è®¾ç½®ç¸åºåæ°\n$ lsnrctl show         //æ¥çå½ååæ°çåå¼\n$ lsnrctl help         //æ¾ç¤ºå¸®å©ä¿¡æ¯\n$ lsnrctl version         //æ¾ç¤ºå½åçå¬è¿ç¨çæ¬\n$ lsnrctl change_password         //æ¹åå£ä»¤\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n4ãå¢å æ°ççå¬è¿ç¨\n\n$ vim $oracle_home/network/admin/listener.ora\nlistener =\n  (description_list =\n    (description =\n      (address = (protocol = tcp)(host = 192.168.1.1)(port = 1521))\n      (address = (protocol = ipc)(key = extproc1521))\n    )\n  )\nlistener1 =\n  (description_list =\n    (description  =\n      (address = (protocol = tcp) (host = oracle) (port = 1522))         //ä¸»æºä¸ºoracleï¼ç«¯å£ä¸º1522\n    )\n  )\n#éææ³¨åæ¨¡å\nsid_list_listener =         //sid_list_çå¬å\n  (sid_list =         \n    (sid_desc =         \n      (sid name = orcl)         //å®ä¾å\n      (oracle_home = /uo1/app/oracle/product/12.2.0/dbhome_1)         //æ è¯æå¡ä¸»ç®å½ä½ç½®\n      (global_dbname = orcl)         //å¨å±æ°æ®åºåç§°\n    )\n  )\n$ netstat -lnupt | grep 1522\n(not all processes could be identified, non-owned process info\n will not be shown, you would have to be root to see it all.)\ntcp6       0      0 :::1522                 :::*                    listen      3725/tnslsnr  \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\næ¥è¯¢global_dbnameä»£ç \n\nsql> select global_name from global_name;\n\nglobal_name\n--------------------------------------------------------------------------------\norcl\n\n\n1\n2\n3\n4\n5\n\n\n\n# åãéä»¶\n\nå¦ï¼å³äºsqlplusæ¹åé®ä¸è½ç¨çè§£å³æ¹æ³\n\n# yum -y install ncurses* readline*\n# wget https://fossies.org/linux/privat/rlwrap-0.45.2.tar.gz\n# tar zxf rlwrap-0.45.2.tar.gz -c /usr/src/\n# cd /usr/src/rlwrap-0.45.2/\n# ./configure && make && make install\n# vim /home/oracle/.bash_profile\n......\nalias sqlplus=\'rlwrap sqlplus\'\nalias rman=\'rlwrap rman\' \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n----------------------------------------\n\nåæé¾æ¥ï¼æ°æ®åºé¨ç½² | gaoyufu \'s blog',charsets:{cjk:!0}},{title:"mongodbç¸å³æ¦å¿µ",frontmatter:{title:"mongodbç¸å³æ¦å¿µ",categories:"mongodb",tags:["mongodb"],date:"2022-12-09T20:50:33.000Z",permalink:"/pages/598be1/",readingShow:"top",description:"ä¼ ç»çå³ç³»åæ°æ®åºï¼å¦MySQLï¼ï¼å¨æ°æ®æä½çâä¸é«âéæ±ä»¥ååºå¯¹Web2.0çç½ç«éæ±é¢åï¼æ¾å¾åä¸ä»å¿ã",meta:[{name:"image",content:"https://img-blog.csdnimg.cn/20200912222258123.png"},{name:"twitter:title",content:"mongodbç¸å³æ¦å¿µ"},{name:"twitter:description",content:"ä¼ ç»çå³ç³»åæ°æ®åºï¼å¦MySQLï¼ï¼å¨æ°æ®æä½çâä¸é«âéæ±ä»¥ååºå¯¹Web2.0çç½ç«éæ±é¢åï¼æ¾å¾åä¸ä»å¿ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://img-blog.csdnimg.cn/20200912222258123.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/08.%E6%95%B0%E6%8D%AE%E5%BA%93/02.mongodb/01.mongodb%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5.html"},{property:"og:type",content:"article"},{property:"og:title",content:"mongodbç¸å³æ¦å¿µ"},{property:"og:description",content:"ä¼ ç»çå³ç³»åæ°æ®åºï¼å¦MySQLï¼ï¼å¨æ°æ®æä½çâä¸é«âéæ±ä»¥ååºå¯¹Web2.0çç½ç«éæ±é¢åï¼æ¾å¾åä¸ä»å¿ã"},{property:"og:image",content:"https://img-blog.csdnimg.cn/20200912222258123.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/08.%E6%95%B0%E6%8D%AE%E5%BA%93/02.mongodb/01.mongodb%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:50:33.000Z"},{property:"article:tag",content:"mongodb"},{itemprop:"name",content:"mongodbç¸å³æ¦å¿µ"},{itemprop:"description",content:"ä¼ ç»çå³ç³»åæ°æ®åºï¼å¦MySQLï¼ï¼å¨æ°æ®æä½çâä¸é«âéæ±ä»¥ååºå¯¹Web2.0çç½ç«éæ±é¢åï¼æ¾å¾åä¸ä»å¿ã"},{itemprop:"image",content:"https://img-blog.csdnimg.cn/20200912222258123.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/08.%E6%95%B0%E6%8D%AE%E5%BA%93/02.mongodb/01.mongodb%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5.html",relativePath:"04.è¿ç»´/08.æ°æ®åº/02.mongodb/01.mongodbç¸å³æ¦å¿µ.md",key:"v-1ebf1e36",path:"/pages/598be1/",headers:[{level:2,title:"1.1 ä¸å¡åºç¨åºæ¯",slug:"_1-1-ä¸å¡åºç¨åºæ¯",normalizedTitle:"1.1 ä¸å¡åºç¨åºæ¯",charIndex:22},{level:2,title:"1.2 MongoDB ç®ä»",slug:"_1-2-mongodb-ç®ä»",normalizedTitle:"1.2 mongodb ç®ä»",charIndex:978},{level:2,title:"1.3 ä½ç³»ç»æ",slug:"_1-3-ä½ç³»ç»æ",normalizedTitle:"1.3 ä½ç³»ç»æ",charIndex:1280},{level:2,title:"1.4 æ°æ®æ¨¡å",slug:"_1-4-æ°æ®æ¨¡å",normalizedTitle:"1.4 æ°æ®æ¨¡å",charIndex:1672},{level:2,title:"1.5 MongoDB çç¹ç¹",slug:"_1-5-mongodb-çç¹ç¹",normalizedTitle:"1.5 mongodb çç¹ç¹",charIndex:3437},{level:2,title:"2.1 Windows ç³»ç»ä¸­çå®è£å¯å¨",slug:"_2-1-windows-ç³»ç»ä¸­çå®è£å¯å¨",normalizedTitle:"2.1 windows ç³»ç»ä¸­çå®è£å¯å¨",charIndex:4075},{level:3,title:"2.1.1 ä¸è½½å®è£å",slug:"_2-1-1-ä¸è½½å®è£å",normalizedTitle:"2.1.1 ä¸è½½å®è£å",charIndex:4100},{level:3,title:"2.1.2 è§£åå®è£å¯å¨",slug:"_2-1-2-è§£åå®è£å¯å¨",normalizedTitle:"2.1.2 è§£åå®è£å¯å¨",charIndex:4452},{level:2,title:"2.2 Shell è¿æ¥(mongoå½ä»¤)",slug:"_2-2-shell-è¿æ¥-mongoå½ä»¤",normalizedTitle:"2.2 shell è¿æ¥(mongoå½ä»¤)",charIndex:6015},{level:3,title:"2.2.1 æ¥çå·²ç»æçæ°æ®åº",slug:"_2-2-1-æ¥çå·²ç»æçæ°æ®åº",normalizedTitle:"2.2.1 æ¥çå·²ç»æçæ°æ®åº",charIndex:6120},{level:3,title:"2.2.2 éåº mongodb",slug:"_2-2-2-éåº-mongodb",normalizedTitle:"2.2.2 éåº mongodb",charIndex:6161},{level:2,title:"2.3 Compass- å¾å½¢åçé¢å®¢æ·ç«¯",slug:"_2-3-compass-å¾å½¢åçé¢å®¢æ·ç«¯",normalizedTitle:"2.3 compass- å¾å½¢åçé¢å®¢æ·ç«¯",charIndex:6288},{level:2,title:"2.4 Linux ç³»ç»ä¸­çå®è£å¯å¨åè¿æ¥",slug:"_2-4-linux-ç³»ç»ä¸­çå®è£å¯å¨åè¿æ¥",normalizedTitle:"2.4 linux ç³»ç»ä¸­çå®è£å¯å¨åè¿æ¥",charIndex:6515},{level:2,title:"3.1 æ¡ä¾éæ±",slug:"_3-1-æ¡ä¾éæ±",normalizedTitle:"3.1 æ¡ä¾éæ±",charIndex:9319},{level:2,title:"3.2 æ°æ®åºæä½",slug:"_3-2-æ°æ®åºæä½",normalizedTitle:"3.2 æ°æ®åºæä½",charIndex:9969},{level:3,title:"3.2.1 éæ©ååå»ºæ°æ®åº",slug:"_3-2-1-éæ©ååå»ºæ°æ®åº",normalizedTitle:"3.2.1 éæ©ååå»ºæ°æ®åº",charIndex:9983},{level:3,title:"3.2.2 æ°æ®åºçå é¤",slug:"_3-2-2-æ°æ®åºçå é¤",normalizedTitle:"3.2.2 æ°æ®åºçå é¤",charIndex:10639},{level:2,title:"3.3 éåæä½",slug:"_3-3-éåæä½",normalizedTitle:"3.3 éåæä½",charIndex:10723},{level:3,title:"3.3.1 éåçæ¾å¼åå»º",slug:"_3-3-1-éåçæ¾å¼åå»º",normalizedTitle:"3.3.1 éåçæ¾å¼åå»º",charIndex:10772},{level:3,title:"3.3.2 éåçéå¼åå»º",slug:"_3-3-2-éåçéå¼åå»º",normalizedTitle:"3.3.2 éåçéå¼åå»º",charIndex:11187},{level:3,title:"3.3.3 éåçå é¤",slug:"_3-3-3-éåçå é¤",normalizedTitle:"3.3.3 éåçå é¤",charIndex:11275},{level:2,title:"3.4 ææ¡£åºæ¬CRUD",slug:"_3-4-ææ¡£åºæ¬crud",normalizedTitle:"3.4 ææ¡£åºæ¬crud",charIndex:11449},{level:3,title:"3.4.1 ææ¡£çæå¥",slug:"_3-4-1-ææ¡£çæå¥",normalizedTitle:"3.4.1 ææ¡£çæå¥",charIndex:11521},{level:4,title:"3.4.1.1 åä¸ªææ¡£æå¥",slug:"_3-4-1-1-åä¸ªææ¡£æå¥",normalizedTitle:"3.4.1.1 åä¸ªææ¡£æå¥",charIndex:11536},{level:4,title:"3.4.1.2 æ¹éæå¥",slug:"_3-4-1-2-æ¹éæå¥",normalizedTitle:"3.4.1.2 æ¹éæå¥",charIndex:13147},{level:3,title:"3.4.2 ææ¡£çåºæ¬æ¥è¯¢",slug:"_3-4-2-ææ¡£çåºæ¬æ¥è¯¢",normalizedTitle:"3.4.2 ææ¡£çåºæ¬æ¥è¯¢",charIndex:15612},{level:4,title:"3.4.2.1 æ¥è¯¢ææ",slug:"_3-4-2-1-æ¥è¯¢ææ",normalizedTitle:"3.4.2.1 æ¥è¯¢ææ",charIndex:15890},{level:4,title:"3.4.2.2 æå½±æ¥è¯¢ï¼PROJECTION QUERYï¼",slug:"_3-4-2-2-æå½±æ¥è¯¢-projection-query",normalizedTitle:"3.4.2.2 æå½±æ¥è¯¢ï¼projection queryï¼",charIndex:16381},{level:3,title:"3.4.3 ææ¡£çæ´æ°",slug:"_3-4-3-ææ¡£çæ´æ°",normalizedTitle:"3.4.3 ææ¡£çæ´æ°",charIndex:16763},{level:4,title:"3.4.3.1 è¦ççä¿®æ¹",slug:"_3-4-3-1-è¦ççä¿®æ¹",normalizedTitle:"3.4.3.1 è¦ççä¿®æ¹",charIndex:17511},{level:4,title:"3.4.3.2 å±é¨ä¿®æ¹",slug:"_3-4-3-2-å±é¨ä¿®æ¹",normalizedTitle:"3.4.3.2 å±é¨ä¿®æ¹",charIndex:17660},{level:4,title:"3.4.3.3 æ¹éçä¿®æ¹",slug:"_3-4-3-3-æ¹éçä¿®æ¹",normalizedTitle:"3.4.3.3 æ¹éçä¿®æ¹",charIndex:17807},{level:4,title:"3.4.3.4 åå¼å¢é¿çä¿®æ¹",slug:"_3-4-3-4-åå¼å¢é¿çä¿®æ¹",normalizedTitle:"3.4.3.4 åå¼å¢é¿çä¿®æ¹",charIndex:18053},{level:3,title:"3.4.4 å é¤ææ¡£",slug:"_3-4-4-å é¤ææ¡£",normalizedTitle:"3.4.4 å é¤ææ¡£",charIndex:18204},{level:2,title:"3.5 ææ¡£çåé¡µæ¥è¯¢",slug:"_3-5-ææ¡£çåé¡µæ¥è¯¢",normalizedTitle:"3.5 ææ¡£çåé¡µæ¥è¯¢",charIndex:18360},{level:3,title:"3.5.1 ç»è®¡æ¥è¯¢",slug:"_3-5-1-ç»è®¡æ¥è¯¢",normalizedTitle:"3.5.1 ç»è®¡æ¥è¯¢",charIndex:18376},{level:4,title:"3.5.1.1 ç»è®¡ææè®°å½æ°",slug:"_3-5-1-1-ç»è®¡ææè®°å½æ°",normalizedTitle:"3.5.1.1 ç»è®¡ææè®°å½æ°",charIndex:18570},{level:4,title:"3.5.1.2 ææ¡ä»¶ç»è®¡è®°å½æ°",slug:"_3-5-1-2-ææ¡ä»¶ç»è®¡è®°å½æ°",normalizedTitle:"3.5.1.2 ææ¡ä»¶ç»è®¡è®°å½æ°",charIndex:18635},{level:3,title:"3.5.2 åé¡µåè¡¨æ¥è¯¢",slug:"_3-5-2-åé¡µåè¡¨æ¥è¯¢",normalizedTitle:"3.5.2 åé¡µåè¡¨æ¥è¯¢",charIndex:18756},{level:3,title:"3.5.3 æåºæ¥è¯¢",slug:"_3-5-3-æåºæ¥è¯¢",normalizedTitle:"3.5.3 æåºæ¥è¯¢",charIndex:19230},{level:2,title:"3.6 ææ¡£çæ´å¤æ¥è¯¢",slug:"_3-6-ææ¡£çæ´å¤æ¥è¯¢",normalizedTitle:"3.6 ææ¡£çæ´å¤æ¥è¯¢",charIndex:19594},{level:3,title:"3.6.1 æ­£åçå¤ææ¡ä»¶æ¥è¯¢",slug:"_3-6-1-æ­£åçå¤ææ¡ä»¶æ¥è¯¢",normalizedTitle:"3.6.1 æ­£åçå¤ææ¡ä»¶æ¥è¯¢",charIndex:19610},{level:3,title:"3.6.2 æ¯è¾æ¥è¯¢",slug:"_3-6-2-æ¯è¾æ¥è¯¢",normalizedTitle:"3.6.2 æ¯è¾æ¥è¯¢",charIndex:19896},{level:3,title:"3.6.3 åå«æ¥è¯¢",slug:"_3-6-3-åå«æ¥è¯¢",normalizedTitle:"3.6.3 åå«æ¥è¯¢",charIndex:20358},{level:3,title:"3.6.4 æ¡ä»¶è¿æ¥æ¥è¯¢",slug:"_3-6-4-æ¡ä»¶è¿æ¥æ¥è¯¢",normalizedTitle:"3.6.4 æ¡ä»¶è¿æ¥æ¥è¯¢",charIndex:20579},{level:2,title:"3.7 å¸¸ç¨å½ä»¤å°ç»",slug:"_3-7-å¸¸ç¨å½ä»¤å°ç»",normalizedTitle:"3.7 å¸¸ç¨å½ä»¤å°ç»",charIndex:21009},{level:2,title:"4.1 æ¦è¿°",slug:"_4-1-æ¦è¿°",normalizedTitle:"4.1 æ¦è¿°",charIndex:21748},{level:2,title:"4.2 ç´¢å¼çç±»å",slug:"_4-2-ç´¢å¼çç±»å",normalizedTitle:"4.2 ç´¢å¼çç±»å",charIndex:22141},{level:3,title:"4.2.1 åå­æ®µç´¢å¼",slug:"_4-2-1-åå­æ®µç´¢å¼",normalizedTitle:"4.2.1 åå­æ®µç´¢å¼",charIndex:22155},{level:3,title:"4.2.2 å¤åç´¢å¼",slug:"_4-2-2-å¤åç´¢å¼",normalizedTitle:"4.2.2 å¤åç´¢å¼",charIndex:22295},{level:3,title:"4.2.3 å¶ä»ç´¢å¼",slug:"_4-2-3-å¶ä»ç´¢å¼",normalizedTitle:"4.2.3 å¶ä»ç´¢å¼",charIndex:22463},{level:2,title:"4.3 ç´¢å¼çç®¡çæä½",slug:"_4-3-ç´¢å¼çç®¡çæä½",normalizedTitle:"4.3 ç´¢å¼çç®¡çæä½",charIndex:22887},{level:3,title:"4.3.1 ç´¢å¼çæ¥ç",slug:"_4-3-1-ç´¢å¼çæ¥ç",normalizedTitle:"4.3.1 ç´¢å¼çæ¥ç",charIndex:22903},{level:3,title:"4.3.2 ç´¢å¼çåå»º",slug:"_4-3-2-ç´¢å¼çåå»º",normalizedTitle:"4.3.2 ç´¢å¼çåå»º",charIndex:23400},{level:4,title:"4.3.2.1 åå­æ®µç´¢å¼",slug:"_4-3-2-1-åå­æ®µç´¢å¼",normalizedTitle:"4.3.2.1 åå­æ®µç´¢å¼",charIndex:24965},{level:4,title:"4.3.2.2 å¤åç´¢å¼",slug:"_4-3-2-2-å¤åç´¢å¼",normalizedTitle:"4.3.2.2 å¤åç´¢å¼",charIndex:25072},{level:3,title:"4.3.3 ç´¢å¼çç§»é¤",slug:"_4-3-3-ç´¢å¼çç§»é¤",normalizedTitle:"4.3.3 ç´¢å¼çç§»é¤",charIndex:25197},{level:4,title:"4.3.3.1 æå®ç´¢å¼çç§»é¤",slug:"_4-3-3-1-æå®ç´¢å¼çç§»é¤",normalizedTitle:"4.3.3.1 æå®ç´¢å¼çç§»é¤",charIndex:25234},{level:4,title:"4.3.3.2 ææç´¢å¼çç§»é¤",slug:"_4-3-3-2-ææç´¢å¼çç§»é¤",normalizedTitle:"4.3.3.2 ææç´¢å¼çç§»é¤",charIndex:25505},{level:2,title:"4.4 ç´¢å¼çä½¿ç¨",slug:"_4-4-ç´¢å¼çä½¿ç¨",normalizedTitle:"4.4 ç´¢å¼çä½¿ç¨",charIndex:25661},{level:3,title:"4.4.1 æ§è¡è®¡å",slug:"_4-4-1-æ§è¡è®¡å",normalizedTitle:"4.4.1 æ§è¡è®¡å",charIndex:25675},{level:3,title:"4.4.2 æ¶µççæ¥è¯¢",slug:"_4-4-2-æ¶µççæ¥è¯¢",normalizedTitle:"4.4.2 æ¶µççæ¥è¯¢",charIndex:28277},{level:2,title:"5.1 éæ±åæ",slug:"_5-1-éæ±åæ",normalizedTitle:"5.1 éæ±åæ",charIndex:30143},{level:2,title:"5.2 è¡¨ç»æåæ",slug:"_5-2-è¡¨ç»æåæ",normalizedTitle:"5.2 è¡¨ç»æåæ",charIndex:30288},{level:2,title:"5.3 ææ¯éå",slug:"_5-3-ææ¯éå",normalizedTitle:"5.3 ææ¯éå",charIndex:30907},{level:3,title:"5.3.1 mongodb-driver",slug:"_5-3-1-mongodb-driver",normalizedTitle:"5.3.1 mongodb-driver",charIndex:30920},{level:3,title:"5.3.2 SpringDataMongoDB",slug:"_5-3-2-springdatamongodb",normalizedTitle:"5.3.2 springdatamongodb",charIndex:31183},{level:2,title:"5.4 æç« å¾®æå¡æ¨¡åæ­å»º",slug:"_5-4-æç« å¾®æå¡æ¨¡åæ­å»º",normalizedTitle:"5.4 æç« å¾®æå¡æ¨¡åæ­å»º",charIndex:31362},{level:2,title:"5.5 æç« è¯è®ºå®ä½ç±»çç¼å",slug:"_5-5-æç« è¯è®ºå®ä½ç±»çç¼å",normalizedTitle:"5.5 æç« è¯è®ºå®ä½ç±»çç¼å",charIndex:33252},{level:2,title:"5.6 æç« è¯è®ºçåºæ¬å¢å æ¹æ¥",slug:"_5-6-æç« è¯è®ºçåºæ¬å¢å æ¹æ¥",normalizedTitle:"5.6 æç« è¯è®ºçåºæ¬å¢å æ¹æ¥",charIndex:34817},{level:2,title:"5.7 æ ¹æ®ä¸çº§IDæ¥è¯¢æç« è¯è®ºçåé¡µåè¡¨",slug:"_5-7-æ ¹æ®ä¸çº§idæ¥è¯¢æç« è¯è®ºçåé¡µåè¡¨",normalizedTitle:"5.7 æ ¹æ®ä¸çº§idæ¥è¯¢æç« è¯è®ºçåé¡µåè¡¨",charIndex:37557},{level:2,title:"5.8 MongoTemplate å®ç°è¯è®ºç¹èµ",slug:"_5-8-mongotemplate-å®ç°è¯è®ºç¹èµ",normalizedTitle:"5.8 mongotemplate å®ç°è¯è®ºç¹èµ",charIndex:38705}],headersStr:"1.1 ä¸å¡åºç¨åºæ¯ 1.2 MongoDB ç®ä» 1.3 ä½ç³»ç»æ 1.4 æ°æ®æ¨¡å 1.5 MongoDB çç¹ç¹ 2.1 Windows ç³»ç»ä¸­çå®è£å¯å¨ 2.1.1 ä¸è½½å®è£å 2.1.2 è§£åå®è£å¯å¨ 2.2 Shell è¿æ¥(mongoå½ä»¤) 2.2.1 æ¥çå·²ç»æçæ°æ®åº 2.2.2 éåº mongodb 2.3 Compass- å¾å½¢åçé¢å®¢æ·ç«¯ 2.4 Linux ç³»ç»ä¸­çå®è£å¯å¨åè¿æ¥ 3.1 æ¡ä¾éæ± 3.2 æ°æ®åºæä½ 3.2.1 éæ©ååå»ºæ°æ®åº 3.2.2 æ°æ®åºçå é¤ 3.3 éåæä½ 3.3.1 éåçæ¾å¼åå»º 3.3.2 éåçéå¼åå»º 3.3.3 éåçå é¤ 3.4 ææ¡£åºæ¬CRUD 3.4.1 ææ¡£çæå¥ 3.4.1.1 åä¸ªææ¡£æå¥ 3.4.1.2 æ¹éæå¥ 3.4.2 ææ¡£çåºæ¬æ¥è¯¢ 3.4.2.1 æ¥è¯¢ææ 3.4.2.2 æå½±æ¥è¯¢ï¼PROJECTION QUERYï¼ 3.4.3 ææ¡£çæ´æ° 3.4.3.1 è¦ççä¿®æ¹ 3.4.3.2 å±é¨ä¿®æ¹ 3.4.3.3 æ¹éçä¿®æ¹ 3.4.3.4 åå¼å¢é¿çä¿®æ¹ 3.4.4 å é¤ææ¡£ 3.5 ææ¡£çåé¡µæ¥è¯¢ 3.5.1 ç»è®¡æ¥è¯¢ 3.5.1.1 ç»è®¡ææè®°å½æ° 3.5.1.2 ææ¡ä»¶ç»è®¡è®°å½æ° 3.5.2 åé¡µåè¡¨æ¥è¯¢ 3.5.3 æåºæ¥è¯¢ 3.6 ææ¡£çæ´å¤æ¥è¯¢ 3.6.1 æ­£åçå¤ææ¡ä»¶æ¥è¯¢ 3.6.2 æ¯è¾æ¥è¯¢ 3.6.3 åå«æ¥è¯¢ 3.6.4 æ¡ä»¶è¿æ¥æ¥è¯¢ 3.7 å¸¸ç¨å½ä»¤å°ç» 4.1 æ¦è¿° 4.2 ç´¢å¼çç±»å 4.2.1 åå­æ®µç´¢å¼ 4.2.2 å¤åç´¢å¼ 4.2.3 å¶ä»ç´¢å¼ 4.3 ç´¢å¼çç®¡çæä½ 4.3.1 ç´¢å¼çæ¥ç 4.3.2 ç´¢å¼çåå»º 4.3.2.1 åå­æ®µç´¢å¼ 4.3.2.2 å¤åç´¢å¼ 4.3.3 ç´¢å¼çç§»é¤ 4.3.3.1 æå®ç´¢å¼çç§»é¤ 4.3.3.2 ææç´¢å¼çç§»é¤ 4.4 ç´¢å¼çä½¿ç¨ 4.4.1 æ§è¡è®¡å 4.4.2 æ¶µççæ¥è¯¢ 5.1 éæ±åæ 5.2 è¡¨ç»æåæ 5.3 ææ¯éå 5.3.1 mongodb-driver 5.3.2 SpringDataMongoDB 5.4 æç« å¾®æå¡æ¨¡åæ­å»º 5.5 æç« è¯è®ºå®ä½ç±»çç¼å 5.6 æç« è¯è®ºçåºæ¬å¢å æ¹æ¥ 5.7 æ ¹æ®ä¸çº§IDæ¥è¯¢æç« è¯è®ºçåé¡µåè¡¨ 5.8 MongoTemplate å®ç°è¯è®ºç¹èµ",content:'# 1. MongoDB ç¸å³æ¦å¿µ\n\n\n# 1.1 ä¸å¡åºç¨åºæ¯\n\nä¼ ç»çå³ç³»åæ°æ®åºï¼å¦MySQLï¼ï¼å¨æ°æ®æä½çâä¸é«âéæ±ä»¥ååºå¯¹Web2.0çç½ç«éæ±é¢åï¼æ¾å¾åä¸ä»å¿ã\n\nè§£éï¼âä¸é«âéæ±ï¼\n\n * High performance - å¯¹æ°æ®åºé«å¹¶åè¯»åçéæ±ã\n * Huge Storage - å¯¹æµ·éæ°æ®çé«æçå­å¨åè®¿é®çéæ±ã\n * High Scalability && High Availability- å¯¹æ°æ®åºçé«å¯æ©å±æ§åé«å¯ç¨æ§çéæ±ã\n\nèMongoDBå¯åºå¯¹âä¸é«âéæ±ã\n\nå·ä½çåºç¨åºæ¯å¦ï¼\n\n * ç¤¾äº¤åºæ¯ï¼ä½¿ç¨ MongoDB å­å¨å­å¨ç¨æ·ä¿¡æ¯ï¼ä»¥åç¨æ·åè¡¨çæååä¿¡æ¯ï¼éè¿å°çä½ç½®ç´¢å¼å®ç°éè¿çäººãå°ç¹ç­åè½ã\n * æ¸¸æåºæ¯ï¼ä½¿ç¨ MongoDB å­å¨æ¸¸æç¨æ·ä¿¡æ¯ï¼ç¨æ·çè£å¤ãç§¯åç­ç´æ¥ä»¥ååµææ¡£çå½¢å¼å­å¨ï¼æ¹ä¾¿æ¥è¯¢ãé«æçå­å¨åè®¿é®ã\n * ç©æµåºæ¯ï¼ä½¿ç¨ MongoDB å­å¨è®¢åä¿¡æ¯ï¼è®¢åç¶æå¨è¿éè¿ç¨ä¸­ä¼ä¸æ­æ´æ°ï¼ä»¥ MongoDB ååµæ°ç»çå½¢å¼æ¥å­å¨ï¼ä¸æ¬¡æ¥è¯¢å°±è½å°è®¢åææçåæ´è¯»ååºæ¥ã\n * ç©èç½åºæ¯ï¼ä½¿ç¨ MongoDB å­å¨æææ¥å¥çæºè½è®¾å¤ä¿¡æ¯ï¼ä»¥åè®¾å¤æ±æ¥çæ¥å¿ä¿¡æ¯ï¼å¹¶å¯¹è¿äºä¿¡æ¯è¿è¡å¤ç»´åº¦çåæã\n * è§é¢ç´æ­ï¼ä½¿ç¨ MongoDB å­å¨ç¨æ·ä¿¡æ¯ãç¹èµäºå¨ä¿¡æ¯ç­ã\n\nè¿äºåºç¨åºæ¯ä¸­ï¼æ°æ®æä½æ¹é¢çå±åç¹ç¹æ¯ï¼\n\n * æ°æ®éå¤§\n * åå¥æä½é¢ç¹ï¼è¯»åé½å¾é¢ç¹ï¼\n * ä»·å¼è¾ä½çæ°æ®ï¼å¯¹äºå¡æ§è¦æ±ä¸é«\n\nå¯¹äºè¿æ ·çæ°æ®ï¼æä»¬æ´éåä½¿ç¨MongoDBæ¥å®ç°æ°æ®çå­å¨ã\n\nä»ä¹æ¶åéæ©MongoDB\n\nå¨æ¶æéåä¸ï¼é¤äºä¸è¿°çä¸ä¸ªç¹ç¹å¤ï¼å¦æä½ è¿ç¹è±«æ¯å¦è¦éæ©å®ï¼å¯ä»¥èèä»¥ä¸çä¸äºé®é¢ï¼\n\n * åºç¨ä¸éè¦äºå¡åå¤æ join æ¯æ\n * æ°åºç¨ï¼éæ±ä¼åï¼æ°æ®æ¨¡åæ æ³ç¡®å®ï¼æ³å¿«éè¿­ä»£å¼å\n * åºç¨éè¦2000-3000ä»¥ä¸çè¯»åQPSï¼æ´é«ä¹å¯ä»¥ï¼\n * åºç¨éè¦TBçè³ PB çº§å«æ°æ®å­å¨\n * åºç¨åå±è¿éï¼éè¦è½å¿«éæ°´å¹³æ©å±\n * åºç¨è¦æ±å­å¨çæ°æ®ä¸ä¸¢å¤±\n * åºç¨éè¦99.999%é«å¯ç¨\n * åºç¨éè¦å¤§éçå°çä½ç½®æ¥è¯¢ãææ¬æ¥è¯¢\n\nå¦æä¸è¿°æ1ä¸ªç¬¦åï¼å¯ä»¥èè MongoDBï¼2ä¸ªåä»¥ä¸çç¬¦åï¼éæ© MongoDB ç»ä¸ä¼åæã\n\n\n# 1.2 MongoDB ç®ä»\n\nMongoDBæ¯ä¸ä¸ªå¼æºãé«æ§è½ãæ æ¨¡å¼çææ¡£åæ°æ®åºï¼å½åçè®¾è®¡å°±æ¯ç¨äºç®åå¼ååæ¹ä¾¿æ©å±ï¼æ¯NoSQLæ°æ®åºäº§åä¸­çä¸ç§ãæ¯æåå³ç³»åæ°æ®åºï¼MySQLï¼çéå³ç³»åæ°æ®åºã\n\nå®æ¯æçæ°æ®ç»æéå¸¸æ¾æ£ï¼æ¯ä¸ç§ç±»ä¼¼äº JSON ç æ ¼å¼å«BSONï¼æä»¥å®æ¢å¯ä»¥å­å¨æ¯è¾å¤æçæ°æ®ç±»åï¼åç¸å½ççµæ´»ã\n\nMongoDBä¸­çè®°å½æ¯ä¸ä¸ªææ¡£ï¼å®æ¯ä¸ä¸ªç±å­æ®µåå¼å¯¹ï¼field:valueï¼ç»æçæ°æ®ç»æãMongoDBææ¡£ç±»ä¼¼äºJSONå¯¹è±¡ï¼å³ä¸ä¸ªææ¡£è®¤ä¸ºå°±æ¯ä¸ä¸ªå¯¹è±¡ãå­æ®µçæ°æ®ç±»åæ¯å­ç¬¦åï¼å®çå¼é¤äºä½¿ç¨åºæ¬çä¸äºç±»åå¤ï¼è¿å¯ä»¥åæ¬å¶ä»ææ¡£ãæ®éæ°ç»åææ¡£æ°ç»ã\n\n\n# 1.3 ä½ç³»ç»æ\n\nMySQLåMongoDBå¯¹æ¯\n\n\n\nSQL æ¯è¯­/æ¦å¿µ     MONGODBæ¯è¯­/æ¦å¿µ   è§£é/è¯´æ\ndatabase      database       æ°æ®åº\ntable         collection     æ°æ®åºè¡¨/éå\nrow           document       æ°æ®è®°å½è¡/ææ¡£\ncolumn        field          æ°æ®å­æ®µ/å\nindex         index          ç´¢å¼\ntable joins                  è¡¨è¿æ¥,MongoDBä¸æ¯æ\n              åµå¥ææ¡£           MongoDBéè¿åµå¥å¼ææ¡£æ¥æ¿ä»£å¤è¡¨è¿æ¥\nprimary key   primary key    ä¸»é®,MongoDBèªå¨å°_idå­æ®µè®¾ç½®ä¸ºä¸»é®\n\n\n# 1.4 æ°æ®æ¨¡å\n\nMongoDBçæå°å­å¨åä½å°±æ¯ææ¡£(document)å¯¹è±¡ãææ¡£(document)å¯¹è±¡å¯¹åºäºå³ç³»åæ°æ®åºçè¡ãæ°æ®å¨MongoDBä¸­ä»¥BSONï¼Binary-JSONï¼ææ¡£çæ ¼å¼å­å¨å¨ç£çä¸ã\n\nBSONï¼Binary Serialized Document Formatï¼æ¯ä¸ç§ç±»jsonçä¸ç§äºè¿å¶å½¢å¼çå­å¨æ ¼å¼ï¼ç®ç§°Binary JSONãBSONåJSONä¸æ ·ï¼æ¯æååµçææ¡£å¯¹è±¡åæ°ç»å¯¹è±¡ï¼ä½æ¯BSONæJSONæ²¡æçä¸äºæ°æ®ç±»åï¼å¦DateåBinDataç±»åã\n\nBSONéç¨äºç±»ä¼¼äº C è¯­è¨ç»æä½çåç§°ãå¯¹è¡¨ç¤ºæ¹æ³ï¼æ¯æååµçææ¡£å¯¹è±¡åæ°ç»å¯¹è±¡ï¼å·æè½»éæ§ãå¯éåæ§ãé«ææ§çä¸ä¸ªç¹ç¹ï¼å¯ä»¥æææè¿°éç»æåæ°æ®åç»æåæ°æ®ãè¿ç§æ ¼å¼çä¼ç¹æ¯çµæ´»æ§é«ï¼ä½å®çç¼ºç¹æ¯ç©ºé´å©ç¨çä¸æ¯å¾çæ³ã\n\nBsonä¸­ï¼é¤äºåºæ¬çJSONç±»åï¼string,integer,boolean,double,null,arrayåobjectï¼mongoè¿ä½¿ç¨äºç¹æ®çæ°æ®ç±»åãè¿äºç±»ååæ¬date,object id,binary data,regular expression åcodeãæ¯ä¸ä¸ªé©±å¨é½ä»¥ç¹å®è¯­è¨çæ¹å¼å®ç°äºè¿äºç±»åï¼æ¥çä½ çé©±å¨çææ¡£æ¥è·åè¯¦ç»ä¿¡æ¯ã\n\nBSONæ°æ®ç±»ååèåè¡¨ï¼\n\næ°æ®ç±»å        æè¿°                                         ä¸¾ä¾\nå­ç¬¦ä¸²         UTF-8å­ç¬¦ä¸²é½å¯è¡¨ç¤ºä¸ºå­ç¬¦ä¸²ç±»åçæ°æ®                      {âxâ : âfoobarâ}\nå¯¹è±¡id        å¯¹è±¡idæ¯ææ¡£ç12å­èçå¯ä¸ ID                         {âXâ :ObjectId() }\nå¸å°å¼         çæèåï¼trueæèfalse                           {âxâ:true}\næ°ç»          å¼çéåæèåè¡¨å¯ä»¥è¡¨ç¤ºææ°ç»                            {âxâ ï¼ [âaâ, âbâ, âcâ]}\n32ä½æ´æ°       ç±»åä¸å¯ç¨ãJavaScriptä»æ¯æ64ä½æµ®ç¹æ°ï¼æä»¥32ä½æ´æ°ä¼è¢«èªå¨è½¬æ¢ã   shellæ¯ä¸æ¯æè¯¥ç±»åçï¼shellä¸­é»è®¤ä¼è½¬æ¢æ64ä½æµ®ç¹æ°\n64ä½æ´æ°       ä¸æ¯æè¿ä¸ªç±»åãshellä¼ä½¿ç¨ä¸ä¸ªç¹æ®çååµææ¡£æ¥æ¾ç¤º64ä½æ´æ°          shellæ¯ä¸æ¯æè¯¥ç±»åçï¼shellä¸­é»è®¤ä¼è½¬æ¢æ64ä½æµ®ç¹æ°\n64ä½æµ®ç¹æ°      shellä¸­çæ°å­å°±æ¯è¿ä¸ç§ç±»å                           {âxâï¼3.14159ï¼âyâï¼3}\nnull        è¡¨ç¤ºç©ºå¼æèæªå®ä¹çå¯¹è±¡                               {âxâ:null}\nundefined   ææ¡£ä¸­ä¹å¯ä»¥ä½¿ç¨æªå®ä¹ç±»å                              {âxâ:undefined}\nç¬¦å·          shellä¸æ¯æï¼shellä¼å°æ°æ®åºä¸­çç¬¦å·ç±»åçæ°æ®èªå¨è½¬æ¢æå­ç¬¦ä¸²       \næ­£åè¡¨è¾¾å¼       ææ¡£ä¸­å¯ä»¥åå«æ­£åè¡¨è¾¾å¼ï¼éç¨JavaScriptçæ­£åè¡¨è¾¾å¼è¯­æ³          {âxâ ï¼ /foobar/i}\nä»£ç           ææ¡£ä¸­è¿å¯ä»¥åå«JavaScriptä»£ç                        {âxâ ï¼ function() { /* â¦â¦ */ }}\näºè¿å¶æ°æ®       äºè¿å¶æ°æ®å¯ä»¥ç±ä»»æå­èçä¸²ç»æï¼ä¸è¿shellä¸­æ æ³ä½¿ç¨              \næå¤§å¼/æå°å¼     BSONåæ¬ä¸ä¸ªç¹æ®ç±»åï¼è¡¨ç¤ºå¯è½çæå¤§å¼ãshellä¸­æ²¡æè¿ä¸ªç±»åã        \n\næç¤ºï¼\n\nshellé»è®¤ä½¿ç¨64ä½æµ®ç¹åæ°å¼ã{âxâï¼3.14}æ{âxâï¼3}ãå¯¹äºæ´åå¼ï¼å¯ä»¥ä½¿ç¨NumberIntï¼4å­èç¬¦å·æ´æ°ï¼æNumberLongï¼8å­èç¬¦å·æ´æ°ï¼ï¼{âxâ:NumberInt(â3â)}{âxâ:NumberLong(â3â)}\n\n\n# 1.5 MongoDB çç¹ç¹\n\nMongoDBä¸»è¦æå¦ä¸ç¹ç¹ï¼\n\n * é«æ§è½ï¼\n   \n   MongoDBæä¾é«æ§è½çæ°æ®æä¹æ§ãç¹å«æ¯\n   \n   å¯¹åµå¥å¼æ°æ®æ¨¡åçæ¯æåå°äºæ°æ®åºç³»ç»ä¸çI/Oæ´»å¨ã\n   \n   ç´¢å¼æ¯ææ´å¿«çæ¥è¯¢ï¼å¹¶ä¸å¯ä»¥åå«æ¥èªåµå¥å¼ææ¡£åæ°ç»çé®ãï¼ææ¬ç´¢å¼è§£å³æç´¢çéæ±ãTTLç´¢å¼è§£å³åå²æ°æ®èªå¨è¿æçéæ±ãå°çä½ç½®ç´¢å¼å¯ç¨äºæå»ºåç§ O2O åºç¨ï¼\n   \n   mmapv1ãwiredtigerãmongorocksï¼rocksdbï¼ãin-memory ç­å¤å¼ææ¯ææ»¡è¶³åç§åºæ¯éæ±ã\n   \n   Gridfsè§£å³æä»¶å­å¨çéæ±ã\n\n * é«å¯ç¨æ§ï¼\n   \n   MongoDBçå¤å¶å·¥å·ç§°ä¸ºå¯æ¬éï¼replica setï¼ï¼å®å¯æä¾èªå¨æéè½¬ç§»åæ°æ®åä½ã\n\n * é«æ©å±æ§ï¼\n   \n   MongoDBæä¾äºæ°´å¹³å¯æ©å±æ§ä½ä¸ºå¶æ ¸å¿åè½çä¸é¨åã\n   \n   åçå°æ°æ®åå¸å¨ä¸ç»éç¾¤çæºå¨ä¸ãï¼æµ·éæ°æ®å­å¨ï¼æå¡è½åæ°´å¹³æ©å±ï¼\n   \n   ä»3.4å¼å§ï¼MongoDBæ¯æåºäºçé®åå»ºæ°æ®åºåãå¨ä¸ä¸ªå¹³è¡¡çéç¾¤ä¸­ï¼MongoDBå°ä¸ä¸ªåºåæè¦ççè¯»ååªå®åå°è¯¥åºååçé£äºçã\n\n * ä¸°å¯çæ¥è¯¢æ¯æï¼\n   \n   MongoDBæ¯æä¸°å¯çæ¥è¯¢è¯­è¨ï¼æ¯æè¯»ååæä½(CRUD)ï¼æ¯å¦æ°æ®èåãææ¬æç´¢åå°çç©ºé´æ¥è¯¢ç­ã\n\n * å¶ä»ç¹ç¹ï¼å¦æ æ¨¡å¼ï¼å¨ææ¨¡å¼ï¼ãçµæ´»çææ¡£æ¨¡åã\n\n\n# 2. åæºé¨ç½²\n\n\n# 2.1 Windows ç³»ç»ä¸­çå®è£å¯å¨\n\n\n# 2.1.1 ä¸è½½å®è£å\n\nMongoDB æä¾äºå¯ç¨äº 32 ä½å 64 ä½ç³»ç»çé¢ç¼è¯äºè¿å¶åï¼ä½ å¯ä»¥ä»MongoDBå®ç½ä¸è½½å®è£ï¼MongoDB é¢ç¼è¯äºè¿å¶åä¸å°åï¼https://www.mongodb.com/download-center#community\n\n\n\næ ¹æ®ä¸å¾æç¤ºä¸è½½ zip åã\n\næç¤ºï¼çæ¬çéæ©ï¼\n\nMongoDBççæ¬å½åè§èå¦ï¼x.y.zï¼\n\nyä¸ºå¥æ°æ¶è¡¨ç¤ºå½åçæ¬ä¸ºå¼åçï¼å¦ï¼1.5.2ã4.1.13ï¼\n\nyä¸ºå¶æ°æ¶è¡¨ç¤ºå½åçæ¬ä¸ºç¨³å®çï¼å¦ï¼1.6.3ã4.0.10ï¼\n\nzæ¯ä¿®æ­£çæ¬å·ï¼æ°å­è¶å¤§è¶å¥½ã\n\nè¯¦æï¼ http://docs.mongodb.org/manual/release-notes/#release-version-numbers\n\n\n# 2.1.2 è§£åå®è£å¯å¨\n\nå°åç¼©åè§£åå°ä¸ä¸ªç®å½ä¸­ãå¨è§£åç®å½ä¸­ï¼æå¨å»ºç«ä¸ä¸ªç®å½ç¨äºå­æ¾æ°æ®æä»¶ï¼å¦ data/db\n\næ¹å¼1ï¼å½ä»¤è¡åæ°æ¹å¼å¯å¨æå¡\n\nå¨ bin ç®å½ä¸­æå¼å½ä»¤è¡æç¤ºç¬¦ï¼è¾å¥å¦ä¸å½ä»¤ï¼\n\nmongod --dbpath=..\\data\\db\n\n\n1\n\n\næä»¬å¨å¯å¨ä¿¡æ¯ä¸­å¯ä»¥çå°ï¼ mongoDBçé»è®¤ç«¯å£æ¯27017ï¼å¦ææä»¬æ³æ¹åé»è®¤çå¯å¨ç«¯å£ï¼å¯ä»¥éè¿âportæ¥æå®ç«¯å£ã\n\nä¸ºäºæ¹ä¾¿æä»¬æ¯æ¬¡å¯å¨ï¼å¯ä»¥å°å®è£ç®å½çbinç®å½è®¾ç½®å°ç¯å¢åéçpathä¸­ï¼ bin ç®å½ä¸æ¯ä¸äºå¸¸ç¨å½ä»¤ï¼æ¯å¦ mongod å¯å¨æå¡ç¨çï¼mongo å®¢æ·ç«¯è¿æ¥æå¡ç¨çã\n\næ¹å¼2ï¼éç½®æä»¶æ¹å¼å¯å¨æå¡\n\nå¨è§£åç®å½ä¸­æ°å»º config æä»¶å¤¹ï¼è¯¥æä»¶å¤¹ä¸­æ°å»ºéç½®æä»¶ mongod.conf ï¼åå¦åèå¦ä¸ï¼\n\nstorage:\n    #The directory where the mongod instance stores its data.Default Value is "\\data\\db" on Windows.\n    dbPath: D:\\mongodb-win32-x86_64-2008plus-ssl-4.0.1\\data\n\n\n1\n2\n3\n\n\nè¯¦ç»éç½®é¡¹åå®¹å¯ä»¥åèå®æ¹ææ¡£ï¼ https://docs.mongodb.com/manual/reference/configuration-options/\n\nãæ³¨æã\n\n * éç½®æä»¶ä¸­å¦æä½¿ç¨åå¼å·ï¼æ¯å¦è·¯å¾å°åï¼èªå¨ä¼å°åå¼å·çåå®¹è½¬ä¹ãå¦æä¸è½¬ä¹ï¼åä¼æ¥éï¼\n   \n   error-parsing-yaml-config-file-yaml-cpp-error-at-line-3-column-15-unknown-escape-character-d\n   \n   \n   1\n   \n   \n   è§£å³ï¼\n   \n   a. å¯¹ \\ æ¢æ / æ \\\n   \n   b. å¦æè·¯å¾ä¸­æ²¡æç©ºæ ¼ï¼åæ éå å¼å·ã\n\n * éç½®æä»¶ä¸­ä¸è½ä»¥Tabåå²å­æ®µ\n   \n   è§£å³ï¼\n   \n   å°å¶è½¬æ¢æç©ºæ ¼ã\n\nå¯å¨æ¹å¼ï¼\n\nmongod -f ../config/mongod.conf\næ\nmongod --config ../config/mongod.conf\n\n\n1\n2\n3\n\n\næ´å¤åæ°éç½®ï¼\n\nsystemLog:\n    destination: file\n    #The path of the log file to which mongod or mongos should send all diagnostic logging information\n    path: "D:/mongodb-win32-x86_64-2008plus-ssl-4.0.1/log/mongod.log"\n    logAppend: true\nstorage:\n    journal:\n      enabled: true\n    #The directory where the mongod instance stores its data.Default Value is "/data/db".\n    dbPath: "D:/mongodb-win32-x86_64-2008plus-ssl-4.0.1/data"\nnet:\n    #bindIp: 127.0.0.1\n    port: 27017\nsetParameter:\n    enableLocalhostAuthBypass: false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# 2.2 Shell è¿æ¥(mongoå½ä»¤)\n\nå¨å½ä»¤æç¤ºç¬¦è¾å¥ä»¥ä¸shellå½ä»¤å³å¯å®æç»é\n\nmongo\næ\nmongo --host=127.0.0.1 --port=27017\n\n\n1\n2\n3\n\n\n\n# 2.2.1 æ¥çå·²ç»æçæ°æ®åº\n\nshow databases\n\n\n1\n\n\n\n# 2.2.2 éåº mongodb\n\nexit\n\n\n1\n\n\næ´å¤åæ°å¯ä»¥éè¿å¸®å©æ¥çï¼\n\nmongo --help\n\n\n1\n\n\næç¤ºï¼\n\nMongoDB javascript shellæ¯ä¸ä¸ªåºäºjavascriptçè§£éå¨ï¼ææ¯æ¯æjsç¨åºçã\n\n\n# 2.3 Compass- å¾å½¢åçé¢å®¢æ·ç«¯\n\nå°MongoDBå®ç½ä¸è½½MongoDB Compassï¼å°åï¼ https://www.mongodb.com/download-center/v2/compass?initial=true\n\nå¦ææ¯ä¸è½½å®è£çï¼åæç§æ­¥éª¤å®è£ï¼å¦ææ¯ä¸è½½å åç¼©çï¼ç´æ¥è§£åï¼æ§è¡éé¢çMongoDBCompassCommunity.exe æä»¶å³å¯ã\n\nå¨æå¼ççé¢ä¸­ï¼è¾å¥ä¸»æºå°åãç«¯å£ç­ç¸å³ä¿¡æ¯ï¼ç¹å»è¿æ¥ï¼\n\n\n\n\n# 2.4 Linux ç³»ç»ä¸­çå®è£å¯å¨åè¿æ¥\n\nç®æ ï¼å¨Linuxä¸­é¨ç½²ä¸ä¸ªåæºçMongoDBï¼ä½ä¸ºçäº§ç¯å¢ä¸ä½¿ç¨ã\n\næç¤ºï¼åWindowsä¸æä½å·®ä¸å¤ã\n\næ­¥éª¤å¦ä¸ï¼\n\n * åå°å®ç½ä¸è½½åç¼©å mongod -linux-x86_64-4.0.10.tgz ã\n\n * ä¸ä¼ åç¼©åå°Linuxä¸­ï¼è§£åå°å½åç®å½ï¼\n   \n   tar -xvf mongodb-linux-x86_64-4.0.10.tgz\n   \n   \n   1\n   \n\n * ç§»å¨è§£ååçæä»¶å¤¹å°æå®çç®å½ä¸­ï¼\n   \n   mv mongodb-linux-x86_64-4.0.10 /usr/local/mongodb\n   \n   \n   1\n   \n\n * æ°å»ºå ä¸ªç®å½ï¼åå«ç¨æ¥å­å¨æ°æ®åæ¥å¿ï¼\n   \n   #æ°æ®å­å¨ç®å½\n   mkdir -p /mongodb/single/data/db\n   #æ¥å¿å­å¨ç®å½\n   mkdir -p /mongodb/single/log\n   \n   \n   1\n   2\n   3\n   4\n   \n\n * æ°å»ºå¹¶ä¿®æ¹éç½®æä»¶\n   \n   vi /mongodb/single/mongod.conf\n   \n   \n   1\n   \n   \n   éç½®æä»¶çåå®¹å¦ä¸ï¼\n   \n   systemLog:\n         #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n         # #The path of the log file to which mongod or mongos should send all diagnostic logging information\n         destination: file\n         #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n         path: "/mongodb/single/log/mongod.log"\n         #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n         logAppend: true\n   storage:\n         #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n         ##The directory where the mongod instance stores its data.Default Value is "/data/db".\n         dbPath: "/mongodb/single/data/db"\n         journal:\n             #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n             enabled: true\n   processManagement:\n         #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n         fork: true\n   net:\n         #æå¡å®ä¾ç»å®çIPï¼é»è®¤æ¯localhost\n         bindIp: localhost,192.168.142.128\n         #bindIp\n         #ç»å®çç«¯å£ï¼é»è®¤æ¯27017\n         port: 27017\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   18\n   19\n   20\n   21\n   22\n   23\n   24\n   \n\n * å¯å¨MongoDBæå¡\n   \n   /usr/local/mongodb/bin/mongod -f /mongodb/single/mongod.conf\n   \n   \n   1\n   \n   \n   æ³¨æï¼\n   \n   å¦æå¯å¨åä¸æ¯ successfully ï¼åæ¯å¯å¨å¤±è´¥äºãåå åºæ¬ä¸å°±æ¯éç½®æä»¶æé®é¢ã\n   \n   éè¿è¿ç¨æ¥æ¥çæå¡æ¯å¦å¯å¨äºï¼\n   \n   ps -ef |grep mongod\n   \n   \n   1\n   \n\n * åå«ä½¿ç¨mongoå½ä»¤åcompasså·¥å·æ¥è¿æ¥æµè¯ã\n   \n   æç¤ºï¼å¦æè¿ç¨è¿æ¥ä¸ä¸ï¼éè¦éç½®é²ç«å¢æ¾è¡ï¼æç´æ¥å³é­linuxé²ç«å¢\n   \n   #æ¥çé²ç«å¢ç¶æ\n   systemctl status firewalld\n   #ä¸´æ¶å³é­é²ç«å¢\n   systemctl stop firewalld\n   #å¼æºç¦æ­¢å¯å¨é²ç«å¢\n   systemctl disable firewalld\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   \n\n * åæ­¢å³é­æå¡\n   \n   åæ­¢æå¡çæ¹å¼æä¸¤ç§ï¼å¿«éå³é­åæ åå³é­ï¼ä¸é¢ä¾æ¬¡è¯´æï¼\n   \n   ï¼ä¸ï¼å¿«éå³é­æ¹æ³ï¼å¿«éï¼ç®åï¼æ°æ®å¯è½ä¼åºéï¼\n   \n   ç®æ ï¼éè¿ç³»ç»çkillå½ä»¤ç´æ¥ææ­»è¿ç¨ï¼\n   \n   æå®è¦æ£æ¥ä¸ä¸ï¼é¿åæçæ²¡æææã\n   \n   #éè¿è¿ç¨ç¼å·å³é­èç¹\n   kill -2 54410\n   \n   \n   1\n   2\n   \n   \n   ãè¡¥åã\n   \n   å¦æä¸æ¦æ¯å ä¸ºæ°æ®æåï¼åéè¦è¿è¡å¦ä¸æä½ï¼äºè§£ï¼ï¼\n   \n   1ï¼å é¤lockæä»¶ï¼\n   \n   rm -f /mongodb/single/data/db/*.lock\n   \n   \n   1\n   \n   \n   2 ï¼ä¿®å¤æ°æ®ï¼\n   \n   /usr/local/mongdb/bin/mongod --repair --dbpath=/mongodb/single/data/db\n   \n   \n   1\n   \n   \n   ï¼äºï¼æ åçå³é­æ¹æ³ï¼æ°æ®ä¸å®¹æåºéï¼ä½éº»ç¦ï¼ï¼\n   \n   ç®æ ï¼éè¿mongoå®¢æ·ç«¯ä¸­çshutdownServerå½ä»¤æ¥å³é­æå¡\n   \n   ä¸»è¦çæä½æ­¥éª¤åèå¦ä¸ï¼\n   \n   //å®¢æ·ç«¯ç»å½æå¡ï¼æ³¨æï¼è¿ééè¿localhostç»å½ï¼å¦æéè¦è¿ç¨ç»å½ï¼å¿é¡»åç»å½è®¤è¯æè¡ã\n   mongo --port 27017\n   //#åæ¢å°adminåº\n   use admin\n   //å³é­æå¡\n   db.shutdownServer()\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   \n\n\n# 3. åºæ¬å¸¸ç¨å½ä»¤\n\n\n# 3.1 æ¡ä¾éæ±\n\nå­æ¾æç« è¯è®ºçæ°æ®å­æ¾å°MongoDBä¸­ï¼æ°æ®ç»æåèå¦ä¸ï¼\n\næ°æ®åºï¼articledb\n\nä¸æ æç« è¯è®º           COMMENT                     \nå­æ®µåç§°             å­æ®µå«ä¹      å­æ®µç±»å              å¤æ³¨\n_id              ID        ObjectIdæString   Mongoçä¸»é®çå­æ®µ\narticleid        æç« ID      String            \ncontent          è¯è®ºåå®¹      String            \nuserid           è¯è®ºäººID     String            \nnickname         è¯è®ºäººæµç§°     String            \ncreatedatetime   è¯è®ºçæ¥ææ¶é´   Date              \nlikenum          ç¹èµæ°       Int32             \nreplynum         åå¤æ°       Int32             \nstate            ç¶æ        String            0ï¼ä¸å¯è§ï¼1ï¼å¯è§ï¼\nparentid         ä¸çº§ID      String            å¦æä¸º0è¡¨ç¤ºæç« çé¡¶çº§è¯è®º\n\n\n# 3.2 æ°æ®åºæä½\n\n\n# 3.2.1 éæ©ååå»ºæ°æ®åº\n\néæ©ååå»ºæ°æ®åºçè¯­æ³æ ¼å¼ï¼\n\nuse æ°æ®åºåç§°\n\n\n1\n\n\nå¦ææ°æ®åºä¸å­å¨åèªå¨åå»ºï¼ä¾å¦ï¼ä»¥ä¸è¯­å¥åå»º articledb æ°æ®åºï¼\n\nuse articledb\n\n\n1\n\n\næ¥çææéçææçæ°æ®åºå½ä»¤\n\nshow dbs\næ\nshow databases\n\n\n1\n2\n3\n\n\n> æ³¨æ : å¨ MongoDB ä¸­ï¼éååªæå¨åå®¹æå¥åæä¼åå»º! å°±æ¯è¯´ï¼åå»ºéå(æ°æ®è¡¨)åè¦åæå¥ä¸ä¸ªææ¡£(è®°å½)ï¼éåæä¼çæ­£åå»ºã\n\næ¥çå½åæ­£å¨ä½¿ç¨çæ°æ®åºå½ä»¤\n\ndb\n\n\n1\n\n\nMongoDB ä¸­é»è®¤çæ°æ®åºä¸º testï¼å¦æä½ æ²¡æéæ©æ°æ®åºï¼éåå°å­æ¾å¨ test æ°æ®åºä¸­ã\n\nå¦å¤ï¼\n\næ°æ®åºåå¯ä»¥æ¯æ»¡è¶³ä»¥ä¸æ¡ä»¶çä»»æUTF-8å­ç¬¦ä¸²ã\n\n * ä¸è½æ¯ç©ºå­ç¬¦ä¸²ï¼ ââ)ã\n * ä¸å¾å«æ â âï¼ç©ºæ ¼)ã.ã$ã/ã\\å\\0 (ç©ºå­ç¬¦)ã\n * åºå¨é¨å°åã\n * æå¤ 64å­èã\n\næä¸äºæ°æ®åºåæ¯ä¿ççï¼å¯ä»¥ç´æ¥è®¿é®è¿äºæç¹æ®ä½ç¨çæ°æ®åºã\n\n * admin ï¼ ä»æéçè§åº¦æ¥çï¼è¿æ¯ârootâæ°æ®åºãè¦æ¯å°ä¸ä¸ªç¨æ·æ·»å å°è¿ä¸ªæ°æ®åºï¼è¿ä¸ªç¨æ·èªå¨ç»§æ¿æææ°æ®åºçæéãä¸äºç¹å®çæå¡å¨ç«¯å½ä»¤ä¹åªè½ä»è¿ä¸ªæ°æ®åºè¿è¡ï¼æ¯å¦ååºææçæ°æ®åºæèå³é­æå¡å¨ã\n * local: è¿ä¸ªæ°æ®æ°¸è¿ä¸ä¼è¢«å¤å¶ï¼å¯ä»¥ç¨æ¥å­å¨éäºæ¬å°åå°æå¡å¨çä»»æéå\n * config : å½Mongoç¨äºåçè®¾ç½®æ¶ï¼configæ°æ®åºå¨åé¨ä½¿ç¨ï¼ç¨äºä¿å­åççç¸å³ä¿¡æ¯ã\n\n\n# 3.2.2 æ°æ®åºçå é¤\n\nMongoDB å é¤æ°æ®åºçè¯­æ³æ ¼å¼å¦ä¸ï¼\n\ndb.dropDatabase()\n\n\n1\n\n\næç¤ºï¼ä¸»è¦ç¨æ¥å é¤å·²ç»æä¹åçæ°æ®åº\n\n\n# 3.3 éåæä½\n\néåï¼ç±»ä¼¼å³ç³»åæ°æ®åºä¸­çè¡¨ã\n\nå¯ä»¥æ¾ç¤ºçåå»ºï¼ä¹å¯ä»¥éå¼çåå»ºã\n\n\n# 3.3.1 éåçæ¾å¼åå»º\n\nåºæ¬è¯­æ³æ ¼å¼ï¼\n\ndb.createCollection(name)\n\n\n1\n\n\nåæ°è¯´æï¼\n\n * name: è¦åå»ºçéååç§°\n\nä¾å¦ï¼åå»ºä¸ä¸ªåä¸º mycollection çæ®ééåã\n\ndb.createCollection("mycollection")\n\n\n1\n\n\næ¥çå½ååºä¸­çè¡¨ï¼ show tableså½ä»¤\n\nshow collections\næ\nshow tables\n\n\n1\n2\n3\n\n\néåçå½åè§èï¼\n\n * éååä¸è½æ¯ç©ºå­ç¬¦ä¸² ââã\n * éååä¸è½å«æ \\0å­ç¬¦ï¼ç©ºå­ç¬¦)ï¼è¿ä¸ªå­ç¬¦è¡¨ç¤ºéååçç»å°¾ã\n * éååä¸è½ä»¥ âsystem.âå¼å¤´ï¼è¿æ¯ä¸ºç³»ç»éåä¿ççåç¼ã\n * ç¨æ·åå»ºçéååå­ä¸è½å«æä¿çå­ç¬¦ãæäºé©±å¨ç¨åºçç¡®æ¯æå¨éååéé¢åå«ï¼è¿æ¯å ä¸ºæäºç³»ç»çæçéåä¸­åå«è¯¥å­ç¬¦ãé¤éä½ è¦è®¿é®è¿ç§ç³»ç»åå»ºçéåï¼å¦ååä¸ä¸è¦å¨åå­éåºç°$ã\n\n\n# 3.3.2 éåçéå¼åå»º\n\nå½åä¸ä¸ªéåä¸­æå¥ä¸ä¸ªææ¡£çæ¶åï¼å¦æéåä¸å­å¨ï¼åä¼èªå¨åå»ºéåã\n\nè¯¦è§ ææ¡£çæå¥ ç« èã\n\næç¤ºï¼éå¸¸æä»¬ä½¿ç¨éå¼åå»ºææ¡£å³å¯ã\n\n\n# 3.3.3 éåçå é¤\n\néåå é¤è¯­æ³æ ¼å¼å¦ä¸ï¼\n\ndb.collection.drop()\næ\ndb.éå.drop()\n\n\n1\n2\n3\n\n\nè¿åå¼\n\nå¦ææåå é¤éå®éåï¼å drop() æ¹æ³è¿å trueï¼å¦åè¿å falseã\n\nä¾å¦ï¼è¦å é¤mycollectionéå\n\ndb.mycollection.drop()\n\n\n1\n\n\n\n# 3.4 ææ¡£åºæ¬CRUD\n\nææ¡£ï¼documentï¼çæ°æ®ç»æå JSON åºæ¬ä¸æ ·ã\n\nææå­å¨å¨éåä¸­çæ°æ®é½æ¯ BSON æ ¼å¼ã\n\n\n# 3.4.1 ææ¡£çæå¥\n\n# 3.4.1.1 åä¸ªææ¡£æå¥\n\nä½¿ç¨insert() æ save() æ¹æ³åéåä¸­æå¥ææ¡£ï¼è¯­æ³å¦ä¸ï¼\n\ndb.collection.insert(\n    <document or array of documents>,\n    {\n        writeConcern: <document>,\n        ordered: <boolean>\n    }\n)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nåæ°ï¼\n\nPARAMETER      TYPE                DESCRIPTION\ndocument       document or array   è¦æå¥å°éåä¸­çææ¡£æææ¡£æ°ç»ãï¼(jsonæ ¼å¼ï¼\nwriteConcern   document            Optional. A document expressing the write concern . Omit to\n                                   use the default write concern. See Write Concern .Do not\n                                   explicitly set the write concern for the operation if run in\n                                   a transaction. To use write concern with transactions, see\n                                   Transactions and Write Concern\nordered        boolean             å¯éãå¦æä¸ºçï¼åæé¡ºåºæå¥æ°ç»ä¸­çææ¡£ï¼å¦æå¶ä¸­ä¸ä¸ªææ¡£åºç°éè¯¯ï¼MongoDBå°è¿åèä¸å¤çæ°ç»ä¸­çå¶ä½ææ¡£ãå¦æä¸ºåï¼åæ§è¡æ åºæå¥ï¼å¦æå¶ä¸­ä¸ä¸ªææ¡£åºç°éè¯¯ï¼åç»§ç»­å¤çæ°ç»ä¸­çä¸»ææ¡£ãå¨çæ¬2.6+ä¸­é»è®¤ä¸ºtrue\n\nãç¤ºä¾ã\n\nè¦åcommentçéå(è¡¨)ä¸­æå¥ä¸æ¡æµè¯æ°æ®ï¼\n\ndb.comment.insert({"articleid":"100000","content":"ä»å¤©å¤©æ°çå¥½ï¼é³åæåª","userid":"1001","nickname":"Rose","createdatetime":new Date(),"likenum":NumberInt(10),"state":null})\n\n\n1\n\n\næç¤ºï¼\n\n * commentéåå¦æä¸å­å¨ï¼åä¼éå¼åå»º\n * mongoä¸­çæ°å­ï¼é»è®¤æåµä¸æ¯doubleç±»åï¼å¦æè¦å­æ´åï¼å¿é¡»ä½¿ç¨å½æ°NumberInt(æ´åæ°å­)ï¼å¦åååºæ¥å°±æé®é¢äºã\n * æå¥å½åæ¥æä½¿ç¨ new Date()\n * æå¥çæ°æ®æ²¡ææå® _id ï¼ä¼èªå¨çæä¸»é®å¼\n * å¦ææå­æ®µæ²¡å¼ï¼å¯ä»¥èµå¼ä¸ºnullï¼æä¸åè¯¥å­æ®µã\n\næ§è¡åï¼å¦ä¸ï¼è¯´ææå¥ä¸ä¸ªæ°æ®æåäºã\n\nWriteResult({ "nInserted" : 1 })\n\n\n1\n\n\næ³¨æï¼\n\n * ææ¡£ä¸­çé®/å¼å¯¹æ¯æåºçã\n * ææ¡£ä¸­çå¼ä¸ä»å¯ä»¥æ¯å¨åå¼å·éé¢çå­ç¬¦ä¸²ï¼è¿å¯ä»¥æ¯å¶ä»å ç§æ°æ®ç±»åï¼çè³å¯ä»¥æ¯æ´ä¸ªåµå¥çææ¡£)ã\n * MongoDBåºåç±»ååå¤§å°åã\n * MongoDBçææ¡£ä¸è½æéå¤çé®ã\n * ææ¡£çé®æ¯å­ç¬¦ä¸²ãé¤äºå°æ°ä¾å¤æåµï¼é®å¯ä»¥ä½¿ç¨ä»»æUTF-8å­ç¬¦ã\n\nææ¡£é®å½åè§èï¼\n\n * é®ä¸è½å«æ \\0 (ç©ºå­ç¬¦)ãè¿ä¸ªå­ç¬¦ç¨æ¥è¡¨ç¤ºé®çç»å°¾ã\n * . å$æç¹å«çæä¹ï¼åªæå¨ç¹å®ç¯å¢ä¸æè½ä½¿ç¨ã\n * ä»¥ä¸åçº¿ â_âå¼å¤´çé®æ¯ä¿çç(ä¸æ¯ä¸¥æ ¼è¦æ±ç)ã\n\n# 3.4.1.2 æ¹éæå¥\n\nè¯­æ³ï¼\n\ndb.collection.insertMany(\n     [ <document 1> , <document 2>, ... ],\n     {\n         writeConcern: <document>,\n         ordered: <boolean>\n     }\n)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nãç¤ºä¾ã\n\næ¹éæå¥å¤æ¡æç« è¯è®ºï¼\n\ndb.comment.insertMany([\n    {"_id":"1","articleid":"100001","content":"æä»¬ä¸åºè¯¥ææ¸æ¨æµªè´¹å¨ææºä¸ï¼å¥åº·å¾éè¦ï¼ä¸æ¯æ¸©æ°´å¹¸ç¦ä½ æä»ã","userid":"1002","nickname":"ç¸å¿äºæ±æ¹","createdatetime":new Date("2019-08-05T22:08:15.522Z"),"likenum":NumberInt(1000),"state":"1"},\n    {"_id":"2","articleid":"100001","content":"æå¤å¤©ç©ºè¹ååå¼æ°´ï¼å¬å¤©åæ¸©å¼æ°´","userid":"1005","nickname":"ä¼äººææ´","createdatetime":new Date("2019-08-05T23:58:51.485Z"),"likenum":NumberInt(888),"state":"1"},\n    {"_id":"3","articleid":"100001","content":"æä¸ç´ååå¼æ°´ï¼å¬å¤©å¤å¤©é½åã","userid":"1004","nickname":"æ°åè¹é¿","createdatetime":new Date("2019-08-06T01:05:06.321Z"),"likenum":NumberInt(666),"state":"1"},\n    {"_id":"4","articleid":"100001","content":"ä¸å®¶è¯´ä¸è½ç©ºè¹åé¥­ï¼å½±åå¥åº·ã","userid":"1003","nickname":"å¯æ","createdatetime":new Date("2019-08-06T08:18:35.288Z"),"likenum":NumberInt(2000),"state":"1"},\n    {"_id":"5","articleid":"100001","content":"ç ç©¶è¡¨æï¼åç§å¼çæ°´åä¸ä¸è½åï¼å ä¸ºç«å´ã","userid":"1003","nickname":"å¯æ","createdatetime":new Date("2019-08-06T11:01:02.521Z"),"likenum":NumberInt(3000),"state":"1"}\n\n]);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næç¤ºï¼\n\næå¥æ¶æå®äº _id ï¼åä¸»é®å°±æ¯è¯¥å¼ã\n\nå¦æææ¡æ°æ®æå¥å¤±è´¥ï¼å°ä¼ç»æ­¢æå¥ï¼ä½å·²ç»æå¥æåçæ°æ®ä¸ä¼åæ»æã\n\nå ä¸ºæ¹éæå¥ç±äºæ°æ®è¾å¤å®¹æåºç°å¤±è´¥ï¼å æ­¤ï¼å¯ä»¥ä½¿ç¨try catchè¿è¡å¼å¸¸ææå¤çï¼æµè¯çæ¶åå¯ä»¥ä¸å¤çãå¦ï¼äºè§£ï¼ï¼\n\ntry {\n    db.comment.insertMany([\n        {"_id":"1","articleid":"100001","content":"æä»¬ä¸åºè¯¥ææ¸æ¨æµªè´¹å¨ææºä¸ï¼å¥åº·å¾éè¦ï¼ä¸æ¯æ¸©æ°´å¹¸ç¦ä½ æä»ã","userid":"1002","nickname":"ç¸å¿äºæ±æ¹","createdatetime":new Date("2019-08-05T22:08:15.522Z"),"likenum":NumberInt(1000),"state":"1"},\n        {"_id":"2","articleid":"100001","content":"æå¤å¤©ç©ºè¹ååå¼æ°´ï¼å¬å¤©åæ¸©å¼æ°´","userid":"1005","nickname":"ä¼äººææ´","createdatetime":new Date("2019-08-05T23:58:51.485Z"),"likenum":NumberInt(888),"state":"1"},\n        {"_id":"3","articleid":"100001","content":"æä¸ç´ååå¼æ°´ï¼å¬å¤©å¤å¤©é½åã","userid":"1004","nickname":"æ°åè¹é¿","createdatetime":new Date("2019-08-06T01:05:06.321Z"),"likenum":NumberInt(666),"state":"1"},\n        {"_id":"4","articleid":"100001","content":"ä¸å®¶è¯´ä¸è½ç©ºè¹åé¥­ï¼å½±åå¥åº·ã","userid":"1003","nickname":"å¯æ","createdatetime":new Date("2019-08-06T08:18:35.288Z"),"likenum":NumberInt(2000),"state":"1"},\n        {"_id":"5","articleid":"100001","content":"ç ç©¶è¡¨æï¼åç§å¼çæ°´åä¸ä¸è½åï¼å ä¸ºç«å´ã","userid":"1003","nickname":"å¯æ","createdatetime":new Date("2019-08-06T11:01:02.521Z"),"likenum":NumberInt(3000),"state":"1"}\n\n    ]);\n\n} catch (e) {\n    print (e);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# 3.4.2 ææ¡£çåºæ¬æ¥è¯¢\n\næ¥è¯¢æ°æ®çè¯­æ³æ ¼å¼å¦ä¸ï¼\n\ndb.collection.find(<query>, [projection])\n\n\n1\n\n\nåæ°ï¼\n\nPARAMETER    TYPE       DESCRIPTION\nquery        document   å¯éãä½¿ç¨æ¥è¯¢è¿ç®ç¬¦æå®éæ©ç­éå¨ãè¥è¦è¿åéåä¸­çææææ¡£ï¼è¯·çç¥æ­¤åæ°æä¼ éç©ºææ¡£( {} )ã\nprojection   document   å¯éãæå®è¦å¨ä¸æ¥è¯¢ç­éå¨å¹éçææ¡£ä¸­è¿åçå­æ®µï¼æå½±ï¼ãè¥è¦è¿åå¹éææ¡£ä¸­çææå­æ®µï¼è¯·çç¥æ­¤åæ°ã\n\nãç¤ºä¾ã\n\n# 3.4.2.1 æ¥è¯¢ææ\n\nå¦ææä»¬è¦æ¥è¯¢commentéåçææææ¡£ï¼æä»¬è¾å¥ä»¥ä¸å½ä»¤\n\ndb.comment.find()\næ\ndb.comment.find({})\n\n\n1\n2\n3\n\n\nè¿éä½ ä¼åç°æ¯æ¡ææ¡£ä¼æä¸ä¸ªå« _idçå­æ®µï¼è¿ä¸ªç¸å½äºæä»¬åæ¥å³ç³»æ°æ®åºä¸­è¡¨çä¸»é®ï¼å½ä½ å¨æå¥ææ¡£è®°å½æ¶æ²¡ææå®è¯¥å­æ®µï¼MongoDBä¼èªå¨åå»ºï¼å¶ç±»åæ¯ObjectIDç±»åã\n\nå¦ææä»¬å¨æå¥ææ¡£è®°å½æ¶æå®è¯¥å­æ®µä¹å¯ä»¥ï¼å¶ç±»åå¯ä»¥æ¯ObjectIDç±»åï¼ä¹å¯ä»¥æ¯MongoDBæ¯æçä»»æç±»åã\n\nå¦æææ³æä¸å®æ¡ä»¶æ¥æ¥è¯¢ï¼æ¯å¦ææ³æ¥è¯¢useridä¸º1003çè®°å½ï¼æä¹åï¼å¾ç®åï¼åª è¦å¨find()ä¸­æ·»å åæ°å³å¯ï¼åæ°ä¹æ¯jsonæ ¼å¼ï¼å¦ä¸ï¼\n\ndb.comment.find({userid:\'1003\'})\n\n\n1\n\n\nå¦æä½ åªéè¦è¿åç¬¦åæ¡ä»¶çç¬¬ä¸æ¡æ°æ®ï¼æä»¬å¯ä»¥ä½¿ç¨findOneå½ä»¤æ¥å®ç°ï¼è¯­æ³åfindä¸æ ·ã\n\nå¦ï¼æ¥è¯¢ç¨æ·ç¼å·æ¯1003çè®°å½ï¼ä½åªæå¤è¿åç¬¦åæ¡ä»¶çç¬¬ä¸æ¡è®°å½ï¼\n\ndb.comment.findOne({userid:\'1003\'})\n\n\n1\n\n\n# 3.4.2.2 æå½±æ¥è¯¢ï¼PROJECTION QUERYï¼\n\nå¦æè¦æ¥è¯¢ç»æè¿åé¨åå­æ®µï¼åéè¦ä½¿ç¨æå½±æ¥è¯¢ï¼ä¸æ¾ç¤ºææå­æ®µï¼åªæ¾ç¤ºæå®çå­æ®µï¼ã\n\nå¦ï¼æ¥è¯¢ç»æåªæ¾ç¤º _id ãuseridãnickname :\n\ndb.comment.find({userid:"1003"},{userid:1,nickname:1})\n\n\n1\n\n\né»è®¤ _id ä¼æ¾ç¤ºã\n\nå¦ï¼æ¥è¯¢ç»æåªæ¾ç¤º ã useridãnickname ï¼ä¸æ¾ç¤º _id ï¼\n\ndb.comment.find({userid:"1003"},{userid:1,nickname:1,_id:0})\n\n\n1\n\n\nåä¾å¦ï¼æ¥è¯¢æææ°æ®ï¼ä½åªæ¾ç¤º _id ãuseridãnickname :\n\ndb.comment.find({},{userid:1,nickname:1})\n\n\n1\n\n\n\n# 3.4.3 ææ¡£çæ´æ°\n\næ´æ°ææ¡£çè¯­æ³ï¼\n\ndb.collection.update(query, update, options)\n//æ\ndb.collection.update(\n    <query>,\n    <update>,\n    {\n        upsert: <boolean>,\n        multi: <boolean>,\n        writeConcern: <document>,\n        collation: <document>,\n        arrayFilters: [ <filterdocument1>, ... ],\n        hint:  <document|string>     // Available starting in MongoDB 4.2\n    }\n)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nåæ°ï¼\n\nPARAMETER   TYPE       DESCRIPTION\nquery       document   æ´æ°çéæ©æ¡ä»¶ãå¯ä»¥ä½¿ç¨ä¸findï¼ï¼æ¹æ³ä¸­ç¸åçæ¥è¯¢éæ©å¨ï¼ç±»ä¼¼sql\n                       updateæ¥è¯¢åwhereåé¢çããå¨3.0çä¸­è¿è¡äºæ´æ¹ï¼å½ä½¿ç¨upsert:trueæ§è¡updateï¼ï¼æ¶ï¼å¦ææ¥è¯¢ä½¿ç¨ç¹è¡¨ç¤ºæ³å¨_id\n                       å­æ®µä¸æå®æ¡ä»¶ï¼åMongoDBå°æç»æå¥æ°ææ¡£ã\nmulti       boolean    å¯éãå¦æè®¾ç½®ä¸ºtrueï¼åæ´æ°ç¬¦åæ¥è¯¢æ¡ä»¶çå¤ä¸ªææ¡£ãå¦æè®¾ç½®ä¸ºfalseï¼åæ´æ°ä¸ä¸ªææ¡£ãé»è®¤å¼ä¸ºfalseã\n\nãç¤ºä¾ã\n\n# 3.4.3.1 è¦ççä¿®æ¹\n\nå¦ææä»¬æ³ä¿®æ¹_idä¸º1çè®°å½ï¼ç¹èµéä¸º1001ï¼è¾å¥ä»¥ä¸è¯­å¥ï¼\n\ndb.comment.update({_id:"1"},{likenum:NumberInt(1001)})\n\n\n1\n\n\næ§è¡åï¼æä»¬ä¼åç°ï¼è¿æ¡ææ¡£é¤äº likenumå­æ®µå¶å®å­æ®µé½ä¸è§äºï¼\n\n# 3.4.3.2 å±é¨ä¿®æ¹\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼æä»¬éè¦ä½¿ç¨ä¿®æ¹å¨$setæ¥å®ç°ï¼å½ä»¤å¦ä¸ï¼\n\næä»¬æ³ä¿®æ¹_idä¸º2çè®°å½ï¼æµè§éä¸º889ï¼è¾å¥ä»¥ä¸è¯­å¥ï¼\n\ndb.comment.update({_id:"2"},{$set:{likenum:NumberInt(889)}})\n\n\n1\n\n\n# 3.4.3.3 æ¹éçä¿®æ¹\n\næ´æ°ææç¨æ·ä¸º 1003 çç¨æ·çæµç§°ä¸º å¯æå¤§å¸ ã\n\n//é»è®¤åªä¿®æ¹ç¬¬ä¸æ¡æ°æ®\ndb.comment.update({userid:"1003"},{$set:{nickname:"å¯æ2"}})\n//ä¿®æ¹ææç¬¦åæ¡ä»¶çæ°æ®\ndb.comment.update({userid:"1003"},{$set:{nickname:"å¯æå¤§å¸"}},{multi:true})\n\n\n1\n2\n3\n4\n\n\næç¤ºï¼å¦æä¸å åé¢çåæ°ï¼ååªæ´æ°ç¬¦åæ¡ä»¶çç¬¬ä¸æ¡è®°å½\n\n# 3.4.3.4 åå¼å¢é¿çä¿®æ¹\n\nå¦ææä»¬æ³å®ç°å¯¹æåå¼å¨åæå¼çåºç¡ä¸è¿è¡å¢å æåå°ï¼å¯ä»¥ä½¿ç¨ $inc è¿ç®ç¬¦æ¥å®ç°ã\n\néæ±ï¼å¯¹3å·æ°æ®çç¹èµæ°ï¼æ¯æ¬¡éå¢1\n\ndb.comment.update({_id:"3"},{$inc:{likenum:NumberInt(1)}})\n\n\n1\n\n\n\n# 3.4.4 å é¤ææ¡£\n\nå é¤ææ¡£çè¯­æ³ç»æï¼\n\ndb.éååç§°.remove(æ¡ä»¶)\n\n\n1\n\n\nä»¥ä¸è¯­å¥å¯ä»¥å°æ°æ®å¨é¨å é¤ï¼è¯·æç¨\n\ndb.comment.remove({})\n\n\n1\n\n\nå¦æå é¤ _id=1çè®°å½ï¼è¾å¥ä»¥ä¸è¯­å¥\n\ndb.comment.remove({_id:"1"})\n\n\n1\n\n\n\n# 3.5 ææ¡£çåé¡µæ¥è¯¢\n\n\n# 3.5.1 ç»è®¡æ¥è¯¢\n\nç»è®¡æ¥è¯¢ä½¿ç¨count()æ¹æ³ï¼è¯­æ³å¦ä¸ï¼\n\ndb.collection.count(query, options)\n\n\n1\n\n\nåæ°ï¼\n\nPARAMETER   TYPE       DESCRIPTION\nquery       document   æ¥è¯¢éæ©æ¡ä»¶\noptions     document   å¯éãç¨äºä¿®æ¹è®¡æ°çé¢å¤éé¡¹\n\nãç¤ºä¾ã\n\n# 3.5.1.1 ç»è®¡ææè®°å½æ°\n\nç»è®¡commentéåçææçè®°å½æ°ï¼\n\ndb.comment.count()\n\n\n1\n\n\n# 3.5.1.2 ææ¡ä»¶ç»è®¡è®°å½æ°\n\nä¾å¦ï¼ç»è®¡useridä¸º1003çè®°å½æ¡æ°\n\ndb.comment.count({userid:"1003"})\n\n\n1\n\n\næç¤ºï¼\n\né»è®¤æåµä¸ count() æ¹æ³è¿åç¬¦åæ¡ä»¶çå¨é¨è®°å½æ¡æ°ã\n\n\n# 3.5.2 åé¡µåè¡¨æ¥è¯¢\n\nå¯ä»¥ä½¿ç¨limit()æ¹æ³æ¥è¯»åæå®æ°éçæ°æ®ï¼ä½¿ç¨skip()æ¹æ³æ¥è·³è¿æå®æ°éçæ°æ®ã\n\nåºæ¬è¯­æ³å¦ä¸æç¤ºï¼\n\ndb.COLLECTION_NAME.find().limit(NUMBER).skip(NUMBER)\n\n\n1\n\n\nå¦æä½ æ³è¿åæå®æ¡æ°çè®°å½ï¼å¯ä»¥å¨findæ¹æ³åè°ç¨limitæ¥è¿åç»æ(TopN)ï¼é»è®¤å¼20ï¼ä¾å¦ï¼\n\ndb.comment.find().limit(3)\n\n\n1\n\n\nskip æ¹æ³åæ ·æ¥åä¸ä¸ªæ°å­åæ°ä½ä¸ºè·³è¿çè®°å½æ¡æ°ãï¼åNä¸ªä¸è¦ï¼,é»è®¤å¼æ¯0\n\ndb.comment.find().skip(3)\n\n\n1\n\n\nåé¡µæ¥è¯¢ï¼éæ±ï¼æ¯é¡µ2ä¸ªï¼ç¬¬äºé¡µå¼å§ï¼è·³è¿åä¸¤æ¡æ°æ®ï¼æ¥çå¼æ¾ç¤º3å4æ¡æ°æ®\n\n//ç¬¬ä¸é¡µ\ndb.comment.find().skip(0).limit(2)\n//ç¬¬äºé¡µ\ndb.comment.find().skip(2).limit(2)\n//ç¬¬ä¸é¡µ\ndb.comment.find().skip(4).limit(2)\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 3.5.3 æåºæ¥è¯¢\n\nsort() æ¹æ³å¯¹æ°æ®è¿è¡æåºï¼sort() æ¹æ³å¯ä»¥éè¿åæ°æå®æåºçå­æ®µï¼å¹¶ä½¿ç¨ 1 å -1 æ¥æå®æåºçæ¹å¼ï¼å¶ä¸­ 1ä¸ºååºæåï¼è -1 æ¯ç¨äºéåºæåã\n\nè¯­æ³å¦ä¸æç¤ºï¼\n\ndb.COLLECTION_NAME.find().sort({KEY:1})\næ\ndb.éååç§°.find().sort(æåºæ¹å¼)\n\n\n1\n2\n3\n\n\nä¾å¦ï¼\n\nå¯¹useridéåºæåï¼å¹¶å¯¹è®¿é®éè¿è¡ååºæå\n\ndb.comment.find().sort({userid:-1,likenum:1})\n\n\n1\n\n\næç¤ºï¼\n\nskip(), limilt(), sort()ä¸ä¸ªæ¾å¨ä¸èµ·æ§è¡çæ¶åï¼æ§è¡çé¡ºåºæ¯å sort(), ç¶åæ¯ skip()ï¼æåæ¯æ¾ç¤ºç limit()ï¼åå½ä»¤ç¼åé¡ºåºæ å³ã\n\n\n# 3.6 ææ¡£çæ´å¤æ¥è¯¢\n\n\n# 3.6.1 æ­£åçå¤ææ¡ä»¶æ¥è¯¢\n\nMongoDBçæ¨¡ç³æ¥è¯¢æ¯éè¿æ­£åè¡¨è¾¾å¼çæ¹å¼å®ç°çãæ ¼å¼ä¸ºï¼\n\ndb.collection.find({field:/æ­£åè¡¨è¾¾å¼/})\næ\ndb.éå.find({å­æ®µ:/æ­£åè¡¨è¾¾å¼/})\n\n\n1\n2\n3\n\n\næç¤ºï¼æ­£åè¡¨è¾¾å¼æ¯ jsçè¯­æ³ï¼ç´æ¥éçåæ³ã\n\nä¾å¦ï¼æè¦æ¥è¯¢è¯è®ºåå®¹åå«âå¼æ°´âçææææ¡£ï¼ä»£ç å¦ä¸ï¼\n\ndb.comment.find({content:/å¼æ°´/})\n\n\n1\n\n\nå¦æè¦æ¥è¯¢è¯è®ºçåå®¹ä¸­ä»¥ âä¸å®¶âå¼å¤´çï¼ä»£ç å¦ä¸ï¼\n\ndb.comment.find({content:/^ä¸å®¶/})\n\n\n1\n\n\n\n# 3.6.2 æ¯è¾æ¥è¯¢\n\n<, <=, >, >= è¿ä¸ªæä½ç¬¦ä¹æ¯å¾å¸¸ç¨çï¼æ ¼å¼å¦ä¸:\n\ndb.éååç§°.find({ "field" : { $gt: value }}) // å¤§äº: field > value\ndb.éååç§°.find({ "field" : { $lt: value }}) // å°äº: field < value\ndb.éååç§°.find({ "field" : { $gte: value }}) // å¤§äºç­äº: field >= value\ndb.éååç§°.find({ "field" : { $lte: value }}) // å°äºç­äº: field <= value\ndb.éååç§°.find({ "field" : { $ne: value }}) // ä¸ç­äº: field != value\n\n\n1\n2\n3\n4\n5\n\n\nç¤ºä¾ï¼æ¥è¯¢è¯è®ºç¹èµæ°éå¤§äº 700çè®°å½\n\ndb.comment.find({likenum:{$gt:NumberInt(700)}})\n\n\n1\n\n\n\n# 3.6.3 åå«æ¥è¯¢\n\nåå«ä½¿ç¨$inæä½ç¬¦ã ç¤ºä¾ï¼æ¥è¯¢è¯è®ºçéåä¸­useridå­æ®µåå«1003æ1004çææ¡£\n\ndb.comment.find({userid:{$in:["1003","1004"]}})\n\n\n1\n\n\nä¸åå«ä½¿ç¨ $ninæä½ç¬¦ã ç¤ºä¾ï¼æ¥è¯¢è¯è®ºéåä¸­useridå­æ®µä¸åå«1003å1004çææ¡£\n\ndb.comment.find({userid:{$nin:["1003","1004"]}})\n\n\n1\n\n\n\n# 3.6.4 æ¡ä»¶è¿æ¥æ¥è¯¢\n\næä»¬å¦æéè¦æ¥è¯¢åæ¶æ»¡è¶³ä¸¤ä¸ªä»¥ä¸æ¡ä»¶ï¼éè¦ä½¿ç¨$andæä½ç¬¦å°æ¡ä»¶è¿è¡å³èãï¼ç¸å½äºSQLçandï¼ æ ¼å¼ä¸ºï¼\n\n$and:[ {  },{  },{ } ]\n\n\n1\n\n\nç¤ºä¾ï¼æ¥è¯¢è¯è®ºéåä¸­ likenumå¤§äºç­äº700 å¹¶ä¸å°äº2000çææ¡£ï¼\n\ndb.comment.find({$and:[{likenum:{$gte:NumberInt(700)}},{likenum:{$lt:NumberInt(2000)}}]})\n\n\n1\n\n\nå¦æä¸¤ä¸ªä»¥ä¸æ¡ä»¶ä¹é´æ¯æèçå³ç³»ï¼æä»¬ä½¿ç¨æä½ç¬¦è¿è¡å³èï¼ä¸åé¢ andçä½¿ç¨æ¹å¼ç¸åæ ¼å¼ä¸ºï¼\n\n$or:[ {  },{  },{   } ]\n\n\n1\n\n\nç¤ºä¾ï¼æ¥è¯¢è¯è®ºéåä¸­ useridä¸º1003ï¼æèç¹èµæ°å°äº1000çææ¡£è®°å½\n\ndb.comment.find({$or:[ {userid:"1003"} ,{likenum:{$lt:1000} }]})\n\n\n1\n\n\n\n# 3.7 å¸¸ç¨å½ä»¤å°ç»\n\néæ©åæ¢æ°æ®åºï¼use articledb\næå¥æ°æ®ï¼db.comment.insert({bsonæ°æ®})\næ¥è¯¢æææ°æ®ï¼db.comment.find();\næ¡ä»¶æ¥è¯¢æ°æ®ï¼db.comment.find({æ¡ä»¶})\næ¥è¯¢ç¬¦åæ¡ä»¶çç¬¬ä¸æ¡è®°å½ï¼db.comment.findOne({æ¡ä»¶})\næ¥è¯¢ç¬¦åæ¡ä»¶çåå æ¡è®°å½ï¼db.comment.find({æ¡ä»¶}).limit(æ¡æ°)\næ¥è¯¢ç¬¦åæ¡ä»¶çè·³è¿çè®°å½ï¼db.comment.find({æ¡ä»¶}).skip(æ¡æ°)\nä¿®æ¹æ°æ®ï¼db.comment.update({æ¡ä»¶},{ä¿®æ¹åçæ°æ®}) ædb.comment.update({æ¡ä»¶},{$set:{è¦ä¿®æ¹é¨åçå­æ®µ:æ°æ®})\nä¿®æ¹æ°æ®å¹¶èªå¢æå­æ®µå¼ï¼db.comment.update({æ¡ä»¶},{$inc:{èªå¢çå­æ®µ:æ­¥è¿å¼}})\nå é¤æ°æ®ï¼db.comment.remove({æ¡ä»¶})\nç»è®¡æ¥è¯¢ï¼db.comment.count({æ¡ä»¶})\næ¨¡ç³æ¥è¯¢ï¼db.comment.find({å­æ®µå:/æ­£åè¡¨è¾¾å¼/})\næ¡ä»¶æ¯è¾è¿ç®ï¼db.comment.find({å­æ®µå:{$gt:å¼}})\nåå«æ¥è¯¢ï¼db.comment.find({å­æ®µå:{$in:[å¼1ï¼å¼2]}})ædb.comment.find({å­æ®µå:{$nin:[å¼1ï¼å¼2]}})\næ¡ä»¶è¿æ¥æ¥è¯¢ï¼db.comment.find({$and:[{æ¡ä»¶1},{æ¡ä»¶2}]})ædb.comment.find({$or:[{æ¡ä»¶1},{æ¡ä»¶2}]})\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# 4. ç´¢å¼-Index\n\n\n# 4.1 æ¦è¿°\n\nç´¢å¼æ¯æå¨MongoDBä¸­é«æå°æ§è¡æ¥è¯¢ãå¦ææ²¡æç´¢å¼ï¼MongoDBå¿é¡»æ§è¡å¨éåæ«æï¼å³æ«æéåä¸­çæ¯ä¸ªææ¡£ï¼ä»¥éæ©ä¸æ¥è¯¢è¯­å¥å¹éçææ¡£ãè¿ç§æ«æå¨éåçæ¥è¯¢æçæ¯éå¸¸ä½çï¼ç¹å«å¨å¤çå¤§éçæ°æ®æ¶ï¼æ¥è¯¢å¯ä»¥è¦è±è´¹å åç§çè³å åéï¼è¿å¯¹ç½ç«çæ§è½æ¯éå¸¸è´å½çã\n\nå¦ææ¥è¯¢å­å¨éå½çç´¢å¼ï¼MongoDBå¯ä»¥ä½¿ç¨è¯¥ç´¢å¼éå¶å¿é¡»æ£æ¥çææ¡£æ°ã\n\nç´¢å¼æ¯ç¹æ®çæ°æ®ç»æï¼å®ä»¥æäºéåçå½¢å¼å­å¨éåæ°æ®éçä¸å°é¨åãç´¢å¼å­å¨ç¹å®å­æ®µæä¸ç»å­æ®µçå¼ï¼æå­æ®µå¼æåºãç´¢å¼é¡¹çæåºæ¯æææçç¸ç­å¹éååºäºèå´çæ¥è¯¢æä½ãæ­¤å¤ï¼MongoDBè¿å¯ä»¥ä½¿ç¨ç´¢å¼ä¸­çæåºè¿åæåºç»æã\n\nå®ç½ææ¡£ï¼ https://docs.mongodb.com/manual/indexes/\n\näºè§£ï¼\n\nMongoDBç´¢å¼ä½¿ç¨Bæ æ°æ®ç»æï¼ç¡®åçè¯´æ¯B-Treeï¼MySQLæ¯B+Treeï¼\n\n\n# 4.2 ç´¢å¼çç±»å\n\n\n# 4.2.1 åå­æ®µç´¢å¼\n\nMongoDBæ¯æå¨ææ¡£çåä¸ªå­æ®µä¸åå»ºç¨æ·å®ä¹çååº/éåºç´¢å¼ï¼ç§°ä¸ºåå­æ®µç´¢å¼ï¼Single Field Indexï¼ã\n\nå¯¹äºåä¸ªå­æ®µç´¢å¼åæåºæä½ï¼ç´¢å¼é®çæåºé¡ºåºï¼å³ååºæéåºï¼å¹¶ä¸éè¦ï¼å ä¸ºMongoDBå¯ä»¥å¨ä»»ä½æ¹åä¸éåç´¢å¼ã\n\n\n\n\n# 4.2.2 å¤åç´¢å¼\n\nMongoDBè¿æ¯æå¤ä¸ªå­æ®µçç¨æ·å®ä¹ç´¢å¼ï¼å³å¤åç´¢å¼ï¼Compound Indexï¼ã\n\nå¤åç´¢å¼ä¸­ååºçå­æ®µé¡ºåºå·æéè¦æä¹ãä¾å¦ï¼å¦æå¤åç´¢å¼ç± { userid: 1, score: -1 } ç»æï¼åç´¢å¼é¦åæuseridæ­£åºæåºï¼ç¶åå¨æ¯ä¸ªuseridçå¼åï¼åå¨æscoreååºæåºã\n\n\n\n\n# 4.2.3 å¶ä»ç´¢å¼\n\nå°çç©ºé´ç´¢å¼ï¼Geospatial Indexï¼ãææ¬ç´¢å¼ï¼Text Indexesï¼ãåå¸ç´¢å¼ï¼Hashed Indexesï¼ã\n\n * å°çç©ºé´ç´¢å¼ï¼Geospatial Indexï¼\n   \n   ä¸ºäºæ¯æå¯¹å°çç©ºé´åæ æ°æ®çæææ¥è¯¢ï¼MongoDBæä¾äºä¸¤ç§ç¹æ®çç´¢å¼ï¼è¿åç»ææ¶ä½¿ç¨å¹³é¢å ä½çäºç»´ç´¢å¼åè¿åç»ææ¶ä½¿ç¨çé¢å ä½çäºç»´çé¢ç´¢å¼ã\n\n * ææ¬ç´¢å¼ï¼Text Indexesï¼\n   \n   MongoDBæä¾äºä¸ç§ææ¬ç´¢å¼ç±»åï¼æ¯æå¨éåä¸­æç´¢å­ç¬¦ä¸²åå®¹ãè¿äºææ¬ç´¢å¼ä¸å­å¨ç¹å®äºè¯­è¨çåæ­¢è¯ï¼ä¾å¦âtheâãâaâãâorâï¼ï¼èå°éåä¸­çè¯ä½ä¸ºè¯å¹²ï¼åªå­å¨æ ¹è¯ã\n\n * åå¸ç´¢å¼ï¼Hashed Indexesï¼\n   \n   ä¸ºäºæ¯æåºäºæ£åçåçï¼MongoDBæä¾äºæ£åç´¢å¼ç±»åï¼å®å¯¹å­æ®µå¼çæ£åè¿è¡ç´¢å¼ãè¿äºç´¢å¼å¨å¶èå´åçå¼åå¸æ´å éæºï¼ä½åªæ¯æç¸ç­å¹éï¼ä¸æ¯æåºäºèå´çæ¥è¯¢ã\n\n\n# 4.3 ç´¢å¼çç®¡çæä½\n\n\n# 4.3.1 ç´¢å¼çæ¥ç\n\nè¯´æï¼\n\nè¿åä¸ä¸ªéåä¸­çææç´¢å¼çæ°ç»ã\n\nè¯­æ³ï¼\n\ndb.collection.getIndexes()\n\n\n1\n\n\næç¤ºï¼è¯¥è¯­æ³å½ä»¤è¿è¡è¦æ±æ¯ MongoDB 3.0+\n\nãç¤ºä¾ã\n\næ¥çcommentéåä¸­ææçç´¢å¼æåµ\n\n> db.comment.getIndexes()\n[\n   {\n        "v" : 2,\n        "key" : {\n            "_id" : 1\n       },\n        "name" : "_id_",\n        "ns" : "articledb.comment"\n   }\n]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nç»æä¸­æ¾ç¤ºçæ¯é»è®¤ _id ç´¢å¼ã\n\né»è®¤_idç´¢å¼ï¼\n\nMongoDBå¨åå»ºéåçè¿ç¨ä¸­ï¼å¨_id å­æ®µä¸åå»ºä¸ä¸ªå¯ä¸çç´¢å¼ï¼é»è®¤åå­ä¸º_id_ï¼è¯¥ç´¢å¼å¯é²æ­¢å®¢æ·ç«¯æå¥ä¸¤ä¸ªå·æç¸åå¼çææ¡£ï¼æ¨ä¸è½å¨_idå­æ®µä¸å é¤æ­¤ç´¢å¼ã\n\næ³¨æï¼è¯¥ç´¢å¼æ¯å¯ä¸ç´¢å¼ï¼å æ­¤å¼ä¸è½éå¤ï¼å³ _id å¼ä¸è½éå¤çãå¨åçéç¾¤ä¸­ï¼éå¸¸ä½¿ç¨ _id ä½ä¸ºçé®ã\n\n\n# 4.3.2 ç´¢å¼çåå»º\n\nè¯´æï¼å¨éåä¸åå»ºç´¢å¼ã\n\nè¯­æ³ï¼\n\ndb.collection.createIndex(keys, options)\n\n\n1\n\n\nåæ°ï¼\n\nPARAMETER   TYPE       DESCRIPTION\nkeys        document   åå«å­æ®µåå¼å¯¹çææ¡£ï¼å¶ä¸­å­æ®µæ¯ç´¢å¼é®ï¼å¼æè¿°è¯¥å­æ®µçç´¢å¼ç±»åãå¯¹äºå­æ®µä¸çååºç´¢å¼ï¼è¯·\n                       æå®å¼1ï¼å¯¹äºéåºç´¢å¼ï¼è¯·æå®å¼-1ãæ¯å¦ï¼ { å­æ®µ:1æ-1} ï¼å¶ä¸­1 ä¸ºæå®æååºåå»ºç´¢å¼ï¼å¦æä½ \n                       æ³æéåºæ¥åå»ºç´¢å¼æå®ä¸º -1 å³å¯ãå¦å¤ï¼MongoDBæ¯æå ç§ä¸åçç´¢å¼ç±»åï¼åæ¬ææ¬ãå°çç©º é´ååå¸ç´¢å¼ã\noptions     document   å¯éãåå«ä¸ç»æ§å¶ç´¢å¼åå»ºçéé¡¹çææ¡£ãæå³è¯¦ç»ä¿¡æ¯ï¼è¯·åè§éé¡¹è¯¦æåè¡¨ã\n\noptionsï¼æ´å¤éé¡¹ï¼åè¡¨ï¼\n\nPARAMETER            TYPE            DESCRIPTION\nbackground           Boolean         å»ºç´¢å¼è¿ç¨ä¼é»å¡å¶å®æ°æ®åºæä½ï¼backgroundå¯æå®ä»¥åå°æ¹å¼åå»ºç´¢å¼ï¼å³å¢å  âbackgroundâ\n                                     å¯éåæ°ã âbackgroundâ é»è®¤å¼ä¸ºfalseã\nunique               Boolean         å»ºç«çç´¢å¼æ¯å¦å¯ä¸ãæå®ä¸ºtrueåå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸ºfalse.\nname                 string          ç´¢å¼çåç§°ãå¦ææªæå®ï¼MongoDBçéè¿è¿æ¥ç´¢å¼çå­æ®µååæåºé¡ºåºçæä¸ä¸ªç´¢å¼å ç§°ã\ndropDups             Boolean         3.0+çæ¬å·²åºå¼ãå¨å»ºç«å¯ä¸ç´¢å¼æ¶æ¯å¦å é¤éå¤è®°å½,æå® true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸º false.\nsparse               Boolean         å¯¹ææ¡£ä¸­ä¸å­å¨çå­æ®µæ°æ®ä¸å¯ç¨ç´¢å¼ï¼è¿ä¸ªåæ°éè¦ç¹å«æ³¨æï¼å¦æè®¾ç½®ä¸ºtrueçè¯ï¼å¨ç´¢\n                                     å¼å­æ®µä¸­ä¸ä¼æ¥è¯¢åºä¸åå«å¯¹åºå­æ®µçææ¡£.ãé»è®¤å¼ä¸º false.\nexpireAfterSeconds   integer         æå®ä¸ä¸ªä»¥ç§ä¸ºåä½çæ°å¼ï¼å®æ TTLè®¾å®ï¼è®¾å®éåççå­æ¶é´ã\nv                    index version   ç´¢å¼ççæ¬å·ãé»è®¤çç´¢å¼çæ¬åå³äºmongodåå»ºç´¢å¼æ¶è¿è¡ççæ¬ã\nweights              document        ç´¢å¼æéå¼ï¼æ°å¼å¨ 1 å° 99,999 ä¹é´ï¼è¡¨ç¤ºè¯¥ç´¢å¼ç¸å¯¹äºå¶ä»ç´¢å¼å­æ®µçå¾åæéã\ndefault_language     string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°å³å®äºåç¨è¯åè¯å¹²åè¯å¨çè§åçåè¡¨ã é»è®¤ä¸ºè±è¯­\nlanguage_override    string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°æå®äºåå«å¨ææ¡£ä¸­çå­æ®µåï¼è¯­è¨è¦çé»è®¤çlanguageï¼é»è®¤å¼ä¸º language.\n\næç¤ºï¼ æ³¨æå¨ 3.0.0 çæ¬ååå»ºç´¢å¼æ¹æ³ä¸º db.collection.ensureIndex() ï¼ä¹åççæ¬ä½¿ç¨äº db.collection.createIndex() æ¹æ³ï¼ensureIndex() è¿è½ç¨ï¼ä½åªæ¯ createIndex() çå«åã\n\nãç¤ºä¾ã\n\n# 4.3.2.1 åå­æ®µç´¢å¼\n\nç¤ºä¾ï¼å¯¹ userid å­æ®µå»ºç«ç´¢å¼ï¼\n\ndb.comment.createIndex({userid:1})\n\n\n1\n\n\nåæ° 1ï¼æååºåå»ºç´¢å¼\n\ncompassæ¥çï¼\n\n\n\n# 4.3.2.2 å¤åç´¢å¼\n\nå¯¹ userid å nickname åæ¶å»ºç«å¤åï¼Compoundï¼ç´¢å¼ï¼\n\ndb.comment.createIndex({userid:1,nickname:-1})\n\n\n1\n\n\ncompass ä¸­ï¼\n\n\n\n\n# 4.3.3 ç´¢å¼çç§»é¤\n\nè¯´æï¼å¯ä»¥ç§»é¤æå®çç´¢å¼ï¼æç§»é¤ææç´¢å¼\n\n# 4.3.3.1 æå®ç´¢å¼çç§»é¤\n\nè¯­æ³ï¼\n\ndb.collection.dropIndex(index)\n\n\n1\n\n\nåæ°ï¼\n\nPARAMETER   TYPE                 DESCRIPTION\nindex       string or document   æå®è¦å é¤çç´¢å¼ãå¯ä»¥éè¿ç´¢å¼åç§°æç´¢å¼è§èææ¡£æå®ç´¢å¼ãè¥è¦å é¤ææ¬ç´¢å¼ï¼è¯·æå® ç´¢å¼åç§°ã\n\nãç¤ºä¾ã\n\nå é¤ comment éåä¸­ userid å­æ®µä¸çååºç´¢å¼ï¼\n\ndb.comment.dropIndex({userid:1})\n\n\n1\n\n\n# 4.3.3.2 ææç´¢å¼çç§»é¤\n\nè¯­æ³ï¼\n\ndb.collection.dropIndexes()\n\n\n1\n\n\nãç¤ºä¾ã\n\nå é¤ comment éåä¸­ææç´¢å¼ã\n\ndb.comment.dropIndexes()\n\n\n1\n\n\næç¤ºï¼ _id çå­æ®µçç´¢å¼æ¯æ æ³å é¤çï¼åªè½å é¤é _id å­æ®µçç´¢å¼ã\n\n\n# 4.4 ç´¢å¼çä½¿ç¨\n\n\n# 4.4.1 æ§è¡è®¡å\n\nåææ¥è¯¢æ§è½ï¼Analyze Query Performanceï¼éå¸¸ä½¿ç¨æ§è¡è®¡åï¼è§£éè®¡åãExplain Planï¼æ¥æ¥çæ¥è¯¢çæåµï¼å¦æ¥è¯¢èè´¹çæ¶é´ãæ¯å¦åºäºç´¢å¼æ¥è¯¢ç­ã\n\né£ä¹ï¼éå¸¸ï¼æä»¬æ³ç¥éï¼å»ºç«çç´¢å¼æ¯å¦ææï¼ææå¦ä½ï¼é½éè¦éè¿æ§è¡è®¡åæ¥çã\n\nè¯­æ³ï¼\n\ndb.collection.find(query,options).explain(options)\n\n\n1\n\n\nãç¤ºä¾ã\n\næ¥çæ ¹æ®useridæ¥è¯¢æ°æ®çæåµï¼\n\n> db.comment.find({userid:"1003"}).explain()\n{\n    "queryPlanner" : {\n        "plannerVersion" : 1,\n        "namespace" : "articledb.comment",\n        "indexFilterSet" : false,\n        "parsedQuery" : {\n            "userid" : {\n                "$eq" : "1003"\n            }\n        },\n        "winningPlan" : {\n            "stage" : "COLLSCAN",\n            "filter" : {\n                "userid" : {\n                    "$eq" : "1003"\n                }\n            },\n            "direction" : "forward"\n        },\n        "rejectedPlans" : [ ]\n   },\n   "serverInfo" : {\n       "host" : "9ef3740277ad",\n       "port" : 27017,\n       "version" : "4.0.10",\n       "gitVersion" : "c389e7f69f637f7a1ac3cc9fae843b635f20b766"\n   },\n   "ok" : 1\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nå³é®ç¹çï¼ âstageâ : âCOLLSCANâ, è¡¨ç¤ºå¨éåæ«æ\n\n\n\nä¸é¢å¯¹useridå»ºç«ç´¢å¼\n\ndb.comment.createIndex({userid:1})\n\n\n1\n\n\nåæ¬¡æ¥çæ§è¡è®¡åï¼\n\n> db.comment.find({userid:"1013"}).explain()\n{\n    "queryPlanner" : {\n        "plannerVersion" : 1,\n        "namespace" : "articledb.comment",\n        "indexFilterSet" : false,\n        "parsedQuery" : {\n            "userid" : {\n                "$eq" : "1013"\n            }\n        },\n        "winningPlan" : {\n            "stage" : "FETCH",\n            "inputStage" : {\n                "stage" : "IXSCAN",\n                "keyPattern" : {\n                    "userid" : 1\n                },\n                "indexName" : "userid_1",\n                "isMultiKey" : false,\n                "multiKeyPaths" : {\n                    "userid" : [ ]\n                 },\n                "isUnique" : false,\n                "isSparse" : false,\n                "isPartial" : false,\n                "indexVersion" : 2,\n                "direction" : "forward",\n                "indexBounds" : {\n                    "userid" : [\n                        "[\\"1013\\", \\"1013\\"]"\n                    ]\n                }\n            }\n        },\n        "rejectedPlans" : [ ]\n    },\n    "serverInfo" : {\n        "host" : "9ef3740277ad",\n        "port" : 27017,\n        "version" : "4.0.10",\n        "gitVersion" : "c389e7f69f637f7a1ac3cc9fae843b635f20b766"\n    },\n    "ok" : 1\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\nå³é®ç¹çï¼ âstageâ : âIXSCANâ ,åºäºç´¢å¼çæ«æ\n\ncompassæ¥çï¼\n\n\n\n\n# 4.4.2 æ¶µççæ¥è¯¢\n\nCovered Queries\n\nå½æ¥è¯¢æ¡ä»¶åæ¥è¯¢çæå½±ä»åå«ç´¢å¼å­æ®µæ¶ï¼MongoDBç´æ¥ä»ç´¢å¼è¿åç»æï¼èä¸æ«æä»»ä½ææ¡£æå°ææ¡£å¸¦å¥åå­ã è¿äºè¦ççæ¥è¯¢å¯ä»¥éå¸¸ææã\n\n\n\næ´å¤ï¼https://docs.mongodb.com/manual/core/query-optimization/#read-operations-covered-query\n\nãç¤ºä¾ã\n\n> db.comment.find({userid:"1003"},{userid:1,_id:0})\n{ "userid" : "1003" }\n{ "userid" : "1003" }\n> db.comment.find({userid:"1003"},{userid:1,_id:0}).explain()\n{\n    "queryPlanner" : {\n        "plannerVersion" : 1,\n        "namespace" : "articledb.comment",\n        "indexFilterSet" : false,\n        "parsedQuery" : {\n            "userid" : {\n                "$eq" : "1003"\n            }\n        },\n        "winningPlan" : {\n            "stage" : "PROJECTION",\n            "transformBy" : {\n                "userid" : 1,\n                "_id" : 0\n            },\n            "inputStage" : {\n                "stage" : "IXSCAN",\n                "keyPattern" : {\n                    "userid" : 1\n                },\n                "indexName" : "userid_1",\n                "isMultiKey" : false,\n                "multiKeyPaths" : {\n                    "userid" : [ ]\n                },\n                "isUnique" : false,\n                "isSparse" : false,\n                "isPartial" : false,\n                "indexVersion" : 2,\n                "direction" : "forward",\n                "indexBounds" : {\n                    "userid" : [\n                        "[\\"1003\\", \\"1003\\"]"\n                    ]\n                }\n            }\n        },\n        "rejectedPlans" : [ ]\n    },\n    "serverInfo" : {\n        "host" : "bobohost.localdomain",\n        "port" : 27017,\n        "version" : "4.0.10",\n        "gitVersion" : "c389e7f69f637f7a1ac3cc9fae843b635f20b766"\n    },\n    "ok" : 1\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n\n\nCompass ä¸­ï¼\n\n\n\n\n# 5. æç« è¯è®º\n\n\n# 5.1 éæ±åæ\n\næå¤´æ¡çæç« è¯è®ºä¸å¡å¦ä¸ï¼\n\n\n\næç« ç¤ºä¾åèï¼æ©æ¨ç©ºè¹åæ°´ï¼æ¯å¯¹è¿æ¯éï¼ https://www.toutiao.com/a6721476546088927748/\n\néè¦å®ç°ä»¥ä¸åè½ï¼\n\n * åºæ¬å¢å æ¹æ¥API\n * æ ¹æ®æç« idæ¥è¯¢è¯è®º\n * è¯è®ºç¹èµ\n\n\n# 5.2 è¡¨ç»æåæ\n\næ°æ®åºï¼articledb\n\nä¸æ æç« è¯è®º           COMMENT                     \nå­æ®µåç§°             å­æ®µå«ä¹      å­æ®µç±»å              å¤æ³¨\n_id              ID        ObjectIdæString   Mongoçä¸»é®çå­æ®µ\narticleid        æç« ID      String            \ncontent          è¯è®ºåå®¹      String            \nuserid           è¯è®ºäººID     String            \nnickname         è¯è®ºäººæµç§°     String            \ncreatedatetime   è¯è®ºçæ¥ææ¶é´   Date              \nlikenum          ç¹èµæ°       Int32             \nreplynum         åå¤æ°       Int32             \nstate            ç¶æ        String            0ï¼ä¸å¯è§ï¼1ï¼å¯è§ï¼\nparentid         ä¸çº§ID      String            å¦æä¸º0è¡¨ç¤ºæç« çé¡¶çº§è¯è®º\n\n\n# 5.3 ææ¯éå\n\n\n# 5.3.1 mongodb-driver\n\nmongodb-driveræ¯mongoå®æ¹æ¨åºçjavaè¿æ¥mongoDBçé©±å¨åï¼ç¸å½äºJDBCé©±å¨ãæä»¬éè¿ä¸ä¸ªå¥é¨çæ¡ä¾æ¥äºè§£mongodb-driverçåºæ¬ä½¿ç¨ã\n\nå®æ¹é©±å¨è¯´æåä¸è½½ï¼ http://mongodb.github.io/mongo-java-driver/\n\nå®æ¹é©±å¨ç¤ºä¾ææ¡£ï¼http://mongodb.github.io/mongo-java-driver/3.8/driver/getting-started/quick-start/\n\n\n# 5.3.2 SpringDataMongoDB\n\nSpringDataå®¶ææåä¹ä¸ï¼ç¨äºæä½MongoDBçæä¹å±æ¡æ¶ï¼å°è£äºåºå±çmongodb-driverã\n\nå®ç½ä¸»é¡µï¼ https://projects.spring.io/spring-data-mongodb/\n\næä»¬åæ¬¡æ¹é¡¹ç®çåæ§½å¾®æå¡å°±éç¨SpringDataMongoDBæ¡æ¶ã\n\n\n# 5.4 æç« å¾®æå¡æ¨¡åæ­å»º\n\nï¼1ï¼æ­å»ºé¡¹ç®å·¥ç¨articleï¼pom.xmlå¼å¥ä¾èµï¼\n\n<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.1.6.RELEASE</version>\n        <relativePath/>\n    </parent>\n    <groupId>com.wgy</groupId>\n    <artifactId>article</artifactId>\n    <version>1.0-SNAPSHOT</version>\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-data-mongodb</artifactId>\n        </dependency>\n    </dependencies>\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\nï¼ 2ï¼åå»ºapplication.yml\n\nspring:\n  #æ°æ®æºéç½®\n  data:\n    mongodb:\n      # ä¸»æºå°å\n      #host: 192.168.142.128\n      # æ°æ®åº\n      #database: articledb\n      # é»è®¤ç«¯å£æ¯27017\n      #port: 27017\n      #ä¹å¯ä»¥ä½¿ç¨uriè¿æ¥\n      uri: mongodb://192.168.142.128:27017/articledb\nserver:\n  # ç«¯å£\n  port: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nï¼ 3ï¼åå»ºå¯å¨ç±»\n\npackage com.wgy;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n/**\n * å¯å¨ç±»\n *\n * @author wgy\n */\n@SpringBootApplication\npublic class ArticleApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(ArticleApplication.class, args);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nï¼4ï¼å¯å¨é¡¹ç®ï¼çæ¯å¦è½æ­£å¸¸å¯å¨ï¼æ§å¶å°æ²¡æéè¯¯ã\n\n\n# 5.5 æç« è¯è®ºå®ä½ç±»çç¼å\n\nåå»ºå®ä½ç±» åå»ºåcom.wgy.articleï¼åä¸å»ºåpoç¨äºå­æ¾å®ä½ç±»ï¼åå»ºå®ä½ç±»\n\n/**\n * è¯è®ºå®ä½ç±»\n *\n * @author wgy\n */\n//æä¸ä¸ªjavaç±»å£°æä¸ºmongodbçææ¡£ï¼å¯ä»¥éè¿collectionåæ°æå®è¿ä¸ªç±»å¯¹åºçææ¡£ã\n//@Document(collection="mongodb å¯¹åº collection å")\n// è¥æªå  @Document ï¼è¯¥ bean save å° mongo ç comment collection\n// è¥æ·»å  @Document ï¼å save å° comment collection\n@Document(collection = "comment")//å¯ä»¥çç¥ï¼å¦æçç¥ï¼åé»è®¤ä½¿ç¨ç±»åå°åæ å°éå\n//å¤åç´¢å¼\n// @CompoundIndex( def = "{\'userid\': 1, \'nickname\': -1}")\npublic class Comment implements Serializable {\n\n    //ä¸»é®æ è¯ï¼è¯¥å±æ§çå¼ä¼èªå¨å¯¹åºmongodbçä¸»é®å­æ®µ"_id"ï¼å¦æè¯¥å±æ§åå°±å«âidâ,åè¯¥æ³¨è§£å¯ä»¥çç¥ï¼å¦åå¿é¡»å\n    @Id\n    private String id;//ä¸»é®    //è¯¥å±æ§å¯¹åºmongodbçå­æ®µçåå­ï¼å¦æä¸è´ï¼åæ éè¯¥æ³¨è§£\n    @Field("content")\n    private String content;//åæ§½åå®¹\n    private Date publishtime;//åå¸æ¥æ    //æ·»å äºä¸ä¸ªåå­æ®µçç´¢å¼\n    @Indexed\n    private String userid;//åå¸äººID\n    private String nickname;//æµç§°\n    private LocalDateTime createdatetime;//è¯è®ºçæ¥ææ¶é´\n    private Integer likenum;//ç¹èµæ°\n    private Integer replynum;//åå¤æ°\n    private String state;//ç¶æ\n    private String parentid;//ä¸çº§ID\n    private String articleid;\n\n    //set/get/toString...\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\nè¯´æï¼\n\nç´¢å¼å¯ä»¥å¤§å¤§æåæ¥è¯¢æçï¼ä¸è¬å¨æ¥è¯¢å­æ®µä¸æ·»å ç´¢å¼ï¼ç´¢å¼çæ·»å å¯ä»¥éè¿Mongoçå½ä»¤æ¥æ·»å ï¼ä¹å¯ä»¥å¨Javaçå®ä½ç±»ä¸­éè¿æ³¨è§£æ·»å ã\n\n1ï¼åå­æ®µç´¢å¼æ³¨è§£@Indexed\n\norg.springframework.data.mongodb.core.index.Indexed.class\n\nå£°æè¯¥å­æ®µéè¦ç´¢å¼ï¼å»ºç´¢å¼å¯ä»¥å¤§å¤§çæé«æ¥è¯¢æçã\n\nMongoå½ä»¤åèï¼\n\ndb.comment.createIndex({"userid":1})\n\n\n1\n\n\n2 ï¼å¤åç´¢å¼æ³¨è§£@CompoundIndex\n\norg.springframework.data.mongodb.core.index.CompoundIndex.class\n\nå¤åç´¢å¼çå£°æï¼å»ºå¤åç´¢å¼å¯ä»¥ææå°æé«å¤å­æ®µçæ¥è¯¢æçã\n\nMongoå½ä»¤åèï¼\n\ndb.comment.createIndex({"userid":1,"nickname":-1})\n\n\n1\n\n\n\n# 5.6 æç« è¯è®ºçåºæ¬å¢å æ¹æ¥\n\nï¼1ï¼åå»ºæ°æ®è®¿é®æ¥å£ com.wgy.articleåä¸åå»ºdaoåï¼åä¸åå»ºæ¥å£\n\n/**\n * è¯è®ºçæä¹å±æ¥å£\n *\n * @author wgy\n */\npublic interface CommentRepository extends MongoRepository<Comment, String> {\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nï¼ 2ï¼åå»ºä¸å¡é»è¾ç±» com.wgy.articleåä¸åå»ºserviceåï¼åä¸åå»ºç±»\n\n/**\n * è¯è®ºçä¸å¡å±\n *\n * @author wgy\n */\n@Service\npublic class CommentService {\n\n    //æ³¨å¥dao\n    @Autowired\n    private CommentRepository commentRepository;\n\n    /**\n     * ä¿å­ä¸ä¸ªè¯è®º\n     *\n     * @param comment\n     */\n    public void saveComment(Comment comment) {\n        //å¦æéè¦èªå®ä¹ä¸»é®ï¼å¯ä»¥å¨è¿éæå®ä¸»é®ï¼å¦æä¸æå®ä¸»é®ï¼MongoDBä¼èªå¨çæä¸»é®\n        //è®¾ç½®ä¸äºé»è®¤åå§å¼ããã\n        //è°ç¨dao\n        commentRepository.save(comment);\n    }\n\n    /**\n     * æ´æ°è¯è®º\n     *\n     * @param comment\n     */\n    public void updateComment(Comment comment) {\n        //è°ç¨dao\n        commentRepository.save(comment);\n    }\n\n    /**\n     * æ ¹æ®idå é¤è¯è®º\n     *\n     * @param id\n     */\n    public void deleteCommentById(String id) {\n        //è°ç¨dao\n        commentRepository.deleteById(id);\n    }\n\n    /**\n     * æ¥è¯¢ææè¯è®º\n     *\n     * @return\n     */\n    public List<Comment> findCommentList() {\n        //è°ç¨dao\n        return commentRepository.findAll();\n    }\n\n    /**\n     * æ ¹æ®idæ¥è¯¢è¯è®º\n     *\n     * @param id\n     * @return\n     */\n    public Comment findCommentById(String id) {\n        //è°ç¨dao\n        return commentRepository.findById(id).get();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n\n\nï¼ 3ï¼æ°å»ºJunitæµè¯ç±»ï¼æµè¯ä¿å­åæ¥è¯¢ææï¼\n\n/**\n * è¯è®ºæµè¯ç±»\n *\n * @author wgy\n */\n@RunWith(SpringRunner.class)\n@SpringBootTest\npublic class CommentServiceTest {\n\n    @Autowired\n    private CommentService commentService;\n\n    /**\n     * æ¥è¯¢æææ°æ®\n     */\n    @Test\n    public void testFindCommentList() {\n        List<Comment> commentList = commentService.findCommentList();\n        System.out.println(commentList);\n    }\n\n    /**\n     * æµè¯æ ¹æ®idæ¥è¯¢\n     */\n    @Test\n    public void testFindCommentById() {\n        Comment commentById = commentService.findCommentById("1");\n        System.out.println(commentById);\n    }\n\n    /**\n     * ä¿å­ä¸ä¸ªè¯è®º\n     */\n    @Test\n    public void testSaveComment() {\n        Comment comment = new Comment();\n        comment.setArticleid("100000");\n        comment.setContent("æµè¯æ·»å çæ°æ®");\n        comment.setCreatedatetime(LocalDateTime.now());\n        comment.setUserid("1003");\n        comment.setNickname("å¯æå¤§å¸");\n        comment.setState("1");\n        comment.setLikenum(0);\n        comment.setReplynum(0);\n        commentService.saveComment(comment);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n\n# 5.7 æ ¹æ®ä¸çº§IDæ¥è¯¢æç« è¯è®ºçåé¡µåè¡¨\n\nï¼1ï¼CommentRepositoryæ°å¢æ¹æ³å®ä¹\n\n/**\n * æ ¹æ®ç¶idï¼æ¥è¯¢å­è¯è®ºçåé¡µåè¡¨\n *\n * @param parentid\n * @param pageable\n * @return\n */\nPage<Comment> findByParentid(String parentid, Pageable pageable);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nï¼2ï¼CommentServiceæ°å¢æ¹æ³\n\n/**\n * æ ¹æ®ç¶idæ¥è¯¢åé¡µåè¡¨\n *\n * @param parentid\n * @param page\n * @param size\n * @return\n */\npublic Page<Comment> findCommentListByParentid(String parentid, int page, int size) {\n    return commentRepository.findByParentid(parentid, PageRequest.of(page - 1, size));\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nï¼3ï¼junitæµè¯ç¨ä¾ï¼\n\n/**\n * æµè¯æ ¹æ®ç¶idæ¥è¯¢å­è¯è®ºçåé¡µåè¡¨\n */\n@Test\npublic void testFindCommentListByParentid() {\n    Page<Comment> pageResponse = commentService.findCommentListByParentid("3", 1, 2);\n    System.out.println("----æ»è®°å½æ°ï¼" + pageResponse.getTotalElements());\n    System.out.println("----å½åé¡µæ°æ®ï¼" + pageResponse.getContent());\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nï¼4ï¼æµè¯\n\nä½¿ç¨compasså¿«éæå¥ä¸æ¡æµè¯æ°æ®ï¼æ°æ®çåå®¹æ¯å¯¹3å·è¯è®ºåå®¹è¿è¡è¯è®ºã\n\n\n\næ§è¡æµè¯ï¼ç»æï¼\n\n----æ»è®°å½æ°ï¼1\n----å½åé¡µæ°æ®ï¼[Comment{id=\'33\', content=\'ä½ å¹´è½»ï¼ç«åå¤§\', publishtime=null, userid=\'1003\', nickname=\'å¯æå¤§å¸\',createdatetime=null, likenum=null, replynum=null, state=\'null\', parentid=\'3\', articleid=\'100001\'}]\n\n\n1\n2\n\n\n\n# 5.8 MongoTemplate å®ç°è¯è®ºç¹èµ\n\næä»¬çä¸ä¸ä»¥ä¸ç¹èµçä¸´æ¶ç¤ºä¾ä»£ç ï¼ CommentService æ°å¢updateThumbupæ¹æ³\n\n/**\n * ç¹èµ-æçä½\n * @param id\n */\npublic void updateCommentThumbupToIncrementingOld(String id){\n    Comment comment = CommentRepository.findById(id).get();\n    comment.setLikenum(comment.getLikenum()+1);\n    CommentRepository.save(comment);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nä»¥ä¸æ¹æ³è½ç¶å®ç°èµ·æ¥æ¯è¾ç®åï¼ä½æ¯æ§è¡æçå¹¶ä¸é«ï¼å ä¸ºæåªéè¦å°ç¹èµæ°å  1å°±å¯ä»¥äºï¼æ²¡å¿è¦æ¥è¯¢åºææå­æ®µä¿®æ¹ååæ´æ°ææå­æ®µã(è´è¶æåº)\n\næä»¬å¯ä»¥ä½¿ç¨MongoTemplateç±»æ¥å®ç°å¯¹æåçæä½ã ï¼1ï¼ä¿®æ¹CommentService\n\n//æ³¨å¥MongoTemplate\n@Autowired\nprivate MongoTemplate mongoTemplate;\n\n/**\n * ç¹èµæ°+1\n *\n * @param id\n */\npublic void updateCommentLikenum(String id) {\n\n    //  æ¥è¯¢æ¡ä»¶\n    Query query = Query.query(Criteria.where("_id").is(id));\n    //  æ´æ°æ¡ä»¶\n    Update update = new Update();\n    //å±é¨æ´æ°ï¼ç¸å½äº$set\n//        update.set(key, value)\n    //éå¢$inc\n    update.inc("likenum");\n    //åæ°3ï¼éåçåå­æå®ä½ç±»çç±»åComment.class\n    mongoTemplate.updateFirst(query, update, Comment.class);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nï¼ 2ï¼æµè¯ç¨ä¾ï¼\n\n/**\n * æµè¯ç¹èµæ°+1\n */\n@Test\npublic void testUpdateCommentLikenum() {\n    commentService.updateCommentLikenum("3");\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næ§è¡æµè¯ç¨ä¾åï¼åç°ç¹èµæ°+1äºï¼\n\n\n\nåæé¾æ¥ï¼https://wgy1993.gitee.io/archives/d69f1e.html',normalizedContent:'# 1. mongodb ç¸å³æ¦å¿µ\n\n\n# 1.1 ä¸å¡åºç¨åºæ¯\n\nä¼ ç»çå³ç³»åæ°æ®åºï¼å¦mysqlï¼ï¼å¨æ°æ®æä½çâä¸é«âéæ±ä»¥ååºå¯¹web2.0çç½ç«éæ±é¢åï¼æ¾å¾åä¸ä»å¿ã\n\nè§£éï¼âä¸é«âéæ±ï¼\n\n * high performance - å¯¹æ°æ®åºé«å¹¶åè¯»åçéæ±ã\n * huge storage - å¯¹æµ·éæ°æ®çé«æçå­å¨åè®¿é®çéæ±ã\n * high scalability && high availability- å¯¹æ°æ®åºçé«å¯æ©å±æ§åé«å¯ç¨æ§çéæ±ã\n\nèmongodbå¯åºå¯¹âä¸é«âéæ±ã\n\nå·ä½çåºç¨åºæ¯å¦ï¼\n\n * ç¤¾äº¤åºæ¯ï¼ä½¿ç¨ mongodb å­å¨å­å¨ç¨æ·ä¿¡æ¯ï¼ä»¥åç¨æ·åè¡¨çæååä¿¡æ¯ï¼éè¿å°çä½ç½®ç´¢å¼å®ç°éè¿çäººãå°ç¹ç­åè½ã\n * æ¸¸æåºæ¯ï¼ä½¿ç¨ mongodb å­å¨æ¸¸æç¨æ·ä¿¡æ¯ï¼ç¨æ·çè£å¤ãç§¯åç­ç´æ¥ä»¥ååµææ¡£çå½¢å¼å­å¨ï¼æ¹ä¾¿æ¥è¯¢ãé«æçå­å¨åè®¿é®ã\n * ç©æµåºæ¯ï¼ä½¿ç¨ mongodb å­å¨è®¢åä¿¡æ¯ï¼è®¢åç¶æå¨è¿éè¿ç¨ä¸­ä¼ä¸æ­æ´æ°ï¼ä»¥ mongodb ååµæ°ç»çå½¢å¼æ¥å­å¨ï¼ä¸æ¬¡æ¥è¯¢å°±è½å°è®¢åææçåæ´è¯»ååºæ¥ã\n * ç©èç½åºæ¯ï¼ä½¿ç¨ mongodb å­å¨æææ¥å¥çæºè½è®¾å¤ä¿¡æ¯ï¼ä»¥åè®¾å¤æ±æ¥çæ¥å¿ä¿¡æ¯ï¼å¹¶å¯¹è¿äºä¿¡æ¯è¿è¡å¤ç»´åº¦çåæã\n * è§é¢ç´æ­ï¼ä½¿ç¨ mongodb å­å¨ç¨æ·ä¿¡æ¯ãç¹èµäºå¨ä¿¡æ¯ç­ã\n\nè¿äºåºç¨åºæ¯ä¸­ï¼æ°æ®æä½æ¹é¢çå±åç¹ç¹æ¯ï¼\n\n * æ°æ®éå¤§\n * åå¥æä½é¢ç¹ï¼è¯»åé½å¾é¢ç¹ï¼\n * ä»·å¼è¾ä½çæ°æ®ï¼å¯¹äºå¡æ§è¦æ±ä¸é«\n\nå¯¹äºè¿æ ·çæ°æ®ï¼æä»¬æ´éåä½¿ç¨mongodbæ¥å®ç°æ°æ®çå­å¨ã\n\nä»ä¹æ¶åéæ©mongodb\n\nå¨æ¶æéåä¸ï¼é¤äºä¸è¿°çä¸ä¸ªç¹ç¹å¤ï¼å¦æä½ è¿ç¹è±«æ¯å¦è¦éæ©å®ï¼å¯ä»¥èèä»¥ä¸çä¸äºé®é¢ï¼\n\n * åºç¨ä¸éè¦äºå¡åå¤æ join æ¯æ\n * æ°åºç¨ï¼éæ±ä¼åï¼æ°æ®æ¨¡åæ æ³ç¡®å®ï¼æ³å¿«éè¿­ä»£å¼å\n * åºç¨éè¦2000-3000ä»¥ä¸çè¯»åqpsï¼æ´é«ä¹å¯ä»¥ï¼\n * åºç¨éè¦tbçè³ pb çº§å«æ°æ®å­å¨\n * åºç¨åå±è¿éï¼éè¦è½å¿«éæ°´å¹³æ©å±\n * åºç¨è¦æ±å­å¨çæ°æ®ä¸ä¸¢å¤±\n * åºç¨éè¦99.999%é«å¯ç¨\n * åºç¨éè¦å¤§éçå°çä½ç½®æ¥è¯¢ãææ¬æ¥è¯¢\n\nå¦æä¸è¿°æ1ä¸ªç¬¦åï¼å¯ä»¥èè mongodbï¼2ä¸ªåä»¥ä¸çç¬¦åï¼éæ© mongodb ç»ä¸ä¼åæã\n\n\n# 1.2 mongodb ç®ä»\n\nmongodbæ¯ä¸ä¸ªå¼æºãé«æ§è½ãæ æ¨¡å¼çææ¡£åæ°æ®åºï¼å½åçè®¾è®¡å°±æ¯ç¨äºç®åå¼ååæ¹ä¾¿æ©å±ï¼æ¯nosqlæ°æ®åºäº§åä¸­çä¸ç§ãæ¯æåå³ç³»åæ°æ®åºï¼mysqlï¼çéå³ç³»åæ°æ®åºã\n\nå®æ¯æçæ°æ®ç»æéå¸¸æ¾æ£ï¼æ¯ä¸ç§ç±»ä¼¼äº json ç æ ¼å¼å«bsonï¼æä»¥å®æ¢å¯ä»¥å­å¨æ¯è¾å¤æçæ°æ®ç±»åï¼åç¸å½ççµæ´»ã\n\nmongodbä¸­çè®°å½æ¯ä¸ä¸ªææ¡£ï¼å®æ¯ä¸ä¸ªç±å­æ®µåå¼å¯¹ï¼field:valueï¼ç»æçæ°æ®ç»æãmongodbææ¡£ç±»ä¼¼äºjsonå¯¹è±¡ï¼å³ä¸ä¸ªææ¡£è®¤ä¸ºå°±æ¯ä¸ä¸ªå¯¹è±¡ãå­æ®µçæ°æ®ç±»åæ¯å­ç¬¦åï¼å®çå¼é¤äºä½¿ç¨åºæ¬çä¸äºç±»åå¤ï¼è¿å¯ä»¥åæ¬å¶ä»ææ¡£ãæ®éæ°ç»åææ¡£æ°ç»ã\n\n\n# 1.3 ä½ç³»ç»æ\n\nmysqlåmongodbå¯¹æ¯\n\n\n\nsql æ¯è¯­/æ¦å¿µ     mongodbæ¯è¯­/æ¦å¿µ   è§£é/è¯´æ\ndatabase      database       æ°æ®åº\ntable         collection     æ°æ®åºè¡¨/éå\nrow           document       æ°æ®è®°å½è¡/ææ¡£\ncolumn        field          æ°æ®å­æ®µ/å\nindex         index          ç´¢å¼\ntable joins                  è¡¨è¿æ¥,mongodbä¸æ¯æ\n              åµå¥ææ¡£           mongodbéè¿åµå¥å¼ææ¡£æ¥æ¿ä»£å¤è¡¨è¿æ¥\nprimary key   primary key    ä¸»é®,mongodbèªå¨å°_idå­æ®µè®¾ç½®ä¸ºä¸»é®\n\n\n# 1.4 æ°æ®æ¨¡å\n\nmongodbçæå°å­å¨åä½å°±æ¯ææ¡£(document)å¯¹è±¡ãææ¡£(document)å¯¹è±¡å¯¹åºäºå³ç³»åæ°æ®åºçè¡ãæ°æ®å¨mongodbä¸­ä»¥bsonï¼binary-jsonï¼ææ¡£çæ ¼å¼å­å¨å¨ç£çä¸ã\n\nbsonï¼binary serialized document formatï¼æ¯ä¸ç§ç±»jsonçä¸ç§äºè¿å¶å½¢å¼çå­å¨æ ¼å¼ï¼ç®ç§°binary jsonãbsonåjsonä¸æ ·ï¼æ¯æååµçææ¡£å¯¹è±¡åæ°ç»å¯¹è±¡ï¼ä½æ¯bsonæjsonæ²¡æçä¸äºæ°æ®ç±»åï¼å¦dateåbindataç±»åã\n\nbsonéç¨äºç±»ä¼¼äº c è¯­è¨ç»æä½çåç§°ãå¯¹è¡¨ç¤ºæ¹æ³ï¼æ¯æååµçææ¡£å¯¹è±¡åæ°ç»å¯¹è±¡ï¼å·æè½»éæ§ãå¯éåæ§ãé«ææ§çä¸ä¸ªç¹ç¹ï¼å¯ä»¥æææè¿°éç»æåæ°æ®åç»æåæ°æ®ãè¿ç§æ ¼å¼çä¼ç¹æ¯çµæ´»æ§é«ï¼ä½å®çç¼ºç¹æ¯ç©ºé´å©ç¨çä¸æ¯å¾çæ³ã\n\nbsonä¸­ï¼é¤äºåºæ¬çjsonç±»åï¼string,integer,boolean,double,null,arrayåobjectï¼mongoè¿ä½¿ç¨äºç¹æ®çæ°æ®ç±»åãè¿äºç±»ååæ¬date,object id,binary data,regular expression åcodeãæ¯ä¸ä¸ªé©±å¨é½ä»¥ç¹å®è¯­è¨çæ¹å¼å®ç°äºè¿äºç±»åï¼æ¥çä½ çé©±å¨çææ¡£æ¥è·åè¯¦ç»ä¿¡æ¯ã\n\nbsonæ°æ®ç±»ååèåè¡¨ï¼\n\næ°æ®ç±»å        æè¿°                                         ä¸¾ä¾\nå­ç¬¦ä¸²         utf-8å­ç¬¦ä¸²é½å¯è¡¨ç¤ºä¸ºå­ç¬¦ä¸²ç±»åçæ°æ®                      {âxâ : âfoobarâ}\nå¯¹è±¡id        å¯¹è±¡idæ¯ææ¡£ç12å­èçå¯ä¸ id                         {âxâ :objectid() }\nå¸å°å¼         çæèåï¼trueæèfalse                           {âxâ:true}\næ°ç»          å¼çéåæèåè¡¨å¯ä»¥è¡¨ç¤ºææ°ç»                            {âxâ ï¼ [âaâ, âbâ, âcâ]}\n32ä½æ´æ°       ç±»åä¸å¯ç¨ãjavascriptä»æ¯æ64ä½æµ®ç¹æ°ï¼æä»¥32ä½æ´æ°ä¼è¢«èªå¨è½¬æ¢ã   shellæ¯ä¸æ¯æè¯¥ç±»åçï¼shellä¸­é»è®¤ä¼è½¬æ¢æ64ä½æµ®ç¹æ°\n64ä½æ´æ°       ä¸æ¯æè¿ä¸ªç±»åãshellä¼ä½¿ç¨ä¸ä¸ªç¹æ®çååµææ¡£æ¥æ¾ç¤º64ä½æ´æ°          shellæ¯ä¸æ¯æè¯¥ç±»åçï¼shellä¸­é»è®¤ä¼è½¬æ¢æ64ä½æµ®ç¹æ°\n64ä½æµ®ç¹æ°      shellä¸­çæ°å­å°±æ¯è¿ä¸ç§ç±»å                           {âxâï¼3.14159ï¼âyâï¼3}\nnull        è¡¨ç¤ºç©ºå¼æèæªå®ä¹çå¯¹è±¡                               {âxâ:null}\nundefined   ææ¡£ä¸­ä¹å¯ä»¥ä½¿ç¨æªå®ä¹ç±»å                              {âxâ:undefined}\nç¬¦å·          shellä¸æ¯æï¼shellä¼å°æ°æ®åºä¸­çç¬¦å·ç±»åçæ°æ®èªå¨è½¬æ¢æå­ç¬¦ä¸²       \næ­£åè¡¨è¾¾å¼       ææ¡£ä¸­å¯ä»¥åå«æ­£åè¡¨è¾¾å¼ï¼éç¨javascriptçæ­£åè¡¨è¾¾å¼è¯­æ³          {âxâ ï¼ /foobar/i}\nä»£ç           ææ¡£ä¸­è¿å¯ä»¥åå«javascriptä»£ç                        {âxâ ï¼ function() { /* â¦â¦ */ }}\näºè¿å¶æ°æ®       äºè¿å¶æ°æ®å¯ä»¥ç±ä»»æå­èçä¸²ç»æï¼ä¸è¿shellä¸­æ æ³ä½¿ç¨              \næå¤§å¼/æå°å¼     bsonåæ¬ä¸ä¸ªç¹æ®ç±»åï¼è¡¨ç¤ºå¯è½çæå¤§å¼ãshellä¸­æ²¡æè¿ä¸ªç±»åã        \n\næç¤ºï¼\n\nshellé»è®¤ä½¿ç¨64ä½æµ®ç¹åæ°å¼ã{âxâï¼3.14}æ{âxâï¼3}ãå¯¹äºæ´åå¼ï¼å¯ä»¥ä½¿ç¨numberintï¼4å­èç¬¦å·æ´æ°ï¼ænumberlongï¼8å­èç¬¦å·æ´æ°ï¼ï¼{âxâ:numberint(â3â)}{âxâ:numberlong(â3â)}\n\n\n# 1.5 mongodb çç¹ç¹\n\nmongodbä¸»è¦æå¦ä¸ç¹ç¹ï¼\n\n * é«æ§è½ï¼\n   \n   mongodbæä¾é«æ§è½çæ°æ®æä¹æ§ãç¹å«æ¯\n   \n   å¯¹åµå¥å¼æ°æ®æ¨¡åçæ¯æåå°äºæ°æ®åºç³»ç»ä¸çi/oæ´»å¨ã\n   \n   ç´¢å¼æ¯ææ´å¿«çæ¥è¯¢ï¼å¹¶ä¸å¯ä»¥åå«æ¥èªåµå¥å¼ææ¡£åæ°ç»çé®ãï¼ææ¬ç´¢å¼è§£å³æç´¢çéæ±ãttlç´¢å¼è§£å³åå²æ°æ®èªå¨è¿æçéæ±ãå°çä½ç½®ç´¢å¼å¯ç¨äºæå»ºåç§ o2o åºç¨ï¼\n   \n   mmapv1ãwiredtigerãmongorocksï¼rocksdbï¼ãin-memory ç­å¤å¼ææ¯ææ»¡è¶³åç§åºæ¯éæ±ã\n   \n   gridfsè§£å³æä»¶å­å¨çéæ±ã\n\n * é«å¯ç¨æ§ï¼\n   \n   mongodbçå¤å¶å·¥å·ç§°ä¸ºå¯æ¬éï¼replica setï¼ï¼å®å¯æä¾èªå¨æéè½¬ç§»åæ°æ®åä½ã\n\n * é«æ©å±æ§ï¼\n   \n   mongodbæä¾äºæ°´å¹³å¯æ©å±æ§ä½ä¸ºå¶æ ¸å¿åè½çä¸é¨åã\n   \n   åçå°æ°æ®åå¸å¨ä¸ç»éç¾¤çæºå¨ä¸ãï¼æµ·éæ°æ®å­å¨ï¼æå¡è½åæ°´å¹³æ©å±ï¼\n   \n   ä»3.4å¼å§ï¼mongodbæ¯æåºäºçé®åå»ºæ°æ®åºåãå¨ä¸ä¸ªå¹³è¡¡çéç¾¤ä¸­ï¼mongodbå°ä¸ä¸ªåºåæè¦ççè¯»ååªå®åå°è¯¥åºååçé£äºçã\n\n * ä¸°å¯çæ¥è¯¢æ¯æï¼\n   \n   mongodbæ¯æä¸°å¯çæ¥è¯¢è¯­è¨ï¼æ¯æè¯»ååæä½(crud)ï¼æ¯å¦æ°æ®èåãææ¬æç´¢åå°çç©ºé´æ¥è¯¢ç­ã\n\n * å¶ä»ç¹ç¹ï¼å¦æ æ¨¡å¼ï¼å¨ææ¨¡å¼ï¼ãçµæ´»çææ¡£æ¨¡åã\n\n\n# 2. åæºé¨ç½²\n\n\n# 2.1 windows ç³»ç»ä¸­çå®è£å¯å¨\n\n\n# 2.1.1 ä¸è½½å®è£å\n\nmongodb æä¾äºå¯ç¨äº 32 ä½å 64 ä½ç³»ç»çé¢ç¼è¯äºè¿å¶åï¼ä½ å¯ä»¥ä»mongodbå®ç½ä¸è½½å®è£ï¼mongodb é¢ç¼è¯äºè¿å¶åä¸å°åï¼https://www.mongodb.com/download-center#community\n\n\n\næ ¹æ®ä¸å¾æç¤ºä¸è½½ zip åã\n\næç¤ºï¼çæ¬çéæ©ï¼\n\nmongodbççæ¬å½åè§èå¦ï¼x.y.zï¼\n\nyä¸ºå¥æ°æ¶è¡¨ç¤ºå½åçæ¬ä¸ºå¼åçï¼å¦ï¼1.5.2ã4.1.13ï¼\n\nyä¸ºå¶æ°æ¶è¡¨ç¤ºå½åçæ¬ä¸ºç¨³å®çï¼å¦ï¼1.6.3ã4.0.10ï¼\n\nzæ¯ä¿®æ­£çæ¬å·ï¼æ°å­è¶å¤§è¶å¥½ã\n\nè¯¦æï¼ http://docs.mongodb.org/manual/release-notes/#release-version-numbers\n\n\n# 2.1.2 è§£åå®è£å¯å¨\n\nå°åç¼©åè§£åå°ä¸ä¸ªç®å½ä¸­ãå¨è§£åç®å½ä¸­ï¼æå¨å»ºç«ä¸ä¸ªç®å½ç¨äºå­æ¾æ°æ®æä»¶ï¼å¦ data/db\n\næ¹å¼1ï¼å½ä»¤è¡åæ°æ¹å¼å¯å¨æå¡\n\nå¨ bin ç®å½ä¸­æå¼å½ä»¤è¡æç¤ºç¬¦ï¼è¾å¥å¦ä¸å½ä»¤ï¼\n\nmongod --dbpath=..\\data\\db\n\n\n1\n\n\næä»¬å¨å¯å¨ä¿¡æ¯ä¸­å¯ä»¥çå°ï¼ mongodbçé»è®¤ç«¯å£æ¯27017ï¼å¦ææä»¬æ³æ¹åé»è®¤çå¯å¨ç«¯å£ï¼å¯ä»¥éè¿âportæ¥æå®ç«¯å£ã\n\nä¸ºäºæ¹ä¾¿æä»¬æ¯æ¬¡å¯å¨ï¼å¯ä»¥å°å®è£ç®å½çbinç®å½è®¾ç½®å°ç¯å¢åéçpathä¸­ï¼ bin ç®å½ä¸æ¯ä¸äºå¸¸ç¨å½ä»¤ï¼æ¯å¦ mongod å¯å¨æå¡ç¨çï¼mongo å®¢æ·ç«¯è¿æ¥æå¡ç¨çã\n\næ¹å¼2ï¼éç½®æä»¶æ¹å¼å¯å¨æå¡\n\nå¨è§£åç®å½ä¸­æ°å»º config æä»¶å¤¹ï¼è¯¥æä»¶å¤¹ä¸­æ°å»ºéç½®æä»¶ mongod.conf ï¼åå¦åèå¦ä¸ï¼\n\nstorage:\n    #the directory where the mongod instance stores its data.default value is "\\data\\db" on windows.\n    dbpath: d:\\mongodb-win32-x86_64-2008plus-ssl-4.0.1\\data\n\n\n1\n2\n3\n\n\nè¯¦ç»éç½®é¡¹åå®¹å¯ä»¥åèå®æ¹ææ¡£ï¼ https://docs.mongodb.com/manual/reference/configuration-options/\n\nãæ³¨æã\n\n * éç½®æä»¶ä¸­å¦æä½¿ç¨åå¼å·ï¼æ¯å¦è·¯å¾å°åï¼èªå¨ä¼å°åå¼å·çåå®¹è½¬ä¹ãå¦æä¸è½¬ä¹ï¼åä¼æ¥éï¼\n   \n   error-parsing-yaml-config-file-yaml-cpp-error-at-line-3-column-15-unknown-escape-character-d\n   \n   \n   1\n   \n   \n   è§£å³ï¼\n   \n   a. å¯¹ \\ æ¢æ / æ \\\n   \n   b. å¦æè·¯å¾ä¸­æ²¡æç©ºæ ¼ï¼åæ éå å¼å·ã\n\n * éç½®æä»¶ä¸­ä¸è½ä»¥tabåå²å­æ®µ\n   \n   è§£å³ï¼\n   \n   å°å¶è½¬æ¢æç©ºæ ¼ã\n\nå¯å¨æ¹å¼ï¼\n\nmongod -f ../config/mongod.conf\næ\nmongod --config ../config/mongod.conf\n\n\n1\n2\n3\n\n\næ´å¤åæ°éç½®ï¼\n\nsystemlog:\n    destination: file\n    #the path of the log file to which mongod or mongos should send all diagnostic logging information\n    path: "d:/mongodb-win32-x86_64-2008plus-ssl-4.0.1/log/mongod.log"\n    logappend: true\nstorage:\n    journal:\n      enabled: true\n    #the directory where the mongod instance stores its data.default value is "/data/db".\n    dbpath: "d:/mongodb-win32-x86_64-2008plus-ssl-4.0.1/data"\nnet:\n    #bindip: 127.0.0.1\n    port: 27017\nsetparameter:\n    enablelocalhostauthbypass: false\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# 2.2 shell è¿æ¥(mongoå½ä»¤)\n\nå¨å½ä»¤æç¤ºç¬¦è¾å¥ä»¥ä¸shellå½ä»¤å³å¯å®æç»é\n\nmongo\næ\nmongo --host=127.0.0.1 --port=27017\n\n\n1\n2\n3\n\n\n\n# 2.2.1 æ¥çå·²ç»æçæ°æ®åº\n\nshow databases\n\n\n1\n\n\n\n# 2.2.2 éåº mongodb\n\nexit\n\n\n1\n\n\næ´å¤åæ°å¯ä»¥éè¿å¸®å©æ¥çï¼\n\nmongo --help\n\n\n1\n\n\næç¤ºï¼\n\nmongodb javascript shellæ¯ä¸ä¸ªåºäºjavascriptçè§£éå¨ï¼ææ¯æ¯æjsç¨åºçã\n\n\n# 2.3 compass- å¾å½¢åçé¢å®¢æ·ç«¯\n\nå°mongodbå®ç½ä¸è½½mongodb compassï¼å°åï¼ https://www.mongodb.com/download-center/v2/compass?initial=true\n\nå¦ææ¯ä¸è½½å®è£çï¼åæç§æ­¥éª¤å®è£ï¼å¦ææ¯ä¸è½½å åç¼©çï¼ç´æ¥è§£åï¼æ§è¡éé¢çmongodbcompasscommunity.exe æä»¶å³å¯ã\n\nå¨æå¼ççé¢ä¸­ï¼è¾å¥ä¸»æºå°åãç«¯å£ç­ç¸å³ä¿¡æ¯ï¼ç¹å»è¿æ¥ï¼\n\n\n\n\n# 2.4 linux ç³»ç»ä¸­çå®è£å¯å¨åè¿æ¥\n\nç®æ ï¼å¨linuxä¸­é¨ç½²ä¸ä¸ªåæºçmongodbï¼ä½ä¸ºçäº§ç¯å¢ä¸ä½¿ç¨ã\n\næç¤ºï¼åwindowsä¸æä½å·®ä¸å¤ã\n\næ­¥éª¤å¦ä¸ï¼\n\n * åå°å®ç½ä¸è½½åç¼©å mongod -linux-x86_64-4.0.10.tgz ã\n\n * ä¸ä¼ åç¼©åå°linuxä¸­ï¼è§£åå°å½åç®å½ï¼\n   \n   tar -xvf mongodb-linux-x86_64-4.0.10.tgz\n   \n   \n   1\n   \n\n * ç§»å¨è§£ååçæä»¶å¤¹å°æå®çç®å½ä¸­ï¼\n   \n   mv mongodb-linux-x86_64-4.0.10 /usr/local/mongodb\n   \n   \n   1\n   \n\n * æ°å»ºå ä¸ªç®å½ï¼åå«ç¨æ¥å­å¨æ°æ®åæ¥å¿ï¼\n   \n   #æ°æ®å­å¨ç®å½\n   mkdir -p /mongodb/single/data/db\n   #æ¥å¿å­å¨ç®å½\n   mkdir -p /mongodb/single/log\n   \n   \n   1\n   2\n   3\n   4\n   \n\n * æ°å»ºå¹¶ä¿®æ¹éç½®æä»¶\n   \n   vi /mongodb/single/mongod.conf\n   \n   \n   1\n   \n   \n   éç½®æä»¶çåå®¹å¦ä¸ï¼\n   \n   systemlog:\n         #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n         # #the path of the log file to which mongod or mongos should send all diagnostic logging information\n         destination: file\n         #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n         path: "/mongodb/single/log/mongod.log"\n         #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n         logappend: true\n   storage:\n         #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n         ##the directory where the mongod instance stores its data.default value is "/data/db".\n         dbpath: "/mongodb/single/data/db"\n         journal:\n             #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n             enabled: true\n   processmanagement:\n         #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n         fork: true\n   net:\n         #æå¡å®ä¾ç»å®çipï¼é»è®¤æ¯localhost\n         bindip: localhost,192.168.142.128\n         #bindip\n         #ç»å®çç«¯å£ï¼é»è®¤æ¯27017\n         port: 27017\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   7\n   8\n   9\n   10\n   11\n   12\n   13\n   14\n   15\n   16\n   17\n   18\n   19\n   20\n   21\n   22\n   23\n   24\n   \n\n * å¯å¨mongodbæå¡\n   \n   /usr/local/mongodb/bin/mongod -f /mongodb/single/mongod.conf\n   \n   \n   1\n   \n   \n   æ³¨æï¼\n   \n   å¦æå¯å¨åä¸æ¯ successfully ï¼åæ¯å¯å¨å¤±è´¥äºãåå åºæ¬ä¸å°±æ¯éç½®æä»¶æé®é¢ã\n   \n   éè¿è¿ç¨æ¥æ¥çæå¡æ¯å¦å¯å¨äºï¼\n   \n   ps -ef |grep mongod\n   \n   \n   1\n   \n\n * åå«ä½¿ç¨mongoå½ä»¤åcompasså·¥å·æ¥è¿æ¥æµè¯ã\n   \n   æç¤ºï¼å¦æè¿ç¨è¿æ¥ä¸ä¸ï¼éè¦éç½®é²ç«å¢æ¾è¡ï¼æç´æ¥å³é­linuxé²ç«å¢\n   \n   #æ¥çé²ç«å¢ç¶æ\n   systemctl status firewalld\n   #ä¸´æ¶å³é­é²ç«å¢\n   systemctl stop firewalld\n   #å¼æºç¦æ­¢å¯å¨é²ç«å¢\n   systemctl disable firewalld\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   \n\n * åæ­¢å³é­æå¡\n   \n   åæ­¢æå¡çæ¹å¼æä¸¤ç§ï¼å¿«éå³é­åæ åå³é­ï¼ä¸é¢ä¾æ¬¡è¯´æï¼\n   \n   ï¼ä¸ï¼å¿«éå³é­æ¹æ³ï¼å¿«éï¼ç®åï¼æ°æ®å¯è½ä¼åºéï¼\n   \n   ç®æ ï¼éè¿ç³»ç»çkillå½ä»¤ç´æ¥ææ­»è¿ç¨ï¼\n   \n   æå®è¦æ£æ¥ä¸ä¸ï¼é¿åæçæ²¡æææã\n   \n   #éè¿è¿ç¨ç¼å·å³é­èç¹\n   kill -2 54410\n   \n   \n   1\n   2\n   \n   \n   ãè¡¥åã\n   \n   å¦æä¸æ¦æ¯å ä¸ºæ°æ®æåï¼åéè¦è¿è¡å¦ä¸æä½ï¼äºè§£ï¼ï¼\n   \n   1ï¼å é¤lockæä»¶ï¼\n   \n   rm -f /mongodb/single/data/db/*.lock\n   \n   \n   1\n   \n   \n   2 ï¼ä¿®å¤æ°æ®ï¼\n   \n   /usr/local/mongdb/bin/mongod --repair --dbpath=/mongodb/single/data/db\n   \n   \n   1\n   \n   \n   ï¼äºï¼æ åçå³é­æ¹æ³ï¼æ°æ®ä¸å®¹æåºéï¼ä½éº»ç¦ï¼ï¼\n   \n   ç®æ ï¼éè¿mongoå®¢æ·ç«¯ä¸­çshutdownserverå½ä»¤æ¥å³é­æå¡\n   \n   ä¸»è¦çæä½æ­¥éª¤åèå¦ä¸ï¼\n   \n   //å®¢æ·ç«¯ç»å½æå¡ï¼æ³¨æï¼è¿ééè¿localhostç»å½ï¼å¦æéè¦è¿ç¨ç»å½ï¼å¿é¡»åç»å½è®¤è¯æè¡ã\n   mongo --port 27017\n   //#åæ¢å°adminåº\n   use admin\n   //å³é­æå¡\n   db.shutdownserver()\n   \n   \n   1\n   2\n   3\n   4\n   5\n   6\n   \n\n\n# 3. åºæ¬å¸¸ç¨å½ä»¤\n\n\n# 3.1 æ¡ä¾éæ±\n\nå­æ¾æç« è¯è®ºçæ°æ®å­æ¾å°mongodbä¸­ï¼æ°æ®ç»æåèå¦ä¸ï¼\n\næ°æ®åºï¼articledb\n\nä¸æ æç« è¯è®º           comment                     \nå­æ®µåç§°             å­æ®µå«ä¹      å­æ®µç±»å              å¤æ³¨\n_id              id        objectidæstring   mongoçä¸»é®çå­æ®µ\narticleid        æç« id      string            \ncontent          è¯è®ºåå®¹      string            \nuserid           è¯è®ºäººid     string            \nnickname         è¯è®ºäººæµç§°     string            \ncreatedatetime   è¯è®ºçæ¥ææ¶é´   date              \nlikenum          ç¹èµæ°       int32             \nreplynum         åå¤æ°       int32             \nstate            ç¶æ        string            0ï¼ä¸å¯è§ï¼1ï¼å¯è§ï¼\nparentid         ä¸çº§id      string            å¦æä¸º0è¡¨ç¤ºæç« çé¡¶çº§è¯è®º\n\n\n# 3.2 æ°æ®åºæä½\n\n\n# 3.2.1 éæ©ååå»ºæ°æ®åº\n\néæ©ååå»ºæ°æ®åºçè¯­æ³æ ¼å¼ï¼\n\nuse æ°æ®åºåç§°\n\n\n1\n\n\nå¦ææ°æ®åºä¸å­å¨åèªå¨åå»ºï¼ä¾å¦ï¼ä»¥ä¸è¯­å¥åå»º articledb æ°æ®åºï¼\n\nuse articledb\n\n\n1\n\n\næ¥çææéçææçæ°æ®åºå½ä»¤\n\nshow dbs\næ\nshow databases\n\n\n1\n2\n3\n\n\n> æ³¨æ : å¨ mongodb ä¸­ï¼éååªæå¨åå®¹æå¥åæä¼åå»º! å°±æ¯è¯´ï¼åå»ºéå(æ°æ®è¡¨)åè¦åæå¥ä¸ä¸ªææ¡£(è®°å½)ï¼éåæä¼çæ­£åå»ºã\n\næ¥çå½åæ­£å¨ä½¿ç¨çæ°æ®åºå½ä»¤\n\ndb\n\n\n1\n\n\nmongodb ä¸­é»è®¤çæ°æ®åºä¸º testï¼å¦æä½ æ²¡æéæ©æ°æ®åºï¼éåå°å­æ¾å¨ test æ°æ®åºä¸­ã\n\nå¦å¤ï¼\n\næ°æ®åºåå¯ä»¥æ¯æ»¡è¶³ä»¥ä¸æ¡ä»¶çä»»æutf-8å­ç¬¦ä¸²ã\n\n * ä¸è½æ¯ç©ºå­ç¬¦ä¸²ï¼ ââ)ã\n * ä¸å¾å«æ â âï¼ç©ºæ ¼)ã.ã$ã/ã\\å\\0 (ç©ºå­ç¬¦)ã\n * åºå¨é¨å°åã\n * æå¤ 64å­èã\n\næä¸äºæ°æ®åºåæ¯ä¿ççï¼å¯ä»¥ç´æ¥è®¿é®è¿äºæç¹æ®ä½ç¨çæ°æ®åºã\n\n * admin ï¼ ä»æéçè§åº¦æ¥çï¼è¿æ¯ârootâæ°æ®åºãè¦æ¯å°ä¸ä¸ªç¨æ·æ·»å å°è¿ä¸ªæ°æ®åºï¼è¿ä¸ªç¨æ·èªå¨ç»§æ¿æææ°æ®åºçæéãä¸äºç¹å®çæå¡å¨ç«¯å½ä»¤ä¹åªè½ä»è¿ä¸ªæ°æ®åºè¿è¡ï¼æ¯å¦ååºææçæ°æ®åºæèå³é­æå¡å¨ã\n * local: è¿ä¸ªæ°æ®æ°¸è¿ä¸ä¼è¢«å¤å¶ï¼å¯ä»¥ç¨æ¥å­å¨éäºæ¬å°åå°æå¡å¨çä»»æéå\n * config : å½mongoç¨äºåçè®¾ç½®æ¶ï¼configæ°æ®åºå¨åé¨ä½¿ç¨ï¼ç¨äºä¿å­åççç¸å³ä¿¡æ¯ã\n\n\n# 3.2.2 æ°æ®åºçå é¤\n\nmongodb å é¤æ°æ®åºçè¯­æ³æ ¼å¼å¦ä¸ï¼\n\ndb.dropdatabase()\n\n\n1\n\n\næç¤ºï¼ä¸»è¦ç¨æ¥å é¤å·²ç»æä¹åçæ°æ®åº\n\n\n# 3.3 éåæä½\n\néåï¼ç±»ä¼¼å³ç³»åæ°æ®åºä¸­çè¡¨ã\n\nå¯ä»¥æ¾ç¤ºçåå»ºï¼ä¹å¯ä»¥éå¼çåå»ºã\n\n\n# 3.3.1 éåçæ¾å¼åå»º\n\nåºæ¬è¯­æ³æ ¼å¼ï¼\n\ndb.createcollection(name)\n\n\n1\n\n\nåæ°è¯´æï¼\n\n * name: è¦åå»ºçéååç§°\n\nä¾å¦ï¼åå»ºä¸ä¸ªåä¸º mycollection çæ®ééåã\n\ndb.createcollection("mycollection")\n\n\n1\n\n\næ¥çå½ååºä¸­çè¡¨ï¼ show tableså½ä»¤\n\nshow collections\næ\nshow tables\n\n\n1\n2\n3\n\n\néåçå½åè§èï¼\n\n * éååä¸è½æ¯ç©ºå­ç¬¦ä¸² ââã\n * éååä¸è½å«æ \\0å­ç¬¦ï¼ç©ºå­ç¬¦)ï¼è¿ä¸ªå­ç¬¦è¡¨ç¤ºéååçç»å°¾ã\n * éååä¸è½ä»¥ âsystem.âå¼å¤´ï¼è¿æ¯ä¸ºç³»ç»éåä¿ççåç¼ã\n * ç¨æ·åå»ºçéååå­ä¸è½å«æä¿çå­ç¬¦ãæäºé©±å¨ç¨åºçç¡®æ¯æå¨éååéé¢åå«ï¼è¿æ¯å ä¸ºæäºç³»ç»çæçéåä¸­åå«è¯¥å­ç¬¦ãé¤éä½ è¦è®¿é®è¿ç§ç³»ç»åå»ºçéåï¼å¦ååä¸ä¸è¦å¨åå­éåºç°$ã\n\n\n# 3.3.2 éåçéå¼åå»º\n\nå½åä¸ä¸ªéåä¸­æå¥ä¸ä¸ªææ¡£çæ¶åï¼å¦æéåä¸å­å¨ï¼åä¼èªå¨åå»ºéåã\n\nè¯¦è§ ææ¡£çæå¥ ç« èã\n\næç¤ºï¼éå¸¸æä»¬ä½¿ç¨éå¼åå»ºææ¡£å³å¯ã\n\n\n# 3.3.3 éåçå é¤\n\néåå é¤è¯­æ³æ ¼å¼å¦ä¸ï¼\n\ndb.collection.drop()\næ\ndb.éå.drop()\n\n\n1\n2\n3\n\n\nè¿åå¼\n\nå¦ææåå é¤éå®éåï¼å drop() æ¹æ³è¿å trueï¼å¦åè¿å falseã\n\nä¾å¦ï¼è¦å é¤mycollectionéå\n\ndb.mycollection.drop()\n\n\n1\n\n\n\n# 3.4 ææ¡£åºæ¬crud\n\nææ¡£ï¼documentï¼çæ°æ®ç»æå json åºæ¬ä¸æ ·ã\n\nææå­å¨å¨éåä¸­çæ°æ®é½æ¯ bson æ ¼å¼ã\n\n\n# 3.4.1 ææ¡£çæå¥\n\n# 3.4.1.1 åä¸ªææ¡£æå¥\n\nä½¿ç¨insert() æ save() æ¹æ³åéåä¸­æå¥ææ¡£ï¼è¯­æ³å¦ä¸ï¼\n\ndb.collection.insert(\n    <document or array of documents>,\n    {\n        writeconcern: <document>,\n        ordered: <boolean>\n    }\n)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nåæ°ï¼\n\nparameter      type                description\ndocument       document or array   è¦æå¥å°éåä¸­çææ¡£æææ¡£æ°ç»ãï¼(jsonæ ¼å¼ï¼\nwriteconcern   document            optional. a document expressing the write concern . omit to\n                                   use the default write concern. see write concern .do not\n                                   explicitly set the write concern for the operation if run in\n                                   a transaction. to use write concern with transactions, see\n                                   transactions and write concern\nordered        boolean             å¯éãå¦æä¸ºçï¼åæé¡ºåºæå¥æ°ç»ä¸­çææ¡£ï¼å¦æå¶ä¸­ä¸ä¸ªææ¡£åºç°éè¯¯ï¼mongodbå°è¿åèä¸å¤çæ°ç»ä¸­çå¶ä½ææ¡£ãå¦æä¸ºåï¼åæ§è¡æ åºæå¥ï¼å¦æå¶ä¸­ä¸ä¸ªææ¡£åºç°éè¯¯ï¼åç»§ç»­å¤çæ°ç»ä¸­çä¸»ææ¡£ãå¨çæ¬2.6+ä¸­é»è®¤ä¸ºtrue\n\nãç¤ºä¾ã\n\nè¦åcommentçéå(è¡¨)ä¸­æå¥ä¸æ¡æµè¯æ°æ®ï¼\n\ndb.comment.insert({"articleid":"100000","content":"ä»å¤©å¤©æ°çå¥½ï¼é³åæåª","userid":"1001","nickname":"rose","createdatetime":new date(),"likenum":numberint(10),"state":null})\n\n\n1\n\n\næç¤ºï¼\n\n * commentéåå¦æä¸å­å¨ï¼åä¼éå¼åå»º\n * mongoä¸­çæ°å­ï¼é»è®¤æåµä¸æ¯doubleç±»åï¼å¦æè¦å­æ´åï¼å¿é¡»ä½¿ç¨å½æ°numberint(æ´åæ°å­)ï¼å¦åååºæ¥å°±æé®é¢äºã\n * æå¥å½åæ¥æä½¿ç¨ new date()\n * æå¥çæ°æ®æ²¡ææå® _id ï¼ä¼èªå¨çæä¸»é®å¼\n * å¦ææå­æ®µæ²¡å¼ï¼å¯ä»¥èµå¼ä¸ºnullï¼æä¸åè¯¥å­æ®µã\n\næ§è¡åï¼å¦ä¸ï¼è¯´ææå¥ä¸ä¸ªæ°æ®æåäºã\n\nwriteresult({ "ninserted" : 1 })\n\n\n1\n\n\næ³¨æï¼\n\n * ææ¡£ä¸­çé®/å¼å¯¹æ¯æåºçã\n * ææ¡£ä¸­çå¼ä¸ä»å¯ä»¥æ¯å¨åå¼å·éé¢çå­ç¬¦ä¸²ï¼è¿å¯ä»¥æ¯å¶ä»å ç§æ°æ®ç±»åï¼çè³å¯ä»¥æ¯æ´ä¸ªåµå¥çææ¡£)ã\n * mongodbåºåç±»ååå¤§å°åã\n * mongodbçææ¡£ä¸è½æéå¤çé®ã\n * ææ¡£çé®æ¯å­ç¬¦ä¸²ãé¤äºå°æ°ä¾å¤æåµï¼é®å¯ä»¥ä½¿ç¨ä»»æutf-8å­ç¬¦ã\n\nææ¡£é®å½åè§èï¼\n\n * é®ä¸è½å«æ \\0 (ç©ºå­ç¬¦)ãè¿ä¸ªå­ç¬¦ç¨æ¥è¡¨ç¤ºé®çç»å°¾ã\n * . å$æç¹å«çæä¹ï¼åªæå¨ç¹å®ç¯å¢ä¸æè½ä½¿ç¨ã\n * ä»¥ä¸åçº¿ â_âå¼å¤´çé®æ¯ä¿çç(ä¸æ¯ä¸¥æ ¼è¦æ±ç)ã\n\n# 3.4.1.2 æ¹éæå¥\n\nè¯­æ³ï¼\n\ndb.collection.insertmany(\n     [ <document 1> , <document 2>, ... ],\n     {\n         writeconcern: <document>,\n         ordered: <boolean>\n     }\n)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nãç¤ºä¾ã\n\næ¹éæå¥å¤æ¡æç« è¯è®ºï¼\n\ndb.comment.insertmany([\n    {"_id":"1","articleid":"100001","content":"æä»¬ä¸åºè¯¥ææ¸æ¨æµªè´¹å¨ææºä¸ï¼å¥åº·å¾éè¦ï¼ä¸æ¯æ¸©æ°´å¹¸ç¦ä½ æä»ã","userid":"1002","nickname":"ç¸å¿äºæ±æ¹","createdatetime":new date("2019-08-05t22:08:15.522z"),"likenum":numberint(1000),"state":"1"},\n    {"_id":"2","articleid":"100001","content":"æå¤å¤©ç©ºè¹ååå¼æ°´ï¼å¬å¤©åæ¸©å¼æ°´","userid":"1005","nickname":"ä¼äººææ´","createdatetime":new date("2019-08-05t23:58:51.485z"),"likenum":numberint(888),"state":"1"},\n    {"_id":"3","articleid":"100001","content":"æä¸ç´ååå¼æ°´ï¼å¬å¤©å¤å¤©é½åã","userid":"1004","nickname":"æ°åè¹é¿","createdatetime":new date("2019-08-06t01:05:06.321z"),"likenum":numberint(666),"state":"1"},\n    {"_id":"4","articleid":"100001","content":"ä¸å®¶è¯´ä¸è½ç©ºè¹åé¥­ï¼å½±åå¥åº·ã","userid":"1003","nickname":"å¯æ","createdatetime":new date("2019-08-06t08:18:35.288z"),"likenum":numberint(2000),"state":"1"},\n    {"_id":"5","articleid":"100001","content":"ç ç©¶è¡¨æï¼åç§å¼çæ°´åä¸ä¸è½åï¼å ä¸ºç«å´ã","userid":"1003","nickname":"å¯æ","createdatetime":new date("2019-08-06t11:01:02.521z"),"likenum":numberint(3000),"state":"1"}\n\n]);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\næç¤ºï¼\n\næå¥æ¶æå®äº _id ï¼åä¸»é®å°±æ¯è¯¥å¼ã\n\nå¦æææ¡æ°æ®æå¥å¤±è´¥ï¼å°ä¼ç»æ­¢æå¥ï¼ä½å·²ç»æå¥æåçæ°æ®ä¸ä¼åæ»æã\n\nå ä¸ºæ¹éæå¥ç±äºæ°æ®è¾å¤å®¹æåºç°å¤±è´¥ï¼å æ­¤ï¼å¯ä»¥ä½¿ç¨try catchè¿è¡å¼å¸¸ææå¤çï¼æµè¯çæ¶åå¯ä»¥ä¸å¤çãå¦ï¼äºè§£ï¼ï¼\n\ntry {\n    db.comment.insertmany([\n        {"_id":"1","articleid":"100001","content":"æä»¬ä¸åºè¯¥ææ¸æ¨æµªè´¹å¨ææºä¸ï¼å¥åº·å¾éè¦ï¼ä¸æ¯æ¸©æ°´å¹¸ç¦ä½ æä»ã","userid":"1002","nickname":"ç¸å¿äºæ±æ¹","createdatetime":new date("2019-08-05t22:08:15.522z"),"likenum":numberint(1000),"state":"1"},\n        {"_id":"2","articleid":"100001","content":"æå¤å¤©ç©ºè¹ååå¼æ°´ï¼å¬å¤©åæ¸©å¼æ°´","userid":"1005","nickname":"ä¼äººææ´","createdatetime":new date("2019-08-05t23:58:51.485z"),"likenum":numberint(888),"state":"1"},\n        {"_id":"3","articleid":"100001","content":"æä¸ç´ååå¼æ°´ï¼å¬å¤©å¤å¤©é½åã","userid":"1004","nickname":"æ°åè¹é¿","createdatetime":new date("2019-08-06t01:05:06.321z"),"likenum":numberint(666),"state":"1"},\n        {"_id":"4","articleid":"100001","content":"ä¸å®¶è¯´ä¸è½ç©ºè¹åé¥­ï¼å½±åå¥åº·ã","userid":"1003","nickname":"å¯æ","createdatetime":new date("2019-08-06t08:18:35.288z"),"likenum":numberint(2000),"state":"1"},\n        {"_id":"5","articleid":"100001","content":"ç ç©¶è¡¨æï¼åç§å¼çæ°´åä¸ä¸è½åï¼å ä¸ºç«å´ã","userid":"1003","nickname":"å¯æ","createdatetime":new date("2019-08-06t11:01:02.521z"),"likenum":numberint(3000),"state":"1"}\n\n    ]);\n\n} catch (e) {\n    print (e);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\n\n# 3.4.2 ææ¡£çåºæ¬æ¥è¯¢\n\næ¥è¯¢æ°æ®çè¯­æ³æ ¼å¼å¦ä¸ï¼\n\ndb.collection.find(<query>, [projection])\n\n\n1\n\n\nåæ°ï¼\n\nparameter    type       description\nquery        document   å¯éãä½¿ç¨æ¥è¯¢è¿ç®ç¬¦æå®éæ©ç­éå¨ãè¥è¦è¿åéåä¸­çææææ¡£ï¼è¯·çç¥æ­¤åæ°æä¼ éç©ºææ¡£( {} )ã\nprojection   document   å¯éãæå®è¦å¨ä¸æ¥è¯¢ç­éå¨å¹éçææ¡£ä¸­è¿åçå­æ®µï¼æå½±ï¼ãè¥è¦è¿åå¹éææ¡£ä¸­çææå­æ®µï¼è¯·çç¥æ­¤åæ°ã\n\nãç¤ºä¾ã\n\n# 3.4.2.1 æ¥è¯¢ææ\n\nå¦ææä»¬è¦æ¥è¯¢commentéåçææææ¡£ï¼æä»¬è¾å¥ä»¥ä¸å½ä»¤\n\ndb.comment.find()\næ\ndb.comment.find({})\n\n\n1\n2\n3\n\n\nè¿éä½ ä¼åç°æ¯æ¡ææ¡£ä¼æä¸ä¸ªå« _idçå­æ®µï¼è¿ä¸ªç¸å½äºæä»¬åæ¥å³ç³»æ°æ®åºä¸­è¡¨çä¸»é®ï¼å½ä½ å¨æå¥ææ¡£è®°å½æ¶æ²¡ææå®è¯¥å­æ®µï¼mongodbä¼èªå¨åå»ºï¼å¶ç±»åæ¯objectidç±»åã\n\nå¦ææä»¬å¨æå¥ææ¡£è®°å½æ¶æå®è¯¥å­æ®µä¹å¯ä»¥ï¼å¶ç±»åå¯ä»¥æ¯objectidç±»åï¼ä¹å¯ä»¥æ¯mongodbæ¯æçä»»æç±»åã\n\nå¦æææ³æä¸å®æ¡ä»¶æ¥æ¥è¯¢ï¼æ¯å¦ææ³æ¥è¯¢useridä¸º1003çè®°å½ï¼æä¹åï¼å¾ç®åï¼åª è¦å¨find()ä¸­æ·»å åæ°å³å¯ï¼åæ°ä¹æ¯jsonæ ¼å¼ï¼å¦ä¸ï¼\n\ndb.comment.find({userid:\'1003\'})\n\n\n1\n\n\nå¦æä½ åªéè¦è¿åç¬¦åæ¡ä»¶çç¬¬ä¸æ¡æ°æ®ï¼æä»¬å¯ä»¥ä½¿ç¨findoneå½ä»¤æ¥å®ç°ï¼è¯­æ³åfindä¸æ ·ã\n\nå¦ï¼æ¥è¯¢ç¨æ·ç¼å·æ¯1003çè®°å½ï¼ä½åªæå¤è¿åç¬¦åæ¡ä»¶çç¬¬ä¸æ¡è®°å½ï¼\n\ndb.comment.findone({userid:\'1003\'})\n\n\n1\n\n\n# 3.4.2.2 æå½±æ¥è¯¢ï¼projection queryï¼\n\nå¦æè¦æ¥è¯¢ç»æè¿åé¨åå­æ®µï¼åéè¦ä½¿ç¨æå½±æ¥è¯¢ï¼ä¸æ¾ç¤ºææå­æ®µï¼åªæ¾ç¤ºæå®çå­æ®µï¼ã\n\nå¦ï¼æ¥è¯¢ç»æåªæ¾ç¤º _id ãuseridãnickname :\n\ndb.comment.find({userid:"1003"},{userid:1,nickname:1})\n\n\n1\n\n\né»è®¤ _id ä¼æ¾ç¤ºã\n\nå¦ï¼æ¥è¯¢ç»æåªæ¾ç¤º ã useridãnickname ï¼ä¸æ¾ç¤º _id ï¼\n\ndb.comment.find({userid:"1003"},{userid:1,nickname:1,_id:0})\n\n\n1\n\n\nåä¾å¦ï¼æ¥è¯¢æææ°æ®ï¼ä½åªæ¾ç¤º _id ãuseridãnickname :\n\ndb.comment.find({},{userid:1,nickname:1})\n\n\n1\n\n\n\n# 3.4.3 ææ¡£çæ´æ°\n\næ´æ°ææ¡£çè¯­æ³ï¼\n\ndb.collection.update(query, update, options)\n//æ\ndb.collection.update(\n    <query>,\n    <update>,\n    {\n        upsert: <boolean>,\n        multi: <boolean>,\n        writeconcern: <document>,\n        collation: <document>,\n        arrayfilters: [ <filterdocument1>, ... ],\n        hint:  <document|string>     // available starting in mongodb 4.2\n    }\n)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\nåæ°ï¼\n\nparameter   type       description\nquery       document   æ´æ°çéæ©æ¡ä»¶ãå¯ä»¥ä½¿ç¨ä¸findï¼ï¼æ¹æ³ä¸­ç¸åçæ¥è¯¢éæ©å¨ï¼ç±»ä¼¼sql\n                       updateæ¥è¯¢åwhereåé¢çããå¨3.0çä¸­è¿è¡äºæ´æ¹ï¼å½ä½¿ç¨upsert:trueæ§è¡updateï¼ï¼æ¶ï¼å¦ææ¥è¯¢ä½¿ç¨ç¹è¡¨ç¤ºæ³å¨_id\n                       å­æ®µä¸æå®æ¡ä»¶ï¼åmongodbå°æç»æå¥æ°ææ¡£ã\nmulti       boolean    å¯éãå¦æè®¾ç½®ä¸ºtrueï¼åæ´æ°ç¬¦åæ¥è¯¢æ¡ä»¶çå¤ä¸ªææ¡£ãå¦æè®¾ç½®ä¸ºfalseï¼åæ´æ°ä¸ä¸ªææ¡£ãé»è®¤å¼ä¸ºfalseã\n\nãç¤ºä¾ã\n\n# 3.4.3.1 è¦ççä¿®æ¹\n\nå¦ææä»¬æ³ä¿®æ¹_idä¸º1çè®°å½ï¼ç¹èµéä¸º1001ï¼è¾å¥ä»¥ä¸è¯­å¥ï¼\n\ndb.comment.update({_id:"1"},{likenum:numberint(1001)})\n\n\n1\n\n\næ§è¡åï¼æä»¬ä¼åç°ï¼è¿æ¡ææ¡£é¤äº likenumå­æ®µå¶å®å­æ®µé½ä¸è§äºï¼\n\n# 3.4.3.2 å±é¨ä¿®æ¹\n\nä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼æä»¬éè¦ä½¿ç¨ä¿®æ¹å¨$setæ¥å®ç°ï¼å½ä»¤å¦ä¸ï¼\n\næä»¬æ³ä¿®æ¹_idä¸º2çè®°å½ï¼æµè§éä¸º889ï¼è¾å¥ä»¥ä¸è¯­å¥ï¼\n\ndb.comment.update({_id:"2"},{$set:{likenum:numberint(889)}})\n\n\n1\n\n\n# 3.4.3.3 æ¹éçä¿®æ¹\n\næ´æ°ææç¨æ·ä¸º 1003 çç¨æ·çæµç§°ä¸º å¯æå¤§å¸ ã\n\n//é»è®¤åªä¿®æ¹ç¬¬ä¸æ¡æ°æ®\ndb.comment.update({userid:"1003"},{$set:{nickname:"å¯æ2"}})\n//ä¿®æ¹ææç¬¦åæ¡ä»¶çæ°æ®\ndb.comment.update({userid:"1003"},{$set:{nickname:"å¯æå¤§å¸"}},{multi:true})\n\n\n1\n2\n3\n4\n\n\næç¤ºï¼å¦æä¸å åé¢çåæ°ï¼ååªæ´æ°ç¬¦åæ¡ä»¶çç¬¬ä¸æ¡è®°å½\n\n# 3.4.3.4 åå¼å¢é¿çä¿®æ¹\n\nå¦ææä»¬æ³å®ç°å¯¹æåå¼å¨åæå¼çåºç¡ä¸è¿è¡å¢å æåå°ï¼å¯ä»¥ä½¿ç¨ $inc è¿ç®ç¬¦æ¥å®ç°ã\n\néæ±ï¼å¯¹3å·æ°æ®çç¹èµæ°ï¼æ¯æ¬¡éå¢1\n\ndb.comment.update({_id:"3"},{$inc:{likenum:numberint(1)}})\n\n\n1\n\n\n\n# 3.4.4 å é¤ææ¡£\n\nå é¤ææ¡£çè¯­æ³ç»æï¼\n\ndb.éååç§°.remove(æ¡ä»¶)\n\n\n1\n\n\nä»¥ä¸è¯­å¥å¯ä»¥å°æ°æ®å¨é¨å é¤ï¼è¯·æç¨\n\ndb.comment.remove({})\n\n\n1\n\n\nå¦æå é¤ _id=1çè®°å½ï¼è¾å¥ä»¥ä¸è¯­å¥\n\ndb.comment.remove({_id:"1"})\n\n\n1\n\n\n\n# 3.5 ææ¡£çåé¡µæ¥è¯¢\n\n\n# 3.5.1 ç»è®¡æ¥è¯¢\n\nç»è®¡æ¥è¯¢ä½¿ç¨count()æ¹æ³ï¼è¯­æ³å¦ä¸ï¼\n\ndb.collection.count(query, options)\n\n\n1\n\n\nåæ°ï¼\n\nparameter   type       description\nquery       document   æ¥è¯¢éæ©æ¡ä»¶\noptions     document   å¯éãç¨äºä¿®æ¹è®¡æ°çé¢å¤éé¡¹\n\nãç¤ºä¾ã\n\n# 3.5.1.1 ç»è®¡ææè®°å½æ°\n\nç»è®¡commentéåçææçè®°å½æ°ï¼\n\ndb.comment.count()\n\n\n1\n\n\n# 3.5.1.2 ææ¡ä»¶ç»è®¡è®°å½æ°\n\nä¾å¦ï¼ç»è®¡useridä¸º1003çè®°å½æ¡æ°\n\ndb.comment.count({userid:"1003"})\n\n\n1\n\n\næç¤ºï¼\n\né»è®¤æåµä¸ count() æ¹æ³è¿åç¬¦åæ¡ä»¶çå¨é¨è®°å½æ¡æ°ã\n\n\n# 3.5.2 åé¡µåè¡¨æ¥è¯¢\n\nå¯ä»¥ä½¿ç¨limit()æ¹æ³æ¥è¯»åæå®æ°éçæ°æ®ï¼ä½¿ç¨skip()æ¹æ³æ¥è·³è¿æå®æ°éçæ°æ®ã\n\nåºæ¬è¯­æ³å¦ä¸æç¤ºï¼\n\ndb.collection_name.find().limit(number).skip(number)\n\n\n1\n\n\nå¦æä½ æ³è¿åæå®æ¡æ°çè®°å½ï¼å¯ä»¥å¨findæ¹æ³åè°ç¨limitæ¥è¿åç»æ(topn)ï¼é»è®¤å¼20ï¼ä¾å¦ï¼\n\ndb.comment.find().limit(3)\n\n\n1\n\n\nskip æ¹æ³åæ ·æ¥åä¸ä¸ªæ°å­åæ°ä½ä¸ºè·³è¿çè®°å½æ¡æ°ãï¼ånä¸ªä¸è¦ï¼,é»è®¤å¼æ¯0\n\ndb.comment.find().skip(3)\n\n\n1\n\n\nåé¡µæ¥è¯¢ï¼éæ±ï¼æ¯é¡µ2ä¸ªï¼ç¬¬äºé¡µå¼å§ï¼è·³è¿åä¸¤æ¡æ°æ®ï¼æ¥çå¼æ¾ç¤º3å4æ¡æ°æ®\n\n//ç¬¬ä¸é¡µ\ndb.comment.find().skip(0).limit(2)\n//ç¬¬äºé¡µ\ndb.comment.find().skip(2).limit(2)\n//ç¬¬ä¸é¡µ\ndb.comment.find().skip(4).limit(2)\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 3.5.3 æåºæ¥è¯¢\n\nsort() æ¹æ³å¯¹æ°æ®è¿è¡æåºï¼sort() æ¹æ³å¯ä»¥éè¿åæ°æå®æåºçå­æ®µï¼å¹¶ä½¿ç¨ 1 å -1 æ¥æå®æåºçæ¹å¼ï¼å¶ä¸­ 1ä¸ºååºæåï¼è -1 æ¯ç¨äºéåºæåã\n\nè¯­æ³å¦ä¸æç¤ºï¼\n\ndb.collection_name.find().sort({key:1})\næ\ndb.éååç§°.find().sort(æåºæ¹å¼)\n\n\n1\n2\n3\n\n\nä¾å¦ï¼\n\nå¯¹useridéåºæåï¼å¹¶å¯¹è®¿é®éè¿è¡ååºæå\n\ndb.comment.find().sort({userid:-1,likenum:1})\n\n\n1\n\n\næç¤ºï¼\n\nskip(), limilt(), sort()ä¸ä¸ªæ¾å¨ä¸èµ·æ§è¡çæ¶åï¼æ§è¡çé¡ºåºæ¯å sort(), ç¶åæ¯ skip()ï¼æåæ¯æ¾ç¤ºç limit()ï¼åå½ä»¤ç¼åé¡ºåºæ å³ã\n\n\n# 3.6 ææ¡£çæ´å¤æ¥è¯¢\n\n\n# 3.6.1 æ­£åçå¤ææ¡ä»¶æ¥è¯¢\n\nmongodbçæ¨¡ç³æ¥è¯¢æ¯éè¿æ­£åè¡¨è¾¾å¼çæ¹å¼å®ç°çãæ ¼å¼ä¸ºï¼\n\ndb.collection.find({field:/æ­£åè¡¨è¾¾å¼/})\næ\ndb.éå.find({å­æ®µ:/æ­£åè¡¨è¾¾å¼/})\n\n\n1\n2\n3\n\n\næç¤ºï¼æ­£åè¡¨è¾¾å¼æ¯ jsçè¯­æ³ï¼ç´æ¥éçåæ³ã\n\nä¾å¦ï¼æè¦æ¥è¯¢è¯è®ºåå®¹åå«âå¼æ°´âçææææ¡£ï¼ä»£ç å¦ä¸ï¼\n\ndb.comment.find({content:/å¼æ°´/})\n\n\n1\n\n\nå¦æè¦æ¥è¯¢è¯è®ºçåå®¹ä¸­ä»¥ âä¸å®¶âå¼å¤´çï¼ä»£ç å¦ä¸ï¼\n\ndb.comment.find({content:/^ä¸å®¶/})\n\n\n1\n\n\n\n# 3.6.2 æ¯è¾æ¥è¯¢\n\n<, <=, >, >= è¿ä¸ªæä½ç¬¦ä¹æ¯å¾å¸¸ç¨çï¼æ ¼å¼å¦ä¸:\n\ndb.éååç§°.find({ "field" : { $gt: value }}) // å¤§äº: field > value\ndb.éååç§°.find({ "field" : { $lt: value }}) // å°äº: field < value\ndb.éååç§°.find({ "field" : { $gte: value }}) // å¤§äºç­äº: field >= value\ndb.éååç§°.find({ "field" : { $lte: value }}) // å°äºç­äº: field <= value\ndb.éååç§°.find({ "field" : { $ne: value }}) // ä¸ç­äº: field != value\n\n\n1\n2\n3\n4\n5\n\n\nç¤ºä¾ï¼æ¥è¯¢è¯è®ºç¹èµæ°éå¤§äº 700çè®°å½\n\ndb.comment.find({likenum:{$gt:numberint(700)}})\n\n\n1\n\n\n\n# 3.6.3 åå«æ¥è¯¢\n\nåå«ä½¿ç¨$inæä½ç¬¦ã ç¤ºä¾ï¼æ¥è¯¢è¯è®ºçéåä¸­useridå­æ®µåå«1003æ1004çææ¡£\n\ndb.comment.find({userid:{$in:["1003","1004"]}})\n\n\n1\n\n\nä¸åå«ä½¿ç¨ $ninæä½ç¬¦ã ç¤ºä¾ï¼æ¥è¯¢è¯è®ºéåä¸­useridå­æ®µä¸åå«1003å1004çææ¡£\n\ndb.comment.find({userid:{$nin:["1003","1004"]}})\n\n\n1\n\n\n\n# 3.6.4 æ¡ä»¶è¿æ¥æ¥è¯¢\n\næä»¬å¦æéè¦æ¥è¯¢åæ¶æ»¡è¶³ä¸¤ä¸ªä»¥ä¸æ¡ä»¶ï¼éè¦ä½¿ç¨$andæä½ç¬¦å°æ¡ä»¶è¿è¡å³èãï¼ç¸å½äºsqlçandï¼ æ ¼å¼ä¸ºï¼\n\n$and:[ {  },{  },{ } ]\n\n\n1\n\n\nç¤ºä¾ï¼æ¥è¯¢è¯è®ºéåä¸­ likenumå¤§äºç­äº700 å¹¶ä¸å°äº2000çææ¡£ï¼\n\ndb.comment.find({$and:[{likenum:{$gte:numberint(700)}},{likenum:{$lt:numberint(2000)}}]})\n\n\n1\n\n\nå¦æä¸¤ä¸ªä»¥ä¸æ¡ä»¶ä¹é´æ¯æèçå³ç³»ï¼æä»¬ä½¿ç¨æä½ç¬¦è¿è¡å³èï¼ä¸åé¢ andçä½¿ç¨æ¹å¼ç¸åæ ¼å¼ä¸ºï¼\n\n$or:[ {  },{  },{   } ]\n\n\n1\n\n\nç¤ºä¾ï¼æ¥è¯¢è¯è®ºéåä¸­ useridä¸º1003ï¼æèç¹èµæ°å°äº1000çææ¡£è®°å½\n\ndb.comment.find({$or:[ {userid:"1003"} ,{likenum:{$lt:1000} }]})\n\n\n1\n\n\n\n# 3.7 å¸¸ç¨å½ä»¤å°ç»\n\néæ©åæ¢æ°æ®åºï¼use articledb\næå¥æ°æ®ï¼db.comment.insert({bsonæ°æ®})\næ¥è¯¢æææ°æ®ï¼db.comment.find();\næ¡ä»¶æ¥è¯¢æ°æ®ï¼db.comment.find({æ¡ä»¶})\næ¥è¯¢ç¬¦åæ¡ä»¶çç¬¬ä¸æ¡è®°å½ï¼db.comment.findone({æ¡ä»¶})\næ¥è¯¢ç¬¦åæ¡ä»¶çåå æ¡è®°å½ï¼db.comment.find({æ¡ä»¶}).limit(æ¡æ°)\næ¥è¯¢ç¬¦åæ¡ä»¶çè·³è¿çè®°å½ï¼db.comment.find({æ¡ä»¶}).skip(æ¡æ°)\nä¿®æ¹æ°æ®ï¼db.comment.update({æ¡ä»¶},{ä¿®æ¹åçæ°æ®}) ædb.comment.update({æ¡ä»¶},{$set:{è¦ä¿®æ¹é¨åçå­æ®µ:æ°æ®})\nä¿®æ¹æ°æ®å¹¶èªå¢æå­æ®µå¼ï¼db.comment.update({æ¡ä»¶},{$inc:{èªå¢çå­æ®µ:æ­¥è¿å¼}})\nå é¤æ°æ®ï¼db.comment.remove({æ¡ä»¶})\nç»è®¡æ¥è¯¢ï¼db.comment.count({æ¡ä»¶})\næ¨¡ç³æ¥è¯¢ï¼db.comment.find({å­æ®µå:/æ­£åè¡¨è¾¾å¼/})\næ¡ä»¶æ¯è¾è¿ç®ï¼db.comment.find({å­æ®µå:{$gt:å¼}})\nåå«æ¥è¯¢ï¼db.comment.find({å­æ®µå:{$in:[å¼1ï¼å¼2]}})ædb.comment.find({å­æ®µå:{$nin:[å¼1ï¼å¼2]}})\næ¡ä»¶è¿æ¥æ¥è¯¢ï¼db.comment.find({$and:[{æ¡ä»¶1},{æ¡ä»¶2}]})ædb.comment.find({$or:[{æ¡ä»¶1},{æ¡ä»¶2}]})\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# 4. ç´¢å¼-index\n\n\n# 4.1 æ¦è¿°\n\nç´¢å¼æ¯æå¨mongodbä¸­é«æå°æ§è¡æ¥è¯¢ãå¦ææ²¡æç´¢å¼ï¼mongodbå¿é¡»æ§è¡å¨éåæ«æï¼å³æ«æéåä¸­çæ¯ä¸ªææ¡£ï¼ä»¥éæ©ä¸æ¥è¯¢è¯­å¥å¹éçææ¡£ãè¿ç§æ«æå¨éåçæ¥è¯¢æçæ¯éå¸¸ä½çï¼ç¹å«å¨å¤çå¤§éçæ°æ®æ¶ï¼æ¥è¯¢å¯ä»¥è¦è±è´¹å åç§çè³å åéï¼è¿å¯¹ç½ç«çæ§è½æ¯éå¸¸è´å½çã\n\nå¦ææ¥è¯¢å­å¨éå½çç´¢å¼ï¼mongodbå¯ä»¥ä½¿ç¨è¯¥ç´¢å¼éå¶å¿é¡»æ£æ¥çææ¡£æ°ã\n\nç´¢å¼æ¯ç¹æ®çæ°æ®ç»æï¼å®ä»¥æäºéåçå½¢å¼å­å¨éåæ°æ®éçä¸å°é¨åãç´¢å¼å­å¨ç¹å®å­æ®µæä¸ç»å­æ®µçå¼ï¼æå­æ®µå¼æåºãç´¢å¼é¡¹çæåºæ¯æææçç¸ç­å¹éååºäºèå´çæ¥è¯¢æä½ãæ­¤å¤ï¼mongodbè¿å¯ä»¥ä½¿ç¨ç´¢å¼ä¸­çæåºè¿åæåºç»æã\n\nå®ç½ææ¡£ï¼ https://docs.mongodb.com/manual/indexes/\n\näºè§£ï¼\n\nmongodbç´¢å¼ä½¿ç¨bæ æ°æ®ç»æï¼ç¡®åçè¯´æ¯b-treeï¼mysqlæ¯b+treeï¼\n\n\n# 4.2 ç´¢å¼çç±»å\n\n\n# 4.2.1 åå­æ®µç´¢å¼\n\nmongodbæ¯æå¨ææ¡£çåä¸ªå­æ®µä¸åå»ºç¨æ·å®ä¹çååº/éåºç´¢å¼ï¼ç§°ä¸ºåå­æ®µç´¢å¼ï¼single field indexï¼ã\n\nå¯¹äºåä¸ªå­æ®µç´¢å¼åæåºæä½ï¼ç´¢å¼é®çæåºé¡ºåºï¼å³ååºæéåºï¼å¹¶ä¸éè¦ï¼å ä¸ºmongodbå¯ä»¥å¨ä»»ä½æ¹åä¸éåç´¢å¼ã\n\n\n\n\n# 4.2.2 å¤åç´¢å¼\n\nmongodbè¿æ¯æå¤ä¸ªå­æ®µçç¨æ·å®ä¹ç´¢å¼ï¼å³å¤åç´¢å¼ï¼compound indexï¼ã\n\nå¤åç´¢å¼ä¸­ååºçå­æ®µé¡ºåºå·æéè¦æä¹ãä¾å¦ï¼å¦æå¤åç´¢å¼ç± { userid: 1, score: -1 } ç»æï¼åç´¢å¼é¦åæuseridæ­£åºæåºï¼ç¶åå¨æ¯ä¸ªuseridçå¼åï¼åå¨æscoreååºæåºã\n\n\n\n\n# 4.2.3 å¶ä»ç´¢å¼\n\nå°çç©ºé´ç´¢å¼ï¼geospatial indexï¼ãææ¬ç´¢å¼ï¼text indexesï¼ãåå¸ç´¢å¼ï¼hashed indexesï¼ã\n\n * å°çç©ºé´ç´¢å¼ï¼geospatial indexï¼\n   \n   ä¸ºäºæ¯æå¯¹å°çç©ºé´åæ æ°æ®çæææ¥è¯¢ï¼mongodbæä¾äºä¸¤ç§ç¹æ®çç´¢å¼ï¼è¿åç»ææ¶ä½¿ç¨å¹³é¢å ä½çäºç»´ç´¢å¼åè¿åç»ææ¶ä½¿ç¨çé¢å ä½çäºç»´çé¢ç´¢å¼ã\n\n * ææ¬ç´¢å¼ï¼text indexesï¼\n   \n   mongodbæä¾äºä¸ç§ææ¬ç´¢å¼ç±»åï¼æ¯æå¨éåä¸­æç´¢å­ç¬¦ä¸²åå®¹ãè¿äºææ¬ç´¢å¼ä¸å­å¨ç¹å®äºè¯­è¨çåæ­¢è¯ï¼ä¾å¦âtheâãâaâãâorâï¼ï¼èå°éåä¸­çè¯ä½ä¸ºè¯å¹²ï¼åªå­å¨æ ¹è¯ã\n\n * åå¸ç´¢å¼ï¼hashed indexesï¼\n   \n   ä¸ºäºæ¯æåºäºæ£åçåçï¼mongodbæä¾äºæ£åç´¢å¼ç±»åï¼å®å¯¹å­æ®µå¼çæ£åè¿è¡ç´¢å¼ãè¿äºç´¢å¼å¨å¶èå´åçå¼åå¸æ´å éæºï¼ä½åªæ¯æç¸ç­å¹éï¼ä¸æ¯æåºäºèå´çæ¥è¯¢ã\n\n\n# 4.3 ç´¢å¼çç®¡çæä½\n\n\n# 4.3.1 ç´¢å¼çæ¥ç\n\nè¯´æï¼\n\nè¿åä¸ä¸ªéåä¸­çææç´¢å¼çæ°ç»ã\n\nè¯­æ³ï¼\n\ndb.collection.getindexes()\n\n\n1\n\n\næç¤ºï¼è¯¥è¯­æ³å½ä»¤è¿è¡è¦æ±æ¯ mongodb 3.0+\n\nãç¤ºä¾ã\n\næ¥çcommentéåä¸­ææçç´¢å¼æåµ\n\n> db.comment.getindexes()\n[\n   {\n        "v" : 2,\n        "key" : {\n            "_id" : 1\n       },\n        "name" : "_id_",\n        "ns" : "articledb.comment"\n   }\n]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nç»æä¸­æ¾ç¤ºçæ¯é»è®¤ _id ç´¢å¼ã\n\né»è®¤_idç´¢å¼ï¼\n\nmongodbå¨åå»ºéåçè¿ç¨ä¸­ï¼å¨_id å­æ®µä¸åå»ºä¸ä¸ªå¯ä¸çç´¢å¼ï¼é»è®¤åå­ä¸º_id_ï¼è¯¥ç´¢å¼å¯é²æ­¢å®¢æ·ç«¯æå¥ä¸¤ä¸ªå·æç¸åå¼çææ¡£ï¼æ¨ä¸è½å¨_idå­æ®µä¸å é¤æ­¤ç´¢å¼ã\n\næ³¨æï¼è¯¥ç´¢å¼æ¯å¯ä¸ç´¢å¼ï¼å æ­¤å¼ä¸è½éå¤ï¼å³ _id å¼ä¸è½éå¤çãå¨åçéç¾¤ä¸­ï¼éå¸¸ä½¿ç¨ _id ä½ä¸ºçé®ã\n\n\n# 4.3.2 ç´¢å¼çåå»º\n\nè¯´æï¼å¨éåä¸åå»ºç´¢å¼ã\n\nè¯­æ³ï¼\n\ndb.collection.createindex(keys, options)\n\n\n1\n\n\nåæ°ï¼\n\nparameter   type       description\nkeys        document   åå«å­æ®µåå¼å¯¹çææ¡£ï¼å¶ä¸­å­æ®µæ¯ç´¢å¼é®ï¼å¼æè¿°è¯¥å­æ®µçç´¢å¼ç±»åãå¯¹äºå­æ®µä¸çååºç´¢å¼ï¼è¯·\n                       æå®å¼1ï¼å¯¹äºéåºç´¢å¼ï¼è¯·æå®å¼-1ãæ¯å¦ï¼ { å­æ®µ:1æ-1} ï¼å¶ä¸­1 ä¸ºæå®æååºåå»ºç´¢å¼ï¼å¦æä½ \n                       æ³æéåºæ¥åå»ºç´¢å¼æå®ä¸º -1 å³å¯ãå¦å¤ï¼mongodbæ¯æå ç§ä¸åçç´¢å¼ç±»åï¼åæ¬ææ¬ãå°çç©º é´ååå¸ç´¢å¼ã\noptions     document   å¯éãåå«ä¸ç»æ§å¶ç´¢å¼åå»ºçéé¡¹çææ¡£ãæå³è¯¦ç»ä¿¡æ¯ï¼è¯·åè§éé¡¹è¯¦æåè¡¨ã\n\noptionsï¼æ´å¤éé¡¹ï¼åè¡¨ï¼\n\nparameter            type            description\nbackground           boolean         å»ºç´¢å¼è¿ç¨ä¼é»å¡å¶å®æ°æ®åºæä½ï¼backgroundå¯æå®ä»¥åå°æ¹å¼åå»ºç´¢å¼ï¼å³å¢å  âbackgroundâ\n                                     å¯éåæ°ã âbackgroundâ é»è®¤å¼ä¸ºfalseã\nunique               boolean         å»ºç«çç´¢å¼æ¯å¦å¯ä¸ãæå®ä¸ºtrueåå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸ºfalse.\nname                 string          ç´¢å¼çåç§°ãå¦ææªæå®ï¼mongodbçéè¿è¿æ¥ç´¢å¼çå­æ®µååæåºé¡ºåºçæä¸ä¸ªç´¢å¼å ç§°ã\ndropdups             boolean         3.0+çæ¬å·²åºå¼ãå¨å»ºç«å¯ä¸ç´¢å¼æ¶æ¯å¦å é¤éå¤è®°å½,æå® true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸º false.\nsparse               boolean         å¯¹ææ¡£ä¸­ä¸å­å¨çå­æ®µæ°æ®ä¸å¯ç¨ç´¢å¼ï¼è¿ä¸ªåæ°éè¦ç¹å«æ³¨æï¼å¦æè®¾ç½®ä¸ºtrueçè¯ï¼å¨ç´¢\n                                     å¼å­æ®µä¸­ä¸ä¼æ¥è¯¢åºä¸åå«å¯¹åºå­æ®µçææ¡£.ãé»è®¤å¼ä¸º false.\nexpireafterseconds   integer         æå®ä¸ä¸ªä»¥ç§ä¸ºåä½çæ°å¼ï¼å®æ ttlè®¾å®ï¼è®¾å®éåççå­æ¶é´ã\nv                    index version   ç´¢å¼ççæ¬å·ãé»è®¤çç´¢å¼çæ¬åå³äºmongodåå»ºç´¢å¼æ¶è¿è¡ççæ¬ã\nweights              document        ç´¢å¼æéå¼ï¼æ°å¼å¨ 1 å° 99,999 ä¹é´ï¼è¡¨ç¤ºè¯¥ç´¢å¼ç¸å¯¹äºå¶ä»ç´¢å¼å­æ®µçå¾åæéã\ndefault_language     string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°å³å®äºåç¨è¯åè¯å¹²åè¯å¨çè§åçåè¡¨ã é»è®¤ä¸ºè±è¯­\nlanguage_override    string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°æå®äºåå«å¨ææ¡£ä¸­çå­æ®µåï¼è¯­è¨è¦çé»è®¤çlanguageï¼é»è®¤å¼ä¸º language.\n\næç¤ºï¼ æ³¨æå¨ 3.0.0 çæ¬ååå»ºç´¢å¼æ¹æ³ä¸º db.collection.ensureindex() ï¼ä¹åççæ¬ä½¿ç¨äº db.collection.createindex() æ¹æ³ï¼ensureindex() è¿è½ç¨ï¼ä½åªæ¯ createindex() çå«åã\n\nãç¤ºä¾ã\n\n# 4.3.2.1 åå­æ®µç´¢å¼\n\nç¤ºä¾ï¼å¯¹ userid å­æ®µå»ºç«ç´¢å¼ï¼\n\ndb.comment.createindex({userid:1})\n\n\n1\n\n\nåæ° 1ï¼æååºåå»ºç´¢å¼\n\ncompassæ¥çï¼\n\n\n\n# 4.3.2.2 å¤åç´¢å¼\n\nå¯¹ userid å nickname åæ¶å»ºç«å¤åï¼compoundï¼ç´¢å¼ï¼\n\ndb.comment.createindex({userid:1,nickname:-1})\n\n\n1\n\n\ncompass ä¸­ï¼\n\n\n\n\n# 4.3.3 ç´¢å¼çç§»é¤\n\nè¯´æï¼å¯ä»¥ç§»é¤æå®çç´¢å¼ï¼æç§»é¤ææç´¢å¼\n\n# 4.3.3.1 æå®ç´¢å¼çç§»é¤\n\nè¯­æ³ï¼\n\ndb.collection.dropindex(index)\n\n\n1\n\n\nåæ°ï¼\n\nparameter   type                 description\nindex       string or document   æå®è¦å é¤çç´¢å¼ãå¯ä»¥éè¿ç´¢å¼åç§°æç´¢å¼è§èææ¡£æå®ç´¢å¼ãè¥è¦å é¤ææ¬ç´¢å¼ï¼è¯·æå® ç´¢å¼åç§°ã\n\nãç¤ºä¾ã\n\nå é¤ comment éåä¸­ userid å­æ®µä¸çååºç´¢å¼ï¼\n\ndb.comment.dropindex({userid:1})\n\n\n1\n\n\n# 4.3.3.2 ææç´¢å¼çç§»é¤\n\nè¯­æ³ï¼\n\ndb.collection.dropindexes()\n\n\n1\n\n\nãç¤ºä¾ã\n\nå é¤ comment éåä¸­ææç´¢å¼ã\n\ndb.comment.dropindexes()\n\n\n1\n\n\næç¤ºï¼ _id çå­æ®µçç´¢å¼æ¯æ æ³å é¤çï¼åªè½å é¤é _id å­æ®µçç´¢å¼ã\n\n\n# 4.4 ç´¢å¼çä½¿ç¨\n\n\n# 4.4.1 æ§è¡è®¡å\n\nåææ¥è¯¢æ§è½ï¼analyze query performanceï¼éå¸¸ä½¿ç¨æ§è¡è®¡åï¼è§£éè®¡åãexplain planï¼æ¥æ¥çæ¥è¯¢çæåµï¼å¦æ¥è¯¢èè´¹çæ¶é´ãæ¯å¦åºäºç´¢å¼æ¥è¯¢ç­ã\n\né£ä¹ï¼éå¸¸ï¼æä»¬æ³ç¥éï¼å»ºç«çç´¢å¼æ¯å¦ææï¼ææå¦ä½ï¼é½éè¦éè¿æ§è¡è®¡åæ¥çã\n\nè¯­æ³ï¼\n\ndb.collection.find(query,options).explain(options)\n\n\n1\n\n\nãç¤ºä¾ã\n\næ¥çæ ¹æ®useridæ¥è¯¢æ°æ®çæåµï¼\n\n> db.comment.find({userid:"1003"}).explain()\n{\n    "queryplanner" : {\n        "plannerversion" : 1,\n        "namespace" : "articledb.comment",\n        "indexfilterset" : false,\n        "parsedquery" : {\n            "userid" : {\n                "$eq" : "1003"\n            }\n        },\n        "winningplan" : {\n            "stage" : "collscan",\n            "filter" : {\n                "userid" : {\n                    "$eq" : "1003"\n                }\n            },\n            "direction" : "forward"\n        },\n        "rejectedplans" : [ ]\n   },\n   "serverinfo" : {\n       "host" : "9ef3740277ad",\n       "port" : 27017,\n       "version" : "4.0.10",\n       "gitversion" : "c389e7f69f637f7a1ac3cc9fae843b635f20b766"\n   },\n   "ok" : 1\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n\n\nå³é®ç¹çï¼ âstageâ : âcollscanâ, è¡¨ç¤ºå¨éåæ«æ\n\n\n\nä¸é¢å¯¹useridå»ºç«ç´¢å¼\n\ndb.comment.createindex({userid:1})\n\n\n1\n\n\nåæ¬¡æ¥çæ§è¡è®¡åï¼\n\n> db.comment.find({userid:"1013"}).explain()\n{\n    "queryplanner" : {\n        "plannerversion" : 1,\n        "namespace" : "articledb.comment",\n        "indexfilterset" : false,\n        "parsedquery" : {\n            "userid" : {\n                "$eq" : "1013"\n            }\n        },\n        "winningplan" : {\n            "stage" : "fetch",\n            "inputstage" : {\n                "stage" : "ixscan",\n                "keypattern" : {\n                    "userid" : 1\n                },\n                "indexname" : "userid_1",\n                "ismultikey" : false,\n                "multikeypaths" : {\n                    "userid" : [ ]\n                 },\n                "isunique" : false,\n                "issparse" : false,\n                "ispartial" : false,\n                "indexversion" : 2,\n                "direction" : "forward",\n                "indexbounds" : {\n                    "userid" : [\n                        "[\\"1013\\", \\"1013\\"]"\n                    ]\n                }\n            }\n        },\n        "rejectedplans" : [ ]\n    },\n    "serverinfo" : {\n        "host" : "9ef3740277ad",\n        "port" : 27017,\n        "version" : "4.0.10",\n        "gitversion" : "c389e7f69f637f7a1ac3cc9fae843b635f20b766"\n    },\n    "ok" : 1\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n\n\nå³é®ç¹çï¼ âstageâ : âixscanâ ,åºäºç´¢å¼çæ«æ\n\ncompassæ¥çï¼\n\n\n\n\n# 4.4.2 æ¶µççæ¥è¯¢\n\ncovered queries\n\nå½æ¥è¯¢æ¡ä»¶åæ¥è¯¢çæå½±ä»åå«ç´¢å¼å­æ®µæ¶ï¼mongodbç´æ¥ä»ç´¢å¼è¿åç»æï¼èä¸æ«æä»»ä½ææ¡£æå°ææ¡£å¸¦å¥åå­ã è¿äºè¦ççæ¥è¯¢å¯ä»¥éå¸¸ææã\n\n\n\næ´å¤ï¼https://docs.mongodb.com/manual/core/query-optimization/#read-operations-covered-query\n\nãç¤ºä¾ã\n\n> db.comment.find({userid:"1003"},{userid:1,_id:0})\n{ "userid" : "1003" }\n{ "userid" : "1003" }\n> db.comment.find({userid:"1003"},{userid:1,_id:0}).explain()\n{\n    "queryplanner" : {\n        "plannerversion" : 1,\n        "namespace" : "articledb.comment",\n        "indexfilterset" : false,\n        "parsedquery" : {\n            "userid" : {\n                "$eq" : "1003"\n            }\n        },\n        "winningplan" : {\n            "stage" : "projection",\n            "transformby" : {\n                "userid" : 1,\n                "_id" : 0\n            },\n            "inputstage" : {\n                "stage" : "ixscan",\n                "keypattern" : {\n                    "userid" : 1\n                },\n                "indexname" : "userid_1",\n                "ismultikey" : false,\n                "multikeypaths" : {\n                    "userid" : [ ]\n                },\n                "isunique" : false,\n                "issparse" : false,\n                "ispartial" : false,\n                "indexversion" : 2,\n                "direction" : "forward",\n                "indexbounds" : {\n                    "userid" : [\n                        "[\\"1003\\", \\"1003\\"]"\n                    ]\n                }\n            }\n        },\n        "rejectedplans" : [ ]\n    },\n    "serverinfo" : {\n        "host" : "bobohost.localdomain",\n        "port" : 27017,\n        "version" : "4.0.10",\n        "gitversion" : "c389e7f69f637f7a1ac3cc9fae843b635f20b766"\n    },\n    "ok" : 1\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n\n\ncompass ä¸­ï¼\n\n\n\n\n# 5. æç« è¯è®º\n\n\n# 5.1 éæ±åæ\n\næå¤´æ¡çæç« è¯è®ºä¸å¡å¦ä¸ï¼\n\n\n\næç« ç¤ºä¾åèï¼æ©æ¨ç©ºè¹åæ°´ï¼æ¯å¯¹è¿æ¯éï¼ https://www.toutiao.com/a6721476546088927748/\n\néè¦å®ç°ä»¥ä¸åè½ï¼\n\n * åºæ¬å¢å æ¹æ¥api\n * æ ¹æ®æç« idæ¥è¯¢è¯è®º\n * è¯è®ºç¹èµ\n\n\n# 5.2 è¡¨ç»æåæ\n\næ°æ®åºï¼articledb\n\nä¸æ æç« è¯è®º           comment                     \nå­æ®µåç§°             å­æ®µå«ä¹      å­æ®µç±»å              å¤æ³¨\n_id              id        objectidæstring   mongoçä¸»é®çå­æ®µ\narticleid        æç« id      string            \ncontent          è¯è®ºåå®¹      string            \nuserid           è¯è®ºäººid     string            \nnickname         è¯è®ºäººæµç§°     string            \ncreatedatetime   è¯è®ºçæ¥ææ¶é´   date              \nlikenum          ç¹èµæ°       int32             \nreplynum         åå¤æ°       int32             \nstate            ç¶æ        string            0ï¼ä¸å¯è§ï¼1ï¼å¯è§ï¼\nparentid         ä¸çº§id      string            å¦æä¸º0è¡¨ç¤ºæç« çé¡¶çº§è¯è®º\n\n\n# 5.3 ææ¯éå\n\n\n# 5.3.1 mongodb-driver\n\nmongodb-driveræ¯mongoå®æ¹æ¨åºçjavaè¿æ¥mongodbçé©±å¨åï¼ç¸å½äºjdbcé©±å¨ãæä»¬éè¿ä¸ä¸ªå¥é¨çæ¡ä¾æ¥äºè§£mongodb-driverçåºæ¬ä½¿ç¨ã\n\nå®æ¹é©±å¨è¯´æåä¸è½½ï¼ http://mongodb.github.io/mongo-java-driver/\n\nå®æ¹é©±å¨ç¤ºä¾ææ¡£ï¼http://mongodb.github.io/mongo-java-driver/3.8/driver/getting-started/quick-start/\n\n\n# 5.3.2 springdatamongodb\n\nspringdataå®¶ææåä¹ä¸ï¼ç¨äºæä½mongodbçæä¹å±æ¡æ¶ï¼å°è£äºåºå±çmongodb-driverã\n\nå®ç½ä¸»é¡µï¼ https://projects.spring.io/spring-data-mongodb/\n\næä»¬åæ¬¡æ¹é¡¹ç®çåæ§½å¾®æå¡å°±éç¨springdatamongodbæ¡æ¶ã\n\n\n# 5.4 æç« å¾®æå¡æ¨¡åæ­å»º\n\nï¼1ï¼æ­å»ºé¡¹ç®å·¥ç¨articleï¼pom.xmlå¼å¥ä¾èµï¼\n\n<?xml version="1.0" encoding="utf-8"?>\n<project xmlns="http://maven.apache.org/pom/4.0.0"\n         xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n         xsi:schemalocation="http://maven.apache.org/pom/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n    <modelversion>4.0.0</modelversion>\n    <parent>\n        <groupid>org.springframework.boot</groupid>\n        <artifactid>spring-boot-starter-parent</artifactid>\n        <version>2.1.6.release</version>\n        <relativepath/>\n    </parent>\n    <groupid>com.wgy</groupid>\n    <artifactid>article</artifactid>\n    <version>1.0-snapshot</version>\n    <dependencies>\n        <dependency>\n            <groupid>org.springframework.boot</groupid>\n            <artifactid>spring-boot-starter-test</artifactid>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupid>org.springframework.boot</groupid>\n            <artifactid>spring-boot-starter-data-mongodb</artifactid>\n        </dependency>\n    </dependencies>\n</project>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n\nï¼ 2ï¼åå»ºapplication.yml\n\nspring:\n  #æ°æ®æºéç½®\n  data:\n    mongodb:\n      # ä¸»æºå°å\n      #host: 192.168.142.128\n      # æ°æ®åº\n      #database: articledb\n      # é»è®¤ç«¯å£æ¯27017\n      #port: 27017\n      #ä¹å¯ä»¥ä½¿ç¨uriè¿æ¥\n      uri: mongodb://192.168.142.128:27017/articledb\nserver:\n  # ç«¯å£\n  port: 80\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\nï¼ 3ï¼åå»ºå¯å¨ç±»\n\npackage com.wgy;\n\nimport org.springframework.boot.springapplication;\nimport org.springframework.boot.autoconfigure.springbootapplication;\n\n/**\n * å¯å¨ç±»\n *\n * @author wgy\n */\n@springbootapplication\npublic class articleapplication {\n\n    public static void main(string[] args) {\n        springapplication.run(articleapplication.class, args);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nï¼4ï¼å¯å¨é¡¹ç®ï¼çæ¯å¦è½æ­£å¸¸å¯å¨ï¼æ§å¶å°æ²¡æéè¯¯ã\n\n\n# 5.5 æç« è¯è®ºå®ä½ç±»çç¼å\n\nåå»ºå®ä½ç±» åå»ºåcom.wgy.articleï¼åä¸å»ºåpoç¨äºå­æ¾å®ä½ç±»ï¼åå»ºå®ä½ç±»\n\n/**\n * è¯è®ºå®ä½ç±»\n *\n * @author wgy\n */\n//æä¸ä¸ªjavaç±»å£°æä¸ºmongodbçææ¡£ï¼å¯ä»¥éè¿collectionåæ°æå®è¿ä¸ªç±»å¯¹åºçææ¡£ã\n//@document(collection="mongodb å¯¹åº collection å")\n// è¥æªå  @document ï¼è¯¥ bean save å° mongo ç comment collection\n// è¥æ·»å  @document ï¼å save å° comment collection\n@document(collection = "comment")//å¯ä»¥çç¥ï¼å¦æçç¥ï¼åé»è®¤ä½¿ç¨ç±»åå°åæ å°éå\n//å¤åç´¢å¼\n// @compoundindex( def = "{\'userid\': 1, \'nickname\': -1}")\npublic class comment implements serializable {\n\n    //ä¸»é®æ è¯ï¼è¯¥å±æ§çå¼ä¼èªå¨å¯¹åºmongodbçä¸»é®å­æ®µ"_id"ï¼å¦æè¯¥å±æ§åå°±å«âidâ,åè¯¥æ³¨è§£å¯ä»¥çç¥ï¼å¦åå¿é¡»å\n    @id\n    private string id;//ä¸»é®    //è¯¥å±æ§å¯¹åºmongodbçå­æ®µçåå­ï¼å¦æä¸è´ï¼åæ éè¯¥æ³¨è§£\n    @field("content")\n    private string content;//åæ§½åå®¹\n    private date publishtime;//åå¸æ¥æ    //æ·»å äºä¸ä¸ªåå­æ®µçç´¢å¼\n    @indexed\n    private string userid;//åå¸äººid\n    private string nickname;//æµç§°\n    private localdatetime createdatetime;//è¯è®ºçæ¥ææ¶é´\n    private integer likenum;//ç¹èµæ°\n    private integer replynum;//åå¤æ°\n    private string state;//ç¶æ\n    private string parentid;//ä¸çº§id\n    private string articleid;\n\n    //set/get/tostring...\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\nè¯´æï¼\n\nç´¢å¼å¯ä»¥å¤§å¤§æåæ¥è¯¢æçï¼ä¸è¬å¨æ¥è¯¢å­æ®µä¸æ·»å ç´¢å¼ï¼ç´¢å¼çæ·»å å¯ä»¥éè¿mongoçå½ä»¤æ¥æ·»å ï¼ä¹å¯ä»¥å¨javaçå®ä½ç±»ä¸­éè¿æ³¨è§£æ·»å ã\n\n1ï¼åå­æ®µç´¢å¼æ³¨è§£@indexed\n\norg.springframework.data.mongodb.core.index.indexed.class\n\nå£°æè¯¥å­æ®µéè¦ç´¢å¼ï¼å»ºç´¢å¼å¯ä»¥å¤§å¤§çæé«æ¥è¯¢æçã\n\nmongoå½ä»¤åèï¼\n\ndb.comment.createindex({"userid":1})\n\n\n1\n\n\n2 ï¼å¤åç´¢å¼æ³¨è§£@compoundindex\n\norg.springframework.data.mongodb.core.index.compoundindex.class\n\nå¤åç´¢å¼çå£°æï¼å»ºå¤åç´¢å¼å¯ä»¥ææå°æé«å¤å­æ®µçæ¥è¯¢æçã\n\nmongoå½ä»¤åèï¼\n\ndb.comment.createindex({"userid":1,"nickname":-1})\n\n\n1\n\n\n\n# 5.6 æç« è¯è®ºçåºæ¬å¢å æ¹æ¥\n\nï¼1ï¼åå»ºæ°æ®è®¿é®æ¥å£ com.wgy.articleåä¸åå»ºdaoåï¼åä¸åå»ºæ¥å£\n\n/**\n * è¯è®ºçæä¹å±æ¥å£\n *\n * @author wgy\n */\npublic interface commentrepository extends mongorepository<comment, string> {\n\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nï¼ 2ï¼åå»ºä¸å¡é»è¾ç±» com.wgy.articleåä¸åå»ºserviceåï¼åä¸åå»ºç±»\n\n/**\n * è¯è®ºçä¸å¡å±\n *\n * @author wgy\n */\n@service\npublic class commentservice {\n\n    //æ³¨å¥dao\n    @autowired\n    private commentrepository commentrepository;\n\n    /**\n     * ä¿å­ä¸ä¸ªè¯è®º\n     *\n     * @param comment\n     */\n    public void savecomment(comment comment) {\n        //å¦æéè¦èªå®ä¹ä¸»é®ï¼å¯ä»¥å¨è¿éæå®ä¸»é®ï¼å¦æä¸æå®ä¸»é®ï¼mongodbä¼èªå¨çæä¸»é®\n        //è®¾ç½®ä¸äºé»è®¤åå§å¼ããã\n        //è°ç¨dao\n        commentrepository.save(comment);\n    }\n\n    /**\n     * æ´æ°è¯è®º\n     *\n     * @param comment\n     */\n    public void updatecomment(comment comment) {\n        //è°ç¨dao\n        commentrepository.save(comment);\n    }\n\n    /**\n     * æ ¹æ®idå é¤è¯è®º\n     *\n     * @param id\n     */\n    public void deletecommentbyid(string id) {\n        //è°ç¨dao\n        commentrepository.deletebyid(id);\n    }\n\n    /**\n     * æ¥è¯¢ææè¯è®º\n     *\n     * @return\n     */\n    public list<comment> findcommentlist() {\n        //è°ç¨dao\n        return commentrepository.findall();\n    }\n\n    /**\n     * æ ¹æ®idæ¥è¯¢è¯è®º\n     *\n     * @param id\n     * @return\n     */\n    public comment findcommentbyid(string id) {\n        //è°ç¨dao\n        return commentrepository.findbyid(id).get();\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n\n\nï¼ 3ï¼æ°å»ºjunitæµè¯ç±»ï¼æµè¯ä¿å­åæ¥è¯¢ææï¼\n\n/**\n * è¯è®ºæµè¯ç±»\n *\n * @author wgy\n */\n@runwith(springrunner.class)\n@springboottest\npublic class commentservicetest {\n\n    @autowired\n    private commentservice commentservice;\n\n    /**\n     * æ¥è¯¢æææ°æ®\n     */\n    @test\n    public void testfindcommentlist() {\n        list<comment> commentlist = commentservice.findcommentlist();\n        system.out.println(commentlist);\n    }\n\n    /**\n     * æµè¯æ ¹æ®idæ¥è¯¢\n     */\n    @test\n    public void testfindcommentbyid() {\n        comment commentbyid = commentservice.findcommentbyid("1");\n        system.out.println(commentbyid);\n    }\n\n    /**\n     * ä¿å­ä¸ä¸ªè¯è®º\n     */\n    @test\n    public void testsavecomment() {\n        comment comment = new comment();\n        comment.setarticleid("100000");\n        comment.setcontent("æµè¯æ·»å çæ°æ®");\n        comment.setcreatedatetime(localdatetime.now());\n        comment.setuserid("1003");\n        comment.setnickname("å¯æå¤§å¸");\n        comment.setstate("1");\n        comment.setlikenum(0);\n        comment.setreplynum(0);\n        commentservice.savecomment(comment);\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n\n# 5.7 æ ¹æ®ä¸çº§idæ¥è¯¢æç« è¯è®ºçåé¡µåè¡¨\n\nï¼1ï¼commentrepositoryæ°å¢æ¹æ³å®ä¹\n\n/**\n * æ ¹æ®ç¶idï¼æ¥è¯¢å­è¯è®ºçåé¡µåè¡¨\n *\n * @param parentid\n * @param pageable\n * @return\n */\npage<comment> findbyparentid(string parentid, pageable pageable);\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nï¼2ï¼commentserviceæ°å¢æ¹æ³\n\n/**\n * æ ¹æ®ç¶idæ¥è¯¢åé¡µåè¡¨\n *\n * @param parentid\n * @param page\n * @param size\n * @return\n */\npublic page<comment> findcommentlistbyparentid(string parentid, int page, int size) {\n    return commentrepository.findbyparentid(parentid, pagerequest.of(page - 1, size));\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nï¼3ï¼junitæµè¯ç¨ä¾ï¼\n\n/**\n * æµè¯æ ¹æ®ç¶idæ¥è¯¢å­è¯è®ºçåé¡µåè¡¨\n */\n@test\npublic void testfindcommentlistbyparentid() {\n    page<comment> pageresponse = commentservice.findcommentlistbyparentid("3", 1, 2);\n    system.out.println("----æ»è®°å½æ°ï¼" + pageresponse.gettotalelements());\n    system.out.println("----å½åé¡µæ°æ®ï¼" + pageresponse.getcontent());\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nï¼4ï¼æµè¯\n\nä½¿ç¨compasså¿«éæå¥ä¸æ¡æµè¯æ°æ®ï¼æ°æ®çåå®¹æ¯å¯¹3å·è¯è®ºåå®¹è¿è¡è¯è®ºã\n\n\n\næ§è¡æµè¯ï¼ç»æï¼\n\n----æ»è®°å½æ°ï¼1\n----å½åé¡µæ°æ®ï¼[comment{id=\'33\', content=\'ä½ å¹´è½»ï¼ç«åå¤§\', publishtime=null, userid=\'1003\', nickname=\'å¯æå¤§å¸\',createdatetime=null, likenum=null, replynum=null, state=\'null\', parentid=\'3\', articleid=\'100001\'}]\n\n\n1\n2\n\n\n\n# 5.8 mongotemplate å®ç°è¯è®ºç¹èµ\n\næä»¬çä¸ä¸ä»¥ä¸ç¹èµçä¸´æ¶ç¤ºä¾ä»£ç ï¼ commentservice æ°å¢updatethumbupæ¹æ³\n\n/**\n * ç¹èµ-æçä½\n * @param id\n */\npublic void updatecommentthumbuptoincrementingold(string id){\n    comment comment = commentrepository.findbyid(id).get();\n    comment.setlikenum(comment.getlikenum()+1);\n    commentrepository.save(comment);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nä»¥ä¸æ¹æ³è½ç¶å®ç°èµ·æ¥æ¯è¾ç®åï¼ä½æ¯æ§è¡æçå¹¶ä¸é«ï¼å ä¸ºæåªéè¦å°ç¹èµæ°å  1å°±å¯ä»¥äºï¼æ²¡å¿è¦æ¥è¯¢åºææå­æ®µä¿®æ¹ååæ´æ°ææå­æ®µã(è´è¶æåº)\n\næä»¬å¯ä»¥ä½¿ç¨mongotemplateç±»æ¥å®ç°å¯¹æåçæä½ã ï¼1ï¼ä¿®æ¹commentservice\n\n//æ³¨å¥mongotemplate\n@autowired\nprivate mongotemplate mongotemplate;\n\n/**\n * ç¹èµæ°+1\n *\n * @param id\n */\npublic void updatecommentlikenum(string id) {\n\n    //  æ¥è¯¢æ¡ä»¶\n    query query = query.query(criteria.where("_id").is(id));\n    //  æ´æ°æ¡ä»¶\n    update update = new update();\n    //å±é¨æ´æ°ï¼ç¸å½äº$set\n//        update.set(key, value)\n    //éå¢$inc\n    update.inc("likenum");\n    //åæ°3ï¼éåçåå­æå®ä½ç±»çç±»åcomment.class\n    mongotemplate.updatefirst(query, update, comment.class);\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nï¼ 2ï¼æµè¯ç¨ä¾ï¼\n\n/**\n * æµè¯ç¹èµæ°+1\n */\n@test\npublic void testupdatecommentlikenum() {\n    commentservice.updatecommentlikenum("3");\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\næ§è¡æµè¯ç¨ä¾åï¼åç°ç¹èµæ°+1äºï¼\n\n\n\nåæé¾æ¥ï¼https://wgy1993.gitee.io/archives/d69f1e.html',charsets:{cjk:!0}},{title:"æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤",frontmatter:{title:"æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤",date:"2022-12-16T15:57:11.000Z",permalink:"/pages/26f193/",categories:["è¿ç»´","ç³»ç»","vmware"],tags:[null],readingShow:"top",description:"VMwarev Center Server æä¾äºä¸ä¸ªå¯ä¼¸ç¼©ãå¯æ©å±çå¹³å°ï¼ä¸ºèæåç®¡çå¥ å®äºåºç¡ãå¯éä¸­ç®¡çVMware vSphereç¯å¢ï¼ä¸å¶ä»ç®¡çå¹³å°ç¸æ¯ï¼æå¤§å°æé«äº IT ç®¡çåå¯¹èæç¯å¢çæ§å¶ã",meta:[{name:"image",content:"https://img-blog.csdnimg.cn/20201106091846329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3F5eTk3MDUyNQ==,size_16,color_FFFFFF,t_70#pic_center"},{name:"twitter:title",content:"æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤"},{name:"twitter:description",content:"VMwarev Center Server æä¾äºä¸ä¸ªå¯ä¼¸ç¼©ãå¯æ©å±çå¹³å°ï¼ä¸ºèæåç®¡çå¥ å®äºåºç¡ãå¯éä¸­ç®¡çVMware vSphereç¯å¢ï¼ä¸å¶ä»ç®¡çå¹³å°ç¸æ¯ï¼æå¤§å°æé«äº IT ç®¡çåå¯¹èæç¯å¢çæ§å¶ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://img-blog.csdnimg.cn/20201106091846329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3F5eTk3MDUyNQ==,size_16,color_FFFFFF,t_70#pic_center"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/01.vmware/01.%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96VMware%20ESXI%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html"},{property:"og:type",content:"article"},{property:"og:title",content:"æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤"},{property:"og:description",content:"VMwarev Center Server æä¾äºä¸ä¸ªå¯ä¼¸ç¼©ãå¯æ©å±çå¹³å°ï¼ä¸ºèæåç®¡çå¥ å®äºåºç¡ãå¯éä¸­ç®¡çVMware vSphereç¯å¢ï¼ä¸å¶ä»ç®¡çå¹³å°ç¸æ¯ï¼æå¤§å°æé«äº IT ç®¡çåå¯¹èæç¯å¢çæ§å¶ã"},{property:"og:image",content:"https://img-blog.csdnimg.cn/20201106091846329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3F5eTk3MDUyNQ==,size_16,color_FFFFFF,t_70#pic_center"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/01.vmware/01.%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96VMware%20ESXI%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-16T15:57:11.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤"},{itemprop:"description",content:"VMwarev Center Server æä¾äºä¸ä¸ªå¯ä¼¸ç¼©ãå¯æ©å±çå¹³å°ï¼ä¸ºèæåç®¡çå¥ å®äºåºç¡ãå¯éä¸­ç®¡çVMware vSphereç¯å¢ï¼ä¸å¶ä»ç®¡çå¹³å°ç¸æ¯ï¼æå¤§å°æé«äº IT ç®¡çåå¯¹èæç¯å¢çæ§å¶ã"},{itemprop:"image",content:"https://img-blog.csdnimg.cn/20201106091846329.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3F5eTk3MDUyNQ==,size_16,color_FFFFFF,t_70#pic_center"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/01.vmware/01.%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%99%9A%E6%8B%9F%E5%8C%96VMware%20ESXI%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html",relativePath:"04.è¿ç»´/09.ç³»ç»/01.vmware/01.æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤.md",key:"v-447429d0",path:"/pages/26f193/",headers:[{level:2,title:"æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤",slug:"æå¡å¨èæåvmware-esxiæ­å»ºéç¾¤",normalizedTitle:"æå¡å¨èæåvmware esxiæ­å»ºéç¾¤",charIndex:2},{level:2,title:"æè¦",slug:"æè¦",normalizedTitle:"æè¦",charIndex:28},{level:2,title:"ç¯å¢åå·¥å·åå¤",slug:"ç¯å¢åå·¥å·åå¤",normalizedTitle:"ç¯å¢åå·¥å·åå¤",charIndex:35},{level:2,title:"æå¡å¨å®è£èæå VMware ESXI",slug:"æå¡å¨å®è£èæå-vmware-esxi",normalizedTitle:"æå¡å¨å®è£èæå vmware esxi",charIndex:47},{level:2,title:"åå»ºèææºæä½ç³»ç»",slug:"åå»ºèææºæä½ç³»ç»",normalizedTitle:"åå»ºèææºæä½ç³»ç»",charIndex:72},{level:2,title:"Windows server 2012 R2å®è£",slug:"windows-server-2012-r2å®è£",normalizedTitle:"windows server 2012 r2å®è£",charIndex:86},{level:2,title:"å¨Windows Server 2012 R2 ä¸é¢å®è£vcenter",slug:"å¨windows-server-2012-r2-ä¸é¢å®è£vcenter",normalizedTitle:"å¨windows server 2012 r2 ä¸é¢å®è£vcenter",charIndex:115}],headersStr:"æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤ æè¦ ç¯å¢åå·¥å·åå¤ æå¡å¨å®è£èæå VMware ESXI åå»ºèææºæä½ç³»ç» Windows server 2012 R2å®è£ å¨Windows Server 2012 R2 ä¸é¢å®è£vcenter",content:"# æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤\n\n * æè¦\n\n * ç¯å¢åå·¥å·åå¤\n\n * æå¡å¨å®è£èæå VMware ESXI\n\n * åå»ºèææºæä½ç³»ç»\n\n * Windows server 2012 R2å®è£\n\n * å¨Windows Server 2012 R2 ä¸é¢å®è£vcenter\n\n\n# æè¦\n\nVMwarev Center Server æä¾äºä¸ä¸ªå¯ä¼¸ç¼©ãå¯æ©å±çå¹³å°ï¼ä¸ºèæåç®¡çå¥ å®äºåºç¡ãå¯éä¸­ç®¡çVMware vSphereç¯å¢ï¼ä¸å¶ä»ç®¡çå¹³å°ç¸æ¯ï¼æå¤§å°æé«äº IT ç®¡çåå¯¹èæç¯å¢çæ§å¶ã\n\nVMware vCenter Serverï¼æé«å¨èæåºç¡æ¶ææ¯ä¸ªçº§å«ä¸çéä¸­æ§å¶åå¯è§æ§ï¼éè¿ä¸»å¨ç®¡çåæ¥ vSphere æ½è½ï¼æ¯ä¸ä¸ªå·æå¹¿æ³åä½ä¼ä¼´ä½ç³»æ¯æçå¯ä¼¸ç¼©ãå¯æ©å±å¹³å°ã\n\næ è®ºæ¨æ¥æåå ä¸ªèææºï¼è¿æ¯å åä¸ªèææºï¼VMware vCenter Server é½æ¯ç®¡ç VMware vSphere æç®åãæææçæ¹æ³ãåå© VMware vCenter Serverï¼å¯ä»åä¸ªæ§å¶å°ç»ä¸ç®¡çæ°æ®ä¸­å¿çææä¸»æºåèææºï¼è¯¥æ§å¶å°èåäºéç¾¤ãä¸»æºåèææºçæ§è½çæ§åè½ã VMware vCenter Server ä½¿ç®¡çåè½å¤ä»ä¸ä¸ªä½ç½®æ·±å¥äºè§£èæåºç¡æ¶æçéç¾¤ãä¸»æºãèææºãå­å¨ãå®¢æ·æä½ç³»ç»åå¶ä»å³é®ç»ä»¶ç­ææä¿¡æ¯ã\n\nåå©VMware vCenter Serverï¼èæåç¯å¢åå¾æ´æäºç®¡çï¼ä¸ä¸ªç®¡çåå°±è½ç®¡ç 100 ä¸ªä»¥ä¸çå·¥ä½è´è½½ï¼å¨ç®¡çç©çåºç¡æ¶ææ¹é¢çå·¥ä½æçæ¯éå¸¸æåµæé«äºä¸åã\n\n\n# ç¯å¢åå·¥å·åå¤\n\n1.æå¡å¨ï¼ç©ºæºï¼\n\n2.VMware ESXI 6.7.0 å»å½çåç\n\n3.æ¾ç¤ºå±ï¼æ¥çº¿å¸¦å¨ï¼\n\n4.Windows Server 2012 R2çå»å½åç\n\n5.VMware-VIM-all-6.7.0.iso\n\n6.æå¥½å¸¦ä¸ä¸ªUçï¼æå¥½æ¯16GBçï¼è¶å¤§åèè¶å¥½ï¼\n\n\n# æå¡å¨å®è£èæå VMware ESXI\n\n1.è¿æå¡å¨çåçé©±å¨æ¨¡å¼è¿å¥ï¼ä¸è¬ä¼è¾å¥BISOå¯ç ï¼è¿å»ä¹åå°±æ¯æ­¤é¡µé¢\n\n\n\n2.è¿å¥ç¼å²åºï¼ç­å¾\n\n\n\n3.è¿å¥æ¬¢è¿çé¢ï¼æåè½¦ç»§ç»­\n\n\n\n4.è¿å¥å®è£è®¸å¯åè®®çé¢ï¼æF11ç»§ç»­\n\n\n\n5.ç³»ç»ä¼èªå¨æ£æ¥å¯ç¨å­å¨è®¾å¤ï¼å¦ææéè¦ï¼èªå·±æå¨éæ©ï¼æä¸ä¸é®ï¼éä¸­ä¹åæåè½¦ç»§ç»­ï¼æ³¨æESXIä¼æ ¼å¼åæ´ä¸ªç¡¬ç\n\n\n\n6.è¿éä¸è¬éæ©US defaultï¼ç¾å¼ï¼é®çï¼æåè½¦ç»§ç»­\n\n\n\n7.è®¾ç½®rootå¯ç ï¼æ³¨æè¿éå¿é¡»æ¯æ ååçå¯ç ï¼ç®åçéè¿ä¸äºï¼ç¶åæåè½¦ç»§ç»­\n\n\n\n8.éç½®ä¿¡æ¯å®æåï¼æ¥å°å®è£çé¢ï¼ç¶åæF11å¼å§å®è£\n\n\n\n9.ç­å¾å®è£è¿ç¨\n\n\n\n10.å®è£å®æï¼æåè½¦éå¯\n\n\n\n11.è¿å¥ç»å½çé¢\n\n\n\n12.ç¶åæF2é®ï¼è¿å¥rootè´¦å·ç»å½çé¢\n\n\n\n13.è¿å¥éé¡¹çé¢ï¼Configure Password ï¼éç½®rootå¯ç ï¼ Configure lockdown modeï¼éç½®éå®æ¨¡å¼ï¼Configure Management Network ï¼éç½®ç½ç»ï¼Restart Management Network ï¼éå¯ç½ç»ï¼Test Management Network ï¼ä½¿ç¨pingæµè¯ç½ç»ï¼Network Restore Options ï¼è¿åéç½®ï¼Troubleshooting Options ï¼æéææ¥éé¡¹ï¼View System Logs ï¼æ¥çç³»ç»æ¥å¿ï¼ Reset System Conf iguration ESXi ï¼åºåè®¾ç½®ï¼\n\n\n\n14.é¦åæä»¬éç½®å¯ç ,éä¸­ç¶ååè½¦\n\n\n\n15.è¿å¥ç½ç»éç½®éé¢ï¼è¿è¡éç½®ï¼éé¡¹æï¼Network Adapters ï¼ç½ç»ééå¨ï¼ VLANï¼opt ionalï¼IPv4 Configuration ï¼IPv4 å°åéç½®ï¼ IPv6 Configuration ï¼IPv6å°å éç½®ï¼ DNS Configuration ï¼DNSéç½®ï¼ Custom DNS Suffixes ï¼èªå®ä¹DNSï¼\n\n\n\n16.é¦åæä»¬éç½®ç½ç»ééå¨ï¼ä¸ä¸é®ç§»å¨ï¼ç©ºæ ¼éä¸­ç®æ ï¼åè½¦ç¡®è®¤ï¼èªå¨è¿åç½ç»éç½®é¡µé¢\n\n\n\n17.è¿å¥IPv4å°åéç½®ï¼éç½®å®æåï¼æåè½¦ç¡®å®\n\n\n\n18.éç½®å®æåï¼ç½å¡éç½®éè¦ç¡®è®¤ï¼æYç¡®è®¤ï¼\n\n\n\n19.ç¶åå»ç½é¡µä¸ç»å½ï¼è¾å¥ä½ èªå·±çIPå°åå³å¯ï¼è¾å¥ç¨æ·ï¼rootï¼åå¯ç \n\n\n\n20.è¾å¥ç¨æ·åå¯ç ï¼è¿å¥èæåå¹³å°\n\n\n\n\n# åå»ºèææºæä½ç³»ç»\n\n1.æä»¬è¿å¥èæåå¹³å°ï¼é¦åè¦åéè®¸å¯è¯ï¼ç¹å»ä¸»æºç®¡ç>è®¸å¯>åéè®¸å¯è¯ï¼è®¸å¯è¯ä¹¦å¯å¨ç½ä¸æ¥è¯¢\n\nè®¸å¯è¯ï¼VMware vSphere 6 Enterprise Plus ï¼0A65P-00HD0-3Z5M1-M097M-22P7H\n\n\n\n2.ä¸ä¼ ç³»ç»çéåï¼ç¹å»å­å¨>æ°æ®å­å¨>æ°æ®å­å¨æµè§å¨>ä¸è½½>éæ©éå\n\n\n\n3.åå»ºèææº\n\n\n\n\n\n\n\n\n\n\n\n\n\nåå»ºå®æåï¼æå¼èææºï¼è¿è¡æä½ç³»ç»çå®è£\n\n\n# Windows server 2012 R2å®è£\n\nå ä¸ºå®è£è¿ç¨è¿äºç®åï¼æä»¥åªè¯´ä¸ä¸æ­¥éª¤æä½\n\n1.å°Windows Server 2012 R2çåçæ¾å¥åé©±ï¼æå¼æå¡å¨ï¼éæ©ä»åé©±å¯å¨ï¼ç¶åè¿å¥å¯å¨çé¢\n\n2.ç­å¾å®è£ç¨åºå¯å¨ä¹åè¿å¥è¾å¥è¯­è¨åå¶ä»éé¡¹çè®¾ç½®é¡µé¢ï¼è¦å®è£çè¯­è¨ãæ¶é´åè´§å¸é½éæ©ä¸­æï¼é®çåè¾å¥æ¹æ³éå¾®è½¯æ¼é³ï¼ç¹å»ä¸ä¸æ­¥\n\n3.è¿å¥ç°å¨å®è£çé¢ï¼ç¹å»ç°å¨å®è£\n\n4.è¿å¥äº§åå®è£å¯é¥ï¼å¨ç½é¡µä¸æ¥æ¾ä¸ä¸ªï¼æå¨è¾å¥å³å¯ï¼ç¹å»ä¸ä¸æ­¥\n\n5.è¿å¥å®è£æä½ç³»ç»çæ¬çé¢ï¼å ä¸ºæä»¬æ¯è¦ä½¿ç¨çvcenterå¾å½¢çè¿è¡ç®¡çï¼æä»¥æä»¬éæ©å¸¦æGUIçæå¡å¨ï¼ç¹å»ä¸ä¸æ­¥\n\n6.è¿å¥è®¸å¯æ¡æ¬¾ï¼ç¹å»ææ¥åè®¸å¯æ¡æ¬¾ï¼ç¹å»ä¸ä¸æ­¥\n\n7.è¿å¥å®è£ç±»åçé¢ï¼æä»¬éæ©èªå®ä¹å®è£ï¼ä»¥ä¾¿æä»¬æ¥åççç»ç¡¬çååº\n\n8.è¿å¥ç¡¬çååºçé¢ï¼æä»¬éä¸­è¦ä»åªéåç©ºé´ï¼ç¶åæ°å»ºä¸ä¸ªååºï¼ç¶åæ ¼å¼åï¼ç¶åç¹å»ä¸ä¸æ­¥\n\n9.è¿å¥å®è£çé¢ï¼ç­å¾å®è£ç»æå³å¯ï¼å®è£å®æç¹å»ç«å³éå¯\n\n10.éå¯è¿å¥è®¾ç½®å¯ç ççé¢ï¼ä¸é»è®¤çç¨æ·é½æ¯Administratorï¼è®¾ç½®å®æç¹å»ç¡®å®\n\n11.éè¿æç¤ºçè¿å¥ç»å½é¡µé¢ï¼è¾å¥å¯ç ï¼è¿å¥ç³»ç»\n\n\n# å¨Windows Server 2012 R2 ä¸é¢å®è£vcenter\n\n1.ævcenteréåæ·è´å°æ¡é¢ä¸ï¼ç¶ååå»ï¼éåå°±ä¼å°æççµèçåºç°\n\n\n\n2.å®è£ä¼åºç°éè¯¯ï¼é¦åå®è£ä¸äºæä»¶åè¡¥ä¸ï¼ç»éªæå¾ï¼å®è£ä¸ä¸çä¸è¥¿\n\nwindows8.1-kb2919355-x64_e6f4da4d33564419065a7370865faacf9b40ff72.msu\n\nwindows8.1-kb2919442-x64_f97d8290d9d75d96f163095c4cb05e1b9f6986e0.msu\n\nwindows8.1-kb2932046-x64_6aee5fda6e2a6729d1fbae6eac08693acd70d985.msu\n\nWindows8.1-KB2934018-x64.msu\n\nwindows8.1-kb2937592-x64_4abc0a39c9e500c0fbe9c41282169c92315cafc2.msu\n\nwindows8.1-kb2938439-x64_3ed1574369e36b11f37af41aa3a875a115a3eac1 (1).msu\n\nWindows8.1-KB2959977-x64.msu\n\nWindows8.1-KB2999226-x64.msu\n\nå®è£C++ç¯å¢\n\nç½é¡µççflashpayerppæä»¶\n\n3.ä¸è½½å®æå³å¯å®è£\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nè¾å¥åæè®¾ç½®çIPå°åè®¿é®\n\n\n\nåæé¾æ¥ï¼https://blog.csdn.net/qyy970525/article/details/109844335",normalizedContent:"# æå¡å¨èæåvmware esxiæ­å»ºéç¾¤\n\n * æè¦\n\n * ç¯å¢åå·¥å·åå¤\n\n * æå¡å¨å®è£èæå vmware esxi\n\n * åå»ºèææºæä½ç³»ç»\n\n * windows server 2012 r2å®è£\n\n * å¨windows server 2012 r2 ä¸é¢å®è£vcenter\n\n\n# æè¦\n\nvmwarev center server æä¾äºä¸ä¸ªå¯ä¼¸ç¼©ãå¯æ©å±çå¹³å°ï¼ä¸ºèæåç®¡çå¥ å®äºåºç¡ãå¯éä¸­ç®¡çvmware vsphereç¯å¢ï¼ä¸å¶ä»ç®¡çå¹³å°ç¸æ¯ï¼æå¤§å°æé«äº it ç®¡çåå¯¹èæç¯å¢çæ§å¶ã\n\nvmware vcenter serverï¼æé«å¨èæåºç¡æ¶ææ¯ä¸ªçº§å«ä¸çéä¸­æ§å¶åå¯è§æ§ï¼éè¿ä¸»å¨ç®¡çåæ¥ vsphere æ½è½ï¼æ¯ä¸ä¸ªå·æå¹¿æ³åä½ä¼ä¼´ä½ç³»æ¯æçå¯ä¼¸ç¼©ãå¯æ©å±å¹³å°ã\n\næ è®ºæ¨æ¥æåå ä¸ªèææºï¼è¿æ¯å åä¸ªèææºï¼vmware vcenter server é½æ¯ç®¡ç vmware vsphere æç®åãæææçæ¹æ³ãåå© vmware vcenter serverï¼å¯ä»åä¸ªæ§å¶å°ç»ä¸ç®¡çæ°æ®ä¸­å¿çææä¸»æºåèææºï¼è¯¥æ§å¶å°èåäºéç¾¤ãä¸»æºåèææºçæ§è½çæ§åè½ã vmware vcenter server ä½¿ç®¡çåè½å¤ä»ä¸ä¸ªä½ç½®æ·±å¥äºè§£èæåºç¡æ¶æçéç¾¤ãä¸»æºãèææºãå­å¨ãå®¢æ·æä½ç³»ç»åå¶ä»å³é®ç»ä»¶ç­ææä¿¡æ¯ã\n\nåå©vmware vcenter serverï¼èæåç¯å¢åå¾æ´æäºç®¡çï¼ä¸ä¸ªç®¡çåå°±è½ç®¡ç 100 ä¸ªä»¥ä¸çå·¥ä½è´è½½ï¼å¨ç®¡çç©çåºç¡æ¶ææ¹é¢çå·¥ä½æçæ¯éå¸¸æåµæé«äºä¸åã\n\n\n# ç¯å¢åå·¥å·åå¤\n\n1.æå¡å¨ï¼ç©ºæºï¼\n\n2.vmware esxi 6.7.0 å»å½çåç\n\n3.æ¾ç¤ºå±ï¼æ¥çº¿å¸¦å¨ï¼\n\n4.windows server 2012 r2çå»å½åç\n\n5.vmware-vim-all-6.7.0.iso\n\n6.æå¥½å¸¦ä¸ä¸ªuçï¼æå¥½æ¯16gbçï¼è¶å¤§åèè¶å¥½ï¼\n\n\n# æå¡å¨å®è£èæå vmware esxi\n\n1.è¿æå¡å¨çåçé©±å¨æ¨¡å¼è¿å¥ï¼ä¸è¬ä¼è¾å¥bisoå¯ç ï¼è¿å»ä¹åå°±æ¯æ­¤é¡µé¢\n\n\n\n2.è¿å¥ç¼å²åºï¼ç­å¾\n\n\n\n3.è¿å¥æ¬¢è¿çé¢ï¼æåè½¦ç»§ç»­\n\n\n\n4.è¿å¥å®è£è®¸å¯åè®®çé¢ï¼æf11ç»§ç»­\n\n\n\n5.ç³»ç»ä¼èªå¨æ£æ¥å¯ç¨å­å¨è®¾å¤ï¼å¦ææéè¦ï¼èªå·±æå¨éæ©ï¼æä¸ä¸é®ï¼éä¸­ä¹åæåè½¦ç»§ç»­ï¼æ³¨æesxiä¼æ ¼å¼åæ´ä¸ªç¡¬ç\n\n\n\n6.è¿éä¸è¬éæ©us defaultï¼ç¾å¼ï¼é®çï¼æåè½¦ç»§ç»­\n\n\n\n7.è®¾ç½®rootå¯ç ï¼æ³¨æè¿éå¿é¡»æ¯æ ååçå¯ç ï¼ç®åçéè¿ä¸äºï¼ç¶åæåè½¦ç»§ç»­\n\n\n\n8.éç½®ä¿¡æ¯å®æåï¼æ¥å°å®è£çé¢ï¼ç¶åæf11å¼å§å®è£\n\n\n\n9.ç­å¾å®è£è¿ç¨\n\n\n\n10.å®è£å®æï¼æåè½¦éå¯\n\n\n\n11.è¿å¥ç»å½çé¢\n\n\n\n12.ç¶åæf2é®ï¼è¿å¥rootè´¦å·ç»å½çé¢\n\n\n\n13.è¿å¥éé¡¹çé¢ï¼configure password ï¼éç½®rootå¯ç ï¼ configure lockdown modeï¼éç½®éå®æ¨¡å¼ï¼configure management network ï¼éç½®ç½ç»ï¼restart management network ï¼éå¯ç½ç»ï¼test management network ï¼ä½¿ç¨pingæµè¯ç½ç»ï¼network restore options ï¼è¿åéç½®ï¼troubleshooting options ï¼æéææ¥éé¡¹ï¼view system logs ï¼æ¥çç³»ç»æ¥å¿ï¼ reset system conf iguration esxi ï¼åºåè®¾ç½®ï¼\n\n\n\n14.é¦åæä»¬éç½®å¯ç ,éä¸­ç¶ååè½¦\n\n\n\n15.è¿å¥ç½ç»éç½®éé¢ï¼è¿è¡éç½®ï¼éé¡¹æï¼network adapters ï¼ç½ç»ééå¨ï¼ vlanï¼opt ionalï¼ipv4 configuration ï¼ipv4 å°åéç½®ï¼ ipv6 configuration ï¼ipv6å°å éç½®ï¼ dns configuration ï¼dnséç½®ï¼ custom dns suffixes ï¼èªå®ä¹dnsï¼\n\n\n\n16.é¦åæä»¬éç½®ç½ç»ééå¨ï¼ä¸ä¸é®ç§»å¨ï¼ç©ºæ ¼éä¸­ç®æ ï¼åè½¦ç¡®è®¤ï¼èªå¨è¿åç½ç»éç½®é¡µé¢\n\n\n\n17.è¿å¥ipv4å°åéç½®ï¼éç½®å®æåï¼æåè½¦ç¡®å®\n\n\n\n18.éç½®å®æåï¼ç½å¡éç½®éè¦ç¡®è®¤ï¼æyç¡®è®¤ï¼\n\n\n\n19.ç¶åå»ç½é¡µä¸ç»å½ï¼è¾å¥ä½ èªå·±çipå°åå³å¯ï¼è¾å¥ç¨æ·ï¼rootï¼åå¯ç \n\n\n\n20.è¾å¥ç¨æ·åå¯ç ï¼è¿å¥èæåå¹³å°\n\n\n\n\n# åå»ºèææºæä½ç³»ç»\n\n1.æä»¬è¿å¥èæåå¹³å°ï¼é¦åè¦åéè®¸å¯è¯ï¼ç¹å»ä¸»æºç®¡ç>è®¸å¯>åéè®¸å¯è¯ï¼è®¸å¯è¯ä¹¦å¯å¨ç½ä¸æ¥è¯¢\n\nè®¸å¯è¯ï¼vmware vsphere 6 enterprise plus ï¼0a65p-00hd0-3z5m1-m097m-22p7h\n\n\n\n2.ä¸ä¼ ç³»ç»çéåï¼ç¹å»å­å¨>æ°æ®å­å¨>æ°æ®å­å¨æµè§å¨>ä¸è½½>éæ©éå\n\n\n\n3.åå»ºèææº\n\n\n\n\n\n\n\n\n\n\n\n\n\nåå»ºå®æåï¼æå¼èææºï¼è¿è¡æä½ç³»ç»çå®è£\n\n\n# windows server 2012 r2å®è£\n\nå ä¸ºå®è£è¿ç¨è¿äºç®åï¼æä»¥åªè¯´ä¸ä¸æ­¥éª¤æä½\n\n1.å°windows server 2012 r2çåçæ¾å¥åé©±ï¼æå¼æå¡å¨ï¼éæ©ä»åé©±å¯å¨ï¼ç¶åè¿å¥å¯å¨çé¢\n\n2.ç­å¾å®è£ç¨åºå¯å¨ä¹åè¿å¥è¾å¥è¯­è¨åå¶ä»éé¡¹çè®¾ç½®é¡µé¢ï¼è¦å®è£çè¯­è¨ãæ¶é´åè´§å¸é½éæ©ä¸­æï¼é®çåè¾å¥æ¹æ³éå¾®è½¯æ¼é³ï¼ç¹å»ä¸ä¸æ­¥\n\n3.è¿å¥ç°å¨å®è£çé¢ï¼ç¹å»ç°å¨å®è£\n\n4.è¿å¥äº§åå®è£å¯é¥ï¼å¨ç½é¡µä¸æ¥æ¾ä¸ä¸ªï¼æå¨è¾å¥å³å¯ï¼ç¹å»ä¸ä¸æ­¥\n\n5.è¿å¥å®è£æä½ç³»ç»çæ¬çé¢ï¼å ä¸ºæä»¬æ¯è¦ä½¿ç¨çvcenterå¾å½¢çè¿è¡ç®¡çï¼æä»¥æä»¬éæ©å¸¦æguiçæå¡å¨ï¼ç¹å»ä¸ä¸æ­¥\n\n6.è¿å¥è®¸å¯æ¡æ¬¾ï¼ç¹å»ææ¥åè®¸å¯æ¡æ¬¾ï¼ç¹å»ä¸ä¸æ­¥\n\n7.è¿å¥å®è£ç±»åçé¢ï¼æä»¬éæ©èªå®ä¹å®è£ï¼ä»¥ä¾¿æä»¬æ¥åççç»ç¡¬çååº\n\n8.è¿å¥ç¡¬çååºçé¢ï¼æä»¬éä¸­è¦ä»åªéåç©ºé´ï¼ç¶åæ°å»ºä¸ä¸ªååºï¼ç¶åæ ¼å¼åï¼ç¶åç¹å»ä¸ä¸æ­¥\n\n9.è¿å¥å®è£çé¢ï¼ç­å¾å®è£ç»æå³å¯ï¼å®è£å®æç¹å»ç«å³éå¯\n\n10.éå¯è¿å¥è®¾ç½®å¯ç ççé¢ï¼ä¸é»è®¤çç¨æ·é½æ¯administratorï¼è®¾ç½®å®æç¹å»ç¡®å®\n\n11.éè¿æç¤ºçè¿å¥ç»å½é¡µé¢ï¼è¾å¥å¯ç ï¼è¿å¥ç³»ç»\n\n\n# å¨windows server 2012 r2 ä¸é¢å®è£vcenter\n\n1.ævcenteréåæ·è´å°æ¡é¢ä¸ï¼ç¶ååå»ï¼éåå°±ä¼å°æççµèçåºç°\n\n\n\n2.å®è£ä¼åºç°éè¯¯ï¼é¦åå®è£ä¸äºæä»¶åè¡¥ä¸ï¼ç»éªæå¾ï¼å®è£ä¸ä¸çä¸è¥¿\n\nwindows8.1-kb2919355-x64_e6f4da4d33564419065a7370865faacf9b40ff72.msu\n\nwindows8.1-kb2919442-x64_f97d8290d9d75d96f163095c4cb05e1b9f6986e0.msu\n\nwindows8.1-kb2932046-x64_6aee5fda6e2a6729d1fbae6eac08693acd70d985.msu\n\nwindows8.1-kb2934018-x64.msu\n\nwindows8.1-kb2937592-x64_4abc0a39c9e500c0fbe9c41282169c92315cafc2.msu\n\nwindows8.1-kb2938439-x64_3ed1574369e36b11f37af41aa3a875a115a3eac1 (1).msu\n\nwindows8.1-kb2959977-x64.msu\n\nwindows8.1-kb2999226-x64.msu\n\nå®è£c++ç¯å¢\n\nç½é¡µççflashpayerppæä»¶\n\n3.ä¸è½½å®æå³å¯å®è£\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nè¾å¥åæè®¾ç½®çipå°åè®¿é®\n\n\n\nåæé¾æ¥ï¼https://blog.csdn.net/qyy970525/article/details/109844335",charsets:{cjk:!0}},{title:"proftpdç¯å¢é¨ç½²",frontmatter:{title:"proftpdç¯å¢é¨ç½²",date:"2022-12-21T17:59:19.000Z",permalink:"/pages/affcf2/",categories:["è¿ç»´","ç³»ç»","ftp"],tags:[null],readingShow:"top",description:"Proftpdçå¨ç§°æ¯Professional FTP daemonï¼æ¯éå¯¹Wu-FTPçå¼±é¡¹èå¼åçï¼è½¯ä»¶å¨ç»è¿å¤å¹´çåå±ä¹åå®åäºå¾å¤åè½ï¼ProFTPå·²ç»æä¸ºç»§Wu-FTPä¹åæä¸ºæµè¡çFTPæå¡å¨è½¯ä»¶ï¼è¶æ¥è¶å¤çç«ç¹éç¨å®æç­å®å¨é«æçFTPç«ç¹ãProftpdè½¯ä»¶åvsftpdä¸æ ·æ¯ä¸ä¸ªå¼æ¾æºä»£ç çftpæå¡å¨è½¯ä»¶ï¼ä½æ¯å¯éç½®é¡¹æ¯vsftpdè¦å¤ï¼æ¯ç®åæ¯è¾æµè¡çftpè½¯ä»¶ï¼Proftpdçéç½®åapacheçéç½®ç¸ä¼¼ï¼å æ­¤è¯¥è½¯ä»¶ä¹ååå®¹æéç½®åç®¡çã",meta:[{name:"image",content:"https://img2018.cnblogs.com/blog/907596/201907/907596-20190712120948336-1260009529.png"},{name:"twitter:title",content:"proftpdç¯å¢é¨ç½²"},{name:"twitter:description",content:"Proftpdçå¨ç§°æ¯Professional FTP daemonï¼æ¯éå¯¹Wu-FTPçå¼±é¡¹èå¼åçï¼è½¯ä»¶å¨ç»è¿å¤å¹´çåå±ä¹åå®åäºå¾å¤åè½ï¼ProFTPå·²ç»æä¸ºç»§Wu-FTPä¹åæä¸ºæµè¡çFTPæå¡å¨è½¯ä»¶ï¼è¶æ¥è¶å¤çç«ç¹éç¨å®æç­å®å¨é«æçFTPç«ç¹ãProftpdè½¯ä»¶åvsftpdä¸æ ·æ¯ä¸ä¸ªå¼æ¾æºä»£ç çftpæå¡å¨è½¯ä»¶ï¼ä½æ¯å¯éç½®é¡¹æ¯vsftpdè¦å¤ï¼æ¯ç®åæ¯è¾æµè¡çftpè½¯ä»¶ï¼Proftpdçéç½®åapacheçéç½®ç¸ä¼¼ï¼å æ­¤è¯¥è½¯ä»¶ä¹ååå®¹æéç½®åç®¡çã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://img2018.cnblogs.com/blog/907596/201907/907596-20190712120948336-1260009529.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/02.ftp/01.proftpd%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2.html"},{property:"og:type",content:"article"},{property:"og:title",content:"proftpdç¯å¢é¨ç½²"},{property:"og:description",content:"Proftpdçå¨ç§°æ¯Professional FTP daemonï¼æ¯éå¯¹Wu-FTPçå¼±é¡¹èå¼åçï¼è½¯ä»¶å¨ç»è¿å¤å¹´çåå±ä¹åå®åäºå¾å¤åè½ï¼ProFTPå·²ç»æä¸ºç»§Wu-FTPä¹åæä¸ºæµè¡çFTPæå¡å¨è½¯ä»¶ï¼è¶æ¥è¶å¤çç«ç¹éç¨å®æç­å®å¨é«æçFTPç«ç¹ãProftpdè½¯ä»¶åvsftpdä¸æ ·æ¯ä¸ä¸ªå¼æ¾æºä»£ç çftpæå¡å¨è½¯ä»¶ï¼ä½æ¯å¯éç½®é¡¹æ¯vsftpdè¦å¤ï¼æ¯ç®åæ¯è¾æµè¡çftpè½¯ä»¶ï¼Proftpdçéç½®åapacheçéç½®ç¸ä¼¼ï¼å æ­¤è¯¥è½¯ä»¶ä¹ååå®¹æéç½®åç®¡çã"},{property:"og:image",content:"https://img2018.cnblogs.com/blog/907596/201907/907596-20190712120948336-1260009529.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/02.ftp/01.proftpd%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-21T17:59:19.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"proftpdç¯å¢é¨ç½²"},{itemprop:"description",content:"Proftpdçå¨ç§°æ¯Professional FTP daemonï¼æ¯éå¯¹Wu-FTPçå¼±é¡¹èå¼åçï¼è½¯ä»¶å¨ç»è¿å¤å¹´çåå±ä¹åå®åäºå¾å¤åè½ï¼ProFTPå·²ç»æä¸ºç»§Wu-FTPä¹åæä¸ºæµè¡çFTPæå¡å¨è½¯ä»¶ï¼è¶æ¥è¶å¤çç«ç¹éç¨å®æç­å®å¨é«æçFTPç«ç¹ãProftpdè½¯ä»¶åvsftpdä¸æ ·æ¯ä¸ä¸ªå¼æ¾æºä»£ç çftpæå¡å¨è½¯ä»¶ï¼ä½æ¯å¯éç½®é¡¹æ¯vsftpdè¦å¤ï¼æ¯ç®åæ¯è¾æµè¡çftpè½¯ä»¶ï¼Proftpdçéç½®åapacheçéç½®ç¸ä¼¼ï¼å æ­¤è¯¥è½¯ä»¶ä¹ååå®¹æéç½®åç®¡çã"},{itemprop:"image",content:"https://img2018.cnblogs.com/blog/907596/201907/907596-20190712120948336-1260009529.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/02.ftp/01.proftpd%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2.html",relativePath:"04.è¿ç»´/09.ç³»ç»/02.ftp/01.proftpdç¯å¢é¨ç½².md",key:"v-64021198",path:"/pages/affcf2/",headers:[{level:2,title:"proftpdä»ç»",slug:"proftpdä»ç»",normalizedTitle:"proftpdä»ç»",charIndex:2},{level:2,title:"proftpå®è£è®°å½",slug:"proftpå®è£è®°å½",normalizedTitle:"proftpå®è£è®°å½",charIndex:1141}],headersStr:"proftpdä»ç» proftpå®è£è®°å½",content:'# proftpdä»ç»\n\nProftpdçå¨ç§°æ¯Professional FTP daemonï¼æ¯éå¯¹Wu-FTPçå¼±é¡¹èå¼åçï¼è½¯ä»¶å¨ç»è¿å¤å¹´çåå±ä¹åå®åäºå¾å¤åè½ï¼ProFTPå·²ç»æä¸ºç»§Wu-FTPä¹åæä¸ºæµè¡çFTPæå¡å¨è½¯ä»¶ï¼è¶æ¥è¶å¤çç«ç¹éç¨å®æç­å®å¨é«æçFTPç«ç¹ãProftpdè½¯ä»¶åvsftpdä¸æ ·æ¯ä¸ä¸ªå¼æ¾æºä»£ç çftpæå¡å¨è½¯ä»¶ï¼ä½æ¯å¯éç½®é¡¹æ¯vsftpdè¦å¤ï¼æ¯ç®åæ¯è¾æµè¡çftpè½¯ä»¶ï¼Proftpdçéç½®åapacheçéç½®ç¸ä¼¼ï¼å æ­¤è¯¥è½¯ä»¶ä¹ååå®¹æéç½®åç®¡çã\n\nProftpdåVSftpdäºèåºå«\n===== vsftpd =====Â Â \nå¨ç§°Very secure FTP daemonãæ¯ProFTPDÂ å·ææ´é«çå®å¨æ§ãvsftpdä½¿ç¨ä¸è¬èº«ä»½å¯å¨æå¡ï¼éä½äºFTPæå¡çPIDæéï¼ä½¿è¯¥æå¡å³ä½¿è¢«å¥ä¾µä¹æ æ³å¾å°ææçç³»ç»ç®¡çæéãåæ¶vsftpdå©ç¨chrootè½¯ä»¶æ¥æ¹åç»å½èçæ ¹ç®å½ï¼ä½¿ç»éèåªè½å¨è¿ä¸ªç®å½ä¸­æ´»å¨ï¼éå¶äºç»å½èçæ§è¡æéãvsftpdéè¿éç½®vsftpd.confæä»¶æ¥å®æé¨ç½²ï¼è®¾å®ç®åï¼ç»å½èä»åä¸ºanonymousåreal user ä¸¤ç§ãå¯ä»¥ä½¿ç¨standaloneåsuper daemonçæ¹å¼å¯å¨ãvsftpdæ æ³æ§å¶æ¯ä¸ªç®å½çæµéãä¸è½æ§å¶ä¸ä¼ åä¸è½½çæ¯ä¾ãä¸è½éå¯¹ä¸åçç»éèè¿è¡ä¸åçæéè®¾å®ã\n\n===== Proftpd=====\nç±äºProftpdå¨èªèº«çåå§ç ä¸­å·²ç»åå«äºæéè¦çæ§è¡æä»¤ï¼ä¸éè¦Linuxç³»ç»æ¬æºçæ§è¡ç¨åºçæ¯æï¼æä»¥å¨ç³»ç»å®å¨ä¸æ´ä¸ºå®å¨ãéç½®ç®åä¸çµæ´»ï¼å®è£ååªéè¦è®¾å®proftpd.confä¸ä¸ªéç½®æä»¶å³å¯ï¼å¯éç½®æ§æ´å¼ºãå¯ä»¥ä½¿ç¨stand-aloneæèsuper daemonæ¹å¼æ¥å¯å¨ftpæå¡ãProftpdå¯ä»¥æ§å¶ä¸ä¸ä¼ æ¯ä¾ï¼å®ç°æµéæ§å¶ï¼éå¯¹ä¸åçç®å½è®¾å®ä¸åçæéãç»å½èåä¸ºanonymousåreal userä¸¤ç§ã\n\nProftpdæ¯è¾å¥½ç¨çåè½æä»¥ä¸å ç¹ï¼\n1ï¼ç®å½è®¿é®æééç½®çµæ´»ï¼éç½®ç®åã\n2ï¼è½å¤ä¸ä¾èµç³»ç»ç¨æ·ï¼å¯ä»¥ä½¿ç¨ç¬ç«çèæç¨æ·ç³»ç»ï¼ä½¿ç¨è¿Serv-Uçæååºè¯¥æ·±æä½ä¼ï¼éç½®éå¸¸æ¹ä¾¿ï¼å¯¹åæç³»ç»ç¯å¢å½±åè¾å°ï¼\n3ï¼å¯¹ä¸­æçæ¯æè¯å¥½ï¼å®ç¾è§£å³vsftpdä¸­æå¼å·bugãå ä¸ºvsftpdå¨ä¸­ææ¯ææ¹é¢å­å¨bugï¼å¯¹ä¸­æä¸­ä¸äºå­ç¬¦çæ¯æä¸æ¯å¾å¥½ï¼æ¯å¦å¯¹ä¸­æçåå¼å·æ¯æä¸æ¯å¾å¥½ï¼ã\n\nFTPé¨ç½²çèæ¯\nå¬å¸åä¸ªé¨é¨åå«ä¸ºè¿ç»´é¨ãå¼åé¨ãéå®é¨ãè¡æ¿é¨ï¼\n1ï¼åé¨é¨ç¨æ·è®¿é®FTPåå¯ä»¥çå°ææç®å½ï¼ä»å¯ä»¥è®¿é®æ¬é¨é¨çç®å½ï¼\n2ï¼éè¦FTPæ¥å¿åè½ï¼\n3ï¼FTPè®¤è¯æ¹å¼åºäºæä»¶è®¤è¯æ¹å¼ï¼\n4ï¼å±äº«ç®å½ï¼/var/ftp;\n\n\n# proftpå®è£è®°å½\n\næµè¯æºå¨ä¸ºCentos7.5ï¼iptablesåselinuxåå³é­\n \n1ï¼ä¸è½½ProFTP\n[root@localhost ~]# wget ftp://ftp.proftpd.org/distrib/source/proftpd-1.3.6.tar.gz\n[root@localhost ~]# tar -zvxf proftpd-1.3.6.tar.gz -C /usr/src/\n[root@localhost ~]# cd  /usr/src/proftpd-1.3.6/\n[root@localhost proftpd-1.3.6]# ./configure  --prefix=/usr/local/proftpd  --sysconfdir=/etc/  --enable-nls  --enable-openssl  --enable-shadow\n \n==================================================================================================================\nç¼è¯åæ°è¯´æï¼å¯éè¿"./configure --help" æ¥çå¸®å©éé¡¹ï¼ï¼\n--prefix=PREFIX         æå®å®è£è·¯å¾ï¼--prefix=/usr/local/)              \n--sysconfdir=DIR        æå®FTPæå¡éç½®æä»¶è·¯å¾(--sysconfdir=/etc)                  \n--localstatedir=DIR     æå®è¿è¡ç¶æçæä»¶å­æ¾ä½ç½®(é»è®¤/var/proftpd)                 \n--with-modules=mod_ldap æå®å è½½åè½æ¨¡å                        \n--enable-memcache       æ¯æç¼å­åè½                          \n--enable-nls            æ¯æå¤è¯­è¨ç¯å¢ï¼å¦ä¸­æï¼ï¼å®è£å®æåå¨ä¸»éç½®æä»¶ä¸­éè¦æå®å­ç¬¦ç¼ç ï¼UseEncoding UTF-8 CP936ï¼ \n--enable-openssl        æ¯æTLSå å¯FTPæå¡                        \n--enable-shadow         æ¯æä½¿ç¨/etc/shadowéªè¯ç¨æ·å¯ç \n \n==================================================================================================================\n \næ³¨æéè¦GCCç¼è¯å¨ \n[root@localhost proftpd-1.3.6]# make\n[root@localhost proftpd-1.3.6]# make install\n \n \n2ï¼æ·»å ç¯å¢åé\n[root@localhost proftpd-1.3.6]# vim /etc/profile\n........\nPATH=$PATH:/usr/local/proftpd/bin\n \n[root@localhost proftpd-1.3.6]# source /etc/profile\n \n3ï¼åå»ºå¯å¨ç¨æ·åç»(è¯¥ç¨æ·æ æ³ç»å½ç³»ç»ï¼æ²¡æå®¿ä¸»ç®å½)\n[root@localhost ~]# useradd proftp -s /sbin/nologin -M\n \n4ï¼å»ºç«å±äº«ç®å½\n[root@localhost ~]# mkdir -p /var/ftp/è¿ç»´é¨\n[root@localhost ~]# mkdir -p /var/ftp/å¼åé¨\n[root@localhost ~]# mkdir -p /var/ftp/éå®é¨\n[root@localhost ~]# mkdir -p /var/ftp/è¡æ¿é¨\n[root@localhost ~]# useradd -M -s /sbin/nologin  yunwei\n[root@localhost ~]# useradd -M -s /sbin/nologin  kaifa\n[root@localhost ~]# useradd -M -s /sbin/nologin  xiaoshou\n[root@localhost ~]# useradd -M -s /sbin/nologin  xingzheng\n[root@localhost ~]# chmod 777  /var/ftp/è¿ç»´é¨\n[root@localhost ~]# chmod 777  /var/ftp/å¼åé¨\n[root@localhost ~]# chmod 777  /var/ftp/éå®é¨\n[root@localhost ~]# chmod 777  /var/ftp/è¡æ¿é¨\n \n================proftpdéç½®åæä»¶è§£é==============\n[root@localhost ~]# cat /etc/proftpd.conf|grep -v "#"|grep -v "^$"\nServerName                      "ProFTPD Default Installation"     #å®¢æ·ç«¯è¿æ¥åæ¾ç¤ºçå­ç¬¦\nServerType                      standalone                         #æå¡å¯å¨æ¨¡å¼\nDefaultServer                   on                                \nPort                            21          #ç«¯å£\nUseIPv6                         off         #ç¦ç¨IPv6\nUmask                           022         #æéæ©ç \nMaxInstances                    30          #å¹¶åè¿ç¨30ä¸ªï¼é²DoSæ»å»)\nUser                            nobody      #å¯å¨æå¡çç¨æ·\nGroup                           nogroup     #å¯å¨æå¡çç»\n#DefaultRoot ~                              #å±äº«æ ¹ç®å½ï¼é»è®¤ä¸ºç¨æ·å®¶ç®å½ï¼\nAllowOverwrite          on                  #æ¯å¦åè®¸ä½¿ç¨æä»¶è¦åæé\n<Limit SITE_CHMOD>                          #æéè®¾ç½®\n  DenyAll\n</Limit>\n<Anonymous ~ftp>\n  User                          ftp\n  Group                         ftp\n  UserAlias                     anonymous ftp     #ç¨æ·å«å\n  MaxClients                    10                #æå¤§å®¢æ·ç«¯è¿æ¥æ°\n  DisplayLogin                  welcome.msg       #æ¾ç¤ºç»å½ä¿¡æ¯\n  DisplayChdir                  .message\n  <Limit WRITE>                                   #æéè®¾ç½®\n    DenyAll\n  </Limit>\n</Anonymous>\n \n=================è¯¥æä»¶æ ¼å¼===================\n##########################################################################\n#   å¨å±è®¾ç½®  åæ°å¼                                                                                                  \n#                                                                       \n#   <Directory  "è·¯å¾"> æå®è·¯å¾ç¸å³è®¾ç½®ï¼å¯ä»¥ä½¿ç¨Limitè¯­æ³éå¶ç®å½æé \n#         ... ...                                                       \n#   ... ...                                                       \n#   </Directory>                                                        \n#                             \n#                                                                       \n#                 \n#   <anonymouse "è·¯å¾">   å¿åå±äº«è·¯å¾ç¸å³è®¾ç½®ï¼åæ¬æéè®¾ç½®ï¼    \n#   </anonymouse>                   \n#########################################################################\n \n==============Limitæéè¯´æ================\n#########################################################################\n#  CWD:æ¹åæå¨ç®å½ ï¼å³Change Working Directory   è¡¨ç¤ºè¿å¥è¯¥ç®å½ï¼\n#  MKD/XMKD:æ°å»ºç®å½\n#  RNFR/RNTO:éå½åç®å½ç(ä¸èµ·ä½¿ç¨) ï¼å³æ´å\n#  DELE:å é¤æä»¶\n#  RMD/XRMD:å é¤ç®å½ ï¼å³Remove Directoryï¼\n#  RETR:ä¸è½½\n#  STOR:ä¸ä¼ \n#  LOGIN:åè®¸ç»é\n#  READ: å¯è¯»ï¼åæ¬äºRETR,SITE,SIZE,STAT\n#  WRITE: å¯åï¼åæ¬åæ¬äºAPPE, DELE, MKD, RMD, RNTO, STOR, XMKD, XRMD\n#  DIRS: åè®¸ååºç®å½ï¼åæ¬äºDUP, CWD, LIST, MDTM, NLST, PWD, RNFR, XCUP, XCWD, XPWD\n#  ALL:åæ¬äºREAD WRITE DIRS\n#######################ä»¥ä¸æéç»åå¨ä½ä¸èµ·ä½¿ç¨#####################\n#  AllowUser:åè®¸æä¸ªç¨æ·\n#  DenyUser:ç¦æ­¢æä¸ªç¨æ·\n#  AllowGroup:åè®¸æä¸ªç¨æ·ç»\n#  DenyGroup:ç¦æ­¢æä¸ªç¨æ·ç»\n#  AllowAll:åè®¸ææç¨æ·\n#  DenyAll:ç¦æ­¢ææç¨æ·\n#########################################################################\n \n5ï¼ä¿®æ¹/etc/proftpd.confæä»¶ï¼é¨ååå®¹ä¸ºæ·»å åå®¹\n[root@localhost ~]# cat /etc/proftpd.conf\nServerName                      "ProFTPD Default Installation"\nServerType                      standalone\nDefaultServer                   on\nUseEncoding UTF-8 CP936                    #æ¯æçç¼ç æ ¼å¼(ä¸­æ)\nPort                            21\nAllowRetrieveRestart            on         #åè®¸æ­ç¹ç»§ä¼ ï¼ä¸ä¼ ï¼ \nAllowStoreRestart               on         #åè®¸æ­ç¹ç»§ä¼ ï¼ä¸è½½ï¼ \nUseIPv6                         off\nUmask                           022\nRootLogin                       off        #ç¦æ­¢rootç»å½ftp\nMaxInstances                    30\nSystemLog                       /var/log/proftp.log   #äº§çç¬ç«çæ¥å¿æä»¶. (å¦ææ³æå®èªå·±çæ¥å¿æ ¼å¼å¯ä»¥ç»åï¼ExtendLogï¼LogFormatï¼ä¸¤ä¸ªéé¡¹è®¾ç½®)\nTransferLog                     /var/log/proftp.log   #è®°å½ç¨æ·ä¸è½½çæ¥å¿ä¿¡æ¯\nUser                            proftp     #è®¾ç½®å¯å¨ç¨æ·ä¸ºproftp\nGroup                           proftp     #è®¾ç½®å¯å¨ç»ä¸ºproftp\nDefaultRoot /var/ftp                       #æå®å±äº«æ ¹ç®å½ä¸º/var/ftp\nAllowOverwrite                  on\n#<Anonymous ~ftp>                          #è¯¥é¨åå¨é¨#æ³¨éï¼åæ¶å¿åè®¿é®åè½\n#  User       ftp\n#  Group      ftp\n#  UserAlias      anonymous ftp        \n#  MaxClients     10           \n#  DisplayLogin     welcome.msg        \n#  DisplayChdir     .message\n#  <Limit WRITE>                 \n#    DenyAll\n#  </Limit>\n#</Anonymous>\n \n#ä»¥ä¸åå®¹ä¸ºè®¾ç½®æéï¼ä¸ºæå¨æ·»å åå®¹     \n#ææç¨æ·å¯ä»¥çå°ææé¨é¨çæä»¶å¤¹ï¼ä»å¯ä»¥è®¿é®èªå·±é¨é¨çç®å½\nRequireValidShell off                            #ç¨æ·ç»å½æ¯å¦éè¦shellï¼å¯¹èæç¨æ·å¾éè¦ï¼\nAuthUserFile /usr/local/proftpd/ftpd.passwd      #éè¿æä»¶è®¤è¯ç¨æ·ç»å½ï¼éè¦ftpasswdå½ä»¤åå»ºè¯¥æä»¶\n<Directory "/var/ftp/*">\n<Limit CWD READ>                                 #åè®¸ææäººå¯ä»¥æ¥çæ ¹ç®å½\n    AllowAll\n</Limit>\n</Directory>\n<Directory "/var/ftp/è¿ç»´é¨">\n<Limit CWD MKD RNFR READ WRITE STOR RETR>\n    DenyAll                                      #æç»ææäººå¾è¯¥ç®å½ä¸æ§è¡Limitåçæä½æä»¤\n</Limit>\n<Limit DELE>\n    DenyAll                                      #ç¦æ­¢ä»»ä½äººå¨è¯¥ç®å½ä¸å é¤æä»¶\n</Limit>\n<Limit CWD MKD RNFR READ WRITE STOR RETR>\n    AllowUser yunwei                             #ä»åè®¸yunweiç¨æ·å¯ä»¥æ§è¡Limitåçæææä»¤\n</Limit>\n</Directory>\n <Directory "/var/ftp/å¼åé¨">\n <Limit CWD MKD RNFR READ WRITE STOR RETR>\n    DenyAll\n</Limit>\n<Limit DELE>\n    DenyAll\n</Limit>\n<Limit CWD MKD RNFR READ WRITE STOR RETR>\n    AllowUser kaifa\n</Limit>\n</Directory>\n<Directory "/var/ftp/è¡æ¿é¨">\n<Limit CWD MKD RNFR READ WRITE STOR RETR>\n    DenyAll\n</Limit>\n<Limit DELE>\n   DenyAll\n</Limit>\n<Limit CWD MKD RNFR READ WRITE STOR RETR>\n   AllowUser xingzheng\n</Limit>\n</Directory>\n<Directory "/var/ftp/éå®é¨">\n<Limit CWD MKD RNFR READ WRITE STOR RETR>\n   DenyAll\n</Limit>\n<Limit DELE>\n   DenyAll\n</Limit>\n<Limit CWD MKD RNFR READ WRITE STOR RETR>\n   AllowUser xiaoshou\n</Limit>\n</Directory>\n \n6ï¼ç¨ftpasswdå½ä»¤å»ºç«èæè´¦å·ï¼ä¸é¢å½ä»¤ä¹å¯ä»¥ç´æ¥ç¨äºä¿®æ¹ç¨æ·å¯ç ï¼\nftpasswdå½ä»¤æ ¼å¼è¯´æ ï¼è¯¥å½ä»¤å¯ä»¥åå»ºç¨æ·æä»¶ãç»æä»¶ï¼é»è®¤åå»ºçç¨æ·æä»¶ä¸ºftpd.passwdï¼ï¼\n--passwd  åå»ºå¯ç æä»¶ï¼å³AuthUserFileæå®çæä»¶\n--group   åå»ºç»æä»¶\n--name    æå®åå»ºçç¨æ·å\n--uid     æå®ç¨æ·èæUID\n--gid     æå®èæGID\n--home    æå®ç¨æ·å®¶ç®å½\n--shell   æå®ç¨æ·Shell\n--file    æå®åå»ºçæä»¶å\n \n[root@localhost ~]# ftpasswd  --passwd --file=/usr/local/proftpd/ftpd.passwd --name=yunwei  --uid=1000  --home=/home/nohome  --shell=/bin/false\nftpasswd: using alternate file: /usr/local/proftpd/ftpd.passwd\nftpasswd: --passwd: missing --gid argument: default gid set to uid\nftpasswd: creating passwd entry for user yunwei\n \nftpasswd: /bin/false is not among the valid system shells.  Use of\nftpasswd: "RequireValidShell off" may be required, and the PAM\nftpasswd: module configuration may need to be adjusted.\n \n \nPassword:\nRe-type password:\n \nftpasswd: entry created\n \nç¨æ·è®¤è¯æä»¶åå»ºåçæéæ¯440\n[root@localhost ~]# ll /usr/local/proftpd/ftpd.passwd\n-r--r-----. 1 root root 77 Jul 12 10:59 /usr/local/proftpd/ftpd.passwd\n[root@localhost ~]# cat /usr/local/proftpd/ftpd.passwd\nyunwei:$1$UEKjLwfY$FXV4SHlLeAOGEc2wrZa.M/:1000:1000::/home/nohome:/bin/false\n \n7ï¼å¯å¨FTPæå¡\næ£æ¥éç½®æä»¶æ¯å¦æ­£å¸¸\n[root@localhost ~]# /usr/local/proftpd/sbin/proftpd -t6\nChecking syntax of configuration file\nSyntax check complete.\n \n[root@localhost ~]# /usr/local/proftpd/sbin/proftpd\n \n[root@localhost ~]# ps -ef|grep proftpd\nproftp   13438     1  0 11:01 ?        00:00:00 proftpd: (accepting connections)\nroot     13440 13349  0 11:01 pts/2    00:00:00 grep --color=auto proftpd\n \n[root@localhost ~]# lsof -i:21\nCOMMAND   PID   USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME\nproftpd 13438 proftp    0u  IPv4 2066796      0t0  TCP *:ftp (LISTEN)\n \nè¿éä»ä»¥ç¨æ·ä¸ºå®éªç¯å¢ï¼è¿å¯ä»¥å®ç°ç»åè½ï¼è¿éå°±ä¸åè¿å¤ä»ç»äºï¼\n=====================================================================================\nå¦æéç½®ç»åè½ï¼ååå»ºèæè´¦å·ç»çå½ä»¤å¦ä¸\n# ftpasswd --group --file=/usr/local/proftpd/ftpd.group --name=admin --gid=99\n# ftpasswd --group --name=admin --gid=99 --member=ftpadmin\n=====================================================================================\n \n8ï¼ProFtpdå¯å¨èæ¬\n[root@localhost ~]# mkdir /usr/local/proftpd/etc\n[root@localhost ~]# ln -s /etc/proftpd.conf /usr/local/proftpd/etc/\n[root@localhost ~]# ll /usr/local/proftpd/etc/\ntotal 0\nlrwxrwxrwx. 1 root root 17 Jul 12 11:21 proftpd.conf -> /etc/proftpd.conf\n \n[root@localhost ~]# cat /etc/rc.d/init.d/proftpd\n#!/bin/bash \n# \n# chkconfig: 2345 85 15 \n# description: ProFTPd is an FTP server \n# processname: proftpd \n   \n# Author:   jingyihome \n# E-mail:   webmaster@zhanghaijun.com \n# Website:  https://www.zhanghaijun.com \n   \n# ProFTPd Settings \nPROFTPD="/usr/local/proftpd/sbin/proftpd" \nPROCONF="/usr/local/proftpd/etc/proftpd.conf" \nPROPID="/usr/local/proftpd/var/proftpd.pid" \nRETVAL=0 \nprog="ProFTPd" \n   \nstart() { \n    echo -n $"Starting $prog... " \n    $PROFTPD -c $PROCONF \n    if [ "$?" = 0 ] ; then \n        echo " done" \n    else \n        echo " failed" \n    fi \n} \n   \nstop() { \n    echo -n $"Stopping $prog...  " \n    if [ ! -e $PROPID ]; then \n        echo -n $"$prog is not running." \n        exit 1 \n    fi \n    kill `cat $PROPID` \n    if [ "$?" = 0 ] ; then \n        echo " done" \n    else \n        echo " failed" \n    fi \n} \n   \nrestart(){ \n    echo $"Restarting $prog..." \n    $0 stop \n    sleep 2 \n    $0 start \n} \n   \nstatus(){ \n    if [ -e $PROPID ]; then \n        echo $"$prog is running." \n    else \n        echo $"$prog is not running." \n    fi \n} \n   \ncase "$1" in \n    start) \n        start \n        ;; \n    stop) \n        stop \n        ;; \n    restart) \n        restart \n        ;; \n    status) \n        status \n        ;; \n  *) \n        echo $"Usage: $0 {start|stop|restart|status}" \nesac \n \næäºæ§è¡æé\n[root@localhost ~]# chmod 755 /etc/rc.d/init.d/proftpd\n[root@localhost ~]# ll /etc/rc.d/init.d/proftpd\n-rwxr-xr-x. 1 root root 1370 Jul 12 11:20 /etc/rc.d/init.d/proftpd\n[root@localhost ~]# ll /etc/init.d/proftpd\n-rwxr-xr-x. 1 root root 1370 Jul 12 11:20 /etc/init.d/proftpd\n \næµè¯proftpdèæ¬å¯å\n[root@localhost ~]# /etc/init.d/proftpd stop\nStopping ProFTPd...   done\n[root@localhost ~]# lsof -i:21\n[root@localhost ~]#\n \n[root@localhost ~]# /etc/init.d/proftpd start\nStarting ProFTPd...  done\n[root@localhost ~]# lsof -i:21              \nCOMMAND   PID   USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME\nproftpd 13503 proftp    0u  IPv4 2066913      0t0  TCP *:ftp (LISTEN)\n \n \n9ï¼å¦æè¿æ¥FTPæ¶éåº¦æ¢ï¼å¯ä»¥å¨proftpdéç½®æä»¶proftpd.confä¸­å å¥ä»¥ä¸åå®¹ï¼\n# Slow logins\n# This is probably caused by a firewall or DNS timeout. By default ProFTPD will try to do both DNS and ident lookups against the\n# incoming connection. If these are blocked or excessively delayed a slower than normal login will result. To turn off DNS and ident\n# use:\nUseReverseDNS off\nIdentLookups off\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n286\n287\n288\n289\n290\n291\n292\n293\n294\n295\n296\n297\n298\n299\n300\n301\n302\n303\n304\n305\n306\n307\n308\n309\n310\n311\n312\n313\n314\n315\n316\n317\n318\n319\n320\n321\n322\n323\n324\n325\n326\n327\n328\n329\n330\n331\n332\n333\n334\n335\n336\n337\n338\n339\n340\n341\n342\n343\n344\n345\n346\n347\n348\n349\n350\n351\n352\n353\n354\n355\n356\n357\n358\n359\n360\n361\n362\n363\n364\n\n\n\n\n\n\nåèé¾æ¥\n\nCentOSä¸Proftpdç¯å¢é¨ç½²å¹¶ä½¿ç¨èæç¨æ·ç»å½ - è¿ç»´ç¬è®° - æ£å°½æµ®å - åå®¢å­',normalizedContent:'# proftpdä»ç»\n\nproftpdçå¨ç§°æ¯professional ftp daemonï¼æ¯éå¯¹wu-ftpçå¼±é¡¹èå¼åçï¼è½¯ä»¶å¨ç»è¿å¤å¹´çåå±ä¹åå®åäºå¾å¤åè½ï¼proftpå·²ç»æä¸ºç»§wu-ftpä¹åæä¸ºæµè¡çftpæå¡å¨è½¯ä»¶ï¼è¶æ¥è¶å¤çç«ç¹éç¨å®æç­å®å¨é«æçftpç«ç¹ãproftpdè½¯ä»¶åvsftpdä¸æ ·æ¯ä¸ä¸ªå¼æ¾æºä»£ç çftpæå¡å¨è½¯ä»¶ï¼ä½æ¯å¯éç½®é¡¹æ¯vsftpdè¦å¤ï¼æ¯ç®åæ¯è¾æµè¡çftpè½¯ä»¶ï¼proftpdçéç½®åapacheçéç½®ç¸ä¼¼ï¼å æ­¤è¯¥è½¯ä»¶ä¹ååå®¹æéç½®åç®¡çã\n\nproftpdåvsftpdäºèåºå«\n===== vsftpd =====Â Â \nå¨ç§°very secure ftp daemonãæ¯proftpdÂ å·ææ´é«çå®å¨æ§ãvsftpdä½¿ç¨ä¸è¬èº«ä»½å¯å¨æå¡ï¼éä½äºftpæå¡çpidæéï¼ä½¿è¯¥æå¡å³ä½¿è¢«å¥ä¾µä¹æ æ³å¾å°ææçç³»ç»ç®¡çæéãåæ¶vsftpdå©ç¨chrootè½¯ä»¶æ¥æ¹åç»å½èçæ ¹ç®å½ï¼ä½¿ç»éèåªè½å¨è¿ä¸ªç®å½ä¸­æ´»å¨ï¼éå¶äºç»å½èçæ§è¡æéãvsftpdéè¿éç½®vsftpd.confæä»¶æ¥å®æé¨ç½²ï¼è®¾å®ç®åï¼ç»å½èä»åä¸ºanonymousåreal user ä¸¤ç§ãå¯ä»¥ä½¿ç¨standaloneåsuper daemonçæ¹å¼å¯å¨ãvsftpdæ æ³æ§å¶æ¯ä¸ªç®å½çæµéãä¸è½æ§å¶ä¸ä¼ åä¸è½½çæ¯ä¾ãä¸è½éå¯¹ä¸åçç»éèè¿è¡ä¸åçæéè®¾å®ã\n\n===== proftpd=====\nç±äºproftpdå¨èªèº«çåå§ç ä¸­å·²ç»åå«äºæéè¦çæ§è¡æä»¤ï¼ä¸éè¦linuxç³»ç»æ¬æºçæ§è¡ç¨åºçæ¯æï¼æä»¥å¨ç³»ç»å®å¨ä¸æ´ä¸ºå®å¨ãéç½®ç®åä¸çµæ´»ï¼å®è£ååªéè¦è®¾å®proftpd.confä¸ä¸ªéç½®æä»¶å³å¯ï¼å¯éç½®æ§æ´å¼ºãå¯ä»¥ä½¿ç¨stand-aloneæèsuper daemonæ¹å¼æ¥å¯å¨ftpæå¡ãproftpdå¯ä»¥æ§å¶ä¸ä¸ä¼ æ¯ä¾ï¼å®ç°æµéæ§å¶ï¼éå¯¹ä¸åçç®å½è®¾å®ä¸åçæéãç»å½èåä¸ºanonymousåreal userä¸¤ç§ã\n\nproftpdæ¯è¾å¥½ç¨çåè½æä»¥ä¸å ç¹ï¼\n1ï¼ç®å½è®¿é®æééç½®çµæ´»ï¼éç½®ç®åã\n2ï¼è½å¤ä¸ä¾èµç³»ç»ç¨æ·ï¼å¯ä»¥ä½¿ç¨ç¬ç«çèæç¨æ·ç³»ç»ï¼ä½¿ç¨è¿serv-uçæååºè¯¥æ·±æä½ä¼ï¼éç½®éå¸¸æ¹ä¾¿ï¼å¯¹åæç³»ç»ç¯å¢å½±åè¾å°ï¼\n3ï¼å¯¹ä¸­æçæ¯æè¯å¥½ï¼å®ç¾è§£å³vsftpdä¸­æå¼å·bugãå ä¸ºvsftpdå¨ä¸­ææ¯ææ¹é¢å­å¨bugï¼å¯¹ä¸­æä¸­ä¸äºå­ç¬¦çæ¯æä¸æ¯å¾å¥½ï¼æ¯å¦å¯¹ä¸­æçåå¼å·æ¯æä¸æ¯å¾å¥½ï¼ã\n\nftpé¨ç½²çèæ¯\nå¬å¸åä¸ªé¨é¨åå«ä¸ºè¿ç»´é¨ãå¼åé¨ãéå®é¨ãè¡æ¿é¨ï¼\n1ï¼åé¨é¨ç¨æ·è®¿é®ftpåå¯ä»¥çå°ææç®å½ï¼ä»å¯ä»¥è®¿é®æ¬é¨é¨çç®å½ï¼\n2ï¼éè¦ftpæ¥å¿åè½ï¼\n3ï¼ftpè®¤è¯æ¹å¼åºäºæä»¶è®¤è¯æ¹å¼ï¼\n4ï¼å±äº«ç®å½ï¼/var/ftp;\n\n\n# proftpå®è£è®°å½\n\næµè¯æºå¨ä¸ºcentos7.5ï¼iptablesåselinuxåå³é­\n \n1ï¼ä¸è½½proftp\n[root@localhost ~]# wget ftp://ftp.proftpd.org/distrib/source/proftpd-1.3.6.tar.gz\n[root@localhost ~]# tar -zvxf proftpd-1.3.6.tar.gz -c /usr/src/\n[root@localhost ~]# cd  /usr/src/proftpd-1.3.6/\n[root@localhost proftpd-1.3.6]# ./configure  --prefix=/usr/local/proftpd  --sysconfdir=/etc/  --enable-nls  --enable-openssl  --enable-shadow\n \n==================================================================================================================\nç¼è¯åæ°è¯´æï¼å¯éè¿"./configure --help" æ¥çå¸®å©éé¡¹ï¼ï¼\n--prefix=prefix         æå®å®è£è·¯å¾ï¼--prefix=/usr/local/)              \n--sysconfdir=dir        æå®ftpæå¡éç½®æä»¶è·¯å¾(--sysconfdir=/etc)                  \n--localstatedir=dir     æå®è¿è¡ç¶æçæä»¶å­æ¾ä½ç½®(é»è®¤/var/proftpd)                 \n--with-modules=mod_ldap æå®å è½½åè½æ¨¡å                        \n--enable-memcache       æ¯æç¼å­åè½                          \n--enable-nls            æ¯æå¤è¯­è¨ç¯å¢ï¼å¦ä¸­æï¼ï¼å®è£å®æåå¨ä¸»éç½®æä»¶ä¸­éè¦æå®å­ç¬¦ç¼ç ï¼useencoding utf-8 cp936ï¼ \n--enable-openssl        æ¯ætlså å¯ftpæå¡                        \n--enable-shadow         æ¯æä½¿ç¨/etc/shadowéªè¯ç¨æ·å¯ç \n \n==================================================================================================================\n \næ³¨æéè¦gccç¼è¯å¨ \n[root@localhost proftpd-1.3.6]# make\n[root@localhost proftpd-1.3.6]# make install\n \n \n2ï¼æ·»å ç¯å¢åé\n[root@localhost proftpd-1.3.6]# vim /etc/profile\n........\npath=$path:/usr/local/proftpd/bin\n \n[root@localhost proftpd-1.3.6]# source /etc/profile\n \n3ï¼åå»ºå¯å¨ç¨æ·åç»(è¯¥ç¨æ·æ æ³ç»å½ç³»ç»ï¼æ²¡æå®¿ä¸»ç®å½)\n[root@localhost ~]# useradd proftp -s /sbin/nologin -m\n \n4ï¼å»ºç«å±äº«ç®å½\n[root@localhost ~]# mkdir -p /var/ftp/è¿ç»´é¨\n[root@localhost ~]# mkdir -p /var/ftp/å¼åé¨\n[root@localhost ~]# mkdir -p /var/ftp/éå®é¨\n[root@localhost ~]# mkdir -p /var/ftp/è¡æ¿é¨\n[root@localhost ~]# useradd -m -s /sbin/nologin  yunwei\n[root@localhost ~]# useradd -m -s /sbin/nologin  kaifa\n[root@localhost ~]# useradd -m -s /sbin/nologin  xiaoshou\n[root@localhost ~]# useradd -m -s /sbin/nologin  xingzheng\n[root@localhost ~]# chmod 777  /var/ftp/è¿ç»´é¨\n[root@localhost ~]# chmod 777  /var/ftp/å¼åé¨\n[root@localhost ~]# chmod 777  /var/ftp/éå®é¨\n[root@localhost ~]# chmod 777  /var/ftp/è¡æ¿é¨\n \n================proftpdéç½®åæä»¶è§£é==============\n[root@localhost ~]# cat /etc/proftpd.conf|grep -v "#"|grep -v "^$"\nservername                      "proftpd default installation"     #å®¢æ·ç«¯è¿æ¥åæ¾ç¤ºçå­ç¬¦\nservertype                      standalone                         #æå¡å¯å¨æ¨¡å¼\ndefaultserver                   on                                \nport                            21          #ç«¯å£\nuseipv6                         off         #ç¦ç¨ipv6\numask                           022         #æéæ©ç \nmaxinstances                    30          #å¹¶åè¿ç¨30ä¸ªï¼é²dosæ»å»)\nuser                            nobody      #å¯å¨æå¡çç¨æ·\ngroup                           nogroup     #å¯å¨æå¡çç»\n#defaultroot ~                              #å±äº«æ ¹ç®å½ï¼é»è®¤ä¸ºç¨æ·å®¶ç®å½ï¼\nallowoverwrite          on                  #æ¯å¦åè®¸ä½¿ç¨æä»¶è¦åæé\n<limit site_chmod>                          #æéè®¾ç½®\n  denyall\n</limit>\n<anonymous ~ftp>\n  user                          ftp\n  group                         ftp\n  useralias                     anonymous ftp     #ç¨æ·å«å\n  maxclients                    10                #æå¤§å®¢æ·ç«¯è¿æ¥æ°\n  displaylogin                  welcome.msg       #æ¾ç¤ºç»å½ä¿¡æ¯\n  displaychdir                  .message\n  <limit write>                                   #æéè®¾ç½®\n    denyall\n  </limit>\n</anonymous>\n \n=================è¯¥æä»¶æ ¼å¼===================\n##########################################################################\n#   å¨å±è®¾ç½®  åæ°å¼                                                                                                  \n#                                                                       \n#   <directory  "è·¯å¾"> æå®è·¯å¾ç¸å³è®¾ç½®ï¼å¯ä»¥ä½¿ç¨limitè¯­æ³éå¶ç®å½æé \n#         ... ...                                                       \n#   ... ...                                                       \n#   </directory>                                                        \n#                             \n#                                                                       \n#                 \n#   <anonymouse "è·¯å¾">   å¿åå±äº«è·¯å¾ç¸å³è®¾ç½®ï¼åæ¬æéè®¾ç½®ï¼    \n#   </anonymouse>                   \n#########################################################################\n \n==============limitæéè¯´æ================\n#########################################################################\n#  cwd:æ¹åæå¨ç®å½ ï¼å³change working directory   è¡¨ç¤ºè¿å¥è¯¥ç®å½ï¼\n#  mkd/xmkd:æ°å»ºç®å½\n#  rnfr/rnto:éå½åç®å½ç(ä¸èµ·ä½¿ç¨) ï¼å³æ´å\n#  dele:å é¤æä»¶\n#  rmd/xrmd:å é¤ç®å½ ï¼å³remove directoryï¼\n#  retr:ä¸è½½\n#  stor:ä¸ä¼ \n#  login:åè®¸ç»é\n#  read: å¯è¯»ï¼åæ¬äºretr,site,size,stat\n#  write: å¯åï¼åæ¬åæ¬äºappe, dele, mkd, rmd, rnto, stor, xmkd, xrmd\n#  dirs: åè®¸ååºç®å½ï¼åæ¬äºdup, cwd, list, mdtm, nlst, pwd, rnfr, xcup, xcwd, xpwd\n#  all:åæ¬äºread write dirs\n#######################ä»¥ä¸æéç»åå¨ä½ä¸èµ·ä½¿ç¨#####################\n#  allowuser:åè®¸æä¸ªç¨æ·\n#  denyuser:ç¦æ­¢æä¸ªç¨æ·\n#  allowgroup:åè®¸æä¸ªç¨æ·ç»\n#  denygroup:ç¦æ­¢æä¸ªç¨æ·ç»\n#  allowall:åè®¸ææç¨æ·\n#  denyall:ç¦æ­¢ææç¨æ·\n#########################################################################\n \n5ï¼ä¿®æ¹/etc/proftpd.confæä»¶ï¼é¨ååå®¹ä¸ºæ·»å åå®¹\n[root@localhost ~]# cat /etc/proftpd.conf\nservername                      "proftpd default installation"\nservertype                      standalone\ndefaultserver                   on\nuseencoding utf-8 cp936                    #æ¯æçç¼ç æ ¼å¼(ä¸­æ)\nport                            21\nallowretrieverestart            on         #åè®¸æ­ç¹ç»§ä¼ ï¼ä¸ä¼ ï¼ \nallowstorerestart               on         #åè®¸æ­ç¹ç»§ä¼ ï¼ä¸è½½ï¼ \nuseipv6                         off\numask                           022\nrootlogin                       off        #ç¦æ­¢rootç»å½ftp\nmaxinstances                    30\nsystemlog                       /var/log/proftp.log   #äº§çç¬ç«çæ¥å¿æä»¶. (å¦ææ³æå®èªå·±çæ¥å¿æ ¼å¼å¯ä»¥ç»åï¼extendlogï¼logformatï¼ä¸¤ä¸ªéé¡¹è®¾ç½®)\ntransferlog                     /var/log/proftp.log   #è®°å½ç¨æ·ä¸è½½çæ¥å¿ä¿¡æ¯\nuser                            proftp     #è®¾ç½®å¯å¨ç¨æ·ä¸ºproftp\ngroup                           proftp     #è®¾ç½®å¯å¨ç»ä¸ºproftp\ndefaultroot /var/ftp                       #æå®å±äº«æ ¹ç®å½ä¸º/var/ftp\nallowoverwrite                  on\n#<anonymous ~ftp>                          #è¯¥é¨åå¨é¨#æ³¨éï¼åæ¶å¿åè®¿é®åè½\n#  user       ftp\n#  group      ftp\n#  useralias      anonymous ftp        \n#  maxclients     10           \n#  displaylogin     welcome.msg        \n#  displaychdir     .message\n#  <limit write>                 \n#    denyall\n#  </limit>\n#</anonymous>\n \n#ä»¥ä¸åå®¹ä¸ºè®¾ç½®æéï¼ä¸ºæå¨æ·»å åå®¹     \n#ææç¨æ·å¯ä»¥çå°ææé¨é¨çæä»¶å¤¹ï¼ä»å¯ä»¥è®¿é®èªå·±é¨é¨çç®å½\nrequirevalidshell off                            #ç¨æ·ç»å½æ¯å¦éè¦shellï¼å¯¹èæç¨æ·å¾éè¦ï¼\nauthuserfile /usr/local/proftpd/ftpd.passwd      #éè¿æä»¶è®¤è¯ç¨æ·ç»å½ï¼éè¦ftpasswdå½ä»¤åå»ºè¯¥æä»¶\n<directory "/var/ftp/*">\n<limit cwd read>                                 #åè®¸ææäººå¯ä»¥æ¥çæ ¹ç®å½\n    allowall\n</limit>\n</directory>\n<directory "/var/ftp/è¿ç»´é¨">\n<limit cwd mkd rnfr read write stor retr>\n    denyall                                      #æç»ææäººå¾è¯¥ç®å½ä¸æ§è¡limitåçæä½æä»¤\n</limit>\n<limit dele>\n    denyall                                      #ç¦æ­¢ä»»ä½äººå¨è¯¥ç®å½ä¸å é¤æä»¶\n</limit>\n<limit cwd mkd rnfr read write stor retr>\n    allowuser yunwei                             #ä»åè®¸yunweiç¨æ·å¯ä»¥æ§è¡limitåçæææä»¤\n</limit>\n</directory>\n <directory "/var/ftp/å¼åé¨">\n <limit cwd mkd rnfr read write stor retr>\n    denyall\n</limit>\n<limit dele>\n    denyall\n</limit>\n<limit cwd mkd rnfr read write stor retr>\n    allowuser kaifa\n</limit>\n</directory>\n<directory "/var/ftp/è¡æ¿é¨">\n<limit cwd mkd rnfr read write stor retr>\n    denyall\n</limit>\n<limit dele>\n   denyall\n</limit>\n<limit cwd mkd rnfr read write stor retr>\n   allowuser xingzheng\n</limit>\n</directory>\n<directory "/var/ftp/éå®é¨">\n<limit cwd mkd rnfr read write stor retr>\n   denyall\n</limit>\n<limit dele>\n   denyall\n</limit>\n<limit cwd mkd rnfr read write stor retr>\n   allowuser xiaoshou\n</limit>\n</directory>\n \n6ï¼ç¨ftpasswdå½ä»¤å»ºç«èæè´¦å·ï¼ä¸é¢å½ä»¤ä¹å¯ä»¥ç´æ¥ç¨äºä¿®æ¹ç¨æ·å¯ç ï¼\nftpasswdå½ä»¤æ ¼å¼è¯´æ ï¼è¯¥å½ä»¤å¯ä»¥åå»ºç¨æ·æä»¶ãç»æä»¶ï¼é»è®¤åå»ºçç¨æ·æä»¶ä¸ºftpd.passwdï¼ï¼\n--passwd  åå»ºå¯ç æä»¶ï¼å³authuserfileæå®çæä»¶\n--group   åå»ºç»æä»¶\n--name    æå®åå»ºçç¨æ·å\n--uid     æå®ç¨æ·èæuid\n--gid     æå®èægid\n--home    æå®ç¨æ·å®¶ç®å½\n--shell   æå®ç¨æ·shell\n--file    æå®åå»ºçæä»¶å\n \n[root@localhost ~]# ftpasswd  --passwd --file=/usr/local/proftpd/ftpd.passwd --name=yunwei  --uid=1000  --home=/home/nohome  --shell=/bin/false\nftpasswd: using alternate file: /usr/local/proftpd/ftpd.passwd\nftpasswd: --passwd: missing --gid argument: default gid set to uid\nftpasswd: creating passwd entry for user yunwei\n \nftpasswd: /bin/false is not among the valid system shells.  use of\nftpasswd: "requirevalidshell off" may be required, and the pam\nftpasswd: module configuration may need to be adjusted.\n \n \npassword:\nre-type password:\n \nftpasswd: entry created\n \nç¨æ·è®¤è¯æä»¶åå»ºåçæéæ¯440\n[root@localhost ~]# ll /usr/local/proftpd/ftpd.passwd\n-r--r-----. 1 root root 77 jul 12 10:59 /usr/local/proftpd/ftpd.passwd\n[root@localhost ~]# cat /usr/local/proftpd/ftpd.passwd\nyunwei:$1$uekjlwfy$fxv4shlleaogec2wrza.m/:1000:1000::/home/nohome:/bin/false\n \n7ï¼å¯å¨ftpæå¡\næ£æ¥éç½®æä»¶æ¯å¦æ­£å¸¸\n[root@localhost ~]# /usr/local/proftpd/sbin/proftpd -t6\nchecking syntax of configuration file\nsyntax check complete.\n \n[root@localhost ~]# /usr/local/proftpd/sbin/proftpd\n \n[root@localhost ~]# ps -ef|grep proftpd\nproftp   13438     1  0 11:01 ?        00:00:00 proftpd: (accepting connections)\nroot     13440 13349  0 11:01 pts/2    00:00:00 grep --color=auto proftpd\n \n[root@localhost ~]# lsof -i:21\ncommand   pid   user   fd   type  device size/off node name\nproftpd 13438 proftp    0u  ipv4 2066796      0t0  tcp *:ftp (listen)\n \nè¿éä»ä»¥ç¨æ·ä¸ºå®éªç¯å¢ï¼è¿å¯ä»¥å®ç°ç»åè½ï¼è¿éå°±ä¸åè¿å¤ä»ç»äºï¼\n=====================================================================================\nå¦æéç½®ç»åè½ï¼ååå»ºèæè´¦å·ç»çå½ä»¤å¦ä¸\n# ftpasswd --group --file=/usr/local/proftpd/ftpd.group --name=admin --gid=99\n# ftpasswd --group --name=admin --gid=99 --member=ftpadmin\n=====================================================================================\n \n8ï¼proftpdå¯å¨èæ¬\n[root@localhost ~]# mkdir /usr/local/proftpd/etc\n[root@localhost ~]# ln -s /etc/proftpd.conf /usr/local/proftpd/etc/\n[root@localhost ~]# ll /usr/local/proftpd/etc/\ntotal 0\nlrwxrwxrwx. 1 root root 17 jul 12 11:21 proftpd.conf -> /etc/proftpd.conf\n \n[root@localhost ~]# cat /etc/rc.d/init.d/proftpd\n#!/bin/bash \n# \n# chkconfig: 2345 85 15 \n# description: proftpd is an ftp server \n# processname: proftpd \n   \n# author:   jingyihome \n# e-mail:   webmaster@zhanghaijun.com \n# website:  https://www.zhanghaijun.com \n   \n# proftpd settings \nproftpd="/usr/local/proftpd/sbin/proftpd" \nproconf="/usr/local/proftpd/etc/proftpd.conf" \npropid="/usr/local/proftpd/var/proftpd.pid" \nretval=0 \nprog="proftpd" \n   \nstart() { \n    echo -n $"starting $prog... " \n    $proftpd -c $proconf \n    if [ "$?" = 0 ] ; then \n        echo " done" \n    else \n        echo " failed" \n    fi \n} \n   \nstop() { \n    echo -n $"stopping $prog...  " \n    if [ ! -e $propid ]; then \n        echo -n $"$prog is not running." \n        exit 1 \n    fi \n    kill `cat $propid` \n    if [ "$?" = 0 ] ; then \n        echo " done" \n    else \n        echo " failed" \n    fi \n} \n   \nrestart(){ \n    echo $"restarting $prog..." \n    $0 stop \n    sleep 2 \n    $0 start \n} \n   \nstatus(){ \n    if [ -e $propid ]; then \n        echo $"$prog is running." \n    else \n        echo $"$prog is not running." \n    fi \n} \n   \ncase "$1" in \n    start) \n        start \n        ;; \n    stop) \n        stop \n        ;; \n    restart) \n        restart \n        ;; \n    status) \n        status \n        ;; \n  *) \n        echo $"usage: $0 {start|stop|restart|status}" \nesac \n \næäºæ§è¡æé\n[root@localhost ~]# chmod 755 /etc/rc.d/init.d/proftpd\n[root@localhost ~]# ll /etc/rc.d/init.d/proftpd\n-rwxr-xr-x. 1 root root 1370 jul 12 11:20 /etc/rc.d/init.d/proftpd\n[root@localhost ~]# ll /etc/init.d/proftpd\n-rwxr-xr-x. 1 root root 1370 jul 12 11:20 /etc/init.d/proftpd\n \næµè¯proftpdèæ¬å¯å\n[root@localhost ~]# /etc/init.d/proftpd stop\nstopping proftpd...   done\n[root@localhost ~]# lsof -i:21\n[root@localhost ~]#\n \n[root@localhost ~]# /etc/init.d/proftpd start\nstarting proftpd...  done\n[root@localhost ~]# lsof -i:21              \ncommand   pid   user   fd   type  device size/off node name\nproftpd 13503 proftp    0u  ipv4 2066913      0t0  tcp *:ftp (listen)\n \n \n9ï¼å¦æè¿æ¥ftpæ¶éåº¦æ¢ï¼å¯ä»¥å¨proftpdéç½®æä»¶proftpd.confä¸­å å¥ä»¥ä¸åå®¹ï¼\n# slow logins\n# this is probably caused by a firewall or dns timeout. by default proftpd will try to do both dns and ident lookups against the\n# incoming connection. if these are blocked or excessively delayed a slower than normal login will result. to turn off dns and ident\n# use:\nusereversedns off\nidentlookups off\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n286\n287\n288\n289\n290\n291\n292\n293\n294\n295\n296\n297\n298\n299\n300\n301\n302\n303\n304\n305\n306\n307\n308\n309\n310\n311\n312\n313\n314\n315\n316\n317\n318\n319\n320\n321\n322\n323\n324\n325\n326\n327\n328\n329\n330\n331\n332\n333\n334\n335\n336\n337\n338\n339\n340\n341\n342\n343\n344\n345\n346\n347\n348\n349\n350\n351\n352\n353\n354\n355\n356\n357\n358\n359\n360\n361\n362\n363\n364\n\n\n\n\n\n\nåèé¾æ¥\n\ncentosä¸proftpdç¯å¢é¨ç½²å¹¶ä½¿ç¨èæç¨æ·ç»å½ - è¿ç»´ç¬è®° - æ£å°½æµ®å - åå®¢å­',charsets:{cjk:!0}},{title:"nexuså®è£",frontmatter:{title:"nexuså®è£",date:"2023-02-17T10:48:27.000Z",permalink:"/pages/af4fce/",categories:["è¿ç»´","ç³»ç»","nexus"],tags:[null],readingShow:"top",description:"Nexus æ¯ä¸ä¸ªå¼ºå¤§çmavenä»åºç®¡çå¨ï¼å®æå¤§å°ç®åäºæ¬å°åé¨ä»åºçç»´æ¤åå¤é¨ä»åºçè®¿é®ã",meta:[{name:"image",content:"http://t.eryajf.net/imgs/2021/09/11d4a8c868c78c35.jpg"},{name:"twitter:title",content:"nexuså®è£"},{name:"twitter:description",content:"Nexus æ¯ä¸ä¸ªå¼ºå¤§çmavenä»åºç®¡çå¨ï¼å®æå¤§å°ç®åäºæ¬å°åé¨ä»åºçç»´æ¤åå¤é¨ä»åºçè®¿é®ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://t.eryajf.net/imgs/2021/09/11d4a8c868c78c35.jpg"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/03.nexus/01.nexus%E5%AE%89%E8%A3%85.html"},{property:"og:type",content:"article"},{property:"og:title",content:"nexuså®è£"},{property:"og:description",content:"Nexus æ¯ä¸ä¸ªå¼ºå¤§çmavenä»åºç®¡çå¨ï¼å®æå¤§å°ç®åäºæ¬å°åé¨ä»åºçç»´æ¤åå¤é¨ä»åºçè®¿é®ã"},{property:"og:image",content:"http://t.eryajf.net/imgs/2021/09/11d4a8c868c78c35.jpg"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/03.nexus/01.nexus%E5%AE%89%E8%A3%85.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-17T10:48:27.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"nexuså®è£"},{itemprop:"description",content:"Nexus æ¯ä¸ä¸ªå¼ºå¤§çmavenä»åºç®¡çå¨ï¼å®æå¤§å°ç®åäºæ¬å°åé¨ä»åºçç»´æ¤åå¤é¨ä»åºçè®¿é®ã"},{itemprop:"image",content:"http://t.eryajf.net/imgs/2021/09/11d4a8c868c78c35.jpg"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/03.nexus/01.nexus%E5%AE%89%E8%A3%85.html",relativePath:"04.è¿ç»´/09.ç³»ç»/03.nexus/01.nexuså®è£.md",key:"v-c4242b76",path:"/pages/af4fce/",headers:[{level:2,title:"1. nexusä»ç»",slug:"_1-nexusä»ç»",normalizedTitle:"1. nexusä»ç»",charIndex:2},{level:3,title:"nexusæ¯ä»ä¹ï¼",slug:"nexusæ¯ä»ä¹",normalizedTitle:"nexusæ¯ä»ä¹ï¼",charIndex:17},{level:3,title:"ä¸ºä»ä¹è¦æå»º Nexus ç§æï¼",slug:"ä¸ºä»ä¹è¦æå»º-nexus-ç§æ",normalizedTitle:"ä¸ºä»ä¹è¦æå»º nexus ç§æï¼",charIndex:598},{level:3,title:"2.çæ¬éæ©åä¸è½½",slug:"_2-çæ¬éæ©åä¸è½½",normalizedTitle:"2.çæ¬éæ©åä¸è½½",charIndex:1069},{level:4,title:"å³äºçæ¬éæ©",slug:"å³äºçæ¬éæ©",normalizedTitle:"å³äºçæ¬éæ©",charIndex:1124},{level:4,title:"å³äºä¸è½½",slug:"å³äºä¸è½½",normalizedTitle:"å³äºä¸è½½",charIndex:1285},{level:3,title:"3.å®è£jdk-1.8",slug:"_3-å®è£jdk-1-8",normalizedTitle:"3.å®è£jdk-1.8",charIndex:1591},{level:3,title:"4.é¨ç½²nexus",slug:"_4-é¨ç½²nexus",normalizedTitle:"4.é¨ç½²nexus",charIndex:1659},{level:3,title:"2.å¯å¨",slug:"_2-å¯å¨",normalizedTitle:"2.å¯å¨",charIndex:1815},{level:3,title:"3.è®¿é®",slug:"_3-è®¿é®",normalizedTitle:"3.è®¿é®",charIndex:1953},{level:3,title:"4.ä¼åéç½®",slug:"_4-ä¼åéç½®",normalizedTitle:"4.ä¼åéç½®",charIndex:2013},{level:4,title:"1.è®¾ç½®å¼æºå¯å¨",slug:"_1-è®¾ç½®å¼æºå¯å¨",normalizedTitle:"1.è®¾ç½®å¼æºå¯å¨",charIndex:2023},{level:4,title:"2.éç½®è¿è¡ç¨æ·",slug:"_2-éç½®è¿è¡ç¨æ·",normalizedTitle:"2.éç½®è¿è¡ç¨æ·",charIndex:2144},{level:4,title:"3.éç½®jdk",slug:"_3-éç½®jdk",normalizedTitle:"3.éç½®jdk",charIndex:2453},{level:4,title:"4.ä¿®æ¹ç«¯å£",slug:"_4-ä¿®æ¹ç«¯å£",normalizedTitle:"4.ä¿®æ¹ç«¯å£",charIndex:2614},{level:4,title:"5.éç½®å­å¨åæ¥å¿ä½ç½®",slug:"_5-éç½®å­å¨åæ¥å¿ä½ç½®",normalizedTitle:"5.éç½®å­å¨åæ¥å¿ä½ç½®",charIndex:2709},{level:4,title:"6.éç½®å®æ¯ä¹åï¼éå¯ä¸ä¸æå¡ã",slug:"_6-éç½®å®æ¯ä¹å-éå¯ä¸ä¸æå¡ã",normalizedTitle:"6.éç½®å®æ¯ä¹åï¼éå¯ä¸ä¸æå¡ã",charIndex:2965},{level:4,title:"7.è§£å³nexusä¸è½½ä¾èµè¿å¤æ¥éé®é¢",slug:"_7-è§£å³nexusä¸è½½ä¾èµè¿å¤æ¥éé®é¢",normalizedTitle:"7.è§£å³nexusä¸è½½ä¾èµè¿å¤æ¥éé®é¢",charIndex:3140},{level:3,title:"5.dockeræ¹å¼å®è£",slug:"_5-dockeræ¹å¼å®è£",normalizedTitle:"5.dockeræ¹å¼å®è£",charIndex:3600}],headersStr:"1. nexusä»ç» nexusæ¯ä»ä¹ï¼ ä¸ºä»ä¹è¦æå»º Nexus ç§æï¼ 2.çæ¬éæ©åä¸è½½ å³äºçæ¬éæ© å³äºä¸è½½ 3.å®è£jdk-1.8 4.é¨ç½²nexus 2.å¯å¨ 3.è®¿é® 4.ä¼åéç½® 1.è®¾ç½®å¼æºå¯å¨ 2.éç½®è¿è¡ç¨æ· 3.éç½®jdk 4.ä¿®æ¹ç«¯å£ 5.éç½®å­å¨åæ¥å¿ä½ç½® 6.éç½®å®æ¯ä¹åï¼éå¯ä¸ä¸æå¡ã 7.è§£å³nexusä¸è½½ä¾èµè¿å¤æ¥éé®é¢ 5.dockeræ¹å¼å®è£",content:'# 1. nexusä»ç»\n\n\n# nexusæ¯ä»ä¹ï¼\n\nNexus æ¯ä¸ä¸ªå¼ºå¤§çmavenä»åºç®¡çå¨ï¼å®æå¤§å°ç®åäºæ¬å°åé¨ä»åºçç»´æ¤åå¤é¨ä»åºçè®¿é®ã\n\nä¸ä»å¦æ­¤ï¼ä»è¿å¯ä»¥ç¨æ¥åå»ºyumãpypiãnpmãdockerãnugetãrubygems ç­åç§ç§æä»åºã\n\nå¦æä½¿ç¨äºå¬å±ç Maven ä»åºæå¡å¨ï¼å¯ä»¥ä» Maven ä¸­å¤®ä»åºä¸è½½æéè¦çæä»¶ï¼Artifactï¼ï¼ä½è¿éå¸¸ä¸æ¯ä¸ä¸ªå¥½çåæ³ã æ­£å¸¸åæ³æ¯å¨æ¬å°æ¶è®¾ä¸ä¸ª Maven ä»åºæå¡å¨ï¼å³å©ç¨ Nexus ç§æå¯ä»¥åªå¨ä¸ä¸ªå°æ¹å°±è½å¤å®å¨æ§å¶è®¿é®åé¨ç½²å¨ä½ æç»´æ¤ä»åºä¸­çæ¯ä¸ª Artifactã Nexus å¨ä»£çè¿ç¨ä»åºçåæ¶ç»´æ¤æ¬å°ä»åºï¼ä»¥éä½ä¸­å¤®ä»åºçè´è·, èçå¤ç½å¸¦å®½åæ¶é´ï¼Nexus ç§æå°±å¯ä»¥æ»¡è¶³è¿æ ·çéè¦ã Nexus æ¯ä¸å¥ âå¼ç®±å³ç¨â çç³»ç»ä¸éè¦æ°æ®åºï¼å®ä½¿ç¨æä»¶ç³»ç»å  Lucene æ¥ç»ç»æ°æ®ã Nexus ä½¿ç¨ ExtJS æ¥å¼åçé¢ï¼å©ç¨ Restlet æ¥æä¾å®æ´ç REST APIsï¼éè¿ m2eclipse ä¸ Eclipse éæä½¿ç¨ã Nexus æ¯æ WebDAV ä¸ LDAP å®å¨èº«ä»½è®¤è¯ã Nexus è¿æä¾äºå¼ºå¤§çä»åºç®¡çåè½ï¼æä»¶æç´¢åè½ï¼å®åºäº RESTï¼åå¥½ç UI æ¯ä¸ä¸ª extjs ç REST å®¢æ·ç«¯ï¼å®å ç¨è¾å°çåå­ï¼åºäºç®åæä»¶ç³»ç»èéæ°æ®åº\n\n\n# ä¸ºä»ä¹è¦æå»º Nexus ç§æï¼\n\nå¦ææ²¡æ Nexus ç§æï¼æä»¬æéçæææä»¶é½éè¦éè¿ maven çä¸­å¤®ä»åºåç¬¬ä¸æ¹ç Maven ä»åºä¸è½½å°æ¬å°ï¼èä¸ä¸ªå¢éä¸­çææäººé½éå¤çä» maven ä»åºä¸è½½æä»¶æ çå å¤§äºä»åºçè´è½½åæµªè´¹äºå¤ç½å¸¦å®½ï¼å¦æç½éæ¢çè¯ï¼è¿ä¼å½±åé¡¹ç®çè¿ç¨ãå¾å¤æåµä¸é¡¹ç®çå¼åé½æ¯å¨åç½è¿è¡çï¼è¿æ¥ä¸å° maven ä»åºæä¹åå¢ï¼å¼åçå¬å±æä»¶æä¹è®©å¶å®é¡¹ç®ä½¿ç¨ï¼è¿ä¸ªæ¶åæä»¬ä¸å¾ä¸ä¸ºèªå·±çå¢éæ­å»ºå±äºèªå·±ç maven ç§æï¼è¿æ ·æ¢èçäºç½ç»å¸¦å®½ä¹ä¼å éé¡¹ç®æ­å»ºçè¿ç¨ï¼å½ç¶åææ¡ä»¶å°±æ¯ä½ çç§æä¸­æ¥æé¡¹ç®æéçæææä»¶ã\n\næ»ä¹ï¼å¨æ¬å°æå»º nexusç§æçå¥½å¤æï¼\n\n>  1. å éæå»º\n>  2. èçå¸¦å®½\n>  3. èçä¸­å¤® maven ä»åºçå¸¦å®½\n>  4. ç¨³å®ï¼åºä»ä¸æ¦ä¸­å¤®æå¡å¨åºé®é¢çæåµï¼\n>  5. æ§å¶åå®¡è®¡\n>  6. è½å¤é¨ç½²ç¬¬ä¸æ¹æä»¶\n>  7. å¯ä»¥å»ºç«æ¬å°åé¨ä»åº\n>  8. å¯ä»¥å»ºç«å¬å±ä»åº\n\nè¿äºä¼ç¹ä½¿å¾ Nexus æ¥è¶æä¸ºææµè¡ç Maven ä»åºç®¡çå¨\n\n\n# 2.çæ¬éæ©åä¸è½½\n\n----------------------------------------\n\n# å³äºçæ¬éæ©\n\nä»¥åå¬å¸ä½¿ç¨ççæ¬ä¸ç´æ¯ç¨çä¸ä¸ª2.xççæ¬ï¼æ§ççæ¬åç§éæ§ï¼å¨è¿ç§éæ§çæåµä¸ï¼è®¸å¤å°æ¹å·²ç»ç ´ç ´ççäºï¼æ¯å¦æéè¦çåè½ä¹ä¸ï¼èªå¨åæ­¥è¿ç¨ä»åºçä¾èµï¼å°±å·²ç»æ æ³ä½¿ç¨ï¼çå°çæ¬å·²ç»æ´æ°å°3.xï¼å æ­¤å°±æ³çæ­ä¸ä¸ªé«çæ¬çæ¥ä½éªä¸ä¸ã\n\nè¿ä¹ä¸ä½éªï¼åç°è¿ä¸ªä¸ä¸ï¼çççæ¯ä¸ä¸ªç¹å«å¥½çå©å¨ï¼ç¥å¨ã\n\n\n\n# å³äºä¸è½½\n\nå®ç½å°åï¼https://www.sonatype.com/\n\n * å¯ä»¥ç´æ¥éè¿ä¸è¾¹é¾æ¥ä¸è½½ææ°çæ¬ï¼https://www.sonatype.com/oss-thank-you-tar.gz\n * å¯ä»¥éè¿åè¾¹çè¿ä¸ªé¾æ¥éæ©åå²çæ¬ï¼https://help.sonatype.com/repomanager3/download/download-archivesârepository-manager-3(opens new window)\n\nå¯è½ä¸è¬ç½ç»ä¸å¨æµè§å¨éè¾¹ä¸è½½æ¯è¾æ¢ï¼é£ä¹å¯ä»¥å¤å¶é¾æ¥ç¨è¿é·ä¸è½½ï¼å°±ä¼å¥½ä¸äºã\n\næ¥ä¸æ¥å¼å§æ´ä¸ªå®è£çæµç¨ä»ç»ï¼æä»¬åæ¥ä»ç»æ®éæ¹å¼çå®è£ã\n\n\n# 3.å®è£jdk-1.8\n\nnexusçå®è£ä¾èµjdkç¯å¢ãæå¥½å®è£1.8çæ¬çï¼å¦åå¯è½ä¼éå°å¶ä»ä¸å¯ç¥é®é¢ãæ­¤å®è£ä¸åèµè¿°ã\n\n\n# 4.é¨ç½²nexus\n\n[root@nexus mnt]$tar xf nexus-3.12.1-01-unix.tar.gz\n[root@nexus mnt]$ls\nnexus-3.12.1-01  nexus-3.12.1-01-unix.tar.gz  sonatype-work\n\n\n1\n2\n3\n\n\n\n# 2.å¯å¨\n\ncd /mnt/nexus-3.12.1-01/bin\n./nexus run &\n\n\n1\n2\n\n\nå¤§æ¦ç­å¾ä¸åéå·¦å³ï¼å¦æå¨æ¥å¿è¾åºå½ä¸­çå°å¦ä¸æ¾ç¤ºï¼åè¯´æå¯å¨æåã\n\nStarted Sonatype Nexus OSS 3.12.1-01\n\n\n1\n\n\n\n# 3.è®¿é®\n\né»è®¤çå¬ç«¯å£ä¸º8081ï¼é»è®¤ç¨æ·åå¯ç ä¸ºadmin/admin123ï¼å æ­¤å¯ä»¥è®¿é®ä»¥ä¸é¦é¡µå¹¶ç»éã\n\n\n# 4.ä¼åéç½®\n\n# 1.è®¾ç½®å¼æºå¯å¨\n\nln -s /mnt/nexus-3.12.1-01/bin/nexus /etc/init.d/nexus3\nchkconfig --add nexus3\nchkconfig nexus3 on\n\n\n1\n2\n3\n\n\n# 2.éç½®è¿è¡ç¨æ·\n\nè¿ä¸ªå°æ¹å¯ä»¥ä½¿ç¨rootè¿è¡ï¼ä¸è¿å®æ¹ææ¡£éè¾¹ä¹ä¸å»ºè®®ä½¿ç¨rootæ¥è¿è¡ï¼å æ­¤ä½¿ç¨æ®éç¨æ·æ¥è¿è¡ã\n\n[root@nexus ~]$useradd nexus\n[root@nexus bin]$vim nexus.rc\n\nrun_as_user="nexus"\n\néç½®ä¹åè®°å¾æ´æ¹ç®å½æéï¼å¦åä¸æ¬¡å¯å¨ä¼æ²¡ææéã\n\n[root@nexus mnt]$chown -R nexus.nexus /mnt/nexus-3.12.1-01\n[root@nexus mnt]$chown -R nexus.nexus /mnt/sonatype-work\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# 3.éç½®jdk\n\nå¦æè¿éä¸éç½®ï¼ä¸è¬ä¼ä½¿ç¨é»è®¤çJAVA_HOMEçåéï¼å¦æç³»ç»ä¸­æå¤ä¸ªï¼é£ä¹å¯ä»¥è¿è¡éç½®ã\n\n[root@nexus bin]$vim nexus\n\nä¿®æ¹ç¬¬14è¡ï¼\nINSTALL4J_JAVA_HOME_OVERRIDE=/usr/local/jdk1.8.0_144\n\n\n1\n2\n3\n4\n\n\n# 4.ä¿®æ¹ç«¯å£\n\nä¸è¬ä½¿ç¨é»è®¤çï¼å¦æéè¦ä¿®æ¹ï¼åæ´æ¹/mnt/nexus-3.12.1-01/etc/nexus-default.propertieséè¾¹çéç½®ã\n\nè¿éä¸åä¿®æ¹äºã\n\n# 5.éç½®å­å¨åæ¥å¿ä½ç½®\n\n[root@nexus bin]$vim /mnt/nexus-3.12.1-01/bin/nexus.vmoptions\n\nä¸è¬é½ä¸åä¿®æ¹ï¼ä½¿ç¨é»è®¤å³å¯ï¼è¿éååºæ¯ä¸ºäºäºè§£è¿ä¸ªç¹ã\n\n-XX:LogFile=../sonatype-work/nexus3/log/jvm.log\n-Dkaraf.data=../sonatype-work/nexus3\n-Djava.io.tmpdir=../sonatype-work/nexus3/tmp\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# 6.éç½®å®æ¯ä¹åï¼éå¯ä¸ä¸æå¡ã\n\næ³¨æå·¦ä¸è§ä¼æä¸ä¸ªåè­¦ï¼è¿ä¸ªåè­¦çæææ¯ç³»ç»é»è®¤çæå¤§æä»¶å¥æå¤ªå°äºã\n\nè§£å³åæ³å®ç½ä¹å·²ç»ç»åºäºï¼è§£å³æä»¶å¥æéå¶ã\n\nå æ­¤æä»¬ç§å®æ¹è§£å³åæ³æ¥åï¼\n\necho "nexus  -  nofile 65536" >> /etc/security/limits.conf\n\n\n1\n\n\nç¶ååæ¬¡éå¯æå¡å³å¯ã\n\n# 7.è§£å³nexusä¸è½½ä¾èµè¿å¤æ¥éé®é¢\n\næ§è¡nexusç§åºå°åï¼å¹¶ä¸npm loginå®æåï¼è¿è¡npm iä¸è½½ä¾èµæ¶ï¼å½ä¾èµè¿å¤æèæ§è¡æ¶é´è¿é¿æ¶ï¼åºç°éè¯¯æç¤º\n\néç¹æ¯Â java.io.IOException: java.util.concurrent.TimeoutException: Idle timeout expired: 30001/30000 msï¼\n\nç±æ­¤å¯ç¥ï¼éè¯¯åå æ¯ç½ç»è¿æ¥è¶æ¶ãåæåºè¯¥æ¯å ä¸ºç¬¬ä¸æ¹ä¾èµè¿å¤ï¼å¯¼è´ä¸è½½ä¾èµçæ¶é´è¶è¿äºhttpè¯·æ±çé»è®¤ç­å¾æ¶é´30000mså¯¼è´ä¸è½½è¯·æ±è¢«ææ­äºã\n\nç¥éåå å°±å¥½è§£å³äºã\n\néè¿éè¯¯æç¤ºåç°nexusæ¯éç¨äº jettyï¼æä»¥è¿å¥nexusæ ¹ç®å½\\etc\\jettyï¼æ¾å°jetty-http.xmlåjetty-https.xml\n\næå¼xmlæç´¢Set name="idleTimeout"\n\nå°åé¢çdefault=30000æ¹æ1200000\n\néå¯æå¡ï¼ä¸å®è¦éå¯æå¡ï¼\n\nåæ¬¡æ§è¡npm iæä»¤ã\n\nä¸è½½æ­£å¸¸ï¼é®é¢è§£å³ã\n\n\n# 5.dockeræ¹å¼å®è£\n\næåä»ç»ä¸äºä½¿ç¨dockerçæ¹å¼å¦ä½å®è£ã\n\nå¦ææ³ä½¿ç¨dockeræ¥å¯å¨ï¼é£ä¹å¯ä»¥åèï¼å®æ¹éåä»ç»ã(opens new window)\n\næç¨ä¸è¾¹æ¹å¼ç´æ¥å¯å¨ã\n\nmkdir /mnt/nexus-data\ndocker run -d -p 8081:8081 --name nexus -v --ulimit nofile=65536ï¼65536 /mnt/nexus-data:/nexus-data sonatype/nexus3\n\n\n1\n2\n\n\nåæé¾æ¥ï¼nexusçå®è£ | äºä¸«è®²æ¢µ',normalizedContent:'# 1. nexusä»ç»\n\n\n# nexusæ¯ä»ä¹ï¼\n\nnexus æ¯ä¸ä¸ªå¼ºå¤§çmavenä»åºç®¡çå¨ï¼å®æå¤§å°ç®åäºæ¬å°åé¨ä»åºçç»´æ¤åå¤é¨ä»åºçè®¿é®ã\n\nä¸ä»å¦æ­¤ï¼ä»è¿å¯ä»¥ç¨æ¥åå»ºyumãpypiãnpmãdockerãnugetãrubygems ç­åç§ç§æä»åºã\n\nå¦æä½¿ç¨äºå¬å±ç maven ä»åºæå¡å¨ï¼å¯ä»¥ä» maven ä¸­å¤®ä»åºä¸è½½æéè¦çæä»¶ï¼artifactï¼ï¼ä½è¿éå¸¸ä¸æ¯ä¸ä¸ªå¥½çåæ³ã æ­£å¸¸åæ³æ¯å¨æ¬å°æ¶è®¾ä¸ä¸ª maven ä»åºæå¡å¨ï¼å³å©ç¨ nexus ç§æå¯ä»¥åªå¨ä¸ä¸ªå°æ¹å°±è½å¤å®å¨æ§å¶è®¿é®åé¨ç½²å¨ä½ æç»´æ¤ä»åºä¸­çæ¯ä¸ª artifactã nexus å¨ä»£çè¿ç¨ä»åºçåæ¶ç»´æ¤æ¬å°ä»åºï¼ä»¥éä½ä¸­å¤®ä»åºçè´è·, èçå¤ç½å¸¦å®½åæ¶é´ï¼nexus ç§æå°±å¯ä»¥æ»¡è¶³è¿æ ·çéè¦ã nexus æ¯ä¸å¥ âå¼ç®±å³ç¨â çç³»ç»ä¸éè¦æ°æ®åºï¼å®ä½¿ç¨æä»¶ç³»ç»å  lucene æ¥ç»ç»æ°æ®ã nexus ä½¿ç¨ extjs æ¥å¼åçé¢ï¼å©ç¨ restlet æ¥æä¾å®æ´ç rest apisï¼éè¿ m2eclipse ä¸ eclipse éæä½¿ç¨ã nexus æ¯æ webdav ä¸ ldap å®å¨èº«ä»½è®¤è¯ã nexus è¿æä¾äºå¼ºå¤§çä»åºç®¡çåè½ï¼æä»¶æç´¢åè½ï¼å®åºäº restï¼åå¥½ç ui æ¯ä¸ä¸ª extjs ç rest å®¢æ·ç«¯ï¼å®å ç¨è¾å°çåå­ï¼åºäºç®åæä»¶ç³»ç»èéæ°æ®åº\n\n\n# ä¸ºä»ä¹è¦æå»º nexus ç§æï¼\n\nå¦ææ²¡æ nexus ç§æï¼æä»¬æéçæææä»¶é½éè¦éè¿ maven çä¸­å¤®ä»åºåç¬¬ä¸æ¹ç maven ä»åºä¸è½½å°æ¬å°ï¼èä¸ä¸ªå¢éä¸­çææäººé½éå¤çä» maven ä»åºä¸è½½æä»¶æ çå å¤§äºä»åºçè´è½½åæµªè´¹äºå¤ç½å¸¦å®½ï¼å¦æç½éæ¢çè¯ï¼è¿ä¼å½±åé¡¹ç®çè¿ç¨ãå¾å¤æåµä¸é¡¹ç®çå¼åé½æ¯å¨åç½è¿è¡çï¼è¿æ¥ä¸å° maven ä»åºæä¹åå¢ï¼å¼åçå¬å±æä»¶æä¹è®©å¶å®é¡¹ç®ä½¿ç¨ï¼è¿ä¸ªæ¶åæä»¬ä¸å¾ä¸ä¸ºèªå·±çå¢éæ­å»ºå±äºèªå·±ç maven ç§æï¼è¿æ ·æ¢èçäºç½ç»å¸¦å®½ä¹ä¼å éé¡¹ç®æ­å»ºçè¿ç¨ï¼å½ç¶åææ¡ä»¶å°±æ¯ä½ çç§æä¸­æ¥æé¡¹ç®æéçæææä»¶ã\n\næ»ä¹ï¼å¨æ¬å°æå»º nexusç§æçå¥½å¤æï¼\n\n>  1. å éæå»º\n>  2. èçå¸¦å®½\n>  3. èçä¸­å¤® maven ä»åºçå¸¦å®½\n>  4. ç¨³å®ï¼åºä»ä¸æ¦ä¸­å¤®æå¡å¨åºé®é¢çæåµï¼\n>  5. æ§å¶åå®¡è®¡\n>  6. è½å¤é¨ç½²ç¬¬ä¸æ¹æä»¶\n>  7. å¯ä»¥å»ºç«æ¬å°åé¨ä»åº\n>  8. å¯ä»¥å»ºç«å¬å±ä»åº\n\nè¿äºä¼ç¹ä½¿å¾ nexus æ¥è¶æä¸ºææµè¡ç maven ä»åºç®¡çå¨\n\n\n# 2.çæ¬éæ©åä¸è½½\n\n----------------------------------------\n\n# å³äºçæ¬éæ©\n\nä»¥åå¬å¸ä½¿ç¨ççæ¬ä¸ç´æ¯ç¨çä¸ä¸ª2.xççæ¬ï¼æ§ççæ¬åç§éæ§ï¼å¨è¿ç§éæ§çæåµä¸ï¼è®¸å¤å°æ¹å·²ç»ç ´ç ´ççäºï¼æ¯å¦æéè¦çåè½ä¹ä¸ï¼èªå¨åæ­¥è¿ç¨ä»åºçä¾èµï¼å°±å·²ç»æ æ³ä½¿ç¨ï¼çå°çæ¬å·²ç»æ´æ°å°3.xï¼å æ­¤å°±æ³çæ­ä¸ä¸ªé«çæ¬çæ¥ä½éªä¸ä¸ã\n\nè¿ä¹ä¸ä½éªï¼åç°è¿ä¸ªä¸ä¸ï¼çççæ¯ä¸ä¸ªç¹å«å¥½çå©å¨ï¼ç¥å¨ã\n\n\n\n# å³äºä¸è½½\n\nå®ç½å°åï¼https://www.sonatype.com/\n\n * å¯ä»¥ç´æ¥éè¿ä¸è¾¹é¾æ¥ä¸è½½ææ°çæ¬ï¼https://www.sonatype.com/oss-thank-you-tar.gz\n * å¯ä»¥éè¿åè¾¹çè¿ä¸ªé¾æ¥éæ©åå²çæ¬ï¼https://help.sonatype.com/repomanager3/download/download-archivesârepository-manager-3(opens new window)\n\nå¯è½ä¸è¬ç½ç»ä¸å¨æµè§å¨éè¾¹ä¸è½½æ¯è¾æ¢ï¼é£ä¹å¯ä»¥å¤å¶é¾æ¥ç¨è¿é·ä¸è½½ï¼å°±ä¼å¥½ä¸äºã\n\næ¥ä¸æ¥å¼å§æ´ä¸ªå®è£çæµç¨ä»ç»ï¼æä»¬åæ¥ä»ç»æ®éæ¹å¼çå®è£ã\n\n\n# 3.å®è£jdk-1.8\n\nnexusçå®è£ä¾èµjdkç¯å¢ãæå¥½å®è£1.8çæ¬çï¼å¦åå¯è½ä¼éå°å¶ä»ä¸å¯ç¥é®é¢ãæ­¤å®è£ä¸åèµè¿°ã\n\n\n# 4.é¨ç½²nexus\n\n[root@nexus mnt]$tar xf nexus-3.12.1-01-unix.tar.gz\n[root@nexus mnt]$ls\nnexus-3.12.1-01  nexus-3.12.1-01-unix.tar.gz  sonatype-work\n\n\n1\n2\n3\n\n\n\n# 2.å¯å¨\n\ncd /mnt/nexus-3.12.1-01/bin\n./nexus run &\n\n\n1\n2\n\n\nå¤§æ¦ç­å¾ä¸åéå·¦å³ï¼å¦æå¨æ¥å¿è¾åºå½ä¸­çå°å¦ä¸æ¾ç¤ºï¼åè¯´æå¯å¨æåã\n\nstarted sonatype nexus oss 3.12.1-01\n\n\n1\n\n\n\n# 3.è®¿é®\n\né»è®¤çå¬ç«¯å£ä¸º8081ï¼é»è®¤ç¨æ·åå¯ç ä¸ºadmin/admin123ï¼å æ­¤å¯ä»¥è®¿é®ä»¥ä¸é¦é¡µå¹¶ç»éã\n\n\n# 4.ä¼åéç½®\n\n# 1.è®¾ç½®å¼æºå¯å¨\n\nln -s /mnt/nexus-3.12.1-01/bin/nexus /etc/init.d/nexus3\nchkconfig --add nexus3\nchkconfig nexus3 on\n\n\n1\n2\n3\n\n\n# 2.éç½®è¿è¡ç¨æ·\n\nè¿ä¸ªå°æ¹å¯ä»¥ä½¿ç¨rootè¿è¡ï¼ä¸è¿å®æ¹ææ¡£éè¾¹ä¹ä¸å»ºè®®ä½¿ç¨rootæ¥è¿è¡ï¼å æ­¤ä½¿ç¨æ®éç¨æ·æ¥è¿è¡ã\n\n[root@nexus ~]$useradd nexus\n[root@nexus bin]$vim nexus.rc\n\nrun_as_user="nexus"\n\néç½®ä¹åè®°å¾æ´æ¹ç®å½æéï¼å¦åä¸æ¬¡å¯å¨ä¼æ²¡ææéã\n\n[root@nexus mnt]$chown -r nexus.nexus /mnt/nexus-3.12.1-01\n[root@nexus mnt]$chown -r nexus.nexus /mnt/sonatype-work\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# 3.éç½®jdk\n\nå¦æè¿éä¸éç½®ï¼ä¸è¬ä¼ä½¿ç¨é»è®¤çjava_homeçåéï¼å¦æç³»ç»ä¸­æå¤ä¸ªï¼é£ä¹å¯ä»¥è¿è¡éç½®ã\n\n[root@nexus bin]$vim nexus\n\nä¿®æ¹ç¬¬14è¡ï¼\ninstall4j_java_home_override=/usr/local/jdk1.8.0_144\n\n\n1\n2\n3\n4\n\n\n# 4.ä¿®æ¹ç«¯å£\n\nä¸è¬ä½¿ç¨é»è®¤çï¼å¦æéè¦ä¿®æ¹ï¼åæ´æ¹/mnt/nexus-3.12.1-01/etc/nexus-default.propertieséè¾¹çéç½®ã\n\nè¿éä¸åä¿®æ¹äºã\n\n# 5.éç½®å­å¨åæ¥å¿ä½ç½®\n\n[root@nexus bin]$vim /mnt/nexus-3.12.1-01/bin/nexus.vmoptions\n\nä¸è¬é½ä¸åä¿®æ¹ï¼ä½¿ç¨é»è®¤å³å¯ï¼è¿éååºæ¯ä¸ºäºäºè§£è¿ä¸ªç¹ã\n\n-xx:logfile=../sonatype-work/nexus3/log/jvm.log\n-dkaraf.data=../sonatype-work/nexus3\n-djava.io.tmpdir=../sonatype-work/nexus3/tmp\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# 6.éç½®å®æ¯ä¹åï¼éå¯ä¸ä¸æå¡ã\n\næ³¨æå·¦ä¸è§ä¼æä¸ä¸ªåè­¦ï¼è¿ä¸ªåè­¦çæææ¯ç³»ç»é»è®¤çæå¤§æä»¶å¥æå¤ªå°äºã\n\nè§£å³åæ³å®ç½ä¹å·²ç»ç»åºäºï¼è§£å³æä»¶å¥æéå¶ã\n\nå æ­¤æä»¬ç§å®æ¹è§£å³åæ³æ¥åï¼\n\necho "nexus  -  nofile 65536" >> /etc/security/limits.conf\n\n\n1\n\n\nç¶ååæ¬¡éå¯æå¡å³å¯ã\n\n# 7.è§£å³nexusä¸è½½ä¾èµè¿å¤æ¥éé®é¢\n\næ§è¡nexusç§åºå°åï¼å¹¶ä¸npm loginå®æåï¼è¿è¡npm iä¸è½½ä¾èµæ¶ï¼å½ä¾èµè¿å¤æèæ§è¡æ¶é´è¿é¿æ¶ï¼åºç°éè¯¯æç¤º\n\néç¹æ¯Â java.io.ioexception: java.util.concurrent.timeoutexception: idle timeout expired: 30001/30000 msï¼\n\nç±æ­¤å¯ç¥ï¼éè¯¯åå æ¯ç½ç»è¿æ¥è¶æ¶ãåæåºè¯¥æ¯å ä¸ºç¬¬ä¸æ¹ä¾èµè¿å¤ï¼å¯¼è´ä¸è½½ä¾èµçæ¶é´è¶è¿äºhttpè¯·æ±çé»è®¤ç­å¾æ¶é´30000mså¯¼è´ä¸è½½è¯·æ±è¢«ææ­äºã\n\nç¥éåå å°±å¥½è§£å³äºã\n\néè¿éè¯¯æç¤ºåç°nexusæ¯éç¨äº jettyï¼æä»¥è¿å¥nexusæ ¹ç®å½\\etc\\jettyï¼æ¾å°jetty-http.xmlåjetty-https.xml\n\næå¼xmlæç´¢set name="idletimeout"\n\nå°åé¢çdefault=30000æ¹æ1200000\n\néå¯æå¡ï¼ä¸å®è¦éå¯æå¡ï¼\n\nåæ¬¡æ§è¡npm iæä»¤ã\n\nä¸è½½æ­£å¸¸ï¼é®é¢è§£å³ã\n\n\n# 5.dockeræ¹å¼å®è£\n\næåä»ç»ä¸äºä½¿ç¨dockerçæ¹å¼å¦ä½å®è£ã\n\nå¦ææ³ä½¿ç¨dockeræ¥å¯å¨ï¼é£ä¹å¯ä»¥åèï¼å®æ¹éåä»ç»ã(opens new window)\n\næç¨ä¸è¾¹æ¹å¼ç´æ¥å¯å¨ã\n\nmkdir /mnt/nexus-data\ndocker run -d -p 8081:8081 --name nexus -v --ulimit nofile=65536ï¼65536 /mnt/nexus-data:/nexus-data sonatype/nexus3\n\n\n1\n2\n\n\nåæé¾æ¥ï¼nexusçå®è£ | äºä¸«è®²æ¢µ',charsets:{cjk:!0}},{title:"ä½¿ç¨nexus3éç½®npmç§æä»åº",frontmatter:{title:"ä½¿ç¨nexus3éç½®npmç§æä»åº",date:"2023-02-20T10:57:40.000Z",permalink:"/pages/b851fe/",categories:["è¿ç»´","ç³»ç»","nexus"],tags:[null],readingShow:"top",description:"å½æä»¬è¿è¡åç«¯é¡¹ç®çæ¶åï¼å¸¸å¸¸å¨è§£å³ä¾èµçæ¶åä¼å ä¸ä¸ä¸ªåæ°npm install --registry=https://registry.npm.taobao.orgå°æºæå®ä¸ºæ·å®çæºï¼ä»¥æè®©éåº¦å å¿«èµ·æ¥ï¼äºå®ä¸è¿ç§çç¡®è½å¤è®©éåº¦åå¿«ï¼ä½æ¯é¿ä¹æ¥çï¼å¦ææ³çæ­£çå¿«éææ·å¼åé¨ç½²ï¼æ­å»ºä¼ä¸åé¨çç§æï¼åä¼è®©éåº¦æ´ä¸ä¸ä¸ªå°é¶ã",meta:[{name:"image",content:"http://pic.zzppjj.top/LightPicture/2023/02/013b7fc775dcf453.jpg"},{name:"twitter:title",content:"ä½¿ç¨nexus3éç½®npmç§æä»åº"},{name:"twitter:description",content:"å½æä»¬è¿è¡åç«¯é¡¹ç®çæ¶åï¼å¸¸å¸¸å¨è§£å³ä¾èµçæ¶åä¼å ä¸ä¸ä¸ªåæ°npm install --registry=https://registry.npm.taobao.orgå°æºæå®ä¸ºæ·å®çæºï¼ä»¥æè®©éåº¦å å¿«èµ·æ¥ï¼äºå®ä¸è¿ç§çç¡®è½å¤è®©éåº¦åå¿«ï¼ä½æ¯é¿ä¹æ¥çï¼å¦ææ³çæ­£çå¿«éææ·å¼åé¨ç½²ï¼æ­å»ºä¼ä¸åé¨çç§æï¼åä¼è®©éåº¦æ´ä¸ä¸ä¸ªå°é¶ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://pic.zzppjj.top/LightPicture/2023/02/013b7fc775dcf453.jpg"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/03.nexus/02.%E4%BD%BF%E7%94%A8nexus3%E9%85%8D%E7%BD%AEnpm%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ä½¿ç¨nexus3éç½®npmç§æä»åº"},{property:"og:description",content:"å½æä»¬è¿è¡åç«¯é¡¹ç®çæ¶åï¼å¸¸å¸¸å¨è§£å³ä¾èµçæ¶åä¼å ä¸ä¸ä¸ªåæ°npm install --registry=https://registry.npm.taobao.orgå°æºæå®ä¸ºæ·å®çæºï¼ä»¥æè®©éåº¦å å¿«èµ·æ¥ï¼äºå®ä¸è¿ç§çç¡®è½å¤è®©éåº¦åå¿«ï¼ä½æ¯é¿ä¹æ¥çï¼å¦ææ³çæ­£çå¿«éææ·å¼åé¨ç½²ï¼æ­å»ºä¼ä¸åé¨çç§æï¼åä¼è®©éåº¦æ´ä¸ä¸ä¸ªå°é¶ã"},{property:"og:image",content:"http://pic.zzppjj.top/LightPicture/2023/02/013b7fc775dcf453.jpg"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/03.nexus/02.%E4%BD%BF%E7%94%A8nexus3%E9%85%8D%E7%BD%AEnpm%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-20T10:57:40.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ä½¿ç¨nexus3éç½®npmç§æä»åº"},{itemprop:"description",content:"å½æä»¬è¿è¡åç«¯é¡¹ç®çæ¶åï¼å¸¸å¸¸å¨è§£å³ä¾èµçæ¶åä¼å ä¸ä¸ä¸ªåæ°npm install --registry=https://registry.npm.taobao.orgå°æºæå®ä¸ºæ·å®çæºï¼ä»¥æè®©éåº¦å å¿«èµ·æ¥ï¼äºå®ä¸è¿ç§çç¡®è½å¤è®©éåº¦åå¿«ï¼ä½æ¯é¿ä¹æ¥çï¼å¦ææ³çæ­£çå¿«éææ·å¼åé¨ç½²ï¼æ­å»ºä¼ä¸åé¨çç§æï¼åä¼è®©éåº¦æ´ä¸ä¸ä¸ªå°é¶ã"},{itemprop:"image",content:"http://pic.zzppjj.top/LightPicture/2023/02/013b7fc775dcf453.jpg"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/03.nexus/02.%E4%BD%BF%E7%94%A8nexus3%E9%85%8D%E7%BD%AEnpm%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html",relativePath:"04.è¿ç»´/09.ç³»ç»/03.nexus/02.ä½¿ç¨nexus3éç½®npmç§æä»åº.md",key:"v-6feefc5e",path:"/pages/b851fe/",headers:[{level:2,title:"1ï¼åå»ºblobå­å¨ã",slug:"_1-åå»ºblobå­å¨ã",normalizedTitle:"1ï¼åå»ºblobå­å¨ã",charIndex:340},{level:2,title:"2ï¼åå»ºhostedç±»åçnpmã",slug:"_2-åå»ºhostedç±»åçnpmã",normalizedTitle:"2ï¼åå»ºhostedç±»åçnpmã",charIndex:374},{level:2,title:"3ï¼åå»ºä¸ä¸ªproxyç±»åçnpmä»åºã",slug:"_3-åå»ºä¸ä¸ªproxyç±»åçnpmä»åºã",normalizedTitle:"3ï¼åå»ºä¸ä¸ªproxyç±»åçnpmä»åºã",charIndex:544},{level:2,title:"4ï¼åå»ºä¸ä¸ªgroupç±»åçnpmä»åºã",slug:"_4-åå»ºä¸ä¸ªgroupç±»åçnpmä»åºã",normalizedTitle:"4ï¼åå»ºä¸ä¸ªgroupç±»åçnpmä»åºã",charIndex:700},{level:2,title:"5ï¼éªè¯ä½¿ç¨ã",slug:"_5-éªè¯ä½¿ç¨ã",normalizedTitle:"5ï¼éªè¯ä½¿ç¨ã",charIndex:844},{level:3,title:"1ï¼é¦åè·åé»è®¤çä»åºå°åï¼",slug:"_1-é¦åè·åé»è®¤çä»åºå°å",normalizedTitle:"1ï¼é¦åè·åé»è®¤çä»åºå°åï¼",charIndex:1383},{level:3,title:"2ï¼éç½®ä¸ºç§æå°åã",slug:"_2-éç½®ä¸ºç§æå°åã",normalizedTitle:"2ï¼éç½®ä¸ºç§æå°åã",charIndex:1488},{level:3,title:"3ï¼å®è£ç¼è¯ã",slug:"_3-å®è£ç¼è¯ã",normalizedTitle:"3ï¼å®è£ç¼è¯ã",charIndex:1769},{level:3,title:"4ï¼åä¸æ¬¡å®è£ç¼è¯ã",slug:"_4-åä¸æ¬¡å®è£ç¼è¯ã",normalizedTitle:"4ï¼åä¸æ¬¡å®è£ç¼è¯ã",charIndex:2373}],headersStr:"1ï¼åå»ºblobå­å¨ã 2ï¼åå»ºhostedç±»åçnpmã 3ï¼åå»ºä¸ä¸ªproxyç±»åçnpmä»åºã 4ï¼åå»ºä¸ä¸ªgroupç±»åçnpmä»åºã 5ï¼éªè¯ä½¿ç¨ã 1ï¼é¦åè·åé»è®¤çä»åºå°åï¼ 2ï¼éç½®ä¸ºç§æå°åã 3ï¼å®è£ç¼è¯ã 4ï¼åä¸æ¬¡å®è£ç¼è¯ã",content:'å½æä»¬è¿è¡åç«¯é¡¹ç®çæ¶åï¼å¸¸å¸¸å¨è§£å³ä¾èµçæ¶åä¼å ä¸ä¸ä¸ªåæ°npm install --registry=https://registry.npm.taobao.orgå°æºæå®ä¸ºæ·å®çæºï¼ä»¥æè®©éåº¦å å¿«èµ·æ¥ï¼äºå®ä¸è¿ç§çç¡®è½å¤è®©éåº¦åå¿«ï¼ä½æ¯é¿ä¹æ¥çï¼å¦ææ³çæ­£çå¿«éææ·å¼åé¨ç½²ï¼æ­å»ºä¼ä¸åé¨çç§æï¼åä¼è®©éåº¦æ´ä¸ä¸ä¸ªå°é¶ã\n\næ­å»ºnpmç§æï¼æä»¬ä¾æ§ä½¿ç¨nexus3ã\n\nä¸å¶ä»ç§æä¸æ ·çï¼npmç§æåæ ·æä¸ç§ç±»åï¼\n\n * hosted : æ¬å°å­å¨ï¼å³å docker å®æ¹ä»åºä¸æ ·æä¾æ¬å°ç§æåè½\n * proxy : æä¾ä»£çå¶ä»ä»åºçç±»åï¼å¦ docker ä¸­å¤®ä»åº\n * group : ç»ç±»åï¼å®è´¨ä½ç¨æ¯ç»åå¤ä¸ªä»åºä¸ºä¸ä¸ªå°å\n\né£ä¹å°±æ¥ä¸ä¸ªä¸ä¸ªåå»ºã\n\n\n# 1ï¼åå»ºblobå­å¨ã\n\nä¸ºå¶åå»ºä¸ä¸ªåç¬çå­å¨ç©ºé´ã\n\n\n\n\n# 2ï¼åå»ºhostedç±»åçnpmã\n\n * Name: å®ä¹ä¸ä¸ªåç§°local-npm\n * Storageï¼Blob storeï¼æä»¬ä¸æéæ©åé¢åå»ºå¥½çä¸ç¨blobï¼npm-hubã\n * Hostedï¼å¼åç¯å¢ï¼æä»¬è¿è¡éå¤åå¸ï¼å æ­¤Delpoyment policy æä»¬éæ©Allow redeployãè¿ä¸ªå¾éè¦ï¼\n\n\n\n\n# 3ï¼åå»ºä¸ä¸ªproxyç±»åçnpmä»åºã\n\n * Name: proxy-npm\n * Proxyï¼Remote Storage: è¿ç¨ä»åºå°åï¼è¿éå¡«å: https://registry.npmjs.org\n * Storage: npm-hubã\n\nå¶ä»çåæ¯é»è®¤ã\n\næ´ä½éç½®æªå¾å¦ä¸ï¼\n\n\n\n\n\n\n# 4ï¼åå»ºä¸ä¸ªgroupç±»åçnpmä»åºã\n\n * Nameï¼group-npm\n * Storageï¼éæ©ä¸ç¨çblobå­å¨npm-hubã\n * group : å°å·¦è¾¹å¯éç2ä¸ªä»åºï¼æ·»å å°å³è¾¹çmembersä¸ã\n\næ´ä½éç½®æªå¾å¦ä¸ï¼\n\n\n\nè¿äºéç½®å®æä¹åï¼å°±å¯ä»¥ä½¿ç¨äºã\n\n\n# 5ï¼éªè¯ä½¿ç¨ã\n\næ°å»ºä¸å°ç¯å¢å¹²åçä¸»æºï¼å®è£å¥½nodeç¯å¢ã\n\né¦åéè¿curl 192.168.106.10/a | shå®è£å¥½nodeç¯å¢ã\n\nå¦æçä¸æè¿æ¯ä»ä¹é¬¼ï¼å¯ä»¥ç¹å»è¿ç¯æç« äºè§£ï¼æå»ºè¿ç»´å¤æã\n\næ­¤èæ¬æå·²ç»å¼æºå¨GitHubä¹ä¸­ï¼æå´è¶£çåå­¦å¯ä»¥ç¹å»ä¸è¾¹è·³è½¬åè§ã\n\nmagic-of-sysuse-scripts\n\nè¿ç»´å¤æå°å·¥å·\n\n- name: magic-of-sysuse-scripts\n  desc: è¿ç»´å¤æå°å·¥å·\n  avatar: https://avatars2.githubusercontent.com/u/416130?s=460&u=8753e86600e300a9811cdc539aa158deec2e2724&v=4 # å¯é\n  link: https://github.com/eryajf/magic-of-sysuse-scripts # å¯é\n  bgColor: \'#FBDE4B\' # å¯éï¼é»è®¤var(--bodyBg)ãé¢è²å¼æ#å·æ¶è¯·æ·»å åå¼å·\n  textColor: \'#fff\' # å¯éï¼é»è®¤var(--textColor)\n\n\n1\n2\n3\n4\n5\n6\n\n\nç¶åæ·è´ä¸ä»½åç«¯é¡¹ç®çæºç ã\n\n\n# 1ï¼é¦åè·åé»è®¤çä»åºå°åï¼\n\n[root@moban business_jsdweb]$npm config get registryhttps://registry.npmjs.org/\n\n\n1\n\n\n\n# 2ï¼éç½®ä¸ºç§æå°åã\n\nä»å¦ä¸æªå¾ä¸­æ¥ç(å¶å®å°±æ¯åå»ºçç»å¯¹å¤çå°å)ã\n\n\n\néè¿å¦ä¸å½ä»¤éç½®ï¼\n\n[root@moban business_jsdweb]$npm config set registry http://192.168.112.214:8081/repository/group-npm/\n[root@moban business_jsdweb]$npm config get registry\nhttp://192.168.112.214:8081/repository/group-npm/\n\n\n1\n2\n3\n\n\nå¯ä»¥çå°è¿æ¯ç©ºçã\n\n\n# 3ï¼å®è£ç¼è¯ã\n\nnpm install\n\n\n1\n\n\nå¨ç¼è¯çè¿ç¨ä¸­ï¼æä»¬å·²ç»å¯ä»¥ççç»éçååäºï¼\n\n\n\nå®è£å®æï¼æ´ä¸ªè¿ç¨å¦ä¸ï¼å¯ä»¥çå°ä¸å±è±è´¹äº82ç§ã\n\n[root@moban business_jsdweb]$npm install\n\n> uglifyjs-webpack-plugin@0.4.6 postinstall /root/business_jsdweb/node_modules/webpack/node_modules/uglifyjs-webpack-plugin\n> node lib/post_install.js\n\nnpm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.4 (node_modules/fsevents):\nnpm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.4: wanted {"os":"darwin","arch":"any"} (current: {"os":"linux","arch":"x64"})\n\nadded 1216 packages from 717 contributors in 82.171s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# 4ï¼åä¸æ¬¡å®è£ç¼è¯ã\n\nè¿éååå¤ä¸å°ç¯å¢å¹²åçä¸»æºï¼ç¶åè¿è¡ä¸æ¬¡ç¼è¯å®è£ï¼ççææã\n\nç¼è¯ä¹åï¼åå°è¿ç¨å°åéç½®ä¸ºæä»¬èªå·±çï¼\n\n[root@7-3 business_jsdweb]$npm config get registry\nhttps://registry.npmjs.org/\n[root@7-3 business_jsdweb]$npm config set registry http://192.168.112.214:8081/repository/group-npm/\n[root@7-3 business_jsdweb]$npm config get registry\nhttp://192.168.112.214:8081/repository/group-npm/\n\n\n1\n2\n3\n4\n5\n\n\nç¶åç¼è¯ï¼çææï¼\n\n[root@7-3 business_jsdweb]$npm install\n\n> uglifyjs-webpack-plugin@0.4.6 postinstall /root/business_jsdweb/node_modules/webpack/node_modules/uglifyjs-webpack-plugin\n> node lib/post_install.js\n\nnpm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.4 (node_modules/fsevents):\nnpm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.4: wanted {"os":"darwin","arch":"any"} (current: {"os":"linux","arch":"x64"})\n\nadded 1216 packages from 717 contributors in 31.693s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¯ä»¥çå°ï¼åæ ·æ¯å¨æ°çç¯å¢ä¸ï¼å ä¸ºç¬¬ä¸æ¬¡å·²ç»å°ä¾èµä»è¿ç¨ç¼å­å°æ¬å°ç§æï¼é£ä¹å¨ç¬¬äºæ¬¡å®è£ç¼è¯çæ¶åï¼ç¨æ¶31ç§ã\n\nç§æçéè¦æ§ï¼ä»¥åä¾¿æ·æ§ï¼é«ä¸ç«è§ï¼\n\nåæé¾æ¥ï¼ä½¿ç¨nexus3éç½®npmç§æä»åº | äºä¸«è®²æ¢µ',normalizedContent:'å½æä»¬è¿è¡åç«¯é¡¹ç®çæ¶åï¼å¸¸å¸¸å¨è§£å³ä¾èµçæ¶åä¼å ä¸ä¸ä¸ªåæ°npm install --registry=https://registry.npm.taobao.orgå°æºæå®ä¸ºæ·å®çæºï¼ä»¥æè®©éåº¦å å¿«èµ·æ¥ï¼äºå®ä¸è¿ç§çç¡®è½å¤è®©éåº¦åå¿«ï¼ä½æ¯é¿ä¹æ¥çï¼å¦ææ³çæ­£çå¿«éææ·å¼åé¨ç½²ï¼æ­å»ºä¼ä¸åé¨çç§æï¼åä¼è®©éåº¦æ´ä¸ä¸ä¸ªå°é¶ã\n\næ­å»ºnpmç§æï¼æä»¬ä¾æ§ä½¿ç¨nexus3ã\n\nä¸å¶ä»ç§æä¸æ ·çï¼npmç§æåæ ·æä¸ç§ç±»åï¼\n\n * hosted : æ¬å°å­å¨ï¼å³å docker å®æ¹ä»åºä¸æ ·æä¾æ¬å°ç§æåè½\n * proxy : æä¾ä»£çå¶ä»ä»åºçç±»åï¼å¦ docker ä¸­å¤®ä»åº\n * group : ç»ç±»åï¼å®è´¨ä½ç¨æ¯ç»åå¤ä¸ªä»åºä¸ºä¸ä¸ªå°å\n\né£ä¹å°±æ¥ä¸ä¸ªä¸ä¸ªåå»ºã\n\n\n# 1ï¼åå»ºblobå­å¨ã\n\nä¸ºå¶åå»ºä¸ä¸ªåç¬çå­å¨ç©ºé´ã\n\n\n\n\n# 2ï¼åå»ºhostedç±»åçnpmã\n\n * name: å®ä¹ä¸ä¸ªåç§°local-npm\n * storageï¼blob storeï¼æä»¬ä¸æéæ©åé¢åå»ºå¥½çä¸ç¨blobï¼npm-hubã\n * hostedï¼å¼åç¯å¢ï¼æä»¬è¿è¡éå¤åå¸ï¼å æ­¤delpoyment policy æä»¬éæ©allow redeployãè¿ä¸ªå¾éè¦ï¼\n\n\n\n\n# 3ï¼åå»ºä¸ä¸ªproxyç±»åçnpmä»åºã\n\n * name: proxy-npm\n * proxyï¼remote storage: è¿ç¨ä»åºå°åï¼è¿éå¡«å: https://registry.npmjs.org\n * storage: npm-hubã\n\nå¶ä»çåæ¯é»è®¤ã\n\næ´ä½éç½®æªå¾å¦ä¸ï¼\n\n\n\n\n\n\n# 4ï¼åå»ºä¸ä¸ªgroupç±»åçnpmä»åºã\n\n * nameï¼group-npm\n * storageï¼éæ©ä¸ç¨çblobå­å¨npm-hubã\n * group : å°å·¦è¾¹å¯éç2ä¸ªä»åºï¼æ·»å å°å³è¾¹çmembersä¸ã\n\næ´ä½éç½®æªå¾å¦ä¸ï¼\n\n\n\nè¿äºéç½®å®æä¹åï¼å°±å¯ä»¥ä½¿ç¨äºã\n\n\n# 5ï¼éªè¯ä½¿ç¨ã\n\næ°å»ºä¸å°ç¯å¢å¹²åçä¸»æºï¼å®è£å¥½nodeç¯å¢ã\n\né¦åéè¿curl 192.168.106.10/a | shå®è£å¥½nodeç¯å¢ã\n\nå¦æçä¸æè¿æ¯ä»ä¹é¬¼ï¼å¯ä»¥ç¹å»è¿ç¯æç« äºè§£ï¼æå»ºè¿ç»´å¤æã\n\næ­¤èæ¬æå·²ç»å¼æºå¨githubä¹ä¸­ï¼æå´è¶£çåå­¦å¯ä»¥ç¹å»ä¸è¾¹è·³è½¬åè§ã\n\nmagic-of-sysuse-scripts\n\nè¿ç»´å¤æå°å·¥å·\n\n- name: magic-of-sysuse-scripts\n  desc: è¿ç»´å¤æå°å·¥å·\n  avatar: https://avatars2.githubusercontent.com/u/416130?s=460&u=8753e86600e300a9811cdc539aa158deec2e2724&v=4 # å¯é\n  link: https://github.com/eryajf/magic-of-sysuse-scripts # å¯é\n  bgcolor: \'#fbde4b\' # å¯éï¼é»è®¤var(--bodybg)ãé¢è²å¼æ#å·æ¶è¯·æ·»å åå¼å·\n  textcolor: \'#fff\' # å¯éï¼é»è®¤var(--textcolor)\n\n\n1\n2\n3\n4\n5\n6\n\n\nç¶åæ·è´ä¸ä»½åç«¯é¡¹ç®çæºç ã\n\n\n# 1ï¼é¦åè·åé»è®¤çä»åºå°åï¼\n\n[root@moban business_jsdweb]$npm config get registryhttps://registry.npmjs.org/\n\n\n1\n\n\n\n# 2ï¼éç½®ä¸ºç§æå°åã\n\nä»å¦ä¸æªå¾ä¸­æ¥ç(å¶å®å°±æ¯åå»ºçç»å¯¹å¤çå°å)ã\n\n\n\néè¿å¦ä¸å½ä»¤éç½®ï¼\n\n[root@moban business_jsdweb]$npm config set registry http://192.168.112.214:8081/repository/group-npm/\n[root@moban business_jsdweb]$npm config get registry\nhttp://192.168.112.214:8081/repository/group-npm/\n\n\n1\n2\n3\n\n\nå¯ä»¥çå°è¿æ¯ç©ºçã\n\n\n# 3ï¼å®è£ç¼è¯ã\n\nnpm install\n\n\n1\n\n\nå¨ç¼è¯çè¿ç¨ä¸­ï¼æä»¬å·²ç»å¯ä»¥ççç»éçååäºï¼\n\n\n\nå®è£å®æï¼æ´ä¸ªè¿ç¨å¦ä¸ï¼å¯ä»¥çå°ä¸å±è±è´¹äº82ç§ã\n\n[root@moban business_jsdweb]$npm install\n\n> uglifyjs-webpack-plugin@0.4.6 postinstall /root/business_jsdweb/node_modules/webpack/node_modules/uglifyjs-webpack-plugin\n> node lib/post_install.js\n\nnpm warn optional skipping optional dependency: fsevents@1.2.4 (node_modules/fsevents):\nnpm warn notsup skipping optional dependency: unsupported platform for fsevents@1.2.4: wanted {"os":"darwin","arch":"any"} (current: {"os":"linux","arch":"x64"})\n\nadded 1216 packages from 717 contributors in 82.171s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n# 4ï¼åä¸æ¬¡å®è£ç¼è¯ã\n\nè¿éååå¤ä¸å°ç¯å¢å¹²åçä¸»æºï¼ç¶åè¿è¡ä¸æ¬¡ç¼è¯å®è£ï¼ççææã\n\nç¼è¯ä¹åï¼åå°è¿ç¨å°åéç½®ä¸ºæä»¬èªå·±çï¼\n\n[root@7-3 business_jsdweb]$npm config get registry\nhttps://registry.npmjs.org/\n[root@7-3 business_jsdweb]$npm config set registry http://192.168.112.214:8081/repository/group-npm/\n[root@7-3 business_jsdweb]$npm config get registry\nhttp://192.168.112.214:8081/repository/group-npm/\n\n\n1\n2\n3\n4\n5\n\n\nç¶åç¼è¯ï¼çææï¼\n\n[root@7-3 business_jsdweb]$npm install\n\n> uglifyjs-webpack-plugin@0.4.6 postinstall /root/business_jsdweb/node_modules/webpack/node_modules/uglifyjs-webpack-plugin\n> node lib/post_install.js\n\nnpm warn optional skipping optional dependency: fsevents@1.2.4 (node_modules/fsevents):\nnpm warn notsup skipping optional dependency: unsupported platform for fsevents@1.2.4: wanted {"os":"darwin","arch":"any"} (current: {"os":"linux","arch":"x64"})\n\nadded 1216 packages from 717 contributors in 31.693s\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nå¯ä»¥çå°ï¼åæ ·æ¯å¨æ°çç¯å¢ä¸ï¼å ä¸ºç¬¬ä¸æ¬¡å·²ç»å°ä¾èµä»è¿ç¨ç¼å­å°æ¬å°ç§æï¼é£ä¹å¨ç¬¬äºæ¬¡å®è£ç¼è¯çæ¶åï¼ç¨æ¶31ç§ã\n\nç§æçéè¦æ§ï¼ä»¥åä¾¿æ·æ§ï¼é«ä¸ç«è§ï¼\n\nåæé¾æ¥ï¼ä½¿ç¨nexus3éç½®npmç§æä»åº | äºä¸«è®²æ¢µ',charsets:{cjk:!0}},{title:"ä½¿ç¨nexus3éç½®mavenç§æä»åº",frontmatter:{title:"ä½¿ç¨nexus3éç½®mavenç§æä»åº",date:"2023-02-20T12:03:31.000Z",permalink:"/pages/12e16a/",categories:["è¿ç»´","ç³»ç»","nexus"],tags:[null],readingShow:"top",description:"éç½®ä¹åï¼æä»¬åæ¥ççç³»ç»é»è®¤åå»ºçé½æåªäºï¼",meta:[{name:"image",content:"http://pic.zzppjj.top/LightPicture/2023/02/40cd9e21fa166d75.jpg"},{name:"twitter:title",content:"ä½¿ç¨nexus3éç½®mavenç§æä»åº"},{name:"twitter:description",content:"éç½®ä¹åï¼æä»¬åæ¥ççç³»ç»é»è®¤åå»ºçé½æåªäºï¼"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://pic.zzppjj.top/LightPicture/2023/02/40cd9e21fa166d75.jpg"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/03.nexus/03.%E4%BD%BF%E7%94%A8nexus3%E9%85%8D%E7%BD%AEmaven%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ä½¿ç¨nexus3éç½®mavenç§æä»åº"},{property:"og:description",content:"éç½®ä¹åï¼æä»¬åæ¥ççç³»ç»é»è®¤åå»ºçé½æåªäºï¼"},{property:"og:image",content:"http://pic.zzppjj.top/LightPicture/2023/02/40cd9e21fa166d75.jpg"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/03.nexus/03.%E4%BD%BF%E7%94%A8nexus3%E9%85%8D%E7%BD%AEmaven%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-20T12:03:31.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ä½¿ç¨nexus3éç½®mavenç§æä»åº"},{itemprop:"description",content:"éç½®ä¹åï¼æä»¬åæ¥ççç³»ç»é»è®¤åå»ºçé½æåªäºï¼"},{itemprop:"image",content:"http://pic.zzppjj.top/LightPicture/2023/02/40cd9e21fa166d75.jpg"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/09.%E7%B3%BB%E7%BB%9F/03.nexus/03.%E4%BD%BF%E7%94%A8nexus3%E9%85%8D%E7%BD%AEmaven%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93.html",relativePath:"04.è¿ç»´/09.ç³»ç»/03.nexus/03.ä½¿ç¨nexus3éç½®mavenç§æä»åº.md",key:"v-28dc669e",path:"/pages/12e16a/",headers:[{level:2,title:"1ï¼åå»ºblobå­å¨ã",slug:"_1-åå»ºblobå­å¨ã",normalizedTitle:"1ï¼åå»ºblobå­å¨ã",charIndex:71},{level:2,title:"2ï¼åå»ºhostedç±»åçmavenã",slug:"_2-åå»ºhostedç±»åçmavenã",normalizedTitle:"2ï¼åå»ºhostedç±»åçmavenã",charIndex:89},{level:2,title:"3ï¼åå»ºä¸ä¸ªproxyç±»åçmavenä»åºã",slug:"_3-åå»ºä¸ä¸ªproxyç±»åçmavenä»åºã",normalizedTitle:"3ï¼åå»ºä¸ä¸ªproxyç±»åçmavenä»åºã",charIndex:533},{level:2,title:"4ï¼åå»ºä¸ä¸ªgroupç±»åçmavenä»åºã",slug:"_4-åå»ºä¸ä¸ªgroupç±»åçmavenä»åºã",normalizedTitle:"4ï¼åå»ºä¸ä¸ªgroupç±»åçmavenä»åºã",charIndex:845},{level:2,title:"5ï¼éªè¯ä½¿ç¨ã",slug:"_5-éªè¯ä½¿ç¨ã",normalizedTitle:"5ï¼éªè¯ä½¿ç¨ã",charIndex:1114},{level:3,title:"1ï¼å®è£jdkã",slug:"_1-å®è£jdkã",normalizedTitle:"1ï¼å®è£jdkã",charIndex:1245},{level:3,title:"2ï¼å®è£mavenã",slug:"_2-å®è£mavenã",normalizedTitle:"2ï¼å®è£mavenã",charIndex:1284},{level:3,title:"3ï¼æ´æ¹mavençéç½®ã",slug:"_3-æ´æ¹mavençéç½®ã",normalizedTitle:"3ï¼æ´æ¹mavençéç½®ã",charIndex:1309},{level:3,title:"4ï¼æåé¡¹ç®ç¼è¯ã",slug:"_4-æåé¡¹ç®ç¼è¯ã",normalizedTitle:"4ï¼æåé¡¹ç®ç¼è¯ã",charIndex:13331}],headersStr:"1ï¼åå»ºblobå­å¨ã 2ï¼åå»ºhostedç±»åçmavenã 3ï¼åå»ºä¸ä¸ªproxyç±»åçmavenä»åºã 4ï¼åå»ºä¸ä¸ªgroupç±»åçmavenä»åºã 5ï¼éªè¯ä½¿ç¨ã 1ï¼å®è£jdkã 2ï¼å®è£mavenã 3ï¼æ´æ¹mavençéç½®ã 4ï¼æåé¡¹ç®ç¼è¯ã",content:"éç½®ä¹åï¼æä»¬åæ¥ççç³»ç»é»è®¤åå»ºçé½æåªäºï¼\n\nå¶ä¸­åèµ·æ¥çé½æ¯ç³»ç»åæçï¼ç¨ä¸å°ï¼å°±å¨å æï¼éæ°åå»ºã\n\n\n\nèè§ç©ï¼å¼å§åå»ºã\n\n\n# 1ï¼åå»ºblobå­å¨ã\n\n\n\n\n# 2ï¼åå»ºhostedç±»åçmavenã\n\nç¹å» Repositoryä¸é¢ç Repositories â Create repository â maven2(hosted) :\n\n * Name: å®ä¹ä¸ä¸ªåç§°maven-local\n\n * Online: å¾éãè¿ä¸ªå¼å³å¯ä»¥è®¾ç½®è¿ä¸ªmaven repoæ¯å¨çº¿è¿æ¯ç¦»çº¿ã\n\n * Maven2ï¼è¿éæä¸ç§æ¹å¼ï¼ReleasesãSNAPSHOTãMixedã\n   \n   * Releases: ä¸è¬æ¯å·²ç»åå¸çJarå\n   * Snapshot: æªåå¸ççæ¬\n   * Mixedï¼æ··åç\n\nè¿éä¸åè®¾ç½®ï¼é»è®¤å³å¯ã\n\n * Storage\n   \n   Blob storeï¼æä»¬ä¸æéæ©åé¢åå»ºå¥½çä¸ç¨blobï¼maven-useã\n\n * Hosted\n   \n   å¼åç¯å¢ï¼æä»¬è¿è¡éå¤åå¸ï¼å æ­¤Delpoyment policy æä»¬éæ©Allow redeployãè¿ä¸ªå¾éè¦ï¼\n\næ´ä½éç½®æªå¾å¦ä¸ï¼\n\n\n\n\n# 3ï¼åå»ºä¸ä¸ªproxyç±»åçmavenä»åºã\n\nproxyçåè½å°±æ¯ä»£çä¸­å¤®Mavenä»åºï¼å½PCè®¿é®ä¸­å¤®åºçæ¶åï¼åéè¿Proxyä¸è½½å°Nexusä»åºï¼ç¶ååä»Nexusä»åºä¸è½½å°PCæ¬å°ã è¿æ ·çä¼å¿åªè¦å¶ä¸­ä¸ä¸ªäººä»ä¸­å¤®åºä¸æ¥äºï¼ä»¥åå¤§å®¶é½æ¯ä»Nexusç§æä¸è¿è¡ä¸æ¥ï¼ç§æä¸è¬é¨ç½²å¨åç½ï¼è¿æ ·å¤§å¤§èçº¦çå®½å¸¦ã\n\n * Name: proxy-maven\n\n * Maven 2: ä¸è®¾ç½®ï¼ä½¿ç¨é»è®¤ã\n\n * Proxy\n   \n   Remote Storage: è¿ç¨ä»åºå°åï¼è¿éå¡«å: Central Repository:\n\n * Storage: maven-useã\n\næ´ä½éç½®æªå¾å¦ä¸ï¼\n\n\n\n\n\n\n# 4ï¼åå»ºä¸ä¸ªgroupç±»åçmavenä»åºã\n\næç¤º\n\ngroupç±»åçmavenä»åºï¼æ¯ä¸ä¸ªèåç±»åçä»åºãå®å¯ä»¥å°åé¢æä»¬åå»ºç2ä¸ªä»åºèåæä¸ä¸ªURLå¯¹å¤æä¾æå¡ï¼å¯ä»¥å±è½åç«¯çå·®å¼æ§ï¼å®ç°ç±»ä¼¼éæä»£ççåè½ãåé¢éè¿ä¸äºéç½®ï¼å¤§å®¶å¯è½ä¼å¯¹è¿ä¸ªgroupææ´å æ·±å¥çäºè§£ã\n\n * Nameï¼group-maven\n\n * Storageï¼éæ©ä¸ç¨çblobå­å¨maven-useã\n\n * group : å°å·¦è¾¹å¯éç2ä¸ªä»åºï¼æ·»å å°å³è¾¹çmembersä¸ã\n\næ´ä½éç½®æªå¾å¦ä¸ï¼\n\nè¿æ ·éç½®ä»¥åï¼æä»¬å°±å¯ä»¥ä½¿ç¨äºã\n\n\n\n\n# 5ï¼éªè¯ä½¿ç¨ã\n\nä½¿ç¨èµ·æ¥å¶å®éå¸¸ç®åï¼å°±æ¯å¨æµè¯æºå¨ä¸å®è£mavenå·¥å·ï¼ç¶ååå¶éç½®å½ä¸­ï¼å°å°åæåæä»¬çç§æå°åï¼ç¶åç¼è¯é¡¹ç®ï¼è¿ä¸ªæ¶åå°±ä¼éè¿ç§ææ¥æåjaråäºï¼ä»¥ååç¼è¯çæ¶åï¼å°±å¯ä»¥ç´æ¥ä»æ¬å°ç§ææåäºã\n\nç°å¨æ¾ä¸å°æµè¯æºå¨ï¼è¿è¡éªè¯ã\n\n\n# 1ï¼å®è£jdkã\n\nå ä¸ºmavenä¾èµäºjdkï¼æä»¥è¦åå®è£jdkã\n\n\n# 2ï¼å®è£mavenã\n\nå®è£mavenã\n\n\n# 3ï¼æ´æ¹mavençéç½®ã\n\nå°é¡¹ç®ç¼è¯ä¾èµå°åæåæ¹æç§æçéç½®ï¼éè¦éè¿æ´æ¹mavençéç½®å®ç°ï¼ä¹å°±æ¯æ´æ¹maven/conf/settings.xmlçä»åºå°åã\n\nè¯´å®è¯ï¼æå°è¯å®è£ä¸ä¸ªå¨æ°çmavenï¼ä»èéè¿ä¿®æ¹éç½®æ¥å®ç°èµ°ç§ææåä¾èµï¼ä½æ¯ï¼ç»è¿è¿æ ·çæä½ï¼æå¤±è´¥äºã\n\nå æ­¤è¿éå°ç°å½¹æ­£ç¨çéç½®æ¿åºæ¥ï¼ä»ä¿®æ¹å¶ä¸­çæ ¸å¿å¤ï¼ç§æé¾æ¥ï¼å§ï¼\n\nç¹å»æ¥ç\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n\x3c!--\nLicensed to the Apache Software Foundation (ASF) under one\nor more contributor license agreements.  See the NOTICE file\ndistributed with this work for additional information\nregarding copyright ownership.  The ASF licenses this file\nto you under the Apache License, Version 2.0 (the\n\"License\"); you may not use this file except in compliance\nwith the License.  You may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing,\nsoftware distributed under the License is distributed on an\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\nKIND, either express or implied.  See the License for the\nspecific language governing permissions and limitations\nunder the License.\n--\x3e\n\n\x3c!--\n | This is the configuration file for Maven. It can be specified at two levels:\n |\n |  1. User Level. This settings.xml file provides configuration for a single user,\n |                 and is normally provided in ${user.home}/.m2/settings.xml.\n |\n |                 NOTE: This location can be overridden with the CLI option:\n |\n |                 -s /path/to/user/settings.xml\n |\n |  2. Global Level. This settings.xml file provides configuration for all Maven\n |                 users on a machine (assuming they're all using the same Maven\n |                 installation). It's normally provided in\n |                 ${maven.home}/conf/settings.xml.\n |\n |                 NOTE: This location can be overridden with the CLI option:\n |\n |                 -gs /path/to/global/settings.xml\n |\n | The sections in this sample file are intended to give you a running start at\n | getting the most out of your Maven installation. Where appropriate, the default\n | values (values used when the setting is not specified) are provided.\n |\n |--\x3e\n<settings xmlns=\"http://maven.apache.org/SETTINGS/1.0.0\"\n          xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n          xsi:schemaLocation=\"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd\">\n  \x3c!-- localRepository\n   | The path to the local repository maven will use to store artifacts.\n   |\n   | Default: ${user.home}/.m2/repository\n  <localRepository>/path/to/local/repo</localRepository>\n  --\x3e\n\n  \x3c!-- interactiveMode\n   | This will determine whether maven prompts you when it needs input. If set to false,\n   | maven will use a sensible default value, perhaps based on some other setting, for\n   | the parameter in question.\n   |\n   | Default: true\n  <interactiveMode>true</interactiveMode>\n  --\x3e\n  <interactiveMode>false</interactiveMode>\n\n  \x3c!-- offline\n   | Determines whether maven should attempt to connect to the network when executing a build.\n   | This will have an effect on artifact downloads, artifact deployment, and others.\n   |\n   | Default: false\n  <offline>false</offline>\n  --\x3e\n\n  \x3c!-- pluginGroups\n   | This is a list of additional group identifiers that will be searched when resolving plugins by their prefix, i.e.\n   | when invoking a command line like \"mvn prefix:goal\". Maven will automatically add thegroup identifiers\n   | \"org.apache.maven.plugins\" and \"org.codehaus.mojo\" if these are not already containedin the list.\n   |--\x3e\n  <pluginGroups>\n    \x3c!-- pluginGroup\n     | Specifies a further group identifier to use for plugin lookup.\n    <pluginGroup>com.your.plugins</pluginGroup>\n    --\x3e\n  </pluginGroups>\n\n  \x3c!-- proxies\n   | This is a list of proxies which can be used on this machine to connect to the network.\n   | Unless otherwise specified (by system property or command-line switch), the first proxy\n   | specification in this list marked as active will be used.\n   |--\x3e\n  <proxies>\n    \x3c!-- proxy\n     | Specification for one proxy, to be used in connecting to the network.\n     |\n    <proxy>\n      <id>optional</id>\n      <active>true</active>\n      <protocol>http</protocol>\n      <username>proxyuser</username>\n      <password>proxypass</password>\n      <host>proxy.host.net</host>\n      <port>80</port>\n      <nonProxyHosts>local.net|some.host.com</nonProxyHosts>\n    </proxy>\n    --\x3e\n  </proxies>\n\n  \x3c!-- servers\n   | This is a list of authentication profiles, keyed by the server-id used within the system.\n   | Authentication profiles can be used whenever maven must make a connection to a remoteserver.\n   |--\x3e\n  <servers>\n    \x3c!-- server\n     | Specifies the authentication information to use when connecting to a particular server, identified by\n     | a unique name within the system (referred to by the 'id' attribute below).\n     |\n     | NOTE: You should either specify username/password OR privateKey/passphrase, since these pairings are\n     |       used together.\n     |\n    <server>\n      <id>deploymentRepo</id>\n      <username>repouser</username>\n      <password>repopwd</password>\n    </server>\n    --\x3e\n\n    \x3c!-- Another sample, using keys to authenticate.\n    <server>\n      <id>siteServer</id>\n      <privateKey>/path/to/private/key</privateKey>\n      <passphrase>optional; leave empty if not used.</passphrase>\n    </server>\n    --\x3e\n  </servers>\n\n  \x3c!-- mirrors\n   | This is a list of mirrors to be used in downloading artifacts from remote repositories.\n   |\n   | It works like this: a POM may declare a repository to use in resolving certain artifacts.\n   | However, this repository may have problems with heavy traffic at times, so people have mirrored\n   | it to several places.\n   |\n   | That repository definition will have a unique id, so we can create a mirror referencefor that\n   | repository, to be used as an alternate download site. The mirror site will be the preferred\n   | server for that repository.\n   |--\x3e\n  <mirrors>\n    \x3c!-- mirror\n     | Specifies a repository mirror site to use instead of a given repository. The repository that\n     | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used\n     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.\n     |\n    <mirror>\n      <id>mirrorId</id>\n      <mirrorOf>repositoryId</mirrorOf>\n      <name>Human Readable Name for this Mirror.</name>\n      <url>http://my.repository.com/repo/path</url>\n    </mirror>\n     --\x3e\n\n<mirror>\n<id>nexus-osc</id>\n<mirrorOf>*</mirrorOf>\n<name>Nexus osc</name>\n<url>http://192.168.106.21:8081/repository/maven-group/</url>\n</mirror>\n\n\n  </mirrors>\n\n  \x3c!-- profiles\n   | This is a list of profiles which can be activated in a variety of ways, and which canmodify\n   | the build process. Profiles provided in the settings.xml are intended to provide local machine-\n   | specific paths and repository locations which allow the build to work in the local environment.\n   |\n   | For example, if you have an integration testing plugin - like cactus - that needs to know where\n   | your Tomcat instance is installed, you can provide a variable here such that the variable is\n   | dereferenced during the build process to configure the cactus plugin.\n   |\n   | As noted above, profiles can be activated in a variety of ways. One way - the activeProfiles\n   | section of this document (settings.xml) - will be discussed later. Another way essentially\n   | relies on the detection of a system property, either matching a particular value for the property,\n   | or merely testing its existence. Profiles can also be activated by JDK version prefix, where a\n   | value of '1.4' might activate a profile when the build is executed on a JDK version of '1.4.2_07'.\n   | Finally, the list of active profiles can be specified directly from the command line.\n   |\n   | NOTE: For profiles defined in the settings.xml, you are restricted to specifying onlyartifact\n   |       repositories, plugin repositories, and free-form properties to be used as configuration\n   |       variables for plugins in the POM.\n   |\n   |--\x3e\n  <profiles>\n    \x3c!-- profile\n     | Specifies a set of introductions to the build process, to be activated using one ormore of the\n     | mechanisms described above. For inheritance purposes, and to activate profiles via <activatedProfiles/>\n     | or the command line, profiles have to have an ID that is unique.\n     |\n     | An encouraged best practice for profile identification is to use a consistent naming convention\n     | for profiles, such as 'env-dev', 'env-test', 'env-production', 'user-jdcasey', 'user-brett', etc.\n     | This will make it more intuitive to understand what the set of introduced profiles is attempting\n     | to accomplish, particularly when you only have a list of profile id's for debug.\n     |\n     | This profile example uses the JDK version to trigger activation, and provides a JDK-specific repo.\n    <profile>\n      <id>jdk-1.4</id>\n\n      <activation>\n        <jdk>1.4</jdk>\n      </activation>\n\n      <repositories>\n        <repository>\n          <id>jdk14</id>\n          <name>Repository for JDK 1.4 builds</name>\n          <url>http://www.myhost.com/maven/jdk14</url>\n          <layout>default</layout>\n          <snapshotPolicy>always</snapshotPolicy>\n        </repository>\n      </repositories>\n    </profile>\n    --\x3e\n        <profile>\n<id>dev</id>\n<repositories>\n  <repository>\n    <id>central</id>\n    <name>Central</name>\n    <layout>default</layout>\n    <url>http://my.repository.com/repo/path</url>\n    <snapshots>\n      <enabled> false</enabled>\n    </snapshots>\n  </repository>\n</repositories>\n</profile>\n\n    \x3c!--\n     | Here is another profile, activated by the system property 'target-env' with a valueof 'dev',\n     | which provides a specific path to the Tomcat instance. To use this, your plugin configuration\n     | might hypothetically look like:\n     |\n     | ...\n     | <plugin>\n     |   <groupId>org.myco.myplugins</groupId>\n     |   <artifactId>myplugin</artifactId>\n     |\n     |   <configuration>\n     |     <tomcatLocation>${tomcatPath}</tomcatLocation>\n     |   </configuration>\n     | </plugin>\n     | ...\n     |\n     | NOTE: If you just wanted to inject this configuration whenever someone set 'target-env' to\n     |       anything, you could just leave off the <value/> inside the activation-property.\n     |\n    <profile>\n      <id>env-dev</id>\n\n      <activation>\n        <property>\n          <name>target-env</name>\n          <value>dev</value>\n        </property>\n      </activation>\n\n      <properties>\n        <tomcatPath>/path/to/tomcat/instance</tomcatPath>\n      </properties>\n    </profile>\n    --\x3e\n  </profiles>\n\n  \x3c!-- activeProfiles\n   | List of profiles that are active for all builds.\n   |\n  <activeProfiles>\n    <activeProfile>alwaysActiveProfile</activeProfile>\n    <activeProfile>anotherAlwaysActiveProfile</activeProfile>\n  </activeProfiles>\n  --\x3e\n  <activeProfiles>\n    <activeProfile>dev</activeProfile>\n\n  </activeProfiles>\n</settings>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n\n\nç¶åä¿®æ¹å¶ä¸­çç¬¬165è¡ä¸ºææ°å»ºçç§æå°å\n\n\n\n\n# 4ï¼æåé¡¹ç®ç¼è¯ã\n\næåä¹åï¼è¿å°é¡¹ç®éè¾¹ï¼å¼å§ç¼è¯ã\n\nmvn clean package -U -Dmaven.test.skip=true\n\nåæé¾æ¥ï¼ä½¿ç¨nexus3éç½®mavenç§æä»åº | äºä¸«è®²æ¢µ",normalizedContent:"éç½®ä¹åï¼æä»¬åæ¥ççç³»ç»é»è®¤åå»ºçé½æåªäºï¼\n\nå¶ä¸­åèµ·æ¥çé½æ¯ç³»ç»åæçï¼ç¨ä¸å°ï¼å°±å¨å æï¼éæ°åå»ºã\n\n\n\nèè§ç©ï¼å¼å§åå»ºã\n\n\n# 1ï¼åå»ºblobå­å¨ã\n\n\n\n\n# 2ï¼åå»ºhostedç±»åçmavenã\n\nç¹å» repositoryä¸é¢ç repositories â create repository â maven2(hosted) :\n\n * name: å®ä¹ä¸ä¸ªåç§°maven-local\n\n * online: å¾éãè¿ä¸ªå¼å³å¯ä»¥è®¾ç½®è¿ä¸ªmaven repoæ¯å¨çº¿è¿æ¯ç¦»çº¿ã\n\n * maven2ï¼è¿éæä¸ç§æ¹å¼ï¼releasesãsnapshotãmixedã\n   \n   * releases: ä¸è¬æ¯å·²ç»åå¸çjarå\n   * snapshot: æªåå¸ççæ¬\n   * mixedï¼æ··åç\n\nè¿éä¸åè®¾ç½®ï¼é»è®¤å³å¯ã\n\n * storage\n   \n   blob storeï¼æä»¬ä¸æéæ©åé¢åå»ºå¥½çä¸ç¨blobï¼maven-useã\n\n * hosted\n   \n   å¼åç¯å¢ï¼æä»¬è¿è¡éå¤åå¸ï¼å æ­¤delpoyment policy æä»¬éæ©allow redeployãè¿ä¸ªå¾éè¦ï¼\n\næ´ä½éç½®æªå¾å¦ä¸ï¼\n\n\n\n\n# 3ï¼åå»ºä¸ä¸ªproxyç±»åçmavenä»åºã\n\nproxyçåè½å°±æ¯ä»£çä¸­å¤®mavenä»åºï¼å½pcè®¿é®ä¸­å¤®åºçæ¶åï¼åéè¿proxyä¸è½½å°nexusä»åºï¼ç¶ååä»nexusä»åºä¸è½½å°pcæ¬å°ã è¿æ ·çä¼å¿åªè¦å¶ä¸­ä¸ä¸ªäººä»ä¸­å¤®åºä¸æ¥äºï¼ä»¥åå¤§å®¶é½æ¯ä»nexusç§æä¸è¿è¡ä¸æ¥ï¼ç§æä¸è¬é¨ç½²å¨åç½ï¼è¿æ ·å¤§å¤§èçº¦çå®½å¸¦ã\n\n * name: proxy-maven\n\n * maven 2: ä¸è®¾ç½®ï¼ä½¿ç¨é»è®¤ã\n\n * proxy\n   \n   remote storage: è¿ç¨ä»åºå°åï¼è¿éå¡«å: central repository:\n\n * storage: maven-useã\n\næ´ä½éç½®æªå¾å¦ä¸ï¼\n\n\n\n\n\n\n# 4ï¼åå»ºä¸ä¸ªgroupç±»åçmavenä»åºã\n\næç¤º\n\ngroupç±»åçmavenä»åºï¼æ¯ä¸ä¸ªèåç±»åçä»åºãå®å¯ä»¥å°åé¢æä»¬åå»ºç2ä¸ªä»åºèåæä¸ä¸ªurlå¯¹å¤æä¾æå¡ï¼å¯ä»¥å±è½åç«¯çå·®å¼æ§ï¼å®ç°ç±»ä¼¼éæä»£ççåè½ãåé¢éè¿ä¸äºéç½®ï¼å¤§å®¶å¯è½ä¼å¯¹è¿ä¸ªgroupææ´å æ·±å¥çäºè§£ã\n\n * nameï¼group-maven\n\n * storageï¼éæ©ä¸ç¨çblobå­å¨maven-useã\n\n * group : å°å·¦è¾¹å¯éç2ä¸ªä»åºï¼æ·»å å°å³è¾¹çmembersä¸ã\n\næ´ä½éç½®æªå¾å¦ä¸ï¼\n\nè¿æ ·éç½®ä»¥åï¼æä»¬å°±å¯ä»¥ä½¿ç¨äºã\n\n\n\n\n# 5ï¼éªè¯ä½¿ç¨ã\n\nä½¿ç¨èµ·æ¥å¶å®éå¸¸ç®åï¼å°±æ¯å¨æµè¯æºå¨ä¸å®è£mavenå·¥å·ï¼ç¶ååå¶éç½®å½ä¸­ï¼å°å°åæåæä»¬çç§æå°åï¼ç¶åç¼è¯é¡¹ç®ï¼è¿ä¸ªæ¶åå°±ä¼éè¿ç§ææ¥æåjaråäºï¼ä»¥ååç¼è¯çæ¶åï¼å°±å¯ä»¥ç´æ¥ä»æ¬å°ç§ææåäºã\n\nç°å¨æ¾ä¸å°æµè¯æºå¨ï¼è¿è¡éªè¯ã\n\n\n# 1ï¼å®è£jdkã\n\nå ä¸ºmavenä¾èµäºjdkï¼æä»¥è¦åå®è£jdkã\n\n\n# 2ï¼å®è£mavenã\n\nå®è£mavenã\n\n\n# 3ï¼æ´æ¹mavençéç½®ã\n\nå°é¡¹ç®ç¼è¯ä¾èµå°åæåæ¹æç§æçéç½®ï¼éè¦éè¿æ´æ¹mavençéç½®å®ç°ï¼ä¹å°±æ¯æ´æ¹maven/conf/settings.xmlçä»åºå°åã\n\nè¯´å®è¯ï¼æå°è¯å®è£ä¸ä¸ªå¨æ°çmavenï¼ä»èéè¿ä¿®æ¹éç½®æ¥å®ç°èµ°ç§ææåä¾èµï¼ä½æ¯ï¼ç»è¿è¿æ ·çæä½ï¼æå¤±è´¥äºã\n\nå æ­¤è¿éå°ç°å½¹æ­£ç¨çéç½®æ¿åºæ¥ï¼ä»ä¿®æ¹å¶ä¸­çæ ¸å¿å¤ï¼ç§æé¾æ¥ï¼å§ï¼\n\nç¹å»æ¥ç\n\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n\n\x3c!--\nlicensed to the apache software foundation (asf) under one\nor more contributor license agreements.  see the notice file\ndistributed with this work for additional information\nregarding copyright ownership.  the asf licenses this file\nto you under the apache license, version 2.0 (the\n\"license\"); you may not use this file except in compliance\nwith the license.  you may obtain a copy of the license at\n\n    http://www.apache.org/licenses/license-2.0\n\nunless required by applicable law or agreed to in writing,\nsoftware distributed under the license is distributed on an\n\"as is\" basis, without warranties or conditions of any\nkind, either express or implied.  see the license for the\nspecific language governing permissions and limitations\nunder the license.\n--\x3e\n\n\x3c!--\n | this is the configuration file for maven. it can be specified at two levels:\n |\n |  1. user level. this settings.xml file provides configuration for a single user,\n |                 and is normally provided in ${user.home}/.m2/settings.xml.\n |\n |                 note: this location can be overridden with the cli option:\n |\n |                 -s /path/to/user/settings.xml\n |\n |  2. global level. this settings.xml file provides configuration for all maven\n |                 users on a machine (assuming they're all using the same maven\n |                 installation). it's normally provided in\n |                 ${maven.home}/conf/settings.xml.\n |\n |                 note: this location can be overridden with the cli option:\n |\n |                 -gs /path/to/global/settings.xml\n |\n | the sections in this sample file are intended to give you a running start at\n | getting the most out of your maven installation. where appropriate, the default\n | values (values used when the setting is not specified) are provided.\n |\n |--\x3e\n<settings xmlns=\"http://maven.apache.org/settings/1.0.0\"\n          xmlns:xsi=\"http://www.w3.org/2001/xmlschema-instance\"\n          xsi:schemalocation=\"http://maven.apache.org/settings/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd\">\n  \x3c!-- localrepository\n   | the path to the local repository maven will use to store artifacts.\n   |\n   | default: ${user.home}/.m2/repository\n  <localrepository>/path/to/local/repo</localrepository>\n  --\x3e\n\n  \x3c!-- interactivemode\n   | this will determine whether maven prompts you when it needs input. if set to false,\n   | maven will use a sensible default value, perhaps based on some other setting, for\n   | the parameter in question.\n   |\n   | default: true\n  <interactivemode>true</interactivemode>\n  --\x3e\n  <interactivemode>false</interactivemode>\n\n  \x3c!-- offline\n   | determines whether maven should attempt to connect to the network when executing a build.\n   | this will have an effect on artifact downloads, artifact deployment, and others.\n   |\n   | default: false\n  <offline>false</offline>\n  --\x3e\n\n  \x3c!-- plugingroups\n   | this is a list of additional group identifiers that will be searched when resolving plugins by their prefix, i.e.\n   | when invoking a command line like \"mvn prefix:goal\". maven will automatically add thegroup identifiers\n   | \"org.apache.maven.plugins\" and \"org.codehaus.mojo\" if these are not already containedin the list.\n   |--\x3e\n  <plugingroups>\n    \x3c!-- plugingroup\n     | specifies a further group identifier to use for plugin lookup.\n    <plugingroup>com.your.plugins</plugingroup>\n    --\x3e\n  </plugingroups>\n\n  \x3c!-- proxies\n   | this is a list of proxies which can be used on this machine to connect to the network.\n   | unless otherwise specified (by system property or command-line switch), the first proxy\n   | specification in this list marked as active will be used.\n   |--\x3e\n  <proxies>\n    \x3c!-- proxy\n     | specification for one proxy, to be used in connecting to the network.\n     |\n    <proxy>\n      <id>optional</id>\n      <active>true</active>\n      <protocol>http</protocol>\n      <username>proxyuser</username>\n      <password>proxypass</password>\n      <host>proxy.host.net</host>\n      <port>80</port>\n      <nonproxyhosts>local.net|some.host.com</nonproxyhosts>\n    </proxy>\n    --\x3e\n  </proxies>\n\n  \x3c!-- servers\n   | this is a list of authentication profiles, keyed by the server-id used within the system.\n   | authentication profiles can be used whenever maven must make a connection to a remoteserver.\n   |--\x3e\n  <servers>\n    \x3c!-- server\n     | specifies the authentication information to use when connecting to a particular server, identified by\n     | a unique name within the system (referred to by the 'id' attribute below).\n     |\n     | note: you should either specify username/password or privatekey/passphrase, since these pairings are\n     |       used together.\n     |\n    <server>\n      <id>deploymentrepo</id>\n      <username>repouser</username>\n      <password>repopwd</password>\n    </server>\n    --\x3e\n\n    \x3c!-- another sample, using keys to authenticate.\n    <server>\n      <id>siteserver</id>\n      <privatekey>/path/to/private/key</privatekey>\n      <passphrase>optional; leave empty if not used.</passphrase>\n    </server>\n    --\x3e\n  </servers>\n\n  \x3c!-- mirrors\n   | this is a list of mirrors to be used in downloading artifacts from remote repositories.\n   |\n   | it works like this: a pom may declare a repository to use in resolving certain artifacts.\n   | however, this repository may have problems with heavy traffic at times, so people have mirrored\n   | it to several places.\n   |\n   | that repository definition will have a unique id, so we can create a mirror referencefor that\n   | repository, to be used as an alternate download site. the mirror site will be the preferred\n   | server for that repository.\n   |--\x3e\n  <mirrors>\n    \x3c!-- mirror\n     | specifies a repository mirror site to use instead of a given repository. the repository that\n     | this mirror serves has an id that matches the mirrorof element of this mirror. ids are used\n     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.\n     |\n    <mirror>\n      <id>mirrorid</id>\n      <mirrorof>repositoryid</mirrorof>\n      <name>human readable name for this mirror.</name>\n      <url>http://my.repository.com/repo/path</url>\n    </mirror>\n     --\x3e\n\n<mirror>\n<id>nexus-osc</id>\n<mirrorof>*</mirrorof>\n<name>nexus osc</name>\n<url>http://192.168.106.21:8081/repository/maven-group/</url>\n</mirror>\n\n\n  </mirrors>\n\n  \x3c!-- profiles\n   | this is a list of profiles which can be activated in a variety of ways, and which canmodify\n   | the build process. profiles provided in the settings.xml are intended to provide local machine-\n   | specific paths and repository locations which allow the build to work in the local environment.\n   |\n   | for example, if you have an integration testing plugin - like cactus - that needs to know where\n   | your tomcat instance is installed, you can provide a variable here such that the variable is\n   | dereferenced during the build process to configure the cactus plugin.\n   |\n   | as noted above, profiles can be activated in a variety of ways. one way - the activeprofiles\n   | section of this document (settings.xml) - will be discussed later. another way essentially\n   | relies on the detection of a system property, either matching a particular value for the property,\n   | or merely testing its existence. profiles can also be activated by jdk version prefix, where a\n   | value of '1.4' might activate a profile when the build is executed on a jdk version of '1.4.2_07'.\n   | finally, the list of active profiles can be specified directly from the command line.\n   |\n   | note: for profiles defined in the settings.xml, you are restricted to specifying onlyartifact\n   |       repositories, plugin repositories, and free-form properties to be used as configuration\n   |       variables for plugins in the pom.\n   |\n   |--\x3e\n  <profiles>\n    \x3c!-- profile\n     | specifies a set of introductions to the build process, to be activated using one ormore of the\n     | mechanisms described above. for inheritance purposes, and to activate profiles via <activatedprofiles/>\n     | or the command line, profiles have to have an id that is unique.\n     |\n     | an encouraged best practice for profile identification is to use a consistent naming convention\n     | for profiles, such as 'env-dev', 'env-test', 'env-production', 'user-jdcasey', 'user-brett', etc.\n     | this will make it more intuitive to understand what the set of introduced profiles is attempting\n     | to accomplish, particularly when you only have a list of profile id's for debug.\n     |\n     | this profile example uses the jdk version to trigger activation, and provides a jdk-specific repo.\n    <profile>\n      <id>jdk-1.4</id>\n\n      <activation>\n        <jdk>1.4</jdk>\n      </activation>\n\n      <repositories>\n        <repository>\n          <id>jdk14</id>\n          <name>repository for jdk 1.4 builds</name>\n          <url>http://www.myhost.com/maven/jdk14</url>\n          <layout>default</layout>\n          <snapshotpolicy>always</snapshotpolicy>\n        </repository>\n      </repositories>\n    </profile>\n    --\x3e\n        <profile>\n<id>dev</id>\n<repositories>\n  <repository>\n    <id>central</id>\n    <name>central</name>\n    <layout>default</layout>\n    <url>http://my.repository.com/repo/path</url>\n    <snapshots>\n      <enabled> false</enabled>\n    </snapshots>\n  </repository>\n</repositories>\n</profile>\n\n    \x3c!--\n     | here is another profile, activated by the system property 'target-env' with a valueof 'dev',\n     | which provides a specific path to the tomcat instance. to use this, your plugin configuration\n     | might hypothetically look like:\n     |\n     | ...\n     | <plugin>\n     |   <groupid>org.myco.myplugins</groupid>\n     |   <artifactid>myplugin</artifactid>\n     |\n     |   <configuration>\n     |     <tomcatlocation>${tomcatpath}</tomcatlocation>\n     |   </configuration>\n     | </plugin>\n     | ...\n     |\n     | note: if you just wanted to inject this configuration whenever someone set 'target-env' to\n     |       anything, you could just leave off the <value/> inside the activation-property.\n     |\n    <profile>\n      <id>env-dev</id>\n\n      <activation>\n        <property>\n          <name>target-env</name>\n          <value>dev</value>\n        </property>\n      </activation>\n\n      <properties>\n        <tomcatpath>/path/to/tomcat/instance</tomcatpath>\n      </properties>\n    </profile>\n    --\x3e\n  </profiles>\n\n  \x3c!-- activeprofiles\n   | list of profiles that are active for all builds.\n   |\n  <activeprofiles>\n    <activeprofile>alwaysactiveprofile</activeprofile>\n    <activeprofile>anotheralwaysactiveprofile</activeprofile>\n  </activeprofiles>\n  --\x3e\n  <activeprofiles>\n    <activeprofile>dev</activeprofile>\n\n  </activeprofiles>\n</settings>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n140\n141\n142\n143\n144\n145\n146\n147\n148\n149\n150\n151\n152\n153\n154\n155\n156\n157\n158\n159\n160\n161\n162\n163\n164\n165\n166\n167\n168\n169\n170\n171\n172\n173\n174\n175\n176\n177\n178\n179\n180\n181\n182\n183\n184\n185\n186\n187\n188\n189\n190\n191\n192\n193\n194\n195\n196\n197\n198\n199\n200\n201\n202\n203\n204\n205\n206\n207\n208\n209\n210\n211\n212\n213\n214\n215\n216\n217\n218\n219\n220\n221\n222\n223\n224\n225\n226\n227\n228\n229\n230\n231\n232\n233\n234\n235\n236\n237\n238\n239\n240\n241\n242\n243\n244\n245\n246\n247\n248\n249\n250\n251\n252\n253\n254\n255\n256\n257\n258\n259\n260\n261\n262\n263\n264\n265\n266\n267\n268\n269\n270\n271\n272\n273\n274\n275\n276\n277\n278\n279\n280\n281\n282\n283\n284\n285\n\n\nç¶åä¿®æ¹å¶ä¸­çç¬¬165è¡ä¸ºææ°å»ºçç§æå°å\n\n\n\n\n# 4ï¼æåé¡¹ç®ç¼è¯ã\n\næåä¹åï¼è¿å°é¡¹ç®éè¾¹ï¼å¼å§ç¼è¯ã\n\nmvn clean package -u -dmaven.test.skip=true\n\nåæé¾æ¥ï¼ä½¿ç¨nexus3éç½®mavenç§æä»åº | äºä¸«è®²æ¢µ",charsets:{cjk:!0}},{title:"dockerådocker-composeå®è£",frontmatter:{title:"dockerådocker-composeå®è£",date:"2022-12-15T18:52:58.000Z",permalink:"/pages/217e32/",categories:["è¿ç»´","docker"],tags:[null],readingShow:"top",description:"docker-composeä¸è½½å°å\n>\n> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-Linux-x86_64\n>\n> dockerä¸è½½å°å\n>\n> Index of linux/static/stable/x86_64/docker-composeä¸è½½å°å\n>\n> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-Linux-x86_64\n>\n> dockerä¸è½½å°å\n>\n> Index of linux/static/stable/x86_64/",meta:[{name:"twitter:title",content:"dockerådocker-composeå®è£"},{name:"twitter:description",content:"docker-composeä¸è½½å°å\n>\n> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-Linux-x86_64\n>\n> dockerä¸è½½å°å\n>\n> Index of linux/static/stable/x86_64/docker-composeä¸è½½å°å\n>\n> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-Linux-x86_64\n>\n> dockerä¸è½½å°å\n>\n> Index of linux/static/stable/x86_64/"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/10.docker/02.docker%E5%92%8Cdocker-compose%E5%AE%89%E8%A3%85.html"},{property:"og:type",content:"article"},{property:"og:title",content:"dockerådocker-composeå®è£"},{property:"og:description",content:"docker-composeä¸è½½å°å\n>\n> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-Linux-x86_64\n>\n> dockerä¸è½½å°å\n>\n> Index of linux/static/stable/x86_64/docker-composeä¸è½½å°å\n>\n> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-Linux-x86_64\n>\n> dockerä¸è½½å°å\n>\n> Index of linux/static/stable/x86_64/"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/10.docker/02.docker%E5%92%8Cdocker-compose%E5%AE%89%E8%A3%85.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T18:52:58.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"dockerådocker-composeå®è£"},{itemprop:"description",content:"docker-composeä¸è½½å°å\n>\n> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-Linux-x86_64\n>\n> dockerä¸è½½å°å\n>\n> Index of linux/static/stable/x86_64/docker-composeä¸è½½å°å\n>\n> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-Linux-x86_64\n>\n> dockerä¸è½½å°å\n>\n> Index of linux/static/stable/x86_64/"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/10.docker/02.docker%E5%92%8Cdocker-compose%E5%AE%89%E8%A3%85.html",relativePath:"04.è¿ç»´/10.docker/02.dockerådocker-composeå®è£.md",key:"v-65a31f9a",path:"/pages/217e32/",headers:[{level:2,title:"dockerådocker-composeäºè¿å¶å®è£",slug:"dockerådocker-composeäºè¿å¶å®è£",normalizedTitle:"dockerådocker-composeäºè¿å¶å®è£",charIndex:2},{level:2,title:"yumå®è£ç¤¾åºç",slug:"yumå®è£ç¤¾åºç",normalizedTitle:"yumå®è£ç¤¾åºç",charIndex:963},{level:4,title:"Fedora/CentOS/RHEL",slug:"fedora-centos-rhel",normalizedTitle:"fedora/centos/rhel",charIndex:975}],headersStr:"dockerådocker-composeäºè¿å¶å®è£ yumå®è£ç¤¾åºç Fedora/CentOS/RHEL",content:"# dockerådocker-composeäºè¿å¶å®è£\n\n> docker-composeä¸è½½å°å\n> \n> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-Linux-x86_64\n> \n> dockerä¸è½½å°å\n> \n> Index of linux/static/stable/x86_64/docker-composeä¸è½½å°å\n> \n> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-Linux-x86_64\n> \n> dockerä¸è½½å°å\n> \n> Index of linux/static/stable/x86_64/\n\ndocker.serviceå¯å¨æå¡æä»¶\n\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network-online.target firewalld.service containerd.service\nWants=network-online.target\n\n[Service]\nType=notify\nExecStart=/usr/bin/dockerd\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutSec=0\nRestartSec=2\nRestart=always\nStartLimitBurst=3\nStartLimitInterval=60s\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\nTasksMax=infinity\nDelegate=yes\nKillMode=process\n\n[Install]\nWantedBy=multi-user.target\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# yumå®è£ç¤¾åºç\n\n# Fedora/CentOS/RHEL\n\nä»¥ä¸åå®¹æ ¹æ®Â å®æ¹ææ¡£Â ä¿®æ¹èæ¥ã\n\nå¦æä½ ä¹åå®è£è¿ dockerï¼è¯·åå æ\n\nsudo yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine\n\nå®è£ä¸äºä¾èµ\n\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\n\næ ¹æ®ä½ çåè¡çä¸è½½repoæä»¶:\n\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n\næè½¯ä»¶ä»åºå°åæ¿æ¢ä¸º TUNA:\n\nsudo sed -i 's+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+' /etc/yum.repos.d/docker-ce.repo\n\næåå®è£:\n\nsudo yum makecache fast\n\nsudo yum install docker-ce",normalizedContent:"# dockerådocker-composeäºè¿å¶å®è£\n\n> docker-composeä¸è½½å°å\n> \n> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-linux-x86_64\n> \n> dockerä¸è½½å°å\n> \n> index of linux/static/stable/x86_64/docker-composeä¸è½½å°å\n> \n> https://github.com/docker/compose/releases/download/1.27.4/docker-compose-linux-x86_64\n> \n> dockerä¸è½½å°å\n> \n> index of linux/static/stable/x86_64/\n\ndocker.serviceå¯å¨æå¡æä»¶\n\n[unit]\ndescription=docker application container engine\ndocumentation=https://docs.docker.com\nafter=network-online.target firewalld.service containerd.service\nwants=network-online.target\n\n[service]\ntype=notify\nexecstart=/usr/bin/dockerd\nexecreload=/bin/kill -s hup $mainpid\ntimeoutsec=0\nrestartsec=2\nrestart=always\nstartlimitburst=3\nstartlimitinterval=60s\nlimitnofile=infinity\nlimitnproc=infinity\nlimitcore=infinity\ntasksmax=infinity\ndelegate=yes\nkillmode=process\n\n[install]\nwantedby=multi-user.target\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\n\n# yumå®è£ç¤¾åºç\n\n# fedora/centos/rhel\n\nä»¥ä¸åå®¹æ ¹æ®Â å®æ¹ææ¡£Â ä¿®æ¹èæ¥ã\n\nå¦æä½ ä¹åå®è£è¿ dockerï¼è¯·åå æ\n\nsudo yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine\n\nå®è£ä¸äºä¾èµ\n\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\n\næ ¹æ®ä½ çåè¡çä¸è½½repoæä»¶:\n\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n\næè½¯ä»¶ä»åºå°åæ¿æ¢ä¸º tuna:\n\nsudo sed -i 's+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+' /etc/yum.repos.d/docker-ce.repo\n\næåå®è£:\n\nsudo yum makecache fast\n\nsudo yum install docker-ce",charsets:{cjk:!0}},{title:"mongodbå¯æ¬é",frontmatter:{title:"mongodbå¯æ¬é",categories:"mongodb",tags:["mongodb"],date:"2022-12-09T20:50:33.000Z",permalink:"/pages/359db9/",readingShow:"top",description:"MongoDBä¸­çå¯æ¬éï¼Replica Setï¼æ¯ä¸ç»ç»´æ¤ç¸åæ°æ®éçmongodæå¡ã å¯æ¬éå¯æä¾åä½åé«å¯ç¨æ§ï¼æ¯ææçäº§é¨ç½²çåºç¡ã",meta:[{name:"image",content:"https://img-blog.csdnimg.cn/20200918164831238.png"},{name:"twitter:title",content:"mongodbå¯æ¬é"},{name:"twitter:description",content:"MongoDBä¸­çå¯æ¬éï¼Replica Setï¼æ¯ä¸ç»ç»´æ¤ç¸åæ°æ®éçmongodæå¡ã å¯æ¬éå¯æä¾åä½åé«å¯ç¨æ§ï¼æ¯ææçäº§é¨ç½²çåºç¡ã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://img-blog.csdnimg.cn/20200918164831238.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/08.%E6%95%B0%E6%8D%AE%E5%BA%93/02.mongodb/02.mongodb%E5%89%AF%E6%9C%AC%E9%9B%86.html"},{property:"og:type",content:"article"},{property:"og:title",content:"mongodbå¯æ¬é"},{property:"og:description",content:"MongoDBä¸­çå¯æ¬éï¼Replica Setï¼æ¯ä¸ç»ç»´æ¤ç¸åæ°æ®éçmongodæå¡ã å¯æ¬éå¯æä¾åä½åé«å¯ç¨æ§ï¼æ¯ææçäº§é¨ç½²çåºç¡ã"},{property:"og:image",content:"https://img-blog.csdnimg.cn/20200918164831238.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/08.%E6%95%B0%E6%8D%AE%E5%BA%93/02.mongodb/02.mongodb%E5%89%AF%E6%9C%AC%E9%9B%86.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-09T20:50:33.000Z"},{property:"article:tag",content:"mongodb"},{itemprop:"name",content:"mongodbå¯æ¬é"},{itemprop:"description",content:"MongoDBä¸­çå¯æ¬éï¼Replica Setï¼æ¯ä¸ç»ç»´æ¤ç¸åæ°æ®éçmongodæå¡ã å¯æ¬éå¯æä¾åä½åé«å¯ç¨æ§ï¼æ¯ææçäº§é¨ç½²çåºç¡ã"},{itemprop:"image",content:"https://img-blog.csdnimg.cn/20200918164831238.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/08.%E6%95%B0%E6%8D%AE%E5%BA%93/02.mongodb/02.mongodb%E5%89%AF%E6%9C%AC%E9%9B%86.html",relativePath:"04.è¿ç»´/08.æ°æ®åº/02.mongodb/02.mongodbå¯æ¬é.md",key:"v-db6593ce",path:"/pages/359db9/",headers:[{level:2,title:"1.1 ç®ä»",slug:"_1-1-ç®ä»",normalizedTitle:"1.1 ç®ä»",charIndex:19},{level:2,title:"1.2 å¯æ¬éçä¸ä¸ªè§è²",slug:"_1-2-å¯æ¬éçä¸ä¸ªè§è²",normalizedTitle:"1.2 å¯æ¬éçä¸ä¸ªè§è²",charIndex:869},{level:2,title:"1.3 å¯æ¬éæ¶æç®æ ",slug:"_1-3-å¯æ¬éæ¶æç®æ ",normalizedTitle:"1.3 å¯æ¬éæ¶æç®æ ",charIndex:1520},{level:2,title:"1.4 å¯æ¬éçåå»º",slug:"_1-4-å¯æ¬éçåå»º",normalizedTitle:"1.4 å¯æ¬éçåå»º",charIndex:1548},{level:3,title:"1.4.1 ç¬¬ä¸æ­¥ï¼åå»ºä¸»èç¹",slug:"_1-4-1-ç¬¬ä¸æ­¥-åå»ºä¸»èç¹",normalizedTitle:"1.4.1 ç¬¬ä¸æ­¥ï¼åå»ºä¸»èç¹",charIndex:1563},{level:3,title:"1.4.2 ç¬¬äºæ­¥ï¼åå»ºå¯æ¬èç¹",slug:"_1-4-2-ç¬¬äºæ­¥-åå»ºå¯æ¬èç¹",normalizedTitle:"1.4.2 ç¬¬äºæ­¥ï¼åå»ºå¯æ¬èç¹",charIndex:3010},{level:3,title:"1.4.3 ç¬¬ä¸æ­¥ï¼åå»ºä»²è£èç¹",slug:"_1-4-3-ç¬¬ä¸æ­¥-åå»ºä»²è£èç¹",normalizedTitle:"1.4.3 ç¬¬ä¸æ­¥ï¼åå»ºä»²è£èç¹",charIndex:4459},{level:3,title:"1.4.4 ç¬¬åæ­¥ï¼åå§åéç½®å¯æ¬éåä¸»èç¹",slug:"_1-4-4-ç¬¬åæ­¥-åå§åéç½®å¯æ¬éåä¸»èç¹",normalizedTitle:"1.4.4 ç¬¬åæ­¥ï¼åå§åéç½®å¯æ¬éåä¸»èç¹",charIndex:5908},{level:3,title:"1.4.5 ç¬¬äºæ­¥ï¼æ¥çå¯æ¬éçéç½®åå®¹",slug:"_1-4-5-ç¬¬äºæ­¥-æ¥çå¯æ¬éçéç½®åå®¹",normalizedTitle:"1.4.5 ç¬¬äºæ­¥ï¼æ¥çå¯æ¬éçéç½®åå®¹",charIndex:6755},{level:3,title:"1.4.6 ç¬¬å­æ­¥ï¼æ¥çå¯æ¬éç¶æ",slug:"_1-4-6-ç¬¬å­æ­¥-æ¥çå¯æ¬éç¶æ",normalizedTitle:"1.4.6 ç¬¬å­æ­¥ï¼æ¥çå¯æ¬éç¶æ",charIndex:9208},{level:3,title:"1.4.7 ç¬¬ä¸æ­¥ï¼æ·»å å¯æ¬ä»èç¹",slug:"_1-4-7-ç¬¬ä¸æ­¥-æ·»å å¯æ¬ä»èç¹",normalizedTitle:"1.4.7 ç¬¬ä¸æ­¥ï¼æ·»å å¯æ¬ä»èç¹",charIndex:11531},{level:3,title:"1.4.8 ç¬¬å«æ­¥ï¼æ·»å ä»²è£ä»èç¹",slug:"_1-4-8-ç¬¬å«æ­¥-æ·»å ä»²è£ä»èç¹",normalizedTitle:"1.4.8 ç¬¬å«æ­¥ï¼æ·»å ä»²è£ä»èç¹",charIndex:15917},{level:2,title:"1.5 å¯æ¬éçæ°æ®è¯»åæä½",slug:"_1-5-å¯æ¬éçæ°æ®è¯»åæä½",normalizedTitle:"1.5 å¯æ¬éçæ°æ®è¯»åæä½",charIndex:20266},{level:2,title:"1.6 ä¸»èç¹çéä¸¾åå",slug:"_1-6-ä¸»èç¹çéä¸¾åå",normalizedTitle:"1.6 ä¸»èç¹çéä¸¾åå",charIndex:24182},{level:2,title:"1.7 æéæµè¯",slug:"_1-7-æéæµè¯",normalizedTitle:"1.7 æéæµè¯",charIndex:26861},{level:3,title:"1.7.1 å¯æ¬èç¹æéæµè¯",slug:"_1-7-1-å¯æ¬èç¹æéæµè¯",normalizedTitle:"1.7.1 å¯æ¬èç¹æéæµè¯",charIndex:26874},{level:3,title:"1.7.2 ä¸»èç¹æéæµè¯",slug:"_1-7-2-ä¸»èç¹æéæµè¯",normalizedTitle:"1.7.2 ä¸»èç¹æéæµè¯",charIndex:27229},{level:3,title:"1.7.3 ä»²è£èç¹åä¸»èç¹æé",slug:"_1-7-3-ä»²è£èç¹åä¸»èç¹æé",normalizedTitle:"1.7.3 ä»²è£èç¹åä¸»èç¹æé",charIndex:27765},{level:3,title:"1.7.4 ä»²è£èç¹åä»èç¹æé",slug:"_1-7-4-ä»²è£èç¹åä»èç¹æé",normalizedTitle:"1.7.4 ä»²è£èç¹åä»èç¹æé",charIndex:28065},{level:2,title:"1.8 Compass è¿æ¥å¯æ¬é",slug:"_1-8-compass-è¿æ¥å¯æ¬é",normalizedTitle:"1.8 compass è¿æ¥å¯æ¬é",charIndex:28166},{level:2,title:"1.9 SpringDataMongoDB è¿æ¥å¯æ¬é",slug:"_1-9-springdatamongodb-è¿æ¥å¯æ¬é",normalizedTitle:"1.9 springdatamongodb è¿æ¥å¯æ¬é",charIndex:28204},{level:2,title:"2.1 åçæ¦å¿µ",slug:"_2-1-åçæ¦å¿µ",normalizedTitle:"2.1 åçæ¦å¿µ",charIndex:30671},{level:2,title:"2.2 åçéç¾¤åå«çç»ä»¶",slug:"_2-2-åçéç¾¤åå«çç»ä»¶",normalizedTitle:"2.2 åçéç¾¤åå«çç»ä»¶",charIndex:31282},{level:2,title:"2.3 åçéç¾¤æ¶æç®æ ",slug:"_2-3-åçéç¾¤æ¶æç®æ ",normalizedTitle:"2.3 åçéç¾¤æ¶æç®æ ",charIndex:31554},{level:2,title:"2.4 åçï¼å­å¨ï¼èç¹å¯æ¬éçåå»º",slug:"_2-4-åç-å­å¨-èç¹å¯æ¬éçåå»º",normalizedTitle:"2.4 åçï¼å­å¨ï¼èç¹å¯æ¬éçåå»º",charIndex:31622},{level:3,title:"2.4.1 ç¬¬ä¸å¥å¯æ¬é",slug:"_2-4-1-ç¬¬ä¸å¥å¯æ¬é",normalizedTitle:"2.4.1 ç¬¬ä¸å¥å¯æ¬é",charIndex:31707},{level:4,title:"2.4.1.1 åå§åå¯æ¬éååå»ºä¸»èç¹ï¼",slug:"_2-4-1-1-åå§åå¯æ¬éååå»ºä¸»èç¹",normalizedTitle:"2.4.1.1 åå§åå¯æ¬éååå»ºä¸»èç¹ï¼",charIndex:37004},{level:4,title:"2.4.1.2 æ·»å å¯æ¬èç¹",slug:"_2-4-1-2-æ·»å å¯æ¬èç¹",normalizedTitle:"2.4.1.2 æ·»å å¯æ¬èç¹",charIndex:37214},{level:4,title:"2.4.1.3 æ·»å ä»²è£èç¹",slug:"_2-4-1-3-æ·»å ä»²è£èç¹",normalizedTitle:"2.4.1.3 æ·»å ä»²è£èç¹",charIndex:37269},{level:3,title:"2.4.2 ç¬¬äºå¥å¯æ¬é",slug:"_2-4-2-ç¬¬äºå¥å¯æ¬é",normalizedTitle:"2.4.2 ç¬¬äºå¥å¯æ¬é",charIndex:38632},{level:4,title:"2.4.2.1 åå§åå¯æ¬éååå»ºä¸»èç¹",slug:"_2-4-2-1-åå§åå¯æ¬éååå»ºä¸»èç¹",normalizedTitle:"2.4.2.1 åå§åå¯æ¬éååå»ºä¸»èç¹",charIndex:43039},{level:4,title:"2.4.2.2 æ·»å å¯æ¬èç¹",slug:"_2-4-2-2-æ·»å å¯æ¬èç¹",normalizedTitle:"2.4.2.2 æ·»å å¯æ¬èç¹",charIndex:43257},{level:4,title:"2.4.2.3 æ·»å ä»²è£èç¹",slug:"_2-4-2-3-æ·»å ä»²è£èç¹",normalizedTitle:"2.4.2.3 æ·»å ä»²è£èç¹",charIndex:43312},{level:2,title:"2.5 éç½®èç¹å¯æ¬éçåå»º",slug:"_2-5-éç½®èç¹å¯æ¬éçåå»º",normalizedTitle:"2.5 éç½®èç¹å¯æ¬éçåå»º",charIndex:47339},{level:3,title:"2.5.1 åå§åå¯æ¬éååå»ºä¸»èç¹",slug:"_2-5-1-åå§åå¯æ¬éååå»ºä¸»èç¹",normalizedTitle:"2.5.1 åå§åå¯æ¬éååå»ºä¸»èç¹",charIndex:51781},{level:3,title:"2.5.2 æ·»å ä¸¤ä¸ªå¯æ¬èç¹",slug:"_2-5-2-æ·»å ä¸¤ä¸ªå¯æ¬èç¹",normalizedTitle:"2.5.2 æ·»å ä¸¤ä¸ªå¯æ¬èç¹",charIndex:51998},{level:2,title:"2.6 è·¯ç±èç¹çåå»ºåæä½",slug:"_2-6-è·¯ç±èç¹çåå»ºåæä½",normalizedTitle:"2.6 è·¯ç±èç¹çåå»ºåæä½",charIndex:52214},{level:3,title:"2.6.1 ç¬¬ä¸ä¸ªè·¯ç±èç¹çåå»ºåè¿æ¥",slug:"_2-6-1-ç¬¬ä¸ä¸ªè·¯ç±èç¹çåå»ºåè¿æ¥",normalizedTitle:"2.6.1 ç¬¬ä¸ä¸ªè·¯ç±èç¹çåå»ºåè¿æ¥",charIndex:52233},{level:3,title:"2.6.2 å¨è·¯ç±èç¹ä¸è¿è¡åçéç½®æä½",slug:"_2-6-2-å¨è·¯ç±èç¹ä¸è¿è¡åçéç½®æä½",normalizedTitle:"2.6.2 å¨è·¯ç±èç¹ä¸è¿è¡åçéç½®æä½",charIndex:54338},{level:4,title:"2.6.2.1 æ·»å åçï¼",slug:"_2-6-2-1-æ·»å åç",normalizedTitle:"2.6.2.1 æ·»å åçï¼",charIndex:54373},{level:4,title:"2.6.2.2 å¼å¯åçåè½",slug:"_2-6-2-2-å¼å¯åçåè½",normalizedTitle:"2.6.2.2 å¼å¯åçåè½",charIndex:57268},{level:4,title:"2.6.2.3 éååç",slug:"_2-6-2-3-éååç",normalizedTitle:"2.6.2.3 éååç",charIndex:59167},{level:3,title:"2.6.3 åçåæå¥æ°æ®æµè¯",slug:"_2-6-3-åçåæå¥æ°æ®æµè¯",normalizedTitle:"2.6.3 åçåæå¥æ°æ®æµè¯",charIndex:63680},{level:3,title:"2.6.4 åå¢å ä¸ä¸ªè·¯ç±èç¹",slug:"_2-6-4-åå¢å ä¸ä¸ªè·¯ç±èç¹",normalizedTitle:"2.6.4 åå¢å ä¸ä¸ªè·¯ç±èç¹",charIndex:65781},{level:2,title:"2.7 Compass è¿æ¥åçéç¾¤",slug:"_2-7-compass-è¿æ¥åçéç¾¤",normalizedTitle:"2.7 compass è¿æ¥åçéç¾¤",charIndex:67086},{level:2,title:"2.8 SpringDataMongDB è¿æ¥åçéç¾¤",slug:"_2-8-springdatamongdb-è¿æ¥åçéç¾¤",normalizedTitle:"2.8 springdatamongdb è¿æ¥åçéç¾¤",charIndex:67171},{level:2,title:"2.9 æ¸é¤ææçèç¹æ°æ®ï¼å¤ç¨ï¼",slug:"_2-9-æ¸é¤ææçèç¹æ°æ®-å¤ç¨",normalizedTitle:"2.9 æ¸é¤ææçèç¹æ°æ®ï¼å¤ç¨ï¼",charIndex:67943},{level:2,title:"3.1 MongoDB çç¨æ·åè§è²æéç®ä»",slug:"_3-1-mongodb-çç¨æ·åè§è²æéç®ä»",normalizedTitle:"3.1 mongodb çç¨æ·åè§è²æéç®ä»",charIndex:71471},{level:2,title:"3.2 åå®ä¾ç¯å¢",slug:"_3-2-åå®ä¾ç¯å¢",normalizedTitle:"3.2 åå®ä¾ç¯å¢",charIndex:77873},{level:3,title:"3.2.1 å³é­å·²å¼å¯çæå¡",slug:"_3-2-1-å³é­å·²å¼å¯çæå¡",normalizedTitle:"3.2.1 å³é­å·²å¼å¯çæå¡",charIndex:77942},{level:3,title:"3.2.2 æ·»å ç¨æ·åæé",slug:"_3-2-2-æ·»å ç¨æ·åæé",normalizedTitle:"3.2.2 æ·»å ç¨æ·åæé",charIndex:78562},{level:3,title:"3.2.3 æå¡ç«¯å¼å¯è®¤è¯åå®¢æ·ç«¯è¿æ¥ç»å½",slug:"_3-2-3-æå¡ç«¯å¼å¯è®¤è¯åå®¢æ·ç«¯è¿æ¥ç»å½",normalizedTitle:"3.2.3 æå¡ç«¯å¼å¯è®¤è¯åå®¢æ·ç«¯è¿æ¥ç»å½",charIndex:81158},{level:4,title:"3.2.3.1 å³é­å·²ç»å¯å¨çæå¡",slug:"_3-2-3-1-å³é­å·²ç»å¯å¨çæå¡",normalizedTitle:"3.2.3.1 å³é­å·²ç»å¯å¨çæå¡",charIndex:81183},{level:4,title:"3.2.3.2 ä»¥å¼å¯è®¤è¯çæ¹å¼å¯å¨æå¡",slug:"_3-2-3-2-ä»¥å¼å¯è®¤è¯çæ¹å¼å¯å¨æå¡",normalizedTitle:"3.2.3.2 ä»¥å¼å¯è®¤è¯çæ¹å¼å¯å¨æå¡",charIndex:82110},{level:4,title:"3.2.3.3 å¼å¯äºè®¤è¯çæåµä¸çå®¢æ·ç«¯ç»å½",slug:"_3-2-3-3-å¼å¯äºè®¤è¯çæåµä¸çå®¢æ·ç«¯ç»å½",normalizedTitle:"3.2.3.3 å¼å¯äºè®¤è¯çæåµä¸çå®¢æ·ç«¯ç»å½",charIndex:82480},{level:3,title:"3.2.4 SpringDataMongoDBè¿æ¥è®¤è¯",slug:"_3-2-4-springdatamongodbè¿æ¥è®¤è¯",normalizedTitle:"3.2.4 springdatamongodbè¿æ¥è®¤è¯",charIndex:86330},{level:2,title:"3.3 å¯æ¬éç¯å¢",slug:"_3-3-å¯æ¬éç¯å¢",normalizedTitle:"3.3 å¯æ¬éç¯å¢",charIndex:86970},{level:3,title:"3.3.1 åè¨",slug:"_3-3-1-åè¨",normalizedTitle:"3.3.1 åè¨",charIndex:86984},{level:3,title:"3.3.2 å³é­å·²å¼å¯çå¯æ¬éæå¡",slug:"_3-3-2-å³é­å·²å¼å¯çå¯æ¬éæå¡",normalizedTitle:"3.3.2 å³é­å·²å¼å¯çå¯æ¬éæå¡",charIndex:87454},{level:3,title:"3.3.3 éè¿ä¸»èç¹æ·»å ä¸ä¸ªç®¡çåå¸å·",slug:"_3-3-3-éè¿ä¸»èç¹æ·»å ä¸ä¸ªç®¡çåå¸å·",normalizedTitle:"3.3.3 éè¿ä¸»èç¹æ·»å ä¸ä¸ªç®¡çåå¸å·",charIndex:88526},{level:3,title:"3.3.4 åå»ºå¯æ¬éè®¤è¯çkeyæä»¶",slug:"_3-3-4-åå»ºå¯æ¬éè®¤è¯çkeyæä»¶",normalizedTitle:"3.3.4 åå»ºå¯æ¬éè®¤è¯çkeyæä»¶",charIndex:88886},{level:3,title:"3.3.5 ä¿®æ¹éç½®æä»¶æå®keyfile",slug:"_3-3-5-ä¿®æ¹éç½®æä»¶æå®keyfile",normalizedTitle:"3.3.5 ä¿®æ¹éç½®æä»¶æå®keyfile",charIndex:89658},{level:3,title:"3.3.6 éæ°å¯å¨å¯æ¬é",slug:"_3-3-6-éæ°å¯å¨å¯æ¬é",normalizedTitle:"3.3.6 éæ°å¯å¨å¯æ¬é",charIndex:90279},{level:3,title:"3.3.7 å¨ä¸»èç¹ä¸æ·»å æ®éè´¦å·",slug:"_3-3-7-å¨ä¸»èç¹ä¸æ·»å æ®éè´¦å·",normalizedTitle:"3.3.7 å¨ä¸»èç¹ä¸æ·»å æ®éè´¦å·",charIndex:91122},{level:3,title:"3.3.8 SpringDataMongoDBè¿æ¥å¯æ¬é",slug:"_3-3-8-springdatamongodbè¿æ¥å¯æ¬é",normalizedTitle:"3.3.8 springdatamongodbè¿æ¥å¯æ¬é",charIndex:91361},{level:2,title:"3.4 åçéç¾¤ç¯å¢(æ©å±)",slug:"_3-4-åçéç¾¤ç¯å¢-æ©å±",normalizedTitle:"3.4 åçéç¾¤ç¯å¢(æ©å±)",charIndex:91804},{level:3,title:"3.4.1 å³é­å·²å¼å¯çéç¾¤æå¡",slug:"_3-4-1-å³é­å·²å¼å¯çéç¾¤æå¡",normalizedTitle:"3.4.1 å³é­å·²å¼å¯çéç¾¤æå¡",charIndex:91823},{level:3,title:"3.4.2 åå»ºå¯æ¬éè®¤è¯çkeyæä»¶",slug:"_3-4-2-åå»ºå¯æ¬éè®¤è¯çkeyæä»¶",normalizedTitle:"3.4.2 åå»ºå¯æ¬éè®¤è¯çkeyæä»¶",charIndex:94702},{level:3,title:"3.4.3 ä¿®æ¹éç½®æä»¶æå®keyfile",slug:"_3-4-3-ä¿®æ¹éç½®æä»¶æå®keyfile",normalizedTitle:"3.4.3 ä¿®æ¹éç½®æä»¶æå®keyfile",charIndex:95950},{level:3,title:"3.4.4 éæ°å¯å¨èç¹",slug:"_3-4-4-éæ°å¯å¨èç¹",normalizedTitle:"3.4.4 éæ°å¯å¨èç¹",charIndex:98487},{level:3,title:"3.3.5 åå»ºå¸å·åè®¤è¯",slug:"_3-3-5-åå»ºå¸å·åè®¤è¯",normalizedTitle:"3.3.5 åå»ºå¸å·åè®¤è¯",charIndex:99682},{level:3,title:"3.3.6 SpringDataMongoDBè¿æ¥è®¤è¯",slug:"_3-3-6-springdatamongodbè¿æ¥è®¤è¯",normalizedTitle:"3.3.6 springdatamongodbè¿æ¥è®¤è¯",charIndex:101282}],headersStr:"1.1 ç®ä» 1.2 å¯æ¬éçä¸ä¸ªè§è² 1.3 å¯æ¬éæ¶æç®æ  1.4 å¯æ¬éçåå»º 1.4.1 ç¬¬ä¸æ­¥ï¼åå»ºä¸»èç¹ 1.4.2 ç¬¬äºæ­¥ï¼åå»ºå¯æ¬èç¹ 1.4.3 ç¬¬ä¸æ­¥ï¼åå»ºä»²è£èç¹ 1.4.4 ç¬¬åæ­¥ï¼åå§åéç½®å¯æ¬éåä¸»èç¹ 1.4.5 ç¬¬äºæ­¥ï¼æ¥çå¯æ¬éçéç½®åå®¹ 1.4.6 ç¬¬å­æ­¥ï¼æ¥çå¯æ¬éç¶æ 1.4.7 ç¬¬ä¸æ­¥ï¼æ·»å å¯æ¬ä»èç¹ 1.4.8 ç¬¬å«æ­¥ï¼æ·»å ä»²è£ä»èç¹ 1.5 å¯æ¬éçæ°æ®è¯»åæä½ 1.6 ä¸»èç¹çéä¸¾åå 1.7 æéæµè¯ 1.7.1 å¯æ¬èç¹æéæµè¯ 1.7.2 ä¸»èç¹æéæµè¯ 1.7.3 ä»²è£èç¹åä¸»èç¹æé 1.7.4 ä»²è£èç¹åä»èç¹æé 1.8 Compass è¿æ¥å¯æ¬é 1.9 SpringDataMongoDB è¿æ¥å¯æ¬é 2.1 åçæ¦å¿µ 2.2 åçéç¾¤åå«çç»ä»¶ 2.3 åçéç¾¤æ¶æç®æ  2.4 åçï¼å­å¨ï¼èç¹å¯æ¬éçåå»º 2.4.1 ç¬¬ä¸å¥å¯æ¬é 2.4.1.1 åå§åå¯æ¬éååå»ºä¸»èç¹ï¼ 2.4.1.2 æ·»å å¯æ¬èç¹ 2.4.1.3 æ·»å ä»²è£èç¹ 2.4.2 ç¬¬äºå¥å¯æ¬é 2.4.2.1 åå§åå¯æ¬éååå»ºä¸»èç¹ 2.4.2.2 æ·»å å¯æ¬èç¹ 2.4.2.3 æ·»å ä»²è£èç¹ 2.5 éç½®èç¹å¯æ¬éçåå»º 2.5.1 åå§åå¯æ¬éååå»ºä¸»èç¹ 2.5.2 æ·»å ä¸¤ä¸ªå¯æ¬èç¹ 2.6 è·¯ç±èç¹çåå»ºåæä½ 2.6.1 ç¬¬ä¸ä¸ªè·¯ç±èç¹çåå»ºåè¿æ¥ 2.6.2 å¨è·¯ç±èç¹ä¸è¿è¡åçéç½®æä½ 2.6.2.1 æ·»å åçï¼ 2.6.2.2 å¼å¯åçåè½ 2.6.2.3 éååç 2.6.3 åçåæå¥æ°æ®æµè¯ 2.6.4 åå¢å ä¸ä¸ªè·¯ç±èç¹ 2.7 Compass è¿æ¥åçéç¾¤ 2.8 SpringDataMongDB è¿æ¥åçéç¾¤ 2.9 æ¸é¤ææçèç¹æ°æ®ï¼å¤ç¨ï¼ 3.1 MongoDB çç¨æ·åè§è²æéç®ä» 3.2 åå®ä¾ç¯å¢ 3.2.1 å³é­å·²å¼å¯çæå¡ 3.2.2 æ·»å ç¨æ·åæé 3.2.3 æå¡ç«¯å¼å¯è®¤è¯åå®¢æ·ç«¯è¿æ¥ç»å½ 3.2.3.1 å³é­å·²ç»å¯å¨çæå¡ 3.2.3.2 ä»¥å¼å¯è®¤è¯çæ¹å¼å¯å¨æå¡ 3.2.3.3 å¼å¯äºè®¤è¯çæåµä¸çå®¢æ·ç«¯ç»å½ 3.2.4 SpringDataMongoDBè¿æ¥è®¤è¯ 3.3 å¯æ¬éç¯å¢ 3.3.1 åè¨ 3.3.2 å³é­å·²å¼å¯çå¯æ¬éæå¡ 3.3.3 éè¿ä¸»èç¹æ·»å ä¸ä¸ªç®¡çåå¸å· 3.3.4 åå»ºå¯æ¬éè®¤è¯çkeyæä»¶ 3.3.5 ä¿®æ¹éç½®æä»¶æå®keyfile 3.3.6 éæ°å¯å¨å¯æ¬é 3.3.7 å¨ä¸»èç¹ä¸æ·»å æ®éè´¦å· 3.3.8 SpringDataMongoDBè¿æ¥å¯æ¬é 3.4 åçéç¾¤ç¯å¢(æ©å±) 3.4.1 å³é­å·²å¼å¯çéç¾¤æå¡ 3.4.2 åå»ºå¯æ¬éè®¤è¯çkeyæä»¶ 3.4.3 ä¿®æ¹éç½®æä»¶æå®keyfile 3.4.4 éæ°å¯å¨èç¹ 3.3.5 åå»ºå¸å·åè®¤è¯ 3.3.6 SpringDataMongoDBè¿æ¥è®¤è¯",content:'# Replica Sets\n\n\n# 1.1 ç®ä»\n\nMongoDBä¸­çå¯æ¬éï¼Replica Setï¼æ¯ä¸ç»ç»´æ¤ç¸åæ°æ®éçmongodæå¡ã å¯æ¬éå¯æä¾åä½åé«å¯ç¨æ§ï¼æ¯ææçäº§é¨ç½²çåºç¡ã\n\nä¹å¯ä»¥è¯´ï¼å¯æ¬éç±»ä¼¼äºæèªå¨æéæ¢å¤åè½çä¸»ä»éç¾¤ãéä¿çè®²å°±æ¯ç¨å¤å°æºå¨è¿è¡åä¸æ°æ®çå¼æ­¥åæ­¥ï¼ä»èä½¿å¤å°æºå¨æ¥æåä¸æ°æ®çå¤ä¸ªå¯æ¬ï¼å¹¶ä¸å½ä¸»åºå½ææ¶å¨ä¸éè¦ç¨æ·å¹²é¢çæåµä¸èªå¨åæ¢å¶ä»å¤ä»½æå¡å¨åä¸»åºãèä¸è¿å¯ä»¥å©ç¨å¯æ¬æå¡å¨ååªè¯»æå¡å¨ï¼å®ç°è¯»ååç¦»ï¼æé«è´è½½ã\n\nï¼1ï¼åä½åæ°æ®å¯ç¨æ§\n\nå¤å¶æä¾åä½å¹¶æé«æ°æ®å¯ç¨æ§ã éè¿å¨ä¸åæ°æ®åºæå¡å¨ä¸æä¾å¤ä¸ªæ°æ®å¯æ¬ï¼å¤å¶å¯æä¾ä¸å®çº§å«çå®¹éåè½ï¼ä»¥é²æ­¢ä¸¢å¤±åä¸ªæ°æ®åºæå¡å¨ã\n\nå¨æäºæåµä¸ï¼å¤å¶å¯ä»¥æä¾å¢å çè¯»åæ§è½ï¼å ä¸ºå®¢æ·ç«¯å¯ä»¥å°è¯»åæä½åéå°ä¸åçæå¡ä¸ï¼ å¨ä¸åæ°æ®ä¸­å¿ç»´æ¤æ°æ®å¯æ¬å¯ä»¥å¢å åå¸å¼åºç¨ç¨åºçæ°æ®ä½ç½®åå¯ç¨æ§ã æ¨è¿å¯ä»¥ä¸ºä¸ç¨ç®çç»´æ¤å¶ä»å¯æ¬ï¼ä¾å¦ç¾é¾æ¢å¤ï¼æ¥åæå¤ä»½ã\n\nï¼2ï¼MongoDBä¸­çå¤å¶\n\nå¯æ¬éæ¯ä¸ç»ç»´æ¤ç¸åæ°æ®éçmongodå®ä¾ã å¯æ¬éåå«å¤ä¸ªæ°æ®æ¿è½½èç¹åå¯éçä¸ä¸ªä»²è£èç¹ãå¨æ¿è½½æ°æ®çèç¹ä¸­ï¼ä¸ä¸ªä¸ä»ä¸ä¸ªæåè¢«è§ä¸ºä¸»èç¹ï¼èå¶ä»èç¹è¢«è§ä¸ºæ¬¡è¦ï¼ä»ï¼èç¹ã\n\nä¸»èç¹æ¥æ¶ææåæä½ã å¯æ¬éåªè½æä¸ä¸ªä¸»è¦è½å¤ç¡®è®¤å·æ{wï¼âmostâ}åå¥å³æ³¨çåå¥; è½ç¶å¨æäºæåµä¸ï¼å¦ä¸ä¸ªmongodå®ä¾å¯è½ææ¶è®¤ä¸ºèªå·±ä¹æ¯ä¸»è¦çãä¸»è¦è®°å½å¶æä½æ¥å¿ä¸­çæ°æ®éçæææ´æ¹ï¼å³oplogã\n\n\n\nè¾å©(å¯æ¬)èç¹å¤å¶ä¸»èç¹çoplogå¹¶å°æä½åºç¨äºå¶æ°æ®éï¼ä»¥ä½¿è¾å©èç¹çæ°æ®éåæ ä¸»èç¹çæ°æ®éã å¦æä¸»è¦äººåä¸å¨ï¼åç¬¦åæ¡ä»¶çä¸­å­¦å°ä¸¾è¡éä¸¾ä»¥éåºæ°çä¸»è¦äººåã\n\nï¼3ï¼ä¸»ä»å¤å¶åå¯æ¬éåºå«\n\nä¸»ä»éç¾¤åå¯æ¬éæå¤§çåºå«å°±æ¯å¯æ¬éæ²¡æåºå®çâä¸»èç¹âï¼æ´ä¸ªéç¾¤ä¼éåºä¸ä¸ªâä¸»èç¹âï¼å½å¶ææåï¼åå¨å©ä¸çä»èç¹ä¸­éä¸­å¶ä»èç¹ä¸ºâä¸»èç¹âï¼å¯æ¬éæ»æä¸ä¸ªæ´»è·ç¹(ä¸»ãprimary)åä¸ä¸ªæå¤ä¸ªå¤ä»½èç¹(ä»ãsecondary)ã\n\n\n# 1.2 å¯æ¬éçä¸ä¸ªè§è²\n\nå¯æ¬éæä¸¤ç§ç±»åä¸ç§è§è²\n\nä¸¤ç§ç±»åï¼\n\n * ä¸»èç¹ï¼ Primaryï¼ç±»åï¼æ°æ®æä½çä¸»è¦è¿æ¥ç¹ï¼å¯è¯»åã\n * æ¬¡è¦ï¼è¾å©ãä»ï¼èç¹ï¼ Secondariesï¼ç±»åï¼æ°æ®åä½å¤ä»½èç¹ï¼å¯ä»¥è¯»æéä¸¾ã\n\nä¸ç§è§è²ï¼\n\n * ä¸»è¦æåï¼Primaryï¼ï¼ä¸»è¦æ¥æ¶ææåæä½ãå°±æ¯ä¸»èç¹ã\n * å¯æ¬æåï¼Replicateï¼ï¼ä»ä¸»èç¹éè¿å¤å¶æä½ä»¥ç»´æ¤ç¸åçæ°æ®éï¼å³å¤ä»½æ°æ®ï¼ä¸å¯åæä½ï¼ä½å¯ä»¥è¯»æä½ï¼ä½éè¦éç½®ï¼ãæ¯é»è®¤çä¸ç§ä»èç¹ç±»åã\n * ä»²è£èï¼ Arbiterï¼ï¼ä¸ä¿çä»»ä½æ°æ®çå¯æ¬ï¼åªå·ææç¥¨éä¸¾ä½ç¨ãå½ç¶ä¹å¯ä»¥å°ä»²è£æå¡å¨ç»´æ¤ä¸ºå¯æ¬éçä¸é¨åï¼å³å¯æ¬æååæ¶ä¹å¯ä»¥æ¯ä»²è£èãä¹æ¯ä¸ç§ä»èç¹ç±»åã\n\n\n\nå³äºä»²è£èçé¢å¤è¯´æï¼\n\næ¨å¯ä»¥å°é¢å¤çmongodå®ä¾æ·»å å°å¯æ¬éä½ä¸ºä»²è£èã ä»²è£èä¸ç»´æ¤æ°æ®éã ä»²è£èçç®çæ¯éè¿ååºå¶ä»å¯æ¬éæåçå¿è·³åéä¸¾è¯·æ±æ¥ç»´æ¤å¯æ¬éä¸­çä»²è£ã å ä¸ºå®ä»¬ä¸å­å¨æ°æ®éï¼æä»¥ä»²è£å¨å¯ä»¥æ¯æä¾å¯æ¬éä»²è£åè½çå¥½æ¹æ³ï¼å¶èµæºææ¬æ¯å·ææ°æ®éçå¨åè½å¯æ¬éæåæ´ä¾¿å®ã\n\nå¦ææ¨çå¯æ¬éå·æå¶æ°ä¸ªæåï¼è¯·æ·»å ä»²è£èä»¥è·å¾ä¸»è¦éä¸¾ä¸­çâå¤§å¤æ°âæç¥¨ã ä»²è£èä¸éè¦ä¸ç¨ç¡¬ä»¶ã\n\nä»²è£èå°æ°¸è¿æ¯ä»²è£èï¼èä¸»è¦äººåå¯è½ä¼éåºå¹¶æä¸ºæ¬¡è¦äººåï¼èæ¬¡è¦äººåå¯è½æä¸ºéä¸¾æé´çä¸»è¦äººåã\n\nå¦æä½ çå¯æ¬+ä¸»èç¹çä¸ªæ°æ¯å¶æ°ï¼å»ºè®®å ä¸ä¸ªä»²è£èï¼å½¢æå¥æ°ï¼å®¹ææ»¡è¶³å¤§å¤æ°çæç¥¨ã\n\nå¦æä½ çå¯æ¬+ä¸»èç¹çä¸ªæ°æ¯å¥æ°ï¼å¯ä»¥ä¸å ä»²è£èã\n\n\n# 1.3 å¯æ¬éæ¶æç®æ \n\nä¸ä¸»ä¸å¯æ¬ä¸ä»²è£\n\n\n\n\n# 1.4 å¯æ¬éçåå»º\n\n\n# 1.4.1 ç¬¬ä¸æ­¥ï¼åå»ºä¸»èç¹\n\nå»ºç«å­æ¾æ°æ®åæ¥å¿çç®å½\n\n#-----------myrs\n#ä¸»èç¹\nmkdir -p /mongodb/replica_sets/myrs_27017/log \\ &\nmkdir -p /mongodb/replica_sets/myrs_27017/data/db\n\n\n1\n2\n3\n4\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/replica_sets/myrs_27017/mongod.conf\n\n\n1\n\n\nmyrs_27017 ï¼\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/replica_sets/myrs_27017/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n    dbPath: "/mongodb/replica_sets/myrs_27017/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: "/mongodb/replica_sets/myrs_27017/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææIPï¼æå¯ä½ç¨ï¼å¯æ¬éåå§åçæ¶åï¼èç¹åå­ä¼èªå¨è®¾ç½®ä¸ºæ¬å°ååï¼èä¸æ¯ip\n    #bindIpAll: true\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #bindIp\n    #ç»å®çç«¯å£\n    port: 27017\nreplication:\n    #å¯æ¬éçåç§°\n    replSetName: myrs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nå¯å¨èç¹æå¡ï¼\n\n[root@bobohost replica_sets]# /usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27017/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 54257\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n\n\n\n# 1.4.2 ç¬¬äºæ­¥ï¼åå»ºå¯æ¬èç¹\n\nå»ºç«å­æ¾æ°æ®åæ¥å¿çç®å½\n\n#-----------myrs\n#å¯æ¬èç¹\nmkdir -p /mongodb/replica_sets/myrs_27018/log \\ &\nmkdir -p /mongodb/replica_sets/myrs_27018/data/db\n\n\n1\n2\n3\n4\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/replica_sets/myrs_27018/mongod.conf\n\n\n1\n\n\nmyrs_27018 ï¼\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/replica_sets/myrs_27018/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n    dbPath: "/mongodb/replica_sets/myrs_27018/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: "/mongodb/replica_sets/myrs_27018/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææIPï¼æå¯ä½ç¨ï¼å¯æ¬éåå§åçæ¶åï¼èç¹åå­ä¼èªå¨è®¾ç½®ä¸ºæ¬å°ååï¼èä¸æ¯ip\n    #bindIpAll: true\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #bindIp\n    #ç»å®çç«¯å£\n    port: 27018\nreplication:\n    #å¯æ¬éçåç§°\n    replSetName: myrs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nå¯å¨èç¹æå¡ï¼\n\n[root@bobohost replica_sets]# /usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27018/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 54361\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n\n\n\n# 1.4.3 ç¬¬ä¸æ­¥ï¼åå»ºä»²è£èç¹\n\nå»ºç«å­æ¾æ°æ®åæ¥å¿çç®å½\n\n#-----------myrs\n#ä»²è£èç¹\nmkdir -p /mongodb/replica_sets/myrs_27019/log \\ &\nmkdir -p /mongodb/replica_sets/myrs_27019/data/db\n\n\n1\n2\n3\n4\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/replica_sets/myrs_27019/mongod.conf\n\n\n1\n\n\nmyrs_27019 ï¼\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/replica_sets/myrs_27019/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n    dbPath: "/mongodb/replica_sets/myrs_27019/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: "/mongodb/replica_sets/myrs_27019/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææIPï¼æå¯ä½ç¨ï¼å¯æ¬éåå§åçæ¶åï¼èç¹åå­ä¼èªå¨è®¾ç½®ä¸ºæ¬å°ååï¼èä¸æ¯ip\n    #bindIpAll: true\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #bindIp\n    #ç»å®çç«¯å£\n    port: 27019\nreplication:\n    #å¯æ¬éçåç§°\n    replSetName: myrs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nå¯å¨èç¹æå¡ï¼\n\n[root@bobohost replica_sets]# /usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27019/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 54410\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n\n\n\n# 1.4.4 ç¬¬åæ­¥ï¼åå§åéç½®å¯æ¬éåä¸»èç¹\n\nä½¿ç¨å®¢æ·ç«¯å½ä»¤è¿æ¥ä»»æä¸ä¸ªèç¹ï¼ä½è¿éå°½éè¦è¿æ¥ä¸»èç¹(27017èç¹)ï¼\n\n/usr/local/mongodb/bin/mongo --host=180.76.159.126 --port=27017\n\n\n1\n\n\nç»æï¼è¿æ¥ä¸ä¹åï¼å¾å¤å½ä»¤æ æ³ä½¿ç¨ï¼ï¼æ¯å¦ show dbs ç­ï¼å¿é¡»åå§åå¯æ¬éæè¡\n\nåå¤åå§åæ°çå¯æ¬éï¼\n\nè¯­æ³ï¼\n\nrs.initiate(configuration)\n\n\n1\n\n\nãç¤ºä¾ã\n\nä½¿ç¨é»è®¤çéç½®æ¥åå§åå¯æ¬éï¼\n\nrs.initiate()\n\n\n1\n\n\næ§è¡ç»æï¼\n\n> rs.initiate()\n{\n    "info2" : "no configuration specified. Using a default configuration for the set",\n    "me" : "180.76.159.126:27017",\n    "ok" : 1,\n    "operationTime" : Timestamp(1565760476, 1),\n    "$clusterTime" : {\n        "clusterTime" : Timestamp(1565760476, 1),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n        }\n    }\n}\nmyrs:SECONDARY>\nmyrs:PRIMARY>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\næç¤ºï¼\n\n * âokâçå¼ä¸º1ï¼è¯´æåå»ºæåã\n * å½ä»¤è¡æç¤ºç¬¦åçååï¼åæäºä¸ä¸ªä»èç¹è§è²ï¼æ­¤æ¶é»è®¤ä¸è½è¯»åãç¨ç­çå»ï¼åè½¦ï¼åæä¸»èç¹ã\n\n\n# 1.4.5 ç¬¬äºæ­¥ï¼æ¥çå¯æ¬éçéç½®åå®¹\n\nè¿ååå«å½åå¯æ¬ééç½®çææ¡£ã\n\nè¯­æ³ï¼\n\nrs.conf(configuration)\n\n\n1\n\n\næç¤ºï¼\n\nrs.config() æ¯è¯¥æ¹æ³çå«åã\n\nconfigurationï¼å¯éï¼å¦ææ²¡æéç½®ï¼åä½¿ç¨é»è®¤ä¸»èç¹éç½®ã\n\nãç¤ºä¾ã\n\nå¨27017ä¸æ§è¡å¯æ¬éä¸­å½åèç¹çé»è®¤èç¹éç½®\n\nmyrs:PRIMARY> rs.conf()\n{\n    "_id" : "myrs",\n    "version" : 1,\n    "protocolVersion" : NumberLong(1),\n    "writeConcernMajorityJournalDefault" : true,\n    "members" : [\n        {\n            "_id" : 0,\n            "host" : "180.76.159.126:27017",\n            "arbiterOnly" : false,\n            "buildIndexes" : true,\n            "hidden" : false,\n            "priority" : 1,\n            "tags" : {\n\n            },\n            "slaveDelay" : NumberLong(0),\n            "votes" : 1\n        }\n    ],\n    "settings" : {\n        "chainingAllowed" : true,\n        "heartbeatIntervalMillis" : 2000,\n        "heartbeatTimeoutSecs" : 10,\n        "electionTimeoutMillis" : 10000,\n        "catchUpTimeoutMillis" : -1,\n        "catchUpTakeoverDelayMillis" : 30000,\n        "getLastErrorModes" : {\n\n        },\n        "getLastErrorDefaults" : {\n            "w" : 1,\n            "wtimeout" : 0\n        },\n        "replicaSetId" : ObjectId("5d539bdcd6a308e600d126bb")\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n\n\nè¯´æï¼\n\n * "_id" : "myrs" ï¼å¯æ¬éçéç½®æ°æ®å­å¨çä¸»é®å¼ï¼é»è®¤å°±æ¯å¯æ¬éçåå­\n * "members" ï¼å¯æ¬éæåæ°ç»ï¼æ­¤æ¶åªæä¸ä¸ªï¼ âhostâ : â180.76.159.126:27017â ï¼è¯¥æåä¸æ¯ä»²è£èç¹ï¼âarbiterOnlyâ : false ï¼ä¼åçº§ï¼æéå¼ï¼ï¼ âpriorityâ : 1,\n * "settings" ï¼å¯æ¬éçåæ°éç½®ã\n\næç¤ºï¼å¯æ¬ééç½®çæ¥çå½ä»¤ï¼æ¬è´¨æ¯æ¥è¯¢çæ¯ system.replset çè¡¨ä¸­çæ°æ®ï¼\n\nmyrs:PRIMARY> use local\nswitched to db local\nmyrs:PRIMARY> show collections\noplog.rs\nreplset.election\nreplset.minvalid\nreplset.oplogTruncateAfterPoint\nstartup_log\nsystem.replset\nsystem.rollback.id\nmyrs:PRIMARY> db.system.replset.find()\n{ "_id" : "myrs", "version" : 1, "protocolVersion" : NumberLong(1),\n"writeConcernMajorityJournalDefault" : true, "members" : [ { "_id" : 0, "host" :\n"180.76.159.126:27017", "arbiterOnly" : false, "buildIndexes" : true, "hidden" :\nfalse, "priority" : 1, "tags" : { }, "slaveDelay" : NumberLong(0), "votes" : 1\n} ], "settings" : { "chainingAllowed" : true, "heartbeatIntervalMillis" : 2000,\n"heartbeatTimeoutSecs" : 10, "electionTimeoutMillis" : 10000,\n"catchUpTimeoutMillis" : -1, "catchUpTakeoverDelayMillis" : 30000,\n"getLastErrorModes" : { }, "getLastErrorDefaults" : { "w" : 1, "wtimeout" : 0\n}, "replicaSetId" : ObjectId("5d539bdcd6a308e600d126bb") } }\nmyrs:PRIMARY>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# 1.4.6 ç¬¬å­æ­¥ï¼æ¥çå¯æ¬éç¶æ\n\næ£æ¥å¯æ¬éç¶æã\n\nè¯´æï¼\n\nè¿ååå«ç¶æä¿¡æ¯çææ¡£ãæ­¤è¾åºä½¿ç¨ä»å¯æ¬éçå¶ä»æååéçå¿è·³åä¸­è·å¾çæ°æ®åæ å¯æ¬éçå½åç¶æã\n\nè¯­æ³ï¼\n\nrs.status()\n\n\n1\n\n\nãç¤ºä¾ã\n\nå¨27017ä¸æ¥çå¯æ¬éç¶æï¼\n\nmyrs:PRIMARY> rs.status()\n{\n    "set" : "myrs",\n    "date" : ISODate("2019-08-14T05:29:45.161Z"),\n    "myState" : 1,\n    "term" : NumberLong(1),\n    "syncingTo" : "",\n    "syncSourceHost" : "",\n    "syncSourceId" : -1,\n    "heartbeatIntervalMillis" : NumberLong(2000),\n    "optimes" : {\n        "lastCommittedOpTime" : {\n            "ts" : Timestamp(1565760578, 1),\n            "t" : NumberLong(1)\n        },\n        "readConcernMajorityOpTime" : {\n            "ts" : Timestamp(1565760578, 1),\n            "t" : NumberLong(1)\n        },\n        "appliedOpTime" : {\n            "ts" : Timestamp(1565760578, 1),\n            "t" : NumberLong(1)\n        },\n        "durableOpTime" : {\n            "ts" : Timestamp(1565760578, 1),\n            "t" : NumberLong(1)\n        }\n    },\n    "lastStableCheckpointTimestamp" : Timestamp(1565760528, 1),\n    "members" : [\n        {\n        "_id" : 0,\n        "name" : "180.76.159.126:27017",\n        "health" : 1,\n        "state" : 1,\n        "stateStr" : "PRIMARY",\n        "uptime" : 419,\n        "optime" : {\n            "ts" : Timestamp(1565760578, 1),\n            "t" : NumberLong(1)\n        },\n        "optimeDate" : ISODate("2019-08-14T05:29:38Z"),\n        "syncingTo" : "",\n        "syncSourceHost" : "",\n        "syncSourceId" : -1,\n        "infoMessage" : "could not find member to sync from",\n        "electionTime" : Timestamp(1565760476, 2),\n        "electionDate" : ISODate("2019-08-14T05:27:56Z"),\n        "configVersion" : 1,\n        "self" : true,\n        "lastHeartbeatMessage" : ""\n        }\n    ],\n    "ok" : 1,\n    "operationTime" : Timestamp(1565760578, 1),\n    "$clusterTime" : {\n        "clusterTime" : Timestamp(1565760578, 1),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n\n\nè¯´æï¼\n\n * "set" : "myrs" ï¼å¯æ¬éçåå­\n * "myState" : 1ï¼è¯´æç¶ææ­£å¸¸\n * "members" ï¼å¯æ¬éæåæ°ç»ï¼æ­¤æ¶åªæä¸ä¸ªï¼ "name" : "180.76.159.126:27017" ï¼è¯¥æåçè§è²æ¯ "stateStr" : "PRIMARY", è¯¥èç¹æ¯å¥åº·çï¼ "health" : 1 ã\n\n\n# 1.4.7 ç¬¬ä¸æ­¥ï¼æ·»å å¯æ¬ä»èç¹\n\nå¨ä¸»èç¹æ·»å ä»èç¹ï¼å°å¶ä»æåå å¥å°å¯æ¬é\n\nè¯­æ³ï¼\n\nrs.add(host, arbiterOnly)\n\n\n1\n\n\néé¡¹ï¼\n\nPARAMETER     TYPE                 DESCRIPTION\nhost          string or document   è¦æ·»å å°å¯æ¬éçæ°æåã\n                                   æå®ä¸ºå­ç¬¦ä¸²æéç½®ææ¡£ï¼1ï¼å¦ææ¯ä¸ä¸ªå­ç¬¦ä¸²ï¼åéè¦æå®æ°æåçä¸»æºååå¯éçç«¯å£å·ï¼2ï¼å¦ææ¯ä¸ä¸ªææ¡£ï¼è¯·æå®å¨membersæ°ç»ä¸­æ¾å°çå¯æ¬éæåéç½®ææ¡£ã\n                                   æ¨å¿é¡»å¨æåéç½®ææ¡£ä¸­æå®ä¸»æºå­æ®µãæå³ææ¡£éç½®å­æ®µçè¯´æï¼è¯¦è§ä¸æ¹ææ¡£ï¼âä¸»æºæåçéç½®ææ¡£â\narbiterOnly   boolean              å¯éçã ä»å¨ å¼ä¸ºå­ç¬¦ä¸²æ¶éç¨ã å¦æä¸ºtrueï¼åæ·»å çä¸»æºæ¯ä»²è£èã\n\nä¸»æºæåçéç½®ææ¡£ï¼\n\n{\n    _id: <int>,\n    host: <string>,     // required\n    arbiterOnly: <boolean>,\n    buildIndexes: <boolean>,\n    hidden: <boolean>,\n    priority: <number>,\n    tags: <document>,\n    slaveDelay: <int>,\n    votes: <number>\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nãç¤ºä¾ã\n\nå°27018çå¯æ¬èç¹æ·»å å°å¯æ¬éä¸­ï¼\n\nmyrs:PRIMARY> rs.add("180.76.159.126:27018")\n{\n    "ok" : 1,\n    "operationTime" : Timestamp(1565761757, 1),\n    "$clusterTime" : {\n        "clusterTime" : Timestamp(1565761757, 1),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nè¯´æï¼\n\n * âokâ : 1 ï¼è¯´ææ·»å æåã\n\næ¥çå¯æ¬éç¶æï¼\n\nmyrs:PRIMARY> rs.status()\n{\n    "set" : "myrs",\n    "date" : ISODate("2019-08-14T05:50:05.738Z"),\n    "myState" : 1,\n    "term" : NumberLong(1),\n    "syncingTo" : "",\n    "syncSourceHost" : "",\n    "syncSourceId" : -1,\n    "heartbeatIntervalMillis" : NumberLong(2000),\n    "optimes" : {\n        "lastCommittedOpTime" : {\n            "ts" : Timestamp(1565761798, 1),\n            "t" : NumberLong(1)\n        },\n        "readConcernMajorityOpTime" : {\n            "ts" : Timestamp(1565761798, 1),\n            "t" : NumberLong(1)\n        },\n        "appliedOpTime" : {\n            "ts" : Timestamp(1565761798, 1),\n            "t" : NumberLong(1)\n        },\n        "durableOpTime" : {\n            "ts" : Timestamp(1565761798, 1),\n            "t" : NumberLong(1)\n        }\n    },\n    "lastStableCheckpointTimestamp" : Timestamp(1565761798, 1),\n    "members" : [\n        {\n            "_id" : 0,\n            "name" : "180.76.159.126:27017",\n            "health" : 1,\n            "state" : 1,\n            "stateStr" : "PRIMARY",\n            "uptime" : 1639,\n            "optime" : {\n                "ts" : Timestamp(1565761798, 1),\n                "t" : NumberLong(1)\n            },\n            "optimeDate" : ISODate("2019-08-14T05:49:58Z"),\n            "syncingTo" : "",\n            "syncSourceHost" : "",\n            "syncSourceId" : -1,\n            "infoMessage" : "",\n            "electionTime" : Timestamp(1565760476, 2),\n            "electionDate" : ISODate("2019-08-14T05:27:56Z"),\n            "configVersion" : 2,\n            "self" : true,\n            "lastHeartbeatMessage" : ""\n        },\n        {\n            "_id" : 1,\n            "name" : "180.76.159.126:27018",\n            "health" : 1,\n            "state" : 2,\n            "stateStr" : "SECONDARY",\n            "uptime" : 48,\n            "optime" : {\n                "ts" : Timestamp(1565761798, 1),\n                "t" : NumberLong(1)\n            },\n            "optimeDurable" : {\n                "ts" : Timestamp(1565761798, 1),\n                "t" : NumberLong(1)\n            },\n            "optimeDate" : ISODate("2019-08-14T05:49:58Z"),\n            "optimeDurableDate" : ISODate("2019-08-14T05:49:58Z"),\n            "lastHeartbeat" : ISODate("2019-08-14T05:50:05.294Z"),\n            "lastHeartbeatRecv" : ISODate("2019-08-\n            14T05:50:05.476Z"),\n            "pingMs" : NumberLong(0),\n            "lastHeartbeatMessage" : "",\n            "syncingTo" : "180.76.159.126:27017",\n            "syncSourceHost" : "180.76.159.126:27017",\n            "syncSourceId" : 0,\n            "infoMessage" : "",\n            "configVersion" : 2\n        }\n    ],\n    "ok" : 1,\n    "operationTime" : Timestamp(1565761798, 1),\n    "$clusterTime" : {\n        "clusterTime" : Timestamp(1565761798, 1),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n\n\nè¯´æï¼\n\n * "name" : "180.76.159.126:27018" æ¯ç¬¬äºä¸ªèç¹çåå­ï¼å¶è§è²æ¯ "stateStr" : "SECONDARY"\n\n\n# 1.4.8 ç¬¬å«æ­¥ï¼æ·»å ä»²è£ä»èç¹\n\næ·»å ä¸ä¸ªä»²è£èç¹å°å¯æ¬é\n\nè¯­æ³ï¼\n\nrs.addArb(host)\n\n\n1\n\n\nå°27019çä»²è£èç¹æ·»å å°å¯æ¬éä¸­ï¼\n\nmyrs:PRIMARY> rs.addArb("180.76.159.126:27019")\n{\n    "ok" : 1,\n    "operationTime" : Timestamp(1565761959, 1),\n    "$clusterTime" : {\n        "clusterTime" : Timestamp(1565761959, 1),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nè¯´æï¼\n\n * "ok" : 1 ï¼è¯´ææ·»å æåã\n\næ¥çå¯æ¬éç¶æï¼\n\nmyrs:PRIMARY> rs.status()\n{\n    "set" : "myrs",\n    "date" : ISODate("2019-08-14T05:53:27.198Z"),\n    "myState" : 1,\n    "term" : NumberLong(1),\n    "syncingTo" : "",\n    "syncSourceHost" : "",\n    "syncSourceId" : -1,\n    "heartbeatIntervalMillis" : NumberLong(2000),\n    "optimes" : {\n        "lastCommittedOpTime" : {\n            "ts" : Timestamp(1565761998, 1),\n            "t" : NumberLong(1)\n        },\n        "readConcernMajorityOpTime" : {\n            "ts" : Timestamp(1565761998, 1),\n            "t" : NumberLong(1)\n        },\n        "appliedOpTime" : {\n            "ts" : Timestamp(1565761998, 1),\n            "t" : NumberLong(1)\n        },\n        "durableOpTime" : {\n            "ts" : Timestamp(1565761998, 1),\n            "t" : NumberLong(1)\n        }\n    },\n    "lastStableCheckpointTimestamp" : Timestamp(1565761978, 1),\n    "members" : [\n        {\n            "_id" : 0,\n            "name" : "180.76.159.126:27017",\n            "health" : 1,\n            "state" : 1,\n            "stateStr" : "PRIMARY",\n            "uptime" : 1841,\n            "optime" : {\n                "ts" : Timestamp(1565761998, 1),\n                "t" : NumberLong(1)\n            },\n            "optimeDate" : ISODate("2019-08-14T05:53:18Z"),\n            "syncingTo" : "",\n            "syncSourceHost" : "",\n            "syncSourceId" : -1,\n            "infoMessage" : "",\n            "electionTime" : Timestamp(1565760476, 2),\n            "electionDate" : ISODate("2019-08-14T05:27:56Z"),\n            "configVersion" : 3,\n            "self" : true,\n            "lastHeartbeatMessage" : ""\n        },\n        {\n            "_id" : 1,\n            "name" : "180.76.159.126:27018",\n            "health" : 1,\n            "state" : 2,\n            "stateStr" : "SECONDARY",\n            "uptime" : 249,\n            "optime" : {\n                "ts" : Timestamp(1565761998, 1),\n                "t" : NumberLong(1)\n            },\n            "optimeDurable" : {\n                "ts" : Timestamp(1565761998, 1),\n                "t" : NumberLong(1)\n            },\n            "optimeDate" : ISODate("2019-08-14T05:53:18Z"),\n            "optimeDurableDate" : ISODate("2019-08-14T05:53:18Z"),\n            "lastHeartbeat" : ISODate("2019-08-14T05:53:25.668Z"),\n            "lastHeartbeatRecv" : ISODate("2019-08-14T05:53:26.702Z"),\n            "pingMs" : NumberLong(0),\n            "lastHeartbeatMessage" : "",\n            "syncingTo" : "180.76.159.126:27017",\n            "syncSourceHost" : "180.76.159.126:27017",\n            "syncSourceId" : 0,\n            "infoMessage" : "",\n            "configVersion" : 3\n        },\n        {\n            "_id" : 2,\n            "name" : "180.76.159.126:27019",\n            "health" : 1,\n            "state" : 7,\n            "stateStr" : "ARBITER",\n            "uptime" : 47,\n            "lastHeartbeat" : ISODate("2019-08-14T05:53:25.668Z"),\n            "lastHeartbeatRecv" : ISODate("2019-08-14T05:53:25.685Z"),\n            "pingMs" : NumberLong(0),\n            "lastHeartbeatMessage" : "",\n            "syncingTo" : "",\n            "syncSourceHost" : "",\n            "syncSourceId" : -1,\n            "infoMessage" : "",\n            "configVersion" : 3\n        }\n    ],\n    "ok" : 1,\n    "operationTime" : Timestamp(1565761998, 1),\n    "$clusterTime" : {\n        "clusterTime" : Timestamp(1565761998, 1),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n\n\nè¯´æï¼\n\n * "name" : "180.76.159.126:27019" æ¯ç¬¬äºä¸ªèç¹çåå­ï¼å¶è§è²æ¯ "stateStr" : "ARBITER"\n\n\n# 1.5 å¯æ¬éçæ°æ®è¯»åæä½\n\nç®æ ï¼æµè¯ä¸ä¸ªä¸åè§è²çèç¹çæ°æ®è¯»åæåµ\n\nç»å½ä¸»èç¹27017ï¼åå¥åè¯»åæ°æ®ï¼\n\n[root@bobohost ~]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017\nmyrs:PRIMARY> use articledb\nswitched to db articledb\nmyrs:PRIMARY> db\narticledb\nmyrs:PRIMARY> db.comment.insert({"articleid":"100000","content":"ä»å¤©å¤©æ°çå¥½ï¼é³åæåª","userid":"1001","nickname":"Rose","createdatetime":new Date()})\nWriteResult({ "nInserted" : 1 })\nmyrs:PRIMARY> db.comment.find()\n{ "_id" : ObjectId("5d4d2ae3068138b4570f53bf"), "articleid" : "100000","content" : "ä»å¤©å¤©æ°çå¥½ï¼é³åæåª", "userid" : "1001", "nickname" : "Rose","createdatetime" : ISODate("2019-08-09T08:12:19.427Z") }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nç»å½ä»èç¹27018\n\n[root@bobohost ~]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27018\nmyrs:SECONDARY> show dbs;\n2019-09-10T10:56:51.953+0800 E QUERY  [js] Error: listDatabases failed:{\n    "operationTime" : Timestamp(1568084204, 1),\n    "ok" : 0,\n    "errmsg" : "not master and slaveOk=false",\n    "code" : 13435,\n    "codeName" : "NotMasterNoSlaveOk",\n    "$clusterTime" : {\n        "clusterTime" : Timestamp(1568084204, 1),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n       }\n   }\n} :\n_getErrorWithCode@src/mongo/shell/utils.js:25:13\nMongo.prototype.getDBs@src/mongo/shell/mongo.js:139:1\nshellHelper.show@src/mongo/shell/utils.js:882:13\nshellHelper@src/mongo/shell/utils.js:766:15\n@(shellhelp2):1:1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nåç°ï¼ä¸è½è¯»åéåçæ°æ®ãå½åä»èç¹åªæ¯ä¸ä¸ªå¤ä»½ï¼ä¸æ¯å¥´é¶èç¹ï¼æ æ³è¯»åæ°æ®ï¼åå½ç¶æ´ä¸è¡ã\n\nå ä¸ºé»è®¤æåµä¸ï¼ä»èç¹æ¯æ²¡æè¯»åæéçï¼å¯ä»¥å¢å è¯»çæéï¼ä½éè¦è¿è¡è®¾ç½®\n\nè®¾ç½®è¯»æä½æéï¼\n\nè¯´æï¼\n\nè®¾ç½®ä¸ºå¥´é¶èç¹ï¼åè®¸å¨ä»æåä¸è¿è¡è¯»çæä½\n\nè¯­æ³ï¼\n\nrs.slaveOk()\n#æ\nrs.slaveOk(true)\n\n\n1\n2\n3\n\n\næç¤ºï¼\n\nè¯¥å½ä»¤æ¯ db.getMongo().setSlaveOk() çç®åå½ä»¤ã\n\nãç¤ºä¾ã\n\nå¨27018ä¸è®¾ç½®ä½ä¸ºå¥´é¶èç¹æéï¼å·å¤è¯»æéï¼\n\nrs:SECONDARY> rs.slaveOk()\n\n\n1\n\n\næ­¤æ¶ï¼å¨æ§è¡æ¥è¯¢å½ä»¤ï¼è¿è¡æåï¼\n\nä½ä»ç¶ä¸åè®¸æå¥ã\n\nmyrs:SECONDARY> rs.slaveOk()\nmyrs:SECONDARY> show dbs;\nadmin    0.000GB\narticledb  0.000GB\nconfig   0.000GB\nlocal    0.000GB\nmyrs:SECONDARY> use articledb\nswitched to db articledb\nmyrs:SECONDARY> show collections\ncomment\nmyrs:SECONDARY> db.comment.find()\n{ "_id" : ObjectId("5d7710c04cfd7eee2e3cdabe"), "articleid" : "100000","content" : "ä»å¤©å¤©æ°çå¥½ï¼é³åæåª", "userid" : "1001", "nickname" : "Rose","createdatetime" : ISODate("2019-09-10T02:56:00.467Z") }\nmyrs:SECONDARY> db.comment.insert({"_id":"1","articleid":"100001","content":"æä»¬ä¸åºè¯¥ææ¸æ¨æµªè´¹å¨ææºä¸ï¼å¥åº·å¾éè¦ï¼kä¸æ¯æ¸©æ°´å¹¸ç¦ä½ æä»ã","userid":"1002","nickname":"ç¸å¿äºæ±æ¹","createdatetime":new Date("2019-08-05T22:08:15.522Z"),"likenum":NumberInt(1000),"state":"1"})\nWriteCommandError({\n    "operationTime" : Timestamp(1568084434, 1),\n    "ok" : 0,\n    "errmsg" : "not master",\n    "code" : 10107,\n    "codeName" : "NotMaster",\n    "$clusterTime" : {\n        "clusterTime" : Timestamp(1568084434, 1),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n        }\n    }\n})\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\nç°å¨å¯å®ç°äºè¯»ååç¦»ï¼è®©ä¸»æå¥æ°æ®ï¼è®©ä»æ¥è¯»åæ°æ®ã\n\nå¦æè¦åæ¶ä½ä¸ºå¥´é¶èç¹çè¯»æéï¼\n\nmyrs:SECONDARY> rs.slaveOk(false)\nmyrs:SECONDARY> db.comment.find()\nError: error: {\n    "operationTime" : Timestamp(1568084459, 1),\n    "ok" : 0,\n    "errmsg" : "not master and slaveOk=false",\n    "code" : 13435,\n    "codeName" : "NotMasterNoSlaveOk",\n    "$clusterTime" : {\n        "clusterTime" : Timestamp(1568084459, 1),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nä»²è£èèç¹ï¼ä¸å­æ¾ä»»ä½ä¸å¡æ°æ®çï¼å¯ä»¥ç»å½æ¥ç\n\n[root@bobohost ~]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27019\nmyrs:ARBITER> rs.slaveOk()\nmyrs:ARBITER> show dbs\nlocal  0.000GB\nmyrs:ARBITER> use local\nswitched to db local\nmyrs:ARBITER> show collections\nreplset.minvalid\nreplset.oplogTruncateAfterPoint\nstartup_log\nsystem.replset\nsystem.rollback.id\nmyrs:ARBITER>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nåç°ï¼åªå­æ¾å¯æ¬ééç½®ç­æ°æ®ã\n\n\n# 1.6 ä¸»èç¹çéä¸¾åå\n\nMongoDBå¨å¯æ¬éä¸­ï¼ä¼èªå¨è¿è¡ä¸»èç¹çéä¸¾ï¼ä¸»èç¹éä¸¾çè§¦åæ¡ä»¶ï¼\n\n * ä¸»èç¹æé\n * ä¸»èç¹ç½ç»ä¸å¯è¾¾ï¼é»è®¤å¿è·³ä¿¡æ¯ä¸º10ç§ï¼\n * äººå·¥å¹²é¢ï¼rs.stepDown(600)ï¼\n\nä¸æ¦è§¦åéä¸¾ï¼å°±è¦æ ¹æ®ä¸å®è§åæ¥éä¸»èç¹ã\n\néä¸¾è§åæ¯æ ¹æ®ç¥¨æ°æ¥å³å®è°è·èï¼\n\n * ç¥¨æ°æé«ï¼ä¸è·å¾äº âå¤§å¤æ°âæåçæç¥¨æ¯æçèç¹è·èã\n   \n   âå¤§å¤æ°âçå®ä¹ä¸ºï¼åè®¾å¤å¶éåæç¥¨æåæ°éä¸ºNï¼åå¤§å¤æ°ä¸º N/2 + 1ãä¾å¦ï¼3ä¸ªæç¥¨æåï¼åå¤§å¤æ°çå¼æ¯2ãå½å¤å¶éåå­æ´»æåæ°éä¸è¶³å¤§å¤æ°æ¶ï¼æ´ä¸ªå¤å¶éå°æ æ³éä¸¾åºPrimaryï¼å¤å¶éå°æ æ³æä¾åæå¡ï¼å¤äºåªè¯»ç¶æã\n\n * è¥ç¥¨æ°ç¸åï¼ä¸é½è·å¾äº âå¤§å¤æ°âæåçæç¥¨æ¯æçï¼æ°æ®æ°çèç¹è·èã\n   \n   æ°æ®çæ°æ§æ¯éè¿æä½æ¥å¿oplogæ¥å¯¹æ¯çã\n\nå¨è·å¾ç¥¨æ°çæ¶åï¼ä¼åçº§ï¼priorityï¼åæ°å½±åéå¤§ã\n\nå¯ä»¥éè¿è®¾ç½®ä¼åçº§ï¼priorityï¼æ¥è®¾ç½®é¢å¤ç¥¨æ°ãä¼åçº§å³æéï¼åå¼ä¸º0-1000ï¼ç¸å½äºå¯é¢å¤å¢å 0-1000çç¥¨æ°ï¼ä¼åçº§çå¼è¶å¤§ï¼å°±è¶å¯è½è·å¾å¤æ°æåçæç¥¨ï¼votesï¼æ°ãæå®è¾é«çå¼å¯ä½¿æåæ´æèµæ ¼æä¸ºä¸»è¦æåï¼æ´ä½çå¼å¯ä½¿æåæ´ä¸ç¬¦åæ¡ä»¶ã\n\né»è®¤æåµä¸ï¼ä¼åçº§çå¼æ¯1\n\nmyrs:PRIMARY> rs.conf()\n{\n    "_id" : "myrs",\n    "version" : 3,\n    "protocolVersion" : NumberLong(1),\n    "writeConcernMajorityJournalDefault" : true,\n    "members" : [\n        {\n            "_id" : 0,\n            "host" : "180.76.159.126:27017",\n            "arbiterOnly" : false,\n            "buildIndexes" : true,\n            "hidden" : false,\n            "priority" : 1,\n            "tags" : {\n\n            },\n            "slaveDelay" : NumberLong(0),\n            "votes" : 1\n        },\n        {\n            "_id" : 1,\n            "host" : "180.76.159.126:27018",\n            "arbiterOnly" : false,\n            "buildIndexes" : true,\n            "hidden" : false,\n            "priority" : 1,\n            "tags" : {\n\n            },\n            "slaveDelay" : NumberLong(0),\n            "votes" : 1\n        },\n        {\n            "_id" : 2,\n            "host" : "180.76.159.126:27019",\n            "arbiterOnly" : true,\n            "buildIndexes" : true,\n            "hidden" : false,\n            "priority" : 0,\n            "tags" : {\n\n            },\n            "slaveDelay" : NumberLong(0),\n            "votes" : 1\n        }\n    ],\n    "settings" : {\n        "chainingAllowed" : true,\n        "heartbeatIntervalMillis" : 2000,\n        "heartbeatTimeoutSecs" : 10,\n        "electionTimeoutMillis" : 10000,\n        "catchUpTimeoutMillis" : -1,\n        "catchUpTakeoverDelayMillis" : 30000,\n        "getLastErrorModes" : {\n\n        },\n        "getLastErrorDefaults" : {\n            "w" : 1,\n            "wtimeout" : 0\n        },\n        "replicaSetId" : ObjectId("5d539bdcd6a308e600d126bb")\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n\n\nå¯ä»¥çåºï¼ä¸»èç¹åå¯æ¬èç¹çä¼åçº§åä¸º 1ï¼å³ï¼é»è®¤å¯ä»¥è®¤ä¸ºé½å·²ç»æäºä¸ç¥¨ãä½éä¸¾èç¹ï¼ä¼åçº§æ¯0ï¼ï¼è¦æ³¨ææ¯ï¼å®æ¹è¯´äºï¼éä¸¾èç¹çä¼åçº§å¿é¡»æ¯0ï¼ä¸è½æ¯å«çå¼ãå³ä¸å·å¤éä¸¾æï¼ä½å·ææç¥¨æï¼\n\nãäºè§£ãä¿®æ¹ä¼åçº§\n\næ¯å¦ï¼ä¸é¢æåä»èç¹çä¼åçº§ï¼\n\n1ï¼åå°éç½®å¯¼å¥cfgåé\n\nmyrs:SECONDARY> cfg=rs.conf()\n\n\n1\n\n\n2 ï¼ç¶åä¿®æ¹å¼ï¼IDå·é»è®¤ä»0å¼å§ï¼\n\nmyrs:SECONDARY> cfg.members[1].priority=2\n2\n\n\n1\n2\n\n\n3 ï¼éæ°å è½½éç½®\n\nmyrs:SECONDARY> rs.reconfig(cfg)\n{ "ok" : 1 }\n\n\n1\n2\n\n\nç¨ç­çå»ä¼éæ°å¼å§éä¸¾ã\n\n\n# 1.7 æéæµè¯\n\n\n# 1.7.1 å¯æ¬èç¹æéæµè¯\n\nå³é­27018å¯æ¬èç¹ï¼\n\nåç°ï¼ä¸»èç¹åä»²è£èç¹å¯¹27018çå¿è·³å¤±è´¥ãå ä¸ºä¸»èç¹è¿å¨ï¼å æ­¤ï¼æ²¡æè§¦åæç¥¨éä¸¾ã\n\nå¦ææ­¤æ¶ï¼å¨ä¸»èç¹åå¥æ°æ®ã\n\ndb.comment.insert({"_id":"1","articleid":"100001","content":"æä»¬ä¸åºè¯¥ææ¸æ¨æµªè´¹å¨ææºä¸ï¼å¥åº·å¾éè¦ï¼ä¸æ¯æ¸©æ°´å¹¸ç¦ä½ æä»ã","userid":"1002","nickname":"ç¸å¿äºæ±æ¹","createdatetime":new Date("2019-08-05T22:08:15.522Z"),"likenum":NumberInt(1000),"state":"1"})\n\n\n1\n\n\nåå¯å¨ä»èç¹ï¼ä¼åç°ï¼ä¸»èç¹åå¥çæ°æ®ï¼ä¼èªå¨åæ­¥ç»ä»èç¹ã\n\n\n# 1.7.2 ä¸»èç¹æéæµè¯\n\nå³é­27017èç¹\n\nåç°ï¼ä»èç¹åä»²è£èç¹å¯¹27017çå¿è·³å¤±è´¥ï¼å½å¤±è´¥è¶è¿10ç§ï¼æ­¤æ¶å ä¸ºæ²¡æä¸»èç¹äºï¼ä¼èªå¨åèµ·æç¥¨ã\n\nèå¯æ¬èç¹åªæ27018ï¼å æ­¤ï¼åéäººåªæä¸ä¸ªå°±æ¯27018ï¼å¼å§æç¥¨ã\n\n27019å27018æäºä¸ç¥¨ï¼27018æ¬èº«èªå¸¦ä¸ç¥¨ï¼å æ­¤å±ä¸¤ç¥¨ï¼è¶è¿äºâå¤§å¤æ°â\n\n27019æ¯ä»²è£èç¹ï¼æ²¡æéä¸¾æï¼27018ä¸åå¶æç¥¨ï¼å¶ç¥¨æ°æ¯0.\n\næç»ç»æï¼27018æä¸ºä¸»èç¹ãå·å¤è¯»ååè½ã\n\nå¨27018åå¥æ°æ®æ¥çã\n\ndb.comment.insert({"_id":"2","articleid":"100001","content":"æå¤å¤©ç©ºè¹ååå¼æ°´ï¼å¬å¤©åæ¸©å¼æ°´","userid":"1005","nickname":"ä¼äººææ´","createdatetime":new Date("2019-08-05T23:58:51.485Z"),"likenum":NumberInt(888),"state":"1"})\n\n\n1\n\n\nåå¯å¨ 27017èç¹ï¼åç°27017åæäºä»èç¹ï¼27018ä»ä¿æä¸»èç¹ã\n\nç»å½27017èç¹ï¼åç°æ¯ä»èç¹äºï¼æ°æ®èªå¨ä»27018åæ­¥ã\n\nä»èå®ç°äºé«å¯ç¨ã\n\n\n# 1.7.3 ä»²è£èç¹åä¸»èç¹æé\n\nåå³æä»²è£èç¹27019ï¼\n\nå³æç°å¨çä¸»èç¹27018\n\nç»å½27017åï¼åç°ï¼27017ä»ç¶æ¯ä»èç¹ï¼å¯æ¬éä¸­æ²¡æä¸»èç¹äºï¼å¯¼è´æ­¤æ¶ï¼å¯æ¬éæ¯åªè¯»ç¶æï¼æ æ³åå¥ã\n\nä¸ºå¥ä¸éä¸¾äºï¼å ä¸º27017çç¥¨æ°ï¼æ²¡æè·å¾å¤§å¤æ°ï¼å³æ²¡æå¤§äºç­äº2ï¼å®åªæé»è®¤çä¸ç¥¨ï¼ä¼åçº§æ¯1ï¼\n\nå¦æè¦è§¦åéä¸¾ï¼éä¾¿å å¥ä¸ä¸ªæåå³å¯ã\n\n * å¦æåªå å¥ 27019ä»²è£èç¹æåï¼åä¸»èç¹ä¸å®æ¯27017ï¼å ä¸ºæ²¡å¾éäºï¼ä»²è£èç¹ä¸åä¸éä¸¾ï¼ä½åä¸æç¥¨ãï¼ä¸æ¼ç¤ºï¼\n * å¦æåªå å¥ 27018èç¹ï¼ä¼åèµ·éä¸¾ãå ä¸º27017å27018é½æ¯ä¸¤ç¥¨ï¼åæç§è°æ°æ®æ°ï¼è°å½ä¸»èç¹ã\n\n\n# 1.7.4 ä»²è£èç¹åä»èç¹æé\n\nåå³æä»²è£èç¹27019ï¼\n\nå³æç°å¨çå¯æ¬èç¹27018\n\n10ç§åï¼27017ä¸»èç¹èªå¨éçº§ä¸ºå¯æ¬èç¹ãï¼æå¡éçº§ï¼\n\nå¯æ¬éä¸å¯åæ°æ®äºï¼å·²ç»æéäºã\n\n\n# 1.8 Compass è¿æ¥å¯æ¬é\n\ncompassè¿æ¥ï¼\n\n\n\n\n\n\n# 1.9 SpringDataMongoDB è¿æ¥å¯æ¬é\n\nå¯æ¬éè¯­æ³ï¼\n\nmongodb://host1,host2,host3/articledb?connect=replicaSet&slaveOk=true&replicaSet=å¯æ¬éåå­\n\n\n1\n\n\nå¶ä¸­ï¼\n\n * slaveOk=true ï¼å¼å¯å¯æ¬èç¹è¯»çåè½ï¼å¯å®ç°è¯»ååç¦»ã\n * connect=replicaSet ï¼èªå¨å°å¯æ¬éä¸­éæ©è¯»åçä¸»æºãå¦æslaveOKæ¯æå¼çï¼åå®ç°äºè¯»ååç¦»\n\nãç¤ºä¾ã\n\nè¿æ¥ replica set ä¸å°æå¡å¨ (ç«¯å£ 27017, 27018, å27019)ï¼ç´æ¥è¿æ¥ç¬¬ä¸ä¸ªæå¡å¨ï¼æ è®ºæ¯replica setä¸é¨åæèä¸»æå¡å¨æèä»æå¡å¨ï¼åå¥æä½åºç¨å¨ä¸»æå¡å¨ å¹¶ä¸åå¸æ¥è¯¢å°ä»æå¡å¨ã\n\nä¿®æ¹éç½®æä»¶application.yml\n\nspring:\n    #æ°æ®æºéç½®\n    data:\n        mongodb:\n            # ä¸»æºå°å\n            #   host: 180.76.159.126\n            # æ°æ®åº\n            #   database: articledb\n            # é»è®¤ç«¯å£æ¯27017\n            #   port: 27017\n            #ä¹å¯ä»¥ä½¿ç¨uriè¿æ¥\n            #uri: mongodb://192.168.40.134:27017/articledb\n            # å¯æ¬éçè¿æ¥å­ç¬¦ä¸²\n            uri: mongodb://180.76.159.126:27017,180.76.159.126:27018,180.76.159.126:27019/articledb?connect=replicaSet&slaveOk=true&replicaSet=myrs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ³¨æï¼\n\nä¸»æºå¿é¡»æ¯å¯æ¬éä¸­ææçä¸»æºï¼åæ¬ä¸»èç¹ãå¯æ¬èç¹ãä»²è£èç¹ã\n\nSpringDataMongoDBèªå¨å®ç°äºè¯»ååç¦»ï¼\n\nåæä½æ¶ï¼åªæå¼ä¸»èç¹è¿æ¥ï¼è¯»æä½æ¯ï¼åæ¶æå¼ä¸»èç¹åä»èç¹è¿æ¥ï¼ä½ä½¿ç¨ä»èç¹è·åæ°æ®ã\n\nå®æ´çè¿æ¥å­ç¬¦ä¸²çåèï¼äºè§£ï¼ï¼\n\nMongoDBå®¢æ·ç«¯è¿æ¥è¯­æ³ï¼\n\nmongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]\n\n\n1\n\n * mongodb:// è¿æ¯åºå®çæ ¼å¼ï¼å¿é¡»è¦æå®ã\n * username:password@ å¯éé¡¹ï¼å¦æè®¾ç½®ï¼å¨è¿æ¥æ°æ®åºæå¡å¨ä¹åï¼é©±å¨é½ä¼å°è¯ç»éè¿ä¸ªæ°æ®åº\n * host1 å¿é¡»çæå®è³å°ä¸ä¸ªhost, host1 æ¯è¿ä¸ªURIå¯ä¸è¦å¡«åçãå®æå®äºè¦è¿æ¥æå¡å¨çå°åãå¦æè¦è¿æ¥å¤å¶éï¼è¯·æå®å¤ä¸ªä¸»æºå°åã\n * portX å¯éçæå®ç«¯å£ï¼å¦æä¸å¡«ï¼é»è®¤ä¸º27017\n * /database å¦ææå®username:password@ï¼è¿æ¥å¹¶éªè¯ç»éæå®æ°æ®åºãè¥ä¸æå®ï¼é»è®¤æå¼test æ°æ®åºã\n * ?options æ¯è¿æ¥éé¡¹ãå¦æä¸ä½¿ç¨/databaseï¼ååé¢éè¦å ä¸/ãææè¿æ¥éé¡¹é½æ¯é®å¼å¯¹name=valueï¼é®å¼å¯¹ä¹é´éè¿&æ;ï¼åå·ï¼éå¼\n\næ åçè¿æ¥æ ¼å¼åå«äºå¤ä¸ªéé¡¹(options)ï¼å¦ä¸æç¤ºï¼\n\néé¡¹                    æè¿°\nreplicaSet=name       éªè¯replica setçåç§°ã Impliesconnect=replicaSet.\nslaveOk=true|false    true:å¨connect=directæ¨¡å¼ä¸ï¼é©±å¨ä¼è¿æ¥ç¬¬ä¸å°æºå¨ï¼å³ä½¿è¿å°æå¡å¨ä¸æ¯ä¸»ãå¨connect=replicaSetæ¨¡å¼ä¸ï¼é©±å¨ä¼åéææçåè¯·æ±å°ä¸»å¹¶ä¸æè¯»åæä½åå¸å¨å¶ä»ä»æå¡å¨ãfalse:\n                      å¨connect=directæ¨¡å¼ä¸ï¼é©±å¨ä¼èªå¨æ¾å¯»ä¸»æå¡å¨. å¨connect=replicaSet\n                      æ¨¡å¼ä¸ï¼é©±å¨ä»ä»è¿æ¥ä¸»æå¡å¨ï¼å¹¶ä¸ææçè¯»åå½ä»¤é½è¿æ¥å°ä¸»æå¡å¨ã\nsafe=true|false       true: å¨æ§è¡æ´æ°æä½ä¹åï¼é©±å¨é½ä¼åégetLastErrorå½ä»¤æ¥ç¡®ä¿æ´æ°æåã(è¿è¦åè\n                      wtimeoutMS).false: å¨æ¯æ¬¡æ´æ°ä¹åï¼é©±å¨ä¸ä¼åégetLastErroræ¥ç¡®ä¿æ´æ°æåã\nw=n                   é©±å¨æ·»å  { w : n } å°getLastErrorå½ä»¤. åºç¨äºsafe=trueã\nwtimeoutMS=ms         é©±å¨æ·»å  { wtimeout : ms } å° getlasterror å½ä»¤. åºç¨äº safe=true.\nfsync=true|false      true: é©±å¨æ·»å  { fsync : true } å° getlasterror\n                      å½ä»¤.åºç¨äºsafe=true.false: é©±å¨ä¸ä¼æ·»å å°getLastErrorå½ä»¤ä¸­ã\njournal=true|false    å¦æè®¾ç½®ä¸º true, åæ­¥å° journal (å¨æäº¤å°æ°æ®åºååå¥å°å®ä½ä¸­).åºç¨äº safe=true\nconnectTimeoutMS=ms   å¯ä»¥æå¼è¿æ¥çæ¶é´\nsocketTimeoutMS=ms    åéåæ¥åsocketsçæ¶é´\n\n\n# 2. åçéç¾¤-Sharded Cluster\n\n\n# 2.1 åçæ¦å¿µ\n\nåçï¼shardingï¼æ¯ä¸ç§è·¨å¤å°æºå¨åå¸æ°æ®çæ¹æ³ï¼ MongoDBä½¿ç¨åçæ¥æ¯æå·æéå¸¸å¤§çæ°æ®éåé«ååéæä½çé¨ç½²ã\n\næ¢å¥è¯è¯´ï¼åç(sharding)æ¯æå°æ°æ®æåï¼å°å¶åæ£å­å¨ä¸åçæºå¨ä¸çè¿ç¨ãææ¶ä¹ç¨ååº(partitioning)æ¥è¡¨ç¤ºè¿ä¸ªæ¦å¿µãå°æ°æ®åæ£å°ä¸åçæºå¨ä¸ï¼ä¸éè¦åè½å¼ºå¤§çå¤§åè®¡ç®æºå°±å¯ä»¥å¨å­æ´å¤çæ°æ®ï¼å¤çæ´å¤çè´è½½ã\n\nå·æå¤§åæ°æ®éæé«ååéåºç¨ç¨åºçæ°æ®åºç³»ç»å¯ä»¥ä¼ææåä¸ªæå¡å¨çå®¹éãä¾å¦ï¼é«æ¥è¯¢çä¼èå°½æå¡å¨çCPUå®¹éãå·¥ä½éå¤§å°å¤§äºç³»ç»çRAMä¼å¼ºè°ç£çé©±å¨å¨çI / Oå®¹éã\n\næä¸¤ç§è§£å³ç³»ç»å¢é¿çæ¹æ³ï¼åç´æ©å±åæ°´å¹³æ©å±ã\n\nåç´æ©å±æå³çå¢å åä¸ªæå¡å¨çå®¹éï¼ä¾å¦ä½¿ç¨æ´å¼ºå¤§çCPUï¼æ·»å æ´å¤RAMæå¢å å­å¨ç©ºé´éãå¯ç¨ææ¯çå±éæ§å¯è½ä¼éå¶åä¸ªæºå¨å¯¹äºç»å®å·¥ä½è´è½½èè¨è¶³å¤å¼ºå¤§ãæ­¤å¤ï¼åºäºäºçæä¾ååºäºå¯ç¨çç¡¬ä»¶éç½®å·æç¡¬æ§ä¸éãç»æï¼åç´ç¼©æ¾æå®éçæå¤§å¼ã\n\næ°´å¹³æ©å±æå³çååç³»ç»æ°æ®éå¹¶å è½½å¤ä¸ªæå¡å¨ï¼æ·»å å¶ä»æå¡å¨ä»¥æ ¹æ®éè¦å¢å å®¹éãè½ç¶åä¸ªæºå¨çæ»ä½éåº¦æå®¹éå¯è½ä¸é«ï¼ä½æ¯å°æºå¨å¤çæ´ä¸ªå·¥ä½è´è½½çå­éï¼å¯è½æä¾æ¯åä¸ªé«éå¤§å®¹éæå¡å¨æ´é«çæçãæ©å±é¨ç½²å®¹éåªéè¦æ ¹æ®éè¦æ·»å é¢å¤çæå¡å¨ï¼è¿å¯è½æ¯åä¸ªæºå¨çé«ç«¯ç¡¬ä»¶çæ»ä½ææ¬æ´ä½ãæè¡¡æ¯åºç¡æ¶æåé¨ç½²ç»´æ¤çå¤ææ§å¢å ã\n\nMongoDBæ¯æéè¿åçè¿è¡æ°´å¹³æ©å±ã\n\n\n# 2.2 åçéç¾¤åå«çç»ä»¶\n\nMongoDBåçç¾¤éåå«ä»¥ä¸ç»ä»¶ï¼\n\n * åçï¼å­å¨ï¼ï¼æ¯ä¸ªåçåå«åçæ°æ®çå­éã æ¯ä¸ªåçé½å¯ä»¥é¨ç½²ä¸ºå¯æ¬éã\n * mongos ï¼è·¯ç±ï¼ï¼mongosåå½æ¥è¯¢è·¯ç±å¨ï¼å¨å®¢æ·ç«¯åºç¨ç¨åºååçéç¾¤ä¹é´æä¾æ¥å£ã\n * config servers ï¼âè°åº¦âçéç½®ï¼ï¼éç½®æå¡å¨å­å¨ç¾¤éçåæ°æ®åéç½®è®¾ç½®ã ä»MongoDB 3.4å¼å§ï¼å¿é¡»å°éç½®æå¡å¨é¨ç½²ä¸ºå¯æ¬éï¼CSRSï¼ã\n\nä¸å¾æè¿°äºåçéç¾¤ä¸­ç»ä»¶çäº¤äºï¼\n\n\n\nMongoDBå¨éåçº§å«å¯¹æ°æ®è¿è¡åçï¼å°éåæ°æ®åå¸å¨éç¾¤ä¸­çåçä¸ã\n\n\n# 2.3 åçéç¾¤æ¶æç®æ \n\nä¸¤ä¸ªåçèç¹å¯æ¬éï¼3+3ï¼+ä¸ä¸ªéç½®èç¹å¯æ¬éï¼3ï¼+ä¸¤ä¸ªè·¯ç±èç¹ï¼2ï¼ï¼å±11ä¸ªæå¡èç¹ã\n\n\n\n\n# 2.4 åçï¼å­å¨ï¼èç¹å¯æ¬éçåå»º\n\nææççéç½®æä»¶é½ç´æ¥æ¾å° sharded_cluster çç¸åºçå­ç®å½ä¸é¢ï¼é»è®¤éç½®æä»¶åå­ï¼mongod.conf\n\n\n# 2.4.1 ç¬¬ä¸å¥å¯æ¬é\n\nåå¤å­æ¾æ°æ®åæ¥å¿çç®å½ï¼\n\n#-----------myshardrs01\nmkdir -p /mongodb/sharded_cluster/myshardrs01_27018/log \\ &\nmkdir -p /mongodb/sharded_cluster/myshardrs01_27018/data/db \\ &\n\nmkdir -p /mongodb/sharded_cluster/myshardrs01_27118/log \\ &\nmkdir -p /mongodb/sharded_cluster/myshardrs01_27118/data/db \\ &\n\nmkdir -p /mongodb/sharded_cluster/myshardrs01_27218/log \\ &\nmkdir -p /mongodb/sharded_cluster/myshardrs01_27218/data/db\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\n\n\n1\n\n\nmyshardrs01_27018 ï¼\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myshardrs01_27018/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n    dbPath: "/mongodb/sharded_cluster/myshardrs01_27018/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: "/mongodb/sharded_cluster/myshardrs01_27018/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææIPï¼æå¯ä½ç¨ï¼å¯æ¬éåå§åçæ¶åï¼èç¹åå­ä¼èªå¨è®¾ç½®ä¸ºæ¬å°ååï¼èä¸æ¯ip\n    #bindIpAll: true\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #bindIp\n    #ç»å®çç«¯å£\n    port: 27018\nreplication:\n    #å¯æ¬éçåç§°\n    replSetName: myshardrs01\nsharding:\n    #åçè§è²\n    clusterRole: shardsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\nsharding.clusterRoleï¼\n\nVALUE       DESCRIPTION\nconfigsvr   Start this instance as a config server. The instance starts\n            on port 27019 by default.\nshardsvr    Start this instance as a shard . The instance starts on port\n            27018 by default.\n\næ³¨æï¼\n\nè®¾ç½®sharding.clusterRoleéè¦mongodå®ä¾è¿è¡å¤å¶ã è¦å°å®ä¾é¨ç½²ä¸ºå¯æ¬éæåï¼è¯·ä½¿ç¨replSetNameè®¾ç½®å¹¶æå®å¯æ¬éçåç§°ã\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\n\n\n1\n\n\nmyshardrs01_27118 ï¼\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myshardrs01_27118/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n    dbPath: "/mongodb/sharded_cluster/myshardrs01_27118/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: "/mongodb/sharded_cluster/myshardrs01_27118/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææIP\n    #bindIpAll: true\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27118\nreplication:\n    replSetName: myshardrs01\nsharding:\n    clusterRole: shardsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\n\n\n1\n\n\nmyshardrs01_27218 ï¼\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myshardrs01_27218/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n    dbPath: "/mongodb/sharded_cluster/myshardrs01_27218/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: "/mongodb/sharded_cluster/myshardrs01_27218/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27218\nreplication:\n    replSetName: myshardrs01\nsharding:\n    clusterRole: shardsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\nå¯å¨ç¬¬ä¸å¥å¯æ¬éï¼ä¸ä¸»ä¸å¯æ¬ä¸ä»²è£\n\nä¾æ¬¡å¯å¨ä¸ä¸ªmongodæå¡ï¼\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123223\nchild process started successfully, parent exiting\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123292\nchild process started successfully, parent exiting\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123326\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ¥çæå¡æ¯å¦å¯å¨ï¼\n\n[root@bobohost bin]# ps -ef |grep mongod\npolkitd  61622  61604  0 7æ31 ?    00:04:29 mongod --bind_ip_all\nroot   123223    1  1 01:10 ?     00:00:01 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\nroot   123292    1  4 01:11 ?     00:00:00 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\nroot   123326    1  6 01:11 ?     00:00:00 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\n\n\n1\n2\n3\n4\n5\n\n\n# 2.4.1.1 åå§åå¯æ¬éååå»ºä¸»èç¹ï¼\n\nä½¿ç¨å®¢æ·ç«¯å½ä»¤è¿æ¥ä»»æä¸ä¸ªèç¹ï¼ä½è¿éå°½éè¦è¿æ¥ä¸»èç¹ï¼\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27018\n\n\n1\n\n\næ§è¡åå§åå¯æ¬éå½ä»¤ï¼\n\nrs.initiate()\n\n\n1\n\n\næ¥çå¯æ¬éæåµ\n\nrs.status()\n\n\n1\n\n\nä¸»èç¹éç½®æ¥ç\n\nrs.conf()\n\n\n1\n\n\n# 2.4.1.2 æ·»å å¯æ¬èç¹\n\nrs.add("180.76.159.126:27118")\n\n\n1\n\n\n# 2.4.1.3 æ·»å ä»²è£èç¹\n\nrs.addArb("180.76.159.126:27218")\n\n\n1\n\n\næ¥çå¯æ¬éçéç½®æåµ\n\nmyshardrs01:PRIMARY> rs.conf()\n{\n    "_id" : "myshardrs01",\n    "version" : 3,\n    "protocolVersion" : NumberLong(1),\n    "writeConcernMajorityJournalDefault" : true,\n    "members" : [\n        {\n            "_id" : 0,\n            "host" : "180.76.159.126:27018",\n            "arbiterOnly" : false,\n            "buildIndexes" : true,\n            "hidden" : false,\n            "priority" : 1,\n            "tags" : {\n\n            },\n            "slaveDelay" : NumberLong(0),\n            "votes" : 1\n        },\n        {\n            "_id" : 1,\n            "host" : "180.76.159.126:27118",\n            "arbiterOnly" : false,\n            "buildIndexes" : true,\n            "hidden" : false,\n            "priority" : 1,\n            "tags" : {\n\n            },\n            "slaveDelay" : NumberLong(0),\n            "votes" : 1\n        },\n        {\n            "_id" : 2,\n            "host" : "180.76.159.126:27218",\n            "arbiterOnly" : true,\n            "buildIndexes" : true,\n            "hidden" : false,\n            "priority" : 0,\n            "tags" : {\n\n            },\n            "slaveDelay" : NumberLong(0),\n            "votes" : 1\n        }\n    ],\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n\n# 2.4.2 ç¬¬äºå¥å¯æ¬é\n\nåå¤å­æ¾æ°æ®åæ¥å¿çç®å½ï¼\n\n#-----------myshardrs02\nmkdir -p /mongodb/sharded_cluster/myshardrs02_27318/log \\ &\nmkdir -p /mongodb/sharded_cluster/myshardrs02_27318/data/db \\ &\n\nmkdir -p /mongodb/sharded_cluster/myshardrs02_27418/log \\ &\nmkdir -p /mongodb/sharded_cluster/myshardrs02_27418/data/db \\ &\n\nmkdir -p /mongodb/sharded_cluster/myshardrs02_27518/log \\ &\nmkdir -p /mongodb/sharded_cluster/myshardrs02_27518/data/db\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myshardrs02_27318/mongod.conf\n\n\n1\n\n\nmyshardrs02_27318 ï¼\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myshardrs02_27318/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n    dbPath: "/mongodb/sharded_cluster/myshardrs02_27318/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: "/mongodb/sharded_cluster/myshardrs02_27318/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27318\nreplication:\n    replSetName: myshardrs02\nsharding:\n    clusterRole: shardsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myshardrs02_27418/mongod.conf\n\n\n1\n\n\nmyshardrs02_27418 ï¼\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myshardrs02_27418/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n    dbPath: "/mongodb/sharded_cluster/myshardrs02_27418/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: "/mongodb/sharded_cluster/myshardrs02_27418/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææIP\n    #bindIpAll: true\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27418\nreplication:\n    replSetName: myshardrs02\nsharding:\n    clusterRole: shardsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myshardrs02_27518/mongod.conf\n\n\n1\n\n\nmyshardrs02_27518 ï¼\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myshardrs02_27518/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n    dbPath: "/mongodb/sharded_cluster/myshardrs02_27518/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: "/mongodb/sharded_cluster/myshardrs02_27518/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææIP\n    #bindIpAll: true\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27518\nreplication:\n    replSetName: myshardrs02\nsharding:\n    clusterRole: shardsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nå¯å¨ç¬¬äºå¥å¯æ¬éï¼ä¸ä¸»ä¸å¯æ¬ä¸ä»²è£\n\nä¾æ¬¡å¯å¨ä¸ä¸ªmongodæå¡ï¼\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27318/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123223\nchild process started successfully, parent exiting\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27418/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123292\nchild process started successfully, parent exiting\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27518/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123326\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ¥çæå¡æ¯å¦å¯å¨ï¼\n\n[root@bobohost bin]# ps -ef |grep mongod\n\n\n1\n\n\n# 2.4.2.1 åå§åå¯æ¬éååå»ºä¸»èç¹\n\nä½¿ç¨å®¢æ·ç«¯å½ä»¤è¿æ¥ä»»æä¸ä¸ªèç¹ï¼ä½è¿éå°½éè¦è¿æ¥ä¸»èç¹ï¼\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27318\n\n\n1\n\n\næ§è¡åå§åå¯æ¬éå½ä»¤ï¼\n\nrs.initiate()\n\n\n1\n\n\næ¥çå¯æ¬éæåµ (èéåå®¹)ï¼\n\nrs.status()\n\n\n1\n\n\nä¸»èç¹éç½®æ¥çï¼\n\nrs.conf()\n\n\n1\n\n\n# 2.4.2.2 æ·»å å¯æ¬èç¹\n\nrs.add("180.76.159.126:27418")\n\n\n1\n\n\n# 2.4.2.3 æ·»å ä»²è£èç¹\n\nrs.addArb("180.76.159.126:27518")\n\n\n1\n\n\næ¥çå¯æ¬éçéç½®æåµ\n\nmyshardrs02:PRIMARY> rs.status()\n{\n    "set" : "myshardrs02",\n    "date" : ISODate("2019-07-31T21:38:22.463Z"),\n    "myState" : 1,\n    "term" : NumberLong(1),\n    "syncingTo" : "",\n    "syncSourceHost" : "",\n    "syncSourceId" : -1,\n    "heartbeatIntervalMillis" : NumberLong(2000),\n    "optimes" : {\n        "lastCommittedOpTime" : {\n            "ts" : Timestamp(1564609094, 1),\n            "t" : NumberLong(1)\n        },\n        "readConcernMajorityOpTime" : {\n            "ts" : Timestamp(1564609094, 1),\n            "t" : NumberLong(1)\n        },\n        "appliedOpTime" : {\n            "ts" : Timestamp(1564609094, 1),\n            "t" : NumberLong(1)\n        },\n        "durableOpTime" : {\n            "ts" : Timestamp(1564609094, 1),\n            "t" : NumberLong(1)\n        }\n    },\n    "lastStableCheckpointTimestamp" : Timestamp(1564609074, 1),\n    "members" : [\n        {\n            "_id" : 0,\n            "name" : "180.76.159.126:27318",\n            "health" : 1,\n            "state" : 1,\n            "stateStr" : "PRIMARY",\n            "uptime" : 5086,\n            "optime" : {\n                "ts" : Timestamp(1564609094, 1),\n                "t" : NumberLong(1)\n            },\n            "optimeDate" : ISODate("2019-07-31T21:38:14Z"),\n            "syncingTo" : "",\n            "syncSourceHost" : "",\n            "syncSourceId" : -1,\n            "infoMessage" : "",\n            "electionTime" : Timestamp(1564604032, 2),\n            "electionDate" : ISODate("2019-07-31T20:13:52Z"),\n            "configVersion" : 3,\n            "self" : true,\n            "lastHeartbeatMessage" : ""\n        },\n        {\n            "_id" : 1,\n            "name" : "180.76.159.126:27418",\n            "health" : 1,\n            "state" : 2,\n            "stateStr" : "SECONDARY",\n            "uptime" : 4452,\n            "optime" : {\n                "ts" : Timestamp(1564609094, 1),\n                "t" : NumberLong(1)\n            },\n            "optimeDurable" : {\n                "ts" : Timestamp(1564609094, 1),\n                "t" : NumberLong(1)\n            },\n            "optimeDate" : ISODate("2019-07-31T21:38:14Z"),\n            "optimeDurableDate" : ISODate("2019-07-31T21:38:14Z"),\n            "lastHeartbeat" : ISODate("2019-07-31T21:38:21.178Z"),\n            "lastHeartbeatRecv" : ISODate("2019-07-31T21:38:20.483Z"),\n            "pingMs" : NumberLong(0),\n            "lastHeartbeatMessage" : "",\n            "syncingTo" : "180.76.159.126:27518",\n            "syncSourceHost" : "180.76.159.126:27518",\n            "syncSourceId" : 2,\n            "infoMessage" : "",\n            "configVersion" : 3\n        },\n        {\n            "_id" : 2,\n            "name" : "180.76.159.126:27518",\n            "health" : 1,\n            "state" : 2,\n            "stateStr" : "SECONDARY",\n            "uptime" : 4448,\n            "optime" : {\n                "ts" : Timestamp(1564609094, 1),\n                "t" : NumberLong(1)\n            },\n            "optimeDurable" : {\n                "ts" : Timestamp(1564609094, 1),\n                "t" : NumberLong(1)\n            },\n            "optimeDate" : ISODate("2019-07-31T21:38:14Z"),\n            "optimeDurableDate" : ISODate("2019-07-31T21:38:14Z"),\n            "lastHeartbeat" : ISODate("2019-07-31T21:38:21.178Z"),\n            "lastHeartbeatRecv" : ISODate("2019-07-31T21:38:22.096Z"),\n            "pingMs" : NumberLong(0),\n            "lastHeartbeatMessage" : "",\n            "syncingTo" : "180.76.159.126:27318",\n            "syncSourceHost" : "180.76.159.126:27318",\n            "syncSourceId" : 0,\n            "infoMessage" : "",\n            "configVersion" : 3\n        }\n    ],\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n\n\n\n# 2.5 éç½®èç¹å¯æ¬éçåå»º\n\nç¬¬ä¸æ­¥ï¼åå¤å­æ¾æ°æ®åæ¥å¿çç®å½ï¼\n\n#-----------configrs\n#å»ºç«æ°æ®èç¹dataåæ¥å¿ç®å½\nmkdir -p /mongodb/sharded_cluster/myconfigrs_27019/log \\ &\nmkdir -p /mongodb/sharded_cluster/myconfigrs_27019/data/db \\ &\n\nmkdir -p /mongodb/sharded_cluster/myconfigrs_27119/log \\ &\nmkdir -p /mongodb/sharded_cluster/myconfigrs_27119/data/db \\ &\n\nmkdir -p /mongodb/sharded_cluster/myconfigrs_27219/log \\ &\nmkdir -p /mongodb/sharded_cluster/myconfigrs_27219/data/db\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myconfigrs_27019/mongod.conf\n\n\n1\n\n\nmyconfigrs_27019 ï¼\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myconfigrs_27019/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n    dbPath: "/mongodb/sharded_cluster/myconfigrs_27019/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: "/mongodb/sharded_cluster/myconfigrs_27019/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææIP\n    #bindIpAll: true\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27019\nreplication:\n    replSetName: myconfigrs\nsharding:\n    clusterRole: configsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myconfigrs_27119/mongod.conf\n\n\n1\n\n\nmyconfigrs_27119\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myconfigrs_27119/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n    dbPath: "/mongodb/sharded_cluster/myconfigrs_27119/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: "/mongodb/sharded_cluster/myconfigrs_27119/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææIP\n    #bindIpAll: true\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27119\nreplication:\n    replSetName: myconfigrs\nsharding:\n    clusterRole: configsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myconfigrs_27219/mongod.conf\n\n\n1\n\n\nmyconfigrs_27219\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myconfigrs_27219/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n    dbPath: "/mongodb/sharded_cluster/myconfigrs_27219/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: "/mongodb/sharded_cluster/myconfigrs_27219/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææIP\n    #bindIpAll: true\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27219\nreplication:\n    replSetName: myconfigrs\nsharding:\n    clusterRole: configsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nå¯å¨éç½®å¯æ¬éï¼ä¸ä¸»ä¸¤å¯æ¬\n\nä¾æ¬¡å¯å¨ä¸ä¸ªmongodæå¡ï¼\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27019/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123223\nchild process started successfully, parent exiting\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27119/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123292\nchild process started successfully, parent exiting\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27219/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123326\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ¥çæå¡æ¯å¦å¯å¨ï¼\n\n[root@bobohost bin]# ps -ef |grep mongod\n\n\n1\n\n\n\n# 2.5.1 åå§åå¯æ¬éååå»ºä¸»èç¹\n\nä½¿ç¨å®¢æ·ç«¯å½ä»¤è¿æ¥ä»»æä¸ä¸ªèç¹ï¼ä½è¿éå°½éè¦è¿æ¥ä¸»èç¹ï¼\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27019\n\n\n1\n\n\næ§è¡åå§åå¯æ¬éå½ä»¤ï¼\n\nrs.initiate()\n\n\n1\n\n\næ¥çå¯æ¬éæåµ (èéåå®¹)ï¼\n\nrs.status()\n\n\n1\n\n\nä¸»èç¹éç½®æ¥çï¼\n\nrs.conf()\n\n\n1\n\n\n\n# 2.5.2 æ·»å ä¸¤ä¸ªå¯æ¬èç¹\n\nmyshardrs01:PRIMARY> rs.add("180.76.159.126:27119")\nmyshardrs01:PRIMARY> rs.add("180.76.159.126:27219")\n\n\n1\n2\n\n\næ¥çå¯æ¬éçéç½®æåµï¼\n\nmyshardrs01:PRIMARY> rs.conf()\nmyshardrs01:PRIMARY> rs.status()\n\n\n1\n2\n\n\n\n# 2.6 è·¯ç±èç¹çåå»ºåæä½\n\n\n# 2.6.1 ç¬¬ä¸ä¸ªè·¯ç±èç¹çåå»ºåè¿æ¥\n\nç¬¬ä¸æ­¥ï¼åå¤å­æ¾æ°æ®åæ¥å¿çç®å½ï¼\n\n#-----------mongos01\nmkdir -p /mongodb/sharded_cluster/mymongos_27017/log\n\n\n1\n2\n\n\nmymongos_27017èç¹ï¼\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvi /mongodb/sharded_cluster/mymongos_27017/mongos.conf\n\n\n1\n\n\nmongos.confï¼\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/mymongos_27017/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: /mongodb/sharded_cluster/mymongos_27017/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææIPï¼æå¯ä½ç¨ï¼å¯æ¬éåå§åçæ¶åï¼èç¹åå­ä¼èªå¨è®¾ç½®ä¸ºæ¬å°ååï¼èä¸æ¯ip\n    #bindIpAll: true\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #bindIp\n    #ç»å®çç«¯å£\n    port: 27017\nsharding:\n    #æå®éç½®èç¹å¯æ¬é\n    configDB: myconfigrs/180.76.159.126:27019,180.76.159.126:27119,180.76.159.126:27219\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nå¯å¨mongosï¼\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27017/mongos.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 129874\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n\n\næç¤ºï¼å¯å¨å¦æå¤±è´¥ï¼å¯ä»¥æ¥ç logç®å½ä¸çæ¥å¿ï¼æ¥çå¤±è´¥åå ã\n\nå®¢æ·ç«¯ç»å½mongos\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017\n\n\n1\n\n\næ­¤æ¶ï¼åä¸è¿å»æ°æ®ï¼å¦æåæ°æ®ä¼æ¥éï¼\n\nmongos> use aadb\nswitched to db aadb\nmongos> db.aa.insert({aa:"aa"})\nWriteCommandError({\n    "ok" : 0,\n    "errmsg" : "unable to initialize targeter for write op for collection aa.aa :: caused by :: Database aa not found :: caused by :: No shards found",\n    "code" : 70,\n    "codeName" : "ShardNotFound",\n    "operationTime" : Timestamp(1564600123, 2),\n    "$clusterTime" : {\n    "clusterTime" : Timestamp(1564600123, 2),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n        }\n    }\n})\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nåå ï¼éè¿è·¯ç±èç¹æä½ï¼ç°å¨åªæ¯è¿æ¥äºéç½®èç¹ï¼è¿æ²¡æè¿æ¥åçæ°æ®èç¹ï¼å æ­¤æ æ³åå¥ä¸å¡æ°æ®ã\n\n\n# 2.6.2 å¨è·¯ç±èç¹ä¸è¿è¡åçéç½®æä½\n\nä½¿ç¨å½ä»¤æ·»å åçï¼\n\n# 2.6.2.1 æ·»å åçï¼\n\nè¯­æ³ï¼\n\nsh.addShard("IP:Port")\n\n\n1\n\n\nå°ç¬¬ä¸å¥åçå¯æ¬éæ·»å è¿æ¥ï¼\n\nmongos>sh.addShard("myshardrs01/192.168.0.2:27018,180.76.159.126:27118,180.76.159.126:27218")\n{\n    "shardAdded" : "myshardrs01",\n    "ok" : 1,\n    "operationTime" : Timestamp(1564611970, 4),\n    "$clusterTime" : {\n    "clusterTime" : Timestamp(1564611970, 4),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\næ¥çåçç¶ææåµï¼\n\nmongos> sh.status()\n--- Sharding Status ---\n    sharding version: {\n        "_id" : 1,\n        "minCompatibleVersion" : 5,\n        "currentVersion" : 6,\n        "clusterId" : ObjectId("5d4211b798f3f9a48522c68b")\n    }\n    shards:\n        {  "_id" : "myshardrs01",  "host" : "myshardrs01/180.76.159.126:27018,180.76.159.126:27118",  "state" : 1 }\n    active mongoses:\n        "4.0.10" : 1\n    autosplit:\n        Currently enabled: yes\n    balancer:\n        Currently enabled:  yes\n        Currently running:  no\n        Failed balancer rounds in last 5 attempts:  0\n        Migration Results for the last 24 hours:\n            No recent migrations\n    databases:\n        {  "_id" : "config",  "primary" : "config",  "partitioned" : true }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nç»§ç»­å°ç¬¬äºå¥åçå¯æ¬éæ·»å è¿æ¥ï¼\n\nmongos>sh.addShard("myshardrs02/192.168.0.2:27318,180.76.159.126:27418,180.76.159.126:27518")\n{\n    "shardAdded" : "myshardrs02",\n    "ok" : 1,\n    "operationTime" : Timestamp(1564612147, 5),\n    "$clusterTime" : {\n    "clusterTime" : Timestamp(1564612147, 5),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\næ¥çåçç¶æï¼\n\nmongos> sh.status()\n--- Sharding Status ---\n    sharding version: {\n        "_id" : 1,\n        "minCompatibleVersion" : 5,\n        "currentVersion" : 6,\n        "clusterId" : ObjectId("5d4211b798f3f9a48522c68b")\n    }\n    shards:\n        {  "_id" : "myshardrs01",  "host" : "myshardrs01/180.76.159.126:27018,180.76.159.126:27118",  "state" : 1 }\n        {  "_id" : "myshardrs02",  "host" : "myshardrs02/180.76.159.126:27318,180.76.159.126:27418",  "state" : 1 }\n    active mongoses:\n        "4.0.10" : 1\n    autosplit:\n        Currently enabled: yes\n    balancer:\n        Currently enabled:  yes\n        Currently running:  no\n        Failed balancer rounds in last 5 attempts:  0\n        Migration Results for the last 24 hours:\n            No recent migrations\n    databases:\n        {  "_id" : "config",  "primary" : "config",  "partitioned" : true }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næç¤ºï¼å¦ææ·»å åçå¤±è´¥ï¼éè¦åæå¨ç§»é¤åçï¼æ£æ¥æ·»å åççä¿¡æ¯çæ­£ç¡®æ§åï¼åæ¬¡æ·»å åçã\n\nç§»é¤åçåè(äºè§£)ï¼\n\nuse admin\ndb.runCommand( { removeShard: "myshardrs02" } )\n\n\n1\n2\n\n\næ³¨æï¼å¦æåªå©ä¸æåä¸ä¸ª shardï¼æ¯æ æ³å é¤ç\n\nç§»é¤æ¶ä¼èªå¨è½¬ç§»åçæ°æ®ï¼éè¦ä¸ä¸ªæ¶é´è¿ç¨ã\n\nå®æåï¼åæ¬¡æ§è¡å é¤åçå½ä»¤æè½çæ­£å é¤ã\n\n# 2.6.2.2 å¼å¯åçåè½\n\nsh.enableSharding(âåºåâ)ãsh.shardCollection(âåºå.éååâ,{âkeyâ:1})\n\nå¨mongosä¸çarticledbæ°æ®åºéç½®sharding:\n\nmongos> sh.enableSharding("articledb")\n{\n    "ok" : 1,\n    "operationTime" : Timestamp(1564612296, 5),\n    "$clusterTime" : {\n        "clusterTime" : Timestamp(1564612296, 5),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥çåçç¶æï¼\n\nmongos> sh.status()\n--- Sharding Status ---\n    sharding version: {\n        "_id" : 1,\n        "minCompatibleVersion" : 5,\n        "currentVersion" : 6,\n        "clusterId" : ObjectId("5d4211b798f3f9a48522c68b")\n    }\n    shards:\n        {  "_id" : "myshardrs01",  "host" : "myshardrs01/180.76.159.126:27018,180.76.159.126:27118",  "state" : 1 }\n        {  "_id" : "myshardrs02",  "host" : "myshardrs02/180.76.159.126:27318,180.76.159.126:27418",  "state" : 1 }\n    active mongoses:\n        "4.0.10" : 1\n    autosplit:\n        Currently enabled: yes\n    balancer:\n        Currently enabled:  yes\n        Currently running:  no\n        Failed balancer rounds in last 5 attempts:  0\n        Migration Results for the last 24 hours:\n            No recent migrations\n    databases:\n        {  "_id" : "articledb",  "primary" : "myshardrs02",  "partitioned" : true, "version" : {  "uuid" : UUID("788c9a3b-bb6a-4cc2-a597-974694772986"), "lastMod" : 1 } }\n        {  "_id" : "config",  "primary" : "config",  "partitioned" : true }\n            config.system.sessions\n                shard key: { "_id" : 1 }\n                unique: false\n                balancing: true\n                chunks:\n                    myshardrs01   1\n                { "_id" : { "$minKey" : 1 } } --\x3e> { "_id" : { "$maxKey" : 1 } } on : myshardrs01 Timestamp(1, 0)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n# 2.6.2.3 éååç\n\nå¯¹éååçï¼ä½ å¿é¡»ä½¿ç¨ sh.shardCollection() æ¹æ³æå®éåååçé®\n\nè¯­æ³ï¼\n\nsh.shardCollection(namespace, key, unique)\n\n\n1\n\n\nåæ°ï¼\n\nPARAMETER   TYPE       DESCRIPTION\nnamespace   string     è¦ï¼åçï¼å±äº«çç®æ éåçå½åç©ºé´ï¼æ ¼å¼ï¼ .\nkey         document   ç¨ä½åçé®çç´¢å¼è§èææ¡£ãshardé®å³å®MongoDBå¦ä½å¨shardä¹é´ååææ¡£ãé¤ééåä¸ºç©ºï¼å¦åç´¢å¼å¿é¡»å¨shardcollectionå½ä»¤ä¹åå­å¨ãå¦æéåä¸ºç©ºï¼åMongoDBå¨å¯¹éåè¿è¡åçä¹ååå»ºç´¢å¼ï¼åææ¯æ¯æåçé®çç´¢å¼ä¸å­å¨ãç®åçè¯´ï¼ç±åå«å­æ®µåè¯¥å­æ®µçç´¢å¼éåæ¹åçææ¡£ç»æã\nunique      boolean    å½å¼ä¸ºtrueæåµä¸ï¼çé®å­æ®µä¸ä¼éå¶ä¸ºç¡®ä¿æ¯å¯ä¸ç´¢å¼ãåå¸ç­ç¥çé®ä¸æ¯æå¯ä¸ç´¢å¼ãé»è®¤æ¯falseã\n\nå¯¹éåè¿è¡åçæ¶,ä½ éè¦éæ©ä¸ä¸ª çé®ï¼Shard Keyï¼ , shard key æ¯æ¯æ¡è®°å½é½å¿é¡»åå«ç,ä¸å»ºç«äºç´¢å¼çåä¸ªå­æ®µæå¤åå­æ®µ,MongoDBæç§çé®å°æ°æ®ååå°ä¸åç æ°æ®å ä¸­,å¹¶å° æ°æ®å åè¡¡å°åå¸å°ææåçä¸­.ä¸ºäºæç§çé®ååæ°æ®å,MongoDBä½¿ç¨ åºäºåå¸çåçæ¹å¼ï¼éæºå¹³ååéï¼æèåºäºèå´çåçæ¹å¼ï¼æ°å¼å¤§å°åéï¼ ã\n\nç¨ä»ä¹å­æ®µå½çé®é½å¯ä»¥ï¼å¦ï¼nicknameä½ä¸ºçé®ï¼ä½ä¸å®æ¯å¿å¡«å­æ®µã\n\nåçè§åä¸ï¼åå¸ç­ç¥\n\nå¯¹äº åºäºåå¸çåç ,MongoDBè®¡ç®ä¸ä¸ªå­æ®µçåå¸å¼,å¹¶ç¨è¿ä¸ªåå¸å¼æ¥åå»ºæ°æ®å.\n\nå¨ä½¿ç¨åºäºåå¸åççç³»ç»ä¸­,æ¥æâç¸è¿âçé®çææ¡£ å¾å¯è½ä¸ä¼ å­å¨å¨åä¸ä¸ªæ°æ®åä¸­,å æ­¤æ°æ®çåç¦»æ§æ´å¥½ä¸äº.\n\nä½¿ç¨nicknameä½ä¸ºçé®ï¼æ ¹æ®å¶å¼çåå¸å¼è¿è¡æ°æ®åç\n\nmongos> sh.shardCollection("articledb.comment",{"nickname":"hashed"})\n{\n    "collectionsharded" : "articledb.comment",\n    "collectionUUID" : UUID("ddea6ed8-ee61-4693-bd16-196acc3a45e8"),\n    "ok" : 1,\n    "operationTime" : Timestamp(1564612840, 28),\n    "$clusterTime" : {\n        "clusterTime" : Timestamp(1564612840, 28),\n        "signature" : {\n            "hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),\n            "keyId" : NumberLong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ¥çåçç¶æï¼sh.status()\n\n databases:\n {  "_id" : "articledb",  "primary" : "myshardrs02",  "partitioned" : true,  "version" : {  "uuid" : UUID("251436b7-86c2-4cd8-9a88-70874af29364"), "lastMod" : 1 } }\n     articledb.comment\n         shard key: { "nickname" : "hashed" }\n         unique: false\n         balancing: true\n         chunks:\n             myshardrs01   2\n             myshardrs02   2\n         { "nickname" : { "$minKey" : 1 } } --\x3e> { "nickname" : NumberLong("-4611686018427387902") } on : myshardrs01 Timestamp(1, 0)\n         { "nickname" : NumberLong("-4611686018427387902") } --\x3e> { "nickname" : NumberLong(0) } on : myshardrs01 Timestamp(1, 1)\n         { "nickname" : NumberLong(0) } --\x3e> { "nickname" : NumberLong("4611686018427387902") } on : myshardrs02 Timestamp(1, 2)\n         { "nickname" : NumberLong("4611686018427387902") } --\x3e> { "nickname" : { "$maxKey" : 1 } } on : myshardrs02 Timestamp(1, 3)\n\n{  "_id" : "config",  "primary" : "config",  "partitioned" : true }\n    config.system.sessions\n        shard key: { "_id" : 1 }\n        unique: false\n        balancing: true\n        chunks:\n            myshardrs01   1\n        { "_id" : { "$minKey" : 1 } } --\x3e> { "_id" : { "$maxKey" : 1 } } on : myshardrs01 Timestamp(1, 0)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nåçè§åäºï¼èå´ç­ç¥\n\nå¯¹äº åºäºèå´çåç ,MongoDBæç§çé®çèå´ææ°æ®åæä¸åé¨å.åè®¾æä¸ä¸ªæ°å­ççé®:æ³è±¡ä¸ä¸ªä»è´æ ç©·å°æ­£æ ç©·çç´çº¿,æ¯ä¸ä¸ªçé®çå¼é½å¨ç´çº¿ä¸ç»äºä¸ä¸ªç¹.MongoDBæè¿æ¡ç´çº¿ååä¸ºæ´ç­çä¸éå ççæ®µ,å¹¶ç§°ä¹ä¸º æ°æ®å ,æ¯ä¸ªæ°æ®ååå«äºçé®å¨ä¸å®èå´åçæ°æ®.\n\nå¨ä½¿ç¨çé®åèå´ååçç³»ç»ä¸­,æ¥æâç¸è¿âçé®çææ¡£å¾å¯è½å­å¨å¨åä¸ä¸ªæ°æ®åä¸­,å æ­¤ä¹ä¼å­å¨å¨åä¸ä¸ªåçä¸­.\n\nå¦ä½¿ç¨ä½èå¹´é¾å­æ®µä½ä¸ºçé®ï¼æç§ç¹èµæ°çå¼è¿è¡åçï¼\n\nmongos> sh.shardCollection("articledb.author",{"age":1})\n{\n    "collectionsharded" : "articledb.author",\n    "collectionUUID" : UUID("9a47bdaa-213a-4039-9c18-e70bfc369df7"),\n    "ok" : 1,\n    "operationTime" : Timestamp(1567512803, 13),\n    "$clusterTime" : {\n        "clusterTime" : Timestamp(1567512803, 13),\n        "signature" : {\n            "hash" : BinData(0,"eE9QT5yE5sL1Tyr7+3U8GRy5+5Q="),\n            "keyId" : NumberLong("6732061237309341726")\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ³¨æçæ¯ï¼\n\n * ä¸ä¸ªéååªè½æå®ä¸ä¸ªçé®ï¼å¦åæ¥éã\n * ä¸æ¦å¯¹ä¸ä¸ªéååçï¼åçé®ååçå¼å°±ä¸å¯æ¹åã å¦ï¼ä¸è½ç»éåéæ©ä¸åçåçé®ãä¸è½æ´æ°åçé®çå¼ã\n * æ ¹æ®ageç´¢å¼è¿è¡åéæ°æ®ã\n\næ¥çåçç¶æï¼\n\narticledb.author\n    shard key: { "age" : 1 }\n    unique: false\n    balancing: true\n    chunks:\n        myshardrs01 1\n    { "age" : { "$minKey" : 1 } } --\x3e> { "age" : { "$maxKey" : 1 } } on : myshardrs01 Timestamp(1, 0)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nåºäºèå´çåçæ¹å¼ä¸åºäºåå¸çåçæ¹å¼æ§è½å¯¹æ¯ï¼\n\nåºäºèå´çåçæ¹å¼æä¾äºæ´é«æçèå´æ¥è¯¢,ç»å®ä¸ä¸ªçé®çèå´,ååè·¯ç±å¯ä»¥å¾ç®åå°ç¡®å®åªä¸ªæ°æ®åå­å¨äºè¯·æ±éè¦çæ°æ®,å¹¶å°è¯·æ±è½¬åå°ç¸åºçåçä¸­.\n\nä¸è¿,åºäºèå´çåçä¼å¯¼è´æ°æ®å¨ä¸ååçä¸çä¸åè¡¡,ææ¶å,å¸¦æ¥çæ¶æä½ç¨ä¼å¤§äºæ¥è¯¢æ§è½çç§¯æä½ç¨.æ¯å¦,å¦æçé®æå¨çå­æ®µæ¯çº¿æ§å¢é¿ç,ä¸å®æ¶é´åçææè¯·æ±é½ä¼è½å°æä¸ªåºå®çæ°æ®åä¸­,æç»å¯¼è´åå¸å¨åä¸ä¸ªåçä¸­.å¨è¿ç§æåµä¸,ä¸å°é¨ååçæ¿è½½äºéç¾¤å¤§é¨åçæ°æ®,ç³»ç»å¹¶ä¸è½å¾å¥½å°è¿è¡æ©å±.\n\nä¸æ­¤ç¸æ¯,åºäºåå¸çåçæ¹å¼ä»¥èå´æ¥è¯¢æ§è½çæå¤±ä¸ºä»£ä»·,ä¿è¯äºéç¾¤ä¸­æ°æ®çåè¡¡.åå¸å¼çéæºæ§ä½¿æ°æ®éæºåå¸å¨æ¯ä¸ªæ°æ®åä¸­,å æ­¤ä¹éæºåå¸å¨ä¸ååçä¸­.ä½æ¯ä¹æ­£ç±äºéæºæ§,ä¸ä¸ªèå´æ¥è¯¢å¾é¾ç¡®å®åºè¯¥è¯·æ±åªäºåç,éå¸¸ä¸ºäºè¿åéè¦çç»æ,éè¦è¯·æ±ææåç.\n\nå¦æ ç¹æ®æåµï¼ä¸è¬æ¨èä½¿ç¨ Hash Shardingã\n\nèä½¿ç¨ _id ä½ä¸ºçé®æ¯ä¸ä¸ªä¸éçéæ©ï¼å ä¸ºå®æ¯å¿æçï¼ä½ å¯ä»¥ä½¿ç¨æ°æ®ææ¡£ _id çåå¸ä½ä¸ºçé®ã\n\nè¿ä¸ªæ¹æ¡è½å¤æ¯çè¯»ååé½è½å¤å¹³ååå¸ï¼å¹¶ä¸å®è½å¤ä¿è¯æ¯ä¸ªææ¡£é½æä¸åççé®æä»¥æ°æ®åè½å¤å¾ç²¾ç»ã\n\nä¼¼ä¹è¿æ¯ä¸å¤å®ç¾ï¼å ä¸ºè¿æ ·çè¯å¯¹å¤ä¸ªææ¡£çæ¥è¯¢å¿å°å½ä¸­ææçåçãè½è¯´å¦æ­¤ï¼è¿ä¹æ¯ä¸ç§æ¯è¾å¥½çæ¹æ¡äºã\n\nçæ³åç shard key å¯ä»¥è®© documents ååå°å¨éç¾¤ä¸­åå¸ï¼\n\n\n\næ¾ç¤ºéç¾¤çè¯¦ç»ä¿¡æ¯ï¼\n\nmongos> db.printShardingStatus()\n\n\n1\n\n\næ¥çåè¡¡å¨æ¯å¦å·¥ä½ï¼éè¦éæ°åè¡¡æ¶ç³»ç»æä¼èªå¨å¯å¨ï¼ä¸ç¨ç®¡å®ï¼ï¼\n\nmongos> sh.isBalancerRunning()\nfalse\n\n\n1\n2\n\n\næ¥çå½å Balancerç¶æï¼\n\nmongos> sh.getBalancerState()\ntrue\n\n\n1\n2\n\n\n\n# 2.6.3 åçåæå¥æ°æ®æµè¯\n\næµè¯ä¸ï¼åå¸è§åï¼ï¼ç»å½mongsåï¼åcommentå¾ªç¯æå¥1000æ¡æ°æ®åæµè¯ï¼\n\nmongos> use articledb\nswitched to db articledb\nmongos> for(var i=1;i<=1000;i++){db.comment.insert({_id:i+"",nickname:"BoBo"+i})}\nWriteResult({ "nInserted" : 1 })\nmongos> db.comment.count()\n1000\n\n\n1\n2\n3\n4\n5\n6\n\n\næç¤ºï¼ jsçè¯­æ³ï¼å ä¸ºmongoçshellæ¯ä¸ä¸ªJavaScriptçshellã\n\næ³¨æï¼ä»è·¯ç±ä¸æå¥çæ°æ®ï¼å¿é¡»åå«çé®ï¼å¦åæ æ³æå¥ã\n\nåå«ç»éä¸¤ä¸ªççä¸»èç¹ï¼ç»è®¡ææ¡£æ°é\n\nç¬¬ä¸ä¸ªåçå¯æ¬éï¼\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27018\n\nmyshardrs01:PRIMARY> use articledb\nswitched to db articledb\nmyshardrs01:PRIMARY> db.comment.count()\n507\n\n\n1\n2\n3\n4\n5\n6\n\n\nç¬¬äºä¸ªåçå¯æ¬éï¼\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27318\n\nmyshardrs02:PRIMARY> use articledb\nswitched to db articledb\nmyshardrs02:PRIMARY> db.comment.count()\n493\n\n\n1\n2\n3\n4\n5\n6\n\n\nå¯ä»¥çå°ï¼ 1000æ¡æ°æ®è¿ä¼¼ååçåå¸å°äº2ä¸ªshardä¸ãæ¯æ ¹æ®çé®çåå¸å¼åéçã\n\nè¿ç§åéæ¹å¼éå¸¸æäºæ°´å¹³æ©å±ï¼ä¸æ¦æ°æ®å­å¨éè¦æ´å¤§ç©ºé´ï¼å¯ä»¥ç´æ¥åå¢å åçå³å¯ï¼åæ¶æåäºæ§è½ã\n\nä½¿ç¨db.comment.stats()æ¥çåä¸ªéåçå®æ´æåµï¼mongosæ§è¡è¯¥å½ä»¤å¯ä»¥æ¥çè¯¥éåçæ°æ®åççæåµã\n\nä½¿ç¨sh.status()æ¥çæ¬åºåææéåçåçä¿¡æ¯ã\n\næµè¯äºï¼èå´è§åï¼ï¼ç»å½mongsåï¼åcommentå¾ªç¯æå¥1000æ¡æ°æ®åæµè¯ï¼\n\nmongos> use articledb\nswitched to db articledb\nmongos> for(var i=1;i<=20000;i++){db.author.save({"name":"BoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBoBo"+i,"age":NumberInt(i%120)})}\nWriteResult({ "nInserted" : 1 })\nmongos> db.comment.count()\n20000\n\n\n1\n2\n3\n4\n5\n6\n\n\næå¥æååï¼ä»ç¶è¦åå«æ¥çä¸¤ä¸ªåçå¯æ¬éçæ°æ®æåµã\n\nåçææï¼\n\narticledb.author\n    shard key: { "age" : 1 }\n    unique: false\n    balancing: true\n    chunks:\n        myshardrs01 2\n        myshardrs02 1\n    { "age" : { "$minKey" : 1 } } --\x3e> { "age" : 0 } on : myshardrs02 Timestamp(2, 0)\n    { "age" : 0 } --\x3e> { "age" : 112 } on : myshardrs01 Timestamp(2, 1)\n    { "age" : 112 } --\x3e> { "age" : { "$maxKey" : 1 } } on : myshardrs01 Timestamp(1, 3)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næç¤ºï¼\n\nå¦ææ¥çç¶æåç°æ²¡æåçï¼åå¯è½æ¯ç±äºä»¥ä¸åå é æäºï¼\n\n * ç³»ç»ç¹å¿ï¼æ­£å¨åçä¸­ã\n\n * æ°æ®åï¼chunkï¼æ²¡æå¡«æ»¡ï¼é»è®¤çæ°æ®åå°ºå¯¸ï¼chunksizeï¼æ¯64Mï¼å¡«æ»¡åæä¼èèåå¶ä»ççæ°æ®åå¡«åæ°æ®ï¼å æ­¤ï¼ä¸ºäºæµè¯ï¼å¯ä»¥å°å¶æ¹å°ï¼è¿éæ¹ä¸º1Mï¼æä½å¦ä¸ï¼\n   \n   use config\n   db.settings.save( { _id:"chunksize", value: 1 } )\n   \n   \n   1\n   2\n   \n   \n   æµè¯å®æ¹åæ¥ï¼\n   \n   db.settings.save( { _id:"chunksize", value: 64 } )\n   \n   \n   1\n   \n\næ³¨æï¼è¦åæ¹å°ï¼åè®¾ç½®åçãä¸ºäºæµè¯ï¼å¯ä»¥åå é¤éåï¼éæ°å»ºç«éåçåçç­ç¥ï¼åæå¥æ°æ®æµè¯å³å¯ã\n\n\n# 2.6.4 åå¢å ä¸ä¸ªè·¯ç±èç¹\n\næä»¶å¤¹ï¼\n\n#-----------mongos02\nmkdir -p /mongodb/sharded_cluster/mymongos_27117/log\n\n\n1\n2\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvi /mongodb/sharded_cluster/mymongos_27117/mongos.conf\n\n\n1\n\n\nmongos.confï¼\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/mymongos_27117/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: /mongodb/sharded_cluster/mymongos_27117/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææIPï¼æå¯ä½ç¨ï¼å¯æ¬éåå§åçæ¶åï¼èç¹åå­ä¼èªå¨è®¾ç½®ä¸ºæ¬å°ååï¼èä¸æ¯ip\n    #bindIpAll: true\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #bindIp\n    #ç»å®çç«¯å£\n    port: 27117\nsharding:\n    configDB: myconfigrs/180.76.159.126:27019,180.76.159.126:27119,180.76.159.126:27219\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nå¯å¨mongos2ï¼\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27117/mongos.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 129874\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n\n\nä½¿ç¨mongoå®¢æ·ç«¯ç»å½27117ï¼åç°ï¼ç¬¬äºä¸ªè·¯ç±æ ééç½®ï¼å ä¸ºåçéç½®é½ä¿å­å°äºéç½®æå¡å¨ä¸­äºã\n\n\n# 2.7 Compass è¿æ¥åçéç¾¤\n\ncompassè¿æ¥ï¼\n\n\n\næç¤ºï¼åè¿æ¥åæº mongodä¸æ ·ã\n\nè¿æ¥æååï¼ä¸æ¹æmongosååçéç¾¤çæç¤ºï¼\n\n\n\n\n# 2.8 SpringDataMongDB è¿æ¥åçéç¾¤\n\nJavaå®¢æ·ç«¯å¸¸ç¨çæ¯SpringDataMongoDBï¼å¶è¿æ¥çæ¯mongsè·¯ç±ï¼éç½®ååæºmongodçéç½®æ¯ä¸æ ·çã\n\nå¤ä¸ªè·¯ç±çæ¶åçSpringDataMongoDBçå®¢æ·ç«¯éç½®åèå¦ä¸ï¼\n\nspring:\n    #æ°æ®æºéç½®\n    data:\n        mongodb:\n            # ä¸»æºå°å\n            #   host: 180.76.159.126\n            # æ°æ®åº\n            #   database: articledb\n            # é»è®¤ç«¯å£æ¯27017\n            #   port: 27017\n            #ä¹å¯ä»¥ä½¿ç¨uriè¿æ¥\n            #   uri: mongodb://192.168.40.134:28017/articledb\n            # è¿æ¥å¯æ¬éå­ç¬¦ä¸²\n            #   uri: mongodb://180.76.159.126:27017,180.76.159.126:27018,180.76.159.126:27019/articledb?connect=replicaSet&slaveOk=true&replicaSet=myrs\n            #è¿æ¥è·¯ç±å­ç¬¦ä¸²\n            uri: mongodb://180.76.159.126:27017,180.76.159.126:27117/articledb\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\néè¿æ¥å¿åç°ï¼åå¥æ°æ®çæ¶åï¼ä¼éæ©ä¸ä¸ªè·¯ç±åå¥\n\n\n# 2.9 æ¸é¤ææçèç¹æ°æ®ï¼å¤ç¨ï¼\n\nå¦æå¨æ­å»ºåççæ¶åææä½å¤±è´¥æéç½®æé®é¢ï¼éè¦éæ°æ¥è¿çï¼å¯ä»¥è¿è¡å¦ä¸æä½ï¼\n\nç¬¬ä¸æ­¥ï¼æ¥è¯¢åºææçæµè¯æå¡èç¹çè¿ç¨ï¼\n\n[root@bobohost sharded_cluster]# ps -ef |grep mongo\nroot    10184    1  0 06:04 ?     00:01:25 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\nroot    10219    1  0 06:04 ?     00:01:25 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\nroot    10253    1  0 06:04 ?     00:00:46 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\nroot    10312    1  0 06:04 ?     00:01:23 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27318/mongod.conf\nroot    10346    1  0 06:05 ?     00:01:23 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27418/mongod.conf\nroot    10380    1  0 06:05 ?     00:00:44 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27518/mongod.conf\nroot    10414    1  1 06:05 ?     00:01:36 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27019/mongod.conf\nroot    10453    1  1 06:05 ?     00:01:37 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27119/mongod.conf\nroot    10492    1  1 06:05 ?     00:01:38 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27219/mongod.conf\nroot    11392    1  0 06:15 ?     00:00:24 /usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27017/mongos.conf\nroot    14829    1  0 07:15 ?     00:00:13 /usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27117/mongos.conf\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ ¹æ®ä¸è¿°çè¿ç¨ç¼å·ï¼ä¾æ¬¡ä¸­æ­è¿ç¨ï¼\n\nkill -2 è¿ç¨ç¼å·\n\n\n1\n\n\nç¬¬äºæ­¥ï¼æ¸é¤ææçèç¹çæ°æ®ï¼\n\nrm -rf /mongodb/sharded_cluster/myconfigrs_27019/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myconfigrs_27119/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myconfigrs_27219/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myshardrs01_27018/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myshardrs01_27118/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myshardrs01_27218/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myshardrs02_27318/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myshardrs02_27418/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myshardrs02_27518/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/mymongos_27017/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/mymongos_27117/data/db/*.*\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nç¬¬ä¸æ­¥ï¼æ¥çæä¿®æ¹æé®é¢çéç½®\n\nç¬¬åæ­¥ï¼ä¾æ¬¡å¯å¨ææèç¹ï¼ä¸åæ¬è·¯ç±èç¹ï¼\n\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27318/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27418/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27518/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27019/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27119/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27219/mongod.conf\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nç¬¬äºæ­¥ï¼å¯¹ä¸¤ä¸ªæ°æ®åçå¯æ¬éåä¸ä¸ªéç½®å¯æ¬éè¿è¡åå§ååç¸å³éç½®\n\nç¬¬å­æ­¥ï¼æ£æ¥è·¯ç±mongosçéç½®ï¼å¹¶å¯å¨mongos\n\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/mymongos_27017/mongos.cfg\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/mymongos_27017/mongos.cfg\n\n\n1\n2\n\n\nç¬¬ä¸æ­¥ï¼mongoç»å½mongosï¼å¨å¶ä¸è¿è¡ç¸å³æä½ã\n\n\n# 3. å®å¨è®¤è¯\n\n\n# 3.1 MongoDB çç¨æ·åè§è²æéç®ä»\n\né»è®¤æåµä¸ï¼MongoDBå®ä¾å¯å¨è¿è¡æ¶æ¯æ²¡æå¯ç¨ç¨æ·è®¿é®æéæ§å¶çï¼ä¹å°±æ¯è¯´ï¼å¨å®ä¾æ¬æºæå¡å¨ä¸é½å¯ä»¥éæè¿æ¥å°å®ä¾è¿è¡åç§æä½ï¼MongoDBä¸ä¼å¯¹è¿æ¥å®¢æ·ç«¯è¿è¡ç¨æ·éªè¯ï¼è¿æ¯éå¸¸å±é©çã\n\nmongodbå®ç½ä¸è¯´ï¼ä¸ºäºè½ä¿émongodbçå®å¨å¯ä»¥åä»¥ä¸å ä¸ªæ­¥éª¤ï¼\n\n * ä½¿ç¨æ°çç«¯å£ï¼é»è®¤ç27017ç«¯å£å¦æä¸æ¦ç¥éäºipå°±è½è¿æ¥ä¸ï¼ä¸å¤ªå®å¨ã\n * è®¾ç½®mongodbçç½ç»ç¯å¢ï¼æå¥½å°mongodbé¨ç½²å°å¬å¸æå¡å¨åç½ï¼è¿æ ·å¤ç½æ¯è®¿é®ä¸å°çãå¬å¸åé¨è®¿é®ä½¿ç¨vpnç­ã\n * å¼å¯å®å¨è®¤è¯ãè®¤è¯è¦åæ¶è®¾ç½®æå¡å¨ä¹é´çåé¨è®¤è¯æ¹å¼ï¼åæ¶è¦è®¾ç½®å®¢æ·ç«¯è¿æ¥å°éç¾¤çè´¦å·å¯ç è®¤è¯æ¹å¼ã\n\nä¸ºäºå¼ºå¶å¼å¯ç¨æ·è®¿é®æ§å¶(ç¨æ·éªè¯)ï¼åéè¦å¨MongoDBå®ä¾å¯å¨æ¶ä½¿ç¨éé¡¹ â auth æå¨æå®å¯å¨éç½®æä»¶ä¸­æ·»å éé¡¹ auth=true ã\n\nå¨å¼å§ä¹åéè¦äºè§£ä¸ä¸æ¦å¿µ\n\n1ï¼å¯ç¨è®¿é®æ§å¶ï¼\n\nMongoDBä½¿ç¨çæ¯åºäºè§è²çè®¿é®æ§å¶(Role-Based Access Control,RBAC)æ¥ç®¡çç¨æ·å¯¹å®ä¾çè®¿é®ãéè¿å¯¹ç¨æ·æäºä¸ä¸ªæå¤ä¸ªè§è²æ¥æ§å¶ç¨æ·è®¿é®æ°æ®åºèµæºçæéåæ°æ®åºæä½çæéï¼å¨å¯¹ç¨æ·åéè§è²ä¹åï¼ç¨æ·æ æ³è®¿é®å®ä¾ã\n\nå¨å®ä¾å¯å¨æ¶æ·»å éé¡¹ â auth ææå®å¯å¨éç½®æä»¶ä¸­æ·»å éé¡¹ auth=true ã\n\n2ï¼è§è²ï¼\n\nå¨MongoDBä¸­éè¿è§è²å¯¹ç¨æ·æäºç¸åºæ°æ®åºèµæºçæä½æéï¼æ¯ä¸ªè§è²å½ä¸­çæéå¯ä»¥æ¾å¼æå®ï¼ä¹å¯ä»¥éè¿ç»§æ¿å¶ä»è§è²çæéï¼æèä¸¤é½é½å­å¨çæéã\n\n3ï¼æéï¼\n\næéç±æå®çæ°æ®åºèµæº(resource)ä»¥ååè®¸å¨æå®èµæºä¸è¿è¡çæä½(action)ç»æã\n\n * èµæº(resource)åæ¬ï¼æ°æ®åºãéåãé¨åéååéç¾¤ï¼\n * æä½(action)åæ¬ï¼å¯¹èµæºè¿è¡çå¢ãå ãæ¹ãæ¥(CRUD)æä½ã\n\nå¨è§è²å®ä¹æ¶å¯ä»¥åå«ä¸ä¸ªæå¤ä¸ªå·²å­å¨çè§è²ï¼æ°åå»ºçè§è²ä¼ç»§æ¿åå«çè§è²ææçæéãå¨åä¸ä¸ªæ°æ®åºä¸­ï¼æ°åå»ºè§è²å¯ä»¥ç»§æ¿å¶ä»è§è²çæéï¼å¨ admin æ°æ®åºä¸­åå»ºçè§è²å¯ä»¥ç»§æ¿å¨å¶å®ä»»ææ°æ®åºä¸­è§è²çæéã\n\nå³äºè§è²æéçæ¥çï¼å¯ä»¥éè¿å¦ä¸å½ä»¤æ¥è¯¢ï¼äºè§£ï¼ï¼\n\n// æ¥è¯¢ææè§è²æé(ä»ç¨æ·èªå®ä¹è§è²)\n> db.runCommand({ rolesInfo: 1 })\n\n// æ¥è¯¢ææè§è²æé(åå«åç½®è§è²)\n> db.runCommand({ rolesInfo: 1, showBuiltinRoles: true })\n\n// æ¥è¯¢å½åæ°æ®åºä¸­çæè§è²çæé\n> db.runCommand({ rolesInfo: "<rolename>" })\n// æ¥è¯¢å¶å®æ°æ®åºä¸­æå®çè§è²æé\n> db.runCommand({ rolesInfo: { role: "<rolename>", db: "<database>" } }\n// æ¥è¯¢å¤ä¸ªè§è²æé\n> db.runCommand(\n    {\n        rolesInfo: [\n            "<rolename>",\n            { role: "<rolename>", db: "<database>" },\n            ...\n        ]  \n    }\n)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nç¤ºä¾ï¼\n\næ¥çææåç½®è§è²ï¼\n\n> db.runCommand({ rolesInfo: 1, showBuiltinRoles: true })\n{\n    "roles" : [\n        {\n            "role" : "__queryableBackup",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "__system",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "backup",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "clusterAdmin",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "clusterManager",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "clusterMonitor",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "dbAdmin",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "dbAdminAnyDatabase",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "dbOwner",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "enableSharding",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "hostManager",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "read",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "readAnyDatabase",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "readWrite",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "readWriteAnyDatabase",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "restore",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "root",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "userAdmin",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        },\n        {\n            "role" : "userAdminAnyDatabase",\n            "db" : "admin",\n            "isBuiltin" : true,\n            "roles" : [ ],\n            "inheritedRoles" : [ ]\n        }\n    ],\n    "ok" : 1\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n\n\nå¸¸ç¨çåç½®è§è²ï¼\n\n * æ°æ®åºç¨æ·è§è²ï¼ readãreadWrite;\n * æææ°æ®åºç¨æ·è§è²ï¼ readAnyDatabaseãreadWriteAnyDatabaseãuserAdminAnyDatabaseãdbAdminAnyDatabase\n * æ°æ®åºç®¡çè§è²ï¼ dbAdminãdbOwnerãuserAdminï¼\n * éç¾¤ç®¡çè§è²ï¼ clusterAdminãclusterManagerãclusterMonitorãhostManagerï¼\n * å¤ä»½æ¢å¤è§è²ï¼ backupãrestoreï¼\n * è¶çº§ç¨æ·è§è²ï¼ root\n * åé¨è§è²ï¼ system\n\nè§è²è¯´æï¼\n\nè§è²                     æéæè¿°\nread                   å¯ä»¥è¯»åæå®æ°æ®åºä¸­ä»»ä½æ°æ®\nreadWrite              å¯ä»¥è¯»åæå®æ°æ®åºä¸­ä»»ä½æ°æ®ï¼åæ¬åå»ºãéå½åãå é¤éå\nreadAnyDatabase        å¯ä»¥è¯»åæææ°æ®åºä¸­ä»»ä½æ°æ®(é¤äºæ°æ®åºconfigålocalä¹å¤)\nreadWriteAnyDatabase   å¯ä»¥è¯»åæææ°æ®åºä¸­ä»»ä½æ°æ®(é¤äºæ°æ®åºconfigålocalä¹å¤)\nuserAdminAnyDatabase   å¯ä»¥å¨æå®æ°æ®åºåå»ºåä¿®æ¹ç¨æ·(é¤äºæ°æ®åºconfigålocalä¹å¤)\ndbAdminAnyDatabase     å¯ä»¥è¯»åä»»ä½æ°æ®åºä»¥åå¯¹æ°æ®åºè¿è¡æ¸çãä¿®æ¹ãåç¼©ãè·åç»è®¡ä¿¡æ¯ãæ§è¡æ£æ¥ç­æä½(é¤äºæ°æ®åºconfigålocalä¹å¤)\ndbAdmin                å¯ä»¥è¯»åæå®æ°æ®åºä»¥åå¯¹æ°æ®åºè¿è¡æ¸çãä¿®æ¹ãåç¼©ãè·åç»è®¡ä¿¡æ¯ãæ§è¡æ£æ¥ç­æä½\nuserAdmin              å¯ä»¥å¨æå®æ°æ®åºåå»ºåä¿®æ¹ç¨æ·\nclusterAdmin           å¯ä»¥å¯¹æ´ä¸ªéç¾¤ææ°æ®åºç³»ç»è¿è¡ç®¡çæä½\nbackup                 å¤ä»½MongoDBæ°æ®æå°çæé\nrestore                ä»å¤ä»½æä»¶ä¸­è¿åæ¢å¤MongoDBæ°æ®(é¤äºsystem.profileéå)çæé\nroot                   è¶çº§è´¦å·ï¼è¶çº§æé\n\n\n# 3.2 åå®ä¾ç¯å¢\n\nç®æ ï¼å¯¹åå®ä¾çMongoDBæå¡å¼å¯å®å¨è®¤è¯ï¼è¿éçåå®ä¾æçæ¯æªå¼å¯å¯æ¬éæåççMongoDBå®ä¾ã\n\n\n# 3.2.1 å³é­å·²å¼å¯çæå¡\n\nå¢å mongodçåå®ä¾çå®å¨è®¤è¯åè½ï¼å¯ä»¥å¨æå¡æ­å»ºçæ¶åç´æ¥æ·»å ï¼ä¹å¯ä»¥å¨ä¹åæ­å»ºå¥½çæå¡ä¸æ·»å ã\n\næ¬æä½¿ç¨ä¹åæ­å»ºå¥½çæå¡ï¼å æ­¤ï¼ååæ­¢ä¹åçæå¡\n\nåæ­¢æå¡çæ¹å¼æä¸¤ç§ï¼å¿«éå³é­åæ åå³é­ï¼ä¸é¢ä¾æ¬¡è¯´æï¼\n\nï¼1ï¼å¿«éå³é­æ¹æ³ï¼å¿«éï¼ç®åï¼æ°æ®å¯è½ä¼åºéï¼\n\nç®æ ï¼éè¿ç³»ç»çkillå½ä»¤ç´æ¥ææ­»è¿ç¨ï¼\n\næå®è¦æ£æ¥ä¸ä¸ï¼é¿åæçæ²¡æææã\n\n#éè¿è¿ç¨ç¼å·å³é­èç¹\nkill -2 54410\n\n\n1\n2\n\n\nãè¡¥åã\n\nå¦æä¸æ¦æ¯å ä¸ºæ°æ®æåï¼åéè¦è¿è¡å¦ä¸æä½ï¼äºè§£ï¼ï¼\n\n1ï¼å é¤lockæä»¶ï¼\n\nrm -f /mongodb/single/data/db/*.lock\n\n\n1\n\n\n2 ï¼ä¿®å¤æ°æ®ï¼\n\n/usr/local/mongodb/bin/mongod --repair --dbpath=/mongodb/single/data/db\n\n\n1\n\n\nï¼2ï¼æ åçå³é­æ¹æ³ï¼æ°æ®ä¸å®¹æåºéï¼ä½éº»ç¦ï¼ï¼\n\nç®æ ï¼éè¿mongoå®¢æ·ç«¯ä¸­çshutdownServerå½ä»¤æ¥å³é­æå¡\n\nä¸»è¦çæä½æ­¥éª¤åèå¦ä¸ï¼\n\n//å®¢æ·ç«¯ç»å½æå¡ï¼æ³¨æï¼è¿ééè¿localhostç»å½ï¼å¦æéè¦è¿ç¨ç»å½ï¼å¿é¡»åç»å½è®¤è¯æè¡ã\nmongo --port 27017\n//#åæ¢å°adminåº\nuse admin\n//å³é­æå¡\ndb.shutdownServer()\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 3.2.2 æ·»å ç¨æ·åæé\n\nï¼1ï¼åæç§æ®éæ ææè®¤è¯çéç½®ï¼æ¥éç½®æå¡ç«¯çéç½®æä»¶ /mongodb/single/mongod.conf\n\nsystemLog:\n    #MongoDBåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/single/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logAppend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbPathè®¾ç½®ä»éç¨äºmongodã\n    dbPath: "/mongodb/single/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessManagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨IDçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶PID\n    pidFilePath: "/mongodb/single/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®çIP\n    bindIp: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27017\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nï¼2ï¼æä¹åæªå¼å¯è®¤è¯çæ¹å¼ï¼ä¸æ·»å  â auth åæ°ï¼æ¥å¯å¨MongoDBæå¡\n\n/usr/local/mongodb/bin/mongod -f /mongodb/single/mongod.conf\n\n\n1\n\n\næç¤ºï¼\n\nå¨æä½ç¨æ·æ¶ï¼å¯å¨mongodæå¡æ¶å°½éä¸è¦å¼å¯ææã\n\nï¼3ï¼ä½¿ç¨Mongoå®¢æ·ç«¯ç»å½\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017\n\n\n1\n\n\nï¼4ï¼åå»ºä¸¤ä¸ªç®¡çåç¨æ·ï¼ä¸ä¸ªæ¯ç³»ç»çè¶çº§ç®¡çå myroot ï¼ä¸ä¸ªæ¯adminåºçç®¡çç¨æ·myadmin\n\n//åæ¢å°adminåº\n> use admin\n\n//åå»ºç³»ç»è¶çº§ç¨æ· myroot,è®¾ç½®å¯ç 123456ï¼è®¾ç½®è§è²root\n//> db.createUser({user:"myroot",pwd:"123456",roles:[ { "role" : "root", "db" : "admin" } ]})\n//æ\n> db.createUser({user:"myroot",pwd:"123456",roles:["root"]})\n\n//åå»ºä¸é¨ç¨æ¥ç®¡çadminåºçè´¦å·myadminï¼åªç¨æ¥ä½ä¸ºç¨æ·æéçç®¡ç\n> db.createUser({user:"myadmin",pwd:"123456",roles: [{role:"userAdminAnyDatabase",db:"admin"}]})\n\n//æ¥çå·²ç»åå»ºäºçç¨æ·çæåµï¼\n> db.system.users.find()\n\n//å é¤ç¨æ·\n> db.dropUser("myadmin")\ntrue\n\n//ä¿®æ¹å¯ç \n> db.changeUserPassword("myroot", "123456")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\næç¤ºï¼\n\n * æ¬æ¡ä¾åå»ºäºä¸¤ä¸ªç¨æ·ï¼åå«å¯¹åºè¶ç®¡åä¸é¨ç¨æ¥ç®¡çç¨æ·çè§è²ï¼äºå®ä¸ï¼ä½ åªéè¦ä¸ä¸ªç¨æ·å³å¯ãå¦æä½ å¯¹å®å¨è¦æ±å¾é«ï¼é²æ­¢è¶ç®¡æ³æ¼ï¼åä¸è¦åå»ºè¶ç®¡ç¨æ·ã\n * åå¶å®æ°æ®åºï¼MySQLï¼ä¸æ ·ï¼æéçç®¡çé½å·®ä¸å¤ä¸æ ·ï¼ä¹æ¯å°ç¨æ·åæéä¿¡æ¯ä¿å­å°æ°æ®åºå¯¹åºçè¡¨ä¸­ãMongodbå­å¨ææçç¨æ·ä¿¡æ¯å¨admin æ°æ®åºçéåsystem.usersä¸­ï¼ä¿å­ç¨æ·åãå¯ç åæ°æ®åºä¿¡æ¯ã\n * å¦æä¸æå®æ°æ®åºï¼ååå»ºçæå®çæéçç¨æ·å¨ææçæ°æ®åºä¸ææï¼å¦ {role: âuserAdminAnyDatabaseâ, db:ââ}\n\nï¼5ï¼è®¤è¯æµè¯\n\næµè¯æ·»å çç¨æ·æ¯å¦æ­£ç¡®\n\n//åæ¢å°admin\n> use admin\n\n//å¯ç è¾é\n> db.auth("myroot","12345")\nError: Authentication failed.\n0\n\n//å¯ç æ­£ç¡®\n> db.auth("myroot","123456")\n1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nï¼6ï¼åå»ºæ®éç¨æ·\n\nåå»ºæ®éç¨æ·å¯ä»¥å¨æ²¡æå¼å¯è®¤è¯çæ¶åæ·»å ï¼ä¹å¯ä»¥å¨å¼å¯è®¤è¯ä¹åæ·»å ï¼ä½å¼å¯è®¤è¯ä¹åï¼å¿é¡»ä½¿ç¨ææä½adminåºçç¨æ·ç»å½è®¤è¯åæè½æä½ãåºå±é½æ¯å°ç¨æ·ä¿¡æ¯ä¿å­å¨äºadminæ°æ®åºçéåsystem.usersä¸­\n\n//åå»º(åæ¢)å°æ¥è¦æä½çæ°æ®åºarticledb,\n> use articledb\n\n//åå»ºç¨æ·ï¼æ¥æarticledbæ°æ®åºçè¯»åæéreadWriteï¼å¯ç æ¯123456\n> db.createUser({user: "bobo", pwd: "123456", roles: [{ role: "readWrite", db: "articledb" }]})\n//> db.createUser({user: "bobo", pwd: "123456", roles: ["readWrite"]})\n\n//æµè¯æ¯å¦å¯ç¨\n> db.auth("bobo","123456")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næç¤ºï¼\n\nå¦æå¼å¯äºè®¤è¯åï¼ç»å½çå®¢æ·ç«¯çç¨æ·å¿é¡»ä½¿ç¨adminåºçè§è²ï¼å¦æ¥ærootè§è²çmyadminç¨æ·ï¼åéè¿myadminç¨æ·å»åå»ºå¶ä»è§è²çç¨æ·\n\n\n# 3.2.3 æå¡ç«¯å¼å¯è®¤è¯åå®¢æ·ç«¯è¿æ¥ç»å½\n\n# 3.2.3.1 å³é­å·²ç»å¯å¨çæå¡\n\n1ï¼ä½¿ç¨linuxå½ä»¤ææ­»è¿ç¨ï¼\n\n[root@bobohost single]# ps -ef |grep mongo\nroot    23482    1  0 08:08 ?     00:00:55 /usr/local/mongodb/bin/mongod -f /mongodb/single/mongod.conf\n[root@bobohost single]# kill -2 23482\n\n\n1\n2\n3\n\n\n2 ï¼å¨mongoå®¢æ·ç«¯ä¸­ä½¿ç¨shutdownServerå½ä»¤æ¥å³é­\n\n> db.shutdownServer()\nshutdown command only works with the admin database; try \'use admin\'\n> use admin\nswitched to db admin\n> db.shutdownServer()\n2019-08-14T11:20:16.450+0800 E QUERY  [js] Error: shutdownServer failed: {\n    "ok" : 0,\n    "errmsg" : "shutdown must run from localhost when running db without auth",\n    "code" : 13,\n    "codeName" : "Unauthorized"\n    } :\n_getErrorWithCode@src/mongo/shell/utils.js:25:13\nDB.prototype.shutdownServer@src/mongo/shell/db.js:453:1\n@(shell):1:1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\néè¦å ä¸ªæ¡ä»¶ï¼\n\n * å¿é¡»æ¯å¨ adminåºä¸æ§è¡è¯¥å³é­æå¡å½ä»¤ã\n * å¦ææ²¡æå¼å¯è®¤è¯ï¼å¿é¡»æ¯ä» localhostç»éçï¼æè½æ§è¡å³é­æå¡å½ä»¤ã\n * é localhostçãéè¿è¿ç¨ç»å½çï¼å¿é¡»æç»å½ä¸å¿é¡»ç»å½ç¨æ·æå¯¹adminæä½æéæå¯ä»¥ã\n\n# 3.2.3.2 ä»¥å¼å¯è®¤è¯çæ¹å¼å¯å¨æå¡\n\næä¸¤ç§æ¹å¼å¼å¯æéè®¤è¯å¯å¨æå¡ï¼ä¸ç§æ¯åæ°æ¹å¼ï¼ä¸ç§æ¯éç½®æä»¶æ¹å¼\n\n1ï¼åæ°æ¹å¼\n\nå¨å¯å¨æ¶æå®åæ° â auth ï¼å¦ï¼\n\n/usr/local/mongodb/bin/mongod -f /mongodb/single/mongod.conf --auth\n\n\n1\n\n\n2ï¼éç½®æä»¶æ¹å¼\n\nå¨mongod.conféç½®æä»¶ä¸­å å¥ï¼vim /mongodb/single/mongod.conf\n\nsecurity:\n    #å¼å¯ææè®¤è¯\n    authorization: enabled\n\n\n1\n2\n3\n\n\nå¯å¨æ¶å¯ä¸å  â auth åæ°ï¼\n\n/usr/local/mongodb/bin/mongod -f /mongodb/single/mongod.conf\n\n\n1\n\n\n# 3.2.3.3 å¼å¯äºè®¤è¯çæåµä¸çå®¢æ·ç«¯ç»å½\n\næä¸¤ç§è®¤è¯æ¹å¼ï¼ä¸ç§æ¯åç»å½ï¼å¨mongo shellä¸­è®¤è¯ï¼ä¸ç§æ¯ç»å½æ¶ç´æ¥è®¤è¯\n\n1ï¼åè¿æ¥åè®¤è¯\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017\nMongoDB shell version v4.0.10\nconnecting to: mongodb://180.76.159.126:27017/?gssapiServiceName=mongodb\nImplicit session: session { "id" : UUID("53fef661-35d6-4d29-b07c-020291d62e1a")}\nMongoDB server version: 4.0.10\n>\n\n\n1\n2\n3\n4\n5\n6\n\n\næç¤ºï¼\n\nå¼å¯è®¤è¯ååç»å½ï¼åç°æå°çæ¥å¿æ¯è¾å°äºã\n\nç¸å³æä½éè¦è®¤è¯æå¯ä»¥ï¼\n\næ¥è¯¢adminåºä¸­çsystem.userséåçç¨æ·ï¼\n\n> use admin\nswitched to db admin\n> db.system.users.find()\nError: error: {\n    "ok" : 0,\n    "errmsg" : "command find requires authentication",\n    "code" : 13,\n    "codeName" : "Unauthorized"\n}\n> db.auth("myroot","123456")\n1\n> db.system.users.find()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥è¯¢articledbåºä¸­çcommentéåçåå®¹ï¼\n\n> use articledb\nswitched to db articledb\n> db.comment.find()\nError: error: {\n    "ok" : 0,\n    "errmsg" : "not authorized on articledb to execute command { find: \\"comment\\", filter: {}, lsid: { id: UUID(\\"53fef661-35d6-4d29-b07c-020291d62e1a\\") }, $db: \\"articledb\\" }",\n    "code" : 13,\n    "codeName" : "Unauthorized"\n}\n> db.auth("bobo","123456")\n1\n> db.comment.find()\nError: error: {\n    "ok" : 0,\n    "errmsg" : "too many users are authenticated",\n    "code" : 13,\n    "codeName" : "Unauthorized"\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næç¤ºï¼\n\nè¿éå¯è½åºç°éè¯¯ï¼è¯´æ¯å¤ªå¤çç¨æ·æ­£å¨è®¤è¯äºãå ä¸ºæä»¬ç¡®å®è¿ç»­ç»å½äºä¸¤ä¸ªç¨æ·äºã\n\nè§£å³æ¹æ¡ï¼éåºshellï¼éæ°è¿æ¥ç»å½è®¤è¯\n\n> exit\nbye\n[root@bobohost bin]# ./mongo --host 180.76.159.126 --port 27017\nMongoDB shell version v4.0.10\nconnecting to: mongodb://180.76.159.126:27017/?gssapiServiceName=mongodb\nImplicit session: session { "id" : UUID("329c1897-566d-4231-bcb3-b2acda301863")\n}\nMongoDB server version: 4.0.10\n> db.auth("bobo","123456")\nError: Authentication failed.\n0\n> use articledb\nswitched to db articledb\n> db.auth("bobo","123456")\n1\n> db.comment.find()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n2ï¼è¿æ¥æ¶ç´æ¥è®¤è¯\n\nå¯¹adminæ°æ®åºè¿è¡ç»å½è®¤è¯åç¸å³æä½ï¼\n\n[root@bobohost ~]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017 --authenticationDatabase admin -u myroot -p 123456\nMongoDB shell version v4.0.10\nconnecting to: mongodb://180.76.159.126:27017/?\nauthSource=admin&gssapiServiceName=mongodb\nImplicit session: session { "id" : UUID("f959b8d6-6994-44bc-9d35-09fc7cd00ba6")\n}\nMongoDB server version: 4.0.10\nServer has startup warnings:\n2019-09-10T15:23:40.102+0800 I CONTROL [initandlisten] ** WARNING: You are\nrunning this process as the root user, which is not recommended.\n2019-09-10T15:23:40.102+0800 I CONTROL [initandlisten]\n2019-09-10T15:23:40.102+0800 I CONTROL [initandlisten]\n2019-09-10T15:23:40.102+0800 I CONTROL [initandlisten] ** WARNING:\n/sys/kernel/mm/transparent_hugepage/enabled is \'always\'.\n2019-09-10T15:23:40.102+0800 I CONTROL [initandlisten] **    We suggest\nsetting it to \'never\'\n2019-09-10T15:23:40.102+0800 I CONTROL [initandlisten]\n2019-09-10T15:23:40.102+0800 I CONTROL [initandlisten] ** WARNING:\n/sys/kernel/mm/transparent_hugepage/defrag is \'always\'.\n2019-09-10T15:23:40.102+0800 I CONTROL [initandlisten] **    We suggest\nsetting it to \'never\'\n2019-09-10T15:23:40.102+0800 I CONTROL [initandlisten]\n> show dbs;\nadmin    0.000GB\narticledb  0.000GB\nconfig   0.000GB\nlocal    0.000GB\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\nå¯¹articledbæ°æ®åºè¿è¡ç»å½è®¤è¯åç¸å³æä½ï¼\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017 --authenticationDatabase articledb -u bobo -p 123456\nMongoDB shell version v4.0.10\nconnecting to: mongodb://180.76.159.126:27017/?\nauthSource=articledb&gssapiServiceName=mongodb\nImplicit session: session { "id" : UUID("e5d4148f-373b-45b8-9cff-a927ce617100")\n}\nMongoDB server version: 4.0.10\n> use articledb\nswitched to db articledb\n> db.comment.find()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næç¤ºï¼\n\n * -u ï¼ç¨æ·å\n * -p ï¼å¯ç \n * -- authenticationDatabase ï¼æå®è¿æ¥å°åªä¸ªåºãå½ç»å½æ¯æå®ç¨æ·åå¯ç æ¶ï¼å¿é¡»æå®å¯¹åºçæ°æ®åºï¼\n\n\n# 3.2.4 SpringDataMongoDBè¿æ¥è®¤è¯\n\nä½¿ç¨ç¨æ·ååå¯ç è¿æ¥å° MongoDB æå¡å¨ï¼ä½ å¿é¡»ä½¿ç¨\'username:password@hostname/dbname\' æ ¼å¼ï¼âusernameâä¸ºç¨æ·åï¼âpasswordâ ä¸ºå¯ç ã\n\nç®æ ï¼ä½¿ç¨ç¨æ·boboä½¿ç¨å¯ç  123456 è¿æ¥å°MongoDB æå¡ä¸ã\n\napplication.ymlï¼\n\nspring:\n    #æ°æ®æºéç½®\n    data:\n        mongodb:\n            # ä¸»æºå°å\n            #   host: 180.76.159.126\n            # æ°æ®åº\n            #   database: articledb\n            # é»è®¤ç«¯å£æ¯27017\n            #   port: 27017\n            #å¸å·\n            #   username: bobo\n            #å¯ç \n            #   password: 123456\n            #åæºæè®¤è¯çæåµä¸ï¼ä¹ä½¿ç¨å­ç¬¦ä¸²è¿æ¥\n            uri: mongodb://bobo:123456@180.76.159.126:27017/articledb\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# 3.3 å¯æ¬éç¯å¢\n\n\n# 3.3.1 åè¨\n\nå¯¹äºæ­å»ºå¥½çmongodbå¯æ¬éï¼ä¸ºäºå®å¨ï¼å¯å¨å®å¨è®¤è¯ï¼ä½¿ç¨è´¦å·å¯ç ç»å½ã\n\nå¯æ¬éç¯å¢ä½¿ç¨ä¹åæ­å»ºå¥½çï¼æ¶æå¦ä¸ï¼\n\n\n\nå¯¹å¯æ¬éæ§è¡è®¿é®æ§å¶éè¦éç½®ä¸¤ä¸ªæ¹é¢ :\n\n * å¯æ¬éåå±äº«éç¾¤çåä¸ªèç¹æåä¹é´ä½¿ç¨åé¨èº«ä»½éªè¯ï¼å¯ä»¥ä½¿ç¨å¯é¥æä»¶æx.509è¯ä¹¦ãå¯é¥æä»¶æ¯è¾ç®åï¼æ¬æä½¿ç¨å¯é¥æä»¶ï¼å®æ¹æ¨èå¦ææ¯æµè¯ç¯å¢å¯ä»¥ä½¿ç¨å¯é¥æä»¶ï¼ä½æ¯æ­£å¼ç¯å¢ï¼å®æ¹æ¨èx.509è¯ä¹¦ãåçå°±æ¯ï¼éç¾¤ä¸­æ¯ä¸ä¸ªå®ä¾å½¼æ­¤è¿æ¥çæ¶åé½æ£éªå½¼æ­¤ä½¿ç¨çè¯ä¹¦çåå®¹æ¯å¦ç¸åãåªæè¯ä¹¦ç¸åçå®ä¾å½¼æ­¤æå¯ä»¥è®¿é®\n * ä½¿ç¨å®¢æ·ç«¯è¿æ¥å°mongodbéç¾¤æ¶ï¼å¼å¯è®¿é®ææãå¯¹äºéç¾¤å¤é¨çè®¿é®ãå¦éè¿å¯è§åå®¢æ·ç«¯ï¼æèéè¿ä»£ç è¿æ¥çæ¶åï¼éè¦å¼å¯ææã\n\nå¨keyfileèº«ä»½éªè¯ä¸­ï¼å¯æ¬éä¸­çæ¯ä¸ªmongodå®ä¾é½ä½¿ç¨keyfileçåå®¹ä½ä¸ºå±äº«å¯ç ï¼åªæå·ææ­£ç¡®å¯é¥æä»¶çmongodæèmongoså®ä¾å¯ä»¥è¿æ¥å°å¯æ¬éãå¯é¥æä»¶çåå®¹å¿é¡»å¨6å°1024ä¸ªå­ç¬¦ä¹é´ï¼å¹¶ä¸å¨unix/linuxç³»ç»ä¸­æä»¶ææèå¿é¡»æå¯¹æä»¶è³å°æè¯»çæéã\n\n\n# 3.3.2 å³é­å·²å¼å¯çå¯æ¬éæå¡\n\nå¢å å¯æ¬éçå®å¨è®¤è¯åæå¡é´æåè½ï¼å¯ä»¥å¨å¯æ¬éæ­å»ºçæ¶åç´æ¥æ·»å ï¼ä¹å¯ä»¥å¨ä¹åæ­å»ºå¥½çå¯æ¬éæå¡ä¸æ·»å ã\n\næ¬æä½¿ç¨ä¹åæ­å»ºå¥½çå¯æ¬éæå¡ï¼å æ­¤ï¼ååæ­¢ä¹åçéç¾¤æå¡\n\nåæ­¢æå¡çæ¹å¼æä¸¤ç§ï¼å¿«éå³é­åæ åå³é­ï¼ä¸é¢ä¾æ¬¡è¯´æï¼\n\nï¼1ï¼å¿«éå³é­æ¹æ³ï¼å¿«éï¼ç®åï¼æ°æ®å¯è½ä¼åºéï¼\n\nç®æ ï¼éè¿ç³»ç»çkillå½ä»¤ç´æ¥ææ­»è¿ç¨ï¼\n\nä¾æ¬¡ææ­»ä»²è£èãå¯æ¬èç¹ãä¸»èç¹ï¼ç´å°æææåé½ç¦»çº¿ãå»ºè®®ä¸»èç¹æåkillï¼ä»¥é¿åæ½å¨çåæ»ãæå®è¦æ£æ¥ä¸ä¸ï¼é¿åæçæ²¡æææã\n\n#éè¿è¿ç¨ç¼å·å³é­èç¹\nkill -2 54410\n\n\n1\n2\n\n\nãè¡¥åã\n\nå¦æä¸æ¦æ¯å ä¸ºæ°æ®æåï¼åéè¦è¿è¡å¦ä¸æä½ï¼äºè§£ï¼ï¼\n\n1ï¼å é¤lockæä»¶ï¼\n\nrm -f /mongodb/replica_sets/myrs_27017/data/db/*.lock \\\n/mongodb/replica_sets/myrs_27018/data/db/*.lock \\\n/mongodb/replica_sets/myrs_27019/data/db/mongod.lock \\\n\n\n1\n2\n3\n\n\n2 ï¼ä¾æ¬¡ä¿®å¤æ°æ®ï¼\n\n/usr/local/mongodb/bin/mongod --repair --dbpath=/mongodb/replica_sets/myrs_27017/data/db\n/usr/local/mongodb/bin/mongod --repair --dbpath=/mongodb/replica_sets/myrs_27018/data/db\n/usr/local/mongodb/bin/mongod --repair --dbpath=/mongodb/replica_sets/myrs_27019/data/db\n\n\n1\n2\n3\n\n\nï¼2ï¼æ åçå³é­æ¹æ³ï¼æ°æ®ä¸å®¹æåºéï¼ä½éº»ç¦ï¼\n\nç®æ ï¼éè¿mongoå®¢æ·ç«¯ä¸­çshutdownServerå½ä»¤æ¥ä¾æ¬¡å³é­åä¸ªæå¡\n\nå³é­å¯æ¬éä¸­çæå¡ï¼å»ºè®®ä¾æ¬¡å³é­ä»²è£èç¹ãå¯æ¬èç¹ãä¸»èç¹ãä¸»è¦çæä½æ­¥éª¤åèå¦ä¸ï¼\n\n//å®¢æ·ç«¯ç»å½æå¡ï¼æ³¨æï¼è¿ééè¿localhostç»å½ï¼å¦æéè¦è¿ç¨ç»å½ï¼å¿é¡»åç»å½è®¤è¯æè¡ã\nmongo --port 27017\n//åç¥å¯æ¬éè¯´æ¬æºè¦ä¸çº¿\nrs.stepDown()\n//#åæ¢å°adminåº\nuse admin\n//å³é­æå¡\ndb.shutdownServer()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 3.3.3 éè¿ä¸»èç¹æ·»å ä¸ä¸ªç®¡çåå¸å·\n\nåªéè¦å¨ä¸»èç¹ä¸æ·»å ç¨æ·ï¼å¯æ¬éä¼èªå¨åæ­¥ã\n\nå¼å¯è®¤è¯ä¹åï¼åå»ºè¶ç®¡ç¨æ·ï¼myrootï¼å¯ç ï¼123456\n\nmyrs:PRIMARY> use admin\nswitched to db admin\nmyrs:PRIMARY> db.createUser({user:"myroot",pwd:"123456",roles:["root"]})\nSuccessfully added user: { "user" : "myroot", "roles" : [ "root" ] }\n\n\n1\n2\n3\n4\n\n\nè¯¥æ­¥éª¤ä¹å¯ä»¥å¨å¼å¯è®¤è¯ä¹åï¼ä½éè¦éè¿localhostç»å½æåè®¸æ·»å ç¨æ·ï¼ç¨æ·æ°æ®ä¹ä¼èªå¨åæ­¥å°å¯æ¬éã\n\nåç»­ååå»ºå¶ä»ç¨æ·ï¼é½å¯ä»¥ä½¿ç¨è¯¥è¶ç®¡ç¨æ·åå»ºã\n\n\n# 3.3.4 åå»ºå¯æ¬éè®¤è¯çkeyæä»¶\n\nç¬¬ä¸æ­¥ï¼çæä¸ä¸ªkeyæä»¶å°å½åæä»¶å¤¹ä¸­ã\n\nå¯ä»¥ä½¿ç¨ä»»ä½æ¹æ³çæå¯é¥æä»¶ãä¾å¦ï¼ä»¥ä¸æä½ä½¿ç¨opensslçæå¯ç æä»¶ï¼ç¶åä½¿ç¨chmodæ¥æ´æ¹æä»¶æéï¼ä»ä¸ºæä»¶ææèæä¾è¯»åæé\n\n[root@bobohost ~]# openssl rand -base64 90 -out ./mongo.keyfile\n[root@bobohost ~]# chmod 400 ./mongo.keyfile\n[root@bobohost ~]# ll mongo.keyfile\n-r--------. 1 root root 122 8æ  14 14:23 mongo.keyfile\n\n\n1\n2\n3\n4\n\n\næç¤ºï¼\n\nææå¯æ¬éèç¹é½å¿é¡»è¦ç¨åä¸ä»½keyfileï¼ä¸è¬æ¯å¨ä¸å°æºå¨ä¸çæï¼ç¶åæ·è´å°å¶ä»æºå¨ä¸ï¼ä¸å¿é¡»æè¯»çæéï¼å¦åå°æ¥ä¼æ¥éï¼ permissions on /mongodb/replica_sets/myrs_27017/mongo.keyfile are too open\n\nä¸å®è¦ä¿è¯å¯é¥æä»¶ä¸è´ï¼æä»¶ä½ç½®éä¾¿ãä½æ¯ä¸ºäºæ¹ä¾¿æ¥æ¾ï¼å»ºè®®æ¯å°æºå¨é½æ¾å°ä¸ä¸ªåºå®çä½ç½®ï¼é½æ¾å°åéç½®æä»¶ä¸èµ·çç®å½ä¸­ã\n\nè¿éå°è¯¥æä»¶åå«æ·è´å°å¤ä¸ªç®å½ä¸­ï¼\n\n[root@bobohost ~]# cp mongo.keyfile /mongodb/replica_sets/myrs_27017\n[root@bobohost ~]# cp mongo.keyfile /mongodb/replica_sets/myrs_27018\n[root@bobohost ~]# cp mongo.keyfile /mongodb/replica_sets/myrs_27019\n\n\n1\n2\n3\n\n\n\n# 3.3.5 ä¿®æ¹éç½®æä»¶æå®keyfile\n\nåå«ç¼è¾å ä¸ªæå¡çmongod.confæä»¶ï¼æ·»å ç¸å³åå®¹\n\n/mongodb/replica_sets/myrs_27017/mongod.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/replica_sets/myrs_27017/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/replica_sets/myrs_27018/mongod.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/replica_sets/myrs_27018/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/replica_sets/myrs_27019/mongod.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/replica_sets/myrs_27019/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n\n# 3.3.6 éæ°å¯å¨å¯æ¬é\n\nå¦æå¯æ¬éæ¯å¼å¯ç¶æï¼åååå«å³é­å³é­å¤æ¬éä¸­çæ¯ä¸ªmongodï¼ä»æ¬¡èç¹å¼å§ãç´å°å¯æ¬éçæææåé½ç¦»çº¿ï¼åæ¬ä»»ä½ä»²è£èãä¸»èç¹å¿é¡»æ¯æåä¸ä¸ªæåå³é­ä»¥é¿åæ½å¨çåæ»ã\n\n#éè¿è¿ç¨ç¼å·å³é­ä¸ä¸ªèç¹\nkill -2 54410 54361 54257\n\n\n1\n2\n\n\nåå«å¯å¨å¯æ¬éèç¹ï¼\n\n/usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27017/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27018/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27019/mongod.conf\n\n\n1\n2\n3\n\n\næ¥çè¿ç¨æåµï¼\n\n[root@bobohost replica_sets]# ps -ef |grep mongod\nroot    62425    1  5 14:43 ?     00:00:01 /usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27017/mongod.conf\nroot    62495    1  7 14:43 ?     00:00:01 /usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27018/mongod.conf\nroot    62567    1 11 14:43 ?     00:00:01 /usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27019/mongod.conf\n\n\n1\n2\n3\n4\n\n\n\n# 3.3.7 å¨ä¸»èç¹ä¸æ·»å æ®éè´¦å·\n\n#åç¨ç®¡çåè´¦å·ç»å½\n#åæ¢å°adminåº\nuse admin\n#ç®¡çåè´¦å·è®¤è¯\ndb.auth("myroot","123456")\n#åæ¢å°è¦è®¤è¯çåº\nuse articledb\n#æ·»å æ®éç¨æ·\ndb.createUser({user: "bobo", pwd: "123456", roles: ["readWrite"]})\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\néæ°è¿æ¥ï¼ä½¿ç¨æ®éç¨æ· boboéæ°ç»å½ï¼æ¥çæ°æ®ã\n\n\n# 3.3.8 SpringDataMongoDBè¿æ¥å¯æ¬é\n\nä½¿ç¨ç¨æ·ååå¯ç è¿æ¥å° MongoDB æå¡å¨ï¼ä½ å¿é¡»ä½¿ç¨\'username:password@hostname/dbname\' æ ¼å¼ï¼âusernameâä¸ºç¨æ·åï¼âpasswordâ ä¸ºå¯ç ã\n\nç®æ ï¼ä½¿ç¨ç¨æ·boboä½¿ç¨å¯ç  123456 è¿æ¥å°MongoDB æå¡ä¸ã\n\napplication.ymlï¼\n\nspring:\n    #æ°æ®æºéç½®\n    data:\n        mongodb:\n            #å¯æ¬éæè®¤è¯çæåµä¸ï¼å­ç¬¦ä¸²è¿æ¥\n            uri: mongodb://bobo:123456@180.76.159.126:27017,180.76.159.126:27018,180.76.159.126:27019/articledb?connect=replicaSet&slaveOk=true&replicaSet=myrs\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 3.4 åçéç¾¤ç¯å¢(æ©å±)\n\n\n# 3.4.1 å³é­å·²å¼å¯çéç¾¤æå¡\n\nåçéç¾¤ç¯å¢ä¸çå®å¨è®¤è¯åå¯æ¬éç¯å¢ä¸åºæ¬ä¸ä¸æ ·ã\n\nä½åçéç¾¤çæå¡å¨ç¯å¢åæ¶æè¾ä¸ºå¤æï¼å»ºè®®å¨æ­å»ºåçéç¾¤çæ¶åï¼ç´æ¥å å¥å®å¨è®¤è¯åæå¡å¨é´çé´æï¼å¦æä¹åææ°æ®ï¼å¯åå°ä¹åçæ°æ®å¤ä»½åºæ¥ï¼åè¿ååå»ã\n\næ¬æä½¿ç¨ä¹åæ­å»ºå¥½çéç¾¤æå¡ï¼å æ­¤ï¼ååæ­¢ä¹åçéç¾¤æå¡\n\nåæ­¢æå¡çæ¹å¼æä¸¤ç§ï¼å¿«éå³é­åæ åå³é­ï¼ä¸é¢ä¾æ¬¡è¯´æï¼\n\nï¼1ï¼å¿«éå³é­æ¹æ³ï¼å¿«éï¼ç®åï¼æ°æ®å¯è½ä¼åºéï¼\n\nç®æ ï¼éè¿ç³»ç»çkillå½ä»¤ç´æ¥ææ­»è¿ç¨ï¼\n\nä¾æ¬¡ææ­» mongosè·¯ç±ãéç½®å¯æ¬éæå¡ï¼åçå¯æ¬éæå¡ï¼ä»æ¬¡èç¹å¼å§ãç´å°æææåé½ç¦»çº¿ãå¯æ¬éæçæ¶åï¼å»ºè®®åæä»²è£èï¼åæå¯æ¬èç¹ï¼æåæ¯ä¸»èç¹ï¼ä»¥é¿åæ½å¨çåæ»ãæå®è¦æ£æ¥ä¸ä¸ï¼é¿åæçæ²¡æææã\n\n#éè¿è¿ç¨ç¼å·å³é­èç¹\nkill -2 54410\n\n\n1\n2\n\n\nãè¡¥åã\n\nå¦æä¸æ¦æ¯å ä¸ºæ°æ®æåï¼åéè¦è¿è¡å¦ä¸æä½ï¼äºè§£ï¼ï¼\n\n1ï¼å é¤lockæä»¶ï¼\n\nrm -f /mongodb/sharded_cluster/myshardrs01_27018/data/db/*.lock \\\n/mongodb/sharded_cluster/myshardrs01_27118/data/db/*.lock \\\n/mongodb/sharded_cluster/myshardrs01_27218/data/db/mongod.lock \\\n/mongodb/sharded_cluster/myshardrs02_27318/data/db/mongod.lock \\\n/mongodb/sharded_cluster/myshardrs02_27418/data/db/mongod.lock \\\n/mongodb/sharded_cluster/myshardrs02_27518/data/db/mongod.lock \\\n/mongodb/sharded_cluster/myconfigrs_27019/data/db/mongod.lock \\\n/mongodb/sharded_cluster/myconfigrs_27119/data/db/mongod.lock \\\n/mongodb/sharded_cluster/myconfigrs_27219/data/db/mongod.lock\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n2 ï¼ä¾æ¬¡ä¿®å¤æ°æ®ï¼\n\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myshardrs01_27018/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myshardrs01_27118/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myshardrs01_27218/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myshardrs02_27318/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myshardrs02_27418/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myshardrs02_27518/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myconfigrs_27019/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myconfigrs_27119/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myconfigrs_27219/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/mymongos_27017/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/mymongos_27117/data/db\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nï¼2ï¼æ åçå³é­æ¹æ³ï¼æ°æ®ä¸å®¹æåºéï¼ä½éº»ç¦ï¼ï¼\n\nç®æ ï¼éè¿mongoå®¢æ·ç«¯ä¸­çshutdownServerå½ä»¤æ¥ä¾æ¬¡å³é­åä¸ªæå¡\n\nå³é­åçæå¡å¨å¯æ¬éä¸­çæå¡ï¼å»ºè®®ä¾æ¬¡å³é­ä»²è£èç¹ãå¯æ¬èç¹ãä¸»èç¹ãä¸»è¦çæä½æ­¥éª¤åèå¦ä¸ï¼\n\n//å®¢æ·ç«¯ç»å½æå¡ï¼æ³¨æï¼è¿ééè¿localhostç»å½ï¼å¦æéè¦è¿ç¨ç»å½ï¼å¿é¡»åç»å½è®¤è¯æè¡ã\nmongo --port 27018\n//åç¥å¯æ¬éè¯´æ¬æºè¦ä¸çº¿\nrs.stepDown()\n//#åæ¢å°adminåº\nuse admin\n//å³é­æå¡\ndb.shutdownServer()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå³é­éç½®æå¡å¨å¯æ¬éçæå¡ï¼å»ºè®®ä¾æ¬¡å³é­å¯æ¬èç¹ãä¸»èç¹ãä¸»è¦çæä½æ­¥éª¤åèå¦ä¸ï¼\n\n//å®¢æ·ç«¯ç»å½æå¡ï¼æ³¨æï¼è¿ééè¿localhostç»å½ï¼å¦æéè¦è¿ç¨ç»å½ï¼å¿é¡»åç»å½è®¤è¯æè¡ã\nmongo --port 27019\n//åç¥å¯æ¬éè¯´æ¬æºè¦ä¸çº¿\nrs.stepDown()\n//#åæ¢å°adminåº\nuse admin\n//å³é­æå¡\ndb.shutdownServer()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå³é­è·¯ç±æå¡å¨çæå¡ï¼å»ºè®®ä¾æ¬¡å³é­ä¸¤ä¸ªè·¯ç±èç¹ãä¸»è¦çæä½æ­¥éª¤åèå¦ä¸ï¼\n\n//å®¢æ·ç«¯ç»å½æå¡ï¼æ³¨æï¼è¿ééè¿localhostç»å½ï¼å¦æéè¦è¿ç¨ç»å½ï¼å¿é¡»åç»å½è®¤è¯æè¡ã\nmongo --port 27017\n//åç¥å¯æ¬éè¯´æ¬æºè¦ä¸çº¿\nrs.stepDown()\n//#åæ¢å°adminåº\nuse admin\n//å³é­æå¡\ndb.shutdownServer()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 3.4.2 åå»ºå¯æ¬éè®¤è¯çkeyæä»¶\n\nç¬¬ä¸æ­¥ï¼çæä¸ä¸ªkeyæä»¶å°å½åæä»¶å¤¹ä¸­ã\n\nå¯ä»¥ä½¿ç¨ä»»ä½æ¹æ³çæå¯é¥æä»¶ãä¾å¦ï¼ä»¥ä¸æä½ä½¿ç¨opensslçæå¯ç æä»¶ï¼ç¶åä½¿ç¨chmodæ¥æ´æ¹æä»¶æéï¼ä»ä¸ºæä»¶ææèæä¾è¯»åæé\n\n[root@bobohost ~]# openssl rand -base64 90 -out ./mongo.keyfile\n[root@bobohost ~]# chmod 400 ./mongo.keyfile\n[root@bobohost ~]# ll mongo.keyfile\n-r--------. 1 root root 122 8æ  14 14:23 mongo.keyfile\n\n\n1\n2\n3\n4\n\n\næç¤ºï¼\n\nææå¯æ¬éèç¹é½å¿é¡»è¦ç¨åä¸ä»½keyfileï¼ä¸è¬æ¯å¨ä¸å°æºå¨ä¸çæï¼ç¶åæ·è´å°å¶ä»æºå¨ä¸ï¼ä¸å¿é¡» æè¯»çæéï¼å¦åå°æ¥ä¼æ¥éï¼ permissions on /mongodb/replica_sets/myrs_27017/mongo.keyfile are too open\n\nä¸å®è¦ä¿è¯å¯é¥æä»¶ä¸è´ï¼æä»¶ä½ç½®éä¾¿ãä½æ¯ä¸ºäºæ¹ä¾¿æ¥æ¾ï¼å»ºè®®æ¯å°æºå¨é½æ¾å°ä¸ä¸ªåºå®çä½ç½®ï¼é½æ¾å°åéç½®æä»¶ä¸èµ·çç®å½ä¸­ã\n\nè¿éå°è¯¥æä»¶åå«æ·è´å°å¤ä¸ªç®å½ä¸­ï¼\n\necho \'/mongodb/sharded_cluster/myshardrs01_27018/mongo.keyfile\n/mongodb/sharded_cluster/myshardrs01_27118/mongo.keyfile\n/mongodb/sharded_cluster/myshardrs01_27218/mongo.keyfile\n/mongodb/sharded_cluster/myshardrs02_27318/mongo.keyfile\n/mongodb/sharded_cluster/myshardrs02_27418/mongo.keyfile\n/mongodb/sharded_cluster/myshardrs02_27518/mongo.keyfile\n/mongodb/sharded_cluster/myconfigrs_27019/mongo.keyfile\n/mongodb/sharded_cluster/myconfigrs_27119/mongo.keyfile\n/mongodb/sharded_cluster/myconfigrs_27219/mongo.keyfile\n/mongodb/sharded_cluster/mymongos_27017/mongo.keyfile\n/mongodb/sharded_cluster/mymongos_27117/mongo.keyfile\' | xargs -n 1 cp -v /root/mongo.keyfile\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# 3.4.3 ä¿®æ¹éç½®æä»¶æå®keyfile\n\nåå«ç¼è¾å ä¸ªæå¡çmongod.confæä»¶ï¼æ·»å ç¸å³åå®¹ï¼\n\n/mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/sharded_cluster/myshardrs01_27018/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/sharded_cluster/myshardrs01_27118/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/sharded_cluster/myshardrs01_27218/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myshardrs02_27318/mongod.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/sharded_cluster/myshardrs02_27318/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myshardrs02_27418/mongod.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/sharded_cluster/myshardrs02_27418/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myshardrs02_27518/mongod.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/sharded_cluster/myshardrs02_27518/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myconfigrs_27019/mongod.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/sharded_cluster/myconfigrs_27019/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myconfigrs_27119/mongod.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/sharded_cluster/myconfigrs_27119/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myconfigrs_27219/mongod.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/sharded_cluster/myconfigrs_27219/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/mymongos_27017/mongos.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/sharded_cluster/mymongos_27017/mongo.keyfile\n\n\n1\n2\n3\n\n\n/mongodb/sharded_cluster/mymongos_27117/mongos.conf\n\nsecurity:\n    #KeyFileé´ææä»¶\n    keyFile: /mongodb/sharded_cluster/mymongos_27117/mongo.keyfile\n\n\n1\n2\n3\n\n\nmongos æ¯mongodå°äºauthorizationï¼enabledçéç½®ãåå æ¯ï¼å¯æ¬éå åççå®å¨è®¤è¯éè¦éç½®ä¸¤æ¹é¢çï¼å¯æ¬éåä¸ªèç¹ä¹é´ä½¿ç¨åé¨èº«ä»½éªè¯ï¼ç¨äºåé¨åä¸ªmongoå®ä¾çéä¿¡ï¼åªæç¸åkeyfileæè½ç¸äºè®¿é®ãæä»¥é½è¦å¼å¯ keyFile: /mongodb/sharded_cluster/mymongos_27117/mongo.keyfile ã\n\nç¶èå¯¹äºææçmongodï¼ææ¯çæ­£çä¿å­æ°æ®çåçãmongosåªåè·¯ç±ï¼ä¸ä¿å­æ°æ®ãæä»¥ææçmongodå¼å¯è®¿é®æ°æ®çææauthorization:enabledãè¿æ ·ç¨æ·åªæè´¦å·å¯ç æ­£ç¡®æè½è®¿é®å°æ°æ®ã\n\n\n# 3.4.4 éæ°å¯å¨èç¹\n\nå¿é¡»ä¾æ¬¡å¯å¨éç½®èç¹ãåçèç¹ãè·¯ç±èç¹ï¼\n\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27019/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27119/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27219/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27318/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27418/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27518/mongod.conf\n/usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27017/mongos.conf\n/usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27117/mongos.conf\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næ³¨æï¼\n\nè¿éæä¸ªéå¸¸ç¹å«çæåµï¼å°±æ¯å¯å¨é¡ºåºãåå¯å¨éç½®èç¹ï¼åå¯å¨åçèç¹ï¼æåå¯å¨è·¯ç±èç¹ã\n\nå¦æåå¯å¨åçèç¹ï¼ä¼å¡ä½ï¼æç¤ºï¼\n\nabout to fork child process, waiting until server is ready for connections\n\n\n1\n\n\nè¿ä¹è®¸æ¯ä¸ª bugãåå æªç¥ã\n\n\n# 3.3.5 åå»ºå¸å·åè®¤è¯\n\nå®¢æ·ç«¯mongoï¼éè¿localhostç»å½ä»»æä¸ä¸ªmongosè·¯ç±ï¼\n\n[root@bobohost db]# /usr/local/mongodb/bin/mongo --port 27017\n\n\n1\n\n\næç¤ºï¼ç¸å½äºä¸ä¸ªåé¨ï¼åªè½å¨ adminä¸æ·»å ç¨æ·ã\n\nåå»ºä¸ä¸ªç®¡çåå¸å·ï¼\n\nmongos> use admin\nswitched to db admin\nmongos>  db.createUser({user:"myroot",pwd:"123456",roles:["root"]})\nSuccessfully added user: { "user" : "myroot", "roles" : [ "root" ] }\n\n\n1\n2\n3\n4\n\n\næç¤ºï¼å¦æå¨å¼å¯è®¤è¯ä¹åå·²ç»åå»ºäºç®¡çåè´¦å·ï¼è¿éå¯ä»¥å¿½ç¥\n\nåå»ºä¸ä¸ªæ®éæéå¸å·ï¼\n\nmongos> use admin\nswitched to db admin\nmongos> db.auth("myroot","123456")\n1\nmongos> use articledb\nswitched to db articledb\nmongos> db.createUser({user: "bobo", pwd: "123456", roles: [{ role: "readWrite",db: "articledb" }]})\nSuccessfully added user: {\n    "user" : "bobo",\n    "roles" : [\n        {\n          "role" : "readWrite",\n          "db" : "articledb"\n        }\n    ]\n}\nmongos> db.auth("bobo","123456")\n1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næç¤ºï¼\n\néè¿mongosæ·»å çè´¦å·ä¿¡æ¯ï¼åªä¼ä¿å­å°éç½®èç¹çæå¡ä¸­ï¼å·ä½çæ°æ®èç¹ä¸ä¿å­è´¦å·ä¿¡æ¯ï¼å æ­¤ï¼åçä¸­çè´¦å·ä¿¡æ¯ä¸æ¶åå°åæ­¥é®é¢ã\n\nmongoå®¢æ·ç«¯ç»å½mongosè·¯ç±ï¼ç¨ç®¡çåå¸å·ç»å½å¯æ¥çåçæåµï¼\n\nmongos> use admin\nswitched to db admin\nmongos>  db.auth("myroot","123456")\n1\nmongos> sh.status()\n\n\n1\n2\n3\n4\n5\n\n\néåºè¿æ¥ï¼éæ°è¿æ¥æå¡ï¼ä½¿ç¨æ®éæéå¸å·è®¿é®æ°æ®ï¼\n\n[root@bobohost db]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017\nMongoDB shell version v4.0.10\nconnecting to: mongodb://180.76.159.126:27017/?gssapiServiceName=mongodb\nImplicit session: session { "id" : UUID("6f84fa91-2414-407e-b3ab-c0b7eedde825")\n}\nMongoDB server version: 4.0.10\nmongos> use articledb\nswitched to db articledb\nmongos> db.auth("bobo","123456")\n1\nmongos> show collections\ncomment\ncomment2\nmongos> db.comment.count()\n10001\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# 3.3.6 SpringDataMongoDBè¿æ¥è®¤è¯\n\nä½¿ç¨ç¨æ·ååå¯ç è¿æ¥å° MongoDB æå¡å¨ï¼ä½ å¿é¡»ä½¿ç¨\'username:password@hostname/dbname\' æ ¼å¼ï¼âusernameâä¸ºç¨æ·åï¼âpasswordâ ä¸ºå¯ç ã\n\nç®æ ï¼ä½¿ç¨ç¨æ·boboä½¿ç¨å¯ç  123456 è¿æ¥å°MongoDB æå¡ä¸ã\n\napplication.ymlï¼\n\nspring:\n    #æ°æ®æºéç½®\n    data:\n        mongodb:\n        # åçéç¾¤æè®¤è¯çæåµä¸ï¼å­ç¬¦ä¸²è¿æ¥\n            uri: mongodb://bobo:123456@180.76.159.126:27017,180.76.159.126:27117/articledb\n\n\n1\n2\n3\n4\n5\n6\n\n\nåæé¾æ¥ï¼https://wgy1993.gitee.io/archives/afe7047c.html',normalizedContent:'# replica sets\n\n\n# 1.1 ç®ä»\n\nmongodbä¸­çå¯æ¬éï¼replica setï¼æ¯ä¸ç»ç»´æ¤ç¸åæ°æ®éçmongodæå¡ã å¯æ¬éå¯æä¾åä½åé«å¯ç¨æ§ï¼æ¯ææçäº§é¨ç½²çåºç¡ã\n\nä¹å¯ä»¥è¯´ï¼å¯æ¬éç±»ä¼¼äºæèªå¨æéæ¢å¤åè½çä¸»ä»éç¾¤ãéä¿çè®²å°±æ¯ç¨å¤å°æºå¨è¿è¡åä¸æ°æ®çå¼æ­¥åæ­¥ï¼ä»èä½¿å¤å°æºå¨æ¥æåä¸æ°æ®çå¤ä¸ªå¯æ¬ï¼å¹¶ä¸å½ä¸»åºå½ææ¶å¨ä¸éè¦ç¨æ·å¹²é¢çæåµä¸èªå¨åæ¢å¶ä»å¤ä»½æå¡å¨åä¸»åºãèä¸è¿å¯ä»¥å©ç¨å¯æ¬æå¡å¨ååªè¯»æå¡å¨ï¼å®ç°è¯»ååç¦»ï¼æé«è´è½½ã\n\nï¼1ï¼åä½åæ°æ®å¯ç¨æ§\n\nå¤å¶æä¾åä½å¹¶æé«æ°æ®å¯ç¨æ§ã éè¿å¨ä¸åæ°æ®åºæå¡å¨ä¸æä¾å¤ä¸ªæ°æ®å¯æ¬ï¼å¤å¶å¯æä¾ä¸å®çº§å«çå®¹éåè½ï¼ä»¥é²æ­¢ä¸¢å¤±åä¸ªæ°æ®åºæå¡å¨ã\n\nå¨æäºæåµä¸ï¼å¤å¶å¯ä»¥æä¾å¢å çè¯»åæ§è½ï¼å ä¸ºå®¢æ·ç«¯å¯ä»¥å°è¯»åæä½åéå°ä¸åçæå¡ä¸ï¼ å¨ä¸åæ°æ®ä¸­å¿ç»´æ¤æ°æ®å¯æ¬å¯ä»¥å¢å åå¸å¼åºç¨ç¨åºçæ°æ®ä½ç½®åå¯ç¨æ§ã æ¨è¿å¯ä»¥ä¸ºä¸ç¨ç®çç»´æ¤å¶ä»å¯æ¬ï¼ä¾å¦ç¾é¾æ¢å¤ï¼æ¥åæå¤ä»½ã\n\nï¼2ï¼mongodbä¸­çå¤å¶\n\nå¯æ¬éæ¯ä¸ç»ç»´æ¤ç¸åæ°æ®éçmongodå®ä¾ã å¯æ¬éåå«å¤ä¸ªæ°æ®æ¿è½½èç¹åå¯éçä¸ä¸ªä»²è£èç¹ãå¨æ¿è½½æ°æ®çèç¹ä¸­ï¼ä¸ä¸ªä¸ä»ä¸ä¸ªæåè¢«è§ä¸ºä¸»èç¹ï¼èå¶ä»èç¹è¢«è§ä¸ºæ¬¡è¦ï¼ä»ï¼èç¹ã\n\nä¸»èç¹æ¥æ¶ææåæä½ã å¯æ¬éåªè½æä¸ä¸ªä¸»è¦è½å¤ç¡®è®¤å·æ{wï¼âmostâ}åå¥å³æ³¨çåå¥; è½ç¶å¨æäºæåµä¸ï¼å¦ä¸ä¸ªmongodå®ä¾å¯è½ææ¶è®¤ä¸ºèªå·±ä¹æ¯ä¸»è¦çãä¸»è¦è®°å½å¶æä½æ¥å¿ä¸­çæ°æ®éçæææ´æ¹ï¼å³oplogã\n\n\n\nè¾å©(å¯æ¬)èç¹å¤å¶ä¸»èç¹çoplogå¹¶å°æä½åºç¨äºå¶æ°æ®éï¼ä»¥ä½¿è¾å©èç¹çæ°æ®éåæ ä¸»èç¹çæ°æ®éã å¦æä¸»è¦äººåä¸å¨ï¼åç¬¦åæ¡ä»¶çä¸­å­¦å°ä¸¾è¡éä¸¾ä»¥éåºæ°çä¸»è¦äººåã\n\nï¼3ï¼ä¸»ä»å¤å¶åå¯æ¬éåºå«\n\nä¸»ä»éç¾¤åå¯æ¬éæå¤§çåºå«å°±æ¯å¯æ¬éæ²¡æåºå®çâä¸»èç¹âï¼æ´ä¸ªéç¾¤ä¼éåºä¸ä¸ªâä¸»èç¹âï¼å½å¶ææåï¼åå¨å©ä¸çä»èç¹ä¸­éä¸­å¶ä»èç¹ä¸ºâä¸»èç¹âï¼å¯æ¬éæ»æä¸ä¸ªæ´»è·ç¹(ä¸»ãprimary)åä¸ä¸ªæå¤ä¸ªå¤ä»½èç¹(ä»ãsecondary)ã\n\n\n# 1.2 å¯æ¬éçä¸ä¸ªè§è²\n\nå¯æ¬éæä¸¤ç§ç±»åä¸ç§è§è²\n\nä¸¤ç§ç±»åï¼\n\n * ä¸»èç¹ï¼ primaryï¼ç±»åï¼æ°æ®æä½çä¸»è¦è¿æ¥ç¹ï¼å¯è¯»åã\n * æ¬¡è¦ï¼è¾å©ãä»ï¼èç¹ï¼ secondariesï¼ç±»åï¼æ°æ®åä½å¤ä»½èç¹ï¼å¯ä»¥è¯»æéä¸¾ã\n\nä¸ç§è§è²ï¼\n\n * ä¸»è¦æåï¼primaryï¼ï¼ä¸»è¦æ¥æ¶ææåæä½ãå°±æ¯ä¸»èç¹ã\n * å¯æ¬æåï¼replicateï¼ï¼ä»ä¸»èç¹éè¿å¤å¶æä½ä»¥ç»´æ¤ç¸åçæ°æ®éï¼å³å¤ä»½æ°æ®ï¼ä¸å¯åæä½ï¼ä½å¯ä»¥è¯»æä½ï¼ä½éè¦éç½®ï¼ãæ¯é»è®¤çä¸ç§ä»èç¹ç±»åã\n * ä»²è£èï¼ arbiterï¼ï¼ä¸ä¿çä»»ä½æ°æ®çå¯æ¬ï¼åªå·ææç¥¨éä¸¾ä½ç¨ãå½ç¶ä¹å¯ä»¥å°ä»²è£æå¡å¨ç»´æ¤ä¸ºå¯æ¬éçä¸é¨åï¼å³å¯æ¬æååæ¶ä¹å¯ä»¥æ¯ä»²è£èãä¹æ¯ä¸ç§ä»èç¹ç±»åã\n\n\n\nå³äºä»²è£èçé¢å¤è¯´æï¼\n\næ¨å¯ä»¥å°é¢å¤çmongodå®ä¾æ·»å å°å¯æ¬éä½ä¸ºä»²è£èã ä»²è£èä¸ç»´æ¤æ°æ®éã ä»²è£èçç®çæ¯éè¿ååºå¶ä»å¯æ¬éæåçå¿è·³åéä¸¾è¯·æ±æ¥ç»´æ¤å¯æ¬éä¸­çä»²è£ã å ä¸ºå®ä»¬ä¸å­å¨æ°æ®éï¼æä»¥ä»²è£å¨å¯ä»¥æ¯æä¾å¯æ¬éä»²è£åè½çå¥½æ¹æ³ï¼å¶èµæºææ¬æ¯å·ææ°æ®éçå¨åè½å¯æ¬éæåæ´ä¾¿å®ã\n\nå¦ææ¨çå¯æ¬éå·æå¶æ°ä¸ªæåï¼è¯·æ·»å ä»²è£èä»¥è·å¾ä¸»è¦éä¸¾ä¸­çâå¤§å¤æ°âæç¥¨ã ä»²è£èä¸éè¦ä¸ç¨ç¡¬ä»¶ã\n\nä»²è£èå°æ°¸è¿æ¯ä»²è£èï¼èä¸»è¦äººåå¯è½ä¼éåºå¹¶æä¸ºæ¬¡è¦äººåï¼èæ¬¡è¦äººåå¯è½æä¸ºéä¸¾æé´çä¸»è¦äººåã\n\nå¦æä½ çå¯æ¬+ä¸»èç¹çä¸ªæ°æ¯å¶æ°ï¼å»ºè®®å ä¸ä¸ªä»²è£èï¼å½¢æå¥æ°ï¼å®¹ææ»¡è¶³å¤§å¤æ°çæç¥¨ã\n\nå¦æä½ çå¯æ¬+ä¸»èç¹çä¸ªæ°æ¯å¥æ°ï¼å¯ä»¥ä¸å ä»²è£èã\n\n\n# 1.3 å¯æ¬éæ¶æç®æ \n\nä¸ä¸»ä¸å¯æ¬ä¸ä»²è£\n\n\n\n\n# 1.4 å¯æ¬éçåå»º\n\n\n# 1.4.1 ç¬¬ä¸æ­¥ï¼åå»ºä¸»èç¹\n\nå»ºç«å­æ¾æ°æ®åæ¥å¿çç®å½\n\n#-----------myrs\n#ä¸»èç¹\nmkdir -p /mongodb/replica_sets/myrs_27017/log \\ &\nmkdir -p /mongodb/replica_sets/myrs_27017/data/db\n\n\n1\n2\n3\n4\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/replica_sets/myrs_27017/mongod.conf\n\n\n1\n\n\nmyrs_27017 ï¼\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/replica_sets/myrs_27017/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n    dbpath: "/mongodb/replica_sets/myrs_27017/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: "/mongodb/replica_sets/myrs_27017/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææipï¼æå¯ä½ç¨ï¼å¯æ¬éåå§åçæ¶åï¼èç¹åå­ä¼èªå¨è®¾ç½®ä¸ºæ¬å°ååï¼èä¸æ¯ip\n    #bindipall: true\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #bindip\n    #ç»å®çç«¯å£\n    port: 27017\nreplication:\n    #å¯æ¬éçåç§°\n    replsetname: myrs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nå¯å¨èç¹æå¡ï¼\n\n[root@bobohost replica_sets]# /usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27017/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 54257\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n\n\n\n# 1.4.2 ç¬¬äºæ­¥ï¼åå»ºå¯æ¬èç¹\n\nå»ºç«å­æ¾æ°æ®åæ¥å¿çç®å½\n\n#-----------myrs\n#å¯æ¬èç¹\nmkdir -p /mongodb/replica_sets/myrs_27018/log \\ &\nmkdir -p /mongodb/replica_sets/myrs_27018/data/db\n\n\n1\n2\n3\n4\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/replica_sets/myrs_27018/mongod.conf\n\n\n1\n\n\nmyrs_27018 ï¼\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/replica_sets/myrs_27018/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n    dbpath: "/mongodb/replica_sets/myrs_27018/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: "/mongodb/replica_sets/myrs_27018/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææipï¼æå¯ä½ç¨ï¼å¯æ¬éåå§åçæ¶åï¼èç¹åå­ä¼èªå¨è®¾ç½®ä¸ºæ¬å°ååï¼èä¸æ¯ip\n    #bindipall: true\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #bindip\n    #ç»å®çç«¯å£\n    port: 27018\nreplication:\n    #å¯æ¬éçåç§°\n    replsetname: myrs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nå¯å¨èç¹æå¡ï¼\n\n[root@bobohost replica_sets]# /usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27018/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 54361\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n\n\n\n# 1.4.3 ç¬¬ä¸æ­¥ï¼åå»ºä»²è£èç¹\n\nå»ºç«å­æ¾æ°æ®åæ¥å¿çç®å½\n\n#-----------myrs\n#ä»²è£èç¹\nmkdir -p /mongodb/replica_sets/myrs_27019/log \\ &\nmkdir -p /mongodb/replica_sets/myrs_27019/data/db\n\n\n1\n2\n3\n4\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/replica_sets/myrs_27019/mongod.conf\n\n\n1\n\n\nmyrs_27019 ï¼\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/replica_sets/myrs_27019/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n    dbpath: "/mongodb/replica_sets/myrs_27019/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: "/mongodb/replica_sets/myrs_27019/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææipï¼æå¯ä½ç¨ï¼å¯æ¬éåå§åçæ¶åï¼èç¹åå­ä¼èªå¨è®¾ç½®ä¸ºæ¬å°ååï¼èä¸æ¯ip\n    #bindipall: true\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #bindip\n    #ç»å®çç«¯å£\n    port: 27019\nreplication:\n    #å¯æ¬éçåç§°\n    replsetname: myrs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nå¯å¨èç¹æå¡ï¼\n\n[root@bobohost replica_sets]# /usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27019/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 54410\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n\n\n\n# 1.4.4 ç¬¬åæ­¥ï¼åå§åéç½®å¯æ¬éåä¸»èç¹\n\nä½¿ç¨å®¢æ·ç«¯å½ä»¤è¿æ¥ä»»æä¸ä¸ªèç¹ï¼ä½è¿éå°½éè¦è¿æ¥ä¸»èç¹(27017èç¹)ï¼\n\n/usr/local/mongodb/bin/mongo --host=180.76.159.126 --port=27017\n\n\n1\n\n\nç»æï¼è¿æ¥ä¸ä¹åï¼å¾å¤å½ä»¤æ æ³ä½¿ç¨ï¼ï¼æ¯å¦ show dbs ç­ï¼å¿é¡»åå§åå¯æ¬éæè¡\n\nåå¤åå§åæ°çå¯æ¬éï¼\n\nè¯­æ³ï¼\n\nrs.initiate(configuration)\n\n\n1\n\n\nãç¤ºä¾ã\n\nä½¿ç¨é»è®¤çéç½®æ¥åå§åå¯æ¬éï¼\n\nrs.initiate()\n\n\n1\n\n\næ§è¡ç»æï¼\n\n> rs.initiate()\n{\n    "info2" : "no configuration specified. using a default configuration for the set",\n    "me" : "180.76.159.126:27017",\n    "ok" : 1,\n    "operationtime" : timestamp(1565760476, 1),\n    "$clustertime" : {\n        "clustertime" : timestamp(1565760476, 1),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n        }\n    }\n}\nmyrs:secondary>\nmyrs:primary>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\næç¤ºï¼\n\n * âokâçå¼ä¸º1ï¼è¯´æåå»ºæåã\n * å½ä»¤è¡æç¤ºç¬¦åçååï¼åæäºä¸ä¸ªä»èç¹è§è²ï¼æ­¤æ¶é»è®¤ä¸è½è¯»åãç¨ç­çå»ï¼åè½¦ï¼åæä¸»èç¹ã\n\n\n# 1.4.5 ç¬¬äºæ­¥ï¼æ¥çå¯æ¬éçéç½®åå®¹\n\nè¿ååå«å½åå¯æ¬ééç½®çææ¡£ã\n\nè¯­æ³ï¼\n\nrs.conf(configuration)\n\n\n1\n\n\næç¤ºï¼\n\nrs.config() æ¯è¯¥æ¹æ³çå«åã\n\nconfigurationï¼å¯éï¼å¦ææ²¡æéç½®ï¼åä½¿ç¨é»è®¤ä¸»èç¹éç½®ã\n\nãç¤ºä¾ã\n\nå¨27017ä¸æ§è¡å¯æ¬éä¸­å½åèç¹çé»è®¤èç¹éç½®\n\nmyrs:primary> rs.conf()\n{\n    "_id" : "myrs",\n    "version" : 1,\n    "protocolversion" : numberlong(1),\n    "writeconcernmajorityjournaldefault" : true,\n    "members" : [\n        {\n            "_id" : 0,\n            "host" : "180.76.159.126:27017",\n            "arbiteronly" : false,\n            "buildindexes" : true,\n            "hidden" : false,\n            "priority" : 1,\n            "tags" : {\n\n            },\n            "slavedelay" : numberlong(0),\n            "votes" : 1\n        }\n    ],\n    "settings" : {\n        "chainingallowed" : true,\n        "heartbeatintervalmillis" : 2000,\n        "heartbeattimeoutsecs" : 10,\n        "electiontimeoutmillis" : 10000,\n        "catchuptimeoutmillis" : -1,\n        "catchuptakeoverdelaymillis" : 30000,\n        "getlasterrormodes" : {\n\n        },\n        "getlasterrordefaults" : {\n            "w" : 1,\n            "wtimeout" : 0\n        },\n        "replicasetid" : objectid("5d539bdcd6a308e600d126bb")\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n\n\nè¯´æï¼\n\n * "_id" : "myrs" ï¼å¯æ¬éçéç½®æ°æ®å­å¨çä¸»é®å¼ï¼é»è®¤å°±æ¯å¯æ¬éçåå­\n * "members" ï¼å¯æ¬éæåæ°ç»ï¼æ­¤æ¶åªæä¸ä¸ªï¼ âhostâ : â180.76.159.126:27017â ï¼è¯¥æåä¸æ¯ä»²è£èç¹ï¼âarbiteronlyâ : false ï¼ä¼åçº§ï¼æéå¼ï¼ï¼ âpriorityâ : 1,\n * "settings" ï¼å¯æ¬éçåæ°éç½®ã\n\næç¤ºï¼å¯æ¬ééç½®çæ¥çå½ä»¤ï¼æ¬è´¨æ¯æ¥è¯¢çæ¯ system.replset çè¡¨ä¸­çæ°æ®ï¼\n\nmyrs:primary> use local\nswitched to db local\nmyrs:primary> show collections\noplog.rs\nreplset.election\nreplset.minvalid\nreplset.oplogtruncateafterpoint\nstartup_log\nsystem.replset\nsystem.rollback.id\nmyrs:primary> db.system.replset.find()\n{ "_id" : "myrs", "version" : 1, "protocolversion" : numberlong(1),\n"writeconcernmajorityjournaldefault" : true, "members" : [ { "_id" : 0, "host" :\n"180.76.159.126:27017", "arbiteronly" : false, "buildindexes" : true, "hidden" :\nfalse, "priority" : 1, "tags" : { }, "slavedelay" : numberlong(0), "votes" : 1\n} ], "settings" : { "chainingallowed" : true, "heartbeatintervalmillis" : 2000,\n"heartbeattimeoutsecs" : 10, "electiontimeoutmillis" : 10000,\n"catchuptimeoutmillis" : -1, "catchuptakeoverdelaymillis" : 30000,\n"getlasterrormodes" : { }, "getlasterrordefaults" : { "w" : 1, "wtimeout" : 0\n}, "replicasetid" : objectid("5d539bdcd6a308e600d126bb") } }\nmyrs:primary>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n\n# 1.4.6 ç¬¬å­æ­¥ï¼æ¥çå¯æ¬éç¶æ\n\næ£æ¥å¯æ¬éç¶æã\n\nè¯´æï¼\n\nè¿ååå«ç¶æä¿¡æ¯çææ¡£ãæ­¤è¾åºä½¿ç¨ä»å¯æ¬éçå¶ä»æååéçå¿è·³åä¸­è·å¾çæ°æ®åæ å¯æ¬éçå½åç¶æã\n\nè¯­æ³ï¼\n\nrs.status()\n\n\n1\n\n\nãç¤ºä¾ã\n\nå¨27017ä¸æ¥çå¯æ¬éç¶æï¼\n\nmyrs:primary> rs.status()\n{\n    "set" : "myrs",\n    "date" : isodate("2019-08-14t05:29:45.161z"),\n    "mystate" : 1,\n    "term" : numberlong(1),\n    "syncingto" : "",\n    "syncsourcehost" : "",\n    "syncsourceid" : -1,\n    "heartbeatintervalmillis" : numberlong(2000),\n    "optimes" : {\n        "lastcommittedoptime" : {\n            "ts" : timestamp(1565760578, 1),\n            "t" : numberlong(1)\n        },\n        "readconcernmajorityoptime" : {\n            "ts" : timestamp(1565760578, 1),\n            "t" : numberlong(1)\n        },\n        "appliedoptime" : {\n            "ts" : timestamp(1565760578, 1),\n            "t" : numberlong(1)\n        },\n        "durableoptime" : {\n            "ts" : timestamp(1565760578, 1),\n            "t" : numberlong(1)\n        }\n    },\n    "laststablecheckpointtimestamp" : timestamp(1565760528, 1),\n    "members" : [\n        {\n        "_id" : 0,\n        "name" : "180.76.159.126:27017",\n        "health" : 1,\n        "state" : 1,\n        "statestr" : "primary",\n        "uptime" : 419,\n        "optime" : {\n            "ts" : timestamp(1565760578, 1),\n            "t" : numberlong(1)\n        },\n        "optimedate" : isodate("2019-08-14t05:29:38z"),\n        "syncingto" : "",\n        "syncsourcehost" : "",\n        "syncsourceid" : -1,\n        "infomessage" : "could not find member to sync from",\n        "electiontime" : timestamp(1565760476, 2),\n        "electiondate" : isodate("2019-08-14t05:27:56z"),\n        "configversion" : 1,\n        "self" : true,\n        "lastheartbeatmessage" : ""\n        }\n    ],\n    "ok" : 1,\n    "operationtime" : timestamp(1565760578, 1),\n    "$clustertime" : {\n        "clustertime" : timestamp(1565760578, 1),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n\n\nè¯´æï¼\n\n * "set" : "myrs" ï¼å¯æ¬éçåå­\n * "mystate" : 1ï¼è¯´æç¶ææ­£å¸¸\n * "members" ï¼å¯æ¬éæåæ°ç»ï¼æ­¤æ¶åªæä¸ä¸ªï¼ "name" : "180.76.159.126:27017" ï¼è¯¥æåçè§è²æ¯ "statestr" : "primary", è¯¥èç¹æ¯å¥åº·çï¼ "health" : 1 ã\n\n\n# 1.4.7 ç¬¬ä¸æ­¥ï¼æ·»å å¯æ¬ä»èç¹\n\nå¨ä¸»èç¹æ·»å ä»èç¹ï¼å°å¶ä»æåå å¥å°å¯æ¬é\n\nè¯­æ³ï¼\n\nrs.add(host, arbiteronly)\n\n\n1\n\n\néé¡¹ï¼\n\nparameter     type                 description\nhost          string or document   è¦æ·»å å°å¯æ¬éçæ°æåã\n                                   æå®ä¸ºå­ç¬¦ä¸²æéç½®ææ¡£ï¼1ï¼å¦ææ¯ä¸ä¸ªå­ç¬¦ä¸²ï¼åéè¦æå®æ°æåçä¸»æºååå¯éçç«¯å£å·ï¼2ï¼å¦ææ¯ä¸ä¸ªææ¡£ï¼è¯·æå®å¨membersæ°ç»ä¸­æ¾å°çå¯æ¬éæåéç½®ææ¡£ã\n                                   æ¨å¿é¡»å¨æåéç½®ææ¡£ä¸­æå®ä¸»æºå­æ®µãæå³ææ¡£éç½®å­æ®µçè¯´æï¼è¯¦è§ä¸æ¹ææ¡£ï¼âä¸»æºæåçéç½®ææ¡£â\narbiteronly   boolean              å¯éçã ä»å¨ å¼ä¸ºå­ç¬¦ä¸²æ¶éç¨ã å¦æä¸ºtrueï¼åæ·»å çä¸»æºæ¯ä»²è£èã\n\nä¸»æºæåçéç½®ææ¡£ï¼\n\n{\n    _id: <int>,\n    host: <string>,     // required\n    arbiteronly: <boolean>,\n    buildindexes: <boolean>,\n    hidden: <boolean>,\n    priority: <number>,\n    tags: <document>,\n    slavedelay: <int>,\n    votes: <number>\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nãç¤ºä¾ã\n\nå°27018çå¯æ¬èç¹æ·»å å°å¯æ¬éä¸­ï¼\n\nmyrs:primary> rs.add("180.76.159.126:27018")\n{\n    "ok" : 1,\n    "operationtime" : timestamp(1565761757, 1),\n    "$clustertime" : {\n        "clustertime" : timestamp(1565761757, 1),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nè¯´æï¼\n\n * âokâ : 1 ï¼è¯´ææ·»å æåã\n\næ¥çå¯æ¬éç¶æï¼\n\nmyrs:primary> rs.status()\n{\n    "set" : "myrs",\n    "date" : isodate("2019-08-14t05:50:05.738z"),\n    "mystate" : 1,\n    "term" : numberlong(1),\n    "syncingto" : "",\n    "syncsourcehost" : "",\n    "syncsourceid" : -1,\n    "heartbeatintervalmillis" : numberlong(2000),\n    "optimes" : {\n        "lastcommittedoptime" : {\n            "ts" : timestamp(1565761798, 1),\n            "t" : numberlong(1)\n        },\n        "readconcernmajorityoptime" : {\n            "ts" : timestamp(1565761798, 1),\n            "t" : numberlong(1)\n        },\n        "appliedoptime" : {\n            "ts" : timestamp(1565761798, 1),\n            "t" : numberlong(1)\n        },\n        "durableoptime" : {\n            "ts" : timestamp(1565761798, 1),\n            "t" : numberlong(1)\n        }\n    },\n    "laststablecheckpointtimestamp" : timestamp(1565761798, 1),\n    "members" : [\n        {\n            "_id" : 0,\n            "name" : "180.76.159.126:27017",\n            "health" : 1,\n            "state" : 1,\n            "statestr" : "primary",\n            "uptime" : 1639,\n            "optime" : {\n                "ts" : timestamp(1565761798, 1),\n                "t" : numberlong(1)\n            },\n            "optimedate" : isodate("2019-08-14t05:49:58z"),\n            "syncingto" : "",\n            "syncsourcehost" : "",\n            "syncsourceid" : -1,\n            "infomessage" : "",\n            "electiontime" : timestamp(1565760476, 2),\n            "electiondate" : isodate("2019-08-14t05:27:56z"),\n            "configversion" : 2,\n            "self" : true,\n            "lastheartbeatmessage" : ""\n        },\n        {\n            "_id" : 1,\n            "name" : "180.76.159.126:27018",\n            "health" : 1,\n            "state" : 2,\n            "statestr" : "secondary",\n            "uptime" : 48,\n            "optime" : {\n                "ts" : timestamp(1565761798, 1),\n                "t" : numberlong(1)\n            },\n            "optimedurable" : {\n                "ts" : timestamp(1565761798, 1),\n                "t" : numberlong(1)\n            },\n            "optimedate" : isodate("2019-08-14t05:49:58z"),\n            "optimedurabledate" : isodate("2019-08-14t05:49:58z"),\n            "lastheartbeat" : isodate("2019-08-14t05:50:05.294z"),\n            "lastheartbeatrecv" : isodate("2019-08-\n            14t05:50:05.476z"),\n            "pingms" : numberlong(0),\n            "lastheartbeatmessage" : "",\n            "syncingto" : "180.76.159.126:27017",\n            "syncsourcehost" : "180.76.159.126:27017",\n            "syncsourceid" : 0,\n            "infomessage" : "",\n            "configversion" : 2\n        }\n    ],\n    "ok" : 1,\n    "operationtime" : timestamp(1565761798, 1),\n    "$clustertime" : {\n        "clustertime" : timestamp(1565761798, 1),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n\n\nè¯´æï¼\n\n * "name" : "180.76.159.126:27018" æ¯ç¬¬äºä¸ªèç¹çåå­ï¼å¶è§è²æ¯ "statestr" : "secondary"\n\n\n# 1.4.8 ç¬¬å«æ­¥ï¼æ·»å ä»²è£ä»èç¹\n\næ·»å ä¸ä¸ªä»²è£èç¹å°å¯æ¬é\n\nè¯­æ³ï¼\n\nrs.addarb(host)\n\n\n1\n\n\nå°27019çä»²è£èç¹æ·»å å°å¯æ¬éä¸­ï¼\n\nmyrs:primary> rs.addarb("180.76.159.126:27019")\n{\n    "ok" : 1,\n    "operationtime" : timestamp(1565761959, 1),\n    "$clustertime" : {\n        "clustertime" : timestamp(1565761959, 1),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nè¯´æï¼\n\n * "ok" : 1 ï¼è¯´ææ·»å æåã\n\næ¥çå¯æ¬éç¶æï¼\n\nmyrs:primary> rs.status()\n{\n    "set" : "myrs",\n    "date" : isodate("2019-08-14t05:53:27.198z"),\n    "mystate" : 1,\n    "term" : numberlong(1),\n    "syncingto" : "",\n    "syncsourcehost" : "",\n    "syncsourceid" : -1,\n    "heartbeatintervalmillis" : numberlong(2000),\n    "optimes" : {\n        "lastcommittedoptime" : {\n            "ts" : timestamp(1565761998, 1),\n            "t" : numberlong(1)\n        },\n        "readconcernmajorityoptime" : {\n            "ts" : timestamp(1565761998, 1),\n            "t" : numberlong(1)\n        },\n        "appliedoptime" : {\n            "ts" : timestamp(1565761998, 1),\n            "t" : numberlong(1)\n        },\n        "durableoptime" : {\n            "ts" : timestamp(1565761998, 1),\n            "t" : numberlong(1)\n        }\n    },\n    "laststablecheckpointtimestamp" : timestamp(1565761978, 1),\n    "members" : [\n        {\n            "_id" : 0,\n            "name" : "180.76.159.126:27017",\n            "health" : 1,\n            "state" : 1,\n            "statestr" : "primary",\n            "uptime" : 1841,\n            "optime" : {\n                "ts" : timestamp(1565761998, 1),\n                "t" : numberlong(1)\n            },\n            "optimedate" : isodate("2019-08-14t05:53:18z"),\n            "syncingto" : "",\n            "syncsourcehost" : "",\n            "syncsourceid" : -1,\n            "infomessage" : "",\n            "electiontime" : timestamp(1565760476, 2),\n            "electiondate" : isodate("2019-08-14t05:27:56z"),\n            "configversion" : 3,\n            "self" : true,\n            "lastheartbeatmessage" : ""\n        },\n        {\n            "_id" : 1,\n            "name" : "180.76.159.126:27018",\n            "health" : 1,\n            "state" : 2,\n            "statestr" : "secondary",\n            "uptime" : 249,\n            "optime" : {\n                "ts" : timestamp(1565761998, 1),\n                "t" : numberlong(1)\n            },\n            "optimedurable" : {\n                "ts" : timestamp(1565761998, 1),\n                "t" : numberlong(1)\n            },\n            "optimedate" : isodate("2019-08-14t05:53:18z"),\n            "optimedurabledate" : isodate("2019-08-14t05:53:18z"),\n            "lastheartbeat" : isodate("2019-08-14t05:53:25.668z"),\n            "lastheartbeatrecv" : isodate("2019-08-14t05:53:26.702z"),\n            "pingms" : numberlong(0),\n            "lastheartbeatmessage" : "",\n            "syncingto" : "180.76.159.126:27017",\n            "syncsourcehost" : "180.76.159.126:27017",\n            "syncsourceid" : 0,\n            "infomessage" : "",\n            "configversion" : 3\n        },\n        {\n            "_id" : 2,\n            "name" : "180.76.159.126:27019",\n            "health" : 1,\n            "state" : 7,\n            "statestr" : "arbiter",\n            "uptime" : 47,\n            "lastheartbeat" : isodate("2019-08-14t05:53:25.668z"),\n            "lastheartbeatrecv" : isodate("2019-08-14t05:53:25.685z"),\n            "pingms" : numberlong(0),\n            "lastheartbeatmessage" : "",\n            "syncingto" : "",\n            "syncsourcehost" : "",\n            "syncsourceid" : -1,\n            "infomessage" : "",\n            "configversion" : 3\n        }\n    ],\n    "ok" : 1,\n    "operationtime" : timestamp(1565761998, 1),\n    "$clustertime" : {\n        "clustertime" : timestamp(1565761998, 1),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n\n\nè¯´æï¼\n\n * "name" : "180.76.159.126:27019" æ¯ç¬¬äºä¸ªèç¹çåå­ï¼å¶è§è²æ¯ "statestr" : "arbiter"\n\n\n# 1.5 å¯æ¬éçæ°æ®è¯»åæä½\n\nç®æ ï¼æµè¯ä¸ä¸ªä¸åè§è²çèç¹çæ°æ®è¯»åæåµ\n\nç»å½ä¸»èç¹27017ï¼åå¥åè¯»åæ°æ®ï¼\n\n[root@bobohost ~]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017\nmyrs:primary> use articledb\nswitched to db articledb\nmyrs:primary> db\narticledb\nmyrs:primary> db.comment.insert({"articleid":"100000","content":"ä»å¤©å¤©æ°çå¥½ï¼é³åæåª","userid":"1001","nickname":"rose","createdatetime":new date()})\nwriteresult({ "ninserted" : 1 })\nmyrs:primary> db.comment.find()\n{ "_id" : objectid("5d4d2ae3068138b4570f53bf"), "articleid" : "100000","content" : "ä»å¤©å¤©æ°çå¥½ï¼é³åæåª", "userid" : "1001", "nickname" : "rose","createdatetime" : isodate("2019-08-09t08:12:19.427z") }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nç»å½ä»èç¹27018\n\n[root@bobohost ~]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27018\nmyrs:secondary> show dbs;\n2019-09-10t10:56:51.953+0800 e query  [js] error: listdatabases failed:{\n    "operationtime" : timestamp(1568084204, 1),\n    "ok" : 0,\n    "errmsg" : "not master and slaveok=false",\n    "code" : 13435,\n    "codename" : "notmasternoslaveok",\n    "$clustertime" : {\n        "clustertime" : timestamp(1568084204, 1),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n       }\n   }\n} :\n_geterrorwithcode@src/mongo/shell/utils.js:25:13\nmongo.prototype.getdbs@src/mongo/shell/mongo.js:139:1\nshellhelper.show@src/mongo/shell/utils.js:882:13\nshellhelper@src/mongo/shell/utils.js:766:15\n@(shellhelp2):1:1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\nåç°ï¼ä¸è½è¯»åéåçæ°æ®ãå½åä»èç¹åªæ¯ä¸ä¸ªå¤ä»½ï¼ä¸æ¯å¥´é¶èç¹ï¼æ æ³è¯»åæ°æ®ï¼åå½ç¶æ´ä¸è¡ã\n\nå ä¸ºé»è®¤æåµä¸ï¼ä»èç¹æ¯æ²¡æè¯»åæéçï¼å¯ä»¥å¢å è¯»çæéï¼ä½éè¦è¿è¡è®¾ç½®\n\nè®¾ç½®è¯»æä½æéï¼\n\nè¯´æï¼\n\nè®¾ç½®ä¸ºå¥´é¶èç¹ï¼åè®¸å¨ä»æåä¸è¿è¡è¯»çæä½\n\nè¯­æ³ï¼\n\nrs.slaveok()\n#æ\nrs.slaveok(true)\n\n\n1\n2\n3\n\n\næç¤ºï¼\n\nè¯¥å½ä»¤æ¯ db.getmongo().setslaveok() çç®åå½ä»¤ã\n\nãç¤ºä¾ã\n\nå¨27018ä¸è®¾ç½®ä½ä¸ºå¥´é¶èç¹æéï¼å·å¤è¯»æéï¼\n\nrs:secondary> rs.slaveok()\n\n\n1\n\n\næ­¤æ¶ï¼å¨æ§è¡æ¥è¯¢å½ä»¤ï¼è¿è¡æåï¼\n\nä½ä»ç¶ä¸åè®¸æå¥ã\n\nmyrs:secondary> rs.slaveok()\nmyrs:secondary> show dbs;\nadmin    0.000gb\narticledb  0.000gb\nconfig   0.000gb\nlocal    0.000gb\nmyrs:secondary> use articledb\nswitched to db articledb\nmyrs:secondary> show collections\ncomment\nmyrs:secondary> db.comment.find()\n{ "_id" : objectid("5d7710c04cfd7eee2e3cdabe"), "articleid" : "100000","content" : "ä»å¤©å¤©æ°çå¥½ï¼é³åæåª", "userid" : "1001", "nickname" : "rose","createdatetime" : isodate("2019-09-10t02:56:00.467z") }\nmyrs:secondary> db.comment.insert({"_id":"1","articleid":"100001","content":"æä»¬ä¸åºè¯¥ææ¸æ¨æµªè´¹å¨ææºä¸ï¼å¥åº·å¾éè¦ï¼kä¸æ¯æ¸©æ°´å¹¸ç¦ä½ æä»ã","userid":"1002","nickname":"ç¸å¿äºæ±æ¹","createdatetime":new date("2019-08-05t22:08:15.522z"),"likenum":numberint(1000),"state":"1"})\nwritecommanderror({\n    "operationtime" : timestamp(1568084434, 1),\n    "ok" : 0,\n    "errmsg" : "not master",\n    "code" : 10107,\n    "codename" : "notmaster",\n    "$clustertime" : {\n        "clustertime" : timestamp(1568084434, 1),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n        }\n    }\n})\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\nç°å¨å¯å®ç°äºè¯»ååç¦»ï¼è®©ä¸»æå¥æ°æ®ï¼è®©ä»æ¥è¯»åæ°æ®ã\n\nå¦æè¦åæ¶ä½ä¸ºå¥´é¶èç¹çè¯»æéï¼\n\nmyrs:secondary> rs.slaveok(false)\nmyrs:secondary> db.comment.find()\nerror: error: {\n    "operationtime" : timestamp(1568084459, 1),\n    "ok" : 0,\n    "errmsg" : "not master and slaveok=false",\n    "code" : 13435,\n    "codename" : "notmasternoslaveok",\n    "$clustertime" : {\n        "clustertime" : timestamp(1568084459, 1),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\nä»²è£èèç¹ï¼ä¸å­æ¾ä»»ä½ä¸å¡æ°æ®çï¼å¯ä»¥ç»å½æ¥ç\n\n[root@bobohost ~]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27019\nmyrs:arbiter> rs.slaveok()\nmyrs:arbiter> show dbs\nlocal  0.000gb\nmyrs:arbiter> use local\nswitched to db local\nmyrs:arbiter> show collections\nreplset.minvalid\nreplset.oplogtruncateafterpoint\nstartup_log\nsystem.replset\nsystem.rollback.id\nmyrs:arbiter>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nåç°ï¼åªå­æ¾å¯æ¬ééç½®ç­æ°æ®ã\n\n\n# 1.6 ä¸»èç¹çéä¸¾åå\n\nmongodbå¨å¯æ¬éä¸­ï¼ä¼èªå¨è¿è¡ä¸»èç¹çéä¸¾ï¼ä¸»èç¹éä¸¾çè§¦åæ¡ä»¶ï¼\n\n * ä¸»èç¹æé\n * ä¸»èç¹ç½ç»ä¸å¯è¾¾ï¼é»è®¤å¿è·³ä¿¡æ¯ä¸º10ç§ï¼\n * äººå·¥å¹²é¢ï¼rs.stepdown(600)ï¼\n\nä¸æ¦è§¦åéä¸¾ï¼å°±è¦æ ¹æ®ä¸å®è§åæ¥éä¸»èç¹ã\n\néä¸¾è§åæ¯æ ¹æ®ç¥¨æ°æ¥å³å®è°è·èï¼\n\n * ç¥¨æ°æé«ï¼ä¸è·å¾äº âå¤§å¤æ°âæåçæç¥¨æ¯æçèç¹è·èã\n   \n   âå¤§å¤æ°âçå®ä¹ä¸ºï¼åè®¾å¤å¶éåæç¥¨æåæ°éä¸ºnï¼åå¤§å¤æ°ä¸º n/2 + 1ãä¾å¦ï¼3ä¸ªæç¥¨æåï¼åå¤§å¤æ°çå¼æ¯2ãå½å¤å¶éåå­æ´»æåæ°éä¸è¶³å¤§å¤æ°æ¶ï¼æ´ä¸ªå¤å¶éå°æ æ³éä¸¾åºprimaryï¼å¤å¶éå°æ æ³æä¾åæå¡ï¼å¤äºåªè¯»ç¶æã\n\n * è¥ç¥¨æ°ç¸åï¼ä¸é½è·å¾äº âå¤§å¤æ°âæåçæç¥¨æ¯æçï¼æ°æ®æ°çèç¹è·èã\n   \n   æ°æ®çæ°æ§æ¯éè¿æä½æ¥å¿oplogæ¥å¯¹æ¯çã\n\nå¨è·å¾ç¥¨æ°çæ¶åï¼ä¼åçº§ï¼priorityï¼åæ°å½±åéå¤§ã\n\nå¯ä»¥éè¿è®¾ç½®ä¼åçº§ï¼priorityï¼æ¥è®¾ç½®é¢å¤ç¥¨æ°ãä¼åçº§å³æéï¼åå¼ä¸º0-1000ï¼ç¸å½äºå¯é¢å¤å¢å 0-1000çç¥¨æ°ï¼ä¼åçº§çå¼è¶å¤§ï¼å°±è¶å¯è½è·å¾å¤æ°æåçæç¥¨ï¼votesï¼æ°ãæå®è¾é«çå¼å¯ä½¿æåæ´æèµæ ¼æä¸ºä¸»è¦æåï¼æ´ä½çå¼å¯ä½¿æåæ´ä¸ç¬¦åæ¡ä»¶ã\n\né»è®¤æåµä¸ï¼ä¼åçº§çå¼æ¯1\n\nmyrs:primary> rs.conf()\n{\n    "_id" : "myrs",\n    "version" : 3,\n    "protocolversion" : numberlong(1),\n    "writeconcernmajorityjournaldefault" : true,\n    "members" : [\n        {\n            "_id" : 0,\n            "host" : "180.76.159.126:27017",\n            "arbiteronly" : false,\n            "buildindexes" : true,\n            "hidden" : false,\n            "priority" : 1,\n            "tags" : {\n\n            },\n            "slavedelay" : numberlong(0),\n            "votes" : 1\n        },\n        {\n            "_id" : 1,\n            "host" : "180.76.159.126:27018",\n            "arbiteronly" : false,\n            "buildindexes" : true,\n            "hidden" : false,\n            "priority" : 1,\n            "tags" : {\n\n            },\n            "slavedelay" : numberlong(0),\n            "votes" : 1\n        },\n        {\n            "_id" : 2,\n            "host" : "180.76.159.126:27019",\n            "arbiteronly" : true,\n            "buildindexes" : true,\n            "hidden" : false,\n            "priority" : 0,\n            "tags" : {\n\n            },\n            "slavedelay" : numberlong(0),\n            "votes" : 1\n        }\n    ],\n    "settings" : {\n        "chainingallowed" : true,\n        "heartbeatintervalmillis" : 2000,\n        "heartbeattimeoutsecs" : 10,\n        "electiontimeoutmillis" : 10000,\n        "catchuptimeoutmillis" : -1,\n        "catchuptakeoverdelaymillis" : 30000,\n        "getlasterrormodes" : {\n\n        },\n        "getlasterrordefaults" : {\n            "w" : 1,\n            "wtimeout" : 0\n        },\n        "replicasetid" : objectid("5d539bdcd6a308e600d126bb")\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n\n\nå¯ä»¥çåºï¼ä¸»èç¹åå¯æ¬èç¹çä¼åçº§åä¸º 1ï¼å³ï¼é»è®¤å¯ä»¥è®¤ä¸ºé½å·²ç»æäºä¸ç¥¨ãä½éä¸¾èç¹ï¼ä¼åçº§æ¯0ï¼ï¼è¦æ³¨ææ¯ï¼å®æ¹è¯´äºï¼éä¸¾èç¹çä¼åçº§å¿é¡»æ¯0ï¼ä¸è½æ¯å«çå¼ãå³ä¸å·å¤éä¸¾æï¼ä½å·ææç¥¨æï¼\n\nãäºè§£ãä¿®æ¹ä¼åçº§\n\næ¯å¦ï¼ä¸é¢æåä»èç¹çä¼åçº§ï¼\n\n1ï¼åå°éç½®å¯¼å¥cfgåé\n\nmyrs:secondary> cfg=rs.conf()\n\n\n1\n\n\n2 ï¼ç¶åä¿®æ¹å¼ï¼idå·é»è®¤ä»0å¼å§ï¼\n\nmyrs:secondary> cfg.members[1].priority=2\n2\n\n\n1\n2\n\n\n3 ï¼éæ°å è½½éç½®\n\nmyrs:secondary> rs.reconfig(cfg)\n{ "ok" : 1 }\n\n\n1\n2\n\n\nç¨ç­çå»ä¼éæ°å¼å§éä¸¾ã\n\n\n# 1.7 æéæµè¯\n\n\n# 1.7.1 å¯æ¬èç¹æéæµè¯\n\nå³é­27018å¯æ¬èç¹ï¼\n\nåç°ï¼ä¸»èç¹åä»²è£èç¹å¯¹27018çå¿è·³å¤±è´¥ãå ä¸ºä¸»èç¹è¿å¨ï¼å æ­¤ï¼æ²¡æè§¦åæç¥¨éä¸¾ã\n\nå¦ææ­¤æ¶ï¼å¨ä¸»èç¹åå¥æ°æ®ã\n\ndb.comment.insert({"_id":"1","articleid":"100001","content":"æä»¬ä¸åºè¯¥ææ¸æ¨æµªè´¹å¨ææºä¸ï¼å¥åº·å¾éè¦ï¼ä¸æ¯æ¸©æ°´å¹¸ç¦ä½ æä»ã","userid":"1002","nickname":"ç¸å¿äºæ±æ¹","createdatetime":new date("2019-08-05t22:08:15.522z"),"likenum":numberint(1000),"state":"1"})\n\n\n1\n\n\nåå¯å¨ä»èç¹ï¼ä¼åç°ï¼ä¸»èç¹åå¥çæ°æ®ï¼ä¼èªå¨åæ­¥ç»ä»èç¹ã\n\n\n# 1.7.2 ä¸»èç¹æéæµè¯\n\nå³é­27017èç¹\n\nåç°ï¼ä»èç¹åä»²è£èç¹å¯¹27017çå¿è·³å¤±è´¥ï¼å½å¤±è´¥è¶è¿10ç§ï¼æ­¤æ¶å ä¸ºæ²¡æä¸»èç¹äºï¼ä¼èªå¨åèµ·æç¥¨ã\n\nèå¯æ¬èç¹åªæ27018ï¼å æ­¤ï¼åéäººåªæä¸ä¸ªå°±æ¯27018ï¼å¼å§æç¥¨ã\n\n27019å27018æäºä¸ç¥¨ï¼27018æ¬èº«èªå¸¦ä¸ç¥¨ï¼å æ­¤å±ä¸¤ç¥¨ï¼è¶è¿äºâå¤§å¤æ°â\n\n27019æ¯ä»²è£èç¹ï¼æ²¡æéä¸¾æï¼27018ä¸åå¶æç¥¨ï¼å¶ç¥¨æ°æ¯0.\n\næç»ç»æï¼27018æä¸ºä¸»èç¹ãå·å¤è¯»ååè½ã\n\nå¨27018åå¥æ°æ®æ¥çã\n\ndb.comment.insert({"_id":"2","articleid":"100001","content":"æå¤å¤©ç©ºè¹ååå¼æ°´ï¼å¬å¤©åæ¸©å¼æ°´","userid":"1005","nickname":"ä¼äººææ´","createdatetime":new date("2019-08-05t23:58:51.485z"),"likenum":numberint(888),"state":"1"})\n\n\n1\n\n\nåå¯å¨ 27017èç¹ï¼åç°27017åæäºä»èç¹ï¼27018ä»ä¿æä¸»èç¹ã\n\nç»å½27017èç¹ï¼åç°æ¯ä»èç¹äºï¼æ°æ®èªå¨ä»27018åæ­¥ã\n\nä»èå®ç°äºé«å¯ç¨ã\n\n\n# 1.7.3 ä»²è£èç¹åä¸»èç¹æé\n\nåå³æä»²è£èç¹27019ï¼\n\nå³æç°å¨çä¸»èç¹27018\n\nç»å½27017åï¼åç°ï¼27017ä»ç¶æ¯ä»èç¹ï¼å¯æ¬éä¸­æ²¡æä¸»èç¹äºï¼å¯¼è´æ­¤æ¶ï¼å¯æ¬éæ¯åªè¯»ç¶æï¼æ æ³åå¥ã\n\nä¸ºå¥ä¸éä¸¾äºï¼å ä¸º27017çç¥¨æ°ï¼æ²¡æè·å¾å¤§å¤æ°ï¼å³æ²¡æå¤§äºç­äº2ï¼å®åªæé»è®¤çä¸ç¥¨ï¼ä¼åçº§æ¯1ï¼\n\nå¦æè¦è§¦åéä¸¾ï¼éä¾¿å å¥ä¸ä¸ªæåå³å¯ã\n\n * å¦æåªå å¥ 27019ä»²è£èç¹æåï¼åä¸»èç¹ä¸å®æ¯27017ï¼å ä¸ºæ²¡å¾éäºï¼ä»²è£èç¹ä¸åä¸éä¸¾ï¼ä½åä¸æç¥¨ãï¼ä¸æ¼ç¤ºï¼\n * å¦æåªå å¥ 27018èç¹ï¼ä¼åèµ·éä¸¾ãå ä¸º27017å27018é½æ¯ä¸¤ç¥¨ï¼åæç§è°æ°æ®æ°ï¼è°å½ä¸»èç¹ã\n\n\n# 1.7.4 ä»²è£èç¹åä»èç¹æé\n\nåå³æä»²è£èç¹27019ï¼\n\nå³æç°å¨çå¯æ¬èç¹27018\n\n10ç§åï¼27017ä¸»èç¹èªå¨éçº§ä¸ºå¯æ¬èç¹ãï¼æå¡éçº§ï¼\n\nå¯æ¬éä¸å¯åæ°æ®äºï¼å·²ç»æéäºã\n\n\n# 1.8 compass è¿æ¥å¯æ¬é\n\ncompassè¿æ¥ï¼\n\n\n\n\n\n\n# 1.9 springdatamongodb è¿æ¥å¯æ¬é\n\nå¯æ¬éè¯­æ³ï¼\n\nmongodb://host1,host2,host3/articledb?connect=replicaset&slaveok=true&replicaset=å¯æ¬éåå­\n\n\n1\n\n\nå¶ä¸­ï¼\n\n * slaveok=true ï¼å¼å¯å¯æ¬èç¹è¯»çåè½ï¼å¯å®ç°è¯»ååç¦»ã\n * connect=replicaset ï¼èªå¨å°å¯æ¬éä¸­éæ©è¯»åçä¸»æºãå¦æslaveokæ¯æå¼çï¼åå®ç°äºè¯»ååç¦»\n\nãç¤ºä¾ã\n\nè¿æ¥ replica set ä¸å°æå¡å¨ (ç«¯å£ 27017, 27018, å27019)ï¼ç´æ¥è¿æ¥ç¬¬ä¸ä¸ªæå¡å¨ï¼æ è®ºæ¯replica setä¸é¨åæèä¸»æå¡å¨æèä»æå¡å¨ï¼åå¥æä½åºç¨å¨ä¸»æå¡å¨ å¹¶ä¸åå¸æ¥è¯¢å°ä»æå¡å¨ã\n\nä¿®æ¹éç½®æä»¶application.yml\n\nspring:\n    #æ°æ®æºéç½®\n    data:\n        mongodb:\n            # ä¸»æºå°å\n            #   host: 180.76.159.126\n            # æ°æ®åº\n            #   database: articledb\n            # é»è®¤ç«¯å£æ¯27017\n            #   port: 27017\n            #ä¹å¯ä»¥ä½¿ç¨uriè¿æ¥\n            #uri: mongodb://192.168.40.134:27017/articledb\n            # å¯æ¬éçè¿æ¥å­ç¬¦ä¸²\n            uri: mongodb://180.76.159.126:27017,180.76.159.126:27018,180.76.159.126:27019/articledb?connect=replicaset&slaveok=true&replicaset=myrs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ³¨æï¼\n\nä¸»æºå¿é¡»æ¯å¯æ¬éä¸­ææçä¸»æºï¼åæ¬ä¸»èç¹ãå¯æ¬èç¹ãä»²è£èç¹ã\n\nspringdatamongodbèªå¨å®ç°äºè¯»ååç¦»ï¼\n\nåæä½æ¶ï¼åªæå¼ä¸»èç¹è¿æ¥ï¼è¯»æä½æ¯ï¼åæ¶æå¼ä¸»èç¹åä»èç¹è¿æ¥ï¼ä½ä½¿ç¨ä»èç¹è·åæ°æ®ã\n\nå®æ´çè¿æ¥å­ç¬¦ä¸²çåèï¼äºè§£ï¼ï¼\n\nmongodbå®¢æ·ç«¯è¿æ¥è¯­æ³ï¼\n\nmongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostn[:portn]]][/[database][?options]]\n\n\n1\n\n * mongodb:// è¿æ¯åºå®çæ ¼å¼ï¼å¿é¡»è¦æå®ã\n * username:password@ å¯éé¡¹ï¼å¦æè®¾ç½®ï¼å¨è¿æ¥æ°æ®åºæå¡å¨ä¹åï¼é©±å¨é½ä¼å°è¯ç»éè¿ä¸ªæ°æ®åº\n * host1 å¿é¡»çæå®è³å°ä¸ä¸ªhost, host1 æ¯è¿ä¸ªuriå¯ä¸è¦å¡«åçãå®æå®äºè¦è¿æ¥æå¡å¨çå°åãå¦æè¦è¿æ¥å¤å¶éï¼è¯·æå®å¤ä¸ªä¸»æºå°åã\n * portx å¯éçæå®ç«¯å£ï¼å¦æä¸å¡«ï¼é»è®¤ä¸º27017\n * /database å¦ææå®username:password@ï¼è¿æ¥å¹¶éªè¯ç»éæå®æ°æ®åºãè¥ä¸æå®ï¼é»è®¤æå¼test æ°æ®åºã\n * ?options æ¯è¿æ¥éé¡¹ãå¦æä¸ä½¿ç¨/databaseï¼ååé¢éè¦å ä¸/ãææè¿æ¥éé¡¹é½æ¯é®å¼å¯¹name=valueï¼é®å¼å¯¹ä¹é´éè¿&æ;ï¼åå·ï¼éå¼\n\næ åçè¿æ¥æ ¼å¼åå«äºå¤ä¸ªéé¡¹(options)ï¼å¦ä¸æç¤ºï¼\n\néé¡¹                    æè¿°\nreplicaset=name       éªè¯replica setçåç§°ã impliesconnect=replicaset.\nslaveok=true|false    true:å¨connect=directæ¨¡å¼ä¸ï¼é©±å¨ä¼è¿æ¥ç¬¬ä¸å°æºå¨ï¼å³ä½¿è¿å°æå¡å¨ä¸æ¯ä¸»ãå¨connect=replicasetæ¨¡å¼ä¸ï¼é©±å¨ä¼åéææçåè¯·æ±å°ä¸»å¹¶ä¸æè¯»åæä½åå¸å¨å¶ä»ä»æå¡å¨ãfalse:\n                      å¨connect=directæ¨¡å¼ä¸ï¼é©±å¨ä¼èªå¨æ¾å¯»ä¸»æå¡å¨. å¨connect=replicaset\n                      æ¨¡å¼ä¸ï¼é©±å¨ä»ä»è¿æ¥ä¸»æå¡å¨ï¼å¹¶ä¸ææçè¯»åå½ä»¤é½è¿æ¥å°ä¸»æå¡å¨ã\nsafe=true|false       true: å¨æ§è¡æ´æ°æä½ä¹åï¼é©±å¨é½ä¼åégetlasterrorå½ä»¤æ¥ç¡®ä¿æ´æ°æåã(è¿è¦åè\n                      wtimeoutms).false: å¨æ¯æ¬¡æ´æ°ä¹åï¼é©±å¨ä¸ä¼åégetlasterroræ¥ç¡®ä¿æ´æ°æåã\nw=n                   é©±å¨æ·»å  { w : n } å°getlasterrorå½ä»¤. åºç¨äºsafe=trueã\nwtimeoutms=ms         é©±å¨æ·»å  { wtimeout : ms } å° getlasterror å½ä»¤. åºç¨äº safe=true.\nfsync=true|false      true: é©±å¨æ·»å  { fsync : true } å° getlasterror\n                      å½ä»¤.åºç¨äºsafe=true.false: é©±å¨ä¸ä¼æ·»å å°getlasterrorå½ä»¤ä¸­ã\njournal=true|false    å¦æè®¾ç½®ä¸º true, åæ­¥å° journal (å¨æäº¤å°æ°æ®åºååå¥å°å®ä½ä¸­).åºç¨äº safe=true\nconnecttimeoutms=ms   å¯ä»¥æå¼è¿æ¥çæ¶é´\nsockettimeoutms=ms    åéåæ¥åsocketsçæ¶é´\n\n\n# 2. åçéç¾¤-sharded cluster\n\n\n# 2.1 åçæ¦å¿µ\n\nåçï¼shardingï¼æ¯ä¸ç§è·¨å¤å°æºå¨åå¸æ°æ®çæ¹æ³ï¼ mongodbä½¿ç¨åçæ¥æ¯æå·æéå¸¸å¤§çæ°æ®éåé«ååéæä½çé¨ç½²ã\n\næ¢å¥è¯è¯´ï¼åç(sharding)æ¯æå°æ°æ®æåï¼å°å¶åæ£å­å¨ä¸åçæºå¨ä¸çè¿ç¨ãææ¶ä¹ç¨ååº(partitioning)æ¥è¡¨ç¤ºè¿ä¸ªæ¦å¿µãå°æ°æ®åæ£å°ä¸åçæºå¨ä¸ï¼ä¸éè¦åè½å¼ºå¤§çå¤§åè®¡ç®æºå°±å¯ä»¥å¨å­æ´å¤çæ°æ®ï¼å¤çæ´å¤çè´è½½ã\n\nå·æå¤§åæ°æ®éæé«ååéåºç¨ç¨åºçæ°æ®åºç³»ç»å¯ä»¥ä¼ææåä¸ªæå¡å¨çå®¹éãä¾å¦ï¼é«æ¥è¯¢çä¼èå°½æå¡å¨çcpuå®¹éãå·¥ä½éå¤§å°å¤§äºç³»ç»çramä¼å¼ºè°ç£çé©±å¨å¨çi / oå®¹éã\n\næä¸¤ç§è§£å³ç³»ç»å¢é¿çæ¹æ³ï¼åç´æ©å±åæ°´å¹³æ©å±ã\n\nåç´æ©å±æå³çå¢å åä¸ªæå¡å¨çå®¹éï¼ä¾å¦ä½¿ç¨æ´å¼ºå¤§çcpuï¼æ·»å æ´å¤ramæå¢å å­å¨ç©ºé´éãå¯ç¨ææ¯çå±éæ§å¯è½ä¼éå¶åä¸ªæºå¨å¯¹äºç»å®å·¥ä½è´è½½èè¨è¶³å¤å¼ºå¤§ãæ­¤å¤ï¼åºäºäºçæä¾ååºäºå¯ç¨çç¡¬ä»¶éç½®å·æç¡¬æ§ä¸éãç»æï¼åç´ç¼©æ¾æå®éçæå¤§å¼ã\n\næ°´å¹³æ©å±æå³çååç³»ç»æ°æ®éå¹¶å è½½å¤ä¸ªæå¡å¨ï¼æ·»å å¶ä»æå¡å¨ä»¥æ ¹æ®éè¦å¢å å®¹éãè½ç¶åä¸ªæºå¨çæ»ä½éåº¦æå®¹éå¯è½ä¸é«ï¼ä½æ¯å°æºå¨å¤çæ´ä¸ªå·¥ä½è´è½½çå­éï¼å¯è½æä¾æ¯åä¸ªé«éå¤§å®¹éæå¡å¨æ´é«çæçãæ©å±é¨ç½²å®¹éåªéè¦æ ¹æ®éè¦æ·»å é¢å¤çæå¡å¨ï¼è¿å¯è½æ¯åä¸ªæºå¨çé«ç«¯ç¡¬ä»¶çæ»ä½ææ¬æ´ä½ãæè¡¡æ¯åºç¡æ¶æåé¨ç½²ç»´æ¤çå¤ææ§å¢å ã\n\nmongodbæ¯æéè¿åçè¿è¡æ°´å¹³æ©å±ã\n\n\n# 2.2 åçéç¾¤åå«çç»ä»¶\n\nmongodbåçç¾¤éåå«ä»¥ä¸ç»ä»¶ï¼\n\n * åçï¼å­å¨ï¼ï¼æ¯ä¸ªåçåå«åçæ°æ®çå­éã æ¯ä¸ªåçé½å¯ä»¥é¨ç½²ä¸ºå¯æ¬éã\n * mongos ï¼è·¯ç±ï¼ï¼mongosåå½æ¥è¯¢è·¯ç±å¨ï¼å¨å®¢æ·ç«¯åºç¨ç¨åºååçéç¾¤ä¹é´æä¾æ¥å£ã\n * config servers ï¼âè°åº¦âçéç½®ï¼ï¼éç½®æå¡å¨å­å¨ç¾¤éçåæ°æ®åéç½®è®¾ç½®ã ä»mongodb 3.4å¼å§ï¼å¿é¡»å°éç½®æå¡å¨é¨ç½²ä¸ºå¯æ¬éï¼csrsï¼ã\n\nä¸å¾æè¿°äºåçéç¾¤ä¸­ç»ä»¶çäº¤äºï¼\n\n\n\nmongodbå¨éåçº§å«å¯¹æ°æ®è¿è¡åçï¼å°éåæ°æ®åå¸å¨éç¾¤ä¸­çåçä¸ã\n\n\n# 2.3 åçéç¾¤æ¶æç®æ \n\nä¸¤ä¸ªåçèç¹å¯æ¬éï¼3+3ï¼+ä¸ä¸ªéç½®èç¹å¯æ¬éï¼3ï¼+ä¸¤ä¸ªè·¯ç±èç¹ï¼2ï¼ï¼å±11ä¸ªæå¡èç¹ã\n\n\n\n\n# 2.4 åçï¼å­å¨ï¼èç¹å¯æ¬éçåå»º\n\nææççéç½®æä»¶é½ç´æ¥æ¾å° sharded_cluster çç¸åºçå­ç®å½ä¸é¢ï¼é»è®¤éç½®æä»¶åå­ï¼mongod.conf\n\n\n# 2.4.1 ç¬¬ä¸å¥å¯æ¬é\n\nåå¤å­æ¾æ°æ®åæ¥å¿çç®å½ï¼\n\n#-----------myshardrs01\nmkdir -p /mongodb/sharded_cluster/myshardrs01_27018/log \\ &\nmkdir -p /mongodb/sharded_cluster/myshardrs01_27018/data/db \\ &\n\nmkdir -p /mongodb/sharded_cluster/myshardrs01_27118/log \\ &\nmkdir -p /mongodb/sharded_cluster/myshardrs01_27118/data/db \\ &\n\nmkdir -p /mongodb/sharded_cluster/myshardrs01_27218/log \\ &\nmkdir -p /mongodb/sharded_cluster/myshardrs01_27218/data/db\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\n\n\n1\n\n\nmyshardrs01_27018 ï¼\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myshardrs01_27018/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n    dbpath: "/mongodb/sharded_cluster/myshardrs01_27018/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: "/mongodb/sharded_cluster/myshardrs01_27018/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææipï¼æå¯ä½ç¨ï¼å¯æ¬éåå§åçæ¶åï¼èç¹åå­ä¼èªå¨è®¾ç½®ä¸ºæ¬å°ååï¼èä¸æ¯ip\n    #bindipall: true\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #bindip\n    #ç»å®çç«¯å£\n    port: 27018\nreplication:\n    #å¯æ¬éçåç§°\n    replsetname: myshardrs01\nsharding:\n    #åçè§è²\n    clusterrole: shardsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n\n\nsharding.clusterroleï¼\n\nvalue       description\nconfigsvr   start this instance as a config server. the instance starts\n            on port 27019 by default.\nshardsvr    start this instance as a shard . the instance starts on port\n            27018 by default.\n\næ³¨æï¼\n\nè®¾ç½®sharding.clusterroleéè¦mongodå®ä¾è¿è¡å¤å¶ã è¦å°å®ä¾é¨ç½²ä¸ºå¯æ¬éæåï¼è¯·ä½¿ç¨replsetnameè®¾ç½®å¹¶æå®å¯æ¬éçåç§°ã\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\n\n\n1\n\n\nmyshardrs01_27118 ï¼\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myshardrs01_27118/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n    dbpath: "/mongodb/sharded_cluster/myshardrs01_27118/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: "/mongodb/sharded_cluster/myshardrs01_27118/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææip\n    #bindipall: true\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27118\nreplication:\n    replsetname: myshardrs01\nsharding:\n    clusterrole: shardsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\n\n\n1\n\n\nmyshardrs01_27218 ï¼\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myshardrs01_27218/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n    dbpath: "/mongodb/sharded_cluster/myshardrs01_27218/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: "/mongodb/sharded_cluster/myshardrs01_27218/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27218\nreplication:\n    replsetname: myshardrs01\nsharding:\n    clusterrole: shardsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\nå¯å¨ç¬¬ä¸å¥å¯æ¬éï¼ä¸ä¸»ä¸å¯æ¬ä¸ä»²è£\n\nä¾æ¬¡å¯å¨ä¸ä¸ªmongodæå¡ï¼\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123223\nchild process started successfully, parent exiting\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123292\nchild process started successfully, parent exiting\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123326\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ¥çæå¡æ¯å¦å¯å¨ï¼\n\n[root@bobohost bin]# ps -ef |grep mongod\npolkitd  61622  61604  0 7æ31 ?    00:04:29 mongod --bind_ip_all\nroot   123223    1  1 01:10 ?     00:00:01 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\nroot   123292    1  4 01:11 ?     00:00:00 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\nroot   123326    1  6 01:11 ?     00:00:00 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\n\n\n1\n2\n3\n4\n5\n\n\n# 2.4.1.1 åå§åå¯æ¬éååå»ºä¸»èç¹ï¼\n\nä½¿ç¨å®¢æ·ç«¯å½ä»¤è¿æ¥ä»»æä¸ä¸ªèç¹ï¼ä½è¿éå°½éè¦è¿æ¥ä¸»èç¹ï¼\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27018\n\n\n1\n\n\næ§è¡åå§åå¯æ¬éå½ä»¤ï¼\n\nrs.initiate()\n\n\n1\n\n\næ¥çå¯æ¬éæåµ\n\nrs.status()\n\n\n1\n\n\nä¸»èç¹éç½®æ¥ç\n\nrs.conf()\n\n\n1\n\n\n# 2.4.1.2 æ·»å å¯æ¬èç¹\n\nrs.add("180.76.159.126:27118")\n\n\n1\n\n\n# 2.4.1.3 æ·»å ä»²è£èç¹\n\nrs.addarb("180.76.159.126:27218")\n\n\n1\n\n\næ¥çå¯æ¬éçéç½®æåµ\n\nmyshardrs01:primary> rs.conf()\n{\n    "_id" : "myshardrs01",\n    "version" : 3,\n    "protocolversion" : numberlong(1),\n    "writeconcernmajorityjournaldefault" : true,\n    "members" : [\n        {\n            "_id" : 0,\n            "host" : "180.76.159.126:27018",\n            "arbiteronly" : false,\n            "buildindexes" : true,\n            "hidden" : false,\n            "priority" : 1,\n            "tags" : {\n\n            },\n            "slavedelay" : numberlong(0),\n            "votes" : 1\n        },\n        {\n            "_id" : 1,\n            "host" : "180.76.159.126:27118",\n            "arbiteronly" : false,\n            "buildindexes" : true,\n            "hidden" : false,\n            "priority" : 1,\n            "tags" : {\n\n            },\n            "slavedelay" : numberlong(0),\n            "votes" : 1\n        },\n        {\n            "_id" : 2,\n            "host" : "180.76.159.126:27218",\n            "arbiteronly" : true,\n            "buildindexes" : true,\n            "hidden" : false,\n            "priority" : 0,\n            "tags" : {\n\n            },\n            "slavedelay" : numberlong(0),\n            "votes" : 1\n        }\n    ],\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n\n\n\n# 2.4.2 ç¬¬äºå¥å¯æ¬é\n\nåå¤å­æ¾æ°æ®åæ¥å¿çç®å½ï¼\n\n#-----------myshardrs02\nmkdir -p /mongodb/sharded_cluster/myshardrs02_27318/log \\ &\nmkdir -p /mongodb/sharded_cluster/myshardrs02_27318/data/db \\ &\n\nmkdir -p /mongodb/sharded_cluster/myshardrs02_27418/log \\ &\nmkdir -p /mongodb/sharded_cluster/myshardrs02_27418/data/db \\ &\n\nmkdir -p /mongodb/sharded_cluster/myshardrs02_27518/log \\ &\nmkdir -p /mongodb/sharded_cluster/myshardrs02_27518/data/db\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myshardrs02_27318/mongod.conf\n\n\n1\n\n\nmyshardrs02_27318 ï¼\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myshardrs02_27318/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n    dbpath: "/mongodb/sharded_cluster/myshardrs02_27318/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: "/mongodb/sharded_cluster/myshardrs02_27318/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27318\nreplication:\n    replsetname: myshardrs02\nsharding:\n    clusterrole: shardsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myshardrs02_27418/mongod.conf\n\n\n1\n\n\nmyshardrs02_27418 ï¼\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myshardrs02_27418/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n    dbpath: "/mongodb/sharded_cluster/myshardrs02_27418/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: "/mongodb/sharded_cluster/myshardrs02_27418/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææip\n    #bindipall: true\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27418\nreplication:\n    replsetname: myshardrs02\nsharding:\n    clusterrole: shardsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myshardrs02_27518/mongod.conf\n\n\n1\n\n\nmyshardrs02_27518 ï¼\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myshardrs02_27518/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n    dbpath: "/mongodb/sharded_cluster/myshardrs02_27518/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: "/mongodb/sharded_cluster/myshardrs02_27518/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææip\n    #bindipall: true\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27518\nreplication:\n    replsetname: myshardrs02\nsharding:\n    clusterrole: shardsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nå¯å¨ç¬¬äºå¥å¯æ¬éï¼ä¸ä¸»ä¸å¯æ¬ä¸ä»²è£\n\nä¾æ¬¡å¯å¨ä¸ä¸ªmongodæå¡ï¼\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27318/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123223\nchild process started successfully, parent exiting\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27418/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123292\nchild process started successfully, parent exiting\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27518/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123326\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ¥çæå¡æ¯å¦å¯å¨ï¼\n\n[root@bobohost bin]# ps -ef |grep mongod\n\n\n1\n\n\n# 2.4.2.1 åå§åå¯æ¬éååå»ºä¸»èç¹\n\nä½¿ç¨å®¢æ·ç«¯å½ä»¤è¿æ¥ä»»æä¸ä¸ªèç¹ï¼ä½è¿éå°½éè¦è¿æ¥ä¸»èç¹ï¼\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27318\n\n\n1\n\n\næ§è¡åå§åå¯æ¬éå½ä»¤ï¼\n\nrs.initiate()\n\n\n1\n\n\næ¥çå¯æ¬éæåµ (èéåå®¹)ï¼\n\nrs.status()\n\n\n1\n\n\nä¸»èç¹éç½®æ¥çï¼\n\nrs.conf()\n\n\n1\n\n\n# 2.4.2.2 æ·»å å¯æ¬èç¹\n\nrs.add("180.76.159.126:27418")\n\n\n1\n\n\n# 2.4.2.3 æ·»å ä»²è£èç¹\n\nrs.addarb("180.76.159.126:27518")\n\n\n1\n\n\næ¥çå¯æ¬éçéç½®æåµ\n\nmyshardrs02:primary> rs.status()\n{\n    "set" : "myshardrs02",\n    "date" : isodate("2019-07-31t21:38:22.463z"),\n    "mystate" : 1,\n    "term" : numberlong(1),\n    "syncingto" : "",\n    "syncsourcehost" : "",\n    "syncsourceid" : -1,\n    "heartbeatintervalmillis" : numberlong(2000),\n    "optimes" : {\n        "lastcommittedoptime" : {\n            "ts" : timestamp(1564609094, 1),\n            "t" : numberlong(1)\n        },\n        "readconcernmajorityoptime" : {\n            "ts" : timestamp(1564609094, 1),\n            "t" : numberlong(1)\n        },\n        "appliedoptime" : {\n            "ts" : timestamp(1564609094, 1),\n            "t" : numberlong(1)\n        },\n        "durableoptime" : {\n            "ts" : timestamp(1564609094, 1),\n            "t" : numberlong(1)\n        }\n    },\n    "laststablecheckpointtimestamp" : timestamp(1564609074, 1),\n    "members" : [\n        {\n            "_id" : 0,\n            "name" : "180.76.159.126:27318",\n            "health" : 1,\n            "state" : 1,\n            "statestr" : "primary",\n            "uptime" : 5086,\n            "optime" : {\n                "ts" : timestamp(1564609094, 1),\n                "t" : numberlong(1)\n            },\n            "optimedate" : isodate("2019-07-31t21:38:14z"),\n            "syncingto" : "",\n            "syncsourcehost" : "",\n            "syncsourceid" : -1,\n            "infomessage" : "",\n            "electiontime" : timestamp(1564604032, 2),\n            "electiondate" : isodate("2019-07-31t20:13:52z"),\n            "configversion" : 3,\n            "self" : true,\n            "lastheartbeatmessage" : ""\n        },\n        {\n            "_id" : 1,\n            "name" : "180.76.159.126:27418",\n            "health" : 1,\n            "state" : 2,\n            "statestr" : "secondary",\n            "uptime" : 4452,\n            "optime" : {\n                "ts" : timestamp(1564609094, 1),\n                "t" : numberlong(1)\n            },\n            "optimedurable" : {\n                "ts" : timestamp(1564609094, 1),\n                "t" : numberlong(1)\n            },\n            "optimedate" : isodate("2019-07-31t21:38:14z"),\n            "optimedurabledate" : isodate("2019-07-31t21:38:14z"),\n            "lastheartbeat" : isodate("2019-07-31t21:38:21.178z"),\n            "lastheartbeatrecv" : isodate("2019-07-31t21:38:20.483z"),\n            "pingms" : numberlong(0),\n            "lastheartbeatmessage" : "",\n            "syncingto" : "180.76.159.126:27518",\n            "syncsourcehost" : "180.76.159.126:27518",\n            "syncsourceid" : 2,\n            "infomessage" : "",\n            "configversion" : 3\n        },\n        {\n            "_id" : 2,\n            "name" : "180.76.159.126:27518",\n            "health" : 1,\n            "state" : 2,\n            "statestr" : "secondary",\n            "uptime" : 4448,\n            "optime" : {\n                "ts" : timestamp(1564609094, 1),\n                "t" : numberlong(1)\n            },\n            "optimedurable" : {\n                "ts" : timestamp(1564609094, 1),\n                "t" : numberlong(1)\n            },\n            "optimedate" : isodate("2019-07-31t21:38:14z"),\n            "optimedurabledate" : isodate("2019-07-31t21:38:14z"),\n            "lastheartbeat" : isodate("2019-07-31t21:38:21.178z"),\n            "lastheartbeatrecv" : isodate("2019-07-31t21:38:22.096z"),\n            "pingms" : numberlong(0),\n            "lastheartbeatmessage" : "",\n            "syncingto" : "180.76.159.126:27318",\n            "syncsourcehost" : "180.76.159.126:27318",\n            "syncsourceid" : 0,\n            "infomessage" : "",\n            "configversion" : 3\n        }\n    ],\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n\n\n\n# 2.5 éç½®èç¹å¯æ¬éçåå»º\n\nç¬¬ä¸æ­¥ï¼åå¤å­æ¾æ°æ®åæ¥å¿çç®å½ï¼\n\n#-----------configrs\n#å»ºç«æ°æ®èç¹dataåæ¥å¿ç®å½\nmkdir -p /mongodb/sharded_cluster/myconfigrs_27019/log \\ &\nmkdir -p /mongodb/sharded_cluster/myconfigrs_27019/data/db \\ &\n\nmkdir -p /mongodb/sharded_cluster/myconfigrs_27119/log \\ &\nmkdir -p /mongodb/sharded_cluster/myconfigrs_27119/data/db \\ &\n\nmkdir -p /mongodb/sharded_cluster/myconfigrs_27219/log \\ &\nmkdir -p /mongodb/sharded_cluster/myconfigrs_27219/data/db\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myconfigrs_27019/mongod.conf\n\n\n1\n\n\nmyconfigrs_27019 ï¼\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myconfigrs_27019/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n    dbpath: "/mongodb/sharded_cluster/myconfigrs_27019/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: "/mongodb/sharded_cluster/myconfigrs_27019/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææip\n    #bindipall: true\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27019\nreplication:\n    replsetname: myconfigrs\nsharding:\n    clusterrole: configsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myconfigrs_27119/mongod.conf\n\n\n1\n\n\nmyconfigrs_27119\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myconfigrs_27119/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n    dbpath: "/mongodb/sharded_cluster/myconfigrs_27119/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: "/mongodb/sharded_cluster/myconfigrs_27119/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææip\n    #bindipall: true\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27119\nreplication:\n    replsetname: myconfigrs\nsharding:\n    clusterrole: configsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvim /mongodb/sharded_cluster/myconfigrs_27219/mongod.conf\n\n\n1\n\n\nmyconfigrs_27219\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/myconfigrs_27219/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n    dbpath: "/mongodb/sharded_cluster/myconfigrs_27219/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: "/mongodb/sharded_cluster/myconfigrs_27219/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææip\n    #bindipall: true\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27219\nreplication:\n    replsetname: myconfigrs\nsharding:\n    clusterrole: configsvr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n\n\nå¯å¨éç½®å¯æ¬éï¼ä¸ä¸»ä¸¤å¯æ¬\n\nä¾æ¬¡å¯å¨ä¸ä¸ªmongodæå¡ï¼\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27019/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123223\nchild process started successfully, parent exiting\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27119/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123292\nchild process started successfully, parent exiting\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27219/mongod.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 123326\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ¥çæå¡æ¯å¦å¯å¨ï¼\n\n[root@bobohost bin]# ps -ef |grep mongod\n\n\n1\n\n\n\n# 2.5.1 åå§åå¯æ¬éååå»ºä¸»èç¹\n\nä½¿ç¨å®¢æ·ç«¯å½ä»¤è¿æ¥ä»»æä¸ä¸ªèç¹ï¼ä½è¿éå°½éè¦è¿æ¥ä¸»èç¹ï¼\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27019\n\n\n1\n\n\næ§è¡åå§åå¯æ¬éå½ä»¤ï¼\n\nrs.initiate()\n\n\n1\n\n\næ¥çå¯æ¬éæåµ (èéåå®¹)ï¼\n\nrs.status()\n\n\n1\n\n\nä¸»èç¹éç½®æ¥çï¼\n\nrs.conf()\n\n\n1\n\n\n\n# 2.5.2 æ·»å ä¸¤ä¸ªå¯æ¬èç¹\n\nmyshardrs01:primary> rs.add("180.76.159.126:27119")\nmyshardrs01:primary> rs.add("180.76.159.126:27219")\n\n\n1\n2\n\n\næ¥çå¯æ¬éçéç½®æåµï¼\n\nmyshardrs01:primary> rs.conf()\nmyshardrs01:primary> rs.status()\n\n\n1\n2\n\n\n\n# 2.6 è·¯ç±èç¹çåå»ºåæä½\n\n\n# 2.6.1 ç¬¬ä¸ä¸ªè·¯ç±èç¹çåå»ºåè¿æ¥\n\nç¬¬ä¸æ­¥ï¼åå¤å­æ¾æ°æ®åæ¥å¿çç®å½ï¼\n\n#-----------mongos01\nmkdir -p /mongodb/sharded_cluster/mymongos_27017/log\n\n\n1\n2\n\n\nmymongos_27017èç¹ï¼\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvi /mongodb/sharded_cluster/mymongos_27017/mongos.conf\n\n\n1\n\n\nmongos.confï¼\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/mymongos_27017/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: /mongodb/sharded_cluster/mymongos_27017/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææipï¼æå¯ä½ç¨ï¼å¯æ¬éåå§åçæ¶åï¼èç¹åå­ä¼èªå¨è®¾ç½®ä¸ºæ¬å°ååï¼èä¸æ¯ip\n    #bindipall: true\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #bindip\n    #ç»å®çç«¯å£\n    port: 27017\nsharding:\n    #æå®éç½®èç¹å¯æ¬é\n    configdb: myconfigrs/180.76.159.126:27019,180.76.159.126:27119,180.76.159.126:27219\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nå¯å¨mongosï¼\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27017/mongos.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 129874\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n\n\næç¤ºï¼å¯å¨å¦æå¤±è´¥ï¼å¯ä»¥æ¥ç logç®å½ä¸çæ¥å¿ï¼æ¥çå¤±è´¥åå ã\n\nå®¢æ·ç«¯ç»å½mongos\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017\n\n\n1\n\n\næ­¤æ¶ï¼åä¸è¿å»æ°æ®ï¼å¦æåæ°æ®ä¼æ¥éï¼\n\nmongos> use aadb\nswitched to db aadb\nmongos> db.aa.insert({aa:"aa"})\nwritecommanderror({\n    "ok" : 0,\n    "errmsg" : "unable to initialize targeter for write op for collection aa.aa :: caused by :: database aa not found :: caused by :: no shards found",\n    "code" : 70,\n    "codename" : "shardnotfound",\n    "operationtime" : timestamp(1564600123, 2),\n    "$clustertime" : {\n    "clustertime" : timestamp(1564600123, 2),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n        }\n    }\n})\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\nåå ï¼éè¿è·¯ç±èç¹æä½ï¼ç°å¨åªæ¯è¿æ¥äºéç½®èç¹ï¼è¿æ²¡æè¿æ¥åçæ°æ®èç¹ï¼å æ­¤æ æ³åå¥ä¸å¡æ°æ®ã\n\n\n# 2.6.2 å¨è·¯ç±èç¹ä¸è¿è¡åçéç½®æä½\n\nä½¿ç¨å½ä»¤æ·»å åçï¼\n\n# 2.6.2.1 æ·»å åçï¼\n\nè¯­æ³ï¼\n\nsh.addshard("ip:port")\n\n\n1\n\n\nå°ç¬¬ä¸å¥åçå¯æ¬éæ·»å è¿æ¥ï¼\n\nmongos>sh.addshard("myshardrs01/192.168.0.2:27018,180.76.159.126:27118,180.76.159.126:27218")\n{\n    "shardadded" : "myshardrs01",\n    "ok" : 1,\n    "operationtime" : timestamp(1564611970, 4),\n    "$clustertime" : {\n    "clustertime" : timestamp(1564611970, 4),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\næ¥çåçç¶ææåµï¼\n\nmongos> sh.status()\n--- sharding status ---\n    sharding version: {\n        "_id" : 1,\n        "mincompatibleversion" : 5,\n        "currentversion" : 6,\n        "clusterid" : objectid("5d4211b798f3f9a48522c68b")\n    }\n    shards:\n        {  "_id" : "myshardrs01",  "host" : "myshardrs01/180.76.159.126:27018,180.76.159.126:27118",  "state" : 1 }\n    active mongoses:\n        "4.0.10" : 1\n    autosplit:\n        currently enabled: yes\n    balancer:\n        currently enabled:  yes\n        currently running:  no\n        failed balancer rounds in last 5 attempts:  0\n        migration results for the last 24 hours:\n            no recent migrations\n    databases:\n        {  "_id" : "config",  "primary" : "config",  "partitioned" : true }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nç»§ç»­å°ç¬¬äºå¥åçå¯æ¬éæ·»å è¿æ¥ï¼\n\nmongos>sh.addshard("myshardrs02/192.168.0.2:27318,180.76.159.126:27418,180.76.159.126:27518")\n{\n    "shardadded" : "myshardrs02",\n    "ok" : 1,\n    "operationtime" : timestamp(1564612147, 5),\n    "$clustertime" : {\n    "clustertime" : timestamp(1564612147, 5),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\næ¥çåçç¶æï¼\n\nmongos> sh.status()\n--- sharding status ---\n    sharding version: {\n        "_id" : 1,\n        "mincompatibleversion" : 5,\n        "currentversion" : 6,\n        "clusterid" : objectid("5d4211b798f3f9a48522c68b")\n    }\n    shards:\n        {  "_id" : "myshardrs01",  "host" : "myshardrs01/180.76.159.126:27018,180.76.159.126:27118",  "state" : 1 }\n        {  "_id" : "myshardrs02",  "host" : "myshardrs02/180.76.159.126:27318,180.76.159.126:27418",  "state" : 1 }\n    active mongoses:\n        "4.0.10" : 1\n    autosplit:\n        currently enabled: yes\n    balancer:\n        currently enabled:  yes\n        currently running:  no\n        failed balancer rounds in last 5 attempts:  0\n        migration results for the last 24 hours:\n            no recent migrations\n    databases:\n        {  "_id" : "config",  "primary" : "config",  "partitioned" : true }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\næç¤ºï¼å¦ææ·»å åçå¤±è´¥ï¼éè¦åæå¨ç§»é¤åçï¼æ£æ¥æ·»å åççä¿¡æ¯çæ­£ç¡®æ§åï¼åæ¬¡æ·»å åçã\n\nç§»é¤åçåè(äºè§£)ï¼\n\nuse admin\ndb.runcommand( { removeshard: "myshardrs02" } )\n\n\n1\n2\n\n\næ³¨æï¼å¦æåªå©ä¸æåä¸ä¸ª shardï¼æ¯æ æ³å é¤ç\n\nç§»é¤æ¶ä¼èªå¨è½¬ç§»åçæ°æ®ï¼éè¦ä¸ä¸ªæ¶é´è¿ç¨ã\n\nå®æåï¼åæ¬¡æ§è¡å é¤åçå½ä»¤æè½çæ­£å é¤ã\n\n# 2.6.2.2 å¼å¯åçåè½\n\nsh.enablesharding(âåºåâ)ãsh.shardcollection(âåºå.éååâ,{âkeyâ:1})\n\nå¨mongosä¸çarticledbæ°æ®åºéç½®sharding:\n\nmongos> sh.enablesharding("articledb")\n{\n    "ok" : 1,\n    "operationtime" : timestamp(1564612296, 5),\n    "$clustertime" : {\n        "clustertime" : timestamp(1564612296, 5),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥çåçç¶æï¼\n\nmongos> sh.status()\n--- sharding status ---\n    sharding version: {\n        "_id" : 1,\n        "mincompatibleversion" : 5,\n        "currentversion" : 6,\n        "clusterid" : objectid("5d4211b798f3f9a48522c68b")\n    }\n    shards:\n        {  "_id" : "myshardrs01",  "host" : "myshardrs01/180.76.159.126:27018,180.76.159.126:27118",  "state" : 1 }\n        {  "_id" : "myshardrs02",  "host" : "myshardrs02/180.76.159.126:27318,180.76.159.126:27418",  "state" : 1 }\n    active mongoses:\n        "4.0.10" : 1\n    autosplit:\n        currently enabled: yes\n    balancer:\n        currently enabled:  yes\n        currently running:  no\n        failed balancer rounds in last 5 attempts:  0\n        migration results for the last 24 hours:\n            no recent migrations\n    databases:\n        {  "_id" : "articledb",  "primary" : "myshardrs02",  "partitioned" : true, "version" : {  "uuid" : uuid("788c9a3b-bb6a-4cc2-a597-974694772986"), "lastmod" : 1 } }\n        {  "_id" : "config",  "primary" : "config",  "partitioned" : true }\n            config.system.sessions\n                shard key: { "_id" : 1 }\n                unique: false\n                balancing: true\n                chunks:\n                    myshardrs01   1\n                { "_id" : { "$minkey" : 1 } } --\x3e> { "_id" : { "$maxkey" : 1 } } on : myshardrs01 timestamp(1, 0)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n\n\n# 2.6.2.3 éååç\n\nå¯¹éååçï¼ä½ å¿é¡»ä½¿ç¨ sh.shardcollection() æ¹æ³æå®éåååçé®\n\nè¯­æ³ï¼\n\nsh.shardcollection(namespace, key, unique)\n\n\n1\n\n\nåæ°ï¼\n\nparameter   type       description\nnamespace   string     è¦ï¼åçï¼å±äº«çç®æ éåçå½åç©ºé´ï¼æ ¼å¼ï¼ .\nkey         document   ç¨ä½åçé®çç´¢å¼è§èææ¡£ãshardé®å³å®mongodbå¦ä½å¨shardä¹é´ååææ¡£ãé¤ééåä¸ºç©ºï¼å¦åç´¢å¼å¿é¡»å¨shardcollectionå½ä»¤ä¹åå­å¨ãå¦æéåä¸ºç©ºï¼åmongodbå¨å¯¹éåè¿è¡åçä¹ååå»ºç´¢å¼ï¼åææ¯æ¯æåçé®çç´¢å¼ä¸å­å¨ãç®åçè¯´ï¼ç±åå«å­æ®µåè¯¥å­æ®µçç´¢å¼éåæ¹åçææ¡£ç»æã\nunique      boolean    å½å¼ä¸ºtrueæåµä¸ï¼çé®å­æ®µä¸ä¼éå¶ä¸ºç¡®ä¿æ¯å¯ä¸ç´¢å¼ãåå¸ç­ç¥çé®ä¸æ¯æå¯ä¸ç´¢å¼ãé»è®¤æ¯falseã\n\nå¯¹éåè¿è¡åçæ¶,ä½ éè¦éæ©ä¸ä¸ª çé®ï¼shard keyï¼ , shard key æ¯æ¯æ¡è®°å½é½å¿é¡»åå«ç,ä¸å»ºç«äºç´¢å¼çåä¸ªå­æ®µæå¤åå­æ®µ,mongodbæç§çé®å°æ°æ®ååå°ä¸åç æ°æ®å ä¸­,å¹¶å° æ°æ®å åè¡¡å°åå¸å°ææåçä¸­.ä¸ºäºæç§çé®ååæ°æ®å,mongodbä½¿ç¨ åºäºåå¸çåçæ¹å¼ï¼éæºå¹³ååéï¼æèåºäºèå´çåçæ¹å¼ï¼æ°å¼å¤§å°åéï¼ ã\n\nç¨ä»ä¹å­æ®µå½çé®é½å¯ä»¥ï¼å¦ï¼nicknameä½ä¸ºçé®ï¼ä½ä¸å®æ¯å¿å¡«å­æ®µã\n\nåçè§åä¸ï¼åå¸ç­ç¥\n\nå¯¹äº åºäºåå¸çåç ,mongodbè®¡ç®ä¸ä¸ªå­æ®µçåå¸å¼,å¹¶ç¨è¿ä¸ªåå¸å¼æ¥åå»ºæ°æ®å.\n\nå¨ä½¿ç¨åºäºåå¸åççç³»ç»ä¸­,æ¥æâç¸è¿âçé®çææ¡£ å¾å¯è½ä¸ä¼ å­å¨å¨åä¸ä¸ªæ°æ®åä¸­,å æ­¤æ°æ®çåç¦»æ§æ´å¥½ä¸äº.\n\nä½¿ç¨nicknameä½ä¸ºçé®ï¼æ ¹æ®å¶å¼çåå¸å¼è¿è¡æ°æ®åç\n\nmongos> sh.shardcollection("articledb.comment",{"nickname":"hashed"})\n{\n    "collectionsharded" : "articledb.comment",\n    "collectionuuid" : uuid("ddea6ed8-ee61-4693-bd16-196acc3a45e8"),\n    "ok" : 1,\n    "operationtime" : timestamp(1564612840, 28),\n    "$clustertime" : {\n        "clustertime" : timestamp(1564612840, 28),\n        "signature" : {\n            "hash" : bindata(0,"aaaaaaaaaaaaaaaaaaaaaaaaaaa="),\n            "keyid" : numberlong(0)\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ¥çåçç¶æï¼sh.status()\n\n databases:\n {  "_id" : "articledb",  "primary" : "myshardrs02",  "partitioned" : true,  "version" : {  "uuid" : uuid("251436b7-86c2-4cd8-9a88-70874af29364"), "lastmod" : 1 } }\n     articledb.comment\n         shard key: { "nickname" : "hashed" }\n         unique: false\n         balancing: true\n         chunks:\n             myshardrs01   2\n             myshardrs02   2\n         { "nickname" : { "$minkey" : 1 } } --\x3e> { "nickname" : numberlong("-4611686018427387902") } on : myshardrs01 timestamp(1, 0)\n         { "nickname" : numberlong("-4611686018427387902") } --\x3e> { "nickname" : numberlong(0) } on : myshardrs01 timestamp(1, 1)\n         { "nickname" : numberlong(0) } --\x3e> { "nickname" : numberlong("4611686018427387902") } on : myshardrs02 timestamp(1, 2)\n         { "nickname" : numberlong("4611686018427387902") } --\x3e> { "nickname" : { "$maxkey" : 1 } } on : myshardrs02 timestamp(1, 3)\n\n{  "_id" : "config",  "primary" : "config",  "partitioned" : true }\n    config.system.sessions\n        shard key: { "_id" : 1 }\n        unique: false\n        balancing: true\n        chunks:\n            myshardrs01   1\n        { "_id" : { "$minkey" : 1 } } --\x3e> { "_id" : { "$maxkey" : 1 } } on : myshardrs01 timestamp(1, 0)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nåçè§åäºï¼èå´ç­ç¥\n\nå¯¹äº åºäºèå´çåç ,mongodbæç§çé®çèå´ææ°æ®åæä¸åé¨å.åè®¾æä¸ä¸ªæ°å­ççé®:æ³è±¡ä¸ä¸ªä»è´æ ç©·å°æ­£æ ç©·çç´çº¿,æ¯ä¸ä¸ªçé®çå¼é½å¨ç´çº¿ä¸ç»äºä¸ä¸ªç¹.mongodbæè¿æ¡ç´çº¿ååä¸ºæ´ç­çä¸éå ççæ®µ,å¹¶ç§°ä¹ä¸º æ°æ®å ,æ¯ä¸ªæ°æ®ååå«äºçé®å¨ä¸å®èå´åçæ°æ®.\n\nå¨ä½¿ç¨çé®åèå´ååçç³»ç»ä¸­,æ¥æâç¸è¿âçé®çææ¡£å¾å¯è½å­å¨å¨åä¸ä¸ªæ°æ®åä¸­,å æ­¤ä¹ä¼å­å¨å¨åä¸ä¸ªåçä¸­.\n\nå¦ä½¿ç¨ä½èå¹´é¾å­æ®µä½ä¸ºçé®ï¼æç§ç¹èµæ°çå¼è¿è¡åçï¼\n\nmongos> sh.shardcollection("articledb.author",{"age":1})\n{\n    "collectionsharded" : "articledb.author",\n    "collectionuuid" : uuid("9a47bdaa-213a-4039-9c18-e70bfc369df7"),\n    "ok" : 1,\n    "operationtime" : timestamp(1567512803, 13),\n    "$clustertime" : {\n        "clustertime" : timestamp(1567512803, 13),\n        "signature" : {\n            "hash" : bindata(0,"ee9qt5ye5sl1tyr7+3u8gry5+5q="),\n            "keyid" : numberlong("6732061237309341726")\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\næ³¨æçæ¯ï¼\n\n * ä¸ä¸ªéååªè½æå®ä¸ä¸ªçé®ï¼å¦åæ¥éã\n * ä¸æ¦å¯¹ä¸ä¸ªéååçï¼åçé®ååçå¼å°±ä¸å¯æ¹åã å¦ï¼ä¸è½ç»éåéæ©ä¸åçåçé®ãä¸è½æ´æ°åçé®çå¼ã\n * æ ¹æ®ageç´¢å¼è¿è¡åéæ°æ®ã\n\næ¥çåçç¶æï¼\n\narticledb.author\n    shard key: { "age" : 1 }\n    unique: false\n    balancing: true\n    chunks:\n        myshardrs01 1\n    { "age" : { "$minkey" : 1 } } --\x3e> { "age" : { "$maxkey" : 1 } } on : myshardrs01 timestamp(1, 0)\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nåºäºèå´çåçæ¹å¼ä¸åºäºåå¸çåçæ¹å¼æ§è½å¯¹æ¯ï¼\n\nåºäºèå´çåçæ¹å¼æä¾äºæ´é«æçèå´æ¥è¯¢,ç»å®ä¸ä¸ªçé®çèå´,ååè·¯ç±å¯ä»¥å¾ç®åå°ç¡®å®åªä¸ªæ°æ®åå­å¨äºè¯·æ±éè¦çæ°æ®,å¹¶å°è¯·æ±è½¬åå°ç¸åºçåçä¸­.\n\nä¸è¿,åºäºèå´çåçä¼å¯¼è´æ°æ®å¨ä¸ååçä¸çä¸åè¡¡,ææ¶å,å¸¦æ¥çæ¶æä½ç¨ä¼å¤§äºæ¥è¯¢æ§è½çç§¯æä½ç¨.æ¯å¦,å¦æçé®æå¨çå­æ®µæ¯çº¿æ§å¢é¿ç,ä¸å®æ¶é´åçææè¯·æ±é½ä¼è½å°æä¸ªåºå®çæ°æ®åä¸­,æç»å¯¼è´åå¸å¨åä¸ä¸ªåçä¸­.å¨è¿ç§æåµä¸,ä¸å°é¨ååçæ¿è½½äºéç¾¤å¤§é¨åçæ°æ®,ç³»ç»å¹¶ä¸è½å¾å¥½å°è¿è¡æ©å±.\n\nä¸æ­¤ç¸æ¯,åºäºåå¸çåçæ¹å¼ä»¥èå´æ¥è¯¢æ§è½çæå¤±ä¸ºä»£ä»·,ä¿è¯äºéç¾¤ä¸­æ°æ®çåè¡¡.åå¸å¼çéæºæ§ä½¿æ°æ®éæºåå¸å¨æ¯ä¸ªæ°æ®åä¸­,å æ­¤ä¹éæºåå¸å¨ä¸ååçä¸­.ä½æ¯ä¹æ­£ç±äºéæºæ§,ä¸ä¸ªèå´æ¥è¯¢å¾é¾ç¡®å®åºè¯¥è¯·æ±åªäºåç,éå¸¸ä¸ºäºè¿åéè¦çç»æ,éè¦è¯·æ±ææåç.\n\nå¦æ ç¹æ®æåµï¼ä¸è¬æ¨èä½¿ç¨ hash shardingã\n\nèä½¿ç¨ _id ä½ä¸ºçé®æ¯ä¸ä¸ªä¸éçéæ©ï¼å ä¸ºå®æ¯å¿æçï¼ä½ å¯ä»¥ä½¿ç¨æ°æ®ææ¡£ _id çåå¸ä½ä¸ºçé®ã\n\nè¿ä¸ªæ¹æ¡è½å¤æ¯çè¯»ååé½è½å¤å¹³ååå¸ï¼å¹¶ä¸å®è½å¤ä¿è¯æ¯ä¸ªææ¡£é½æä¸åççé®æä»¥æ°æ®åè½å¤å¾ç²¾ç»ã\n\nä¼¼ä¹è¿æ¯ä¸å¤å®ç¾ï¼å ä¸ºè¿æ ·çè¯å¯¹å¤ä¸ªææ¡£çæ¥è¯¢å¿å°å½ä¸­ææçåçãè½è¯´å¦æ­¤ï¼è¿ä¹æ¯ä¸ç§æ¯è¾å¥½çæ¹æ¡äºã\n\nçæ³åç shard key å¯ä»¥è®© documents ååå°å¨éç¾¤ä¸­åå¸ï¼\n\n\n\næ¾ç¤ºéç¾¤çè¯¦ç»ä¿¡æ¯ï¼\n\nmongos> db.printshardingstatus()\n\n\n1\n\n\næ¥çåè¡¡å¨æ¯å¦å·¥ä½ï¼éè¦éæ°åè¡¡æ¶ç³»ç»æä¼èªå¨å¯å¨ï¼ä¸ç¨ç®¡å®ï¼ï¼\n\nmongos> sh.isbalancerrunning()\nfalse\n\n\n1\n2\n\n\næ¥çå½å balancerç¶æï¼\n\nmongos> sh.getbalancerstate()\ntrue\n\n\n1\n2\n\n\n\n# 2.6.3 åçåæå¥æ°æ®æµè¯\n\næµè¯ä¸ï¼åå¸è§åï¼ï¼ç»å½mongsåï¼åcommentå¾ªç¯æå¥1000æ¡æ°æ®åæµè¯ï¼\n\nmongos> use articledb\nswitched to db articledb\nmongos> for(var i=1;i<=1000;i++){db.comment.insert({_id:i+"",nickname:"bobo"+i})}\nwriteresult({ "ninserted" : 1 })\nmongos> db.comment.count()\n1000\n\n\n1\n2\n3\n4\n5\n6\n\n\næç¤ºï¼ jsçè¯­æ³ï¼å ä¸ºmongoçshellæ¯ä¸ä¸ªjavascriptçshellã\n\næ³¨æï¼ä»è·¯ç±ä¸æå¥çæ°æ®ï¼å¿é¡»åå«çé®ï¼å¦åæ æ³æå¥ã\n\nåå«ç»éä¸¤ä¸ªççä¸»èç¹ï¼ç»è®¡ææ¡£æ°é\n\nç¬¬ä¸ä¸ªåçå¯æ¬éï¼\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27018\n\nmyshardrs01:primary> use articledb\nswitched to db articledb\nmyshardrs01:primary> db.comment.count()\n507\n\n\n1\n2\n3\n4\n5\n6\n\n\nç¬¬äºä¸ªåçå¯æ¬éï¼\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27318\n\nmyshardrs02:primary> use articledb\nswitched to db articledb\nmyshardrs02:primary> db.comment.count()\n493\n\n\n1\n2\n3\n4\n5\n6\n\n\nå¯ä»¥çå°ï¼ 1000æ¡æ°æ®è¿ä¼¼ååçåå¸å°äº2ä¸ªshardä¸ãæ¯æ ¹æ®çé®çåå¸å¼åéçã\n\nè¿ç§åéæ¹å¼éå¸¸æäºæ°´å¹³æ©å±ï¼ä¸æ¦æ°æ®å­å¨éè¦æ´å¤§ç©ºé´ï¼å¯ä»¥ç´æ¥åå¢å åçå³å¯ï¼åæ¶æåäºæ§è½ã\n\nä½¿ç¨db.comment.stats()æ¥çåä¸ªéåçå®æ´æåµï¼mongosæ§è¡è¯¥å½ä»¤å¯ä»¥æ¥çè¯¥éåçæ°æ®åççæåµã\n\nä½¿ç¨sh.status()æ¥çæ¬åºåææéåçåçä¿¡æ¯ã\n\næµè¯äºï¼èå´è§åï¼ï¼ç»å½mongsåï¼åcommentå¾ªç¯æå¥1000æ¡æ°æ®åæµè¯ï¼\n\nmongos> use articledb\nswitched to db articledb\nmongos> for(var i=1;i<=20000;i++){db.author.save({"name":"bobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobobo"+i,"age":numberint(i%120)})}\nwriteresult({ "ninserted" : 1 })\nmongos> db.comment.count()\n20000\n\n\n1\n2\n3\n4\n5\n6\n\n\næå¥æååï¼ä»ç¶è¦åå«æ¥çä¸¤ä¸ªåçå¯æ¬éçæ°æ®æåµã\n\nåçææï¼\n\narticledb.author\n    shard key: { "age" : 1 }\n    unique: false\n    balancing: true\n    chunks:\n        myshardrs01 2\n        myshardrs02 1\n    { "age" : { "$minkey" : 1 } } --\x3e> { "age" : 0 } on : myshardrs02 timestamp(2, 0)\n    { "age" : 0 } --\x3e> { "age" : 112 } on : myshardrs01 timestamp(2, 1)\n    { "age" : 112 } --\x3e> { "age" : { "$maxkey" : 1 } } on : myshardrs01 timestamp(1, 3)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næç¤ºï¼\n\nå¦ææ¥çç¶æåç°æ²¡æåçï¼åå¯è½æ¯ç±äºä»¥ä¸åå é æäºï¼\n\n * ç³»ç»ç¹å¿ï¼æ­£å¨åçä¸­ã\n\n * æ°æ®åï¼chunkï¼æ²¡æå¡«æ»¡ï¼é»è®¤çæ°æ®åå°ºå¯¸ï¼chunksizeï¼æ¯64mï¼å¡«æ»¡åæä¼èèåå¶ä»ççæ°æ®åå¡«åæ°æ®ï¼å æ­¤ï¼ä¸ºäºæµè¯ï¼å¯ä»¥å°å¶æ¹å°ï¼è¿éæ¹ä¸º1mï¼æä½å¦ä¸ï¼\n   \n   use config\n   db.settings.save( { _id:"chunksize", value: 1 } )\n   \n   \n   1\n   2\n   \n   \n   æµè¯å®æ¹åæ¥ï¼\n   \n   db.settings.save( { _id:"chunksize", value: 64 } )\n   \n   \n   1\n   \n\næ³¨æï¼è¦åæ¹å°ï¼åè®¾ç½®åçãä¸ºäºæµè¯ï¼å¯ä»¥åå é¤éåï¼éæ°å»ºç«éåçåçç­ç¥ï¼åæå¥æ°æ®æµè¯å³å¯ã\n\n\n# 2.6.4 åå¢å ä¸ä¸ªè·¯ç±èç¹\n\næä»¶å¤¹ï¼\n\n#-----------mongos02\nmkdir -p /mongodb/sharded_cluster/mymongos_27117/log\n\n\n1\n2\n\n\næ°å»ºæä¿®æ¹éç½®æä»¶ï¼\n\nvi /mongodb/sharded_cluster/mymongos_27117/mongos.conf\n\n\n1\n\n\nmongos.confï¼\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/sharded_cluster/mymongos_27117/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: /mongodb/sharded_cluster/mymongos_27117/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®ææipï¼æå¯ä½ç¨ï¼å¯æ¬éåå§åçæ¶åï¼èç¹åå­ä¼èªå¨è®¾ç½®ä¸ºæ¬å°ååï¼èä¸æ¯ip\n    #bindipall: true\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #bindip\n    #ç»å®çç«¯å£\n    port: 27117\nsharding:\n    configdb: myconfigrs/180.76.159.126:27019,180.76.159.126:27119,180.76.159.126:27219\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nå¯å¨mongos2ï¼\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27117/mongos.conf\nabout to fork child process, waiting until server is ready for connections.\nforked process: 129874\nchild process started successfully, parent exiting\n\n\n1\n2\n3\n4\n\n\nä½¿ç¨mongoå®¢æ·ç«¯ç»å½27117ï¼åç°ï¼ç¬¬äºä¸ªè·¯ç±æ ééç½®ï¼å ä¸ºåçéç½®é½ä¿å­å°äºéç½®æå¡å¨ä¸­äºã\n\n\n# 2.7 compass è¿æ¥åçéç¾¤\n\ncompassè¿æ¥ï¼\n\n\n\næç¤ºï¼åè¿æ¥åæº mongodä¸æ ·ã\n\nè¿æ¥æååï¼ä¸æ¹æmongosååçéç¾¤çæç¤ºï¼\n\n\n\n\n# 2.8 springdatamongdb è¿æ¥åçéç¾¤\n\njavaå®¢æ·ç«¯å¸¸ç¨çæ¯springdatamongodbï¼å¶è¿æ¥çæ¯mongsè·¯ç±ï¼éç½®ååæºmongodçéç½®æ¯ä¸æ ·çã\n\nå¤ä¸ªè·¯ç±çæ¶åçspringdatamongodbçå®¢æ·ç«¯éç½®åèå¦ä¸ï¼\n\nspring:\n    #æ°æ®æºéç½®\n    data:\n        mongodb:\n            # ä¸»æºå°å\n            #   host: 180.76.159.126\n            # æ°æ®åº\n            #   database: articledb\n            # é»è®¤ç«¯å£æ¯27017\n            #   port: 27017\n            #ä¹å¯ä»¥ä½¿ç¨uriè¿æ¥\n            #   uri: mongodb://192.168.40.134:28017/articledb\n            # è¿æ¥å¯æ¬éå­ç¬¦ä¸²\n            #   uri: mongodb://180.76.159.126:27017,180.76.159.126:27018,180.76.159.126:27019/articledb?connect=replicaset&slaveok=true&replicaset=myrs\n            #è¿æ¥è·¯ç±å­ç¬¦ä¸²\n            uri: mongodb://180.76.159.126:27017,180.76.159.126:27117/articledb\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\néè¿æ¥å¿åç°ï¼åå¥æ°æ®çæ¶åï¼ä¼éæ©ä¸ä¸ªè·¯ç±åå¥\n\n\n# 2.9 æ¸é¤ææçèç¹æ°æ®ï¼å¤ç¨ï¼\n\nå¦æå¨æ­å»ºåççæ¶åææä½å¤±è´¥æéç½®æé®é¢ï¼éè¦éæ°æ¥è¿çï¼å¯ä»¥è¿è¡å¦ä¸æä½ï¼\n\nç¬¬ä¸æ­¥ï¼æ¥è¯¢åºææçæµè¯æå¡èç¹çè¿ç¨ï¼\n\n[root@bobohost sharded_cluster]# ps -ef |grep mongo\nroot    10184    1  0 06:04 ?     00:01:25 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\nroot    10219    1  0 06:04 ?     00:01:25 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\nroot    10253    1  0 06:04 ?     00:00:46 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\nroot    10312    1  0 06:04 ?     00:01:23 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27318/mongod.conf\nroot    10346    1  0 06:05 ?     00:01:23 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27418/mongod.conf\nroot    10380    1  0 06:05 ?     00:00:44 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27518/mongod.conf\nroot    10414    1  1 06:05 ?     00:01:36 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27019/mongod.conf\nroot    10453    1  1 06:05 ?     00:01:37 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27119/mongod.conf\nroot    10492    1  1 06:05 ?     00:01:38 /usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27219/mongod.conf\nroot    11392    1  0 06:15 ?     00:00:24 /usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27017/mongos.conf\nroot    14829    1  0 07:15 ?     00:00:13 /usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27117/mongos.conf\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ ¹æ®ä¸è¿°çè¿ç¨ç¼å·ï¼ä¾æ¬¡ä¸­æ­è¿ç¨ï¼\n\nkill -2 è¿ç¨ç¼å·\n\n\n1\n\n\nç¬¬äºæ­¥ï¼æ¸é¤ææçèç¹çæ°æ®ï¼\n\nrm -rf /mongodb/sharded_cluster/myconfigrs_27019/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myconfigrs_27119/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myconfigrs_27219/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myshardrs01_27018/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myshardrs01_27118/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myshardrs01_27218/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myshardrs02_27318/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myshardrs02_27418/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/myshardrs02_27518/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/mymongos_27017/data/db/*.* \\ &\nrm -rf /mongodb/sharded_cluster/mymongos_27117/data/db/*.*\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nç¬¬ä¸æ­¥ï¼æ¥çæä¿®æ¹æé®é¢çéç½®\n\nç¬¬åæ­¥ï¼ä¾æ¬¡å¯å¨ææèç¹ï¼ä¸åæ¬è·¯ç±èç¹ï¼\n\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27318/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27418/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27518/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27019/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27119/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27219/mongod.conf\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nç¬¬äºæ­¥ï¼å¯¹ä¸¤ä¸ªæ°æ®åçå¯æ¬éåä¸ä¸ªéç½®å¯æ¬éè¿è¡åå§ååç¸å³éç½®\n\nç¬¬å­æ­¥ï¼æ£æ¥è·¯ç±mongosçéç½®ï¼å¹¶å¯å¨mongos\n\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/mymongos_27017/mongos.cfg\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/mymongos_27017/mongos.cfg\n\n\n1\n2\n\n\nç¬¬ä¸æ­¥ï¼mongoç»å½mongosï¼å¨å¶ä¸è¿è¡ç¸å³æä½ã\n\n\n# 3. å®å¨è®¤è¯\n\n\n# 3.1 mongodb çç¨æ·åè§è²æéç®ä»\n\né»è®¤æåµä¸ï¼mongodbå®ä¾å¯å¨è¿è¡æ¶æ¯æ²¡æå¯ç¨ç¨æ·è®¿é®æéæ§å¶çï¼ä¹å°±æ¯è¯´ï¼å¨å®ä¾æ¬æºæå¡å¨ä¸é½å¯ä»¥éæè¿æ¥å°å®ä¾è¿è¡åç§æä½ï¼mongodbä¸ä¼å¯¹è¿æ¥å®¢æ·ç«¯è¿è¡ç¨æ·éªè¯ï¼è¿æ¯éå¸¸å±é©çã\n\nmongodbå®ç½ä¸è¯´ï¼ä¸ºäºè½ä¿émongodbçå®å¨å¯ä»¥åä»¥ä¸å ä¸ªæ­¥éª¤ï¼\n\n * ä½¿ç¨æ°çç«¯å£ï¼é»è®¤ç27017ç«¯å£å¦æä¸æ¦ç¥éäºipå°±è½è¿æ¥ä¸ï¼ä¸å¤ªå®å¨ã\n * è®¾ç½®mongodbçç½ç»ç¯å¢ï¼æå¥½å°mongodbé¨ç½²å°å¬å¸æå¡å¨åç½ï¼è¿æ ·å¤ç½æ¯è®¿é®ä¸å°çãå¬å¸åé¨è®¿é®ä½¿ç¨vpnç­ã\n * å¼å¯å®å¨è®¤è¯ãè®¤è¯è¦åæ¶è®¾ç½®æå¡å¨ä¹é´çåé¨è®¤è¯æ¹å¼ï¼åæ¶è¦è®¾ç½®å®¢æ·ç«¯è¿æ¥å°éç¾¤çè´¦å·å¯ç è®¤è¯æ¹å¼ã\n\nä¸ºäºå¼ºå¶å¼å¯ç¨æ·è®¿é®æ§å¶(ç¨æ·éªè¯)ï¼åéè¦å¨mongodbå®ä¾å¯å¨æ¶ä½¿ç¨éé¡¹ â auth æå¨æå®å¯å¨éç½®æä»¶ä¸­æ·»å éé¡¹ auth=true ã\n\nå¨å¼å§ä¹åéè¦äºè§£ä¸ä¸æ¦å¿µ\n\n1ï¼å¯ç¨è®¿é®æ§å¶ï¼\n\nmongodbä½¿ç¨çæ¯åºäºè§è²çè®¿é®æ§å¶(role-based access control,rbac)æ¥ç®¡çç¨æ·å¯¹å®ä¾çè®¿é®ãéè¿å¯¹ç¨æ·æäºä¸ä¸ªæå¤ä¸ªè§è²æ¥æ§å¶ç¨æ·è®¿é®æ°æ®åºèµæºçæéåæ°æ®åºæä½çæéï¼å¨å¯¹ç¨æ·åéè§è²ä¹åï¼ç¨æ·æ æ³è®¿é®å®ä¾ã\n\nå¨å®ä¾å¯å¨æ¶æ·»å éé¡¹ â auth ææå®å¯å¨éç½®æä»¶ä¸­æ·»å éé¡¹ auth=true ã\n\n2ï¼è§è²ï¼\n\nå¨mongodbä¸­éè¿è§è²å¯¹ç¨æ·æäºç¸åºæ°æ®åºèµæºçæä½æéï¼æ¯ä¸ªè§è²å½ä¸­çæéå¯ä»¥æ¾å¼æå®ï¼ä¹å¯ä»¥éè¿ç»§æ¿å¶ä»è§è²çæéï¼æèä¸¤é½é½å­å¨çæéã\n\n3ï¼æéï¼\n\næéç±æå®çæ°æ®åºèµæº(resource)ä»¥ååè®¸å¨æå®èµæºä¸è¿è¡çæä½(action)ç»æã\n\n * èµæº(resource)åæ¬ï¼æ°æ®åºãéåãé¨åéååéç¾¤ï¼\n * æä½(action)åæ¬ï¼å¯¹èµæºè¿è¡çå¢ãå ãæ¹ãæ¥(crud)æä½ã\n\nå¨è§è²å®ä¹æ¶å¯ä»¥åå«ä¸ä¸ªæå¤ä¸ªå·²å­å¨çè§è²ï¼æ°åå»ºçè§è²ä¼ç»§æ¿åå«çè§è²ææçæéãå¨åä¸ä¸ªæ°æ®åºä¸­ï¼æ°åå»ºè§è²å¯ä»¥ç»§æ¿å¶ä»è§è²çæéï¼å¨ admin æ°æ®åºä¸­åå»ºçè§è²å¯ä»¥ç»§æ¿å¨å¶å®ä»»ææ°æ®åºä¸­è§è²çæéã\n\nå³äºè§è²æéçæ¥çï¼å¯ä»¥éè¿å¦ä¸å½ä»¤æ¥è¯¢ï¼äºè§£ï¼ï¼\n\n// æ¥è¯¢ææè§è²æé(ä»ç¨æ·èªå®ä¹è§è²)\n> db.runcommand({ rolesinfo: 1 })\n\n// æ¥è¯¢ææè§è²æé(åå«åç½®è§è²)\n> db.runcommand({ rolesinfo: 1, showbuiltinroles: true })\n\n// æ¥è¯¢å½åæ°æ®åºä¸­çæè§è²çæé\n> db.runcommand({ rolesinfo: "<rolename>" })\n// æ¥è¯¢å¶å®æ°æ®åºä¸­æå®çè§è²æé\n> db.runcommand({ rolesinfo: { role: "<rolename>", db: "<database>" } }\n// æ¥è¯¢å¤ä¸ªè§è²æé\n> db.runcommand(\n    {\n        rolesinfo: [\n            "<rolename>",\n            { role: "<rolename>", db: "<database>" },\n            ...\n        ]  \n    }\n)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nç¤ºä¾ï¼\n\næ¥çææåç½®è§è²ï¼\n\n> db.runcommand({ rolesinfo: 1, showbuiltinroles: true })\n{\n    "roles" : [\n        {\n            "role" : "__queryablebackup",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "__system",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "backup",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "clusteradmin",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "clustermanager",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "clustermonitor",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "dbadmin",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "dbadminanydatabase",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "dbowner",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "enablesharding",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "hostmanager",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "read",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "readanydatabase",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "readwrite",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "readwriteanydatabase",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "restore",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "root",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "useradmin",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        },\n        {\n            "role" : "useradminanydatabase",\n            "db" : "admin",\n            "isbuiltin" : true,\n            "roles" : [ ],\n            "inheritedroles" : [ ]\n        }\n    ],\n    "ok" : 1\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n134\n135\n136\n137\n138\n139\n\n\nå¸¸ç¨çåç½®è§è²ï¼\n\n * æ°æ®åºç¨æ·è§è²ï¼ readãreadwrite;\n * æææ°æ®åºç¨æ·è§è²ï¼ readanydatabaseãreadwriteanydatabaseãuseradminanydatabaseãdbadminanydatabase\n * æ°æ®åºç®¡çè§è²ï¼ dbadminãdbownerãuseradminï¼\n * éç¾¤ç®¡çè§è²ï¼ clusteradminãclustermanagerãclustermonitorãhostmanagerï¼\n * å¤ä»½æ¢å¤è§è²ï¼ backupãrestoreï¼\n * è¶çº§ç¨æ·è§è²ï¼ root\n * åé¨è§è²ï¼ system\n\nè§è²è¯´æï¼\n\nè§è²                     æéæè¿°\nread                   å¯ä»¥è¯»åæå®æ°æ®åºä¸­ä»»ä½æ°æ®\nreadwrite              å¯ä»¥è¯»åæå®æ°æ®åºä¸­ä»»ä½æ°æ®ï¼åæ¬åå»ºãéå½åãå é¤éå\nreadanydatabase        å¯ä»¥è¯»åæææ°æ®åºä¸­ä»»ä½æ°æ®(é¤äºæ°æ®åºconfigålocalä¹å¤)\nreadwriteanydatabase   å¯ä»¥è¯»åæææ°æ®åºä¸­ä»»ä½æ°æ®(é¤äºæ°æ®åºconfigålocalä¹å¤)\nuseradminanydatabase   å¯ä»¥å¨æå®æ°æ®åºåå»ºåä¿®æ¹ç¨æ·(é¤äºæ°æ®åºconfigålocalä¹å¤)\ndbadminanydatabase     å¯ä»¥è¯»åä»»ä½æ°æ®åºä»¥åå¯¹æ°æ®åºè¿è¡æ¸çãä¿®æ¹ãåç¼©ãè·åç»è®¡ä¿¡æ¯ãæ§è¡æ£æ¥ç­æä½(é¤äºæ°æ®åºconfigålocalä¹å¤)\ndbadmin                å¯ä»¥è¯»åæå®æ°æ®åºä»¥åå¯¹æ°æ®åºè¿è¡æ¸çãä¿®æ¹ãåç¼©ãè·åç»è®¡ä¿¡æ¯ãæ§è¡æ£æ¥ç­æä½\nuseradmin              å¯ä»¥å¨æå®æ°æ®åºåå»ºåä¿®æ¹ç¨æ·\nclusteradmin           å¯ä»¥å¯¹æ´ä¸ªéç¾¤ææ°æ®åºç³»ç»è¿è¡ç®¡çæä½\nbackup                 å¤ä»½mongodbæ°æ®æå°çæé\nrestore                ä»å¤ä»½æä»¶ä¸­è¿åæ¢å¤mongodbæ°æ®(é¤äºsystem.profileéå)çæé\nroot                   è¶çº§è´¦å·ï¼è¶çº§æé\n\n\n# 3.2 åå®ä¾ç¯å¢\n\nç®æ ï¼å¯¹åå®ä¾çmongodbæå¡å¼å¯å®å¨è®¤è¯ï¼è¿éçåå®ä¾æçæ¯æªå¼å¯å¯æ¬éæåççmongodbå®ä¾ã\n\n\n# 3.2.1 å³é­å·²å¼å¯çæå¡\n\nå¢å mongodçåå®ä¾çå®å¨è®¤è¯åè½ï¼å¯ä»¥å¨æå¡æ­å»ºçæ¶åç´æ¥æ·»å ï¼ä¹å¯ä»¥å¨ä¹åæ­å»ºå¥½çæå¡ä¸æ·»å ã\n\næ¬æä½¿ç¨ä¹åæ­å»ºå¥½çæå¡ï¼å æ­¤ï¼ååæ­¢ä¹åçæå¡\n\nåæ­¢æå¡çæ¹å¼æä¸¤ç§ï¼å¿«éå³é­åæ åå³é­ï¼ä¸é¢ä¾æ¬¡è¯´æï¼\n\nï¼1ï¼å¿«éå³é­æ¹æ³ï¼å¿«éï¼ç®åï¼æ°æ®å¯è½ä¼åºéï¼\n\nç®æ ï¼éè¿ç³»ç»çkillå½ä»¤ç´æ¥ææ­»è¿ç¨ï¼\n\næå®è¦æ£æ¥ä¸ä¸ï¼é¿åæçæ²¡æææã\n\n#éè¿è¿ç¨ç¼å·å³é­èç¹\nkill -2 54410\n\n\n1\n2\n\n\nãè¡¥åã\n\nå¦æä¸æ¦æ¯å ä¸ºæ°æ®æåï¼åéè¦è¿è¡å¦ä¸æä½ï¼äºè§£ï¼ï¼\n\n1ï¼å é¤lockæä»¶ï¼\n\nrm -f /mongodb/single/data/db/*.lock\n\n\n1\n\n\n2 ï¼ä¿®å¤æ°æ®ï¼\n\n/usr/local/mongodb/bin/mongod --repair --dbpath=/mongodb/single/data/db\n\n\n1\n\n\nï¼2ï¼æ åçå³é­æ¹æ³ï¼æ°æ®ä¸å®¹æåºéï¼ä½éº»ç¦ï¼ï¼\n\nç®æ ï¼éè¿mongoå®¢æ·ç«¯ä¸­çshutdownserverå½ä»¤æ¥å³é­æå¡\n\nä¸»è¦çæä½æ­¥éª¤åèå¦ä¸ï¼\n\n//å®¢æ·ç«¯ç»å½æå¡ï¼æ³¨æï¼è¿ééè¿localhostç»å½ï¼å¦æéè¦è¿ç¨ç»å½ï¼å¿é¡»åç»å½è®¤è¯æè¡ã\nmongo --port 27017\n//#åæ¢å°adminåº\nuse admin\n//å³é­æå¡\ndb.shutdownserver()\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 3.2.2 æ·»å ç¨æ·åæé\n\nï¼1ï¼åæç§æ®éæ ææè®¤è¯çéç½®ï¼æ¥éç½®æå¡ç«¯çéç½®æä»¶ /mongodb/single/mongod.conf\n\nsystemlog:\n    #mongodbåéæææ¥å¿è¾åºçç®æ æå®ä¸ºæä»¶\n    destination: file\n    #mongodæmongosåºåå¶åéææè¯æ­æ¥å¿è®°å½ä¿¡æ¯çæ¥å¿æä»¶çè·¯å¾\n    path: "/mongodb/single/log/mongod.log"\n    #å½mongosæmongodå®ä¾éæ°å¯å¨æ¶ï¼mongosæmongodä¼å°æ°æ¡ç®éå å°ç°ææ¥å¿æä»¶çæ«å°¾ã\n    logappend: true\nstorage:\n    #mongodå®ä¾å­å¨å¶æ°æ®çç®å½ãstorage.dbpathè®¾ç½®ä»éç¨äºmongodã\n    dbpath: "/mongodb/single/data/db"\n    journal:\n        #å¯ç¨æç¦ç¨æä¹æ§æ¥å¿ä»¥ç¡®ä¿æ°æ®æä»¶ä¿æææåå¯æ¢å¤ã\n        enabled: true\nprocessmanagement:\n    #å¯ç¨å¨åå°è¿è¡mongosæmongodè¿ç¨çå®æ¤è¿ç¨æ¨¡å¼ã\n    fork: true\n    #æå®ç¨äºä¿å­mongosæmongodè¿ç¨çè¿ç¨idçæä»¶ä½ç½®ï¼å¶ä¸­mongosæmongodå°åå¥å¶pid\n    pidfilepath: "/mongodb/single/log/mongod.pid"\nnet:\n    #æå¡å®ä¾ç»å®çip\n    bindip: localhost,192.168.0.2\n    #ç»å®çç«¯å£\n    port: 27017\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n\n\nï¼2ï¼æä¹åæªå¼å¯è®¤è¯çæ¹å¼ï¼ä¸æ·»å  â auth åæ°ï¼æ¥å¯å¨mongodbæå¡\n\n/usr/local/mongodb/bin/mongod -f /mongodb/single/mongod.conf\n\n\n1\n\n\næç¤ºï¼\n\nå¨æä½ç¨æ·æ¶ï¼å¯å¨mongodæå¡æ¶å°½éä¸è¦å¼å¯ææã\n\nï¼3ï¼ä½¿ç¨mongoå®¢æ·ç«¯ç»å½\n\n/usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017\n\n\n1\n\n\nï¼4ï¼åå»ºä¸¤ä¸ªç®¡çåç¨æ·ï¼ä¸ä¸ªæ¯ç³»ç»çè¶çº§ç®¡çå myroot ï¼ä¸ä¸ªæ¯adminåºçç®¡çç¨æ·myadmin\n\n//åæ¢å°adminåº\n> use admin\n\n//åå»ºç³»ç»è¶çº§ç¨æ· myroot,è®¾ç½®å¯ç 123456ï¼è®¾ç½®è§è²root\n//> db.createuser({user:"myroot",pwd:"123456",roles:[ { "role" : "root", "db" : "admin" } ]})\n//æ\n> db.createuser({user:"myroot",pwd:"123456",roles:["root"]})\n\n//åå»ºä¸é¨ç¨æ¥ç®¡çadminåºçè´¦å·myadminï¼åªç¨æ¥ä½ä¸ºç¨æ·æéçç®¡ç\n> db.createuser({user:"myadmin",pwd:"123456",roles: [{role:"useradminanydatabase",db:"admin"}]})\n\n//æ¥çå·²ç»åå»ºäºçç¨æ·çæåµï¼\n> db.system.users.find()\n\n//å é¤ç¨æ·\n> db.dropuser("myadmin")\ntrue\n\n//ä¿®æ¹å¯ç \n> db.changeuserpassword("myroot", "123456")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\næç¤ºï¼\n\n * æ¬æ¡ä¾åå»ºäºä¸¤ä¸ªç¨æ·ï¼åå«å¯¹åºè¶ç®¡åä¸é¨ç¨æ¥ç®¡çç¨æ·çè§è²ï¼äºå®ä¸ï¼ä½ åªéè¦ä¸ä¸ªç¨æ·å³å¯ãå¦æä½ å¯¹å®å¨è¦æ±å¾é«ï¼é²æ­¢è¶ç®¡æ³æ¼ï¼åä¸è¦åå»ºè¶ç®¡ç¨æ·ã\n * åå¶å®æ°æ®åºï¼mysqlï¼ä¸æ ·ï¼æéçç®¡çé½å·®ä¸å¤ä¸æ ·ï¼ä¹æ¯å°ç¨æ·åæéä¿¡æ¯ä¿å­å°æ°æ®åºå¯¹åºçè¡¨ä¸­ãmongodbå­å¨ææçç¨æ·ä¿¡æ¯å¨admin æ°æ®åºçéåsystem.usersä¸­ï¼ä¿å­ç¨æ·åãå¯ç åæ°æ®åºä¿¡æ¯ã\n * å¦æä¸æå®æ°æ®åºï¼ååå»ºçæå®çæéçç¨æ·å¨ææçæ°æ®åºä¸ææï¼å¦ {role: âuseradminanydatabaseâ, db:ââ}\n\nï¼5ï¼è®¤è¯æµè¯\n\næµè¯æ·»å çç¨æ·æ¯å¦æ­£ç¡®\n\n//åæ¢å°admin\n> use admin\n\n//å¯ç è¾é\n> db.auth("myroot","12345")\nerror: authentication failed.\n0\n\n//å¯ç æ­£ç¡®\n> db.auth("myroot","123456")\n1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nï¼6ï¼åå»ºæ®éç¨æ·\n\nåå»ºæ®éç¨æ·å¯ä»¥å¨æ²¡æå¼å¯è®¤è¯çæ¶åæ·»å ï¼ä¹å¯ä»¥å¨å¼å¯è®¤è¯ä¹åæ·»å ï¼ä½å¼å¯è®¤è¯ä¹åï¼å¿é¡»ä½¿ç¨ææä½adminåºçç¨æ·ç»å½è®¤è¯åæè½æä½ãåºå±é½æ¯å°ç¨æ·ä¿¡æ¯ä¿å­å¨äºadminæ°æ®åºçéåsystem.usersä¸­\n\n//åå»º(åæ¢)å°æ¥è¦æä½çæ°æ®åºarticledb,\n> use articledb\n\n//åå»ºç¨æ·ï¼æ¥æarticledbæ°æ®åºçè¯»åæéreadwriteï¼å¯ç æ¯123456\n> db.createuser({user: "bobo", pwd: "123456", roles: [{ role: "readwrite", db: "articledb" }]})\n//> db.createuser({user: "bobo", pwd: "123456", roles: ["readwrite"]})\n\n//æµè¯æ¯å¦å¯ç¨\n> db.auth("bobo","123456")\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\næç¤ºï¼\n\nå¦æå¼å¯äºè®¤è¯åï¼ç»å½çå®¢æ·ç«¯çç¨æ·å¿é¡»ä½¿ç¨adminåºçè§è²ï¼å¦æ¥ærootè§è²çmyadminç¨æ·ï¼åéè¿myadminç¨æ·å»åå»ºå¶ä»è§è²çç¨æ·\n\n\n# 3.2.3 æå¡ç«¯å¼å¯è®¤è¯åå®¢æ·ç«¯è¿æ¥ç»å½\n\n# 3.2.3.1 å³é­å·²ç»å¯å¨çæå¡\n\n1ï¼ä½¿ç¨linuxå½ä»¤ææ­»è¿ç¨ï¼\n\n[root@bobohost single]# ps -ef |grep mongo\nroot    23482    1  0 08:08 ?     00:00:55 /usr/local/mongodb/bin/mongod -f /mongodb/single/mongod.conf\n[root@bobohost single]# kill -2 23482\n\n\n1\n2\n3\n\n\n2 ï¼å¨mongoå®¢æ·ç«¯ä¸­ä½¿ç¨shutdownserverå½ä»¤æ¥å³é­\n\n> db.shutdownserver()\nshutdown command only works with the admin database; try \'use admin\'\n> use admin\nswitched to db admin\n> db.shutdownserver()\n2019-08-14t11:20:16.450+0800 e query  [js] error: shutdownserver failed: {\n    "ok" : 0,\n    "errmsg" : "shutdown must run from localhost when running db without auth",\n    "code" : 13,\n    "codename" : "unauthorized"\n    } :\n_geterrorwithcode@src/mongo/shell/utils.js:25:13\ndb.prototype.shutdownserver@src/mongo/shell/db.js:453:1\n@(shell):1:1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\néè¦å ä¸ªæ¡ä»¶ï¼\n\n * å¿é¡»æ¯å¨ adminåºä¸æ§è¡è¯¥å³é­æå¡å½ä»¤ã\n * å¦ææ²¡æå¼å¯è®¤è¯ï¼å¿é¡»æ¯ä» localhostç»éçï¼æè½æ§è¡å³é­æå¡å½ä»¤ã\n * é localhostçãéè¿è¿ç¨ç»å½çï¼å¿é¡»æç»å½ä¸å¿é¡»ç»å½ç¨æ·æå¯¹adminæä½æéæå¯ä»¥ã\n\n# 3.2.3.2 ä»¥å¼å¯è®¤è¯çæ¹å¼å¯å¨æå¡\n\næä¸¤ç§æ¹å¼å¼å¯æéè®¤è¯å¯å¨æå¡ï¼ä¸ç§æ¯åæ°æ¹å¼ï¼ä¸ç§æ¯éç½®æä»¶æ¹å¼\n\n1ï¼åæ°æ¹å¼\n\nå¨å¯å¨æ¶æå®åæ° â auth ï¼å¦ï¼\n\n/usr/local/mongodb/bin/mongod -f /mongodb/single/mongod.conf --auth\n\n\n1\n\n\n2ï¼éç½®æä»¶æ¹å¼\n\nå¨mongod.conféç½®æä»¶ä¸­å å¥ï¼vim /mongodb/single/mongod.conf\n\nsecurity:\n    #å¼å¯ææè®¤è¯\n    authorization: enabled\n\n\n1\n2\n3\n\n\nå¯å¨æ¶å¯ä¸å  â auth åæ°ï¼\n\n/usr/local/mongodb/bin/mongod -f /mongodb/single/mongod.conf\n\n\n1\n\n\n# 3.2.3.3 å¼å¯äºè®¤è¯çæåµä¸çå®¢æ·ç«¯ç»å½\n\næä¸¤ç§è®¤è¯æ¹å¼ï¼ä¸ç§æ¯åç»å½ï¼å¨mongo shellä¸­è®¤è¯ï¼ä¸ç§æ¯ç»å½æ¶ç´æ¥è®¤è¯\n\n1ï¼åè¿æ¥åè®¤è¯\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017\nmongodb shell version v4.0.10\nconnecting to: mongodb://180.76.159.126:27017/?gssapiservicename=mongodb\nimplicit session: session { "id" : uuid("53fef661-35d6-4d29-b07c-020291d62e1a")}\nmongodb server version: 4.0.10\n>\n\n\n1\n2\n3\n4\n5\n6\n\n\næç¤ºï¼\n\nå¼å¯è®¤è¯ååç»å½ï¼åç°æå°çæ¥å¿æ¯è¾å°äºã\n\nç¸å³æä½éè¦è®¤è¯æå¯ä»¥ï¼\n\næ¥è¯¢adminåºä¸­çsystem.userséåçç¨æ·ï¼\n\n> use admin\nswitched to db admin\n> db.system.users.find()\nerror: error: {\n    "ok" : 0,\n    "errmsg" : "command find requires authentication",\n    "code" : 13,\n    "codename" : "unauthorized"\n}\n> db.auth("myroot","123456")\n1\n> db.system.users.find()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\næ¥è¯¢articledbåºä¸­çcommentéåçåå®¹ï¼\n\n> use articledb\nswitched to db articledb\n> db.comment.find()\nerror: error: {\n    "ok" : 0,\n    "errmsg" : "not authorized on articledb to execute command { find: \\"comment\\", filter: {}, lsid: { id: uuid(\\"53fef661-35d6-4d29-b07c-020291d62e1a\\") }, $db: \\"articledb\\" }",\n    "code" : 13,\n    "codename" : "unauthorized"\n}\n> db.auth("bobo","123456")\n1\n> db.comment.find()\nerror: error: {\n    "ok" : 0,\n    "errmsg" : "too many users are authenticated",\n    "code" : 13,\n    "codename" : "unauthorized"\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næç¤ºï¼\n\nè¿éå¯è½åºç°éè¯¯ï¼è¯´æ¯å¤ªå¤çç¨æ·æ­£å¨è®¤è¯äºãå ä¸ºæä»¬ç¡®å®è¿ç»­ç»å½äºä¸¤ä¸ªç¨æ·äºã\n\nè§£å³æ¹æ¡ï¼éåºshellï¼éæ°è¿æ¥ç»å½è®¤è¯\n\n> exit\nbye\n[root@bobohost bin]# ./mongo --host 180.76.159.126 --port 27017\nmongodb shell version v4.0.10\nconnecting to: mongodb://180.76.159.126:27017/?gssapiservicename=mongodb\nimplicit session: session { "id" : uuid("329c1897-566d-4231-bcb3-b2acda301863")\n}\nmongodb server version: 4.0.10\n> db.auth("bobo","123456")\nerror: authentication failed.\n0\n> use articledb\nswitched to db articledb\n> db.auth("bobo","123456")\n1\n> db.comment.find()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n2ï¼è¿æ¥æ¶ç´æ¥è®¤è¯\n\nå¯¹adminæ°æ®åºè¿è¡ç»å½è®¤è¯åç¸å³æä½ï¼\n\n[root@bobohost ~]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017 --authenticationdatabase admin -u myroot -p 123456\nmongodb shell version v4.0.10\nconnecting to: mongodb://180.76.159.126:27017/?\nauthsource=admin&gssapiservicename=mongodb\nimplicit session: session { "id" : uuid("f959b8d6-6994-44bc-9d35-09fc7cd00ba6")\n}\nmongodb server version: 4.0.10\nserver has startup warnings:\n2019-09-10t15:23:40.102+0800 i control [initandlisten] ** warning: you are\nrunning this process as the root user, which is not recommended.\n2019-09-10t15:23:40.102+0800 i control [initandlisten]\n2019-09-10t15:23:40.102+0800 i control [initandlisten]\n2019-09-10t15:23:40.102+0800 i control [initandlisten] ** warning:\n/sys/kernel/mm/transparent_hugepage/enabled is \'always\'.\n2019-09-10t15:23:40.102+0800 i control [initandlisten] **    we suggest\nsetting it to \'never\'\n2019-09-10t15:23:40.102+0800 i control [initandlisten]\n2019-09-10t15:23:40.102+0800 i control [initandlisten] ** warning:\n/sys/kernel/mm/transparent_hugepage/defrag is \'always\'.\n2019-09-10t15:23:40.102+0800 i control [initandlisten] **    we suggest\nsetting it to \'never\'\n2019-09-10t15:23:40.102+0800 i control [initandlisten]\n> show dbs;\nadmin    0.000gb\narticledb  0.000gb\nconfig   0.000gb\nlocal    0.000gb\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n\n\nå¯¹articledbæ°æ®åºè¿è¡ç»å½è®¤è¯åç¸å³æä½ï¼\n\n[root@bobohost bin]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017 --authenticationdatabase articledb -u bobo -p 123456\nmongodb shell version v4.0.10\nconnecting to: mongodb://180.76.159.126:27017/?\nauthsource=articledb&gssapiservicename=mongodb\nimplicit session: session { "id" : uuid("e5d4148f-373b-45b8-9cff-a927ce617100")\n}\nmongodb server version: 4.0.10\n> use articledb\nswitched to db articledb\n> db.comment.find()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\næç¤ºï¼\n\n * -u ï¼ç¨æ·å\n * -p ï¼å¯ç \n * -- authenticationdatabase ï¼æå®è¿æ¥å°åªä¸ªåºãå½ç»å½æ¯æå®ç¨æ·åå¯ç æ¶ï¼å¿é¡»æå®å¯¹åºçæ°æ®åºï¼\n\n\n# 3.2.4 springdatamongodbè¿æ¥è®¤è¯\n\nä½¿ç¨ç¨æ·ååå¯ç è¿æ¥å° mongodb æå¡å¨ï¼ä½ å¿é¡»ä½¿ç¨\'username:password@hostname/dbname\' æ ¼å¼ï¼âusernameâä¸ºç¨æ·åï¼âpasswordâ ä¸ºå¯ç ã\n\nç®æ ï¼ä½¿ç¨ç¨æ·boboä½¿ç¨å¯ç  123456 è¿æ¥å°mongodb æå¡ä¸ã\n\napplication.ymlï¼\n\nspring:\n    #æ°æ®æºéç½®\n    data:\n        mongodb:\n            # ä¸»æºå°å\n            #   host: 180.76.159.126\n            # æ°æ®åº\n            #   database: articledb\n            # é»è®¤ç«¯å£æ¯27017\n            #   port: 27017\n            #å¸å·\n            #   username: bobo\n            #å¯ç \n            #   password: 123456\n            #åæºæè®¤è¯çæåµä¸ï¼ä¹ä½¿ç¨å­ç¬¦ä¸²è¿æ¥\n            uri: mongodb://bobo:123456@180.76.159.126:27017/articledb\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n\n# 3.3 å¯æ¬éç¯å¢\n\n\n# 3.3.1 åè¨\n\nå¯¹äºæ­å»ºå¥½çmongodbå¯æ¬éï¼ä¸ºäºå®å¨ï¼å¯å¨å®å¨è®¤è¯ï¼ä½¿ç¨è´¦å·å¯ç ç»å½ã\n\nå¯æ¬éç¯å¢ä½¿ç¨ä¹åæ­å»ºå¥½çï¼æ¶æå¦ä¸ï¼\n\n\n\nå¯¹å¯æ¬éæ§è¡è®¿é®æ§å¶éè¦éç½®ä¸¤ä¸ªæ¹é¢ :\n\n * å¯æ¬éåå±äº«éç¾¤çåä¸ªèç¹æåä¹é´ä½¿ç¨åé¨èº«ä»½éªè¯ï¼å¯ä»¥ä½¿ç¨å¯é¥æä»¶æx.509è¯ä¹¦ãå¯é¥æä»¶æ¯è¾ç®åï¼æ¬æä½¿ç¨å¯é¥æä»¶ï¼å®æ¹æ¨èå¦ææ¯æµè¯ç¯å¢å¯ä»¥ä½¿ç¨å¯é¥æä»¶ï¼ä½æ¯æ­£å¼ç¯å¢ï¼å®æ¹æ¨èx.509è¯ä¹¦ãåçå°±æ¯ï¼éç¾¤ä¸­æ¯ä¸ä¸ªå®ä¾å½¼æ­¤è¿æ¥çæ¶åé½æ£éªå½¼æ­¤ä½¿ç¨çè¯ä¹¦çåå®¹æ¯å¦ç¸åãåªæè¯ä¹¦ç¸åçå®ä¾å½¼æ­¤æå¯ä»¥è®¿é®\n * ä½¿ç¨å®¢æ·ç«¯è¿æ¥å°mongodbéç¾¤æ¶ï¼å¼å¯è®¿é®ææãå¯¹äºéç¾¤å¤é¨çè®¿é®ãå¦éè¿å¯è§åå®¢æ·ç«¯ï¼æèéè¿ä»£ç è¿æ¥çæ¶åï¼éè¦å¼å¯ææã\n\nå¨keyfileèº«ä»½éªè¯ä¸­ï¼å¯æ¬éä¸­çæ¯ä¸ªmongodå®ä¾é½ä½¿ç¨keyfileçåå®¹ä½ä¸ºå±äº«å¯ç ï¼åªæå·ææ­£ç¡®å¯é¥æä»¶çmongodæèmongoså®ä¾å¯ä»¥è¿æ¥å°å¯æ¬éãå¯é¥æä»¶çåå®¹å¿é¡»å¨6å°1024ä¸ªå­ç¬¦ä¹é´ï¼å¹¶ä¸å¨unix/linuxç³»ç»ä¸­æä»¶ææèå¿é¡»æå¯¹æä»¶è³å°æè¯»çæéã\n\n\n# 3.3.2 å³é­å·²å¼å¯çå¯æ¬éæå¡\n\nå¢å å¯æ¬éçå®å¨è®¤è¯åæå¡é´æåè½ï¼å¯ä»¥å¨å¯æ¬éæ­å»ºçæ¶åç´æ¥æ·»å ï¼ä¹å¯ä»¥å¨ä¹åæ­å»ºå¥½çå¯æ¬éæå¡ä¸æ·»å ã\n\næ¬æä½¿ç¨ä¹åæ­å»ºå¥½çå¯æ¬éæå¡ï¼å æ­¤ï¼ååæ­¢ä¹åçéç¾¤æå¡\n\nåæ­¢æå¡çæ¹å¼æä¸¤ç§ï¼å¿«éå³é­åæ åå³é­ï¼ä¸é¢ä¾æ¬¡è¯´æï¼\n\nï¼1ï¼å¿«éå³é­æ¹æ³ï¼å¿«éï¼ç®åï¼æ°æ®å¯è½ä¼åºéï¼\n\nç®æ ï¼éè¿ç³»ç»çkillå½ä»¤ç´æ¥ææ­»è¿ç¨ï¼\n\nä¾æ¬¡ææ­»ä»²è£èãå¯æ¬èç¹ãä¸»èç¹ï¼ç´å°æææåé½ç¦»çº¿ãå»ºè®®ä¸»èç¹æåkillï¼ä»¥é¿åæ½å¨çåæ»ãæå®è¦æ£æ¥ä¸ä¸ï¼é¿åæçæ²¡æææã\n\n#éè¿è¿ç¨ç¼å·å³é­èç¹\nkill -2 54410\n\n\n1\n2\n\n\nãè¡¥åã\n\nå¦æä¸æ¦æ¯å ä¸ºæ°æ®æåï¼åéè¦è¿è¡å¦ä¸æä½ï¼äºè§£ï¼ï¼\n\n1ï¼å é¤lockæä»¶ï¼\n\nrm -f /mongodb/replica_sets/myrs_27017/data/db/*.lock \\\n/mongodb/replica_sets/myrs_27018/data/db/*.lock \\\n/mongodb/replica_sets/myrs_27019/data/db/mongod.lock \\\n\n\n1\n2\n3\n\n\n2 ï¼ä¾æ¬¡ä¿®å¤æ°æ®ï¼\n\n/usr/local/mongodb/bin/mongod --repair --dbpath=/mongodb/replica_sets/myrs_27017/data/db\n/usr/local/mongodb/bin/mongod --repair --dbpath=/mongodb/replica_sets/myrs_27018/data/db\n/usr/local/mongodb/bin/mongod --repair --dbpath=/mongodb/replica_sets/myrs_27019/data/db\n\n\n1\n2\n3\n\n\nï¼2ï¼æ åçå³é­æ¹æ³ï¼æ°æ®ä¸å®¹æåºéï¼ä½éº»ç¦ï¼\n\nç®æ ï¼éè¿mongoå®¢æ·ç«¯ä¸­çshutdownserverå½ä»¤æ¥ä¾æ¬¡å³é­åä¸ªæå¡\n\nå³é­å¯æ¬éä¸­çæå¡ï¼å»ºè®®ä¾æ¬¡å³é­ä»²è£èç¹ãå¯æ¬èç¹ãä¸»èç¹ãä¸»è¦çæä½æ­¥éª¤åèå¦ä¸ï¼\n\n//å®¢æ·ç«¯ç»å½æå¡ï¼æ³¨æï¼è¿ééè¿localhostç»å½ï¼å¦æéè¦è¿ç¨ç»å½ï¼å¿é¡»åç»å½è®¤è¯æè¡ã\nmongo --port 27017\n//åç¥å¯æ¬éè¯´æ¬æºè¦ä¸çº¿\nrs.stepdown()\n//#åæ¢å°adminåº\nuse admin\n//å³é­æå¡\ndb.shutdownserver()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 3.3.3 éè¿ä¸»èç¹æ·»å ä¸ä¸ªç®¡çåå¸å·\n\nåªéè¦å¨ä¸»èç¹ä¸æ·»å ç¨æ·ï¼å¯æ¬éä¼èªå¨åæ­¥ã\n\nå¼å¯è®¤è¯ä¹åï¼åå»ºè¶ç®¡ç¨æ·ï¼myrootï¼å¯ç ï¼123456\n\nmyrs:primary> use admin\nswitched to db admin\nmyrs:primary> db.createuser({user:"myroot",pwd:"123456",roles:["root"]})\nsuccessfully added user: { "user" : "myroot", "roles" : [ "root" ] }\n\n\n1\n2\n3\n4\n\n\nè¯¥æ­¥éª¤ä¹å¯ä»¥å¨å¼å¯è®¤è¯ä¹åï¼ä½éè¦éè¿localhostç»å½æåè®¸æ·»å ç¨æ·ï¼ç¨æ·æ°æ®ä¹ä¼èªå¨åæ­¥å°å¯æ¬éã\n\nåç»­ååå»ºå¶ä»ç¨æ·ï¼é½å¯ä»¥ä½¿ç¨è¯¥è¶ç®¡ç¨æ·åå»ºã\n\n\n# 3.3.4 åå»ºå¯æ¬éè®¤è¯çkeyæä»¶\n\nç¬¬ä¸æ­¥ï¼çæä¸ä¸ªkeyæä»¶å°å½åæä»¶å¤¹ä¸­ã\n\nå¯ä»¥ä½¿ç¨ä»»ä½æ¹æ³çæå¯é¥æä»¶ãä¾å¦ï¼ä»¥ä¸æä½ä½¿ç¨opensslçæå¯ç æä»¶ï¼ç¶åä½¿ç¨chmodæ¥æ´æ¹æä»¶æéï¼ä»ä¸ºæä»¶ææèæä¾è¯»åæé\n\n[root@bobohost ~]# openssl rand -base64 90 -out ./mongo.keyfile\n[root@bobohost ~]# chmod 400 ./mongo.keyfile\n[root@bobohost ~]# ll mongo.keyfile\n-r--------. 1 root root 122 8æ  14 14:23 mongo.keyfile\n\n\n1\n2\n3\n4\n\n\næç¤ºï¼\n\nææå¯æ¬éèç¹é½å¿é¡»è¦ç¨åä¸ä»½keyfileï¼ä¸è¬æ¯å¨ä¸å°æºå¨ä¸çæï¼ç¶åæ·è´å°å¶ä»æºå¨ä¸ï¼ä¸å¿é¡»æè¯»çæéï¼å¦åå°æ¥ä¼æ¥éï¼ permissions on /mongodb/replica_sets/myrs_27017/mongo.keyfile are too open\n\nä¸å®è¦ä¿è¯å¯é¥æä»¶ä¸è´ï¼æä»¶ä½ç½®éä¾¿ãä½æ¯ä¸ºäºæ¹ä¾¿æ¥æ¾ï¼å»ºè®®æ¯å°æºå¨é½æ¾å°ä¸ä¸ªåºå®çä½ç½®ï¼é½æ¾å°åéç½®æä»¶ä¸èµ·çç®å½ä¸­ã\n\nè¿éå°è¯¥æä»¶åå«æ·è´å°å¤ä¸ªç®å½ä¸­ï¼\n\n[root@bobohost ~]# cp mongo.keyfile /mongodb/replica_sets/myrs_27017\n[root@bobohost ~]# cp mongo.keyfile /mongodb/replica_sets/myrs_27018\n[root@bobohost ~]# cp mongo.keyfile /mongodb/replica_sets/myrs_27019\n\n\n1\n2\n3\n\n\n\n# 3.3.5 ä¿®æ¹éç½®æä»¶æå®keyfile\n\nåå«ç¼è¾å ä¸ªæå¡çmongod.confæä»¶ï¼æ·»å ç¸å³åå®¹\n\n/mongodb/replica_sets/myrs_27017/mongod.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/replica_sets/myrs_27017/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/replica_sets/myrs_27018/mongod.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/replica_sets/myrs_27018/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/replica_sets/myrs_27019/mongod.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/replica_sets/myrs_27019/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n\n# 3.3.6 éæ°å¯å¨å¯æ¬é\n\nå¦æå¯æ¬éæ¯å¼å¯ç¶æï¼åååå«å³é­å³é­å¤æ¬éä¸­çæ¯ä¸ªmongodï¼ä»æ¬¡èç¹å¼å§ãç´å°å¯æ¬éçæææåé½ç¦»çº¿ï¼åæ¬ä»»ä½ä»²è£èãä¸»èç¹å¿é¡»æ¯æåä¸ä¸ªæåå³é­ä»¥é¿åæ½å¨çåæ»ã\n\n#éè¿è¿ç¨ç¼å·å³é­ä¸ä¸ªèç¹\nkill -2 54410 54361 54257\n\n\n1\n2\n\n\nåå«å¯å¨å¯æ¬éèç¹ï¼\n\n/usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27017/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27018/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27019/mongod.conf\n\n\n1\n2\n3\n\n\næ¥çè¿ç¨æåµï¼\n\n[root@bobohost replica_sets]# ps -ef |grep mongod\nroot    62425    1  5 14:43 ?     00:00:01 /usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27017/mongod.conf\nroot    62495    1  7 14:43 ?     00:00:01 /usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27018/mongod.conf\nroot    62567    1 11 14:43 ?     00:00:01 /usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27019/mongod.conf\n\n\n1\n2\n3\n4\n\n\n\n# 3.3.7 å¨ä¸»èç¹ä¸æ·»å æ®éè´¦å·\n\n#åç¨ç®¡çåè´¦å·ç»å½\n#åæ¢å°adminåº\nuse admin\n#ç®¡çåè´¦å·è®¤è¯\ndb.auth("myroot","123456")\n#åæ¢å°è¦è®¤è¯çåº\nuse articledb\n#æ·»å æ®éç¨æ·\ndb.createuser({user: "bobo", pwd: "123456", roles: ["readwrite"]})\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\néæ°è¿æ¥ï¼ä½¿ç¨æ®éç¨æ· boboéæ°ç»å½ï¼æ¥çæ°æ®ã\n\n\n# 3.3.8 springdatamongodbè¿æ¥å¯æ¬é\n\nä½¿ç¨ç¨æ·ååå¯ç è¿æ¥å° mongodb æå¡å¨ï¼ä½ å¿é¡»ä½¿ç¨\'username:password@hostname/dbname\' æ ¼å¼ï¼âusernameâä¸ºç¨æ·åï¼âpasswordâ ä¸ºå¯ç ã\n\nç®æ ï¼ä½¿ç¨ç¨æ·boboä½¿ç¨å¯ç  123456 è¿æ¥å°mongodb æå¡ä¸ã\n\napplication.ymlï¼\n\nspring:\n    #æ°æ®æºéç½®\n    data:\n        mongodb:\n            #å¯æ¬éæè®¤è¯çæåµä¸ï¼å­ç¬¦ä¸²è¿æ¥\n            uri: mongodb://bobo:123456@180.76.159.126:27017,180.76.159.126:27018,180.76.159.126:27019/articledb?connect=replicaset&slaveok=true&replicaset=myrs\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 3.4 åçéç¾¤ç¯å¢(æ©å±)\n\n\n# 3.4.1 å³é­å·²å¼å¯çéç¾¤æå¡\n\nåçéç¾¤ç¯å¢ä¸çå®å¨è®¤è¯åå¯æ¬éç¯å¢ä¸åºæ¬ä¸ä¸æ ·ã\n\nä½åçéç¾¤çæå¡å¨ç¯å¢åæ¶æè¾ä¸ºå¤æï¼å»ºè®®å¨æ­å»ºåçéç¾¤çæ¶åï¼ç´æ¥å å¥å®å¨è®¤è¯åæå¡å¨é´çé´æï¼å¦æä¹åææ°æ®ï¼å¯åå°ä¹åçæ°æ®å¤ä»½åºæ¥ï¼åè¿ååå»ã\n\næ¬æä½¿ç¨ä¹åæ­å»ºå¥½çéç¾¤æå¡ï¼å æ­¤ï¼ååæ­¢ä¹åçéç¾¤æå¡\n\nåæ­¢æå¡çæ¹å¼æä¸¤ç§ï¼å¿«éå³é­åæ åå³é­ï¼ä¸é¢ä¾æ¬¡è¯´æï¼\n\nï¼1ï¼å¿«éå³é­æ¹æ³ï¼å¿«éï¼ç®åï¼æ°æ®å¯è½ä¼åºéï¼\n\nç®æ ï¼éè¿ç³»ç»çkillå½ä»¤ç´æ¥ææ­»è¿ç¨ï¼\n\nä¾æ¬¡ææ­» mongosè·¯ç±ãéç½®å¯æ¬éæå¡ï¼åçå¯æ¬éæå¡ï¼ä»æ¬¡èç¹å¼å§ãç´å°æææåé½ç¦»çº¿ãå¯æ¬éæçæ¶åï¼å»ºè®®åæä»²è£èï¼åæå¯æ¬èç¹ï¼æåæ¯ä¸»èç¹ï¼ä»¥é¿åæ½å¨çåæ»ãæå®è¦æ£æ¥ä¸ä¸ï¼é¿åæçæ²¡æææã\n\n#éè¿è¿ç¨ç¼å·å³é­èç¹\nkill -2 54410\n\n\n1\n2\n\n\nãè¡¥åã\n\nå¦æä¸æ¦æ¯å ä¸ºæ°æ®æåï¼åéè¦è¿è¡å¦ä¸æä½ï¼äºè§£ï¼ï¼\n\n1ï¼å é¤lockæä»¶ï¼\n\nrm -f /mongodb/sharded_cluster/myshardrs01_27018/data/db/*.lock \\\n/mongodb/sharded_cluster/myshardrs01_27118/data/db/*.lock \\\n/mongodb/sharded_cluster/myshardrs01_27218/data/db/mongod.lock \\\n/mongodb/sharded_cluster/myshardrs02_27318/data/db/mongod.lock \\\n/mongodb/sharded_cluster/myshardrs02_27418/data/db/mongod.lock \\\n/mongodb/sharded_cluster/myshardrs02_27518/data/db/mongod.lock \\\n/mongodb/sharded_cluster/myconfigrs_27019/data/db/mongod.lock \\\n/mongodb/sharded_cluster/myconfigrs_27119/data/db/mongod.lock \\\n/mongodb/sharded_cluster/myconfigrs_27219/data/db/mongod.lock\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n2 ï¼ä¾æ¬¡ä¿®å¤æ°æ®ï¼\n\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myshardrs01_27018/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myshardrs01_27118/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myshardrs01_27218/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myshardrs02_27318/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myshardrs02_27418/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myshardrs02_27518/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myconfigrs_27019/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myconfigrs_27119/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/myconfigrs_27219/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/mymongos_27017/data/db\n/usr/local/mongodb/bin/mongod --repair --\ndbpath=/mongodb/sharded_cluster/mymongos_27117/data/db\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nï¼2ï¼æ åçå³é­æ¹æ³ï¼æ°æ®ä¸å®¹æåºéï¼ä½éº»ç¦ï¼ï¼\n\nç®æ ï¼éè¿mongoå®¢æ·ç«¯ä¸­çshutdownserverå½ä»¤æ¥ä¾æ¬¡å³é­åä¸ªæå¡\n\nå³é­åçæå¡å¨å¯æ¬éä¸­çæå¡ï¼å»ºè®®ä¾æ¬¡å³é­ä»²è£èç¹ãå¯æ¬èç¹ãä¸»èç¹ãä¸»è¦çæä½æ­¥éª¤åèå¦ä¸ï¼\n\n//å®¢æ·ç«¯ç»å½æå¡ï¼æ³¨æï¼è¿ééè¿localhostç»å½ï¼å¦æéè¦è¿ç¨ç»å½ï¼å¿é¡»åç»å½è®¤è¯æè¡ã\nmongo --port 27018\n//åç¥å¯æ¬éè¯´æ¬æºè¦ä¸çº¿\nrs.stepdown()\n//#åæ¢å°adminåº\nuse admin\n//å³é­æå¡\ndb.shutdownserver()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå³é­éç½®æå¡å¨å¯æ¬éçæå¡ï¼å»ºè®®ä¾æ¬¡å³é­å¯æ¬èç¹ãä¸»èç¹ãä¸»è¦çæä½æ­¥éª¤åèå¦ä¸ï¼\n\n//å®¢æ·ç«¯ç»å½æå¡ï¼æ³¨æï¼è¿ééè¿localhostç»å½ï¼å¦æéè¦è¿ç¨ç»å½ï¼å¿é¡»åç»å½è®¤è¯æè¡ã\nmongo --port 27019\n//åç¥å¯æ¬éè¯´æ¬æºè¦ä¸çº¿\nrs.stepdown()\n//#åæ¢å°adminåº\nuse admin\n//å³é­æå¡\ndb.shutdownserver()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\nå³é­è·¯ç±æå¡å¨çæå¡ï¼å»ºè®®ä¾æ¬¡å³é­ä¸¤ä¸ªè·¯ç±èç¹ãä¸»è¦çæä½æ­¥éª¤åèå¦ä¸ï¼\n\n//å®¢æ·ç«¯ç»å½æå¡ï¼æ³¨æï¼è¿ééè¿localhostç»å½ï¼å¦æéè¦è¿ç¨ç»å½ï¼å¿é¡»åç»å½è®¤è¯æè¡ã\nmongo --port 27017\n//åç¥å¯æ¬éè¯´æ¬æºè¦ä¸çº¿\nrs.stepdown()\n//#åæ¢å°adminåº\nuse admin\n//å³é­æå¡\ndb.shutdownserver()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 3.4.2 åå»ºå¯æ¬éè®¤è¯çkeyæä»¶\n\nç¬¬ä¸æ­¥ï¼çæä¸ä¸ªkeyæä»¶å°å½åæä»¶å¤¹ä¸­ã\n\nå¯ä»¥ä½¿ç¨ä»»ä½æ¹æ³çæå¯é¥æä»¶ãä¾å¦ï¼ä»¥ä¸æä½ä½¿ç¨opensslçæå¯ç æä»¶ï¼ç¶åä½¿ç¨chmodæ¥æ´æ¹æä»¶æéï¼ä»ä¸ºæä»¶ææèæä¾è¯»åæé\n\n[root@bobohost ~]# openssl rand -base64 90 -out ./mongo.keyfile\n[root@bobohost ~]# chmod 400 ./mongo.keyfile\n[root@bobohost ~]# ll mongo.keyfile\n-r--------. 1 root root 122 8æ  14 14:23 mongo.keyfile\n\n\n1\n2\n3\n4\n\n\næç¤ºï¼\n\nææå¯æ¬éèç¹é½å¿é¡»è¦ç¨åä¸ä»½keyfileï¼ä¸è¬æ¯å¨ä¸å°æºå¨ä¸çæï¼ç¶åæ·è´å°å¶ä»æºå¨ä¸ï¼ä¸å¿é¡» æè¯»çæéï¼å¦åå°æ¥ä¼æ¥éï¼ permissions on /mongodb/replica_sets/myrs_27017/mongo.keyfile are too open\n\nä¸å®è¦ä¿è¯å¯é¥æä»¶ä¸è´ï¼æä»¶ä½ç½®éä¾¿ãä½æ¯ä¸ºäºæ¹ä¾¿æ¥æ¾ï¼å»ºè®®æ¯å°æºå¨é½æ¾å°ä¸ä¸ªåºå®çä½ç½®ï¼é½æ¾å°åéç½®æä»¶ä¸èµ·çç®å½ä¸­ã\n\nè¿éå°è¯¥æä»¶åå«æ·è´å°å¤ä¸ªç®å½ä¸­ï¼\n\necho \'/mongodb/sharded_cluster/myshardrs01_27018/mongo.keyfile\n/mongodb/sharded_cluster/myshardrs01_27118/mongo.keyfile\n/mongodb/sharded_cluster/myshardrs01_27218/mongo.keyfile\n/mongodb/sharded_cluster/myshardrs02_27318/mongo.keyfile\n/mongodb/sharded_cluster/myshardrs02_27418/mongo.keyfile\n/mongodb/sharded_cluster/myshardrs02_27518/mongo.keyfile\n/mongodb/sharded_cluster/myconfigrs_27019/mongo.keyfile\n/mongodb/sharded_cluster/myconfigrs_27119/mongo.keyfile\n/mongodb/sharded_cluster/myconfigrs_27219/mongo.keyfile\n/mongodb/sharded_cluster/mymongos_27017/mongo.keyfile\n/mongodb/sharded_cluster/mymongos_27117/mongo.keyfile\' | xargs -n 1 cp -v /root/mongo.keyfile\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\n\n# 3.4.3 ä¿®æ¹éç½®æä»¶æå®keyfile\n\nåå«ç¼è¾å ä¸ªæå¡çmongod.confæä»¶ï¼æ·»å ç¸å³åå®¹ï¼\n\n/mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/sharded_cluster/myshardrs01_27018/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/sharded_cluster/myshardrs01_27118/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/sharded_cluster/myshardrs01_27218/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myshardrs02_27318/mongod.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/sharded_cluster/myshardrs02_27318/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myshardrs02_27418/mongod.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/sharded_cluster/myshardrs02_27418/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myshardrs02_27518/mongod.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/sharded_cluster/myshardrs02_27518/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myconfigrs_27019/mongod.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/sharded_cluster/myconfigrs_27019/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myconfigrs_27119/mongod.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/sharded_cluster/myconfigrs_27119/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/myconfigrs_27219/mongod.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/sharded_cluster/myconfigrs_27219/mongo.keyfile\n    #å¼å¯è®¤è¯æ¹å¼è¿è¡\n    authorization: enabled\n\n\n1\n2\n3\n4\n5\n\n\n/mongodb/sharded_cluster/mymongos_27017/mongos.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/sharded_cluster/mymongos_27017/mongo.keyfile\n\n\n1\n2\n3\n\n\n/mongodb/sharded_cluster/mymongos_27117/mongos.conf\n\nsecurity:\n    #keyfileé´ææä»¶\n    keyfile: /mongodb/sharded_cluster/mymongos_27117/mongo.keyfile\n\n\n1\n2\n3\n\n\nmongos æ¯mongodå°äºauthorizationï¼enabledçéç½®ãåå æ¯ï¼å¯æ¬éå åççå®å¨è®¤è¯éè¦éç½®ä¸¤æ¹é¢çï¼å¯æ¬éåä¸ªèç¹ä¹é´ä½¿ç¨åé¨èº«ä»½éªè¯ï¼ç¨äºåé¨åä¸ªmongoå®ä¾çéä¿¡ï¼åªæç¸åkeyfileæè½ç¸äºè®¿é®ãæä»¥é½è¦å¼å¯ keyfile: /mongodb/sharded_cluster/mymongos_27117/mongo.keyfile ã\n\nç¶èå¯¹äºææçmongodï¼ææ¯çæ­£çä¿å­æ°æ®çåçãmongosåªåè·¯ç±ï¼ä¸ä¿å­æ°æ®ãæä»¥ææçmongodå¼å¯è®¿é®æ°æ®çææauthorization:enabledãè¿æ ·ç¨æ·åªæè´¦å·å¯ç æ­£ç¡®æè½è®¿é®å°æ°æ®ã\n\n\n# 3.4.4 éæ°å¯å¨èç¹\n\nå¿é¡»ä¾æ¬¡å¯å¨éç½®èç¹ãåçèç¹ãè·¯ç±èç¹ï¼\n\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27019/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27119/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27219/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27318/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27418/mongod.conf\n/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27518/mongod.conf\n/usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27017/mongos.conf\n/usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27117/mongos.conf\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\næ³¨æï¼\n\nè¿éæä¸ªéå¸¸ç¹å«çæåµï¼å°±æ¯å¯å¨é¡ºåºãåå¯å¨éç½®èç¹ï¼åå¯å¨åçèç¹ï¼æåå¯å¨è·¯ç±èç¹ã\n\nå¦æåå¯å¨åçèç¹ï¼ä¼å¡ä½ï¼æç¤ºï¼\n\nabout to fork child process, waiting until server is ready for connections\n\n\n1\n\n\nè¿ä¹è®¸æ¯ä¸ª bugãåå æªç¥ã\n\n\n# 3.3.5 åå»ºå¸å·åè®¤è¯\n\nå®¢æ·ç«¯mongoï¼éè¿localhostç»å½ä»»æä¸ä¸ªmongosè·¯ç±ï¼\n\n[root@bobohost db]# /usr/local/mongodb/bin/mongo --port 27017\n\n\n1\n\n\næç¤ºï¼ç¸å½äºä¸ä¸ªåé¨ï¼åªè½å¨ adminä¸æ·»å ç¨æ·ã\n\nåå»ºä¸ä¸ªç®¡çåå¸å·ï¼\n\nmongos> use admin\nswitched to db admin\nmongos>  db.createuser({user:"myroot",pwd:"123456",roles:["root"]})\nsuccessfully added user: { "user" : "myroot", "roles" : [ "root" ] }\n\n\n1\n2\n3\n4\n\n\næç¤ºï¼å¦æå¨å¼å¯è®¤è¯ä¹åå·²ç»åå»ºäºç®¡çåè´¦å·ï¼è¿éå¯ä»¥å¿½ç¥\n\nåå»ºä¸ä¸ªæ®éæéå¸å·ï¼\n\nmongos> use admin\nswitched to db admin\nmongos> db.auth("myroot","123456")\n1\nmongos> use articledb\nswitched to db articledb\nmongos> db.createuser({user: "bobo", pwd: "123456", roles: [{ role: "readwrite",db: "articledb" }]})\nsuccessfully added user: {\n    "user" : "bobo",\n    "roles" : [\n        {\n          "role" : "readwrite",\n          "db" : "articledb"\n        }\n    ]\n}\nmongos> db.auth("bobo","123456")\n1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\næç¤ºï¼\n\néè¿mongosæ·»å çè´¦å·ä¿¡æ¯ï¼åªä¼ä¿å­å°éç½®èç¹çæå¡ä¸­ï¼å·ä½çæ°æ®èç¹ä¸ä¿å­è´¦å·ä¿¡æ¯ï¼å æ­¤ï¼åçä¸­çè´¦å·ä¿¡æ¯ä¸æ¶åå°åæ­¥é®é¢ã\n\nmongoå®¢æ·ç«¯ç»å½mongosè·¯ç±ï¼ç¨ç®¡çåå¸å·ç»å½å¯æ¥çåçæåµï¼\n\nmongos> use admin\nswitched to db admin\nmongos>  db.auth("myroot","123456")\n1\nmongos> sh.status()\n\n\n1\n2\n3\n4\n5\n\n\néåºè¿æ¥ï¼éæ°è¿æ¥æå¡ï¼ä½¿ç¨æ®éæéå¸å·è®¿é®æ°æ®ï¼\n\n[root@bobohost db]# /usr/local/mongodb/bin/mongo --host 180.76.159.126 --port 27017\nmongodb shell version v4.0.10\nconnecting to: mongodb://180.76.159.126:27017/?gssapiservicename=mongodb\nimplicit session: session { "id" : uuid("6f84fa91-2414-407e-b3ab-c0b7eedde825")\n}\nmongodb server version: 4.0.10\nmongos> use articledb\nswitched to db articledb\nmongos> db.auth("bobo","123456")\n1\nmongos> show collections\ncomment\ncomment2\nmongos> db.comment.count()\n10001\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# 3.3.6 springdatamongodbè¿æ¥è®¤è¯\n\nä½¿ç¨ç¨æ·ååå¯ç è¿æ¥å° mongodb æå¡å¨ï¼ä½ å¿é¡»ä½¿ç¨\'username:password@hostname/dbname\' æ ¼å¼ï¼âusernameâä¸ºç¨æ·åï¼âpasswordâ ä¸ºå¯ç ã\n\nç®æ ï¼ä½¿ç¨ç¨æ·boboä½¿ç¨å¯ç  123456 è¿æ¥å°mongodb æå¡ä¸ã\n\napplication.ymlï¼\n\nspring:\n    #æ°æ®æºéç½®\n    data:\n        mongodb:\n        # åçéç¾¤æè®¤è¯çæåµä¸ï¼å­ç¬¦ä¸²è¿æ¥\n            uri: mongodb://bobo:123456@180.76.159.126:27017,180.76.159.126:27117/articledb\n\n\n1\n2\n3\n4\n5\n6\n\n\nåæé¾æ¥ï¼https://wgy1993.gitee.io/archives/afe7047c.html',charsets:{cjk:!0}},{title:"Dockeræå»ºéå",frontmatter:{title:"Dockeræå»ºéå",date:"2023-02-24T16:15:35.000Z",permalink:"/pages/83a393/",categories:["è¿ç»´","docker"],tags:[null],readingShow:"top",description:"ä»ä¹æ¯ Dockerfileï¼",meta:[{name:"twitter:title",content:"Dockeræå»ºéå"},{name:"twitter:description",content:"ä»ä¹æ¯ Dockerfileï¼"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/10.docker/01.Docker%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Dockeræå»ºéå"},{property:"og:description",content:"ä»ä¹æ¯ Dockerfileï¼"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/10.docker/01.Docker%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-24T16:15:35.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"Dockeræå»ºéå"},{itemprop:"description",content:"ä»ä¹æ¯ Dockerfileï¼"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/10.docker/01.Docker%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F.html",relativePath:"04.è¿ç»´/10.docker/01.Dockeræå»ºéå.md",key:"v-3ed70d81",path:"/pages/83a393/",headers:[{level:2,title:"ä¸ãDockerfile ç®ä»",slug:"ä¸ãdockerfile-ç®ä»",normalizedTitle:"ä¸ãdockerfile ç®ä»",charIndex:2},{level:2,title:"äºãDockerfile æä»¤",slug:"äºãdockerfile-æä»¤",normalizedTitle:"äºãdockerfile æä»¤",charIndex:499},{level:3,title:"1ãå¸¸ç¨æä»¤",slug:"_1ãå¸¸ç¨æä»¤",normalizedTitle:"1ãå¸¸ç¨æä»¤",charIndex:519},{level:3,title:"2ãæä»¤è¯¦è§£",slug:"_2ãæä»¤è¯¦è§£",normalizedTitle:"2ãæä»¤è¯¦è§£",charIndex:1790},{level:4,title:"1ãFROM",slug:"_1ãfrom",normalizedTitle:"1ãfrom",charIndex:1800},{level:4,title:"2ãCOPY",slug:"_2ãcopy",normalizedTitle:"2ãcopy",charIndex:2071},{level:4,title:"3ãADD",slug:"_3ãadd",normalizedTitle:"3ãadd",charIndex:2462},{level:4,title:"4ãRUN",slug:"_4ãrun",normalizedTitle:"4ãrun",charIndex:2830},{level:4,title:"5ãCMD",slug:"_5ãcmd",normalizedTitle:"5ãcmd",charIndex:3554},{level:4,title:"6ãENTRYPOINT",slug:"_6ãentrypoint",normalizedTitle:"6ãentrypoint",charIndex:4375},{level:4,title:"7ãENV",slug:"_7ãenv",normalizedTitle:"7ãenv",charIndex:5710},{level:4,title:"8ãARG",slug:"_8ãarg",normalizedTitle:"8ãarg",charIndex:6283},{level:4,title:"9ãVOLUME",slug:"_9ãvolume",normalizedTitle:"9ãvolume",charIndex:6472},{level:4,title:"10ãEXPOSE",slug:"_10ãexpose",normalizedTitle:"10ãexpose",charIndex:6655},{level:4,title:"11ãWORKDIR",slug:"_11ãworkdir",normalizedTitle:"11ãworkdir",charIndex:6805},{level:4,title:"12ãUSER",slug:"_12ãuser",normalizedTitle:"12ãuser",charIndex:6921},{level:4,title:"13ãHEALTHCHECK",slug:"_13ãhealthcheck",normalizedTitle:"13ãhealthcheck",charIndex:7013},{level:4,title:"14ãONBUILD",slug:"_14ãonbuild",normalizedTitle:"14ãonbuild",charIndex:8162},{level:4,title:"15ãLABEL",slug:"_15ãlabel",normalizedTitle:"15ãlabel",charIndex:8787},{level:4,title:"16ã.dockerignore æä»¶",slug:"_16ã-dockerignore-æä»¶",normalizedTitle:"16ã.dockerignore æä»¶",charIndex:9261},{level:2,title:"ä¸ãéåä¼å",slug:"ä¸ãéåä¼å",normalizedTitle:"ä¸ãéåä¼å",charIndex:9894},{level:3,title:"1ãåºç¡éåéæ©",slug:"_1ãåºç¡éåéæ©",normalizedTitle:"1ãåºç¡éåéæ©",charIndex:9905},{level:3,title:"2ãéç½®å½åè½¯ä»¶æº",slug:"_2ãéç½®å½åè½¯ä»¶æº",normalizedTitle:"2ãéç½®å½åè½¯ä»¶æº",charIndex:11345},{level:2,title:"åãæå»ºéå",slug:"åãæå»ºéå",normalizedTitle:"åãæå»ºéå",charIndex:12270},{level:3,title:"1ãå½å",slug:"_1ãå½å",normalizedTitle:"1ãå½å",charIndex:12281},{level:3,title:"2ãåºäºéåé¨ç½²æå¡",slug:"_2ãåºäºéåé¨ç½²æå¡",normalizedTitle:"2ãåºäºéåé¨ç½²æå¡",charIndex:12524},{level:3,title:"3ãä½¿ç¨Makefileæä½Dockerfile",slug:"_3ãä½¿ç¨makefileæä½dockerfile",normalizedTitle:"3ãä½¿ç¨makefileæä½dockerfile",charIndex:14093},{level:2,title:"äºãå¤é¶æ®µæå»ºéå",slug:"äºãå¤é¶æ®µæå»ºéå",normalizedTitle:"äºãå¤é¶æ®µæå»ºéå",charIndex:14792},{level:2,title:"å­ãDockerfile ä¼ å",slug:"å­ãdockerfile-ä¼ å",normalizedTitle:"å­ãdockerfile ä¼ å",charIndex:15935},{level:2,title:"ä¸ãDockerfile ä¼å",slug:"ä¸ãdockerfile-ä¼å",normalizedTitle:"ä¸ãdockerfile ä¼å",charIndex:16573},{level:3,title:"1ãå°½éä¸ä½¿ç¨rootç¨æ·",slug:"_1ãå°½éä¸ä½¿ç¨rootç¨æ·",normalizedTitle:"1ãå°½éä¸ä½¿ç¨rootç¨æ·",charIndex:16593},{level:3,title:"2ãç§»é¤ææç¼å­ç­ä¸å¿è¦ä¿¡æ¯",slug:"_2ãç§»é¤ææç¼å­ç­ä¸å¿è¦ä¿¡æ¯",normalizedTitle:"2ãç§»é¤ææç¼å­ç­ä¸å¿è¦ä¿¡æ¯",charIndex:16812},{level:3,title:"3ãä½¿ç¨åççENTRYPOINTèæ¬",slug:"_3ãä½¿ç¨åççentrypointèæ¬",normalizedTitle:"3ãä½¿ç¨åççentrypointèæ¬",charIndex:16975},{level:3,title:"4ãè®¾ç½®æ¶åº",slug:"_4ãè®¾ç½®æ¶åº",normalizedTitle:"4ãè®¾ç½®æ¶åº",charIndex:17245},{level:4,title:"1ãåºäº Alpine éå",slug:"_1ãåºäº-alpine-éå",normalizedTitle:"1ãåºäº alpine éå",charIndex:17464},{level:4,title:"2ãåºäº Centos7 éå",slug:"_2ãåºäº-centos7-éå",normalizedTitle:"2ãåºäº centos7 éå",charIndex:17764},{level:4,title:"3ãåºäº Debian éå",slug:"_3ãåºäº-debian-éå",normalizedTitle:"3ãåºäº debian éå",charIndex:17927},{level:4,title:"4ãåºäº Ubuntu éå",slug:"_4ãåºäº-ubuntu-éå",normalizedTitle:"4ãåºäº ubuntu éå",charIndex:18041},{level:3,title:"5ãè®¾ç½®ç³»ç»è¯­è¨",slug:"_5ãè®¾ç½®ç³»ç»è¯­è¨",normalizedTitle:"5ãè®¾ç½®ç³»ç»è¯­è¨",charIndex:18291},{level:4,title:"1ãåºäº Alpine éå",slug:"_1ãåºäº-alpine-éå-2",normalizedTitle:"1ãåºäº alpine éå",charIndex:17464},{level:4,title:"2ãåºäº Centos7 éå",slug:"_2ãåºäº-centos7-éå-2",normalizedTitle:"2ãåºäº centos7 éå",charIndex:17764},{level:4,title:"3ãåºäº Debian éå",slug:"_3ãåºäº-debian-éå-2",normalizedTitle:"3ãåºäº debian éå",charIndex:17927},{level:4,title:"4ãåºäº Ubuntu éå",slug:"_4ãåºäº-ubuntu-éå-2",normalizedTitle:"4ãåºäº ubuntu éå",charIndex:18041},{level:3,title:"6ãä½¿ç¨Labelæ æ³¨ä½èãè½¯ä»¶çæ¬ç­åä¿¡æ¯",slug:"_6ãä½¿ç¨labelæ æ³¨ä½èãè½¯ä»¶çæ¬ç­åä¿¡æ¯",normalizedTitle:"6ãä½¿ç¨labelæ æ³¨ä½èãè½¯ä»¶çæ¬ç­åä¿¡æ¯",charIndex:19711},{level:3,title:"7ãæå®å·¥ä½åº",slug:"_7ãæå®å·¥ä½åº",normalizedTitle:"7ãæå®å·¥ä½åº",charIndex:19890},{level:3,title:"8ãRUNæä»¤æ¾ç¤ºä¼å",slug:"_8ãrunæä»¤æ¾ç¤ºä¼å",normalizedTitle:"8ãrunæä»¤æ¾ç¤ºä¼å",charIndex:19926},{level:3,title:"9ãä½¿ç¨ URL æ·»å æºç ",slug:"_9ãä½¿ç¨-url-æ·»å æºç ",normalizedTitle:"9ãä½¿ç¨ url æ·»å æºç ",charIndex:19978},{level:3,title:"10ãä½¿ç¨èæç¼è¯ç¯å¢",slug:"_10ãä½¿ç¨èæç¼è¯ç¯å¢",normalizedTitle:"10ãä½¿ç¨èæç¼è¯ç¯å¢",charIndex:20231},{level:3,title:"11ãæå°åå±æ°",slug:"_11ãæå°åå±æ°",normalizedTitle:"11ãæå°åå±æ°",charIndex:20608}],headersStr:"ä¸ãDockerfile ç®ä» äºãDockerfile æä»¤ 1ãå¸¸ç¨æä»¤ 2ãæä»¤è¯¦è§£ 1ãFROM 2ãCOPY 3ãADD 4ãRUN 5ãCMD 6ãENTRYPOINT 7ãENV 8ãARG 9ãVOLUME 10ãEXPOSE 11ãWORKDIR 12ãUSER 13ãHEALTHCHECK 14ãONBUILD 15ãLABEL 16ã.dockerignore æä»¶ ä¸ãéåä¼å 1ãåºç¡éåéæ© 2ãéç½®å½åè½¯ä»¶æº åãæå»ºéå 1ãå½å 2ãåºäºéåé¨ç½²æå¡ 3ãä½¿ç¨Makefileæä½Dockerfile äºãå¤é¶æ®µæå»ºéå å­ãDockerfile ä¼ å ä¸ãDockerfile ä¼å 1ãå°½éä¸ä½¿ç¨rootç¨æ· 2ãç§»é¤ææç¼å­ç­ä¸å¿è¦ä¿¡æ¯ 3ãä½¿ç¨åççENTRYPOINTèæ¬ 4ãè®¾ç½®æ¶åº 1ãåºäº Alpine éå 2ãåºäº Centos7 éå 3ãåºäº Debian éå 4ãåºäº Ubuntu éå 5ãè®¾ç½®ç³»ç»è¯­è¨ 1ãåºäº Alpine éå 2ãåºäº Centos7 éå 3ãåºäº Debian éå 4ãåºäº Ubuntu éå 6ãä½¿ç¨Labelæ æ³¨ä½èãè½¯ä»¶çæ¬ç­åä¿¡æ¯ 7ãæå®å·¥ä½åº 8ãRUNæä»¤æ¾ç¤ºä¼å 9ãä½¿ç¨ URL æ·»å æºç  10ãä½¿ç¨èæç¼è¯ç¯å¢ 11ãæå°åå±æ°",content:'# ä¸ãDockerfile ç®ä»\n\nä»ä¹æ¯ Dockerfileï¼\n\nDockerfile æ¯ä¸ä¸ªç¨æ¥æå»ºéåçææ¬æä»¶ï¼ææ¬åå®¹åå«äºæå»ºéåæéçæä»¤åè¯´æã\n\nå¨æå»ºæ¶ docker Engine ä¼å¨å½åç®å½ä¸­æ¥æ¾åä¸º âDockerfileâ çæä»¶ï¼æ³¨æè¿ä¸ªæä»¶åå¿é¡»ä¸º âDockerfileâ é¦å­æ¯å¤§åãå½æ¨è¿è¡ docker build å½ä»¤çæ¶åï¼Dockerfile æä»¶ä»¥åä¸ Dockerfile æä»¶å¤äºåçº§è·¯å¾ä¸çæææä»¶é½å°ä¸å¹¶æäº¤è³ docker Engine æ¥å¤çï¼docker Engine å°éè¡è§£æ Dockerfile æä»¶ï¼å¹¶æ§è¡ç¸å³æä½ãDockerfile çè§£ææ¯ç±ä¸èä¸çé¡ºåºè¿è¡ã\n\næ³¨ææ¨æ¾ç½® Dockerfile çç®å½æå¥½æ¯ä¸ä¸ªç©ºç®å½ï¼æèåªæ¾ç½®ä¸æ¬æ¬¡æå»ºç¸å³çæä»¶å³å¯ï¼å ä¸ºå¨æ§è¡ build æ¶ä¼å° Dockerfile ä»¥å Dockerfile è·¯å¾ä¸çæææä»¶æäº¤è³ docker Engine å¤çï¼å æ­¤æ¨ä¸åºè¯¥å¨ Dockerfile ç®å½ä¸­æ¾ç½®ä¸äºæ å³çæä»¶ï¼è¿æ¯æ æä¹çå¹¶ä¸è¿å°ä¼ä¸¥éææ¢æ´ä¸ªæå»ºè¿ç¨ã\n\n\n# äºãDockerfile æä»¤\n\n\n# 1ãå¸¸ç¨æä»¤\n\nDocker éåå¯ä»¥éè¿ Docker hub æèé¿éäºç­ä»åºä¸­è·åï¼è¿äºéåæ¯ç±å®æ¹æèç¤¾åºäººåæä¾çï¼å¯¹äº Docker ç¨æ·æ¥è¯´å¹¶ä¸è½æ»¡è¶³æä»¬çéæ±ï¼ä½æ¯ä»æ å¼å§æå»ºéåææ¬å¤§ãå¸¸ç¨çæ°æ®åºãä¸­é´ä»¶ãåºç¨è½¯ä»¶ç­é½æç°æç Docker å®æ¹éåæç¤¾åºåå»ºçéåï¼æä»¬åªéè¦ç¨ä½éç½®å°±å¯ä»¥ç´æ¥ä½¿ç¨ã\n\nä½¿ç¨ç°æéåçå¥½å¤é¤äºçå»èªå·±åéåçå·¥ä½éå¤ï¼æ´éè¦çæ¯å¯ä»¥å©ç¨åäººçç»éªãç¹å«æ¯ä½¿ç¨é£äºå®æ¹éåï¼å ä¸º Docker çå·¥ç¨å¸ç¥éå¦ä½æ´å¥½çå¨å®¹å¨ä¸­è¿è¡è½¯ä»¶ã\n\nå½ç¶ï¼æäºæåµä¸æä»¬ä¹ä¸å¾ä¸èªå·±æå»ºéåï¼æ¯å¦æ¾ä¸å°ç°æçéåï¼æ¯å¦èªå·±å¼åçåºç¨ç¨åºï¼éè¦å¨éåä¸­å å¥ç¹å®çåè½ã\n\nå¨ç¼å Dockerfile æ¶ï¼æ¨éè¦ç¨å° Dockerfile æä»¤æ¥å®ä¹æå»ºè¿ç¨ä¸­æè¦æ§è¡çæä½ï¼è¿éåä¸¾å ä¸ªå¸¸ç¨çæä»¤ï¼\n\nå¸¸ç¨æä»¤          è¯´æ\nFROM          FROM æä»¤æ¯å®ä¹æ¬é¶æ®µæå»ºæè¦ä½¿ç¨çåºç¡éåã\nMAINTAINER    éåç»´æ¤èå§åæé®ç®±å°å\nRUN           æå»ºéåæ¶è¿è¡ç shell å½ä»¤\nCMD           è¿è¡å®¹å¨æ¶æ§è¡ç shell å½ä»¤\nEXPOSE        ä»ä»åªæ¯å£°æç«¯å£ï¼å£°æå®¹å¨ååºç¨æä½¿ç¨çç«¯å£å·\nENV           è®¾ç½®å®¹å¨ç¯å¢åéï¼å½ç¶å¨æ¨ä½¿ç¨è¯¥éåè¿è¡å®¹å¨æ¶ï¼ENV æå®ä¹çåéä»ç¶å¯¹å®¹å¨ææ\nADD           æ·è´æä»¶æç®å½å°éåï¼å¦ææ¯ URL æåç¼©åä¼èªå¨ä¸è½½æèªå¨è§£å\nCOPY          æ·è´æä»¶æç®å½å°éåå®¹å¨åï¼è· ADD ç±»ä¼¼ï¼ä½ä¸å·å¤èªå¨ä¸è½½æè§£ååè½\nENTRYPOINT    è¿è¡å®¹å¨æ¶æ§è¡ç shell å½ä»¤\nVOLUME        æå®å®¹å¨æè½½ç¹å°å®¿ä¸»æºèªå¨çæçç®å½æå¶ä»å®¹å¨\nUSER          ä¸º RUNãCMDãå ENTRYPOINT æ§è¡å½ä»¤æå®è¿è¡ç¨æ·\nWORKDIR       ä¸º RUNãCMDãENTRYPOINTãCOPY å ADD è®¾ç½®å·¥ä½ç®å½ï¼ææä¸ºåæ¢ç®å½\nHEALTHCHECK   å¥åº·æ£æ¥\nARG           æå»ºæ¶æå®çä¸äºåæ°\n\nRUNãCMD ä¸ ENTRYPOINT çåºå«\n\n * RUNï¼æ§è¡å½ä»¤å¹¶åå»ºæ°çéåå±ï¼å¸¸ç¨äºå®è£è½¯ä»¶åï¼å¨ docker build è¿ç¨ä¸­æ§è¡ï¼\n * CMDï¼è®¾ç½®å®¹å¨å¯å¨åé»è®¤æ§è¡çå½ä»¤åå¶åæ°ï¼å¨ docker run æ¶è¿è¡ï¼ä½ docker run åè·åæ°æ¶ä¼æ¿æ¢ï¼å¿½ç¥ï¼ CMDï¼CMD å¯ä»¥è¢«è¦çï¼å¦ææ ENTRYPIOINT çè¯ï¼CMD å°±æ¯ ENTRYPIOINT çåæ°ãï¼\n * ENTRYPOINTï¼éç½®å®¹å¨å¯å¨æ¶è¿è¡çå½ä»¤ï¼ä¸ç®¡ docker run â¦ åæ¯å¦è¿è¡æå¶ä»å½ä»¤ï¼ENTRYPOINT æä»¤åçå½ä»¤ä¸å®ä¼è¢«æ§è¡ï¼ åé¢å¦æåæ¥å½ä»¤ï¼ä¼æ¥éå¤ä½çåæ°ã\n * CMD å ENTRYPIOINT å¿é¡»è¦æä¸ä¸ª\n\n\n# 2ãæä»¤è¯¦è§£\n\n# 1ãFROM\n\nFROM æä»¤æ¯å®ä¹æ¬é¶æ®µæå»ºæè¦ä½¿ç¨çåºç¡éåãä¾å¦æ¨éè¦å°æ¨ç java å¼åçé¡¹ç®æå»ºä¸ºä¸ä¸ªéåï¼é£ä¹æ¨å¯è½éè¦ tomcat éåï¼èå¶ä½ tomcat éåå°±å¯è½éè¦ jdk éåï¼é£ä¹ jdk éåå°±éè¦ä¸ä¸ªåºæ¬çæä½ç³»ç»éåï¼è¿å¯è½æ¯ utuntuãdebianãalpine ç­ã\n\næ ¹æ®ä»¥ä¸ï¼æä»¬åºè¯¥å¯ä»¥ç¥éç±äºå®¹å¨éåæ¯å¯ä»¥å¢éå å çï¼é£ä¹ tomcat éåä¸­å°±åºè¯¥åå«äº jdk ä»¥åä¸ä¸ªåºæ¬çæä½ç³»ç»ã\n\næ¨å¯ä»¥ä» hub.docker.com ç½ç«ä¸æ¥æéä¸ä¸ªåéçéåæ¥ä½ä¸ºæ¨çåºç¡éåã\n\n# 2ãCOPY\n\nå¤å¶æä»¤ï¼ä»ä¸ä¸æç®å½ä¸­å¤å¶æä»¶æèç®å½å°å®¹å¨éæå®è·¯å¾\n\nï¼ä¸ä¸æç®å½æ¯ææ¾ç½® Dockerfile æä»¶çç®å½ï¼\n\næ ¼å¼å¦ä¸ï¼\n\nCOPY [--chown=<user>:<group>] <æºè·¯å¾1>... <ç®æ è·¯å¾>\nCOPY [--chown=<user>:<group>] ["<æºè·¯å¾1>",... "<ç®æ è·¯å¾>"]\n\n\n1\n2\n\n\næ³¨æÂ [--chown=<user>:<group>]ï¼Â å¯éåæ°ï¼ç¨æ·æ¹åå¤å¶å°å®¹å¨åæä»¶çæ¥æèåå±ç»ã\n\n<æºè·¯å¾>ï¼æºæä»¶æèæºç®å½ï¼è¿éå¯ä»¥æ¯ééç¬¦è¡¨è¾¾å¼ï¼å¶ééç¬¦è§åè¦æ»¡è¶³ Go ç filepath.Match è§åãä¾å¦ï¼\n\nCOPY hom* /mydir/\n\nCOPY hom?.txt /mydir/\n\n<ç®æ è·¯å¾>ï¼å®¹å¨åçæå®è·¯å¾ï¼è¯¥è·¯å¾ä¸ç¨äºåå»ºå¥½ï¼è·¯å¾ä¸å­å¨çè¯ï¼ä¼èªå¨åå»ºã\n\n# 3ãADD\n\nADD æä»¤å COPY çä½¿ç¨æ ¼å¼ä¸è´ï¼åæ ·éæ±ä¸ï¼å®æ¹æ¨èä½¿ç¨ COPYï¼ãåè½ä¹ç±»ä¼¼ï¼ä¸åä¹å¤å¦ä¸ï¼\n\nADD çä¼ç¹ï¼å¨æ§è¡ <æºæä»¶> ä¸º tar åç¼©æä»¶çè¯ï¼åç¼©æ ¼å¼ä¸º gzip, bzip2 ä»¥å xz çæåµä¸ï¼ä¼èªå¨å¤å¶å¹¶è§£åå° < ç®æ è·¯å¾ >ã\n\nADD çç¼ºç¹ï¼å¨ä¸è§£åçåæä¸ï¼æ æ³å¤å¶ tar åç¼©æä»¶ãä¼ä»¤éåæå»ºç¼å­å¤±æï¼ä»èå¯è½ä¼ä»¤éåæå»ºåå¾æ¯è¾ç¼æ¢ãå·ä½æ¯å¦ä½¿ç¨ï¼å¯ä»¥æ ¹æ®æ¯å¦éè¦èªå¨è§£åæ¥å³å®ã\n\nå¯¹äºä½¿ç¨ ADD æä»¤ä¸è½½è¿ç¨æå¡å¨ä¸ç tar åå¹¶è§£åï¼å»ºè®®ä½¿ç¨ä»¥ä¸æ¹å¼ä»£æ¿\n\nRUN curl -s http://192.168.1.7/repository/tools/jdk-8u241-linux-x64.tar.gz | tar -xC /opt/\n\n\n1\n\n\n# 4ãRUN\n\nå½æä»¬å¨æå»ºéåè¿ç¨ä¸­ï¼éè¦æ§è¡ä¸äºéç½®ï¼ä¾å¦ä½¿ç¨ mkdir å½ä»¤æ°å»ºä¸ä¸ªç®å½ï¼ç¨ sed å½ä»¤æ¥æ¿æ¢ä¸äºææ¬åå®¹ç­ï¼å½ç¶å¯è½å¨å®éè¿ç¨ä¸­éè¦æ´å¤æçå½ä»¤ï¼é£ä¹æ­¤æ¶æ¨å¯ä»¥ä½¿ç¨ RUN æä»¤æ¥å®ä¹å°è¦è¿è¡çå½ä»¤ã\n\nRUN æä»¤å¨ Dockerfile ä¸­å¯ä»¥åºç°å¤æ¬¡ï¼docker Engine å¨æå»ºè¿ç¨ä¸­ä¼è¯»å Dockerfile ç¶åç±ä¸èä¸ä¾æ¬¡æ§è¡ RUN æä»¤ææ è®°çå½ä»¤ã\n\nRUN åé¢è·ççå½ä»¤è¡å½ä»¤ãæä»¥ä¸ä¿©ç§æ ¼å¼ï¼\n\nShell æ ¼å¼\n\nRUN <å½ä»¤è¡å½ä»¤>\n# <å½ä»¤è¡å½ä»¤> ç­åäºï¼å¨ç»ç«¯æä½ç shell å½ä»¤ã\n\n\n1\n2\n\n\nExec æ ¼å¼ï¼\n\nRUN ["å¯æ§è¡æä»¶", "åæ°1", "åæ°2"]\n# ä¾å¦ï¼\n# RUN ["./test.php", "dev", "offline"] ç­ä»·äº RUN ./test.php dev offline\n\n\n1\n2\n3\n\n\næ³¨æå¨æå»ºè¿ç¨ä¸­ docker Engine ä¼ä¸º Dockerfile ä¸­çæ¯ä¸ª RUN æä»¤åå»ºä¸ä¸ªéåå±ï¼layerï¼æ¥è®°å½è¿ç§æ¹åãå æ­¤ä¸ºäºåå°ä¸å¿è¦çéåå±æ°ï¼éå¸¸çåæ³æ¯å°å¤ä¸ªå½ä»¤å®ä¹å¨ä¸ä¸ª RUN æä»¤ä¸­ï¼å¦ä¸æç¤ºï¼\n\nRUN mkdir demo \\\n    && cd demo \\\n    && wget https://www.demo.com/download/demo.tar.gz \\\n    && tar -xf demo.tar.gz \\\n    && rm -rf demo.tar.gz\n\n\n1\n2\n3\n4\n5\n\n\nå¦ä¸ï¼ä»¥ && ç¬¦å·è¿æ¥å½ä»¤ï¼è¿æ ·æ§è¡åï¼åªä¼åå»º 1 å±éå\n\n# 5ãCMD\n\nç±»ä¼¼äº RUN æä»¤ï¼ç¨äºè¿è¡ç¨åºï¼ä½äºèè¿è¡çæ¶é´ç¹ä¸å:\n\nCMD å¨ docker run æ¶è¿è¡ã\n\nRUN æ¯å¨ docker build è¿ç¨ä¸­æ§è¡ã\n\nä½ç¨ï¼ä¸ºå¯å¨çå®¹å¨æå®é»è®¤è¦è¿è¡çç¨åºï¼ç¨åºè¿è¡ç»æï¼å®¹å¨ä¹å°±ç»æãCMD æä»¤æå®çç¨åºå¯è¢« docker run å½ä»¤è¡åæ°ä¸­æå®è¦è¿è¡çç¨åºæè¦çã\n\n> æ³¨æ\n> \n> å¦æ Dockerfile ä¸­å¦æå­å¨å¤ä¸ª CMD æä»¤ï¼ä»æåä¸ä¸ªçæã\n\næ ¼å¼ï¼\n\nCMD <shell å½ä»¤> \nCMD ["<å¯æ§è¡æä»¶æå½ä»¤>","<param1>","<param2>",...] \nCMD ["<param1>","<param2>",...]  # è¯¥åæ³æ¯ä¸º ENTRYPOINT æä»¤æå®çç¨åºæä¾é»è®¤åæ°\n\n\n1\n2\n3\n\n\næ¨èä½¿ç¨ç¬¬äºç§æ ¼å¼ï¼æ§è¡è¿ç¨æ¯è¾æç¡®ãç¬¬ä¸ç§æ ¼å¼å®éä¸å¨è¿è¡çè¿ç¨ä¸­ä¹ä¼èªå¨è½¬æ¢æç¬¬äºç§æ ¼å¼è¿è¡ï¼å¹¶ä¸é»è®¤å¯æ§è¡æä»¶æ¯ shã\n\nä¾å¦æ¨æä¸ä¸ª nodejs ç¨åºï¼å¯å¨è¯¥ç¨åºçå½ä»¤æ¯ node server.jsï¼ç¶åæ¨å¸æå¨ä½¿ç¨è¯¥éåè¿è¡å®¹å¨æ¶ä¹ä»¥è¿ç§æ¹å¼è¿è¡ï¼é£ä¹æ¨å¯ä»¥å¨ Dockerfile ä¸­ä½¿ç¨ CMD æ¥æ è®°ï¼å¦ä¸ï¼\n\nCMD ["node","server.js"]\n\n\n1\n\n\néå¸¸ CMD æä»¤åºç°å¨ Dockerfile æ«å°¾å¤ãå½æ¨å°ä»¥ä¸å®ä¹åå¥ Dockerfile ä¸­å¹¶æåæéåï¼demo:v1ï¼ï¼ç¶åæ¨ä½¿ç¨è¯¥éåè¿è¡æ¶ï¼é£ä¹è¯¥å®¹å¨å°ä½¿ç¨ Dockerfile ä¸­ CMD å®ä¹çå½ä»¤æ¥è¿è¡\n\ndocker  run  -d  --name=demo  deom:v1\n\n\n1\n\n\nå½ç¶æ¨å¯ä»¥å¨è¿è¡æ¶è¦ç CMD æä»¤ä¸­çå½ä»¤ï¼ä¾å¦è¿éæ¹æ npm startï¼å½ä»¤å¦ä¸\n\ndocker  run  -d  --name=demo  deom:v1  npm  start\n\n\n1\n\n\n# 6ãENTRYPOINT\n\nç±»ä¼¼äº CMD æä»¤ï¼ä½å¶ä¸ä¼è¢« docker run çå½ä»¤è¡åæ°æå®çæä»¤æè¦çï¼èä¸è¿äºå½ä»¤è¡åæ°ä¼è¢«å½ä½åæ°éç» ENTRYPOINT æä»¤æå®çç¨åºã\n\nä½æ¯ï¼å¦æè¿è¡ docker run æ¶ä½¿ç¨äº --entrypoint éé¡¹ï¼å°è¦ç CMD æä»¤æå®çç¨åºã\n\nä¼ç¹ï¼å¨æ§è¡ docker run çæ¶åå¯ä»¥æå® ENTRYPOINT è¿è¡æéçåæ°ã\n\næ³¨æï¼å¦æ Dockerfile ä¸­å¦æå­å¨å¤ä¸ª ENTRYPOINT æä»¤ï¼ä»æåä¸ä¸ªçæã\n\næ ¼å¼ï¼\n\nENTRYPOINT ["<executeable>","<param1>","<param2>",...]\n\n\n1\n\n\nå¯ä»¥æ­é CMD å½ä»¤ä½¿ç¨ï¼ä¸è¬æ¯ååæä¼ä½¿ç¨ CMD ï¼è¿éç CMD ç­äºæ¯å¨ç» ENTRYPOINT ä¼ åï¼ä»¥ä¸ç¤ºä¾ä¼æå°ã\n\nç¤ºä¾ï¼\n\nåè®¾å·²éè¿ Dockerfile æå»ºäº nginx:test éå\n\nFROM nginx\nENTRYPOINT ["nginx", "-c"] # å®å\nCMD ["/etc/nginx/nginx.conf"] # åå\n\n\n1\n2\n3\n\n\nä¸ä¼ åè¿è¡\n\ndocker run nginx:test\n\n\n1\n\n\nå®¹å¨åä¼é»è®¤è¿è¡ä»¥ä¸å½ä»¤ï¼å¯å¨ä¸»è¿ç¨ã\n\nnginx -c /etc/nginx/nginx.conf\n\n\n1\n\n\nä¼ åè¿è¡\n\ndocker run nginx:test -c /etc/nginx/new.conf\n\n\n1\n\n\nå®¹å¨åä¼é»è®¤è¿è¡ä»¥ä¸å½ä»¤ï¼å¯å¨ä¸»è¿ç¨ (/etc/nginx/new.conf: åè®¾å®¹å¨åå·²ææ­¤æä»¶)\n\nnginx -c /etc/nginx/new.conf\n\n\n1\n\n\néå¸¸æ´å¥½çåæ³æ¯ä½¿ç¨ ENTRYPOINT æ¥å®ä¹ä¸ä¸ª docker-entrypoint.sh èæ¬ï¼ç¶åå¨è¯¥èæ¬ä¸­å®ä¹ä¸äºé¢å¤çåæ¡ä»¶å¤æ­ï¼æ¥åºå¯¹æ´å¤æªç¥æåµãä¾å¦ cups éåç Dockerfile\n\nARG ARCH=amd64\nFROM $ARCH/debian:buster-slim\n# environment\nENV ADMIN_PASSWORD=admin\n# â¦â¦åå®¹å¤ªå¤ï¼ä¸­é´åå®¹å·²çç¥\nENTRYPOINT [ "docker-entrypoint.sh" ]\n# default command\nCMD ["cupsd", "-f"]\n# volumes\nVOLUME ["/etc/cups"]\n# ports\nEXPOSE 631\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nè¯¥éåç docker-entrypoint.sh æä»¶åå®¹å¦ä¸ï¼\n\n#!/bin/bash -e\necho -e "${ADMIN_PASSWORD}\\n${ADMIN_PASSWORD}" | passwd admin\nif [ ! -f /etc/cups/cupsd.conf ]; then\n  cp -rpn /etc/cups-skel/* /etc/cups/\nfi\nexec "$@"\n\n\n1\n2\n3\n4\n5\n6\n\n\n# 7ãENV\n\nè®¾ç½®ç¯å¢åéï¼å®ä¹äºç¯å¢åéï¼é£ä¹å¨åç»­çæä»¤ä¸­ï¼å°±å¯ä»¥ä½¿ç¨è¿ä¸ªç¯å¢åéãå½ç¶å¨æ¨ä½¿ç¨è¯¥éåè¿è¡å®¹å¨æ¶ï¼ENV æå®ä¹çåéä»ç¶å¯¹å®¹å¨ææï¼ä¾å¦ MySQL éåç Dockerfile ä¸­å°±åå« root ç¨æ·çåå§å¯ç ï¼ä½¿ç¨ ENV æ¥æå®ã\n\næ ¼å¼ï¼\n\nENV <key> <value>\nENV <key1>=<value1> <key2>=<value2>...\n\n\n1\n2\n\n\nä»¥ä¸ç¤ºä¾è®¾ç½® NODE_VERSION = 16.19.0 ï¼ å¨åç»­çæä»¤ä¸­å¯ä»¥éè¿ $NODE_VERSION å¼ç¨ï¼\n\nENV NODE_VERSION 16.19.0\nRUN curl -SLO "https://nodejs.org/download/release/latest-v16.x/node-v$NODE_VERSION-linux-x64.tar.gz" \n\n\n1\n2\n\n\nDockerfile ä¸­ ENV æä»¤å RUN æä»¤ä¸æ ·ï¼æ¯ä¸ä¸ªé½ä¼åå»ºä¸ä¸ªä¸´æ¶å±ã\n\nENV JAVA_HOME=/opt/jdk1.8.0_241 \\\n    CLASSPATH=.:$JAVA_HOME/lib:$JAVA_HOME/jre/lib \nENV PATH=$PATH:$JAVA_HOME/bin\n\n\n1\n2\n3\n\n\n# 8ãARG\n\næå»ºåæ°ï¼ä¸ ENV ä½ç¨ä¸è³ãä¸è¿ä½ç¨åä¸ä¸æ ·ãARG è®¾ç½®çç¯å¢åéä»å¯¹ Dockerfile åææï¼ä¹å°±æ¯è¯´åªæ docker build çè¿ç¨ä¸­ææï¼æå»ºå¥½çéååä¸å­å¨æ­¤ç¯å¢åéã\n\næå»ºå½ä»¤ docker build ä¸­å¯ä»¥ç¨ --build-arg <åæ°å>=< å¼ > æ¥è¦çã\n\næ ¼å¼\n\nARG <åæ°å>[=<é»è®¤å¼>]\n\n\n1\n\n\n# 9ãVOLUME\n\nå®ä¹å¿åæ°æ®å·ãå¨å¯å¨å®¹å¨æ¶å¿è®°æè½½æ°æ®å·ï¼ä¼èªå¨æè½½å°å¿åå·ã\n\nä½ç¨ï¼\n\né¿åéè¦çæ°æ®ï¼å å®¹å¨éå¯èä¸¢å¤±ï¼è¿æ¯éå¸¸è´å½çã\n\né¿åå®¹å¨ä¸æ­åå¤§ã\n\næ ¼å¼ï¼\n\nVOLUME ["<è·¯å¾1>", "<è·¯å¾2>"...]\nVOLUME <è·¯å¾\n\n\n1\n2\n\n\nå¨å¯å¨å®¹å¨ docker run çæ¶åï¼æä»¬å¯ä»¥éè¿ -v åæ°ä¿®æ¹æè½½ç¹ã\n\n# 10ãEXPOSE\n\nä»ä»åªæ¯å£°æç«¯å£ã\n\nä½ç¨ï¼\n\nå¸®å©éåä½¿ç¨èçè§£è¿ä¸ªéåæå¡çå®æ¤ç«¯å£ï¼ä»¥æ¹ä¾¿éç½®æ å°ã\n\nå¨è¿è¡æ¶ä½¿ç¨éæºç«¯å£æ å°æ¶ï¼ä¹å°±æ¯ docker run -P æ¶ï¼ä¼èªå¨éæºæ å° EXPOSE çç«¯å£ã\n\næ ¼å¼ï¼\n\nEXPOSE <ç«¯å£1> [<ç«¯å£2>...]\n\n\n1\n\n\n# 11ãWORKDIR\n\næå®å·¥ä½ç®å½ãç¨ WORKDIR æå®çå·¥ä½ç®å½ï¼ä¼å¨æå»ºéåçæ¯ä¸å±ä¸­é½å­å¨ãï¼WORKDIR æå®çå·¥ä½ç®å½ï¼å¦æç®å½ä¸å­å¨åä¼èªå¨åå»ºï¼ã\n\næ ¼å¼ï¼\n\nWORKDIR <å·¥ä½ç®å½è·¯å¾>\n\n\n1\n\n\n# 12ãUSER\n\nç¨äºæå®æ§è¡åç»­å½ä»¤çç¨æ·åç¨æ·ç»ï¼è¿è¾¹åªæ¯åæ¢åç»­å½ä»¤æ§è¡çç¨æ·ï¼ç¨æ·åç¨æ·ç»å¿é¡»æåå·²ç»å­å¨ï¼ã\n\næ ¼å¼\n\nUSER <ç¨æ·å>[:<ç¨æ·ç»>]\n\n\n1\n\n\n# 13ãHEALTHCHECK\n\nç¨äºæå®æä¸ªç¨åºæèæä»¤æ¥çæ§ docker å®¹å¨æå¡çè¿è¡ç¶æã\n\næ ¼å¼ï¼\n\nHEALTHCHECK [éé¡¹] CMD <å½ä»¤>ï¼è®¾ç½®æ£æ¥å®¹å¨å¥åº·ç¶åµçå½ä»¤\nHEALTHCHECK NONEï¼å¦æåºç¡éåæå¥åº·æ£æ¥æä»¤ï¼ä½¿ç¨è¿è¡å¯ä»¥å±è½æå¶å¥åº·æ£æ¥æä»¤\nHEALTHCHECK [éé¡¹] CMD <å½ä»¤> : è¿è¾¹ CMD åé¢è·éçå½ä»¤ä½¿ç¨ï¼å¯ä»¥åè CMD çç¨æ³ã\nHEALTHCHECK æ¯æä¸åéé¡¹ï¼\n--interval=<é´é>ï¼ä¸¤æ¬¡å¥åº·æ£æ¥çé´éï¼é»è®¤ä¸º 30 ç§ï¼\n--timeout=<æ¶é¿>ï¼å¥åº·æ£æ¥å½ä»¤è¿è¡è¶æ¶æ¶é´ï¼å¦æè¶è¿è¿ä¸ªæ¶é´ï¼æ¬æ¬¡å¥åº·æ£æ¥å°±è¢«è§ä¸ºå¤±è´¥ï¼é»è®¤ 30 ç§ï¼\n--retries=<æ¬¡æ°>ï¼å½è¿ç»­å¤±è´¥æå®æ¬¡æ°åï¼åå°å®¹å¨ç¶æè§ä¸º unhealthyï¼é»è®¤ 3 æ¬¡ã\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå CMD, ENTRYPOINT ä¸æ ·ï¼HEALTHCHECK åªå¯ä»¥åºç°ä¸æ¬¡ï¼å¦æåäºå¤ä¸ªï¼åªææåä¸ä¸ªçæã\n\nå¨ HEALTHCHECK [éé¡¹] CMD åé¢çå½ä»¤ï¼æ ¼å¼å ENTRYPOINT ä¸æ ·ï¼åä¸º shell æ ¼å¼ï¼å exec æ ¼å¼ãå½ä»¤çè¿åå¼å³å®äºè¯¥æ¬¡å¥åº·æ£æ¥çæåä¸å¦ï¼0ï¼æåï¼1ï¼å¤±è´¥ï¼2ï¼ä¿çï¼ä¸è¦ä½¿ç¨è¿ä¸ªå¼ã\n\nåè®¾æä»¬æä¸ªéåæ¯ä¸ªæç®åç Web æå¡ï¼æä»¬å¸æå¢å å¥åº·æ£æ¥æ¥å¤æ­å¶ Web æå¡æ¯å¦å¨æ­£å¸¸å·¥ä½ï¼æä»¬å¯ä»¥ç¨ curl æ¥å¸®å©å¤æ­ï¼å¶ Dockerfile ç HEALTHCHECK å¯ä»¥è¿ä¹åï¼\n\nFROM nginx\nRUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*\nHEALTHCHECK --interval=5s --timeout=3s \\\n  CMD curl -fs http://localhost/ || exit 1\n\n\n1\n2\n3\n4\n\n\nå½ç¶æ¨å¯ä»¥å¨ docker run å½ä»¤ä¸­ï¼ç´æ¥ææ healthcheck ç¸å³ç­ç¥ï¼å¦ä¸ï¼\n\ndocker run --rm -d \\\n    --name=elasticsearch \\\n    --health-cmd="curl --silent --fail localhost:9200/_cluster/health || exit 1" \\\n    --health-interval=5s \\\n    --health-retries=12 \\\n    --health-timeout=2s \\\n    elasticsearch:7\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# 14ãONBUILD\n\nç¨äºå»¶è¿æå»ºå½ä»¤çæ§è¡ãç®åçè¯´ï¼å°±æ¯ Dockerfile éç¨ ONBUILD æå®çå½ä»¤ï¼å¨æ¬æ¬¡æå»ºéåçè¿ç¨ä¸­ä¸ä¼æ§è¡ï¼åè®¾éåä¸º test-buildï¼ãå½ææ°ç Dockerfile ä½¿ç¨äºä¹åæå»ºçéå FROM test-build ï¼è¿æ¯æ§è¡æ°éåç Dockerfile æå»ºæ¶åï¼ä¼æ§è¡ test-build ç Dockerfile éç ONBUILD æå®çå½ä»¤ã\n\næ ¼å¼ï¼\n\nONBUILD <å¶å®æä»¤>\n\n\n1\n\n\nåè®¾æä»¬è¦å¶ä½ Node.js æåçåºç¨çéåãæä»¬é½ç¥é Node.js ä½¿ç¨ npm è¿è¡åç®¡çï¼ææä¾èµãéç½®ãå¯å¨ä¿¡æ¯ç­ä¼æ¾å° package.json æä»¶éãå¨æ¿å°ç¨åºä»£ç åï¼éè¦åè¿è¡ npm install æå¯ä»¥è·å¾ææéè¦çä¾èµãå°é¡¹ç®ç¸å³çæä»¤å ä¸ ONBUILDï¼è¿æ ·å¨æå»ºåºç¡éåçæ¶åï¼è¿ä¸è¡å¹¶ä¸ä¼è¢«æ§è¡ãåºç¡éååååï¼åä¸ªé¡¹ç®é½ç¨è¿ä¸ª Dockerfile éæ°æå»ºéåï¼ä¼ç»§æ¿åºç¡éåçæ´æ°ã\n\nFROM node:slim\nRUN mkdir /app\nWORKDIR /app\nONBUILD COPY ./package.json /app\nONBUILD RUN [ "npm", "install" ]\nONBUILD COPY . /app/\nCMD [ "npm", "start" ]\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# 15ãLABEL\n\nLABEL æä»¤ç¨æ¥ç»éåä»¥é®å¼å¯¹çå½¢å¼æ·»å ä¸äºåæ°æ®ï¼metadataï¼\n\næ ¼å¼ï¼\n\nLABEL <key>=<value> <key>=<value> <key>=<value> ...\n\n\n1\n\n\næä»¬è¿å¯ä»¥ç¨ä¸äºæ ç­¾æ¥ç³æéåçä½èãææ¡£å°åç­ï¼ä¾å¦ï¼\n\nLABEL org.opencontainers.image.authors="deamon"\nLABEL org.opencontainers.image.documentation="https://daemon.gitbooks.io"\næè\nLABEL vendor=ACME\\ Incorporated \\\n      com.example.is-beta= \\\n      com.example.is-production="" \\\n      com.example.version="0.0.1-beta" \\\n      com.example.release-date="2015-02-12"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# 16ã.dockerignore æä»¶\n\næ§è¡Â docker buildÂ å½ä»¤æ¶ï¼å½åçå·¥ä½ç®å½è¢«ç§°ä¸ºæå»ºä¸ä¸æãé»è®¤æåµä¸ï¼Dockerfile å°±ä½äºè¯¥è·¯å¾ä¸ãä¹å¯ä»¥éè¿Â -fÂ åæ°æ¥æå® dockerfile ï¼ä½ docker å®¢æ·ç«¯ä¼å°å½åå·¥ä½ç®å½ä¸çæææä»¶åéå° docker å®æ¤è¿ç¨è¿è¡æå»ºã\n\næä»¥æ¥è¯´ï¼å½æ§è¡ docker build è¿è¡æå»ºéåæ¶ï¼å½åç®å½ä¸å®è¦Â å¹²åÂ ï¼åè®°ä¸è¦å¨å®¶éå½ä¸åå»ºä¸ä¸ª Dockerfile ç´§æ¥çÂ docker buildÂ ä¸ææ¢­ã\n\næ­£ç¡®åæ³æ¯ä¸ºé¡¹ç®å»ºç«ä¸ä¸ªæä»¶å¤¹ï¼ææå»ºéåæ¶æéè¦çèµæºæ¾å¨è¿ä¸ªæä»¶å¤¹ä¸ãæ¯å¦è¿æ ·ï¼\n\nmkdir project\ncd !$\nvi Dockerfile\n# ç¼å Dockerfile\n\n\n1\n2\n3\n4\n\n\nä¹å¯ä»¥éè¿Â .dockerignoreÂ æä»¶æ¥å¿½ç¥ä¸éè¦çæä»¶åéå° docker å®æ¤è¿ç¨\n\nå¨ docker CLI å°ä¸ä¸æåéå° docker å®æ¤ç¨åºä¹åï¼å®ä¼å¨ä¸ä¸æçæ ¹ç®å½ä¸­æ¥æ¾ä¸ä¸ªåä¸º.dockerignore çæä»¶ãå¦ææ­¤æä»¶å­å¨ï¼CLI å°ä¿®æ¹ä¸ä¸æä»¥æé¤ä¸å¶ä¸­æ¨¡å¼å¹éçæä»¶åç®å½ãè¿æå©äºé¿åä¸å¿è¦å°å°å¤§åææææä»¶åç®å½åéå°å®æ¤ç¨åºï¼å¹¶å¯è½ä½¿ç¨æå°å®ä»¬æ·»å å°éåä¸­ã\n\nä¾å¦ï¼\n\n# comment\n*/temp*\n*/*/temp*\ntemp?\n*.md\nREADME-secret.md\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# ä¸ãéåä¼å\n\n\n# 1ãåºç¡éåéæ©\n\nä½¿ç¨ä½ç§¯è¾å°çåºç¡éåï¼æ¯å¦ alpine æè debian:buster-slimï¼å openjdk å¯ä»¥éç¨ openjdk:xxx-slimï¼ç±äº openjdk æ¯åºäº debian çåºç¡éåæå»ºçï¼æä»¥å debian åºç¡éåä¸æ ·ï¼åé¢å¸¦ä¸ª slim å°±æ¯åºäº debian:xxx-slim éåæå»ºçã\n\nç®å Docker å®æ¹å·²å¼å§æ¨èä½¿ç¨ Alpine æ¿ä»£ä¹åç Ubuntu åä¸ºåºç¡éåç¯å¢ãè¿æ ·ä¼å¸¦æ¥å¤ä¸ªå¥½å¤ãåæ¬éåä¸è½½éåº¦å å¿«ï¼éåå®å¨æ§æé«ï¼ä¸»æºä¹é´çåæ¢æ´æ¹ä¾¿ï¼å ç¨æ´å°ç£çç©ºé´ç­ã\n\nREPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE\ndebian                      buster-slim         e1af56d072b8        4 days ago          69.2MB\nalpine                      latest              cc0abc535e36        8 days ago          5.59MB\n\n\n1\n2\n3\n\n\nä¸è¿éè¦æ³¨æçæ¯ï¼alpine ç c åºæ¯ musl libc ï¼èä¸æ¯æ­£ç»ç glibcï¼å¦å¤å¯¹äºä¸äºä¾èµ glibc çå¤§åé¡¹ç®ï¼å openjdk ãtomcatãrabbitmq ç­é½ä¸å»ºè®®ä½¿ç¨ alpine åºç¡éåï¼å ä¸º musl libc å¯è½ä¼å¯¼è´ JVM ä¸äºå¥æªçé®é¢ãè¿ä¹æ¯ä¸ºä»ä¹ tomcat å®æ¹æ²¡æç»åºåºç¡éåæ¯ alpine ç Dockerfile çåå ã\n\nå¶ä½åç«¯éåæ¶ä¸å®ä¸è¦ä½¿ç¨centosãUbuntuç­ç³»ç»éåï¼æä»¬å¯ä»¥ç´æ¥ä½¿ç¨å®æ¹æä¾çnginxéåæ¥ä½ä¸ºåºç¡éåï¼è¿æ ·æä»¬åªéæå¶ä½å¥½çwebéææä»¶æ·è´ä¸ä¸å°±å¯ä»¥äºã\n\næ¨å¯ä»¥å¨hub.docker.comç½ç«ä¸æç´¢æ´å°çéåæèè¯´æ´ç¬¦åæ¨è¦æ±çéåï¼ç¶åä½ä¸ºåºç¡éåæ¥å®ææå»ºã\n\nåºç¡éå      ä¼ç¹                  ç¼ºç¹                         å¤æ³¨\nAlpine    å ç¨ç©ºé´å°               åºäºmusl libcåbusybox        å®æ¹æ¨è\nbusybox   å ç¨ç©ºé´å°ï¼æåº¦è½»éç         å·¥å·å¤ªå°                       ä¸æ¨èï¼ç»ä»¶ä¸å¨\nscratch   ç©ºéåï¼éåå¤§å°çº¦ç­äºæ§è¡æä»¶å¤§å°   æ²¡æshæbashï¼æ æ³è¿å¥å®¹å¨åè¿è¡äº¤äºå¼è°è¯   éågoè¯­è¨\n\ndockeréåå¸¸è§çåæ°\n\nåæ°               è¯´æ\nbuster           éç¨ä¸ debian 10\nstretch          éç¨äº debian 9\njessie           éç¨äº debian 8\nslim             è¡¨ç¤ºæå°å®è£åï¼ä»åå«éè¦è¿è¡æå®å®¹å¨çç¹å®å·¥å·é\nAlphine/alpine   ä¸é¨ä¸ºå®¹å¨æå»ºçæä½ç³»ç»ï¼æ¯å¶ä»çæä½ç³»ç»æ´å°ï¼ä½æ¯å¶ä¸ä¼ç¼ºå°å¾å¤è½¯ä»¶åå¹¶ä¸ä½¿ç¨ç glibc ç­é½æ¯éå²ç\nbullseye         å¼åçæ¬ï¼å¤äºæªç¨³å®ç¶æ\n\n\n# 2ãéç½®å½åè½¯ä»¶æº\n\nä½¿ç¨é»è®¤çè½¯ä»¶æºå®è£æå»ºæ¶æéçä¾èµï¼å¯¹äºç»å¤§å¤æ°åºç¡éåæ¥è¯´ï¼å¯ä»¥éè¿ä¿®æ¹è½¯ä»¶æºçæ¹å¼æ´æ¢ä¸ºå½åçè½¯ä»¶æºéåç«ãç®åå½åç¨³å®å¯é çéåç«ä¸»è¦æï¼åä¸ºäºãé¿éäºãè¾è®¯äºã163 ç­ã\n\nå¯¹äº alpine åºç¡éåä¿®æ¹è½¯ä»¶æº\n\nRUN sed -i \'s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g\' /etc/apk/repositories\n\n\n1\n\n\ndebian åºç¡éåä¿®æ¹é»è®¤è½¯ä»¶æº\n\nRUN sed -i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list\nRUN sed -i "s@http://deb.debian.org@http://mirrors.aliyun.com@g" /etc/apt/sources.list && \\\n    rm -Rf /var/lib/apt/lists/* && \\\n\n\n1\n2\n3\n\n\nUbuntu åºç¡éåä¿®æ¹é»è®¤è½¯ä»¶æº\n\nRUN sed -i \'s/archive.ubuntu.com/mirrors.aliyun.com/g\' /etc/apt/sources.list && \\\n    sed -i \'s/security.ubuntu.com/mirrors.aliyun.com/g\' /etc/apt/sources.list\n\n\n1\n2\n\n\nå¯¹äº CentOS ???\n\nä½ ç¡®å®è¦ç¨ 230MB å¤§å°çåºç¡éåï¼\n\nREPOSITORY                               TAG           IMAGE ID       CREATED          SIZE\ncentos                                   latest        5d0da3dc9764   16 months ago    231MB\n\n\n1\n2\n\n\nå»ºè®®è¿äºå½ä»¤å°±æ¾å¨ RUN æä»¤çç¬¬ä¸æ¡ï¼update ä»¥ä¸è½¯ä»¶æºï¼ä¹åå install ç¸åºçä¾èµã\n\n\n# åãæå»ºéå\n\n\n# 1ãå½å\n\nååæ¯è§åç¥æãå¯ä½¿ç¨ä¸æ®µå¼\n\n> éåä»åºå°å/ç±»ååº/éåå:çæ¬å·\n\n * registry/runtime/Java:8.1.2\n * registry/runtime/php-fpm-nginx:7.3-1.14\n * registry/cicd/kubctl-helm:1.17-3.0\n * registry/cicd/git-compose-docker:v1\n * registry/applications/demo:git_commit_id\n\n\n# 2ãåºäºéåé¨ç½²æå¡\n\né£ä¹ç°å¨æä»¬å°±å¯ä»¥å©ç¨ä»¥ä¸æä»¤ï¼å°æä»¬å¨å®¿ä¸»æºä¸æ§è¡çæä½ï¼åå¨ä¸ä¸ªDockerfileä¸­ï¼ç¤ºä¾å¦ä¸ï¼\n\nFROM centos:7\nMAINTAINER 759600963@qq.com\n#æ§è¡ä¸é¢å½ä»¤ï¼å®è£åºç¡ç¯å¢\nRUN yum install -y gcc gcc-c++ make \\\n    openssl-devel pcre-devel gd-devel \\\n    iproute net-tools telnet wget curl && \\\n    yum clean all && \\\n    rm -rf /var/cache/yum/*\nRUN wget http://nginx.org/download/nginx-1.20.1.tar.gz\nRUN tar -zxf nginx-1.20.1.tar.gz -C /usr/src\nRUN useradd -M -s /sbin/nologin nginx\nWORKDIR /usr/src/nginx-1.20.1\nRUN ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx && make && make install\nRUN ln -s /usr/local/nginx/sbin/* /usr/local/sbin/\nRUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\nWORKDIR /usr/local/nginx\nEXPOSE 80\nCMD ["nginx", "-g", "daemon off;"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nå¦ä¸æç¤ºï¼FROMå®ä¹äºåºäºcentos7éåæ¥æå»ºï¼è¿éä½¿ç¨äºyumæ¹å¼æ¥å®è£ä¾èµï¼å¹¶éè¿æºç ç¼è¯çæ¹å¼è¿è¡å®è£ãç¶åä½¿ç¨WORKDIRå®ä¹äºè¿ç¨çå·¥ä½ç®å½ï¼ä½¿ç¨EXPOSEå£°æäºåºç¨è¦ä½¿ç¨çç«¯å£ï¼æåä½¿ç¨CMDæå®äºå®¹å¨å¯å¨æ¶é»è®¤å½ä»¤ã\n\n# docker pull centos:7\n\n\n1\n\n\né£ä¹æ­¤æ¶æä»¬å¯ä»¥åå»ºä¸ä¸ªç©ºç®å½ä¾å¦nginxï¼ç¶åå°Dockerfileæä»¶æ¾ç½®äºè¯¥ç®å½ä¸­ï¼ç¶åæ§è¡æå»ºå½ä»¤\n\n# docker build -t web:centos .\n\n\n1\n\n\næ³¨æ\n\nè¿éç-tåæ°æ¯ä¸ºè¿ä¸ªæå»ºçéååä¸ä¸ªåå­ï¼è®¾ç½®ä¸ä¸ªæ ç­¾ï¼å¨èªå¨çæéåçå½ä»¤æå®éååï¼ä¸å®ä¸è¦å¿è®°åæ°çæéåçå­æ¾è·¯å¾ï¼ä¹å°±æ¯ç©ºæ ¼åç ä¸ ä¸ªâ.âä»£è¡¨å½åè·¯å¾ï¼å¦åä¼æ¥éã\n\nå½æä»¬æ§è¡buildåï¼dockerä¼å°buildæä»¶å¤¹è¿åDockerfileä¸èµ·ææçæä»¶ï¼å¦ææå¶ä»æä»¶ï¼æäº¤è³docker engineæ¥å¤çãdocker Engineå°éè¡è§£æDockerfileæä»¶ï¼å¹¶æ§è¡ç¸å³æä½ãDockerfileçè§£ææ¯ç±ä¸èä¸çé¡ºåºè¿è¡ã\n\næ³¨ææ¨æ¾ç½®Dockerfileçç®å½æå¥½æ¯ä¸ä¸ªç©ºç®å½ï¼æèåªæ¾ç½®ä¸æ¬æ¬¡æå»ºç¸å³çæä»¶å³å¯ï¼å ä¸ºå¨æ§è¡buildæ¶ä¼å°Dockerfileä»¥åDockerfileè·¯å¾ä¸çæææä»¶æäº¤è³docker Engineå¤çï¼å æ­¤æ¨ä¸åºè¯¥å¨Dockerfileç®å½ä¸­æ¾ç½®ä¸äºæ å³çæä»¶ï¼è¿æ¯æ æä¹çå¹¶ä¸è¿å°ä¼ä¸¥éææ¢æ´ä¸ªæå»ºè¿ç¨ã\n\nä½¿ç¨æ°çéåè¿è¡å®¹å¨\n\n# docker run -itd --name testweb -p 80:80 web:centos\n73277ceaa7a9a72d7a729029360413cfc0364effb4062b3df25aa960c67b894a\n\n\n1\n2\n\n\n\n# 3ãä½¿ç¨Makefileæä½Dockerfile\n\nIMAGE_BASE = registry/runtime\nIMAGE_NAME = php-fpm\nIMAGE_VERSION = 7.3\nIMAGE_TAGVERSION = $(GIT_COMMIT)\n\nall: build tag push\n\nbuild:\n  docker build --rm -f Dockerfile -t ${IMAGE_BASE}/${IMAGE_NAME}:${IMAGE_VERSION} .\n\ntag:\n  docker tag ${IMAGE_BASE}/${IMAGE_NAME}:${IMAGE_VERSION} ${IMAGE_BASE}/${IMAGE_NAME}:${IMAGE_TAGVERSION}\n\npush:\n  docker push ${IMAGE_BASE}/${IMAGE_NAME}:${IMAGE_TAGVERSION}\n\n# æå»ºå¹¶æ¨é\nmake \n# ä»æå»º\nmake build \n# ä»ætag\nmake tag\n# ä»æ¨é\nmake push\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nmakefileä¸­çå½ä»¤å¿é¡»ä»¥tabä½ä¸ºå¼å¤´(åéç¬¦),ä¸è½ç¨æ©å±çtabå³ç¨ç©ºæ ¼ä»£æ¿çtabã(å¦ææ¯vimç¼è¾çè¯,æ§è¡ set noexpandtab)ãå¦åä¼æ¥å¦ä¸éè¯¯ï¼Makefile:10: *** multiple target patterns. Stop.\n\n\n# äºãå¤é¶æ®µæå»ºéå\n\nå¨ç¼åDockerfileæå»ºdockeréåæ¶ï¼å¸¸éå°ä»¥ä¸é®é¢ï¼\n\n 1. RUNå½ä»¤ä¼è®©éåæ°å¢layerï¼å¯¼è´éååå¤§ï¼è½ç¶éè¿&&è¿æ¥å¤ä¸ªå½ä»¤è½ç¼è§£æ­¤é®é¢ï¼ä½å¦æå½ä»¤ä¹é´ç¨å°dockeræä»¤ä¾å¦COPYãWORKDIRç­ï¼ä¾ç¶ä¼å¯¼è´å¤ä¸ªlayerï¼\n 2. æäºå·¥å·å¨æå»ºè¿ç¨ä¸­ä¼ç¨å°ï¼ä½æ¯æç»çéåæ¯ä¸éè¦çï¼ä¾å¦ç¨npmç¼è¯æå»ºåç«¯å·¥ç¨ï¼ï¼è¿è¦æ±Dockerfileçç¼åèè±æ´å¤ç²¾åæ¥æ¸çè¿äºå·¥å·ï¼æ¸ççè¿ç¨åå¯è½å¯¼è´æ°çlayerï¼\n\nä¸ºäºè§£å³ä¸è¿°é®é¢ï¼ä»17.05çæ¬å¼å§Dockerå¨æå»ºéåæ¶å¢å äºæ°ç¹æ§ï¼å¤é¶æ®µæå»º(multi-stage builds)ï¼å°æå»ºè¿ç¨åä¸ºå¤ä¸ªé¶æ®µï¼æ¯ä¸ªé¶æ®µé½å¯ä»¥æå®ä¸ä¸ªåºç¡éåï¼è¿æ ·å¨ä¸ä¸ªDockerfileå°±è½å°å¤ä¸ªéåçç¹æ§åæ¶ç¨å°\n\næä»¬å¯ä»¥å¨ä¸ä¸ªDockerfileä¸­ä½¿ç¨å¤ä¸ªFROMæä»¤å¹¶å°ä¸æ¬¡æå»ºåæå¤ä¸ªé¶æ®µæ¥å®æ\n\n# build stage\nFROM node:14.18.2-stretch-slim AS build-env\n# å·¥ä½ç®å½\nWORKDIR /app\n# å°gitä»åºä¸æææä»¶æ·è´å°å·¥ä½ç®å½\nCOPY . .\nRUN npm install\nRUN npm audit fix\nRUN npm run build:production\n\n# production stage\n# çäº§ç¯å¢åºç¡nginxéåï¼ä¸é¢çéåå·²ç»æåä¸ºäºéææä»¶ï¼\nFROM nginx:alpine\nADD  prod.conf /etc/nginx/conf.d/\n# ä½¿ç¨--fromæä¸é¢äº§ççéææä»¶å¤å¶å°nginxçè¿è¡ç®å½\nCOPY --from=build-env /app/dist /usr/share/nginx/html\nRUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \\\n    echo \'Asia/Shanghai\' >/etc/timezone\n# nginxå®¹å¨åé¨æ´é²çç«¯å£\nEXPOSE 80\n# è¿è¡çå½ä»¤\nCMD ["/bin/sh", "-c", "nginx -g \\"daemon off;\\"" ]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nå¨ç¬¬ä¸ä¸ªFROMæä»¤åä½¿ç¨as build-env æææ¯ä¸ºè¯¥é¶æ®µåä¸ä¸ªæ è®°åä¸ºbuild-envï¼ç¶åå¨ç¬¬äºä¸ªFROMä¹åä½¿ç¨äºCOPY --from=build-envï¼æææ¯ä»ä¸ä¸ä¸ªåä¸ºbuilderçé¶æ®µä¸­æ·è´æä»¶è³æ¬é¶æ®µä¸­ã\n\n\n# å­ãDockerfile ä¼ å\n\nä½¿ç¨ ARG å build-arg ä¼ å¥å¨æåéï¼\n\n# base image \nFROM centos:7 \n# MAINTAINER dot # deprecated \n\nLABEL maintainer="dot" version="demo" \nLABEL multiple="true" \n\nARG USERNAME \nARG DIR="defaultValue" \n\nRUN useradd -m $USERNAME -u 1001 && mkdir $DIR \n\n# docker build --build-arg USERNAME="test_arg" -t test:arg . \n# docker run -ti --rm test:arg bash \n# ls \nbin             dev  home  lib64       media  opt   root  selinux  sys  usr \ndefaultValue  etc  lib   lost+found  mnt    proc  sbin  srv      tmp  var\n# tail -1 /etc/passwd \ntest_arg:x:1001:1001::/home/test_arg:/bin/bash\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# ä¸ãDockerfile ä¼å\n\n\n# 1ãå°½éä¸ä½¿ç¨rootç¨æ·\n\nå¨ååºç¡è¿è¡æ¶éåæ¶ï¼åå»ºè¿è¡æ¶æ®éç¨æ·åç¨æ·ç»ï¼å¹¶åå·¥ä½åºä¸æééå¶ï¼å¯å¨æå¡æ¶å°½éä½¿ç¨æ®éç¨æ·ã\n\ngosu\n\nFROM alpine:3.11.5\nRUN sed -i "s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g" /etc/apk/repositories \\\n    && apk add --no-cache gosu\n\n\n1\n2\n3\n\n\n\n# 2ãç§»é¤ææç¼å­ç­ä¸å¿è¦ä¿¡æ¯\n\n * å é¤è§£ååçæºåç¼©åï¼åèç¬¬äºç« ç¬¬äºèï¼\n * æ¸çåç®¡çå¨ä¸è½½å®è£è½¯ä»¶æ¶çç¼å­\n   * ä½¿ç¨Alipineéåä¸­APKå½ä»¤å®è£åæ¶è®°å¾å ä¸--no-cache\n   * ä½¿ç¨Ubuntuéåä¸­çAPTå½ä»¤å®è£è½¯ä»¶åè®°å¾ rm -rf /var/lib/apt/lists/*\n\n\n# 3ãä½¿ç¨åççENTRYPOINTèæ¬\n\nç¤ºä¾ï¼\n\n#!/bin/bash\nset -e\n\nif [ "$1" = \'postgres\' ]; then\n    chown -R postgres "$PGDATA"\n\n    if [ -z "$(ls -A "$PGDATA")" ]; then\n        gosu postgres initdb\n    fi\n\n    exec gosu postgres "$@"\nfi\n\nexec "$@"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# 4ãè®¾ç½®æ¶åº\n\nç±äºç»å¤§å¤æ°åºç¡éåé½æ¯é»è®¤éç¨ UTC çæ¶åºï¼ä¸åäº¬æ¶é´ç¸å·® 8 ä¸ªå°æ¶ï¼è¿å°ä¼å¯¼è´å®¹å¨åçæ¶é´ä¸åäº¬æ¶é´ä¸ä¸è´ï¼å èä¼å¯¹ä¸äºåºç¨é æä¸äºå½±åï¼è¿ä¼å½±åå®¹å¨åæ¥å¿åçæ§çæ°æ®ã\n\nå æ­¤å¯¹äºä¸å«åºçç¨æ·ï¼æå¥½å¨æå»ºéåçæ¶åè®¾å®ä¸ä¸å®¹å¨åçæ¶åºï¼ä»¥åä»¥åå ä¸ºæ¶åºéå°ä¸äº bugã\n\nå¯ä»¥éè¿ç¯å¢åéè®¾ç½®å®¹å¨åçæ¶åºãå¨å¯å¨çæ¶åå¯ä»¥éè¿è®¾ç½®ç¯å¢åé -e TZ=Asia/Shanghai æ¥è®¾å®å®¹å¨åçæ¶åºã\n\n# 1ãåºäº Alpine éå\n\nFROM alpine:3.15\nENV TZ=Asia/Shanghai\nRUN sed -i \'s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g\' /etc/apk/repositories \\\n    && apk add --no-cache tzdata \\\n    && ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime  \\\n    && echo "Asia/Shanghai" > /etc/timezone\n\n\n1\n2\n3\n4\n5\n6\n\n\n# 2ãåºäº Centos7 éå\n\nFROM centos:7\n#å®ä¹æ¶åºåæ°\nENV TZ=Asia/Shanghai\n#è®¾ç½®æ¶åº\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo \'$TZ\' > /etc/timezone\n\n\n1\n2\n3\n4\n5\n\n\n# 3ãåºäº Debian éå\n\n# ç±äº Debian éåä¸­å·²ç»åå«äºtzdataï¼æä»¥åªéæ·»å ç¯å¢åéTZå³å¯ã\nFROM debian:latest\n\nENV TZ=Asia/Shanghai\n\n\n1\n2\n3\n4\n\n\n# 4ãåºäº Ubuntu éå\n\nFROM ubuntu:bionic\n\nENV TZ=Asia/Shanghai\nRUN echo "${TZ}" > /etc/timezone\n    && ln -sf /usr/share/zoneinfo/${TZ} /etc/localtime\n    && apt update\n    && apt install -y tzdata\n    && rm -rf /var/lib/apt/lists/*\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 5ãè®¾ç½®ç³»ç»è¯­è¨\n\n# 1ãåºäº Alpine éå\n\nFROM alpine:3.15\nENV LANG=en_US.UTF-8 \\\n    LANGUAGE=en_US.UTF-8\n\nRUN apk --no-cache add ca-certificates wget \\ \n    && wget -q -O /etc/apk/keys/sgerrand.rsa.pub https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub \\ \n    && wget -q https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.33-r0/glibc-2.33-r0.apk \\ \n    && wget -q https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.33-r0/glibc-bin-2.33-r0.apk \\\n    && wget -q https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.33-r0/glibc-i18n-2.33-r0.apk \\\n    && apk add glibc-bin-2.33-r0.apk glibc-i18n-2.33-r0.apk glibc-2.33-r0.apk \\\n    && rm -rf /usr/lib/jvm glibc-2.29-r0.apk glibc-bin-2.29-r0.apk  glibc-i18n-2.29-r0.apk \\\n    && /usr/glibc-compat/bin/localedef --force --inputfile POSIX --charmap UTF-8 "$LANG" || true \\\n    && echo "export LANG=$LANG" > /etc/profile.d/locale.sh \\\n    && apk del glibc-i18n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# 2ãåºäº Centos7 éå\n\nFROM centos:7\n#å®è£å¿è¦åºç¨\nRUN yum -y install kde-l10n-Chinese glibc-common\n#è®¾ç½®ç¼ç \nRUN localedef -c -f UTF-8 -i zh_CN zh_CN.utf8\n#è®¾ç½®ç¯å¢åé\nENV LC_ALL zh_CN.utf8\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# 3ãåºäº Debian éå\n\n# ç±äº Debian éåä¸­å·²ç»åå«äºtzdataï¼æä»¥åªéæ·»å ç¯å¢åéTZå³å¯ã\nFROM debian:latest\n\nENV LANG C.UTF-8\nRUN apt-get update; \\\n    apt-get install -y --no-install-recommends fontconfig;\n\n\n1\n2\n3\n4\n5\n6\n\n\n# 4ãåºäº Ubuntu éå\n\nFROM ubuntu:bionic\n\nENV LANG C.UTF-8\n\n\n1\n2\n3\n\n\n\n# 6ãä½¿ç¨Labelæ æ³¨ä½èãè½¯ä»¶çæ¬ç­åä¿¡æ¯\n\nFROM alpine:3.11.5\nLABEL Author=Curiouser \\\n      Mail=****@163.com \\\n      PHP=7.3 \\\n      Tools=âgitãvimãcurlâ \\\n      Update="æ·»å ç¨æ·ç»"\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 7ãæå®å·¥ä½åº\n\nWORKDIR /var/wwww\n\n\n1\n\n\n\n# 8ãRUNæä»¤æ¾ç¤ºä¼å\n\nRUN set -eux ; \\\n    ls -al\n\n\n1\n2\n\n\n\n# 9ãä½¿ç¨ URL æ·»å æºç \n\nå¦æä¸éç¨åé¶æ®µæå»ºï¼å¯¹äºä¸äºéè¦å¨å®¹å¨åè¿è¡ç¼è¯çé¡¹ç®ï¼æå¥½éè¿ git æè wegt çæ¹å¼å°æºç æå¥å°éååï¼èééç¨ ADD æè COPY ï¼å ä¸ºæºç ç¼è¯å®æä¹åï¼æºç å°±ä¸éè¦å¯ä»¥å æäºï¼èéè¿ ADD æè COPY æ·»å è¿å»çæºç å·²ç»ç¨å¨ä¸ä¸å±éåä¸­äºï¼æ¯å ä¸ææ»´å¦ã\n\nä¹å°±æ¯è¯´ git & wget source ç¶å buildï¼æå rm -rf source/ è¿ä¸é¨æ¾å¨ä¸æ¡ RUN æä»¤ä¸­ï¼è¿æ ·å°±è½é¿åæºç æ·»å å°éåä¸­èå¢å¤§éåä½ç§¯å¦ã\n\n\n# 10ãä½¿ç¨èæç¼è¯ç¯å¢\n\nå¯¹äºåªå¨ç¼è¯è¿ç¨ä¸­ä½¿ç¨å°çä¾èµï¼æä»¬å¯ä»¥å°è¿äºä¾èµå®è£å¨èæç¯å¢ä¸­ï¼ç¼è¯å®æä¹åå¯ä»¥ä¸å¹¶å é¤è¿äºä¾èµï¼æ¯å¦ alpine ä¸­å¯ä»¥ä½¿ç¨ apk add --no-cache --virtual .build-depsï¼åé¢å ä¸éè¦å®è£çç¸å³ä¾èµã\n\napk add --no-cache --virtual .build-deps gcc libc-dev make perl-dev openssl-dev pcre-dev zlib-dev git\n\n\n1\n\n\næå»ºå®æä¹åå¯ä»¥ä½¿ç¨ apk del .build-deps å½ä»¤ï¼ä¸å¹¶å°è¿äºç¼è¯ä¾èµå¨é¨å é¤ã\n\néè¦æ³¨æçæ¯ï¼.build-deps åé¢æ¥çæ¯ç¼è¯æ¶ä»¥æ¥çè½¯ä»¶åï¼å¹¶ä¸æ¯ææçç¼è¯ä¾èµé½å¯ä»¥å é¤ï¼ä¸è¦æè¿è¡æ¶çä¾èµåæ¥å¨åé¢ï¼æå¥½åç¬ add ä¸ä¸ã\n\n\n# 11ãæå°åå±æ°\n\ndocker å¨ 1.10 ä»¥åï¼åªæ RUNãCOPY å ADD æä»¤ä¼åå»ºå±ï¼å¶ä»æä»¤ä¼åå»ºä¸´æ¶çä¸­é´éåï¼ä½æ¯ä¸ä¼ç´æ¥å¢å æå»ºçéåå¤§å°äºã\n\nåææå°äºå»ºè®®ä½¿ç¨ git æè wget çæ¹å¼æ¥å°æä»¶æå¥å°éåå½ä¸­ï¼ä½å¦ææä»¬å¿é¡»è¦ä½¿ç¨ COPY æè ADD æä»¤å¢ï¼\n\nè¿æ¯æ¿ FastDFS ä¸ºä¾ï¼\n\n# centos 7\nFROM centos:7\n# æ·»å éç½®æä»¶\n# add profiles\nADD conf/client.conf /etc/fdfs/\nADD conf/http.conf /etc/fdfs/\nADD conf/mime.types /etc/fdfs/\nADD conf/storage.conf /etc/fdfs/\nADD conf/tracker.conf /etc/fdfs/\nADD fastdfs.sh /home\nADD conf/nginx.conf /etc/fdfs/\nADD conf/mod_fastdfs.conf /etc/fdfs\n\n# æ·»å æºæä»¶\n# add source code\nADD source/libfastcommon.tar.gz /usr/local/src/\nADD source/fastdfs.tar.gz /usr/local/src/\nADD source/fastdfs-nginx-module.tar.gz /usr/local/src/\nADD source/nginx-1.15.4.tar.gz /usr/local/src/\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nå¤ä¸ªæä»¶éè¦æ·»å å°å®¹å¨ä¸­ä¸åçè·¯å¾ï¼æ¯ä¸ªæä»¶ä½¿ç¨ä¸æ¡ ADD æä»¤çè¯å°±ä¼å¢å ä¸å±éåï¼è¿æ ·ææ²å°±å¤äº 12 å±éå ã\n\nå¶å®å¤§å¯ä¸å¿ï¼æä»¬å¯ä»¥å°è¿äºæä»¶å¨é¨æåä¸ºä¸ä¸ªæä»¶ä¸º src.tar.gz ç¶åéè¿ ADD çæ¹å¼ææä»¶æ·»å å°å½ä¸­å»ï¼ç¶åå¨ RUN æä»¤åä½¿ç¨ mv å½ä»¤ææä»¶ç§»å¨å°æå®çä½ç½®ãè¿æ ·ä»ä»ä¸æ¡ ADD å RUN æä»¤åä»£æäº 12 ä¸ª ADD æä»¤ã\n\nFROM alpine:3.10\nCOPY src.tar.gz /usr/local/src.tar.gz\nRUN set -xe \\\n    && apk add --no-cache --virtual .build-deps gcc libc-dev make perl-dev openssl-dev pcre-dev zlib-dev tzdata \\\n    && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n    && tar -xvf /usr/local/src.tar.gz -C /usr/local \\\n    && mv /usr/local/src/conf/fastdfs.sh /home/fastdfs/ \\\n    && mv /usr/local/src/conf/* /etc/fdfs \\\n    && chmod +x /home/fastdfs/fastdfs.sh \\\n    && rm -rf /usr/local/src/* /var/cache/apk/* /tmp/* /var/tmp/* $HOME/.cache\nVOLUME /var/fdfs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå¶ä»æå°åå±æ°æ éå°±æ¯ææå»ºé¡¹ç®çæ´ä¸ªæ­¥éª¤å¼æä¸æ¡ RUN æä»¤ï¼ä¸è¿å¤æ¡å½ä»¤åå¹¶å¯ä»¥ä½¿ç¨ && æè ; è¿ä¸¤èé½å¯ä»¥ï¼ä¸è¿æ®æå¨ docker hub ä¸çæè§æé»ï¼ä½¿ç¨ ; çå±å¤ï¼å°¤å¶æ¯å®æ¹ç Dockerfileã',normalizedContent:'# ä¸ãdockerfile ç®ä»\n\nä»ä¹æ¯ dockerfileï¼\n\ndockerfile æ¯ä¸ä¸ªç¨æ¥æå»ºéåçææ¬æä»¶ï¼ææ¬åå®¹åå«äºæå»ºéåæéçæä»¤åè¯´æã\n\nå¨æå»ºæ¶ docker engine ä¼å¨å½åç®å½ä¸­æ¥æ¾åä¸º âdockerfileâ çæä»¶ï¼æ³¨æè¿ä¸ªæä»¶åå¿é¡»ä¸º âdockerfileâ é¦å­æ¯å¤§åãå½æ¨è¿è¡ docker build å½ä»¤çæ¶åï¼dockerfile æä»¶ä»¥åä¸ dockerfile æä»¶å¤äºåçº§è·¯å¾ä¸çæææä»¶é½å°ä¸å¹¶æäº¤è³ docker engine æ¥å¤çï¼docker engine å°éè¡è§£æ dockerfile æä»¶ï¼å¹¶æ§è¡ç¸å³æä½ãdockerfile çè§£ææ¯ç±ä¸èä¸çé¡ºåºè¿è¡ã\n\næ³¨ææ¨æ¾ç½® dockerfile çç®å½æå¥½æ¯ä¸ä¸ªç©ºç®å½ï¼æèåªæ¾ç½®ä¸æ¬æ¬¡æå»ºç¸å³çæä»¶å³å¯ï¼å ä¸ºå¨æ§è¡ build æ¶ä¼å° dockerfile ä»¥å dockerfile è·¯å¾ä¸çæææä»¶æäº¤è³ docker engine å¤çï¼å æ­¤æ¨ä¸åºè¯¥å¨ dockerfile ç®å½ä¸­æ¾ç½®ä¸äºæ å³çæä»¶ï¼è¿æ¯æ æä¹çå¹¶ä¸è¿å°ä¼ä¸¥éææ¢æ´ä¸ªæå»ºè¿ç¨ã\n\n\n# äºãdockerfile æä»¤\n\n\n# 1ãå¸¸ç¨æä»¤\n\ndocker éåå¯ä»¥éè¿ docker hub æèé¿éäºç­ä»åºä¸­è·åï¼è¿äºéåæ¯ç±å®æ¹æèç¤¾åºäººåæä¾çï¼å¯¹äº docker ç¨æ·æ¥è¯´å¹¶ä¸è½æ»¡è¶³æä»¬çéæ±ï¼ä½æ¯ä»æ å¼å§æå»ºéåææ¬å¤§ãå¸¸ç¨çæ°æ®åºãä¸­é´ä»¶ãåºç¨è½¯ä»¶ç­é½æç°æç docker å®æ¹éåæç¤¾åºåå»ºçéåï¼æä»¬åªéè¦ç¨ä½éç½®å°±å¯ä»¥ç´æ¥ä½¿ç¨ã\n\nä½¿ç¨ç°æéåçå¥½å¤é¤äºçå»èªå·±åéåçå·¥ä½éå¤ï¼æ´éè¦çæ¯å¯ä»¥å©ç¨åäººçç»éªãç¹å«æ¯ä½¿ç¨é£äºå®æ¹éåï¼å ä¸º docker çå·¥ç¨å¸ç¥éå¦ä½æ´å¥½çå¨å®¹å¨ä¸­è¿è¡è½¯ä»¶ã\n\nå½ç¶ï¼æäºæåµä¸æä»¬ä¹ä¸å¾ä¸èªå·±æå»ºéåï¼æ¯å¦æ¾ä¸å°ç°æçéåï¼æ¯å¦èªå·±å¼åçåºç¨ç¨åºï¼éè¦å¨éåä¸­å å¥ç¹å®çåè½ã\n\nå¨ç¼å dockerfile æ¶ï¼æ¨éè¦ç¨å° dockerfile æä»¤æ¥å®ä¹æå»ºè¿ç¨ä¸­æè¦æ§è¡çæä½ï¼è¿éåä¸¾å ä¸ªå¸¸ç¨çæä»¤ï¼\n\nå¸¸ç¨æä»¤          è¯´æ\nfrom          from æä»¤æ¯å®ä¹æ¬é¶æ®µæå»ºæè¦ä½¿ç¨çåºç¡éåã\nmaintainer    éåç»´æ¤èå§åæé®ç®±å°å\nrun           æå»ºéåæ¶è¿è¡ç shell å½ä»¤\ncmd           è¿è¡å®¹å¨æ¶æ§è¡ç shell å½ä»¤\nexpose        ä»ä»åªæ¯å£°æç«¯å£ï¼å£°æå®¹å¨ååºç¨æä½¿ç¨çç«¯å£å·\nenv           è®¾ç½®å®¹å¨ç¯å¢åéï¼å½ç¶å¨æ¨ä½¿ç¨è¯¥éåè¿è¡å®¹å¨æ¶ï¼env æå®ä¹çåéä»ç¶å¯¹å®¹å¨ææ\nadd           æ·è´æä»¶æç®å½å°éåï¼å¦ææ¯ url æåç¼©åä¼èªå¨ä¸è½½æèªå¨è§£å\ncopy          æ·è´æä»¶æç®å½å°éåå®¹å¨åï¼è· add ç±»ä¼¼ï¼ä½ä¸å·å¤èªå¨ä¸è½½æè§£ååè½\nentrypoint    è¿è¡å®¹å¨æ¶æ§è¡ç shell å½ä»¤\nvolume        æå®å®¹å¨æè½½ç¹å°å®¿ä¸»æºèªå¨çæçç®å½æå¶ä»å®¹å¨\nuser          ä¸º runãcmdãå entrypoint æ§è¡å½ä»¤æå®è¿è¡ç¨æ·\nworkdir       ä¸º runãcmdãentrypointãcopy å add è®¾ç½®å·¥ä½ç®å½ï¼ææä¸ºåæ¢ç®å½\nhealthcheck   å¥åº·æ£æ¥\narg           æå»ºæ¶æå®çä¸äºåæ°\n\nrunãcmd ä¸ entrypoint çåºå«\n\n * runï¼æ§è¡å½ä»¤å¹¶åå»ºæ°çéåå±ï¼å¸¸ç¨äºå®è£è½¯ä»¶åï¼å¨ docker build è¿ç¨ä¸­æ§è¡ï¼\n * cmdï¼è®¾ç½®å®¹å¨å¯å¨åé»è®¤æ§è¡çå½ä»¤åå¶åæ°ï¼å¨ docker run æ¶è¿è¡ï¼ä½ docker run åè·åæ°æ¶ä¼æ¿æ¢ï¼å¿½ç¥ï¼ cmdï¼cmd å¯ä»¥è¢«è¦çï¼å¦ææ entrypioint çè¯ï¼cmd å°±æ¯ entrypioint çåæ°ãï¼\n * entrypointï¼éç½®å®¹å¨å¯å¨æ¶è¿è¡çå½ä»¤ï¼ä¸ç®¡ docker run â¦ åæ¯å¦è¿è¡æå¶ä»å½ä»¤ï¼entrypoint æä»¤åçå½ä»¤ä¸å®ä¼è¢«æ§è¡ï¼ åé¢å¦æåæ¥å½ä»¤ï¼ä¼æ¥éå¤ä½çåæ°ã\n * cmd å entrypioint å¿é¡»è¦æä¸ä¸ª\n\n\n# 2ãæä»¤è¯¦è§£\n\n# 1ãfrom\n\nfrom æä»¤æ¯å®ä¹æ¬é¶æ®µæå»ºæè¦ä½¿ç¨çåºç¡éåãä¾å¦æ¨éè¦å°æ¨ç java å¼åçé¡¹ç®æå»ºä¸ºä¸ä¸ªéåï¼é£ä¹æ¨å¯è½éè¦ tomcat éåï¼èå¶ä½ tomcat éåå°±å¯è½éè¦ jdk éåï¼é£ä¹ jdk éåå°±éè¦ä¸ä¸ªåºæ¬çæä½ç³»ç»éåï¼è¿å¯è½æ¯ utuntuãdebianãalpine ç­ã\n\næ ¹æ®ä»¥ä¸ï¼æä»¬åºè¯¥å¯ä»¥ç¥éç±äºå®¹å¨éåæ¯å¯ä»¥å¢éå å çï¼é£ä¹ tomcat éåä¸­å°±åºè¯¥åå«äº jdk ä»¥åä¸ä¸ªåºæ¬çæä½ç³»ç»ã\n\næ¨å¯ä»¥ä» hub.docker.com ç½ç«ä¸æ¥æéä¸ä¸ªåéçéåæ¥ä½ä¸ºæ¨çåºç¡éåã\n\n# 2ãcopy\n\nå¤å¶æä»¤ï¼ä»ä¸ä¸æç®å½ä¸­å¤å¶æä»¶æèç®å½å°å®¹å¨éæå®è·¯å¾\n\nï¼ä¸ä¸æç®å½æ¯ææ¾ç½® dockerfile æä»¶çç®å½ï¼\n\næ ¼å¼å¦ä¸ï¼\n\ncopy [--chown=<user>:<group>] <æºè·¯å¾1>... <ç®æ è·¯å¾>\ncopy [--chown=<user>:<group>] ["<æºè·¯å¾1>",... "<ç®æ è·¯å¾>"]\n\n\n1\n2\n\n\næ³¨æÂ [--chown=<user>:<group>]ï¼Â å¯éåæ°ï¼ç¨æ·æ¹åå¤å¶å°å®¹å¨åæä»¶çæ¥æèåå±ç»ã\n\n<æºè·¯å¾>ï¼æºæä»¶æèæºç®å½ï¼è¿éå¯ä»¥æ¯ééç¬¦è¡¨è¾¾å¼ï¼å¶ééç¬¦è§åè¦æ»¡è¶³ go ç filepath.match è§åãä¾å¦ï¼\n\ncopy hom* /mydir/\n\ncopy hom?.txt /mydir/\n\n<ç®æ è·¯å¾>ï¼å®¹å¨åçæå®è·¯å¾ï¼è¯¥è·¯å¾ä¸ç¨äºåå»ºå¥½ï¼è·¯å¾ä¸å­å¨çè¯ï¼ä¼èªå¨åå»ºã\n\n# 3ãadd\n\nadd æä»¤å copy çä½¿ç¨æ ¼å¼ä¸è´ï¼åæ ·éæ±ä¸ï¼å®æ¹æ¨èä½¿ç¨ copyï¼ãåè½ä¹ç±»ä¼¼ï¼ä¸åä¹å¤å¦ä¸ï¼\n\nadd çä¼ç¹ï¼å¨æ§è¡ <æºæä»¶> ä¸º tar åç¼©æä»¶çè¯ï¼åç¼©æ ¼å¼ä¸º gzip, bzip2 ä»¥å xz çæåµä¸ï¼ä¼èªå¨å¤å¶å¹¶è§£åå° < ç®æ è·¯å¾ >ã\n\nadd çç¼ºç¹ï¼å¨ä¸è§£åçåæä¸ï¼æ æ³å¤å¶ tar åç¼©æä»¶ãä¼ä»¤éåæå»ºç¼å­å¤±æï¼ä»èå¯è½ä¼ä»¤éåæå»ºåå¾æ¯è¾ç¼æ¢ãå·ä½æ¯å¦ä½¿ç¨ï¼å¯ä»¥æ ¹æ®æ¯å¦éè¦èªå¨è§£åæ¥å³å®ã\n\nå¯¹äºä½¿ç¨ add æä»¤ä¸è½½è¿ç¨æå¡å¨ä¸ç tar åå¹¶è§£åï¼å»ºè®®ä½¿ç¨ä»¥ä¸æ¹å¼ä»£æ¿\n\nrun curl -s http://192.168.1.7/repository/tools/jdk-8u241-linux-x64.tar.gz | tar -xc /opt/\n\n\n1\n\n\n# 4ãrun\n\nå½æä»¬å¨æå»ºéåè¿ç¨ä¸­ï¼éè¦æ§è¡ä¸äºéç½®ï¼ä¾å¦ä½¿ç¨ mkdir å½ä»¤æ°å»ºä¸ä¸ªç®å½ï¼ç¨ sed å½ä»¤æ¥æ¿æ¢ä¸äºææ¬åå®¹ç­ï¼å½ç¶å¯è½å¨å®éè¿ç¨ä¸­éè¦æ´å¤æçå½ä»¤ï¼é£ä¹æ­¤æ¶æ¨å¯ä»¥ä½¿ç¨ run æä»¤æ¥å®ä¹å°è¦è¿è¡çå½ä»¤ã\n\nrun æä»¤å¨ dockerfile ä¸­å¯ä»¥åºç°å¤æ¬¡ï¼docker engine å¨æå»ºè¿ç¨ä¸­ä¼è¯»å dockerfile ç¶åç±ä¸èä¸ä¾æ¬¡æ§è¡ run æä»¤ææ è®°çå½ä»¤ã\n\nrun åé¢è·ççå½ä»¤è¡å½ä»¤ãæä»¥ä¸ä¿©ç§æ ¼å¼ï¼\n\nshell æ ¼å¼\n\nrun <å½ä»¤è¡å½ä»¤>\n# <å½ä»¤è¡å½ä»¤> ç­åäºï¼å¨ç»ç«¯æä½ç shell å½ä»¤ã\n\n\n1\n2\n\n\nexec æ ¼å¼ï¼\n\nrun ["å¯æ§è¡æä»¶", "åæ°1", "åæ°2"]\n# ä¾å¦ï¼\n# run ["./test.php", "dev", "offline"] ç­ä»·äº run ./test.php dev offline\n\n\n1\n2\n3\n\n\næ³¨æå¨æå»ºè¿ç¨ä¸­ docker engine ä¼ä¸º dockerfile ä¸­çæ¯ä¸ª run æä»¤åå»ºä¸ä¸ªéåå±ï¼layerï¼æ¥è®°å½è¿ç§æ¹åãå æ­¤ä¸ºäºåå°ä¸å¿è¦çéåå±æ°ï¼éå¸¸çåæ³æ¯å°å¤ä¸ªå½ä»¤å®ä¹å¨ä¸ä¸ª run æä»¤ä¸­ï¼å¦ä¸æç¤ºï¼\n\nrun mkdir demo \\\n    && cd demo \\\n    && wget https://www.demo.com/download/demo.tar.gz \\\n    && tar -xf demo.tar.gz \\\n    && rm -rf demo.tar.gz\n\n\n1\n2\n3\n4\n5\n\n\nå¦ä¸ï¼ä»¥ && ç¬¦å·è¿æ¥å½ä»¤ï¼è¿æ ·æ§è¡åï¼åªä¼åå»º 1 å±éå\n\n# 5ãcmd\n\nç±»ä¼¼äº run æä»¤ï¼ç¨äºè¿è¡ç¨åºï¼ä½äºèè¿è¡çæ¶é´ç¹ä¸å:\n\ncmd å¨ docker run æ¶è¿è¡ã\n\nrun æ¯å¨ docker build è¿ç¨ä¸­æ§è¡ã\n\nä½ç¨ï¼ä¸ºå¯å¨çå®¹å¨æå®é»è®¤è¦è¿è¡çç¨åºï¼ç¨åºè¿è¡ç»æï¼å®¹å¨ä¹å°±ç»æãcmd æä»¤æå®çç¨åºå¯è¢« docker run å½ä»¤è¡åæ°ä¸­æå®è¦è¿è¡çç¨åºæè¦çã\n\n> æ³¨æ\n> \n> å¦æ dockerfile ä¸­å¦æå­å¨å¤ä¸ª cmd æä»¤ï¼ä»æåä¸ä¸ªçæã\n\næ ¼å¼ï¼\n\ncmd <shell å½ä»¤> \ncmd ["<å¯æ§è¡æä»¶æå½ä»¤>","<param1>","<param2>",...] \ncmd ["<param1>","<param2>",...]  # è¯¥åæ³æ¯ä¸º entrypoint æä»¤æå®çç¨åºæä¾é»è®¤åæ°\n\n\n1\n2\n3\n\n\næ¨èä½¿ç¨ç¬¬äºç§æ ¼å¼ï¼æ§è¡è¿ç¨æ¯è¾æç¡®ãç¬¬ä¸ç§æ ¼å¼å®éä¸å¨è¿è¡çè¿ç¨ä¸­ä¹ä¼èªå¨è½¬æ¢æç¬¬äºç§æ ¼å¼è¿è¡ï¼å¹¶ä¸é»è®¤å¯æ§è¡æä»¶æ¯ shã\n\nä¾å¦æ¨æä¸ä¸ª nodejs ç¨åºï¼å¯å¨è¯¥ç¨åºçå½ä»¤æ¯ node server.jsï¼ç¶åæ¨å¸æå¨ä½¿ç¨è¯¥éåè¿è¡å®¹å¨æ¶ä¹ä»¥è¿ç§æ¹å¼è¿è¡ï¼é£ä¹æ¨å¯ä»¥å¨ dockerfile ä¸­ä½¿ç¨ cmd æ¥æ è®°ï¼å¦ä¸ï¼\n\ncmd ["node","server.js"]\n\n\n1\n\n\néå¸¸ cmd æä»¤åºç°å¨ dockerfile æ«å°¾å¤ãå½æ¨å°ä»¥ä¸å®ä¹åå¥ dockerfile ä¸­å¹¶æåæéåï¼demo:v1ï¼ï¼ç¶åæ¨ä½¿ç¨è¯¥éåè¿è¡æ¶ï¼é£ä¹è¯¥å®¹å¨å°ä½¿ç¨ dockerfile ä¸­ cmd å®ä¹çå½ä»¤æ¥è¿è¡\n\ndocker  run  -d  --name=demo  deom:v1\n\n\n1\n\n\nå½ç¶æ¨å¯ä»¥å¨è¿è¡æ¶è¦ç cmd æä»¤ä¸­çå½ä»¤ï¼ä¾å¦è¿éæ¹æ npm startï¼å½ä»¤å¦ä¸\n\ndocker  run  -d  --name=demo  deom:v1  npm  start\n\n\n1\n\n\n# 6ãentrypoint\n\nç±»ä¼¼äº cmd æä»¤ï¼ä½å¶ä¸ä¼è¢« docker run çå½ä»¤è¡åæ°æå®çæä»¤æè¦çï¼èä¸è¿äºå½ä»¤è¡åæ°ä¼è¢«å½ä½åæ°éç» entrypoint æä»¤æå®çç¨åºã\n\nä½æ¯ï¼å¦æè¿è¡ docker run æ¶ä½¿ç¨äº --entrypoint éé¡¹ï¼å°è¦ç cmd æä»¤æå®çç¨åºã\n\nä¼ç¹ï¼å¨æ§è¡ docker run çæ¶åå¯ä»¥æå® entrypoint è¿è¡æéçåæ°ã\n\næ³¨æï¼å¦æ dockerfile ä¸­å¦æå­å¨å¤ä¸ª entrypoint æä»¤ï¼ä»æåä¸ä¸ªçæã\n\næ ¼å¼ï¼\n\nentrypoint ["<executeable>","<param1>","<param2>",...]\n\n\n1\n\n\nå¯ä»¥æ­é cmd å½ä»¤ä½¿ç¨ï¼ä¸è¬æ¯ååæä¼ä½¿ç¨ cmd ï¼è¿éç cmd ç­äºæ¯å¨ç» entrypoint ä¼ åï¼ä»¥ä¸ç¤ºä¾ä¼æå°ã\n\nç¤ºä¾ï¼\n\nåè®¾å·²éè¿ dockerfile æå»ºäº nginx:test éå\n\nfrom nginx\nentrypoint ["nginx", "-c"] # å®å\ncmd ["/etc/nginx/nginx.conf"] # åå\n\n\n1\n2\n3\n\n\nä¸ä¼ åè¿è¡\n\ndocker run nginx:test\n\n\n1\n\n\nå®¹å¨åä¼é»è®¤è¿è¡ä»¥ä¸å½ä»¤ï¼å¯å¨ä¸»è¿ç¨ã\n\nnginx -c /etc/nginx/nginx.conf\n\n\n1\n\n\nä¼ åè¿è¡\n\ndocker run nginx:test -c /etc/nginx/new.conf\n\n\n1\n\n\nå®¹å¨åä¼é»è®¤è¿è¡ä»¥ä¸å½ä»¤ï¼å¯å¨ä¸»è¿ç¨ (/etc/nginx/new.conf: åè®¾å®¹å¨åå·²ææ­¤æä»¶)\n\nnginx -c /etc/nginx/new.conf\n\n\n1\n\n\néå¸¸æ´å¥½çåæ³æ¯ä½¿ç¨ entrypoint æ¥å®ä¹ä¸ä¸ª docker-entrypoint.sh èæ¬ï¼ç¶åå¨è¯¥èæ¬ä¸­å®ä¹ä¸äºé¢å¤çåæ¡ä»¶å¤æ­ï¼æ¥åºå¯¹æ´å¤æªç¥æåµãä¾å¦ cups éåç dockerfile\n\narg arch=amd64\nfrom $arch/debian:buster-slim\n# environment\nenv admin_password=admin\n# â¦â¦åå®¹å¤ªå¤ï¼ä¸­é´åå®¹å·²çç¥\nentrypoint [ "docker-entrypoint.sh" ]\n# default command\ncmd ["cupsd", "-f"]\n# volumes\nvolume ["/etc/cups"]\n# ports\nexpose 631\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\nè¯¥éåç docker-entrypoint.sh æä»¶åå®¹å¦ä¸ï¼\n\n#!/bin/bash -e\necho -e "${admin_password}\\n${admin_password}" | passwd admin\nif [ ! -f /etc/cups/cupsd.conf ]; then\n  cp -rpn /etc/cups-skel/* /etc/cups/\nfi\nexec "$@"\n\n\n1\n2\n3\n4\n5\n6\n\n\n# 7ãenv\n\nè®¾ç½®ç¯å¢åéï¼å®ä¹äºç¯å¢åéï¼é£ä¹å¨åç»­çæä»¤ä¸­ï¼å°±å¯ä»¥ä½¿ç¨è¿ä¸ªç¯å¢åéãå½ç¶å¨æ¨ä½¿ç¨è¯¥éåè¿è¡å®¹å¨æ¶ï¼env æå®ä¹çåéä»ç¶å¯¹å®¹å¨ææï¼ä¾å¦ mysql éåç dockerfile ä¸­å°±åå« root ç¨æ·çåå§å¯ç ï¼ä½¿ç¨ env æ¥æå®ã\n\næ ¼å¼ï¼\n\nenv <key> <value>\nenv <key1>=<value1> <key2>=<value2>...\n\n\n1\n2\n\n\nä»¥ä¸ç¤ºä¾è®¾ç½® node_version = 16.19.0 ï¼ å¨åç»­çæä»¤ä¸­å¯ä»¥éè¿ $node_version å¼ç¨ï¼\n\nenv node_version 16.19.0\nrun curl -slo "https://nodejs.org/download/release/latest-v16.x/node-v$node_version-linux-x64.tar.gz" \n\n\n1\n2\n\n\ndockerfile ä¸­ env æä»¤å run æä»¤ä¸æ ·ï¼æ¯ä¸ä¸ªé½ä¼åå»ºä¸ä¸ªä¸´æ¶å±ã\n\nenv java_home=/opt/jdk1.8.0_241 \\\n    classpath=.:$java_home/lib:$java_home/jre/lib \nenv path=$path:$java_home/bin\n\n\n1\n2\n3\n\n\n# 8ãarg\n\næå»ºåæ°ï¼ä¸ env ä½ç¨ä¸è³ãä¸è¿ä½ç¨åä¸ä¸æ ·ãarg è®¾ç½®çç¯å¢åéä»å¯¹ dockerfile åææï¼ä¹å°±æ¯è¯´åªæ docker build çè¿ç¨ä¸­ææï¼æå»ºå¥½çéååä¸å­å¨æ­¤ç¯å¢åéã\n\næå»ºå½ä»¤ docker build ä¸­å¯ä»¥ç¨ --build-arg <åæ°å>=< å¼ > æ¥è¦çã\n\næ ¼å¼\n\narg <åæ°å>[=<é»è®¤å¼>]\n\n\n1\n\n\n# 9ãvolume\n\nå®ä¹å¿åæ°æ®å·ãå¨å¯å¨å®¹å¨æ¶å¿è®°æè½½æ°æ®å·ï¼ä¼èªå¨æè½½å°å¿åå·ã\n\nä½ç¨ï¼\n\né¿åéè¦çæ°æ®ï¼å å®¹å¨éå¯èä¸¢å¤±ï¼è¿æ¯éå¸¸è´å½çã\n\né¿åå®¹å¨ä¸æ­åå¤§ã\n\næ ¼å¼ï¼\n\nvolume ["<è·¯å¾1>", "<è·¯å¾2>"...]\nvolume <è·¯å¾\n\n\n1\n2\n\n\nå¨å¯å¨å®¹å¨ docker run çæ¶åï¼æä»¬å¯ä»¥éè¿ -v åæ°ä¿®æ¹æè½½ç¹ã\n\n# 10ãexpose\n\nä»ä»åªæ¯å£°æç«¯å£ã\n\nä½ç¨ï¼\n\nå¸®å©éåä½¿ç¨èçè§£è¿ä¸ªéåæå¡çå®æ¤ç«¯å£ï¼ä»¥æ¹ä¾¿éç½®æ å°ã\n\nå¨è¿è¡æ¶ä½¿ç¨éæºç«¯å£æ å°æ¶ï¼ä¹å°±æ¯ docker run -p æ¶ï¼ä¼èªå¨éæºæ å° expose çç«¯å£ã\n\næ ¼å¼ï¼\n\nexpose <ç«¯å£1> [<ç«¯å£2>...]\n\n\n1\n\n\n# 11ãworkdir\n\næå®å·¥ä½ç®å½ãç¨ workdir æå®çå·¥ä½ç®å½ï¼ä¼å¨æå»ºéåçæ¯ä¸å±ä¸­é½å­å¨ãï¼workdir æå®çå·¥ä½ç®å½ï¼å¦æç®å½ä¸å­å¨åä¼èªå¨åå»ºï¼ã\n\næ ¼å¼ï¼\n\nworkdir <å·¥ä½ç®å½è·¯å¾>\n\n\n1\n\n\n# 12ãuser\n\nç¨äºæå®æ§è¡åç»­å½ä»¤çç¨æ·åç¨æ·ç»ï¼è¿è¾¹åªæ¯åæ¢åç»­å½ä»¤æ§è¡çç¨æ·ï¼ç¨æ·åç¨æ·ç»å¿é¡»æåå·²ç»å­å¨ï¼ã\n\næ ¼å¼\n\nuser <ç¨æ·å>[:<ç¨æ·ç»>]\n\n\n1\n\n\n# 13ãhealthcheck\n\nç¨äºæå®æä¸ªç¨åºæèæä»¤æ¥çæ§ docker å®¹å¨æå¡çè¿è¡ç¶æã\n\næ ¼å¼ï¼\n\nhealthcheck [éé¡¹] cmd <å½ä»¤>ï¼è®¾ç½®æ£æ¥å®¹å¨å¥åº·ç¶åµçå½ä»¤\nhealthcheck noneï¼å¦æåºç¡éåæå¥åº·æ£æ¥æä»¤ï¼ä½¿ç¨è¿è¡å¯ä»¥å±è½æå¶å¥åº·æ£æ¥æä»¤\nhealthcheck [éé¡¹] cmd <å½ä»¤> : è¿è¾¹ cmd åé¢è·éçå½ä»¤ä½¿ç¨ï¼å¯ä»¥åè cmd çç¨æ³ã\nhealthcheck æ¯æä¸åéé¡¹ï¼\n--interval=<é´é>ï¼ä¸¤æ¬¡å¥åº·æ£æ¥çé´éï¼é»è®¤ä¸º 30 ç§ï¼\n--timeout=<æ¶é¿>ï¼å¥åº·æ£æ¥å½ä»¤è¿è¡è¶æ¶æ¶é´ï¼å¦æè¶è¿è¿ä¸ªæ¶é´ï¼æ¬æ¬¡å¥åº·æ£æ¥å°±è¢«è§ä¸ºå¤±è´¥ï¼é»è®¤ 30 ç§ï¼\n--retries=<æ¬¡æ°>ï¼å½è¿ç»­å¤±è´¥æå®æ¬¡æ°åï¼åå°å®¹å¨ç¶æè§ä¸º unhealthyï¼é»è®¤ 3 æ¬¡ã\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\nå cmd, entrypoint ä¸æ ·ï¼healthcheck åªå¯ä»¥åºç°ä¸æ¬¡ï¼å¦æåäºå¤ä¸ªï¼åªææåä¸ä¸ªçæã\n\nå¨ healthcheck [éé¡¹] cmd åé¢çå½ä»¤ï¼æ ¼å¼å entrypoint ä¸æ ·ï¼åä¸º shell æ ¼å¼ï¼å exec æ ¼å¼ãå½ä»¤çè¿åå¼å³å®äºè¯¥æ¬¡å¥åº·æ£æ¥çæåä¸å¦ï¼0ï¼æåï¼1ï¼å¤±è´¥ï¼2ï¼ä¿çï¼ä¸è¦ä½¿ç¨è¿ä¸ªå¼ã\n\nåè®¾æä»¬æä¸ªéåæ¯ä¸ªæç®åç web æå¡ï¼æä»¬å¸æå¢å å¥åº·æ£æ¥æ¥å¤æ­å¶ web æå¡æ¯å¦å¨æ­£å¸¸å·¥ä½ï¼æä»¬å¯ä»¥ç¨ curl æ¥å¸®å©å¤æ­ï¼å¶ dockerfile ç healthcheck å¯ä»¥è¿ä¹åï¼\n\nfrom nginx\nrun apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*\nhealthcheck --interval=5s --timeout=3s \\\n  cmd curl -fs http://localhost/ || exit 1\n\n\n1\n2\n3\n4\n\n\nå½ç¶æ¨å¯ä»¥å¨ docker run å½ä»¤ä¸­ï¼ç´æ¥ææ healthcheck ç¸å³ç­ç¥ï¼å¦ä¸ï¼\n\ndocker run --rm -d \\\n    --name=elasticsearch \\\n    --health-cmd="curl --silent --fail localhost:9200/_cluster/health || exit 1" \\\n    --health-interval=5s \\\n    --health-retries=12 \\\n    --health-timeout=2s \\\n    elasticsearch:7\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# 14ãonbuild\n\nç¨äºå»¶è¿æå»ºå½ä»¤çæ§è¡ãç®åçè¯´ï¼å°±æ¯ dockerfile éç¨ onbuild æå®çå½ä»¤ï¼å¨æ¬æ¬¡æå»ºéåçè¿ç¨ä¸­ä¸ä¼æ§è¡ï¼åè®¾éåä¸º test-buildï¼ãå½ææ°ç dockerfile ä½¿ç¨äºä¹åæå»ºçéå from test-build ï¼è¿æ¯æ§è¡æ°éåç dockerfile æå»ºæ¶åï¼ä¼æ§è¡ test-build ç dockerfile éç onbuild æå®çå½ä»¤ã\n\næ ¼å¼ï¼\n\nonbuild <å¶å®æä»¤>\n\n\n1\n\n\nåè®¾æä»¬è¦å¶ä½ node.js æåçåºç¨çéåãæä»¬é½ç¥é node.js ä½¿ç¨ npm è¿è¡åç®¡çï¼ææä¾èµãéç½®ãå¯å¨ä¿¡æ¯ç­ä¼æ¾å° package.json æä»¶éãå¨æ¿å°ç¨åºä»£ç åï¼éè¦åè¿è¡ npm install æå¯ä»¥è·å¾ææéè¦çä¾èµãå°é¡¹ç®ç¸å³çæä»¤å ä¸ onbuildï¼è¿æ ·å¨æå»ºåºç¡éåçæ¶åï¼è¿ä¸è¡å¹¶ä¸ä¼è¢«æ§è¡ãåºç¡éååååï¼åä¸ªé¡¹ç®é½ç¨è¿ä¸ª dockerfile éæ°æå»ºéåï¼ä¼ç»§æ¿åºç¡éåçæ´æ°ã\n\nfrom node:slim\nrun mkdir /app\nworkdir /app\nonbuild copy ./package.json /app\nonbuild run [ "npm", "install" ]\nonbuild copy . /app/\ncmd [ "npm", "start" ]\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# 15ãlabel\n\nlabel æä»¤ç¨æ¥ç»éåä»¥é®å¼å¯¹çå½¢å¼æ·»å ä¸äºåæ°æ®ï¼metadataï¼\n\næ ¼å¼ï¼\n\nlabel <key>=<value> <key>=<value> <key>=<value> ...\n\n\n1\n\n\næä»¬è¿å¯ä»¥ç¨ä¸äºæ ç­¾æ¥ç³æéåçä½èãææ¡£å°åç­ï¼ä¾å¦ï¼\n\nlabel org.opencontainers.image.authors="deamon"\nlabel org.opencontainers.image.documentation="https://daemon.gitbooks.io"\næè\nlabel vendor=acme\\ incorporated \\\n      com.example.is-beta= \\\n      com.example.is-production="" \\\n      com.example.version="0.0.1-beta" \\\n      com.example.release-date="2015-02-12"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n# 16ã.dockerignore æä»¶\n\næ§è¡Â docker buildÂ å½ä»¤æ¶ï¼å½åçå·¥ä½ç®å½è¢«ç§°ä¸ºæå»ºä¸ä¸æãé»è®¤æåµä¸ï¼dockerfile å°±ä½äºè¯¥è·¯å¾ä¸ãä¹å¯ä»¥éè¿Â -fÂ åæ°æ¥æå® dockerfile ï¼ä½ docker å®¢æ·ç«¯ä¼å°å½åå·¥ä½ç®å½ä¸çæææä»¶åéå° docker å®æ¤è¿ç¨è¿è¡æå»ºã\n\næä»¥æ¥è¯´ï¼å½æ§è¡ docker build è¿è¡æå»ºéåæ¶ï¼å½åç®å½ä¸å®è¦Â å¹²åÂ ï¼åè®°ä¸è¦å¨å®¶éå½ä¸åå»ºä¸ä¸ª dockerfile ç´§æ¥çÂ docker buildÂ ä¸ææ¢­ã\n\næ­£ç¡®åæ³æ¯ä¸ºé¡¹ç®å»ºç«ä¸ä¸ªæä»¶å¤¹ï¼ææå»ºéåæ¶æéè¦çèµæºæ¾å¨è¿ä¸ªæä»¶å¤¹ä¸ãæ¯å¦è¿æ ·ï¼\n\nmkdir project\ncd !$\nvi dockerfile\n# ç¼å dockerfile\n\n\n1\n2\n3\n4\n\n\nä¹å¯ä»¥éè¿Â .dockerignoreÂ æä»¶æ¥å¿½ç¥ä¸éè¦çæä»¶åéå° docker å®æ¤è¿ç¨\n\nå¨ docker cli å°ä¸ä¸æåéå° docker å®æ¤ç¨åºä¹åï¼å®ä¼å¨ä¸ä¸æçæ ¹ç®å½ä¸­æ¥æ¾ä¸ä¸ªåä¸º.dockerignore çæä»¶ãå¦ææ­¤æä»¶å­å¨ï¼cli å°ä¿®æ¹ä¸ä¸æä»¥æé¤ä¸å¶ä¸­æ¨¡å¼å¹éçæä»¶åç®å½ãè¿æå©äºé¿åä¸å¿è¦å°å°å¤§åææææä»¶åç®å½åéå°å®æ¤ç¨åºï¼å¹¶å¯è½ä½¿ç¨æå°å®ä»¬æ·»å å°éåä¸­ã\n\nä¾å¦ï¼\n\n# comment\n*/temp*\n*/*/temp*\ntemp?\n*.md\nreadme-secret.md\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# ä¸ãéåä¼å\n\n\n# 1ãåºç¡éåéæ©\n\nä½¿ç¨ä½ç§¯è¾å°çåºç¡éåï¼æ¯å¦ alpine æè debian:buster-slimï¼å openjdk å¯ä»¥éç¨ openjdk:xxx-slimï¼ç±äº openjdk æ¯åºäº debian çåºç¡éåæå»ºçï¼æä»¥å debian åºç¡éåä¸æ ·ï¼åé¢å¸¦ä¸ª slim å°±æ¯åºäº debian:xxx-slim éåæå»ºçã\n\nç®å docker å®æ¹å·²å¼å§æ¨èä½¿ç¨ alpine æ¿ä»£ä¹åç ubuntu åä¸ºåºç¡éåç¯å¢ãè¿æ ·ä¼å¸¦æ¥å¤ä¸ªå¥½å¤ãåæ¬éåä¸è½½éåº¦å å¿«ï¼éåå®å¨æ§æé«ï¼ä¸»æºä¹é´çåæ¢æ´æ¹ä¾¿ï¼å ç¨æ´å°ç£çç©ºé´ç­ã\n\nrepository                  tag                 image id            created             size\ndebian                      buster-slim         e1af56d072b8        4 days ago          69.2mb\nalpine                      latest              cc0abc535e36        8 days ago          5.59mb\n\n\n1\n2\n3\n\n\nä¸è¿éè¦æ³¨æçæ¯ï¼alpine ç c åºæ¯ musl libc ï¼èä¸æ¯æ­£ç»ç glibcï¼å¦å¤å¯¹äºä¸äºä¾èµ glibc çå¤§åé¡¹ç®ï¼å openjdk ãtomcatãrabbitmq ç­é½ä¸å»ºè®®ä½¿ç¨ alpine åºç¡éåï¼å ä¸º musl libc å¯è½ä¼å¯¼è´ jvm ä¸äºå¥æªçé®é¢ãè¿ä¹æ¯ä¸ºä»ä¹ tomcat å®æ¹æ²¡æç»åºåºç¡éåæ¯ alpine ç dockerfile çåå ã\n\nå¶ä½åç«¯éåæ¶ä¸å®ä¸è¦ä½¿ç¨centosãubuntuç­ç³»ç»éåï¼æä»¬å¯ä»¥ç´æ¥ä½¿ç¨å®æ¹æä¾çnginxéåæ¥ä½ä¸ºåºç¡éåï¼è¿æ ·æä»¬åªéæå¶ä½å¥½çwebéææä»¶æ·è´ä¸ä¸å°±å¯ä»¥äºã\n\næ¨å¯ä»¥å¨hub.docker.comç½ç«ä¸æç´¢æ´å°çéåæèè¯´æ´ç¬¦åæ¨è¦æ±çéåï¼ç¶åä½ä¸ºåºç¡éåæ¥å®ææå»ºã\n\nåºç¡éå      ä¼ç¹                  ç¼ºç¹                         å¤æ³¨\nalpine    å ç¨ç©ºé´å°               åºäºmusl libcåbusybox        å®æ¹æ¨è\nbusybox   å ç¨ç©ºé´å°ï¼æåº¦è½»éç         å·¥å·å¤ªå°                       ä¸æ¨èï¼ç»ä»¶ä¸å¨\nscratch   ç©ºéåï¼éåå¤§å°çº¦ç­äºæ§è¡æä»¶å¤§å°   æ²¡æshæbashï¼æ æ³è¿å¥å®¹å¨åè¿è¡äº¤äºå¼è°è¯   éågoè¯­è¨\n\ndockeréåå¸¸è§çåæ°\n\nåæ°               è¯´æ\nbuster           éç¨ä¸ debian 10\nstretch          éç¨äº debian 9\njessie           éç¨äº debian 8\nslim             è¡¨ç¤ºæå°å®è£åï¼ä»åå«éè¦è¿è¡æå®å®¹å¨çç¹å®å·¥å·é\nalphine/alpine   ä¸é¨ä¸ºå®¹å¨æå»ºçæä½ç³»ç»ï¼æ¯å¶ä»çæä½ç³»ç»æ´å°ï¼ä½æ¯å¶ä¸ä¼ç¼ºå°å¾å¤è½¯ä»¶åå¹¶ä¸ä½¿ç¨ç glibc ç­é½æ¯éå²ç\nbullseye         å¼åçæ¬ï¼å¤äºæªç¨³å®ç¶æ\n\n\n# 2ãéç½®å½åè½¯ä»¶æº\n\nä½¿ç¨é»è®¤çè½¯ä»¶æºå®è£æå»ºæ¶æéçä¾èµï¼å¯¹äºç»å¤§å¤æ°åºç¡éåæ¥è¯´ï¼å¯ä»¥éè¿ä¿®æ¹è½¯ä»¶æºçæ¹å¼æ´æ¢ä¸ºå½åçè½¯ä»¶æºéåç«ãç®åå½åç¨³å®å¯é çéåç«ä¸»è¦æï¼åä¸ºäºãé¿éäºãè¾è®¯äºã163 ç­ã\n\nå¯¹äº alpine åºç¡éåä¿®æ¹è½¯ä»¶æº\n\nrun sed -i \'s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g\' /etc/apk/repositories\n\n\n1\n\n\ndebian åºç¡éåä¿®æ¹é»è®¤è½¯ä»¶æº\n\nrun sed -i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list\nrun sed -i "s@http://deb.debian.org@http://mirrors.aliyun.com@g" /etc/apt/sources.list && \\\n    rm -rf /var/lib/apt/lists/* && \\\n\n\n1\n2\n3\n\n\nubuntu åºç¡éåä¿®æ¹é»è®¤è½¯ä»¶æº\n\nrun sed -i \'s/archive.ubuntu.com/mirrors.aliyun.com/g\' /etc/apt/sources.list && \\\n    sed -i \'s/security.ubuntu.com/mirrors.aliyun.com/g\' /etc/apt/sources.list\n\n\n1\n2\n\n\nå¯¹äº centos ???\n\nä½ ç¡®å®è¦ç¨ 230mb å¤§å°çåºç¡éåï¼\n\nrepository                               tag           image id       created          size\ncentos                                   latest        5d0da3dc9764   16 months ago    231mb\n\n\n1\n2\n\n\nå»ºè®®è¿äºå½ä»¤å°±æ¾å¨ run æä»¤çç¬¬ä¸æ¡ï¼update ä»¥ä¸è½¯ä»¶æºï¼ä¹åå install ç¸åºçä¾èµã\n\n\n# åãæå»ºéå\n\n\n# 1ãå½å\n\nååæ¯è§åç¥æãå¯ä½¿ç¨ä¸æ®µå¼\n\n> éåä»åºå°å/ç±»ååº/éåå:çæ¬å·\n\n * registry/runtime/java:8.1.2\n * registry/runtime/php-fpm-nginx:7.3-1.14\n * registry/cicd/kubctl-helm:1.17-3.0\n * registry/cicd/git-compose-docker:v1\n * registry/applications/demo:git_commit_id\n\n\n# 2ãåºäºéåé¨ç½²æå¡\n\né£ä¹ç°å¨æä»¬å°±å¯ä»¥å©ç¨ä»¥ä¸æä»¤ï¼å°æä»¬å¨å®¿ä¸»æºä¸æ§è¡çæä½ï¼åå¨ä¸ä¸ªdockerfileä¸­ï¼ç¤ºä¾å¦ä¸ï¼\n\nfrom centos:7\nmaintainer 759600963@qq.com\n#æ§è¡ä¸é¢å½ä»¤ï¼å®è£åºç¡ç¯å¢\nrun yum install -y gcc gcc-c++ make \\\n    openssl-devel pcre-devel gd-devel \\\n    iproute net-tools telnet wget curl && \\\n    yum clean all && \\\n    rm -rf /var/cache/yum/*\nrun wget http://nginx.org/download/nginx-1.20.1.tar.gz\nrun tar -zxf nginx-1.20.1.tar.gz -c /usr/src\nrun useradd -m -s /sbin/nologin nginx\nworkdir /usr/src/nginx-1.20.1\nrun ./configure --prefix=/usr/local/nginx --user=nginx --group=nginx && make && make install\nrun ln -s /usr/local/nginx/sbin/* /usr/local/sbin/\nrun ln -sf /usr/share/zoneinfo/asia/shanghai /etc/localtime\nworkdir /usr/local/nginx\nexpose 80\ncmd ["nginx", "-g", "daemon off;"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nå¦ä¸æç¤ºï¼fromå®ä¹äºåºäºcentos7éåæ¥æå»ºï¼è¿éä½¿ç¨äºyumæ¹å¼æ¥å®è£ä¾èµï¼å¹¶éè¿æºç ç¼è¯çæ¹å¼è¿è¡å®è£ãç¶åä½¿ç¨workdirå®ä¹äºè¿ç¨çå·¥ä½ç®å½ï¼ä½¿ç¨exposeå£°æäºåºç¨è¦ä½¿ç¨çç«¯å£ï¼æåä½¿ç¨cmdæå®äºå®¹å¨å¯å¨æ¶é»è®¤å½ä»¤ã\n\n# docker pull centos:7\n\n\n1\n\n\né£ä¹æ­¤æ¶æä»¬å¯ä»¥åå»ºä¸ä¸ªç©ºç®å½ä¾å¦nginxï¼ç¶åå°dockerfileæä»¶æ¾ç½®äºè¯¥ç®å½ä¸­ï¼ç¶åæ§è¡æå»ºå½ä»¤\n\n# docker build -t web:centos .\n\n\n1\n\n\næ³¨æ\n\nè¿éç-tåæ°æ¯ä¸ºè¿ä¸ªæå»ºçéååä¸ä¸ªåå­ï¼è®¾ç½®ä¸ä¸ªæ ç­¾ï¼å¨èªå¨çæéåçå½ä»¤æå®éååï¼ä¸å®ä¸è¦å¿è®°åæ°çæéåçå­æ¾è·¯å¾ï¼ä¹å°±æ¯ç©ºæ ¼åç ä¸ ä¸ªâ.âä»£è¡¨å½åè·¯å¾ï¼å¦åä¼æ¥éã\n\nå½æä»¬æ§è¡buildåï¼dockerä¼å°buildæä»¶å¤¹è¿ådockerfileä¸èµ·ææçæä»¶ï¼å¦ææå¶ä»æä»¶ï¼æäº¤è³docker engineæ¥å¤çãdocker engineå°éè¡è§£ædockerfileæä»¶ï¼å¹¶æ§è¡ç¸å³æä½ãdockerfileçè§£ææ¯ç±ä¸èä¸çé¡ºåºè¿è¡ã\n\næ³¨ææ¨æ¾ç½®dockerfileçç®å½æå¥½æ¯ä¸ä¸ªç©ºç®å½ï¼æèåªæ¾ç½®ä¸æ¬æ¬¡æå»ºç¸å³çæä»¶å³å¯ï¼å ä¸ºå¨æ§è¡buildæ¶ä¼å°dockerfileä»¥ådockerfileè·¯å¾ä¸çæææä»¶æäº¤è³docker engineå¤çï¼å æ­¤æ¨ä¸åºè¯¥å¨dockerfileç®å½ä¸­æ¾ç½®ä¸äºæ å³çæä»¶ï¼è¿æ¯æ æä¹çå¹¶ä¸è¿å°ä¼ä¸¥éææ¢æ´ä¸ªæå»ºè¿ç¨ã\n\nä½¿ç¨æ°çéåè¿è¡å®¹å¨\n\n# docker run -itd --name testweb -p 80:80 web:centos\n73277ceaa7a9a72d7a729029360413cfc0364effb4062b3df25aa960c67b894a\n\n\n1\n2\n\n\n\n# 3ãä½¿ç¨makefileæä½dockerfile\n\nimage_base = registry/runtime\nimage_name = php-fpm\nimage_version = 7.3\nimage_tagversion = $(git_commit)\n\nall: build tag push\n\nbuild:\n  docker build --rm -f dockerfile -t ${image_base}/${image_name}:${image_version} .\n\ntag:\n  docker tag ${image_base}/${image_name}:${image_version} ${image_base}/${image_name}:${image_tagversion}\n\npush:\n  docker push ${image_base}/${image_name}:${image_tagversion}\n\n# æå»ºå¹¶æ¨é\nmake \n# ä»æå»º\nmake build \n# ä»ætag\nmake tag\n# ä»æ¨é\nmake push\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n\n\nmakefileä¸­çå½ä»¤å¿é¡»ä»¥tabä½ä¸ºå¼å¤´(åéç¬¦),ä¸è½ç¨æ©å±çtabå³ç¨ç©ºæ ¼ä»£æ¿çtabã(å¦ææ¯vimç¼è¾çè¯,æ§è¡ set noexpandtab)ãå¦åä¼æ¥å¦ä¸éè¯¯ï¼makefile:10: *** multiple target patterns. stop.\n\n\n# äºãå¤é¶æ®µæå»ºéå\n\nå¨ç¼ådockerfileæå»ºdockeréåæ¶ï¼å¸¸éå°ä»¥ä¸é®é¢ï¼\n\n 1. runå½ä»¤ä¼è®©éåæ°å¢layerï¼å¯¼è´éååå¤§ï¼è½ç¶éè¿&&è¿æ¥å¤ä¸ªå½ä»¤è½ç¼è§£æ­¤é®é¢ï¼ä½å¦æå½ä»¤ä¹é´ç¨å°dockeræä»¤ä¾å¦copyãworkdirç­ï¼ä¾ç¶ä¼å¯¼è´å¤ä¸ªlayerï¼\n 2. æäºå·¥å·å¨æå»ºè¿ç¨ä¸­ä¼ç¨å°ï¼ä½æ¯æç»çéåæ¯ä¸éè¦çï¼ä¾å¦ç¨npmç¼è¯æå»ºåç«¯å·¥ç¨ï¼ï¼è¿è¦æ±dockerfileçç¼åèè±æ´å¤ç²¾åæ¥æ¸çè¿äºå·¥å·ï¼æ¸ççè¿ç¨åå¯è½å¯¼è´æ°çlayerï¼\n\nä¸ºäºè§£å³ä¸è¿°é®é¢ï¼ä»17.05çæ¬å¼å§dockerå¨æå»ºéåæ¶å¢å äºæ°ç¹æ§ï¼å¤é¶æ®µæå»º(multi-stage builds)ï¼å°æå»ºè¿ç¨åä¸ºå¤ä¸ªé¶æ®µï¼æ¯ä¸ªé¶æ®µé½å¯ä»¥æå®ä¸ä¸ªåºç¡éåï¼è¿æ ·å¨ä¸ä¸ªdockerfileå°±è½å°å¤ä¸ªéåçç¹æ§åæ¶ç¨å°\n\næä»¬å¯ä»¥å¨ä¸ä¸ªdockerfileä¸­ä½¿ç¨å¤ä¸ªfromæä»¤å¹¶å°ä¸æ¬¡æå»ºåæå¤ä¸ªé¶æ®µæ¥å®æ\n\n# build stage\nfrom node:14.18.2-stretch-slim as build-env\n# å·¥ä½ç®å½\nworkdir /app\n# å°gitä»åºä¸æææä»¶æ·è´å°å·¥ä½ç®å½\ncopy . .\nrun npm install\nrun npm audit fix\nrun npm run build:production\n\n# production stage\n# çäº§ç¯å¢åºç¡nginxéåï¼ä¸é¢çéåå·²ç»æåä¸ºäºéææä»¶ï¼\nfrom nginx:alpine\nadd  prod.conf /etc/nginx/conf.d/\n# ä½¿ç¨--fromæä¸é¢äº§ççéææä»¶å¤å¶å°nginxçè¿è¡ç®å½\ncopy --from=build-env /app/dist /usr/share/nginx/html\nrun ln -sf /usr/share/zoneinfo/asia/shanghai /etc/localtime && \\\n    echo \'asia/shanghai\' >/etc/timezone\n# nginxå®¹å¨åé¨æ´é²çç«¯å£\nexpose 80\n# è¿è¡çå½ä»¤\ncmd ["/bin/sh", "-c", "nginx -g \\"daemon off;\\"" ]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nå¨ç¬¬ä¸ä¸ªfromæä»¤åä½¿ç¨as build-env æææ¯ä¸ºè¯¥é¶æ®µåä¸ä¸ªæ è®°åä¸ºbuild-envï¼ç¶åå¨ç¬¬äºä¸ªfromä¹åä½¿ç¨äºcopy --from=build-envï¼æææ¯ä»ä¸ä¸ä¸ªåä¸ºbuilderçé¶æ®µä¸­æ·è´æä»¶è³æ¬é¶æ®µä¸­ã\n\n\n# å­ãdockerfile ä¼ å\n\nä½¿ç¨ arg å build-arg ä¼ å¥å¨æåéï¼\n\n# base image \nfrom centos:7 \n# maintainer dot # deprecated \n\nlabel maintainer="dot" version="demo" \nlabel multiple="true" \n\narg username \narg dir="defaultvalue" \n\nrun useradd -m $username -u 1001 && mkdir $dir \n\n# docker build --build-arg username="test_arg" -t test:arg . \n# docker run -ti --rm test:arg bash \n# ls \nbin             dev  home  lib64       media  opt   root  selinux  sys  usr \ndefaultvalue  etc  lib   lost+found  mnt    proc  sbin  srv      tmp  var\n# tail -1 /etc/passwd \ntest_arg:x:1001:1001::/home/test_arg:/bin/bash\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n\n# ä¸ãdockerfile ä¼å\n\n\n# 1ãå°½éä¸ä½¿ç¨rootç¨æ·\n\nå¨ååºç¡è¿è¡æ¶éåæ¶ï¼åå»ºè¿è¡æ¶æ®éç¨æ·åç¨æ·ç»ï¼å¹¶åå·¥ä½åºä¸æééå¶ï¼å¯å¨æå¡æ¶å°½éä½¿ç¨æ®éç¨æ·ã\n\ngosu\n\nfrom alpine:3.11.5\nrun sed -i "s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g" /etc/apk/repositories \\\n    && apk add --no-cache gosu\n\n\n1\n2\n3\n\n\n\n# 2ãç§»é¤ææç¼å­ç­ä¸å¿è¦ä¿¡æ¯\n\n * å é¤è§£ååçæºåç¼©åï¼åèç¬¬äºç« ç¬¬äºèï¼\n * æ¸çåç®¡çå¨ä¸è½½å®è£è½¯ä»¶æ¶çç¼å­\n   * ä½¿ç¨alipineéåä¸­apkå½ä»¤å®è£åæ¶è®°å¾å ä¸--no-cache\n   * ä½¿ç¨ubuntuéåä¸­çaptå½ä»¤å®è£è½¯ä»¶åè®°å¾ rm -rf /var/lib/apt/lists/*\n\n\n# 3ãä½¿ç¨åççentrypointèæ¬\n\nç¤ºä¾ï¼\n\n#!/bin/bash\nset -e\n\nif [ "$1" = \'postgres\' ]; then\n    chown -r postgres "$pgdata"\n\n    if [ -z "$(ls -a "$pgdata")" ]; then\n        gosu postgres initdb\n    fi\n\n    exec gosu postgres "$@"\nfi\n\nexec "$@"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n\n# 4ãè®¾ç½®æ¶åº\n\nç±äºç»å¤§å¤æ°åºç¡éåé½æ¯é»è®¤éç¨ utc çæ¶åºï¼ä¸åäº¬æ¶é´ç¸å·® 8 ä¸ªå°æ¶ï¼è¿å°ä¼å¯¼è´å®¹å¨åçæ¶é´ä¸åäº¬æ¶é´ä¸ä¸è´ï¼å èä¼å¯¹ä¸äºåºç¨é æä¸äºå½±åï¼è¿ä¼å½±åå®¹å¨åæ¥å¿åçæ§çæ°æ®ã\n\nå æ­¤å¯¹äºä¸å«åºçç¨æ·ï¼æå¥½å¨æå»ºéåçæ¶åè®¾å®ä¸ä¸å®¹å¨åçæ¶åºï¼ä»¥åä»¥åå ä¸ºæ¶åºéå°ä¸äº bugã\n\nå¯ä»¥éè¿ç¯å¢åéè®¾ç½®å®¹å¨åçæ¶åºãå¨å¯å¨çæ¶åå¯ä»¥éè¿è®¾ç½®ç¯å¢åé -e tz=asia/shanghai æ¥è®¾å®å®¹å¨åçæ¶åºã\n\n# 1ãåºäº alpine éå\n\nfrom alpine:3.15\nenv tz=asia/shanghai\nrun sed -i \'s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g\' /etc/apk/repositories \\\n    && apk add --no-cache tzdata \\\n    && ln -sf /usr/share/zoneinfo/asia/shanghai /etc/localtime  \\\n    && echo "asia/shanghai" > /etc/timezone\n\n\n1\n2\n3\n4\n5\n6\n\n\n# 2ãåºäº centos7 éå\n\nfrom centos:7\n#å®ä¹æ¶åºåæ°\nenv tz=asia/shanghai\n#è®¾ç½®æ¶åº\nrun ln -snf /usr/share/zoneinfo/$tz /etc/localtime && echo \'$tz\' > /etc/timezone\n\n\n1\n2\n3\n4\n5\n\n\n# 3ãåºäº debian éå\n\n# ç±äº debian éåä¸­å·²ç»åå«äºtzdataï¼æä»¥åªéæ·»å ç¯å¢åétzå³å¯ã\nfrom debian:latest\n\nenv tz=asia/shanghai\n\n\n1\n2\n3\n4\n\n\n# 4ãåºäº ubuntu éå\n\nfrom ubuntu:bionic\n\nenv tz=asia/shanghai\nrun echo "${tz}" > /etc/timezone\n    && ln -sf /usr/share/zoneinfo/${tz} /etc/localtime\n    && apt update\n    && apt install -y tzdata\n    && rm -rf /var/lib/apt/lists/*\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# 5ãè®¾ç½®ç³»ç»è¯­è¨\n\n# 1ãåºäº alpine éå\n\nfrom alpine:3.15\nenv lang=en_us.utf-8 \\\n    language=en_us.utf-8\n\nrun apk --no-cache add ca-certificates wget \\ \n    && wget -q -o /etc/apk/keys/sgerrand.rsa.pub https://alpine-pkgs.sgerrand.com/sgerrand.rsa.pub \\ \n    && wget -q https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.33-r0/glibc-2.33-r0.apk \\ \n    && wget -q https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.33-r0/glibc-bin-2.33-r0.apk \\\n    && wget -q https://github.com/sgerrand/alpine-pkg-glibc/releases/download/2.33-r0/glibc-i18n-2.33-r0.apk \\\n    && apk add glibc-bin-2.33-r0.apk glibc-i18n-2.33-r0.apk glibc-2.33-r0.apk \\\n    && rm -rf /usr/lib/jvm glibc-2.29-r0.apk glibc-bin-2.29-r0.apk  glibc-i18n-2.29-r0.apk \\\n    && /usr/glibc-compat/bin/localedef --force --inputfile posix --charmap utf-8 "$lang" || true \\\n    && echo "export lang=$lang" > /etc/profile.d/locale.sh \\\n    && apk del glibc-i18n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n\n\n# 2ãåºäº centos7 éå\n\nfrom centos:7\n#å®è£å¿è¦åºç¨\nrun yum -y install kde-l10n-chinese glibc-common\n#è®¾ç½®ç¼ç \nrun localedef -c -f utf-8 -i zh_cn zh_cn.utf8\n#è®¾ç½®ç¯å¢åé\nenv lc_all zh_cn.utf8\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# 3ãåºäº debian éå\n\n# ç±äº debian éåä¸­å·²ç»åå«äºtzdataï¼æä»¥åªéæ·»å ç¯å¢åétzå³å¯ã\nfrom debian:latest\n\nenv lang c.utf-8\nrun apt-get update; \\\n    apt-get install -y --no-install-recommends fontconfig;\n\n\n1\n2\n3\n4\n5\n6\n\n\n# 4ãåºäº ubuntu éå\n\nfrom ubuntu:bionic\n\nenv lang c.utf-8\n\n\n1\n2\n3\n\n\n\n# 6ãä½¿ç¨labelæ æ³¨ä½èãè½¯ä»¶çæ¬ç­åä¿¡æ¯\n\nfrom alpine:3.11.5\nlabel author=curiouser \\\n      mail=****@163.com \\\n      php=7.3 \\\n      tools=âgitãvimãcurlâ \\\n      update="æ·»å ç¨æ·ç»"\n\n\n1\n2\n3\n4\n5\n6\n\n\n\n# 7ãæå®å·¥ä½åº\n\nworkdir /var/wwww\n\n\n1\n\n\n\n# 8ãrunæä»¤æ¾ç¤ºä¼å\n\nrun set -eux ; \\\n    ls -al\n\n\n1\n2\n\n\n\n# 9ãä½¿ç¨ url æ·»å æºç \n\nå¦æä¸éç¨åé¶æ®µæå»ºï¼å¯¹äºä¸äºéè¦å¨å®¹å¨åè¿è¡ç¼è¯çé¡¹ç®ï¼æå¥½éè¿ git æè wegt çæ¹å¼å°æºç æå¥å°éååï¼èééç¨ add æè copy ï¼å ä¸ºæºç ç¼è¯å®æä¹åï¼æºç å°±ä¸éè¦å¯ä»¥å æäºï¼èéè¿ add æè copy æ·»å è¿å»çæºç å·²ç»ç¨å¨ä¸ä¸å±éåä¸­äºï¼æ¯å ä¸ææ»´å¦ã\n\nä¹å°±æ¯è¯´ git & wget source ç¶å buildï¼æå rm -rf source/ è¿ä¸é¨æ¾å¨ä¸æ¡ run æä»¤ä¸­ï¼è¿æ ·å°±è½é¿åæºç æ·»å å°éåä¸­èå¢å¤§éåä½ç§¯å¦ã\n\n\n# 10ãä½¿ç¨èæç¼è¯ç¯å¢\n\nå¯¹äºåªå¨ç¼è¯è¿ç¨ä¸­ä½¿ç¨å°çä¾èµï¼æä»¬å¯ä»¥å°è¿äºä¾èµå®è£å¨èæç¯å¢ä¸­ï¼ç¼è¯å®æä¹åå¯ä»¥ä¸å¹¶å é¤è¿äºä¾èµï¼æ¯å¦ alpine ä¸­å¯ä»¥ä½¿ç¨ apk add --no-cache --virtual .build-depsï¼åé¢å ä¸éè¦å®è£çç¸å³ä¾èµã\n\napk add --no-cache --virtual .build-deps gcc libc-dev make perl-dev openssl-dev pcre-dev zlib-dev git\n\n\n1\n\n\næå»ºå®æä¹åå¯ä»¥ä½¿ç¨ apk del .build-deps å½ä»¤ï¼ä¸å¹¶å°è¿äºç¼è¯ä¾èµå¨é¨å é¤ã\n\néè¦æ³¨æçæ¯ï¼.build-deps åé¢æ¥çæ¯ç¼è¯æ¶ä»¥æ¥çè½¯ä»¶åï¼å¹¶ä¸æ¯ææçç¼è¯ä¾èµé½å¯ä»¥å é¤ï¼ä¸è¦æè¿è¡æ¶çä¾èµåæ¥å¨åé¢ï¼æå¥½åç¬ add ä¸ä¸ã\n\n\n# 11ãæå°åå±æ°\n\ndocker å¨ 1.10 ä»¥åï¼åªæ runãcopy å add æä»¤ä¼åå»ºå±ï¼å¶ä»æä»¤ä¼åå»ºä¸´æ¶çä¸­é´éåï¼ä½æ¯ä¸ä¼ç´æ¥å¢å æå»ºçéåå¤§å°äºã\n\nåææå°äºå»ºè®®ä½¿ç¨ git æè wget çæ¹å¼æ¥å°æä»¶æå¥å°éåå½ä¸­ï¼ä½å¦ææä»¬å¿é¡»è¦ä½¿ç¨ copy æè add æä»¤å¢ï¼\n\nè¿æ¯æ¿ fastdfs ä¸ºä¾ï¼\n\n# centos 7\nfrom centos:7\n# æ·»å éç½®æä»¶\n# add profiles\nadd conf/client.conf /etc/fdfs/\nadd conf/http.conf /etc/fdfs/\nadd conf/mime.types /etc/fdfs/\nadd conf/storage.conf /etc/fdfs/\nadd conf/tracker.conf /etc/fdfs/\nadd fastdfs.sh /home\nadd conf/nginx.conf /etc/fdfs/\nadd conf/mod_fastdfs.conf /etc/fdfs\n\n# æ·»å æºæä»¶\n# add source code\nadd source/libfastcommon.tar.gz /usr/local/src/\nadd source/fastdfs.tar.gz /usr/local/src/\nadd source/fastdfs-nginx-module.tar.gz /usr/local/src/\nadd source/nginx-1.15.4.tar.gz /usr/local/src/\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\nå¤ä¸ªæä»¶éè¦æ·»å å°å®¹å¨ä¸­ä¸åçè·¯å¾ï¼æ¯ä¸ªæä»¶ä½¿ç¨ä¸æ¡ add æä»¤çè¯å°±ä¼å¢å ä¸å±éåï¼è¿æ ·ææ²å°±å¤äº 12 å±éå ã\n\nå¶å®å¤§å¯ä¸å¿ï¼æä»¬å¯ä»¥å°è¿äºæä»¶å¨é¨æåä¸ºä¸ä¸ªæä»¶ä¸º src.tar.gz ç¶åéè¿ add çæ¹å¼ææä»¶æ·»å å°å½ä¸­å»ï¼ç¶åå¨ run æä»¤åä½¿ç¨ mv å½ä»¤ææä»¶ç§»å¨å°æå®çä½ç½®ãè¿æ ·ä»ä»ä¸æ¡ add å run æä»¤åä»£æäº 12 ä¸ª add æä»¤ã\n\nfrom alpine:3.10\ncopy src.tar.gz /usr/local/src.tar.gz\nrun set -xe \\\n    && apk add --no-cache --virtual .build-deps gcc libc-dev make perl-dev openssl-dev pcre-dev zlib-dev tzdata \\\n    && cp /usr/share/zoneinfo/asia/shanghai /etc/localtime \\\n    && tar -xvf /usr/local/src.tar.gz -c /usr/local \\\n    && mv /usr/local/src/conf/fastdfs.sh /home/fastdfs/ \\\n    && mv /usr/local/src/conf/* /etc/fdfs \\\n    && chmod +x /home/fastdfs/fastdfs.sh \\\n    && rm -rf /usr/local/src/* /var/cache/apk/* /tmp/* /var/tmp/* $home/.cache\nvolume /var/fdfs\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå¶ä»æå°åå±æ°æ éå°±æ¯ææå»ºé¡¹ç®çæ´ä¸ªæ­¥éª¤å¼æä¸æ¡ run æä»¤ï¼ä¸è¿å¤æ¡å½ä»¤åå¹¶å¯ä»¥ä½¿ç¨ && æè ; è¿ä¸¤èé½å¯ä»¥ï¼ä¸è¿æ®æå¨ docker hub ä¸çæè§æé»ï¼ä½¿ç¨ ; çå±å¤ï¼å°¤å¶æ¯å®æ¹ç dockerfileã',charsets:{cjk:!0}},{title:"å¦ä½éæ©dockeråºç¡éå",frontmatter:{title:"å¦ä½éæ©dockeråºç¡éå",date:"2023-01-30T16:28:23.000Z",permalink:"/pages/8884ac/",categories:["è¿ç»´","docker"],tags:[null],readingShow:"top",description:"å ä¸ºDockeréåæ¯åºäºåºç¡éåæ¥æå»ºçï¼å æ­¤éæ©çåºç¡éåè¶é«çº§ï¼æä»¬è¦åçåºå±å·¥ä½å°±è¶å°ã",meta:[{name:"twitter:title",content:"å¦ä½éæ©dockeråºç¡éå"},{name:"twitter:description",content:"å ä¸ºDockeréåæ¯åºäºåºç¡éåæ¥æå»ºçï¼å æ­¤éæ©çåºç¡éåè¶é«çº§ï¼æä»¬è¦åçåºå±å·¥ä½å°±è¶å°ã"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/10.docker/03.%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9docker%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å¦ä½éæ©dockeråºç¡éå"},{property:"og:description",content:"å ä¸ºDockeréåæ¯åºäºåºç¡éåæ¥æå»ºçï¼å æ­¤éæ©çåºç¡éåè¶é«çº§ï¼æä»¬è¦åçåºå±å·¥ä½å°±è¶å°ã"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/10.docker/03.%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9docker%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-30T16:28:23.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"å¦ä½éæ©dockeråºç¡éå"},{itemprop:"description",content:"å ä¸ºDockeréåæ¯åºäºåºç¡éåæ¥æå»ºçï¼å æ­¤éæ©çåºç¡éåè¶é«çº§ï¼æä»¬è¦åçåºå±å·¥ä½å°±è¶å°ã"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/10.docker/03.%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9docker%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F.html",relativePath:"04.è¿ç»´/10.docker/03.å¦ä½éæ©dockeråºç¡éå.md",key:"v-573ab138",path:"/pages/8884ac/",headers:[{level:3,title:"éåå®ç½",slug:"éåå®ç½",normalizedTitle:"éåå®ç½",charIndex:137},{level:3,title:"æä½ç³»ç»åºç¡éå",slug:"æä½ç³»ç»åºç¡éå",normalizedTitle:"æä½ç³»ç»åºç¡éå",charIndex:350},{level:3,title:"busybox",slug:"busybox",normalizedTitle:"busybox",charIndex:425},{level:3,title:"Alpine",slug:"alpine",normalizedTitle:"alpine",charIndex:781},{level:3,title:"CentOS",slug:"centos",normalizedTitle:"centos",charIndex:511},{level:3,title:"Ubuntu",slug:"ubuntu",normalizedTitle:"ubuntu",charIndex:1157},{level:3,title:"Debian",slug:"debian",normalizedTitle:"debian",charIndex:1274},{level:3,title:"ç¼ç¨è¯­è¨åºç¡éå",slug:"ç¼ç¨è¯­è¨åºç¡éå",normalizedTitle:"ç¼ç¨è¯­è¨åºç¡éå",charIndex:1392},{level:4,title:"javaåºç¡éå",slug:"javaåºç¡éå",normalizedTitle:"javaåºç¡éå",charIndex:1404},{level:4,title:"pythonåºç¡éå",slug:"pythonåºç¡éå",normalizedTitle:"pythonåºç¡éå",charIndex:1454},{level:4,title:"nodejsåºç¡éå",slug:"nodejsåºç¡éå",normalizedTitle:"nodejsåºç¡éå",charIndex:1505},{level:3,title:"åºç¨åºç¡éå",slug:"åºç¨åºç¡éå",normalizedTitle:"åºç¨åºç¡éå",charIndex:1555},{level:4,title:"nginxåºç¡éå",slug:"nginxåºç¡éå",normalizedTitle:"nginxåºç¡éå",charIndex:1565},{level:4,title:"tomcatåºç¡éå",slug:"tomcatåºç¡éå",normalizedTitle:"tomcatåºç¡éå",charIndex:1614},{level:4,title:"jettyåºç¡éå",slug:"jettyåºç¡éå",normalizedTitle:"jettyåºç¡éå",charIndex:1665},{level:3,title:"å¶å®åºç¡éåä¾å­",slug:"å¶å®åºç¡éåä¾å­",normalizedTitle:"å¶å®åºç¡éåä¾å­",charIndex:1715},{level:4,title:"mavenåºç¡éå",slug:"mavenåºç¡éå",normalizedTitle:"mavenåºç¡éå",charIndex:1727},{level:4,title:"jenkinsåºç¡éå",slug:"jenkinsåºç¡éå",normalizedTitle:"jenkinsåºç¡éå",charIndex:1776},{level:4,title:"gitlabåºç¡éå",slug:"gitlabåºç¡éå",normalizedTitle:"gitlabåºç¡éå",charIndex:1837}],headersStr:"éåå®ç½ æä½ç³»ç»åºç¡éå busybox Alpine CentOS Ubuntu Debian ç¼ç¨è¯­è¨åºç¡éå javaåºç¡éå pythonåºç¡éå nodejsåºç¡éå åºç¨åºç¡éå nginxåºç¡éå tomcatåºç¡éå jettyåºç¡éå å¶å®åºç¡éåä¾å­ mavenåºç¡éå jenkinsåºç¡éå gitlabåºç¡éå",content:"# å¦ä½éæ©dockeråºç¡éå\n\nå ä¸ºDockeréåæ¯åºäºåºç¡éåæ¥æå»ºçï¼å æ­¤éæ©çåºç¡éåè¶é«çº§ï¼æä»¬è¦åçåºå±å·¥ä½å°±è¶å°ã\n\næ¯å¦ï¼å¦ææå»ºä¸ä¸ªJavaåºç¨çéåï¼éæ©ä¸ä¸ªopenjdkçéåä½ä¸ºåºç¡éåæ¯éæ©ä¸ä¸ªalpineéåä½ä¸ºåºç¡éåè¦ç®åå°å¤ã\n\n\n# éåå®ç½\n\n * Dockeréåå®ç½ï¼Docker Hubï¼: https://hub.docker.com\n\n * é¿éäºå®¹å¨Hubï¼https://dev.aliyun.com\n\n * Googleéåï¼gcr.ioï¼ï¼https://console.cloud.google.com/gcr/images/google-containers/GLOBAL ï¼éè¦ç§å­¦ä¸ç½ï¼ä¸»è¦ä¸ºKubernetesç¸å³éåï¼\n\n\n# æä½ç³»ç»åºç¡éå\n\næ¯å¦ä½ è¦ä»Linuxæä½ç³»ç»åºç¡éåå¼å§æå»ºï¼å¯ä»¥åèä¸è¡¨æ¥éæ©åéçåºç¡éåï¼\n\néååç§°      å¤§å°      ä½¿ç¨åºæ¯\nbusybox   1.15M   ä¸´æ¶ä½¿ç¨\nalpine    4.41M   ä¸»è¦ç¨äºæµè¯ï¼ä¹å¯ç¨äºçäº§ç¯å¢\ncentos    200M    ä¸»è¦ç¨äºçäº§ç¯å¢ï¼æ¯æCentOS/Red Hatï¼å¸¸ç¨äºè¿½æ±ç¨³å®æ§çä¼ä¸åºç¨\nutuntu    81.1M   ä¸»è¦ç¨äºçäº§ç¯å¢ï¼å¸¸ç¨äºäººå·¥æºè½è®¡ç®åä¼ä¸åºç¨\ndebian    101M    ä¸»è¦ç¨äºçäº§ç¯å¢\n\n\n# busybox\n\næè¿°ï¼å¯ä»¥å°busyboxçè§£ä¸ºä¸ä¸ªè¶çº§ç®åçåµå¥å¼Linuxç³»ç»ã\n\nå®ç½ï¼https://www.busybox.net/\n\néåï¼https://hub.docker.com/_/busybox/\n\nåç®¡çå½ä»¤ï¼apk, lbu\n\nåç®¡çææ¡£ï¼https://wiki.alpinelinux.org/wiki/Alpine_Linux_package_management\n\n\n# Alpine\n\næè¿°ï¼Alpineæ¯ä¸ä¸ªé¢åå®å¨çãè½»éçº§çLinuxç³»ç»ï¼åºäºmusl libcåbusyboxã\n\nå®ç½ï¼https://www.alpinelinux.org/\n\néåï¼https://hub.docker.com/_/alpine/\n\nåç®¡çå½ä»¤ï¼apk, lbu\n\nåç®¡çææ¡£ï¼https://wiki.alpinelinux.org/wiki/Alpine_Linux_package_management\n\n\n# CentOS\n\næè¿°ï¼å¯ä»¥çè§£CentOSæ¯RedHatçç¤¾åºç\n\nå®ç½ï¼https://www.centos.org/\n\néåï¼https://hub.docker.com/_/centos/\n\nåç®¡çå½ä»¤ï¼yum, rpm\n\n\n# Ubuntu\n\næè¿°ï¼å¦ä¸ä¸ªéå¸¸åºè²çLinuxåè¡ç\n\nå®ç½ï¼http://www.ubuntu.com/\n\néåï¼https://hub.docker.com/_/ubuntu/\n\nåç®¡çå½ä»¤ï¼apt-get, dpkg\n\n\n# Debian\n\næè¿°ï¼å¦ä¸ä¸ªéå¸¸åºè²çLinuxåè¡ç\n\nå®ç½ï¼https://www.debian.org/\n\néåï¼https://hub.docker.com/_/debian/\n\nåç®¡çå½ä»¤ï¼apt-get, dpkg\n\n\n# ç¼ç¨è¯­è¨åºç¡éå\n\n# javaåºç¡éå\n\n * https://hub.docker.com/_/openjdk/\n\n# pythonåºç¡éå\n\n * https://hub.docker.com/_/python/\n\n# nodejsåºç¡éå\n\n * https://hub.docker.com/_/node/\n\n\n# åºç¨åºç¡éå\n\n# nginxåºç¡éå\n\n * https://hub.docker.com/_/nginx/\n\n# tomcatåºç¡éå\n\n * https://hub.docker.com/_/tomcat/\n\n# jettyåºç¡éå\n\n * https://hub.docker.com/_/jetty/\n\n\n# å¶å®åºç¡éåä¾å­\n\n# mavenåºç¡éå\n\n * https://hub.docker.com/_/maven/\n\n# jenkinsåºç¡éå\n\n * https://hub.docker.com/r/jenkins/jenkins/\n\n# gitlabåºç¡éå\n\n * https://hub.docker.com/r/gitlab/gitlab-ce/",normalizedContent:"# å¦ä½éæ©dockeråºç¡éå\n\nå ä¸ºdockeréåæ¯åºäºåºç¡éåæ¥æå»ºçï¼å æ­¤éæ©çåºç¡éåè¶é«çº§ï¼æä»¬è¦åçåºå±å·¥ä½å°±è¶å°ã\n\næ¯å¦ï¼å¦ææå»ºä¸ä¸ªjavaåºç¨çéåï¼éæ©ä¸ä¸ªopenjdkçéåä½ä¸ºåºç¡éåæ¯éæ©ä¸ä¸ªalpineéåä½ä¸ºåºç¡éåè¦ç®åå°å¤ã\n\n\n# éåå®ç½\n\n * dockeréåå®ç½ï¼docker hubï¼: https://hub.docker.com\n\n * é¿éäºå®¹å¨hubï¼https://dev.aliyun.com\n\n * googleéåï¼gcr.ioï¼ï¼https://console.cloud.google.com/gcr/images/google-containers/global ï¼éè¦ç§å­¦ä¸ç½ï¼ä¸»è¦ä¸ºkubernetesç¸å³éåï¼\n\n\n# æä½ç³»ç»åºç¡éå\n\næ¯å¦ä½ è¦ä»linuxæä½ç³»ç»åºç¡éåå¼å§æå»ºï¼å¯ä»¥åèä¸è¡¨æ¥éæ©åéçåºç¡éåï¼\n\néååç§°      å¤§å°      ä½¿ç¨åºæ¯\nbusybox   1.15m   ä¸´æ¶ä½¿ç¨\nalpine    4.41m   ä¸»è¦ç¨äºæµè¯ï¼ä¹å¯ç¨äºçäº§ç¯å¢\ncentos    200m    ä¸»è¦ç¨äºçäº§ç¯å¢ï¼æ¯æcentos/red hatï¼å¸¸ç¨äºè¿½æ±ç¨³å®æ§çä¼ä¸åºç¨\nutuntu    81.1m   ä¸»è¦ç¨äºçäº§ç¯å¢ï¼å¸¸ç¨äºäººå·¥æºè½è®¡ç®åä¼ä¸åºç¨\ndebian    101m    ä¸»è¦ç¨äºçäº§ç¯å¢\n\n\n# busybox\n\næè¿°ï¼å¯ä»¥å°busyboxçè§£ä¸ºä¸ä¸ªè¶çº§ç®åçåµå¥å¼linuxç³»ç»ã\n\nå®ç½ï¼https://www.busybox.net/\n\néåï¼https://hub.docker.com/_/busybox/\n\nåç®¡çå½ä»¤ï¼apk, lbu\n\nåç®¡çææ¡£ï¼https://wiki.alpinelinux.org/wiki/alpine_linux_package_management\n\n\n# alpine\n\næè¿°ï¼alpineæ¯ä¸ä¸ªé¢åå®å¨çãè½»éçº§çlinuxç³»ç»ï¼åºäºmusl libcåbusyboxã\n\nå®ç½ï¼https://www.alpinelinux.org/\n\néåï¼https://hub.docker.com/_/alpine/\n\nåç®¡çå½ä»¤ï¼apk, lbu\n\nåç®¡çææ¡£ï¼https://wiki.alpinelinux.org/wiki/alpine_linux_package_management\n\n\n# centos\n\næè¿°ï¼å¯ä»¥çè§£centosæ¯redhatçç¤¾åºç\n\nå®ç½ï¼https://www.centos.org/\n\néåï¼https://hub.docker.com/_/centos/\n\nåç®¡çå½ä»¤ï¼yum, rpm\n\n\n# ubuntu\n\næè¿°ï¼å¦ä¸ä¸ªéå¸¸åºè²çlinuxåè¡ç\n\nå®ç½ï¼http://www.ubuntu.com/\n\néåï¼https://hub.docker.com/_/ubuntu/\n\nåç®¡çå½ä»¤ï¼apt-get, dpkg\n\n\n# debian\n\næè¿°ï¼å¦ä¸ä¸ªéå¸¸åºè²çlinuxåè¡ç\n\nå®ç½ï¼https://www.debian.org/\n\néåï¼https://hub.docker.com/_/debian/\n\nåç®¡çå½ä»¤ï¼apt-get, dpkg\n\n\n# ç¼ç¨è¯­è¨åºç¡éå\n\n# javaåºç¡éå\n\n * https://hub.docker.com/_/openjdk/\n\n# pythonåºç¡éå\n\n * https://hub.docker.com/_/python/\n\n# nodejsåºç¡éå\n\n * https://hub.docker.com/_/node/\n\n\n# åºç¨åºç¡éå\n\n# nginxåºç¡éå\n\n * https://hub.docker.com/_/nginx/\n\n# tomcatåºç¡éå\n\n * https://hub.docker.com/_/tomcat/\n\n# jettyåºç¡éå\n\n * https://hub.docker.com/_/jetty/\n\n\n# å¶å®åºç¡éåä¾å­\n\n# mavenåºç¡éå\n\n * https://hub.docker.com/_/maven/\n\n# jenkinsåºç¡éå\n\n * https://hub.docker.com/r/jenkins/jenkins/\n\n# gitlabåºç¡éå\n\n * https://hub.docker.com/r/gitlab/gitlab-ce/",charsets:{cjk:!0}},{title:"å¸¸è§çdockerfileæ±æ»",frontmatter:{title:"å¸¸è§çdockerfileæ±æ»",date:"2023-02-01T12:38:37.000Z",permalink:"/pages/382a6c/",categories:["è¿ç»´","docker"],tags:[null],readingShow:"top",description:"python",meta:[{name:"twitter:title",content:"å¸¸è§çdockerfileæ±æ»"},{name:"twitter:description",content:"python"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/10.docker/04.%E5%B8%B8%E8%A7%81%E7%9A%84dockerfile%E6%B1%87%E6%80%BB.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å¸¸è§çdockerfileæ±æ»"},{property:"og:description",content:"python"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/10.docker/04.%E5%B8%B8%E8%A7%81%E7%9A%84dockerfile%E6%B1%87%E6%80%BB.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-02-01T12:38:37.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"å¸¸è§çdockerfileæ±æ»"},{itemprop:"description",content:"python"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/10.docker/04.%E5%B8%B8%E8%A7%81%E7%9A%84dockerfile%E6%B1%87%E6%80%BB.html",relativePath:"04.è¿ç»´/10.docker/04.å¸¸è§çdockerfileæ±æ».md",key:"v-20b39df5",path:"/pages/382a6c/",headersStr:null,content:'python\n\nFROM python:3.7-alpine\nWORKDIR /code\nENV FLASK_APP=app.py\nENV FLASK_RUN_HOST=0.0.0.0\nCOPY requirements.txt requirements.txt\nRUN pip install -r requirements.txt\nEXPOSE 5000\nCOPY . .\nCMD ["flask", "run"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nphp\n\nFROM php:7.2.34-fpm-alpine\nWORKDIR /app\nENV TZ "Asia/Shanghai"\nRUN sed -i "s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g" /etc/apk/repositories \\\n&& apk add --no-cache autoconf g++ libtool make curl-dev libxml2-dev linux-headers \\\n&& docker-php-ext-install -j 2 zip \\\n&& apk add --no-cache freetype-dev libjpeg-turbo-dev libpng-dev \\\n&& docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n&& docker-php-ext-install -j 2 gd \\\n&& docker-php-ext-install -j$(nproc) bcmath \\\n&& docker-php-ext-install -j 2 mysqli \\\n&& docker-php-ext-install pdo_mysql\ncopy . .\nRUN chown -R www-data:www-data /app\nEXPOSE 9000\nENTRYPOINT ["php-fpm"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\ngo\n\nFROM golang:1.16.7-alpine3.13 AS builder\n\nLABEL stage=gobuilder\n\nENV CGO_ENABLED 0\nENV GOOS linux\nENV GOPROXY https://goproxy.cn,direct\nARG VERSION\nARG GIT_COMMIT\nARG GIT_TREE_STATE\nARG BUILD_DATE\n\nWORKDIR /build/zero\n\nADD go.mod .\nADD go.sum .\nRUN go mod download\nCOPY . .\nRUN go build -ldflags="-s -w -X trade/common/version.GitVersion=${VERSION} -X trade/common/version.GitCommit=${GIT_COMMIT} -X trade/common/version.GitTreeState=${GIT_TREE_STATE} -X trade/common/version.BuildDate=${BUILD_DATE}" -o /app/backend api/backend/backend.go\n\n\nFROM alpine:3.13\nRUN sed -i \'s/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g\' /etc/apk/repositories\nRUN apk update --no-cache && apk add --no-cache ca-certificates tzdata\nENV TZ Asia/Shanghai\n\nWORKDIR /app\nCOPY --from=builder /app/backend /app/backend\nCOPY --from=builder /build/zero/api/backend/etc /app/etc\n\nEXPOSE 8888\n\nCMD ["./backend"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nnode\n\nFROM dh.1quant.me/library/node:8.15.0-alpine-i18n AS builder\n\nLABEL stage=h5builder\n\nWORKDIR /app\n\nCOPY . .\n\nRUN npm cache verify && npm i && npm run build\n\nFROM dh.1quant.me/library/nginx:1.14.2-alpine\n\nCOPY --from=builder /app/dist /usr/share/nginx/html\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nc++\n\nFROM debian:buster\n\nENV TZ Asia/Shanghai\n\nWORKDIR /app\nENV LD_LIBRARY_PATH=/app/lib\n\nCOPY . .\nRUN ln -s libssl.so.1.0.2k ./lib/libssl.so.10 && ln -s libcrypto.so.1.0.2k ./lib/libcrypto.so.10\n\nEXPOSE 9101\n\nCMD ["./bin/trade_service"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\njenkins\n\nFROM jenkins/jenkins:2.332.3\n\nUSER root\nRUN echo \'\' > /etc/apt/sources.list \\\n&& echo "deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye main contrib non-free" > /etc/apt/sources.list \\\n&& echo "deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-updates main contrib non-free" >> /etc/apt/sources.list \\\n&& echo "deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-backports main contrib non-free" >> /etc/apt/sources.list \\\n&& echo "deb http://mirrors.tuna.tsinghua.edu.cn/debian-security bullseye-security main contrib non-free" >> /etc/apt/sources.list \\\n&& apt update \\\n&& apt install sudo -y \\\n&& apt install vim -y \\\n&& apt install sshpass -y \\\n&& apt install python -y \\\n&& sed -i \'27a\\jenkins ALL=(ALL)       NOPASSWD:ALL\' /etc/sudoers \\\n&& apt install ansible -y\nUSER jenkins\nENV LANG C.UTF-8\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n',normalizedContent:'python\n\nfrom python:3.7-alpine\nworkdir /code\nenv flask_app=app.py\nenv flask_run_host=0.0.0.0\ncopy requirements.txt requirements.txt\nrun pip install -r requirements.txt\nexpose 5000\ncopy . .\ncmd ["flask", "run"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\nphp\n\nfrom php:7.2.34-fpm-alpine\nworkdir /app\nenv tz "asia/shanghai"\nrun sed -i "s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g" /etc/apk/repositories \\\n&& apk add --no-cache autoconf g++ libtool make curl-dev libxml2-dev linux-headers \\\n&& docker-php-ext-install -j 2 zip \\\n&& apk add --no-cache freetype-dev libjpeg-turbo-dev libpng-dev \\\n&& docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n&& docker-php-ext-install -j 2 gd \\\n&& docker-php-ext-install -j$(nproc) bcmath \\\n&& docker-php-ext-install -j 2 mysqli \\\n&& docker-php-ext-install pdo_mysql\ncopy . .\nrun chown -r www-data:www-data /app\nexpose 9000\nentrypoint ["php-fpm"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\ngo\n\nfrom golang:1.16.7-alpine3.13 as builder\n\nlabel stage=gobuilder\n\nenv cgo_enabled 0\nenv goos linux\nenv goproxy https://goproxy.cn,direct\narg version\narg git_commit\narg git_tree_state\narg build_date\n\nworkdir /build/zero\n\nadd go.mod .\nadd go.sum .\nrun go mod download\ncopy . .\nrun go build -ldflags="-s -w -x trade/common/version.gitversion=${version} -x trade/common/version.gitcommit=${git_commit} -x trade/common/version.gittreestate=${git_tree_state} -x trade/common/version.builddate=${build_date}" -o /app/backend api/backend/backend.go\n\n\nfrom alpine:3.13\nrun sed -i \'s/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g\' /etc/apk/repositories\nrun apk update --no-cache && apk add --no-cache ca-certificates tzdata\nenv tz asia/shanghai\n\nworkdir /app\ncopy --from=builder /app/backend /app/backend\ncopy --from=builder /build/zero/api/backend/etc /app/etc\n\nexpose 8888\n\ncmd ["./backend"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nnode\n\nfrom dh.1quant.me/library/node:8.15.0-alpine-i18n as builder\n\nlabel stage=h5builder\n\nworkdir /app\n\ncopy . .\n\nrun npm cache verify && npm i && npm run build\n\nfrom dh.1quant.me/library/nginx:1.14.2-alpine\n\ncopy --from=builder /app/dist /usr/share/nginx/html\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nc++\n\nfrom debian:buster\n\nenv tz asia/shanghai\n\nworkdir /app\nenv ld_library_path=/app/lib\n\ncopy . .\nrun ln -s libssl.so.1.0.2k ./lib/libssl.so.10 && ln -s libcrypto.so.1.0.2k ./lib/libcrypto.so.10\n\nexpose 9101\n\ncmd ["./bin/trade_service"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\njenkins\n\nfrom jenkins/jenkins:2.332.3\n\nuser root\nrun echo \'\' > /etc/apt/sources.list \\\n&& echo "deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye main contrib non-free" > /etc/apt/sources.list \\\n&& echo "deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-updates main contrib non-free" >> /etc/apt/sources.list \\\n&& echo "deb http://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-backports main contrib non-free" >> /etc/apt/sources.list \\\n&& echo "deb http://mirrors.tuna.tsinghua.edu.cn/debian-security bullseye-security main contrib non-free" >> /etc/apt/sources.list \\\n&& apt update \\\n&& apt install sudo -y \\\n&& apt install vim -y \\\n&& apt install sshpass -y \\\n&& apt install python -y \\\n&& sed -i \'27a\\jenkins all=(all)       nopasswd:all\' /etc/sudoers \\\n&& apt install ansible -y\nuser jenkins\nenv lang c.utf-8\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n',charsets:{}},{title:"åºäºå®æ¹php7.2.34éåæå»ºçäº§å¯ç¨éå",frontmatter:{title:"åºäºå®æ¹php7.2.34éåæå»ºçäº§å¯ç¨éå",date:"2023-01-30T20:21:15.000Z",permalink:"/pages/6e3cb9/",categories:["docker"],tags:[null],readingShow:"top",description:"Dockerhub ä¸ PHP å®æ¹åºç¡éåä¸»è¦åä¸ºä¸ä¸ªåæ¯ï¼",meta:[{name:"twitter:title",content:"åºäºå®æ¹php7.2.34éåæå»ºçäº§å¯ç¨éå"},{name:"twitter:description",content:"Dockerhub ä¸ PHP å®æ¹åºç¡éåä¸»è¦åä¸ºä¸ä¸ªåæ¯ï¼"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/10.docker/05.%E5%9F%BA%E4%BA%8E%E5%AE%98%E6%96%B9php7-2-34%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8%E9%95%9C%E5%83%8F.html"},{property:"og:type",content:"article"},{property:"og:title",content:"åºäºå®æ¹php7.2.34éåæå»ºçäº§å¯ç¨éå"},{property:"og:description",content:"Dockerhub ä¸ PHP å®æ¹åºç¡éåä¸»è¦åä¸ºä¸ä¸ªåæ¯ï¼"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/10.docker/05.%E5%9F%BA%E4%BA%8E%E5%AE%98%E6%96%B9php7-2-34%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8%E9%95%9C%E5%83%8F.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-30T20:21:15.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"åºäºå®æ¹php7.2.34éåæå»ºçäº§å¯ç¨éå"},{itemprop:"description",content:"Dockerhub ä¸ PHP å®æ¹åºç¡éåä¸»è¦åä¸ºä¸ä¸ªåæ¯ï¼"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/10.docker/05.%E5%9F%BA%E4%BA%8E%E5%AE%98%E6%96%B9php7-2-34%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E7%94%9F%E4%BA%A7%E5%8F%AF%E7%94%A8%E9%95%9C%E5%83%8F.html",relativePath:"04.è¿ç»´/10.docker/05.åºäºå®æ¹php7-2-34éåæå»ºçäº§å¯ç¨éå.md",key:"v-0f41bfdd",path:"/pages/6e3cb9/",headers:[{level:2,title:"1 äºè§£å®æ¹phpéå",slug:"_1-äºè§£å®æ¹phpéå",normalizedTitle:"1 äºè§£å®æ¹phpéå",charIndex:2},{level:2,title:"2 éæ±åæåéåéæ©",slug:"_2-éæ±åæåéåéæ©",normalizedTitle:"2 éæ±åæåéåéæ©",charIndex:511},{level:2,title:"3 æå»ºåå¤",slug:"_3-æå»ºåå¤",normalizedTitle:"3 æå»ºåå¤",charIndex:1562},{level:2,title:"4 åå»ºDockerfile",slug:"_4-åå»ºdockerfile",normalizedTitle:"4 åå»ºdockerfile",charIndex:2616},{level:2,title:"5 æ¨éå°Harboréåä»åº",slug:"_5-æ¨éå°harboréåä»åº",normalizedTitle:"5 æ¨éå°harboréåä»åº",charIndex:5560},{level:2,title:"6 åèèµæ",slug:"_6-åèèµæ",normalizedTitle:"6 åèèµæ",charIndex:6998}],headersStr:"1 äºè§£å®æ¹phpéå 2 éæ±åæåéåéæ© 3 æå»ºåå¤ 4 åå»ºDockerfile 5 æ¨éå°Harboréåä»åº 6 åèèµæ",content:'# 1 äºè§£å®æ¹phpéå\n\nDockerhub ä¸ PHP å®æ¹åºç¡éåä¸»è¦åä¸ºä¸ä¸ªåæ¯ï¼\n\n 1. cli: æ²¡æå¼å¯ CGI ä¹å°±æ¯è¯´ä¸è½è¿è¡fpmãåªå¯ä»¥è¿è¡å½ä»¤è¡ã\n\n 2. fpm: å¼å¯äºCGIï¼å¯ä»¥ç¨æ¥è¿è¡webæå¡ä¹å¯ä»¥ç¨æ¥è¿è¡cliå½ä»¤ã\n\n 3. zts: å¼å¯äºçº¿ç¨å®å¨ççæ¬ã\n\néæ©ä»ä¹åæ¯çéåï¼\n\nä¸è¬å¨çæç¯å¢ä¼ä½¿ç¨å°Â php-fpmãåäºè§£ä¸ä¸ä»ä¹æ¯php-fpmï¼\n\n * ç±äºnginxæ¬èº«ä¸è½å¤çPHPï¼å®åªæ¯ä¸ªwebæå¡å¨ï¼å½æ¥æ¶å°è¯·æ±åï¼å¦ææ¯phpè¯·æ±ï¼ååç»phpè§£éå¨å¤çï¼å¹¶æç»æè¿åç»å®¢æ·ç«¯ï¼\n\n * nginx ä¸è¬æ¯æè¯·æ±åfastcgiç®¡çè¿ç¨å¤çï¼fascgiç®¡çè¿ç¨éæ© CGI å­è¿ç¨å¤çç»æå¹¶è¿åè¢« nginx ï¼\n\n * PHP-FPM æ¯ä¸ä¸ªPHP FastCGIç®¡çå¨ï¼æ¨å¨å°FastCGIè¿ç¨ç®¡çæ´åè¿PHPåä¸­ï¼\n\n * PHP-FPMæä¾äºæ´å¥½çPHPè¿ç¨ç®¡çæ¹å¼ï¼å¯ä»¥æææ§å¶åå­åè¿ç¨ãå¯ä»¥å¹³æ»éè½½PHPéç½®ï¼æ¯spawn-fcgiå·ææ´å¤ä¼ç¹ï¼æä»¥è¢«PHPå®æ¹æ¶å½äºã\n\næä»¥ï¼LNMPæ¶æçä¸è¬ä¼éæ©Â fpmÂ åæ¯çéåã\n\n\n# 2 éæ±åæåéåéæ©\n\néåéæ©\n\né¦åæ¯åºç¡éåçæ¬çéæ©ï¼æè¿ééæ©çæ¯Â php:7.2.34-fpm-alpineÂ éåãphp çæ¬ä¸ºÂ 7.2.34Â ï¼phpçæ¬éè¦ç»åå·ä½ä¸å¡ä»£ç è¿è¡éæ©ï¼ï¼è¿ä¸ªå®æ¹éååºäºalpine éåè¿è¡æå»ºï¼alpineéåä½ç§¯éå¸¸å° ï¼å¤§å°åªæ5må·¦å³ã\n\néæ±åæ\n\nå¯¹äºphpåºç¨æ¥è¯´ï¼é½éè¦èªå·±é¢å¤å®è£ä¸äºæ©å±ãå®æ¹åºç¡éåçæ©å±ä¸è¬æ»¡è¶³ä¸æä»¬çéæ±ï¼æä»¥éè¦ççå®æ¹éåæåªäºæ©å±ï¼ç¶ååæéå®è£æä»¬è¦çæ©å±ã\n\næ¥çå®æ¹åºç¡éåæä»ä¹æ©å±ï¼\n\nshell\n\n[root@harbor harbor]# docker run php:7.2.34-fpm-alpine php -m\n\n[PHP Modules]\nCore\nctype\ncurl\ndate\ndom\nfileinfo\nfilter\nftp\nhash\niconv\njson\nlibxml\nmbstring\nmysqlnd\nopenssl\npcre\nPDO\npdo_sqlite\nPhar\nposix\nreadline\nReflection\nsession\nSimpleXML\nsodium\nSPL\nsqlite3\nstandard\ntokenizer\nxml\nxmlreader\nxmlwriter\nzlib\n[Zend Modules]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\nå®è£ç»éªï¼ä¸è¬éè¦é¢å¤å®è£çæ©å±ï¼\n\n * redisï¼redisæ¯ç®åä¸»æµçNosqlæ°æ®åºï¼å¸¸ç¨ã\n * zipï¼æä»¶åç¼©æ©å±ã\n * gdï¼å¾çå¤çæ©å±ï¼ä¸äºå¾å½¢éªè¯ç ççæä¸è½æ²¡æè¿ä¸ªæ©å±ã\n * bcmathï¼æ²¡æè¿ä¸ªåºçè¯å¯è½ä¸äºæ¡æ¶æèç±»åºçcomposerä¾èµæ ¡éªä¼æ æ³éè¿ã\n * pdo_mysqlï¼è¿æ¥æ°æ®åºæ©å±ã\n * opcacheï¼ æ¯ PHP ä¸­ç Zend æ©å±ï¼å¯ä»¥å¤§å¤§æå PHP çæ§è½ã\n * swooleï¼ä¸ä¸ªPHPé«çº§Webå¼åæ¡æ¶ï¼å¯æéæ·»å ã\n\né¤äºæ©å±ä¹å¤ï¼è¿å¯ä»¥å®è£ä¸ä¸ªphpçåç®¡çå·¥å·Â composerãcomposerÂ æ¯PHPçåç®¡çãåä¾èµå³ç³»ç®¡çå·¥å·ï¼æäºå®ï¼æä»¬å°±å¾è½»æ¾ä¸ä¸ªå½ä»¤å°±å¯ä»¥æä»äººä¼ç§çä»£ç ç¨å°æä»¬çé¡¹ç®ä¸­æ¥ï¼èä¸å¾å®¹æç®¡çä¾èµå³ç³»ï¼æ´æ°å é¤ç­æä½ä¹å¾è½»æçå®ç°ã\n\n\n# 3 æå»ºåå¤\n\n 1. åå»ºå·¥ç¨ç®å½\n\n[root@harbor ~]# mkdir lnmp/php -p\n[root@harbor ~]# cd lnmp/php/\n\n\n1\n2\n\n 2. åå¤Â composerÂ åï¼æ¾å¨å·¥ç¨ç®å½ä¸ï¼ä¸è½½é¾æ¥ï¼Releases Â· composer/composer Â· GitHub\n\n[root@harbor php]# wget https://github.com/composer/composer/releases/download/2.0.13/composer.phar\n\n\n1\n\n 3. åå¤Â date.iniÂ æä»¶ï¼è®¾ç½®PHPé»è®¤æ¶åºä¸ºä¸å«åºï¼\n\n[root@harbor php]# mkdir conf.d\n[root@harbor php]# echo "date.timezone = Asia/Shanghai" > conf.d/date.ini\n\n\n1\n2\n\n 4. åå¤Â opcode.iniÂ æä»¶ï¼ç¨äºè®¾ç½®opcodeé»è®¤çåæ°ï¼å¹¶ä¸è®¾ç½®ç¯å¢åéÂ OPCODEÂ ä»¥æ§å¶å¶æ¯å¦è¢«å¼å¯ãå½ç¯å¢åéOPCODEçå¼è¢«è®¾ç½®ä¸º1çæ¶åè¡¨ç¤ºå¼å¯opcodeï¼0åå³é­ã\n\n# è¿éå  \\EOF æ¯é²æ­¢${OPCODE}è¢«è½¬ä¹\n[root@harbor php]# cat >> conf.d/opcode.ini << \\EOF\n> opcache.enable=${OPCODE}\n> enable_clopcache.enable_cli=1\n> opcache.revalidate_freq=60\n> opcache.max_accelerated_files=100000\n> opcache.validate_timestamps=1\n> EOF\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n 5. åå¤Â php-fpm.confÂ æä»¶\n\n[root@harbor php]# cat www.conf \n[www]\nuser = www\ngroup = www\nlisten = 0.0.0.0:9000\npm = dynamic\npm.max_children = 100\npm.start_servers = 30\npm.min_spare_servers = 20\npm.max_spare_servers = 50\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nåå¤å·¥ä½å®æï¼æ¥ä¸æ¥åå»ºDockerfileè¿è¡æå»ºã\n\n\n# 4 åå»ºDockerfile\n\n[root@harbor php]# touch Dockerfile\n\n\n1\n\n\nDockerfileæä»¶åå®¹å¦ä¸ï¼\n\nFROM php:7.2.34-fpm-alpine\nLABEL MAINTAINER="syushin moliyoyoyo@163.com"\nENV TZ "Asia/Shanghai"\nENV TERM xterm\n# é»è®¤å³é­opcode\nENV OPCODE 0\n\nCOPY ./conf.d/ $PHP_INI_DIR/conf.d/\nCOPY composer.phar /usr/local/bin/composer\nCOPY www.conf /usr/local/etc/php-fpm.d/www.conf\n# åå»ºwwwç¨æ·\nRUN addgroup -g 1000 -S www && adduser -s /sbin/nologin -S -D -u 1000 -G www www\n# éç½®é¿éäºéåæºï¼å å¿«æå»ºéåº¦\nRUN sed -i "s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g" /etc/apk/repositories\n\n# PHPIZE_DEPS åå« gcc g++ ç­ç¼è¯è¾å©ç±»åºï¼å®æç¼è¯åå é¤\nRUN apk add --no-cache $PHPIZE_DEPS \\\n    && apk add --no-cache libstdc++ libzip-dev vim\\\n    && apk update \\\n    && pecl install redis-5.3.4 \\\n    && pecl install zip \\\n    && pecl install swoole \\\n    && docker-php-ext-enable redis zip swoole\\\n    && apk del $PHPIZE_DEPS\n# docker-php-ext-install æä»¤å·²ç»åå«ç¼è¯è¾å©ç±»åºçå é¤é»è¾\nRUN apk add --no-cache freetype libpng libjpeg-turbo freetype-dev libpng-dev libjpeg-turbo-dev \\\n    && apk update \\\n    && docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ --with-png-dir=/usr/include/ \\\n    && docker-php-ext-install -j$(nproc) gd \\\n    && docker-php-ext-install -j$(nproc) pdo_mysql \\\n    && docker-php-ext-install -j$(nproc) opcache \\\n    && docker-php-ext-install -j$(nproc) bcmath \\\n    && docker-php-ext-install -j$(nproc) mysqli \\\n    && chmod +x /usr/local/bin/composer\n\nRUN mv "$PHP_INI_DIR/php.ini-production" "$PHP_INI_DIR/php.ini"\nEXPOSE 9000\nENTRYPOINT ["php-fpm"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n\n\nè¯´æï¼\n\n * PHP_INI_DIRÂ : è¿ä¸ªç¯å¢åéçå®ä¹å¨phpåºç¡éåçDockerfileæå®ä¹ï¼åéå¼æ¯Â /usr/local/etc/php\n * PHPIZE_DEPSÂ ï¼è¿ä¸ªä¹æ¯å®ä¹å¨åºç¡éåDockerfileä¸­ï¼åå«äºæ©å±ç¼è¯å®è£æ¶éè¦ä½æ¯phpè¿è¡ä¸éè¦çlinuxè½¯ä»¶åºãæä»¬éè¦æå®ä»¬æéåºæ¥ï¼å¨ç¼è¯å®æ©å±ä¹åå é¤ãåéå¼ï¼Â autoconf dpkg-dev dpkg\n * php-fpm.confÂ éç½®æä»¶å¨Â /usr/local/etc/Â ç®å½ä¸\n * www.confÂ éç½®æä»¶å¨Â /usr/local/etc/php-fpm.dÂ ç®å½ä¸\n\nå¯ä»¥ç¼åä¸ä¸ªèæ¬è¿è¡æå»ºï¼å¥½å¤æ¯ä»¥åå¯ä»¥éè¿æ¥çèæ¬ç¥éåªä¸ªæ ç­¾çéåæ¯æ­¤æ¬¡æå»ºçã\n\n[root@harbor php]# cat build-command.sh \n#!/bin/bash\ndocker build -t php-7.2.34-fpm-alpine:v1 .\n\n\n1\n2\n3\n\n\næ§è¡æå»º\n\n[root@harbor php]# sh build-command.sh \n\n\n1\n\n\nç¨ç­æ¶é´å³å¯çå°æå»ºå®æ\n\n# ç¼è¯å®æåï¼éåä½ç§¯æ¯160m\n[root@harbor php]# docker images\nREPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE\nphp-7.2.34-fpm-alpine         v1                  fb3d05761dfa        2 hours ago         160MB\n\n# æ£æ¥æ©å±\n[root@harbor php]# docker run php-7.2.34-fpm-alpine:v1 php -m\n[PHP Modules]\nbcmath\nCore\nctype\ncurl\ndate\ndom\nfileinfo\nfilter\nftp\ngd\nhash\niconv\njson\nlibxml\nmbstring\nmysqlnd\nopenssl\npcre\nPDO\npdo_mysql\npdo_sqlite\nPhar\nposix\nreadline\nredis\nReflection\nsession\nSimpleXML\nsodium\nSPL\nsqlite3\nstandard\nswoole\ntokenizer\nxml\nxmlreader\nxmlwriter\nZend OPcache\nzip\nzlib\n\n[Zend Modules]\nZend OPcache\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n\n\nè¿æ ·ï¼ä¸ä¸ªéåå°±æå»ºå®æäºã\n\n\n# 5 æ¨éå°Harboréåä»åº\n\nä¸è¬å¨ä¼ä¸ï¼èªå·±æå»ºå¥½éååï¼éè¦æ¨éå°èªå·±çç§æä»åºãæè¿éæ¬å°æä¸ªharborçç§æä»åºï¼ä»åºå°åï¼http://192.168.18.100\n\nå¹¶ä¸ä»åºä¸é¢æä¸ªé¡¹ç®å«Â lnmpï¼å­æ¾ç¸å³éåã\n\nå°ä¸é¢æå»ºçéåæ¨éå°harborä»åºï¼\n\n# Dockerç»å½ä»åº\n[root@harbor php]# docker login 192.168.18.100:80\nAuthenticating with existing credentials...\nWARNING! Your password will be stored unencrypted in /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\n\n# ç»éåææ ç­¾\n[root@harbor php]# docker tag php-7.2.34-fpm-alpine:v1 192.168.18.100:80/lnmp/myphp:7.2\n\n# ä¸ä¼ éå\n[root@harbor php]# docker push 192.168.18.100:80/lnmp/myphp:7.2\nThe push refers to repository [192.168.18.100:80/lnmp/myphp]\n7dfdf785728d: Pushed \n3ec4258bee2c: Pushed \nf01174c9f645: Pushing [================>                                  ]  24.29MB/73.92MB\nc21c6905870c: Pushed \n752870d17619: Pushed \n0e7d6edc15aa: Pushed \nc9685eb5cbc9: Pushed \ne07b1aa3ce21: Pushed \n69e56c02a5f3: Pushed \n5ce5d9de209b: Pushed \nee81ef73796d: Pushed \n738a430a6dab: Pushing [==============>                                    ]  15.51MB/53.39MB\n7d12c6e1d8f1: Pushing [==================================================>]  4.096kB\nbe80e727dd27: Waiting \n24e52497c24f: Waiting \n86d905c1f58e: Waiting \n22573737ba76: Waiting \n777b2c648970: Waiting \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nç­å¾æ¨éå®æï¼å³å¯çå°ä»åºä¸å·²ç»æè¯¥éåäºã\n\n\n# 6 åèèµæ\n\n * å¶ä½ä¸ä¸ªçäº§ç¯å¢å¯ç¨çPHPåºç¡éå æ³é»çæ¥å\n * Dockerhub å®æ¹phpéå\n * Alpine ç³»ç»ç®ä»\n\nåæé¾æ¥ï¼Â åºäºå®æ¹php:7.2.34-fpm-alpineéåæå»ºçäº§å¯ç¨éå - syushin - åå®¢å­',normalizedContent:'# 1 äºè§£å®æ¹phpéå\n\ndockerhub ä¸ php å®æ¹åºç¡éåä¸»è¦åä¸ºä¸ä¸ªåæ¯ï¼\n\n 1. cli: æ²¡æå¼å¯ cgi ä¹å°±æ¯è¯´ä¸è½è¿è¡fpmãåªå¯ä»¥è¿è¡å½ä»¤è¡ã\n\n 2. fpm: å¼å¯äºcgiï¼å¯ä»¥ç¨æ¥è¿è¡webæå¡ä¹å¯ä»¥ç¨æ¥è¿è¡cliå½ä»¤ã\n\n 3. zts: å¼å¯äºçº¿ç¨å®å¨ççæ¬ã\n\néæ©ä»ä¹åæ¯çéåï¼\n\nä¸è¬å¨çæç¯å¢ä¼ä½¿ç¨å°Â php-fpmãåäºè§£ä¸ä¸ä»ä¹æ¯php-fpmï¼\n\n * ç±äºnginxæ¬èº«ä¸è½å¤çphpï¼å®åªæ¯ä¸ªwebæå¡å¨ï¼å½æ¥æ¶å°è¯·æ±åï¼å¦ææ¯phpè¯·æ±ï¼ååç»phpè§£éå¨å¤çï¼å¹¶æç»æè¿åç»å®¢æ·ç«¯ï¼\n\n * nginx ä¸è¬æ¯æè¯·æ±åfastcgiç®¡çè¿ç¨å¤çï¼fascgiç®¡çè¿ç¨éæ© cgi å­è¿ç¨å¤çç»æå¹¶è¿åè¢« nginx ï¼\n\n * php-fpm æ¯ä¸ä¸ªphp fastcgiç®¡çå¨ï¼æ¨å¨å°fastcgiè¿ç¨ç®¡çæ´åè¿phpåä¸­ï¼\n\n * php-fpmæä¾äºæ´å¥½çphpè¿ç¨ç®¡çæ¹å¼ï¼å¯ä»¥æææ§å¶åå­åè¿ç¨ãå¯ä»¥å¹³æ»éè½½phpéç½®ï¼æ¯spawn-fcgiå·ææ´å¤ä¼ç¹ï¼æä»¥è¢«phpå®æ¹æ¶å½äºã\n\næä»¥ï¼lnmpæ¶æçä¸è¬ä¼éæ©Â fpmÂ åæ¯çéåã\n\n\n# 2 éæ±åæåéåéæ©\n\néåéæ©\n\né¦åæ¯åºç¡éåçæ¬çéæ©ï¼æè¿ééæ©çæ¯Â php:7.2.34-fpm-alpineÂ éåãphp çæ¬ä¸ºÂ 7.2.34Â ï¼phpçæ¬éè¦ç»åå·ä½ä¸å¡ä»£ç è¿è¡éæ©ï¼ï¼è¿ä¸ªå®æ¹éååºäºalpine éåè¿è¡æå»ºï¼alpineéåä½ç§¯éå¸¸å° ï¼å¤§å°åªæ5må·¦å³ã\n\néæ±åæ\n\nå¯¹äºphpåºç¨æ¥è¯´ï¼é½éè¦èªå·±é¢å¤å®è£ä¸äºæ©å±ãå®æ¹åºç¡éåçæ©å±ä¸è¬æ»¡è¶³ä¸æä»¬çéæ±ï¼æä»¥éè¦ççå®æ¹éåæåªäºæ©å±ï¼ç¶ååæéå®è£æä»¬è¦çæ©å±ã\n\næ¥çå®æ¹åºç¡éåæä»ä¹æ©å±ï¼\n\nshell\n\n[root@harbor harbor]# docker run php:7.2.34-fpm-alpine php -m\n\n[php modules]\ncore\nctype\ncurl\ndate\ndom\nfileinfo\nfilter\nftp\nhash\niconv\njson\nlibxml\nmbstring\nmysqlnd\nopenssl\npcre\npdo\npdo_sqlite\nphar\nposix\nreadline\nreflection\nsession\nsimplexml\nsodium\nspl\nsqlite3\nstandard\ntokenizer\nxml\nxmlreader\nxmlwriter\nzlib\n[zend modules]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n\n\nå®è£ç»éªï¼ä¸è¬éè¦é¢å¤å®è£çæ©å±ï¼\n\n * redisï¼redisæ¯ç®åä¸»æµçnosqlæ°æ®åºï¼å¸¸ç¨ã\n * zipï¼æä»¶åç¼©æ©å±ã\n * gdï¼å¾çå¤çæ©å±ï¼ä¸äºå¾å½¢éªè¯ç ççæä¸è½æ²¡æè¿ä¸ªæ©å±ã\n * bcmathï¼æ²¡æè¿ä¸ªåºçè¯å¯è½ä¸äºæ¡æ¶æèç±»åºçcomposerä¾èµæ ¡éªä¼æ æ³éè¿ã\n * pdo_mysqlï¼è¿æ¥æ°æ®åºæ©å±ã\n * opcacheï¼ æ¯ php ä¸­ç zend æ©å±ï¼å¯ä»¥å¤§å¤§æå php çæ§è½ã\n * swooleï¼ä¸ä¸ªphpé«çº§webå¼åæ¡æ¶ï¼å¯æéæ·»å ã\n\né¤äºæ©å±ä¹å¤ï¼è¿å¯ä»¥å®è£ä¸ä¸ªphpçåç®¡çå·¥å·Â composerãcomposerÂ æ¯phpçåç®¡çãåä¾èµå³ç³»ç®¡çå·¥å·ï¼æäºå®ï¼æä»¬å°±å¾è½»æ¾ä¸ä¸ªå½ä»¤å°±å¯ä»¥æä»äººä¼ç§çä»£ç ç¨å°æä»¬çé¡¹ç®ä¸­æ¥ï¼èä¸å¾å®¹æç®¡çä¾èµå³ç³»ï¼æ´æ°å é¤ç­æä½ä¹å¾è½»æçå®ç°ã\n\n\n# 3 æå»ºåå¤\n\n 1. åå»ºå·¥ç¨ç®å½\n\n[root@harbor ~]# mkdir lnmp/php -p\n[root@harbor ~]# cd lnmp/php/\n\n\n1\n2\n\n 2. åå¤Â composerÂ åï¼æ¾å¨å·¥ç¨ç®å½ä¸ï¼ä¸è½½é¾æ¥ï¼releases Â· composer/composer Â· github\n\n[root@harbor php]# wget https://github.com/composer/composer/releases/download/2.0.13/composer.phar\n\n\n1\n\n 3. åå¤Â date.iniÂ æä»¶ï¼è®¾ç½®phpé»è®¤æ¶åºä¸ºä¸å«åºï¼\n\n[root@harbor php]# mkdir conf.d\n[root@harbor php]# echo "date.timezone = asia/shanghai" > conf.d/date.ini\n\n\n1\n2\n\n 4. åå¤Â opcode.iniÂ æä»¶ï¼ç¨äºè®¾ç½®opcodeé»è®¤çåæ°ï¼å¹¶ä¸è®¾ç½®ç¯å¢åéÂ opcodeÂ ä»¥æ§å¶å¶æ¯å¦è¢«å¼å¯ãå½ç¯å¢åéopcodeçå¼è¢«è®¾ç½®ä¸º1çæ¶åè¡¨ç¤ºå¼å¯opcodeï¼0åå³é­ã\n\n# è¿éå  \\eof æ¯é²æ­¢${opcode}è¢«è½¬ä¹\n[root@harbor php]# cat >> conf.d/opcode.ini << \\eof\n> opcache.enable=${opcode}\n> enable_clopcache.enable_cli=1\n> opcache.revalidate_freq=60\n> opcache.max_accelerated_files=100000\n> opcache.validate_timestamps=1\n> eof\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n 5. åå¤Â php-fpm.confÂ æä»¶\n\n[root@harbor php]# cat www.conf \n[www]\nuser = www\ngroup = www\nlisten = 0.0.0.0:9000\npm = dynamic\npm.max_children = 100\npm.start_servers = 30\npm.min_spare_servers = 20\npm.max_spare_servers = 50\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nåå¤å·¥ä½å®æï¼æ¥ä¸æ¥åå»ºdockerfileè¿è¡æå»ºã\n\n\n# 4 åå»ºdockerfile\n\n[root@harbor php]# touch dockerfile\n\n\n1\n\n\ndockerfileæä»¶åå®¹å¦ä¸ï¼\n\nfrom php:7.2.34-fpm-alpine\nlabel maintainer="syushin moliyoyoyo@163.com"\nenv tz "asia/shanghai"\nenv term xterm\n# é»è®¤å³é­opcode\nenv opcode 0\n\ncopy ./conf.d/ $php_ini_dir/conf.d/\ncopy composer.phar /usr/local/bin/composer\ncopy www.conf /usr/local/etc/php-fpm.d/www.conf\n# åå»ºwwwç¨æ·\nrun addgroup -g 1000 -s www && adduser -s /sbin/nologin -s -d -u 1000 -g www www\n# éç½®é¿éäºéåæºï¼å å¿«æå»ºéåº¦\nrun sed -i "s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g" /etc/apk/repositories\n\n# phpize_deps åå« gcc g++ ç­ç¼è¯è¾å©ç±»åºï¼å®æç¼è¯åå é¤\nrun apk add --no-cache $phpize_deps \\\n    && apk add --no-cache libstdc++ libzip-dev vim\\\n    && apk update \\\n    && pecl install redis-5.3.4 \\\n    && pecl install zip \\\n    && pecl install swoole \\\n    && docker-php-ext-enable redis zip swoole\\\n    && apk del $phpize_deps\n# docker-php-ext-install æä»¤å·²ç»åå«ç¼è¯è¾å©ç±»åºçå é¤é»è¾\nrun apk add --no-cache freetype libpng libjpeg-turbo freetype-dev libpng-dev libjpeg-turbo-dev \\\n    && apk update \\\n    && docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ --with-png-dir=/usr/include/ \\\n    && docker-php-ext-install -j$(nproc) gd \\\n    && docker-php-ext-install -j$(nproc) pdo_mysql \\\n    && docker-php-ext-install -j$(nproc) opcache \\\n    && docker-php-ext-install -j$(nproc) bcmath \\\n    && docker-php-ext-install -j$(nproc) mysqli \\\n    && chmod +x /usr/local/bin/composer\n\nrun mv "$php_ini_dir/php.ini-production" "$php_ini_dir/php.ini"\nexpose 9000\nentrypoint ["php-fpm"]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n\n\nè¯´æï¼\n\n * php_ini_dirÂ : è¿ä¸ªç¯å¢åéçå®ä¹å¨phpåºç¡éåçdockerfileæå®ä¹ï¼åéå¼æ¯Â /usr/local/etc/php\n * phpize_depsÂ ï¼è¿ä¸ªä¹æ¯å®ä¹å¨åºç¡éådockerfileä¸­ï¼åå«äºæ©å±ç¼è¯å®è£æ¶éè¦ä½æ¯phpè¿è¡ä¸éè¦çlinuxè½¯ä»¶åºãæä»¬éè¦æå®ä»¬æéåºæ¥ï¼å¨ç¼è¯å®æ©å±ä¹åå é¤ãåéå¼ï¼Â autoconf dpkg-dev dpkg\n * php-fpm.confÂ éç½®æä»¶å¨Â /usr/local/etc/Â ç®å½ä¸\n * www.confÂ éç½®æä»¶å¨Â /usr/local/etc/php-fpm.dÂ ç®å½ä¸\n\nå¯ä»¥ç¼åä¸ä¸ªèæ¬è¿è¡æå»ºï¼å¥½å¤æ¯ä»¥åå¯ä»¥éè¿æ¥çèæ¬ç¥éåªä¸ªæ ç­¾çéåæ¯æ­¤æ¬¡æå»ºçã\n\n[root@harbor php]# cat build-command.sh \n#!/bin/bash\ndocker build -t php-7.2.34-fpm-alpine:v1 .\n\n\n1\n2\n3\n\n\næ§è¡æå»º\n\n[root@harbor php]# sh build-command.sh \n\n\n1\n\n\nç¨ç­æ¶é´å³å¯çå°æå»ºå®æ\n\n# ç¼è¯å®æåï¼éåä½ç§¯æ¯160m\n[root@harbor php]# docker images\nrepository                    tag                 image id            created             size\nphp-7.2.34-fpm-alpine         v1                  fb3d05761dfa        2 hours ago         160mb\n\n# æ£æ¥æ©å±\n[root@harbor php]# docker run php-7.2.34-fpm-alpine:v1 php -m\n[php modules]\nbcmath\ncore\nctype\ncurl\ndate\ndom\nfileinfo\nfilter\nftp\ngd\nhash\niconv\njson\nlibxml\nmbstring\nmysqlnd\nopenssl\npcre\npdo\npdo_mysql\npdo_sqlite\nphar\nposix\nreadline\nredis\nreflection\nsession\nsimplexml\nsodium\nspl\nsqlite3\nstandard\nswoole\ntokenizer\nxml\nxmlreader\nxmlwriter\nzend opcache\nzip\nzlib\n\n[zend modules]\nzend opcache\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n\n\nè¿æ ·ï¼ä¸ä¸ªéåå°±æå»ºå®æäºã\n\n\n# 5 æ¨éå°harboréåä»åº\n\nä¸è¬å¨ä¼ä¸ï¼èªå·±æå»ºå¥½éååï¼éè¦æ¨éå°èªå·±çç§æä»åºãæè¿éæ¬å°æä¸ªharborçç§æä»åºï¼ä»åºå°åï¼http://192.168.18.100\n\nå¹¶ä¸ä»åºä¸é¢æä¸ªé¡¹ç®å«Â lnmpï¼å­æ¾ç¸å³éåã\n\nå°ä¸é¢æå»ºçéåæ¨éå°harborä»åºï¼\n\n# dockerç»å½ä»åº\n[root@harbor php]# docker login 192.168.18.100:80\nauthenticating with existing credentials...\nwarning! your password will be stored unencrypted in /root/.docker/config.json.\nconfigure a credential helper to remove this warning. see\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nlogin succeeded\n\n# ç»éåææ ç­¾\n[root@harbor php]# docker tag php-7.2.34-fpm-alpine:v1 192.168.18.100:80/lnmp/myphp:7.2\n\n# ä¸ä¼ éå\n[root@harbor php]# docker push 192.168.18.100:80/lnmp/myphp:7.2\nthe push refers to repository [192.168.18.100:80/lnmp/myphp]\n7dfdf785728d: pushed \n3ec4258bee2c: pushed \nf01174c9f645: pushing [================>                                  ]  24.29mb/73.92mb\nc21c6905870c: pushed \n752870d17619: pushed \n0e7d6edc15aa: pushed \nc9685eb5cbc9: pushed \ne07b1aa3ce21: pushed \n69e56c02a5f3: pushed \n5ce5d9de209b: pushed \nee81ef73796d: pushed \n738a430a6dab: pushing [==============>                                    ]  15.51mb/53.39mb\n7d12c6e1d8f1: pushing [==================================================>]  4.096kb\nbe80e727dd27: waiting \n24e52497c24f: waiting \n86d905c1f58e: waiting \n22573737ba76: waiting \n777b2c648970: waiting \n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nç­å¾æ¨éå®æï¼å³å¯çå°ä»åºä¸å·²ç»æè¯¥éåäºã\n\n\n# 6 åèèµæ\n\n * å¶ä½ä¸ä¸ªçäº§ç¯å¢å¯ç¨çphpåºç¡éå æ³é»çæ¥å\n * dockerhub å®æ¹phpéå\n * alpine ç³»ç»ç®ä»\n\nåæé¾æ¥ï¼Â åºäºå®æ¹php:7.2.34-fpm-alpineéåæå»ºçäº§å¯ç¨éå - syushin - åå®¢å­',charsets:{cjk:!0}},{title:"debianä¸­ç§å¤§æ¿æ¢æç¨",frontmatter:{title:"debianä¸­ç§å¤§æ¿æ¢æç¨",date:"2022-12-15T18:58:50.000Z",permalink:"/pages/767641/",categories:["è¿ç»´","éåæº"],tags:[null],readingShow:"top",description:"è­¦å",meta:[{name:"twitter:title",content:"debianä¸­ç§å¤§æ¿æ¢æç¨"},{name:"twitter:description",content:"è­¦å"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/11.other/01.debian%E4%B8%AD%E7%A7%91%E5%A4%A7%E6%9B%BF%E6%8D%A2%E6%95%99%E7%A8%8B.html"},{property:"og:type",content:"article"},{property:"og:title",content:"debianä¸­ç§å¤§æ¿æ¢æç¨"},{property:"og:description",content:"è­¦å"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/11.other/01.debian%E4%B8%AD%E7%A7%91%E5%A4%A7%E6%9B%BF%E6%8D%A2%E6%95%99%E7%A8%8B.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T18:58:50.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"debianä¸­ç§å¤§æ¿æ¢æç¨"},{itemprop:"description",content:"è­¦å"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/11.other/01.debian%E4%B8%AD%E7%A7%91%E5%A4%A7%E6%9B%BF%E6%8D%A2%E6%95%99%E7%A8%8B.html",relativePath:"04.è¿ç»´/11.other/01.debianä¸­ç§å¤§æ¿æ¢æç¨.md",key:"v-28471c42",path:"/pages/767641/",headers:[{level:2,title:"å½ä»¤å®è£",slug:"å½ä»¤å®è£",normalizedTitle:"å½ä»¤å®è£",charIndex:1031}],headersStr:"å½ä»¤å®è£",content:"è­¦å\n\næä½åè¯·åå¥½ç¸åºå¤ä»½\n\nä¸è¬æåµä¸ï¼å° /etc/apt/sources.list æä»¶ä¸­ Debian é»è®¤çæºå°åÂ http://deb.debian.org/Â æ¿æ¢ä¸ºÂ http://mirrors.ustc.edu.cnÂ å³å¯ã\n\nå¯ä»¥ä½¿ç¨å¦ä¸å½ä»¤ï¼\n\nsudo sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list\n\nå½ç¶ä¹å¯ä»¥ç´æ¥ç¼è¾ /etc/apt/sources.list æä»¶ï¼éè¦ä½¿ç¨ sudoï¼ãä»¥ä¸æ¯ Debian Stable åèéç½®åå®¹ï¼\n\ndeb http://mirrors.ustc.edu.cn/debian stable main contrib non-free # deb-src http://mirrors.ustc.edu.cn/debian stable main contrib non-free deb http://mirrors.ustc.edu.cn/debian stable-updates main contrib non-free # deb-src http://mirrors.ustc.edu.cn/debian stable-updates main contrib non-free # deb http://mirrors.ustc.edu.cn/debian stable-proposed-updates main contrib non-free # deb-src http://mirrors.ustc.edu.cn/debian stable-proposed-updates main contrib non-free\n\nåæ¶ä½ ä¹å¯è½éè¦æ´æ¹ Debian Security æºï¼è¯·åè Debian Security æºä½¿ç¨å¸®å©\n\nsed -i 's/security.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list\n\næ´æ¹å® sources.list æä»¶åè¯·è¿è¡Â sudo apt-get updateÂ æ´æ°ç´¢å¼ä»¥çæã\n\nå°æå·§\n\nä½¿ç¨ HTTPS å¯ä»¥ææé¿åå½åè¿è¥åçç¼å­å«æï¼ä½éè¦äºåå®è£ apt-transport-https (Debian Buster åä»¥ä¸çæ¬ä¸éè¦)ã\n\n\n# å½ä»¤å®è£\n\nubuntu å®¹å¨å®è£ping ifconfig ipå½ä»¤\nè¿å¥å®¹å¨æµè¯ifconfig  ping æ²¡æ--------\x3e>å¾å°´å°¬\napt-get install net-tools\n###   ifconfig\napt-get install iputils-ping\n###  ping\napt-get install iproute2\n####  ip\ncentoså®è£ping\nyum install -y iputils\n\nå®è£pså½ä»¤\napt-get update\napt-get  install  procps\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n",normalizedContent:"è­¦å\n\næä½åè¯·åå¥½ç¸åºå¤ä»½\n\nä¸è¬æåµä¸ï¼å° /etc/apt/sources.list æä»¶ä¸­ debian é»è®¤çæºå°åÂ http://deb.debian.org/Â æ¿æ¢ä¸ºÂ http://mirrors.ustc.edu.cnÂ å³å¯ã\n\nå¯ä»¥ä½¿ç¨å¦ä¸å½ä»¤ï¼\n\nsudo sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list\n\nå½ç¶ä¹å¯ä»¥ç´æ¥ç¼è¾ /etc/apt/sources.list æä»¶ï¼éè¦ä½¿ç¨ sudoï¼ãä»¥ä¸æ¯ debian stable åèéç½®åå®¹ï¼\n\ndeb http://mirrors.ustc.edu.cn/debian stable main contrib non-free # deb-src http://mirrors.ustc.edu.cn/debian stable main contrib non-free deb http://mirrors.ustc.edu.cn/debian stable-updates main contrib non-free # deb-src http://mirrors.ustc.edu.cn/debian stable-updates main contrib non-free # deb http://mirrors.ustc.edu.cn/debian stable-proposed-updates main contrib non-free # deb-src http://mirrors.ustc.edu.cn/debian stable-proposed-updates main contrib non-free\n\nåæ¶ä½ ä¹å¯è½éè¦æ´æ¹ debian security æºï¼è¯·åè debian security æºä½¿ç¨å¸®å©\n\nsed -i 's/security.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list\n\næ´æ¹å® sources.list æä»¶åè¯·è¿è¡Â sudo apt-get updateÂ æ´æ°ç´¢å¼ä»¥çæã\n\nå°æå·§\n\nä½¿ç¨ https å¯ä»¥ææé¿åå½åè¿è¥åçç¼å­å«æï¼ä½éè¦äºåå®è£ apt-transport-https (debian buster åä»¥ä¸çæ¬ä¸éè¦)ã\n\n\n# å½ä»¤å®è£\n\nubuntu å®¹å¨å®è£ping ifconfig ipå½ä»¤\nè¿å¥å®¹å¨æµè¯ifconfig  ping æ²¡æ--------\x3e>å¾å°´å°¬\napt-get install net-tools\n###   ifconfig\napt-get install iputils-ping\n###  ping\napt-get install iproute2\n####  ip\ncentoså®è£ping\nyum install -y iputils\n\nå®è£pså½ä»¤\napt-get update\napt-get  install  procps\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n",charsets:{cjk:!0}},{title:"Alpineå®è£phpåç§æ©å±",frontmatter:{title:"Alpineå®è£phpåç§æ©å±",date:"2023-01-30T20:43:25.000Z",permalink:"/pages/aa9eee/",categories:["è¿ç»´","ä¸­é´ä»¶"],tags:[null],readingShow:"top",description:"è¯¦ç»å¦ä¸",meta:[{name:"twitter:title",content:"Alpineå®è£phpåç§æ©å±"},{name:"twitter:description",content:"è¯¦ç»å¦ä¸"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/11.other/02.Alpine%E5%AE%89%E8%A3%85php%E5%90%84%E7%A7%8D%E6%89%A9%E5%B1%95.html"},{property:"og:type",content:"article"},{property:"og:title",content:"Alpineå®è£phpåç§æ©å±"},{property:"og:description",content:"è¯¦ç»å¦ä¸"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/11.other/02.Alpine%E5%AE%89%E8%A3%85php%E5%90%84%E7%A7%8D%E6%89%A9%E5%B1%95.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-30T20:43:25.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"Alpineå®è£phpåç§æ©å±"},{itemprop:"description",content:"è¯¦ç»å¦ä¸"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/11.other/02.Alpine%E5%AE%89%E8%A3%85php%E5%90%84%E7%A7%8D%E6%89%A9%E5%B1%95.html",relativePath:"04.è¿ç»´/11.other/02.Alpineå®è£phpåç§æ©å±.md",key:"v-2e1ddaa3",path:"/pages/aa9eee/",headersStr:null,content:'è¯¦ç»å¦ä¸\n\n#!/bin/sh\n\nsed -i "s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g" /etc/apk/repositories\n\napk add --no-cache autoconf g++ libtool make curl-dev libxml2-dev linux-headers\n\necho "---------- Install mcrypt ----------"\napk add --no-cache libmcrypt-dev\ndocker-php-ext-install mcrypt\n\nech "---------- Install pdo_mysql ----------"\ndocker-php-ext-install -j 2 pdo_mysql\n\necho "---------- Install zip ----------"\ndocker-php-ext-install -j 2 zip\n\necho "---------- Install pcntl ----------"\ndocker-php-ext-install -j 2 pcntl\n\n\necho "---------- Install mysqli ----------"\ndocker-php-ext-install -j 2 mysqli\n\n\necho "---------- Install mbstring ----------"\ndocker-php-ext-install -j 2 mbstring\n\necho "---------- Install exif ----------"\ndocker-php-ext-install -j 2 exif\n\necho "---------- Install calendar ----------"\ndocker-php-ext-install -j 2 calendar\n\necho "---------- Install sockets ----------"\ndocker-php-ext-install -j 2 sockets\n\necho "---------- Install gettext ----------"\napk add --no-cache gettext-dev\ndocker-php-ext-install -j 2 gettext\n\necho "---------- Install shmop ----------"\ndocker-php-ext-install -j 2 shmop\n\necho "---------- Install bz2 ----------"\napk add --no-cache bzip2-dev\ndocker-php-ext-install -j 2 bz2\n\necho "---------- Install xsl ----------"\napk add --no-cache libxslt-dev\ndocker-php-ext-install -j 2 xsl\n\necho "---------- Install wddx ----------"\napk add --no-cache libxslt-dev\nocker-php-ext-install -j 2 wddx\n\necho "---------- Install curl ----------"\ndocker-php-ext-install -j 2 curl\n\necho "---------- Install mysql ----------"\ndocker-php-ext-install -j 2 mysql\n\necho "---------- Install wddx ----------"\ndocker-php-ext-install -j 2 wddx\n\necho "---------- Install readline ----------"\napk add --no-cache readline-dev\napk add --no-cache libedit-dev\ndocker-php-ext-install -j 2 readline\n\necho "---------- Install gmp ----------"\napk add --no-cache gmp-dev\ndocker-php-ext-install -j 2 gmp\n\necho "---------- Install ldap ----------"\napk add --no-cache ldb-dev\napk add --no-cache openldap-dev\ndocker-php-ext-install -j 2 ldap\n\necho "---------- Install redis ----------"\nmkdir redis \\\n&& tar -xf redis-4.1.1.tgz -C redis --strip-components=1 \\\n&& ( cd redis && phpize && ./configure && make && make install ) \\\n&& docker-php-ext-enable redis\n\necho "---------- Install gd ----------"\napk add --no-cache freetype-dev libjpeg-turbo-dev libpng-dev \\\n&& docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n&& docker-php-ext-install -j 2 gd\n\necho "---------- Install mhash ----------"\nmkdir mhash \\\n&& tar -xf mhash-0.9.9.9.tar.gz -C mhash --strip-components=1 \\\n&& ( cd mhash  && ./configure && make && make install )\\\n&& docker-php-source extract \\\n&& ( cd /usr/src/php && ./configure --with-mcrypt --with-mhash=/usr/local/include && make && make install )\\\n&& docker-php-source delete\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n\n\nåæé¾æ¥ï¼Alpineå®è£phpåç§æ©å±_æå¤çåå®¢-CSDNåå®¢_alpine å®è£php8 xml',normalizedContent:'è¯¦ç»å¦ä¸\n\n#!/bin/sh\n\nsed -i "s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g" /etc/apk/repositories\n\napk add --no-cache autoconf g++ libtool make curl-dev libxml2-dev linux-headers\n\necho "---------- install mcrypt ----------"\napk add --no-cache libmcrypt-dev\ndocker-php-ext-install mcrypt\n\nech "---------- install pdo_mysql ----------"\ndocker-php-ext-install -j 2 pdo_mysql\n\necho "---------- install zip ----------"\ndocker-php-ext-install -j 2 zip\n\necho "---------- install pcntl ----------"\ndocker-php-ext-install -j 2 pcntl\n\n\necho "---------- install mysqli ----------"\ndocker-php-ext-install -j 2 mysqli\n\n\necho "---------- install mbstring ----------"\ndocker-php-ext-install -j 2 mbstring\n\necho "---------- install exif ----------"\ndocker-php-ext-install -j 2 exif\n\necho "---------- install calendar ----------"\ndocker-php-ext-install -j 2 calendar\n\necho "---------- install sockets ----------"\ndocker-php-ext-install -j 2 sockets\n\necho "---------- install gettext ----------"\napk add --no-cache gettext-dev\ndocker-php-ext-install -j 2 gettext\n\necho "---------- install shmop ----------"\ndocker-php-ext-install -j 2 shmop\n\necho "---------- install bz2 ----------"\napk add --no-cache bzip2-dev\ndocker-php-ext-install -j 2 bz2\n\necho "---------- install xsl ----------"\napk add --no-cache libxslt-dev\ndocker-php-ext-install -j 2 xsl\n\necho "---------- install wddx ----------"\napk add --no-cache libxslt-dev\nocker-php-ext-install -j 2 wddx\n\necho "---------- install curl ----------"\ndocker-php-ext-install -j 2 curl\n\necho "---------- install mysql ----------"\ndocker-php-ext-install -j 2 mysql\n\necho "---------- install wddx ----------"\ndocker-php-ext-install -j 2 wddx\n\necho "---------- install readline ----------"\napk add --no-cache readline-dev\napk add --no-cache libedit-dev\ndocker-php-ext-install -j 2 readline\n\necho "---------- install gmp ----------"\napk add --no-cache gmp-dev\ndocker-php-ext-install -j 2 gmp\n\necho "---------- install ldap ----------"\napk add --no-cache ldb-dev\napk add --no-cache openldap-dev\ndocker-php-ext-install -j 2 ldap\n\necho "---------- install redis ----------"\nmkdir redis \\\n&& tar -xf redis-4.1.1.tgz -c redis --strip-components=1 \\\n&& ( cd redis && phpize && ./configure && make && make install ) \\\n&& docker-php-ext-enable redis\n\necho "---------- install gd ----------"\napk add --no-cache freetype-dev libjpeg-turbo-dev libpng-dev \\\n&& docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n&& docker-php-ext-install -j 2 gd\n\necho "---------- install mhash ----------"\nmkdir mhash \\\n&& tar -xf mhash-0.9.9.9.tar.gz -c mhash --strip-components=1 \\\n&& ( cd mhash  && ./configure && make && make install )\\\n&& docker-php-source extract \\\n&& ( cd /usr/src/php && ./configure --with-mcrypt --with-mhash=/usr/local/include && make && make install )\\\n&& docker-php-source delete\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n\n\nåæé¾æ¥ï¼alpineå®è£phpåç§æ©å±_æå¤çåå®¢-csdnåå®¢_alpine å®è£php8 xml',charsets:{cjk:!0}},{title:"dockeræä»¶å®è£zabbix5",frontmatter:{title:"dockeræä»¶å®è£zabbix5",date:"2022-12-20T16:08:39.000Z",permalink:"/pages/e0085e/",categories:["ä¸é¢","zabbix"],tags:[null],readingShow:"top",description:"version: '2'\nservices:\n zabbix-server:\n  image: zabbix/zabbix-server-mysql:centos-5.0-latest\n  networks:\n   zabb:\n    ipv4_address: 172.19.0.2\n  ports:\n   \"10051:10051\"\n  volumes:\n   /etc/localtime:/etc/localtime\n   /etc/timezone:/etc/timezone\n   ./zbx_env/usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts\n   #- ./zbx_env/usr/lib/zabbix/externalscripts:/usr/lib/zabbix/externalscripts\n   #- ./zbx_env/var/lib/zabbix/modules:/var/lib/zabbix/modules\n   #- ./zbx_env/var/lib/zabbix/enc:/var/lib/zabbix/enc\n   #- ./zbxenv/var/lib/zabbix/sshkeys:/var/lib/zabbix/ssh_keys\n   #- ./zbx_env/var/lib/zabbix/mibs:/var/lib/zabbix/mibs\n  privileged: true\n  volumes_from:\n   zabbix-snmptraps:rw",meta:[{name:"twitter:title",content:"dockeræä»¶å®è£zabbix5"},{name:"twitter:description",content:"version: '2'\nservices:\n zabbix-server:\n  image: zabbix/zabbix-server-mysql:centos-5.0-latest\n  networks:\n   zabb:\n    ipv4_address: 172.19.0.2\n  ports:\n   \"10051:10051\"\n  volumes:\n   /etc/localtime:/etc/localtime\n   /etc/timezone:/etc/timezone\n   ./zbx_env/usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts\n   #- ./zbx_env/usr/lib/zabbix/externalscripts:/usr/lib/zabbix/externalscripts\n   #- ./zbx_env/var/lib/zabbix/modules:/var/lib/zabbix/modules\n   #- ./zbx_env/var/lib/zabbix/enc:/var/lib/zabbix/enc\n   #- ./zbxenv/var/lib/zabbix/sshkeys:/var/lib/zabbix/ssh_keys\n   #- ./zbx_env/var/lib/zabbix/mibs:/var/lib/zabbix/mibs\n  privileged: true\n  volumes_from:\n   zabbix-snmptraps:rw"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/03.docker%E6%96%87%E4%BB%B6%E5%AE%89%E8%A3%85zabbix5.html"},{property:"og:type",content:"article"},{property:"og:title",content:"dockeræä»¶å®è£zabbix5"},{property:"og:description",content:"version: '2'\nservices:\n zabbix-server:\n  image: zabbix/zabbix-server-mysql:centos-5.0-latest\n  networks:\n   zabb:\n    ipv4_address: 172.19.0.2\n  ports:\n   \"10051:10051\"\n  volumes:\n   /etc/localtime:/etc/localtime\n   /etc/timezone:/etc/timezone\n   ./zbx_env/usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts\n   #- ./zbx_env/usr/lib/zabbix/externalscripts:/usr/lib/zabbix/externalscripts\n   #- ./zbx_env/var/lib/zabbix/modules:/var/lib/zabbix/modules\n   #- ./zbx_env/var/lib/zabbix/enc:/var/lib/zabbix/enc\n   #- ./zbxenv/var/lib/zabbix/sshkeys:/var/lib/zabbix/ssh_keys\n   #- ./zbx_env/var/lib/zabbix/mibs:/var/lib/zabbix/mibs\n  privileged: true\n  volumes_from:\n   zabbix-snmptraps:rw"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/03.docker%E6%96%87%E4%BB%B6%E5%AE%89%E8%A3%85zabbix5.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-20T16:08:39.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"dockeræä»¶å®è£zabbix5"},{itemprop:"description",content:"version: '2'\nservices:\n zabbix-server:\n  image: zabbix/zabbix-server-mysql:centos-5.0-latest\n  networks:\n   zabb:\n    ipv4_address: 172.19.0.2\n  ports:\n   \"10051:10051\"\n  volumes:\n   /etc/localtime:/etc/localtime\n   /etc/timezone:/etc/timezone\n   ./zbx_env/usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts\n   #- ./zbx_env/usr/lib/zabbix/externalscripts:/usr/lib/zabbix/externalscripts\n   #- ./zbx_env/var/lib/zabbix/modules:/var/lib/zabbix/modules\n   #- ./zbx_env/var/lib/zabbix/enc:/var/lib/zabbix/enc\n   #- ./zbxenv/var/lib/zabbix/sshkeys:/var/lib/zabbix/ssh_keys\n   #- ./zbx_env/var/lib/zabbix/mibs:/var/lib/zabbix/mibs\n  privileged: true\n  volumes_from:\n   zabbix-snmptraps:rw"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/03.docker%E6%96%87%E4%BB%B6%E5%AE%89%E8%A3%85zabbix5.html",relativePath:"04.è¿ç»´/12.çæ§/01.zabbix/03.dockeræä»¶å®è£zabbix5.md",key:"v-10b832a2",path:"/pages/e0085e/",headers:[{level:4,title:"docker-compose.yamlæä»¶",slug:"docker-compose-yamlæä»¶",normalizedTitle:"docker-compose.yamlæä»¶",charIndex:2},{level:4,title:"å­ä½ä¹±ç ä¿®æ¹",slug:"å­ä½ä¹±ç ä¿®æ¹",normalizedTitle:"å­ä½ä¹±ç ä¿®æ¹",charIndex:3147},{level:4,title:"docker-compose 5.4å®è£æä»¶",slug:"docker-compose-5-4å®è£æä»¶",normalizedTitle:"docker-compose 5.4å®è£æä»¶",charIndex:3390}],headersStr:"docker-compose.yamlæä»¶ å­ä½ä¹±ç ä¿®æ¹ docker-compose 5.4å®è£æä»¶",content:'# docker-compose.yamlæä»¶\n\nversion: \'2\'\nservices:\n zabbix-server:\n  image: zabbix/zabbix-server-mysql:centos-5.0-latest\n  networks:\n   zabb:\n    ipv4_address: 172.19.0.2\n  ports:\n   - "10051:10051"\n  volumes:\n   - /etc/localtime:/etc/localtime\n   - /etc/timezone:/etc/timezone \n   - ./zbx_env/usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts\n   #- ./zbx_env/usr/lib/zabbix/externalscripts:/usr/lib/zabbix/externalscripts\n   #- ./zbx_env/var/lib/zabbix/modules:/var/lib/zabbix/modules\n   #- ./zbx_env/var/lib/zabbix/enc:/var/lib/zabbix/enc\n   #- ./zbx_env/var/lib/zabbix/ssh_keys:/var/lib/zabbix/ssh_keys\n   #- ./zbx_env/var/lib/zabbix/mibs:/var/lib/zabbix/mibs\n  privileged: true\n  volumes_from:\n   - zabbix-snmptraps:rw\n\n  links:\n   - mysql-server:mysql-server\n   - zabbix-java-gateway:zabbix-java-gateway\n  ulimits:\n   nproc: 65535\n   nofile:\n    soft: 20000\n    hard: 40000\n  mem_limit: 1024m\n  env_file:\n   - .env_db_mysql\n   - .env_srv\n\n zabbix-web-nginx-mysql:\n  image: zabbix/zabbix-web-nginx-mysql:centos-5.0-latest\n  networks:\n   zabb:\n    ipv4_address: 172.19.0.3\n  ports:\n   - 82:8080\n   - 9010:9000\n   #- "8443:443"\n  links:\n   - mysql-server:mysql-server\n   - zabbix-server:zabbix-server\n  mem_limit: 512m\n  volumes:\n   - /etc/localtime:/etc/localtime\n   - /etc/timezone:/etc/timezone\n   - /usr/share/zabbix:/usr/share/zabbix\n   #- ./zbx_env/etc/php-fpm.d:/etc/php-fpm.d\n   #- ./zbx_env/phpsock/:/tmp/proxy\n   #- ./zbx_env/etc/php-fpm.conf:/etc/php-fpm.conf\n   #- ./zbx_env/etc/php.ini:/etc/php.ini\n   #- ./zbx_env/etc/nginx/conf.d:/etc/nginx/conf.d\n  env_file:\n   - .env_db_mysql\n   - .env_web\n zabbix-java-gateway:\n   image: zabbix/zabbix-java-gateway:centos-5.0-latest\n   networks:\n    zabb:\n     ipv4_address: 172.19.0.5\n   ports:\n    - "10052:10052"\n   env_file:\n    - .env_java\n zabbix-snmptraps:\n   image: zabbix/zabbix-snmptraps:centos-5.0-latest\n   networks:\n    zabb:\n     ipv4_address: 172.19.0.6\n   ports:\n    - "162:162/udp"\n   privileged: true\n   #volumes:\n    #- ./zbx_env/var/lib/zabbix/snmptraps:/var/lib/zabbix/snmptraps:rw\n\n mysql-server:\n  image: mysql:5.7\n  networks:\n   zabb:\n    ipv4_address: 172.19.0.7\n  ports:\n   - "3306:3306"\n  volumes:\n   - /data/zabbix_mysql/mysql:/var/lib/mysql\n   #- /data/zabbix_mysql/zabbix_mysqld.cnf:/etc/mysql/mysql.conf.d/mysqld.cnf\n  environment:\n   MYSQL_ROOT_PASSWORD: "mysql_pwd"\n  command: [mysqld, --character-set-server=utf8, --collation-server=utf8_bin]\n  #volumes_from:\n    #- db_data_mysql\n  #volume_driver: local\n  #env_file:\n   #- .env_db_mysql\n\n #db_data_mysql:\n    #image: busybox\n    #networks:\n     #zabb:\n      #ipv4_address: 172.19.0.8\n    #volumes:\n    #- ./zbx_env/var/lib/mysql:/var/lib/mysql:rw\nnetworks:\n zabb:\n  driver: bridge\n  ipam:\n   config:\n    - subnet: 172.19.0.0/24\n      gateway: 172.19.0.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n\n\n# å­ä½ä¹±ç ä¿®æ¹\n\nå°ä¸­æå­ä½æ¾å°è¿ä¸ªç®å½ä¸\n\n/opt/apps/zabbix/zbx_env/usr/share/zabbix/assets/fonts\n\nä¿®æ¹phpéç½®\n\n/opt/apps/zabbix/zbx_env/usr/share/zabbix/include/defines.inc.php\n\ndefine(\'ZBX_GRAPH_FONT_NAME\', \'simhei\');\n\ndefine(\'ZBX_FONT_NAME\', \'simhei\');\n\néå¯webæå¡\n\n# docker-compose 5.4å®è£æä»¶\n\nversion: "3"\nservices:\n  mysql-server:\n    container_name: mysql-server\n    image: mysql:8.0\n    ports:\n      - "3306:3306"\n    volumes:\n      - /etc/localtime:/etc/localtime\n      - /data/mysql:/var/lib/mysql\n    environment:\n      MYSQL_ROOT_PASSWORD: root_pwd\n      MYSQL_DATABASE: zabbix\n      MYSQL_USER: zabbix\n      MYSQL_PASSWORD: zabbix_pwd\n      TZ: Asia/Shanghai\n    command: \n      --character-set-server=utf8\n      --collation-server=utf8_bin\n    restart: always\n    networks:\n      zabb:\n        ipv4_address: 172.21.0.2\n  zabbix-java-gateway:\n    container_name: zabbix-java-gateway\n    image: zabbix/zabbix-java-gateway:alpine-5.4-latest\n    networks:\n      zabb:\n        ipv4_address: 172.21.0.3\n  zabbix-server:\n    container_name: zabbix-server\n    image: zabbix/zabbix-server-mysql:alpine-5.4-latest\n    ports:\n      - "10051:10051"\n    volumes:\n      - ./zbx_env/usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts\n      - ./zbx_env/usr/lib/zabbix/externalscripts:/usr/lib/zabbix/externalscripts\n      - ./zbx_env/var/lib/zabbix/export:/var/lib/zabbix/export\n      - ./zbx_env/var/lib/zabbix/modules:/var/lib/zabbix/modules\n      - ./zbx_env/var/lib/zabbix/enc:/var/lib/zabbix/enc\n      - ./zbx_env/var/lib/zabbix/ssh_keys:/var/lib/zabbix/ssh_keys\n      - ./zbx_env/var/lib/zabbix/mibs:/var/lib/zabbix/mibs\n      - ./zbx_env/var/lib/zabbix/snmptraps:/var/lib/zabbix/snmptraps\n      - ./zbx_env/etc/zabbix/zabbix_server.conf:/etc/zabbix/zabbix_server.conf\n    environment:\n      DB_SERVER_HOST: mysql-server\n      DB_SERVER_PORT: 3306\n      MYSQL_DATABASE: zabbix\n      MYSQL_USER: zabbix\n      MYSQL_PASSWORD: zabbix_pwd\n      ZBX_JAVAGATEWAY: "zabbix-java-gateway"\n      TZ: Asia/Shanghai\n    depends_on:\n      - mysql-server\n      - zabbix-java-gateway\n      - zabbix-web-service\n    restart: always\n    networks:\n      zabb:\n        ipv4_address: 172.21.0.4\n  zabbix-web:\n    container_name: zabbix-web\n    image: zabbix/zabbix-web-nginx-mysql:alpine-5.4-latest\n    ports:\n      - "80:8080"\n    volumes:\n      - /etc/localtime:/etc/localtime:ro\n      - /etc/timezone:/etc/timezone:ro\n      - ./zbx_env/usr/share/zabbix:/usr/share/zabbix\n      - ./zbx_env/etc/php-fpm.d:/etc/php7/php-fpm.d\n      - ./zbx_env/etc/php-fpm.conf:/etc/php7/php-fpm.conf\n      - ./zbx_env/etc/php.ini:/etc/php7/php.ini\n    environment:\n      DB_SERVER_HOST: mysql-server\n      DB_SERVER_PORT: 3306\n      MYSQL_DATABASE: zabbix\n      MYSQL_USER: zabbix\n      MYSQL_PASSWORD: zabbix_pwd\n      MYSQL_ROOT_PASSWORD: root_pwd\n      TZ: Asia/Shanghai\n      ZBX_SERVER_HOST: zabbix-server\n    depends_on:\n      - mysql-server\n      - zabbix-server\n    restart: always\n    networks:\n      zabb:\n        ipv4_address: 172.21.0.5\n  zabbix-web-service:\n    container_name: zabbix-web-service\n    image: zabbix/zabbix-web-service:alpine-5.4-latest\n#    profiles:\n#      - full\n#      - all\n    ports:\n      - "10053:10053"\n#    volumes:\n#      - ./zbx_env/var/lib/zabbix/enc:/var/lib/zabbix/enc:ro\n    cap_add:\n      - SYS_ADMIN\n    extra_hosts:\n      - "zabbix-server:172.21.0.4"\n    deploy:\n      resources:\n        limits:\n          cpus: \'0.5\'\n          memory: 512M\n        reservations:\n          cpus: \'0.25\'\n          memory: 256M\n#    env_file:\n#      - ./env_vars/.env_web_service\n    networks:\n      zabb:\n        ipv4_address: 172.21.0.6\n  zabbix-agent:\n    container_name: zabbix-agent\n    image: zabbix/zabbix-agent:alpine-5.4-latest\n    links:\n      - zabbix-server:zabbix-server\n    ports:                                                                                                                                              \n      - "10050:10050"\n    privileged: true\n    networks:\n      zabb:\n        ipv4_address: 172.21.0.7\nnetworks:\n  zabb:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.21.0.0/24\n          gateway: 172.21.0.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n',normalizedContent:'# docker-compose.yamlæä»¶\n\nversion: \'2\'\nservices:\n zabbix-server:\n  image: zabbix/zabbix-server-mysql:centos-5.0-latest\n  networks:\n   zabb:\n    ipv4_address: 172.19.0.2\n  ports:\n   - "10051:10051"\n  volumes:\n   - /etc/localtime:/etc/localtime\n   - /etc/timezone:/etc/timezone \n   - ./zbx_env/usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts\n   #- ./zbx_env/usr/lib/zabbix/externalscripts:/usr/lib/zabbix/externalscripts\n   #- ./zbx_env/var/lib/zabbix/modules:/var/lib/zabbix/modules\n   #- ./zbx_env/var/lib/zabbix/enc:/var/lib/zabbix/enc\n   #- ./zbx_env/var/lib/zabbix/ssh_keys:/var/lib/zabbix/ssh_keys\n   #- ./zbx_env/var/lib/zabbix/mibs:/var/lib/zabbix/mibs\n  privileged: true\n  volumes_from:\n   - zabbix-snmptraps:rw\n\n  links:\n   - mysql-server:mysql-server\n   - zabbix-java-gateway:zabbix-java-gateway\n  ulimits:\n   nproc: 65535\n   nofile:\n    soft: 20000\n    hard: 40000\n  mem_limit: 1024m\n  env_file:\n   - .env_db_mysql\n   - .env_srv\n\n zabbix-web-nginx-mysql:\n  image: zabbix/zabbix-web-nginx-mysql:centos-5.0-latest\n  networks:\n   zabb:\n    ipv4_address: 172.19.0.3\n  ports:\n   - 82:8080\n   - 9010:9000\n   #- "8443:443"\n  links:\n   - mysql-server:mysql-server\n   - zabbix-server:zabbix-server\n  mem_limit: 512m\n  volumes:\n   - /etc/localtime:/etc/localtime\n   - /etc/timezone:/etc/timezone\n   - /usr/share/zabbix:/usr/share/zabbix\n   #- ./zbx_env/etc/php-fpm.d:/etc/php-fpm.d\n   #- ./zbx_env/phpsock/:/tmp/proxy\n   #- ./zbx_env/etc/php-fpm.conf:/etc/php-fpm.conf\n   #- ./zbx_env/etc/php.ini:/etc/php.ini\n   #- ./zbx_env/etc/nginx/conf.d:/etc/nginx/conf.d\n  env_file:\n   - .env_db_mysql\n   - .env_web\n zabbix-java-gateway:\n   image: zabbix/zabbix-java-gateway:centos-5.0-latest\n   networks:\n    zabb:\n     ipv4_address: 172.19.0.5\n   ports:\n    - "10052:10052"\n   env_file:\n    - .env_java\n zabbix-snmptraps:\n   image: zabbix/zabbix-snmptraps:centos-5.0-latest\n   networks:\n    zabb:\n     ipv4_address: 172.19.0.6\n   ports:\n    - "162:162/udp"\n   privileged: true\n   #volumes:\n    #- ./zbx_env/var/lib/zabbix/snmptraps:/var/lib/zabbix/snmptraps:rw\n\n mysql-server:\n  image: mysql:5.7\n  networks:\n   zabb:\n    ipv4_address: 172.19.0.7\n  ports:\n   - "3306:3306"\n  volumes:\n   - /data/zabbix_mysql/mysql:/var/lib/mysql\n   #- /data/zabbix_mysql/zabbix_mysqld.cnf:/etc/mysql/mysql.conf.d/mysqld.cnf\n  environment:\n   mysql_root_password: "mysql_pwd"\n  command: [mysqld, --character-set-server=utf8, --collation-server=utf8_bin]\n  #volumes_from:\n    #- db_data_mysql\n  #volume_driver: local\n  #env_file:\n   #- .env_db_mysql\n\n #db_data_mysql:\n    #image: busybox\n    #networks:\n     #zabb:\n      #ipv4_address: 172.19.0.8\n    #volumes:\n    #- ./zbx_env/var/lib/mysql:/var/lib/mysql:rw\nnetworks:\n zabb:\n  driver: bridge\n  ipam:\n   config:\n    - subnet: 172.19.0.0/24\n      gateway: 172.19.0.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n\n\n# å­ä½ä¹±ç ä¿®æ¹\n\nå°ä¸­æå­ä½æ¾å°è¿ä¸ªç®å½ä¸\n\n/opt/apps/zabbix/zbx_env/usr/share/zabbix/assets/fonts\n\nä¿®æ¹phpéç½®\n\n/opt/apps/zabbix/zbx_env/usr/share/zabbix/include/defines.inc.php\n\ndefine(\'zbx_graph_font_name\', \'simhei\');\n\ndefine(\'zbx_font_name\', \'simhei\');\n\néå¯webæå¡\n\n# docker-compose 5.4å®è£æä»¶\n\nversion: "3"\nservices:\n  mysql-server:\n    container_name: mysql-server\n    image: mysql:8.0\n    ports:\n      - "3306:3306"\n    volumes:\n      - /etc/localtime:/etc/localtime\n      - /data/mysql:/var/lib/mysql\n    environment:\n      mysql_root_password: root_pwd\n      mysql_database: zabbix\n      mysql_user: zabbix\n      mysql_password: zabbix_pwd\n      tz: asia/shanghai\n    command: \n      --character-set-server=utf8\n      --collation-server=utf8_bin\n    restart: always\n    networks:\n      zabb:\n        ipv4_address: 172.21.0.2\n  zabbix-java-gateway:\n    container_name: zabbix-java-gateway\n    image: zabbix/zabbix-java-gateway:alpine-5.4-latest\n    networks:\n      zabb:\n        ipv4_address: 172.21.0.3\n  zabbix-server:\n    container_name: zabbix-server\n    image: zabbix/zabbix-server-mysql:alpine-5.4-latest\n    ports:\n      - "10051:10051"\n    volumes:\n      - ./zbx_env/usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts\n      - ./zbx_env/usr/lib/zabbix/externalscripts:/usr/lib/zabbix/externalscripts\n      - ./zbx_env/var/lib/zabbix/export:/var/lib/zabbix/export\n      - ./zbx_env/var/lib/zabbix/modules:/var/lib/zabbix/modules\n      - ./zbx_env/var/lib/zabbix/enc:/var/lib/zabbix/enc\n      - ./zbx_env/var/lib/zabbix/ssh_keys:/var/lib/zabbix/ssh_keys\n      - ./zbx_env/var/lib/zabbix/mibs:/var/lib/zabbix/mibs\n      - ./zbx_env/var/lib/zabbix/snmptraps:/var/lib/zabbix/snmptraps\n      - ./zbx_env/etc/zabbix/zabbix_server.conf:/etc/zabbix/zabbix_server.conf\n    environment:\n      db_server_host: mysql-server\n      db_server_port: 3306\n      mysql_database: zabbix\n      mysql_user: zabbix\n      mysql_password: zabbix_pwd\n      zbx_javagateway: "zabbix-java-gateway"\n      tz: asia/shanghai\n    depends_on:\n      - mysql-server\n      - zabbix-java-gateway\n      - zabbix-web-service\n    restart: always\n    networks:\n      zabb:\n        ipv4_address: 172.21.0.4\n  zabbix-web:\n    container_name: zabbix-web\n    image: zabbix/zabbix-web-nginx-mysql:alpine-5.4-latest\n    ports:\n      - "80:8080"\n    volumes:\n      - /etc/localtime:/etc/localtime:ro\n      - /etc/timezone:/etc/timezone:ro\n      - ./zbx_env/usr/share/zabbix:/usr/share/zabbix\n      - ./zbx_env/etc/php-fpm.d:/etc/php7/php-fpm.d\n      - ./zbx_env/etc/php-fpm.conf:/etc/php7/php-fpm.conf\n      - ./zbx_env/etc/php.ini:/etc/php7/php.ini\n    environment:\n      db_server_host: mysql-server\n      db_server_port: 3306\n      mysql_database: zabbix\n      mysql_user: zabbix\n      mysql_password: zabbix_pwd\n      mysql_root_password: root_pwd\n      tz: asia/shanghai\n      zbx_server_host: zabbix-server\n    depends_on:\n      - mysql-server\n      - zabbix-server\n    restart: always\n    networks:\n      zabb:\n        ipv4_address: 172.21.0.5\n  zabbix-web-service:\n    container_name: zabbix-web-service\n    image: zabbix/zabbix-web-service:alpine-5.4-latest\n#    profiles:\n#      - full\n#      - all\n    ports:\n      - "10053:10053"\n#    volumes:\n#      - ./zbx_env/var/lib/zabbix/enc:/var/lib/zabbix/enc:ro\n    cap_add:\n      - sys_admin\n    extra_hosts:\n      - "zabbix-server:172.21.0.4"\n    deploy:\n      resources:\n        limits:\n          cpus: \'0.5\'\n          memory: 512m\n        reservations:\n          cpus: \'0.25\'\n          memory: 256m\n#    env_file:\n#      - ./env_vars/.env_web_service\n    networks:\n      zabb:\n        ipv4_address: 172.21.0.6\n  zabbix-agent:\n    container_name: zabbix-agent\n    image: zabbix/zabbix-agent:alpine-5.4-latest\n    links:\n      - zabbix-server:zabbix-server\n    ports:                                                                                                                                              \n      - "10050:10050"\n    privileged: true\n    networks:\n      zabb:\n        ipv4_address: 172.21.0.7\nnetworks:\n  zabb:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.21.0.0/24\n          gateway: 172.21.0.1\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n119\n120\n121\n122\n123\n124\n125\n126\n127\n128\n129\n130\n131\n132\n133\n',charsets:{cjk:!0}},{title:"zabbixéç½®ééåè­¦",frontmatter:{title:"zabbixéç½®ééåè­¦",date:"2022-12-20T16:16:02.000Z",permalink:"/pages/a4e3ce/",categories:["ä¸é¢","zabbix"],tags:[null],readingShow:"top",description:"èæ¬å¦ä¸",meta:[{name:"image",content:"https://gitee.com/zhang_peng_jie/images/raw/master/img/2022121220221220162025.jpg"},{name:"twitter:title",content:"zabbixéç½®ééåè­¦"},{name:"twitter:description",content:"èæ¬å¦ä¸"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://gitee.com/zhang_peng_jie/images/raw/master/img/2022121220221220162025.jpg"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/04.zabbix%E9%85%8D%E7%BD%AE%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6.html"},{property:"og:type",content:"article"},{property:"og:title",content:"zabbixéç½®ééåè­¦"},{property:"og:description",content:"èæ¬å¦ä¸"},{property:"og:image",content:"https://gitee.com/zhang_peng_jie/images/raw/master/img/2022121220221220162025.jpg"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/04.zabbix%E9%85%8D%E7%BD%AE%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-20T16:16:02.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"zabbixéç½®ééåè­¦"},{itemprop:"description",content:"èæ¬å¦ä¸"},{itemprop:"image",content:"https://gitee.com/zhang_peng_jie/images/raw/master/img/2022121220221220162025.jpg"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/04.zabbix%E9%85%8D%E7%BD%AE%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6.html",relativePath:"04.è¿ç»´/12.çæ§/01.zabbix/04.zabbixéç½®ééåè­¦.md",key:"v-282498df",path:"/pages/a4e3ce/",headers:[{level:4,title:"å°èæ¬æ¾å°zabbix-serveræå¡å¨è·¯å¾ï¼/usr/lib/zabbix/alertscripts",slug:"å°èæ¬æ¾å°zabbix-serveræå¡å¨è·¯å¾-usr-lib-zabbix-alertscripts",normalizedTitle:"å°èæ¬æ¾å°zabbix-serveræå¡å¨è·¯å¾ï¼/usr/lib/zabbix/alertscripts",charIndex:2},{level:4,title:"æ¥è­¦åªä»éç½®",slug:"æ¥è­¦åªä»éç½®",normalizedTitle:"æ¥è­¦åªä»éç½®",charIndex:1227},{level:4,title:"éç½®è§¦åå¨å¨ä½",slug:"éç½®è§¦åå¨å¨ä½",normalizedTitle:"éç½®è§¦åå¨å¨ä½",charIndex:1239},{level:4,title:"è®¾ç½®åè­¦ç¨æ·ï¼æ·»å æ¥è­¦åªä»",slug:"è®¾ç½®åè­¦ç¨æ·-æ·»å æ¥è­¦åªä»",normalizedTitle:"è®¾ç½®åè­¦ç¨æ·ï¼æ·»å æ¥è­¦åªä»",charIndex:1482}],headersStr:"å°èæ¬æ¾å°zabbix-serveræå¡å¨è·¯å¾ï¼/usr/lib/zabbix/alertscripts æ¥è­¦åªä»éç½® éç½®è§¦åå¨å¨ä½ è®¾ç½®åè­¦ç¨æ·ï¼æ·»å æ¥è­¦åªä»",content:'# å°èæ¬æ¾å°zabbix-serveræå¡å¨è·¯å¾ï¼/usr/lib/zabbix/alertscripts\n\nèæ¬å¦ä¸\n\n#!/usr/bin/python\n#-*- coding: utf-8 -*-\nimport requests,json,sys,os,datetime\nwebhook="https://oapi.dingtalk.com/robot/send?access_token=712c3d89c613a3cce737bd1ed5ce8c7b9ebd5ee48c115236873b2a2a54c5efcf"\n\n#è¯´æï¼è¿éæ¹ä¸ºèªå·±åå»ºçæºå¨äººçwebhookçå¼ \nuser=sys.argv[1]\n#åç»ééç¾¤ä¸­åªä¸ªç¨æ·\ntext=sys.argv[3]\n\ndata={ \n    "msgtype": "text", \n    "text": { \n        "content": text \n    }, \n    "at": { \n        "atMobiles": [\n            user \n        ],\n        "isAtAll": False\n    } \n}\n#ééAPIåºå®æ°æ®æ ¼å¼\nheaders = {\'Content-Type\': \'application/json\'}\nx=requests.post(url=webhook,data=json.dumps(data),headers=headers)\nif os.path.exists("/usr/lib/zabbix/alertscripts/dingding.log"):\n    f=open("/usr/lib/zabbix/alertscripts/dingding.log","a+")\nelse:\n    f=open("/usr/lib/zabbix/alertscripts/dingding.log","w+")\nf.write("\\n"+"--"*30)\nif x.json()["errcode"] == 0:\n    f.write("\\n"+str(datetime.datetime.now())+"    "+str(user)+"    "+"åéæå"+"\\n"+str(text))\n    f.close()\nelse:\n    f.write("\\n"+str(datetime.datetime.now()) + "    " + str(user) + "    " + "åéå¤±è´¥" + "\\n" + str(text))\n    f.close()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\n# æ¥è­¦åªä»éç½®\n\n\n\n# éç½®è§¦åå¨å¨ä½\n\n\n\n\n\n\n\næéåç§°ï¼{EVENT.NAME}\n\næå¡å¨ï¼{HOST.NAME} åçï¼{TRIGGER.NAME}æéï¼ åè­¦ä¸»æºï¼{HOST.NAME} çæ§é¡¹ç®ï¼{ITEM.NAME} çæ§åå¼ï¼{ITEM.LASTVALUE} åè­¦ç­çº§ï¼{TRIGGER.SEVERITY} å½åç¶æï¼{TRIGGER.STATUS} åè­¦ä¿¡æ¯ï¼{TRIGGER.NAME} åè­¦æ¶é´ï¼{EVENT.DATE} {EVENT.TIME} äºä»¶ID:{EVENT.ID}\n\n# è®¾ç½®åè­¦ç¨æ·ï¼æ·»å æ¥è­¦åªä»\n\n',normalizedContent:'# å°èæ¬æ¾å°zabbix-serveræå¡å¨è·¯å¾ï¼/usr/lib/zabbix/alertscripts\n\nèæ¬å¦ä¸\n\n#!/usr/bin/python\n#-*- coding: utf-8 -*-\nimport requests,json,sys,os,datetime\nwebhook="https://oapi.dingtalk.com/robot/send?access_token=712c3d89c613a3cce737bd1ed5ce8c7b9ebd5ee48c115236873b2a2a54c5efcf"\n\n#è¯´æï¼è¿éæ¹ä¸ºèªå·±åå»ºçæºå¨äººçwebhookçå¼ \nuser=sys.argv[1]\n#åç»ééç¾¤ä¸­åªä¸ªç¨æ·\ntext=sys.argv[3]\n\ndata={ \n    "msgtype": "text", \n    "text": { \n        "content": text \n    }, \n    "at": { \n        "atmobiles": [\n            user \n        ],\n        "isatall": false\n    } \n}\n#ééapiåºå®æ°æ®æ ¼å¼\nheaders = {\'content-type\': \'application/json\'}\nx=requests.post(url=webhook,data=json.dumps(data),headers=headers)\nif os.path.exists("/usr/lib/zabbix/alertscripts/dingding.log"):\n    f=open("/usr/lib/zabbix/alertscripts/dingding.log","a+")\nelse:\n    f=open("/usr/lib/zabbix/alertscripts/dingding.log","w+")\nf.write("\\n"+"--"*30)\nif x.json()["errcode"] == 0:\n    f.write("\\n"+str(datetime.datetime.now())+"    "+str(user)+"    "+"åéæå"+"\\n"+str(text))\n    f.close()\nelse:\n    f.write("\\n"+str(datetime.datetime.now()) + "    " + str(user) + "    " + "åéå¤±è´¥" + "\\n" + str(text))\n    f.close()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n\n\n# æ¥è­¦åªä»éç½®\n\n\n\n# éç½®è§¦åå¨å¨ä½\n\n\n\n\n\n\n\næéåç§°ï¼{event.name}\n\næå¡å¨ï¼{host.name} åçï¼{trigger.name}æéï¼ åè­¦ä¸»æºï¼{host.name} çæ§é¡¹ç®ï¼{item.name} çæ§åå¼ï¼{item.lastvalue} åè­¦ç­çº§ï¼{trigger.severity} å½åç¶æï¼{trigger.status} åè­¦ä¿¡æ¯ï¼{trigger.name} åè­¦æ¶é´ï¼{event.date} {event.time} äºä»¶id:{event.id}\n\n# è®¾ç½®åè­¦ç¨æ·ï¼æ·»å æ¥è­¦åªä»\n\n',charsets:{cjk:!0}},{title:"zabbixæ·»å ç«¯å£åè¿ç¨çæ§",frontmatter:{title:"zabbixæ·»å ç«¯å£åè¿ç¨çæ§",date:"2022-12-14T15:03:30.000Z",permalink:"/pages/a0a3ae/",categories:["ä¸é¢","zabbix"],tags:[null],readingShow:"top",description:"å¨çæ§çäº§ç¯å¢çæå¡çæ¶åï¼éå¸¸éè¦å¯¹å¤ä¸ªç«¯å£è¿è¡çæ§ï¼å¦ææä»¬æå¨ä¸ä¸ªä¸ä¸ªçæ·»å ï¼è¿å°æ¯ä¸ä»¶å¾éº»ç¦çäºæï¼ä¸ºäºåå°è¿æ ·çæåµï¼æä»¬éç¨æ¹éæ·»å çæ§ç«¯å£çæ¹æ³ï¼è¿æ¯éå¸¸å¸¸è§çéæ±ï¼zabbixä¹æ¯æ¯æè¿ç§æ¹å¼çï¼éè¦ä½¿ç¨zabbixçDiscoveryåè½æ¥å®ç°ã\n>\n> ä½¿ç¨zabbixçæ§å¦ä½çæ§æå¡å¨ç«¯å£ç¶æï¼å¤§æ¦çæµç¨ï¼zabbixçæ§æå¡èªå¸¦ç«¯å£çæ§ççæ§é¡¹ï¼æä»¥éè¦æä»¬èªå·±æå¨å®ä¹æçæ§çitemï¼å®¢æ·ç«¯è·åçç«¯å£åè¡¨éè¿agentä¼ éå°æå¡ç«¯ã\n>\n> åªéå¨æå¡ç«¯è¿è¡ç«¯å£çæ§æ¨¡æ¿éç½®ï¼ç¶åèªå®ä¹çæ§å¾å½¢ï¼æ·»å çæ§é¡¹å³å¯ï¼",meta:[{name:"image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/20221212Dingtalk_20221220163305.jpg"},{name:"twitter:title",content:"zabbixæ·»å ç«¯å£åè¿ç¨çæ§"},{name:"twitter:description",content:"å¨çæ§çäº§ç¯å¢çæå¡çæ¶åï¼éå¸¸éè¦å¯¹å¤ä¸ªç«¯å£è¿è¡çæ§ï¼å¦ææä»¬æå¨ä¸ä¸ªä¸ä¸ªçæ·»å ï¼è¿å°æ¯ä¸ä»¶å¾éº»ç¦çäºæï¼ä¸ºäºåå°è¿æ ·çæåµï¼æä»¬éç¨æ¹éæ·»å çæ§ç«¯å£çæ¹æ³ï¼è¿æ¯éå¸¸å¸¸è§çéæ±ï¼zabbixä¹æ¯æ¯æè¿ç§æ¹å¼çï¼éè¦ä½¿ç¨zabbixçDiscoveryåè½æ¥å®ç°ã\n>\n> ä½¿ç¨zabbixçæ§å¦ä½çæ§æå¡å¨ç«¯å£ç¶æï¼å¤§æ¦çæµç¨ï¼zabbixçæ§æå¡èªå¸¦ç«¯å£çæ§ççæ§é¡¹ï¼æä»¥éè¦æä»¬èªå·±æå¨å®ä¹æçæ§çitemï¼å®¢æ·ç«¯è·åçç«¯å£åè¡¨éè¿agentä¼ éå°æå¡ç«¯ã\n>\n> åªéå¨æå¡ç«¯è¿è¡ç«¯å£çæ§æ¨¡æ¿éç½®ï¼ç¶åèªå®ä¹çæ§å¾å½¢ï¼æ·»å çæ§é¡¹å³å¯ï¼"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/20221212Dingtalk_20221220163305.jpg"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/02.zabbix%E6%B7%BB%E5%8A%A0%E7%AB%AF%E5%8F%A3%E5%92%8C%E8%BF%9B%E7%A8%8B%E7%9B%91%E6%8E%A7.html"},{property:"og:type",content:"article"},{property:"og:title",content:"zabbixæ·»å ç«¯å£åè¿ç¨çæ§"},{property:"og:description",content:"å¨çæ§çäº§ç¯å¢çæå¡çæ¶åï¼éå¸¸éè¦å¯¹å¤ä¸ªç«¯å£è¿è¡çæ§ï¼å¦ææä»¬æå¨ä¸ä¸ªä¸ä¸ªçæ·»å ï¼è¿å°æ¯ä¸ä»¶å¾éº»ç¦çäºæï¼ä¸ºäºåå°è¿æ ·çæåµï¼æä»¬éç¨æ¹éæ·»å çæ§ç«¯å£çæ¹æ³ï¼è¿æ¯éå¸¸å¸¸è§çéæ±ï¼zabbixä¹æ¯æ¯æè¿ç§æ¹å¼çï¼éè¦ä½¿ç¨zabbixçDiscoveryåè½æ¥å®ç°ã\n>\n> ä½¿ç¨zabbixçæ§å¦ä½çæ§æå¡å¨ç«¯å£ç¶æï¼å¤§æ¦çæµç¨ï¼zabbixçæ§æå¡èªå¸¦ç«¯å£çæ§ççæ§é¡¹ï¼æä»¥éè¦æä»¬èªå·±æå¨å®ä¹æçæ§çitemï¼å®¢æ·ç«¯è·åçç«¯å£åè¡¨éè¿agentä¼ éå°æå¡ç«¯ã\n>\n> åªéå¨æå¡ç«¯è¿è¡ç«¯å£çæ§æ¨¡æ¿éç½®ï¼ç¶åèªå®ä¹çæ§å¾å½¢ï¼æ·»å çæ§é¡¹å³å¯ï¼"},{property:"og:image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/20221212Dingtalk_20221220163305.jpg"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/02.zabbix%E6%B7%BB%E5%8A%A0%E7%AB%AF%E5%8F%A3%E5%92%8C%E8%BF%9B%E7%A8%8B%E7%9B%91%E6%8E%A7.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-14T15:03:30.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"zabbixæ·»å ç«¯å£åè¿ç¨çæ§"},{itemprop:"description",content:"å¨çæ§çäº§ç¯å¢çæå¡çæ¶åï¼éå¸¸éè¦å¯¹å¤ä¸ªç«¯å£è¿è¡çæ§ï¼å¦ææä»¬æå¨ä¸ä¸ªä¸ä¸ªçæ·»å ï¼è¿å°æ¯ä¸ä»¶å¾éº»ç¦çäºæï¼ä¸ºäºåå°è¿æ ·çæåµï¼æä»¬éç¨æ¹éæ·»å çæ§ç«¯å£çæ¹æ³ï¼è¿æ¯éå¸¸å¸¸è§çéæ±ï¼zabbixä¹æ¯æ¯æè¿ç§æ¹å¼çï¼éè¦ä½¿ç¨zabbixçDiscoveryåè½æ¥å®ç°ã\n>\n> ä½¿ç¨zabbixçæ§å¦ä½çæ§æå¡å¨ç«¯å£ç¶æï¼å¤§æ¦çæµç¨ï¼zabbixçæ§æå¡èªå¸¦ç«¯å£çæ§ççæ§é¡¹ï¼æä»¥éè¦æä»¬èªå·±æå¨å®ä¹æçæ§çitemï¼å®¢æ·ç«¯è·åçç«¯å£åè¡¨éè¿agentä¼ éå°æå¡ç«¯ã\n>\n> åªéå¨æå¡ç«¯è¿è¡ç«¯å£çæ§æ¨¡æ¿éç½®ï¼ç¶åèªå®ä¹çæ§å¾å½¢ï¼æ·»å çæ§é¡¹å³å¯ï¼"},{itemprop:"image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/20221212Dingtalk_20221220163305.jpg"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/02.zabbix%E6%B7%BB%E5%8A%A0%E7%AB%AF%E5%8F%A3%E5%92%8C%E8%BF%9B%E7%A8%8B%E7%9B%91%E6%8E%A7.html",relativePath:"04.è¿ç»´/12.çæ§/01.zabbix/02.zabbixæ·»å ç«¯å£åè¿ç¨çæ§.md",key:"v-7b122aa1",path:"/pages/a0a3ae/",headers:[{level:4,title:"æ«æç«¯å£èæ¬",slug:"æ«æç«¯å£èæ¬",normalizedTitle:"æ«æç«¯å£èæ¬",charIndex:279},{level:4,title:"æ°å»ºzabbixæ¨¡æ¿",slug:"æ°å»ºzabbixæ¨¡æ¿",normalizedTitle:"æ°å»ºzabbixæ¨¡æ¿",charIndex:1214},{level:4,title:"èªå¨åç°æ¹éçæµæå®è¿ç¨æå¡æ¹æ¡ä¼åï¼å¯¹äºæ²¡æåºå®ç«¯å£çæå¡å¯éç¨æ­¤æ¹å¼ï¼",slug:"èªå¨åç°æ¹éçæµæå®è¿ç¨æå¡æ¹æ¡ä¼å-å¯¹äºæ²¡æåºå®ç«¯å£çæå¡å¯éç¨æ­¤æ¹å¼",normalizedTitle:"èªå¨åç°æ¹éçæµæå®è¿ç¨æå¡æ¹æ¡ä¼åï¼å¯¹äºæ²¡æåºå®ç«¯å£çæå¡å¯éç¨æ­¤æ¹å¼ï¼",charIndex:1264}],headersStr:"æ«æç«¯å£èæ¬ æ°å»ºzabbixæ¨¡æ¿ èªå¨åç°æ¹éçæµæå®è¿ç¨æå¡æ¹æ¡ä¼åï¼å¯¹äºæ²¡æåºå®ç«¯å£çæå¡å¯éç¨æ­¤æ¹å¼ï¼",content:'> å¨çæ§çäº§ç¯å¢çæå¡çæ¶åï¼éå¸¸éè¦å¯¹å¤ä¸ªç«¯å£è¿è¡çæ§ï¼å¦ææä»¬æå¨ä¸ä¸ªä¸ä¸ªçæ·»å ï¼è¿å°æ¯ä¸ä»¶å¾éº»ç¦çäºæï¼ä¸ºäºåå°è¿æ ·çæåµï¼æä»¬éç¨æ¹éæ·»å çæ§ç«¯å£çæ¹æ³ï¼è¿æ¯éå¸¸å¸¸è§çéæ±ï¼zabbixä¹æ¯æ¯æè¿ç§æ¹å¼çï¼éè¦ä½¿ç¨zabbixçDiscoveryåè½æ¥å®ç°ã\n> \n> ä½¿ç¨zabbixçæ§å¦ä½çæ§æå¡å¨ç«¯å£ç¶æï¼å¤§æ¦çæµç¨ï¼zabbixçæ§æå¡èªå¸¦ç«¯å£çæ§ççæ§é¡¹ï¼æä»¥éè¦æä»¬èªå·±æå¨å®ä¹æçæ§çitemï¼å®¢æ·ç«¯è·åçç«¯å£åè¡¨éè¿agentä¼ éå°æå¡ç«¯ã\n> \n> åªéå¨æå¡ç«¯è¿è¡ç«¯å£çæ§æ¨¡æ¿éç½®ï¼ç¶åèªå®ä¹çæ§å¾å½¢ï¼æ·»å çæ§é¡¹å³å¯ï¼\n\n# æ«æç«¯å£èæ¬\n\ncheck_port.py\n\n#!/usr/bin/env python\n#coding:utf-8\n\nimport json\n\ntotal_dict={"data":[\n{"{#TCP_PORT}":"10690","{#SERVICE_NAME}":"bms_frontend"},\n{"{#TCP_PORT}":"10691","{#SERVICE_NAME}":"bms_backend"},\n{"{#TCP_PORT}":"30004","{#SERVICE_NAME}":"idc_web_uniappp"},\n{"{#TCP_PORT}":"30003","{#SERVICE_NAME}":"idc_service_go"},\n{"{#TCP_PORT}":"30000","{#SERVICE_NAME}":"idc_web_website"},\n{"{#TCP_PORT}":"30002","{#SERVICE_NAME}":"idc_web_h5"},\n{"{#TCP_PORT}":"30001","{#SERVICE_NAME}":"idc_web_admin"},\n{"{#TCP_PORT}":"10585","{#SERVICE_NAME}":"gg_h5_fz"},\n{"{#TCP_PORT}":"80","{#SERVICE_NAME}":"proxy"},\n{"{#TCP_PORT}":"16379","{#SERVICE_NAME}":"redis"}\n]}\n\njsonStr = json.dumps(total_dict,sort_keys=True,indent=4,ensure_ascii=False)\n\n#python3\n#print(jsonStr)\n\n#python2\nprint jsonStr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\ncheck_port.conf\n\nUserParameter=tcpportlisten,/etc/zabbix/sh/check_port.py\n\n# æ°å»ºzabbixæ¨¡æ¿\n\n\n\nåå»ºèªå¨åç°\n\n\n\nåå»ºèªå¨åç°ççæ§é¡¹åååè§¦åå¨ç±»å\n\n\n\n\n\n# èªå¨åç°æ¹éçæµæå®è¿ç¨æå¡æ¹æ¡ä¼åï¼å¯¹äºæ²¡æåºå®ç«¯å£çæå¡å¯éç¨æ­¤æ¹å¼ï¼\n\nè¿ç¨æå¡åç°èæ¬ check_proc.py\n\n#!/usr/bin/env python\n#coding:utf-8\n\nimport json\n\ntotal_dict={"data":[\n{"{#CMDLINE}":"accountinfo-provider","{#SERVICE_NAME}":"accountinfo-provider"},\n{"{#CMDLINE}":"account-provider","{#SERVICE_NAME}":"account-provider"},\n{"{#CMDLINE}":"account-user-provider","{#SERVICE_NAME}":"account-user-provider"},\n{"{#CMDLINE}":"account-userSeq-provider","{#SERVICE_NAME}":"account-userSeq-provider"},\n{"{#CMDLINE}":"loginLogger-provider","{#SERVICE_NAME}":"loginLogger-provider"}\n]}\n\njsonStr = json.dumps(total_dict,sort_keys=True,indent=4,ensure_ascii=False)\n\n#python3\n#print(jsonStr)\n\n#python2\nprint jsonStr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nuserparameter_checkproc.conf æä»¶åå®¹ï¼\n\n\n\nèªå¨åç°è§åï¼\n\n\n\nçæ§é¡¹ååä¼åï¼\n\n\n\nè§¦åå¨ååä¼åï¼\n\n\n\nåæé¾æ¥ï¼https://blog.csdn.net/wudinaniya/article/details/94362623',normalizedContent:'> å¨çæ§çäº§ç¯å¢çæå¡çæ¶åï¼éå¸¸éè¦å¯¹å¤ä¸ªç«¯å£è¿è¡çæ§ï¼å¦ææä»¬æå¨ä¸ä¸ªä¸ä¸ªçæ·»å ï¼è¿å°æ¯ä¸ä»¶å¾éº»ç¦çäºæï¼ä¸ºäºåå°è¿æ ·çæåµï¼æä»¬éç¨æ¹éæ·»å çæ§ç«¯å£çæ¹æ³ï¼è¿æ¯éå¸¸å¸¸è§çéæ±ï¼zabbixä¹æ¯æ¯æè¿ç§æ¹å¼çï¼éè¦ä½¿ç¨zabbixçdiscoveryåè½æ¥å®ç°ã\n> \n> ä½¿ç¨zabbixçæ§å¦ä½çæ§æå¡å¨ç«¯å£ç¶æï¼å¤§æ¦çæµç¨ï¼zabbixçæ§æå¡èªå¸¦ç«¯å£çæ§ççæ§é¡¹ï¼æä»¥éè¦æä»¬èªå·±æå¨å®ä¹æçæ§çitemï¼å®¢æ·ç«¯è·åçç«¯å£åè¡¨éè¿agentä¼ éå°æå¡ç«¯ã\n> \n> åªéå¨æå¡ç«¯è¿è¡ç«¯å£çæ§æ¨¡æ¿éç½®ï¼ç¶åèªå®ä¹çæ§å¾å½¢ï¼æ·»å çæ§é¡¹å³å¯ï¼\n\n# æ«æç«¯å£èæ¬\n\ncheck_port.py\n\n#!/usr/bin/env python\n#coding:utf-8\n\nimport json\n\ntotal_dict={"data":[\n{"{#tcp_port}":"10690","{#service_name}":"bms_frontend"},\n{"{#tcp_port}":"10691","{#service_name}":"bms_backend"},\n{"{#tcp_port}":"30004","{#service_name}":"idc_web_uniappp"},\n{"{#tcp_port}":"30003","{#service_name}":"idc_service_go"},\n{"{#tcp_port}":"30000","{#service_name}":"idc_web_website"},\n{"{#tcp_port}":"30002","{#service_name}":"idc_web_h5"},\n{"{#tcp_port}":"30001","{#service_name}":"idc_web_admin"},\n{"{#tcp_port}":"10585","{#service_name}":"gg_h5_fz"},\n{"{#tcp_port}":"80","{#service_name}":"proxy"},\n{"{#tcp_port}":"16379","{#service_name}":"redis"}\n]}\n\njsonstr = json.dumps(total_dict,sort_keys=true,indent=4,ensure_ascii=false)\n\n#python3\n#print(jsonstr)\n\n#python2\nprint jsonstr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\ncheck_port.conf\n\nuserparameter=tcpportlisten,/etc/zabbix/sh/check_port.py\n\n# æ°å»ºzabbixæ¨¡æ¿\n\n\n\nåå»ºèªå¨åç°\n\n\n\nåå»ºèªå¨åç°ççæ§é¡¹åååè§¦åå¨ç±»å\n\n\n\n\n\n# èªå¨åç°æ¹éçæµæå®è¿ç¨æå¡æ¹æ¡ä¼åï¼å¯¹äºæ²¡æåºå®ç«¯å£çæå¡å¯éç¨æ­¤æ¹å¼ï¼\n\nè¿ç¨æå¡åç°èæ¬ check_proc.py\n\n#!/usr/bin/env python\n#coding:utf-8\n\nimport json\n\ntotal_dict={"data":[\n{"{#cmdline}":"accountinfo-provider","{#service_name}":"accountinfo-provider"},\n{"{#cmdline}":"account-provider","{#service_name}":"account-provider"},\n{"{#cmdline}":"account-user-provider","{#service_name}":"account-user-provider"},\n{"{#cmdline}":"account-userseq-provider","{#service_name}":"account-userseq-provider"},\n{"{#cmdline}":"loginlogger-provider","{#service_name}":"loginlogger-provider"}\n]}\n\njsonstr = json.dumps(total_dict,sort_keys=true,indent=4,ensure_ascii=false)\n\n#python3\n#print(jsonstr)\n\n#python2\nprint jsonstr\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n\n\nuserparameter_checkproc.conf æä»¶åå®¹ï¼\n\n\n\nèªå¨åç°è§åï¼\n\n\n\nçæ§é¡¹ååä¼åï¼\n\n\n\nè§¦åå¨ååä¼åï¼\n\n\n\nåæé¾æ¥ï¼https://blog.csdn.net/wudinaniya/article/details/94362623',charsets:{cjk:!0}},{title:"zabbixæ·»å è¯ä¹¦çæ§",frontmatter:{title:"zabbixæ·»å è¯ä¹¦çæ§",date:"2022-12-14T15:03:30.000Z",permalink:"/pages/3dac52/",categories:["ä¸é¢","zabbix"],tags:[null],readingShow:"top",description:"è·åè¯ä¹¦è¿ææ¶é´èæ¬ï¼/etc/zabbix/scripts/check-cert-expire.sh",meta:[{name:"image",content:"https://img2018.cnblogs.com/blog/1279026/201907/1279026-20190725190623268-1734764150.png"},{name:"twitter:title",content:"zabbixæ·»å è¯ä¹¦çæ§"},{name:"twitter:description",content:"è·åè¯ä¹¦è¿ææ¶é´èæ¬ï¼/etc/zabbix/scripts/check-cert-expire.sh"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://img2018.cnblogs.com/blog/1279026/201907/1279026-20190725190623268-1734764150.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/01.zabbix%E6%B7%BB%E5%8A%A0%E8%AF%81%E4%B9%A6%E7%9B%91%E6%8E%A7.html"},{property:"og:type",content:"article"},{property:"og:title",content:"zabbixæ·»å è¯ä¹¦çæ§"},{property:"og:description",content:"è·åè¯ä¹¦è¿ææ¶é´èæ¬ï¼/etc/zabbix/scripts/check-cert-expire.sh"},{property:"og:image",content:"https://img2018.cnblogs.com/blog/1279026/201907/1279026-20190725190623268-1734764150.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/01.zabbix%E6%B7%BB%E5%8A%A0%E8%AF%81%E4%B9%A6%E7%9B%91%E6%8E%A7.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-14T15:03:30.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"zabbixæ·»å è¯ä¹¦çæ§"},{itemprop:"description",content:"è·åè¯ä¹¦è¿ææ¶é´èæ¬ï¼/etc/zabbix/scripts/check-cert-expire.sh"},{itemprop:"image",content:"https://img2018.cnblogs.com/blog/1279026/201907/1279026-20190725190623268-1734764150.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/01.zabbix%E6%B7%BB%E5%8A%A0%E8%AF%81%E4%B9%A6%E7%9B%91%E6%8E%A7.html",relativePath:"04.è¿ç»´/12.çæ§/01.zabbix/01.zabbixæ·»å è¯ä¹¦çæ§.md",key:"v-787b413e",path:"/pages/3dac52/",headers:[{level:4,title:"zabbixçæ§sslè¯ä¹¦è¿ææ¶é´",slug:"zabbixçæ§sslè¯ä¹¦è¿ææ¶é´",normalizedTitle:"zabbixçæ§sslè¯ä¹¦è¿ææ¶é´",charIndex:2},{level:4,title:"ååèªå¨åç°èæ¬ï¼",slug:"ååèªå¨åç°èæ¬",normalizedTitle:"ååèªå¨åç°èæ¬ï¼",charIndex:804},{level:4,title:"zabbixéç½®",slug:"zabbixéç½®",normalizedTitle:"zabbixéç½®",charIndex:1532},{level:4,title:"å¨zabbixä¸­æ·»å æ¨¡æ¿ï¼",slug:"å¨zabbixä¸­æ·»å æ¨¡æ¿",normalizedTitle:"å¨zabbixä¸­æ·»å æ¨¡æ¿ï¼",charIndex:1782}],headersStr:"zabbixçæ§sslè¯ä¹¦è¿ææ¶é´ ååèªå¨åç°èæ¬ï¼ zabbixéç½® å¨zabbixä¸­æ·»å æ¨¡æ¿ï¼",content:'# zabbixçæ§sslè¯ä¹¦è¿ææ¶é´\n\nè·åè¯ä¹¦è¿ææ¶é´èæ¬ï¼/etc/zabbix/scripts/check-cert-expire.sh\n\n/etc/zabbix/scripts/check-cert-expire.sh:\n\n#!/bin/bash\nhost=$1\nport=$2\nend_date=`/usr/bin/openssl s_client -servername $host -host $host -port $port -showcerts </dev/null 2>/dev/null |\n  sed -n \'/BEGIN CERTIFICATE/,/END CERT/p\' |\n  /usr/bin/openssl  x509 -text 2>/dev/null |\n  sed -n \'s/ *Not After : *//p\'`\n# openssl æ£éªåéªè¯SSLè¯ä¹¦ã\n# -servername $host å ä¸å°ä¸»æºå­å¨å¤ä¸ªè¯ä¹¦ï¼å©ç¨SNIç¹æ§æ£æ¥\n# </dev/null å®åæ åè¾å¥ï¼é²æ­¢äº¤äºå¼ç¨åºãä»/dev/null è¯»æ¶ï¼ç´æ¥è¯»åº0 ã\n# sed -n åp ä¸èµ·ä½¿ç¨ï¼ä»æ¾ç¤ºå¹éå°çé¨åã //,// åºé´å¹éã\n# openssl x509 -text è§£ç è¯ä¹¦ä¿¡æ¯ï¼åå«è¯ä¹¦çæææã\n\nif [ -n "$end_date" ]\nthen\n    end_date_seconds=`date \'+%s\' --date "$end_date"`\n    now_seconds=`date \'+%s\'`\n    echo "($end_date_seconds-$now_seconds)/24/3600" | bc\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n# ååèªå¨åç°èæ¬ï¼\n\n#!/usr/bin/env python\n#coding:utf-8\n\nimport os\nimport sys\nimport json\n\n#è¿ä¸ªå½æ°ä¸»è¦æ¯æé åºä¸ä¸ªç¹å®æ ¼å¼çå­å¸ï¼ç¨äºzabbix\ndef ssl_cert_discovery():\n    web_list=[]\n    web_dict={"data":None}\n    with open("/etc/zabbix/scripts/ssl_cert_list","r") as f:\n        for sslcert in f:\n            dict={}\n            dict["{#DOMAINNAME}"]=sslcert.strip().split()[0]\n            dict["{#PORT}"]=sslcert.strip().split()[1]\n            web_list.append(dict)\n    web_dict["data"]=web_list\n    jsonStr = json.dumps(web_dict,indent=4)\n    return jsonStr\nif __name__ == "__main__":\n    print ssl_cert_discovery()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nåååè¡¨ï¼\n\n/etc/zabbix/scripts/ssl_cert_list: www.baidu.com 443 www.qq.com 443\n\n# zabbixéç½®\n\n/etc/zabbix/zabbix_agentd.conf.d/userparameter_sslcert.conf: UserParameter=sslcert_discovery,/usr/bin/python /etc/zabbix/scripts/sshcert_discovery.py UserParameter=sslcert.info[*],/bin/bash /etc/zabbix/scripts/check-cert-expire.sh $1 $2\n\n# å¨zabbixä¸­æ·»å æ¨¡æ¿ï¼\n\nTemplate_ssl_cert_info.xmlï¼<?xml version="1.0" encoding="UTF-8"?>\n<zabbix_export>\n    <version>3.0</version>\n    <date>2019-07-25T10:31:57Z</date>\n    <groups>\n        <group>\n            <name>Templates</name>\n        </group>\n    </groups>\n    <templates>\n        <template>\n            <template>Template ssl cert Information</template>\n            <name>Template ssl cert Information</name>\n            <description/>\n            <groups>\n                <group>\n                    <name>Templates</name>\n                </group>\n            </groups>\n            <applications/>\n            <items/>\n            <discovery_rules>\n                <discovery_rule>\n                    <name>ssl cert information</name>\n                    <type>0</type>\n                    <snmp_community/>\n                    <snmp_oid/>\n                    <key>sslcert_discovery</key>\n                    <delay>10800</delay>\n                    <status>0</status>\n                    <allowed_hosts/>\n                    <snmpv3_contextname/>\n                    <snmpv3_securityname/>\n                    <snmpv3_securitylevel>0</snmpv3_securitylevel>\n                    <snmpv3_authprotocol>0</snmpv3_authprotocol>\n                    <snmpv3_authpassphrase/>\n                    <snmpv3_privprotocol>0</snmpv3_privprotocol>\n                    <snmpv3_privpassphrase/>\n                    <delay_flex/>\n                    <params/>\n                    <ipmi_sensor/>\n                    <authtype>0</authtype>\n                    <username/>\n                    <password/>\n                    <publickey/>\n                    <privatekey/>\n                    <port/>\n                    <filter>\n                        <evaltype>0</evaltype>\n                        <formula/>\n                        <conditions/>\n                    </filter>\n                    <lifetime>30</lifetime>\n                    <description/>\n                    <item_prototypes>\n                        <item_prototype>\n                            <name>sslinfo[{#DOMAINNAME}]</name>\n                            <type>0</type>\n                            <snmp_community/>\n                            <multiplier>1</multiplier>\n                            <snmp_oid/>\n                            <key>sslcert.info[{#DOMAINNAME},{#PORT}]</key>\n                            <delay>10800</delay>\n                            <history>90</history>\n                            <trends>365</trends>\n                            <status>0</status>\n                            <value_type>3</value_type>\n                            <allowed_hosts/>\n                            <units>å¤©</units>\n                            <delta>0</delta>\n                            <snmpv3_contextname/>\n                            <snmpv3_securityname/>\n                            <snmpv3_securitylevel>0</snmpv3_securitylevel>\n                            <snmpv3_authprotocol>0</snmpv3_authprotocol>\n                            <snmpv3_authpassphrase/>\n                            <snmpv3_privprotocol>0</snmpv3_privprotocol>\n                            <snmpv3_privpassphrase/>\n                            <formula>1</formula>\n                            <delay_flex/>\n                            <params/>\n                            <ipmi_sensor/>\n                            <data_type>0</data_type>\n                            <authtype>0</authtype>\n                            <username/>\n                            <password/>\n                            <publickey/>\n                            <privatekey/>\n                            <port/>\n                            <description/>\n                            <inventory_link>0</inventory_link>\n                            <applications/>\n                            <valuemap/>\n                            <logtimefmt/>\n                            <application_prototypes/>\n                        </item_prototype>\n                    </item_prototypes>\n                    <trigger_prototypes>\n                        <trigger_prototype>\n                            <expression>{Template ssl cert Information:sslcert.info[{#DOMAINNAME},{#PORT}].last()}<7</expression>\n                            <name>{#DOMAINNAME} will retire after 7 days,Attention Please!</name>\n                            <url/>\n                            <status>0</status>\n                            <priority>4</priority>\n                            <description/>\n                            <type>0</type>\n                            <dependencies/>\n                        </trigger_prototype>\n                    </trigger_prototypes>\n                    <graph_prototypes/>\n                    <host_prototypes/>\n                </discovery_rule>\n            </discovery_rules>\n            <macros/>\n            <templates/>\n            <screens/>\n        </template>\n    </templates>\n</zabbix_export>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n\n\nè°æ´è§¦åå¨æ¶é¿ï¼éªè¯éç½®æ¯å¦æ­£ç¡®ã\n\n\n\nåæé¾æ¥ï¼https://www.cnblogs.com/imcati/p/11246158.html',normalizedContent:'# zabbixçæ§sslè¯ä¹¦è¿ææ¶é´\n\nè·åè¯ä¹¦è¿ææ¶é´èæ¬ï¼/etc/zabbix/scripts/check-cert-expire.sh\n\n/etc/zabbix/scripts/check-cert-expire.sh:\n\n#!/bin/bash\nhost=$1\nport=$2\nend_date=`/usr/bin/openssl s_client -servername $host -host $host -port $port -showcerts </dev/null 2>/dev/null |\n  sed -n \'/begin certificate/,/end cert/p\' |\n  /usr/bin/openssl  x509 -text 2>/dev/null |\n  sed -n \'s/ *not after : *//p\'`\n# openssl æ£éªåéªè¯sslè¯ä¹¦ã\n# -servername $host å ä¸å°ä¸»æºå­å¨å¤ä¸ªè¯ä¹¦ï¼å©ç¨sniç¹æ§æ£æ¥\n# </dev/null å®åæ åè¾å¥ï¼é²æ­¢äº¤äºå¼ç¨åºãä»/dev/null è¯»æ¶ï¼ç´æ¥è¯»åº0 ã\n# sed -n åp ä¸èµ·ä½¿ç¨ï¼ä»æ¾ç¤ºå¹éå°çé¨åã //,// åºé´å¹éã\n# openssl x509 -text è§£ç è¯ä¹¦ä¿¡æ¯ï¼åå«è¯ä¹¦çæææã\n\nif [ -n "$end_date" ]\nthen\n    end_date_seconds=`date \'+%s\' --date "$end_date"`\n    now_seconds=`date \'+%s\'`\n    echo "($end_date_seconds-$now_seconds)/24/3600" | bc\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n\n# ååèªå¨åç°èæ¬ï¼\n\n#!/usr/bin/env python\n#coding:utf-8\n\nimport os\nimport sys\nimport json\n\n#è¿ä¸ªå½æ°ä¸»è¦æ¯æé åºä¸ä¸ªç¹å®æ ¼å¼çå­å¸ï¼ç¨äºzabbix\ndef ssl_cert_discovery():\n    web_list=[]\n    web_dict={"data":none}\n    with open("/etc/zabbix/scripts/ssl_cert_list","r") as f:\n        for sslcert in f:\n            dict={}\n            dict["{#domainname}"]=sslcert.strip().split()[0]\n            dict["{#port}"]=sslcert.strip().split()[1]\n            web_list.append(dict)\n    web_dict["data"]=web_list\n    jsonstr = json.dumps(web_dict,indent=4)\n    return jsonstr\nif __name__ == "__main__":\n    print ssl_cert_discovery()\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n\n\nåååè¡¨ï¼\n\n/etc/zabbix/scripts/ssl_cert_list: www.baidu.com 443 www.qq.com 443\n\n# zabbixéç½®\n\n/etc/zabbix/zabbix_agentd.conf.d/userparameter_sslcert.conf: userparameter=sslcert_discovery,/usr/bin/python /etc/zabbix/scripts/sshcert_discovery.py userparameter=sslcert.info[*],/bin/bash /etc/zabbix/scripts/check-cert-expire.sh $1 $2\n\n# å¨zabbixä¸­æ·»å æ¨¡æ¿ï¼\n\ntemplate_ssl_cert_info.xmlï¼<?xml version="1.0" encoding="utf-8"?>\n<zabbix_export>\n    <version>3.0</version>\n    <date>2019-07-25t10:31:57z</date>\n    <groups>\n        <group>\n            <name>templates</name>\n        </group>\n    </groups>\n    <templates>\n        <template>\n            <template>template ssl cert information</template>\n            <name>template ssl cert information</name>\n            <description/>\n            <groups>\n                <group>\n                    <name>templates</name>\n                </group>\n            </groups>\n            <applications/>\n            <items/>\n            <discovery_rules>\n                <discovery_rule>\n                    <name>ssl cert information</name>\n                    <type>0</type>\n                    <snmp_community/>\n                    <snmp_oid/>\n                    <key>sslcert_discovery</key>\n                    <delay>10800</delay>\n                    <status>0</status>\n                    <allowed_hosts/>\n                    <snmpv3_contextname/>\n                    <snmpv3_securityname/>\n                    <snmpv3_securitylevel>0</snmpv3_securitylevel>\n                    <snmpv3_authprotocol>0</snmpv3_authprotocol>\n                    <snmpv3_authpassphrase/>\n                    <snmpv3_privprotocol>0</snmpv3_privprotocol>\n                    <snmpv3_privpassphrase/>\n                    <delay_flex/>\n                    <params/>\n                    <ipmi_sensor/>\n                    <authtype>0</authtype>\n                    <username/>\n                    <password/>\n                    <publickey/>\n                    <privatekey/>\n                    <port/>\n                    <filter>\n                        <evaltype>0</evaltype>\n                        <formula/>\n                        <conditions/>\n                    </filter>\n                    <lifetime>30</lifetime>\n                    <description/>\n                    <item_prototypes>\n                        <item_prototype>\n                            <name>sslinfo[{#domainname}]</name>\n                            <type>0</type>\n                            <snmp_community/>\n                            <multiplier>1</multiplier>\n                            <snmp_oid/>\n                            <key>sslcert.info[{#domainname},{#port}]</key>\n                            <delay>10800</delay>\n                            <history>90</history>\n                            <trends>365</trends>\n                            <status>0</status>\n                            <value_type>3</value_type>\n                            <allowed_hosts/>\n                            <units>å¤©</units>\n                            <delta>0</delta>\n                            <snmpv3_contextname/>\n                            <snmpv3_securityname/>\n                            <snmpv3_securitylevel>0</snmpv3_securitylevel>\n                            <snmpv3_authprotocol>0</snmpv3_authprotocol>\n                            <snmpv3_authpassphrase/>\n                            <snmpv3_privprotocol>0</snmpv3_privprotocol>\n                            <snmpv3_privpassphrase/>\n                            <formula>1</formula>\n                            <delay_flex/>\n                            <params/>\n                            <ipmi_sensor/>\n                            <data_type>0</data_type>\n                            <authtype>0</authtype>\n                            <username/>\n                            <password/>\n                            <publickey/>\n                            <privatekey/>\n                            <port/>\n                            <description/>\n                            <inventory_link>0</inventory_link>\n                            <applications/>\n                            <valuemap/>\n                            <logtimefmt/>\n                            <application_prototypes/>\n                        </item_prototype>\n                    </item_prototypes>\n                    <trigger_prototypes>\n                        <trigger_prototype>\n                            <expression>{template ssl cert information:sslcert.info[{#domainname},{#port}].last()}<7</expression>\n                            <name>{#domainname} will retire after 7 days,attention please!</name>\n                            <url/>\n                            <status>0</status>\n                            <priority>4</priority>\n                            <description/>\n                            <type>0</type>\n                            <dependencies/>\n                        </trigger_prototype>\n                    </trigger_prototypes>\n                    <graph_prototypes/>\n                    <host_prototypes/>\n                </discovery_rule>\n            </discovery_rules>\n            <macros/>\n            <templates/>\n            <screens/>\n        </template>\n    </templates>\n</zabbix_export>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n65\n66\n67\n68\n69\n70\n71\n72\n73\n74\n75\n76\n77\n78\n79\n80\n81\n82\n83\n84\n85\n86\n87\n88\n89\n90\n91\n92\n93\n94\n95\n96\n97\n98\n99\n100\n101\n102\n103\n104\n105\n106\n107\n108\n109\n110\n111\n112\n113\n114\n115\n116\n117\n118\n\n\nè°æ´è§¦åå¨æ¶é¿ï¼éªè¯éç½®æ¯å¦æ­£ç¡®ã\n\n\n\nåæé¾æ¥ï¼https://www.cnblogs.com/imcati/p/11246158.html',charsets:{cjk:!0}},{title:"zabbixæ·»å æ¥å¿çæ§",frontmatter:{title:"zabbixæ·»å æ¥å¿çæ§",date:"2022-12-20T16:41:01.000Z",permalink:"/pages/334bec/",categories:["ä¸é¢","zabbix"],tags:[null],readingShow:"top",description:"ä»å¤©æ¥äºè§£ä¸ä¸å³äºELKçâLâ-Logstash,æ²¡éï¼å°±æ¯è¿ä¸ªç¥å¥å°ç»ä»¶ï¼æä»¬é½ç¥éï¼å®æ¯ELKä¸å¯ç¼ºå°çç»ä»¶ï¼å®æäºè¾å¥ï¼inputï¼ï¼è¿æ»¤ï¼fileterï¼ï¼outputï¼è¾åºï¼å·¥ä½éï¼ä¹æ¯æä»¬ä½ä¸ºè¿ç»´äººåéè¦ææ¡çé¾ç¹ï¼è¯´å°è¿é ï¼åç±åæ¨ï¼âç±ä¹å¥½ï¼æ¨ä¹é¾âï¼è¿ä¸ªLogstashæ¥æè¿å¼ºå¤§çæä»¶åè½ï¼é¤äºå¸®æä»¬è¿æ»¤ï¼é«æçè¾åºæ¥å¿ï¼è¿è½å¸®æä»¬ä¸Zabbixçæ§ç¸ç»åï¼\n>\n> å ä¸ºæä»¬çLogstashæ¯æå¤ç§è¾åºç±»åï¼è½å¤æ¶éwebæå¡æ¥å¿ï¼ç³»ç»æ¥å¿ï¼åæ ¸æ¥å¿ï¼ä½æ¯ï¼ç«ç¶æ¯ææ¥å¿è¾åºï¼è¯å®é¿åä¸äºéè¯¯ï¼errorï¼æ¥å¿çåºç°ï¼å½Erroræ¥å¿åºç°çæ¶åï¼è½ç¶å¯ä»¥éè¿ELKæ¥æ¾åºæ¥ï¼ä½æ¯ELKä¸è½å®æ¶æä¾æ¥è­¦ï¼è¿å°±æç¹å°´å°¬äºï¼æä»¬è¦åçå°±æ¯è½å¤åzabbixï¼nagiosçæ§é£æ ·ï¼ä¸è½è¦åå°çæ§ï¼è¿è¦åå°æ¥è­¦ï¼è¿ä¸ç¹ï¼ELKåªåå°äºçæ§ï¼ä½æ¯æ²¡æåå°æ¥è­¦ï¼ä¸è¿æ²¡å³ç³»ï¼æä»¬çLogstashæä»¶è½å¤ä¸zabbixç»åèµ·æ¥ï¼å°éè¦åè­¦ çæ¥å¿æ¶éèµ·æ¥ï¼æ¯å¦è¯´æéè¯¯æ è¯çæ¥å¿ï¼å®ææ¥å¿çæ§è§¦ååè­¦~\n>\n> logstashæ¯æå¤ç§è¾åºä»è´¨ï¼æ¯å¦è¯´syslogï¼httpï¼tcpï¼elasticsearch,kafkaç­ï¼å¦ææä»¬å°logstashæ¶éçæ¥å¿è¾åºå°zabbixåè­¦ï¼å°±å¿é¡»è¦ç¨å°logstash-output-zabbixæä»¶ï¼éè¿è¿ä¸ªæä»¶å°logstashä¸zabbixæ´åï¼logstashæ¶éå°çæ°æ®è¿æ»¤åºéè¯¯ä¿¡æ¯çæ¥å¿è¾åºå°zabbixä¸­ï¼æåéè¿zabbixåè­¦æºå¶è§¦åï¼",meta:[{name:"image",content:"https://images2018.cnblogs.com/blog/1166362/201809/1166362-20180906220312074-1735973576.png"},{name:"twitter:title",content:"zabbixæ·»å æ¥å¿çæ§"},{name:"twitter:description",content:"ä»å¤©æ¥äºè§£ä¸ä¸å³äºELKçâLâ-Logstash,æ²¡éï¼å°±æ¯è¿ä¸ªç¥å¥å°ç»ä»¶ï¼æä»¬é½ç¥éï¼å®æ¯ELKä¸å¯ç¼ºå°çç»ä»¶ï¼å®æäºè¾å¥ï¼inputï¼ï¼è¿æ»¤ï¼fileterï¼ï¼outputï¼è¾åºï¼å·¥ä½éï¼ä¹æ¯æä»¬ä½ä¸ºè¿ç»´äººåéè¦ææ¡çé¾ç¹ï¼è¯´å°è¿é ï¼åç±åæ¨ï¼âç±ä¹å¥½ï¼æ¨ä¹é¾âï¼è¿ä¸ªLogstashæ¥æè¿å¼ºå¤§çæä»¶åè½ï¼é¤äºå¸®æä»¬è¿æ»¤ï¼é«æçè¾åºæ¥å¿ï¼è¿è½å¸®æä»¬ä¸Zabbixçæ§ç¸ç»åï¼\n>\n> å ä¸ºæä»¬çLogstashæ¯æå¤ç§è¾åºç±»åï¼è½å¤æ¶éwebæå¡æ¥å¿ï¼ç³»ç»æ¥å¿ï¼åæ ¸æ¥å¿ï¼ä½æ¯ï¼ç«ç¶æ¯ææ¥å¿è¾åºï¼è¯å®é¿åä¸äºéè¯¯ï¼errorï¼æ¥å¿çåºç°ï¼å½Erroræ¥å¿åºç°çæ¶åï¼è½ç¶å¯ä»¥éè¿ELKæ¥æ¾åºæ¥ï¼ä½æ¯ELKä¸è½å®æ¶æä¾æ¥è­¦ï¼è¿å°±æç¹å°´å°¬äºï¼æä»¬è¦åçå°±æ¯è½å¤åzabbixï¼nagiosçæ§é£æ ·ï¼ä¸è½è¦åå°çæ§ï¼è¿è¦åå°æ¥è­¦ï¼è¿ä¸ç¹ï¼ELKåªåå°äºçæ§ï¼ä½æ¯æ²¡æåå°æ¥è­¦ï¼ä¸è¿æ²¡å³ç³»ï¼æä»¬çLogstashæä»¶è½å¤ä¸zabbixç»åèµ·æ¥ï¼å°éè¦åè­¦ çæ¥å¿æ¶éèµ·æ¥ï¼æ¯å¦è¯´æéè¯¯æ è¯çæ¥å¿ï¼å®ææ¥å¿çæ§è§¦ååè­¦~\n>\n> logstashæ¯æå¤ç§è¾åºä»è´¨ï¼æ¯å¦è¯´syslogï¼httpï¼tcpï¼elasticsearch,kafkaç­ï¼å¦ææä»¬å°logstashæ¶éçæ¥å¿è¾åºå°zabbixåè­¦ï¼å°±å¿é¡»è¦ç¨å°logstash-output-zabbixæä»¶ï¼éè¿è¿ä¸ªæä»¶å°logstashä¸zabbixæ´åï¼logstashæ¶éå°çæ°æ®è¿æ»¤åºéè¯¯ä¿¡æ¯çæ¥å¿è¾åºå°zabbixä¸­ï¼æåéè¿zabbixåè­¦æºå¶è§¦åï¼"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://images2018.cnblogs.com/blog/1166362/201809/1166362-20180906220312074-1735973576.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/05.zabbix%E6%B7%BB%E5%8A%A0%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7.html"},{property:"og:type",content:"article"},{property:"og:title",content:"zabbixæ·»å æ¥å¿çæ§"},{property:"og:description",content:"ä»å¤©æ¥äºè§£ä¸ä¸å³äºELKçâLâ-Logstash,æ²¡éï¼å°±æ¯è¿ä¸ªç¥å¥å°ç»ä»¶ï¼æä»¬é½ç¥éï¼å®æ¯ELKä¸å¯ç¼ºå°çç»ä»¶ï¼å®æäºè¾å¥ï¼inputï¼ï¼è¿æ»¤ï¼fileterï¼ï¼outputï¼è¾åºï¼å·¥ä½éï¼ä¹æ¯æä»¬ä½ä¸ºè¿ç»´äººåéè¦ææ¡çé¾ç¹ï¼è¯´å°è¿é ï¼åç±åæ¨ï¼âç±ä¹å¥½ï¼æ¨ä¹é¾âï¼è¿ä¸ªLogstashæ¥æè¿å¼ºå¤§çæä»¶åè½ï¼é¤äºå¸®æä»¬è¿æ»¤ï¼é«æçè¾åºæ¥å¿ï¼è¿è½å¸®æä»¬ä¸Zabbixçæ§ç¸ç»åï¼\n>\n> å ä¸ºæä»¬çLogstashæ¯æå¤ç§è¾åºç±»åï¼è½å¤æ¶éwebæå¡æ¥å¿ï¼ç³»ç»æ¥å¿ï¼åæ ¸æ¥å¿ï¼ä½æ¯ï¼ç«ç¶æ¯ææ¥å¿è¾åºï¼è¯å®é¿åä¸äºéè¯¯ï¼errorï¼æ¥å¿çåºç°ï¼å½Erroræ¥å¿åºç°çæ¶åï¼è½ç¶å¯ä»¥éè¿ELKæ¥æ¾åºæ¥ï¼ä½æ¯ELKä¸è½å®æ¶æä¾æ¥è­¦ï¼è¿å°±æç¹å°´å°¬äºï¼æä»¬è¦åçå°±æ¯è½å¤åzabbixï¼nagiosçæ§é£æ ·ï¼ä¸è½è¦åå°çæ§ï¼è¿è¦åå°æ¥è­¦ï¼è¿ä¸ç¹ï¼ELKåªåå°äºçæ§ï¼ä½æ¯æ²¡æåå°æ¥è­¦ï¼ä¸è¿æ²¡å³ç³»ï¼æä»¬çLogstashæä»¶è½å¤ä¸zabbixç»åèµ·æ¥ï¼å°éè¦åè­¦ çæ¥å¿æ¶éèµ·æ¥ï¼æ¯å¦è¯´æéè¯¯æ è¯çæ¥å¿ï¼å®ææ¥å¿çæ§è§¦ååè­¦~\n>\n> logstashæ¯æå¤ç§è¾åºä»è´¨ï¼æ¯å¦è¯´syslogï¼httpï¼tcpï¼elasticsearch,kafkaç­ï¼å¦ææä»¬å°logstashæ¶éçæ¥å¿è¾åºå°zabbixåè­¦ï¼å°±å¿é¡»è¦ç¨å°logstash-output-zabbixæä»¶ï¼éè¿è¿ä¸ªæä»¶å°logstashä¸zabbixæ´åï¼logstashæ¶éå°çæ°æ®è¿æ»¤åºéè¯¯ä¿¡æ¯çæ¥å¿è¾åºå°zabbixä¸­ï¼æåéè¿zabbixåè­¦æºå¶è§¦åï¼"},{property:"og:image",content:"https://images2018.cnblogs.com/blog/1166362/201809/1166362-20180906220312074-1735973576.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/05.zabbix%E6%B7%BB%E5%8A%A0%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-20T16:41:01.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"zabbixæ·»å æ¥å¿çæ§"},{itemprop:"description",content:"ä»å¤©æ¥äºè§£ä¸ä¸å³äºELKçâLâ-Logstash,æ²¡éï¼å°±æ¯è¿ä¸ªç¥å¥å°ç»ä»¶ï¼æä»¬é½ç¥éï¼å®æ¯ELKä¸å¯ç¼ºå°çç»ä»¶ï¼å®æäºè¾å¥ï¼inputï¼ï¼è¿æ»¤ï¼fileterï¼ï¼outputï¼è¾åºï¼å·¥ä½éï¼ä¹æ¯æä»¬ä½ä¸ºè¿ç»´äººåéè¦ææ¡çé¾ç¹ï¼è¯´å°è¿é ï¼åç±åæ¨ï¼âç±ä¹å¥½ï¼æ¨ä¹é¾âï¼è¿ä¸ªLogstashæ¥æè¿å¼ºå¤§çæä»¶åè½ï¼é¤äºå¸®æä»¬è¿æ»¤ï¼é«æçè¾åºæ¥å¿ï¼è¿è½å¸®æä»¬ä¸Zabbixçæ§ç¸ç»åï¼\n>\n> å ä¸ºæä»¬çLogstashæ¯æå¤ç§è¾åºç±»åï¼è½å¤æ¶éwebæå¡æ¥å¿ï¼ç³»ç»æ¥å¿ï¼åæ ¸æ¥å¿ï¼ä½æ¯ï¼ç«ç¶æ¯ææ¥å¿è¾åºï¼è¯å®é¿åä¸äºéè¯¯ï¼errorï¼æ¥å¿çåºç°ï¼å½Erroræ¥å¿åºç°çæ¶åï¼è½ç¶å¯ä»¥éè¿ELKæ¥æ¾åºæ¥ï¼ä½æ¯ELKä¸è½å®æ¶æä¾æ¥è­¦ï¼è¿å°±æç¹å°´å°¬äºï¼æä»¬è¦åçå°±æ¯è½å¤åzabbixï¼nagiosçæ§é£æ ·ï¼ä¸è½è¦åå°çæ§ï¼è¿è¦åå°æ¥è­¦ï¼è¿ä¸ç¹ï¼ELKåªåå°äºçæ§ï¼ä½æ¯æ²¡æåå°æ¥è­¦ï¼ä¸è¿æ²¡å³ç³»ï¼æä»¬çLogstashæä»¶è½å¤ä¸zabbixç»åèµ·æ¥ï¼å°éè¦åè­¦ çæ¥å¿æ¶éèµ·æ¥ï¼æ¯å¦è¯´æéè¯¯æ è¯çæ¥å¿ï¼å®ææ¥å¿çæ§è§¦ååè­¦~\n>\n> logstashæ¯æå¤ç§è¾åºä»è´¨ï¼æ¯å¦è¯´syslogï¼httpï¼tcpï¼elasticsearch,kafkaç­ï¼å¦ææä»¬å°logstashæ¶éçæ¥å¿è¾åºå°zabbixåè­¦ï¼å°±å¿é¡»è¦ç¨å°logstash-output-zabbixæä»¶ï¼éè¿è¿ä¸ªæä»¶å°logstashä¸zabbixæ´åï¼logstashæ¶éå°çæ°æ®è¿æ»¤åºéè¯¯ä¿¡æ¯çæ¥å¿è¾åºå°zabbixä¸­ï¼æåéè¿zabbixåè­¦æºå¶è§¦åï¼"},{itemprop:"image",content:"https://images2018.cnblogs.com/blog/1166362/201809/1166362-20180906220312074-1735973576.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/05.zabbix%E6%B7%BB%E5%8A%A0%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7.html",relativePath:"04.è¿ç»´/12.çæ§/01.zabbix/05.zabbixæ·»å æ¥å¿çæ§.md",key:"v-68775ace",path:"/pages/334bec/",headers:[{level:4,title:"zabbixæ´åelkæ¶éç³»ç»å¼å¸¸æ¥å¿è§¦ååè­¦",slug:"zabbixæ´åelkæ¶éç³»ç»å¼å¸¸æ¥å¿è§¦ååè­¦",normalizedTitle:"zabbixæ´åelkæ¶éç³»ç»å¼å¸¸æ¥å¿è§¦ååè­¦",charIndex:2}],headersStr:"zabbixæ´åelkæ¶éç³»ç»å¼å¸¸æ¥å¿è§¦ååè­¦",content:'# zabbixæ´åelkæ¶éç³»ç»å¼å¸¸æ¥å¿è§¦ååè­¦\n\n> ä»å¤©æ¥äºè§£ä¸ä¸å³äºELKçâLâ-Logstash,æ²¡éï¼å°±æ¯è¿ä¸ªç¥å¥å°ç»ä»¶ï¼æä»¬é½ç¥éï¼å®æ¯ELKä¸å¯ç¼ºå°çç»ä»¶ï¼å®æäºè¾å¥ï¼inputï¼ï¼è¿æ»¤ï¼fileterï¼ï¼outputï¼è¾åºï¼å·¥ä½éï¼ä¹æ¯æä»¬ä½ä¸ºè¿ç»´äººåéè¦ææ¡çé¾ç¹ï¼è¯´å°è¿é ï¼åç±åæ¨ï¼âç±ä¹å¥½ï¼æ¨ä¹é¾âï¼è¿ä¸ªLogstashæ¥æè¿å¼ºå¤§çæä»¶åè½ï¼é¤äºå¸®æä»¬è¿æ»¤ï¼é«æçè¾åºæ¥å¿ï¼è¿è½å¸®æä»¬ä¸Zabbixçæ§ç¸ç»åï¼\n> \n> å ä¸ºæä»¬çLogstashæ¯æå¤ç§è¾åºç±»åï¼è½å¤æ¶éwebæå¡æ¥å¿ï¼ç³»ç»æ¥å¿ï¼åæ ¸æ¥å¿ï¼ä½æ¯ï¼ç«ç¶æ¯ææ¥å¿è¾åºï¼è¯å®é¿åä¸äºéè¯¯ï¼errorï¼æ¥å¿çåºç°ï¼å½Erroræ¥å¿åºç°çæ¶åï¼è½ç¶å¯ä»¥éè¿ELKæ¥æ¾åºæ¥ï¼ä½æ¯ELKä¸è½å®æ¶æä¾æ¥è­¦ï¼è¿å°±æç¹å°´å°¬äºï¼æä»¬è¦åçå°±æ¯è½å¤åzabbixï¼nagiosçæ§é£æ ·ï¼ä¸è½è¦åå°çæ§ï¼è¿è¦åå°æ¥è­¦ï¼è¿ä¸ç¹ï¼ELKåªåå°äºçæ§ï¼ä½æ¯æ²¡æåå°æ¥è­¦ï¼ä¸è¿æ²¡å³ç³»ï¼æä»¬çLogstashæä»¶è½å¤ä¸zabbixç»åèµ·æ¥ï¼å°éè¦åè­¦ çæ¥å¿æ¶éèµ·æ¥ï¼æ¯å¦è¯´æéè¯¯æ è¯çæ¥å¿ï¼å®ææ¥å¿çæ§è§¦ååè­¦~\n> \n> logstashæ¯æå¤ç§è¾åºä»è´¨ï¼æ¯å¦è¯´syslogï¼httpï¼tcpï¼elasticsearch,kafkaç­ï¼å¦ææä»¬å°logstashæ¶éçæ¥å¿è¾åºå°zabbixåè­¦ï¼å°±å¿é¡»è¦ç¨å°logstash-output-zabbixæä»¶ï¼éè¿è¿ä¸ªæä»¶å°logstashä¸zabbixæ´åï¼logstashæ¶éå°çæ°æ®è¿æ»¤åºéè¯¯ä¿¡æ¯çæ¥å¿è¾åºå°zabbixä¸­ï¼æåéè¿zabbixåè­¦æºå¶è§¦åï¼\n\n[root@localhost ~]# /usr/local/logstash/bin/logstash-plugin install logstash-output-zabbix      #å®è£logstash-output-zabbixæä»¶\nValidating logstash-output-zabbix\nInstalling logstash-output-zabbix\nInstallation successful\n\n\n1\n2\n3\n4\n\n\nç¯å¢æ¡ä¾éæ±ï¼\n\néè¿è¯»ç³»ç»æ¥å¿æä»¶ççæ§ï¼è¿æ»¤ææ¥å¿ä¿¡æ¯ä¸­çå¼å¸¸å³é®è¯ï¼å¦ERR,errorï¼Failedï¼warningç­ä¿¡æ¯ï¼å°è¿äºå¸¦æå¼å¸¸å³é®è¯çå¼å¸¸æ¥å¿ä¿¡æ¯è¿æ»¤åºæ¥ï¼ç¶åè¾åºå°zabbixï¼éè¿zabbixåè­¦æºå¶å®ç°è§¦ååè­¦ï¼ä¸é¢ç¯å¢æ¯filebeatä½ä¸ºééç«¯ï¼è¾åºå°kafakaæ¶æ¯éåï¼æåç±logsatshæåæ¥å¿å¹¶è¿æ»¤ï¼è¾åºå°zabbix\n\nfilebeat\n\n- type: log\n\n  # Change to true to enable this input configuration.\n  enabled: true\n\n  # Paths that should be crawled and fetched. Glob based paths.\n  paths:\n    -  /opt/apps/nginx_proxy/log/*.log\n    - /opt/apps/idc/idc_service_go/logs/*.log\n    - /workspace/apps/goldmerry/business_server/storage/logs/*.log\n    - /workspace/apps/goldmerry/cms_server/storage/logs/*.log\n    - /opt/apps/bms/bms_go_server/logs/backend/*.log\n    - /opt/apps/bms/bms_go_server/logs/contractmgr/*.log\n    - /opt/apps/bms/bms_go_server/logs/crm/*.log\n    - /opt/apps/bms/bms_go_server/logs/frontend/*.log\n    - /opt/apps/bms/bms_go_server/logs/product/*.log\n    - /opt/apps/idc/idc_service_go/logs/*.log\n    - /workspace/apps/goldmerry/crm_server/runtime/log/**/*.log\n    - /opt/apps/idc/idc_python/logs/*.log\n    - /opt/apps/idc/idc_python_2/logs/*.log\n    #- c:\\programdata\\elasticsearch\\logs\\*\n  fields:\n    topic: pro-idc_bms-logs\nname: pro_bms_idc\noutput.kafka:\n  hosts: ["xx:9093","xx:9094","xx:9095"]\n  topic: \'%{[fields.topic]}\'\n  partition.round_robin:\n    reachable_only: true\n  required_acks: 1\n\nlogging:\n    to_syslog: false\n    to_files: true\n    files:\n        rotateeverybytes: 10485760 # é»è®¤ç10MB\n        level: info\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\ninput {\n kafka {\n    type => "pro-idc_bms-logs"\n    bootstrap_servers => ["172.16.30.247:9093, 172.16.30.247:9094, 172.16.30.247:9095"]\n    client_id => "pro-idc_bms-logs"\n    topics => ["pro-idc_bms-logs"]\n    consumer_threads => 3\n    codec => "json"\n  }\n}\n\nfilter {\n    if [fields][topic] == "pro-idc_bms-logs" {    #æå®filebeatäº§ççæ¥å¿ä¸»é¢\n             mutate {\n             add_field => [ "[zabbix_key]", "oslogs" ]      #æ°å¢çå­æ®µï¼å­æ®µåæ¯zabbix_keyï¼å¼ä¸ºoslogsã\n             add_field => [ "[zabbix_host]", "%{[host][name]}" ]   #æ°å¢çå­æ®µï¼å­æ®µåæ¯zabbix_hostï¼å¼å¯ä»¥å¨è¿éç´æ¥å®ä¹ï¼ä¹å¯ä»¥å¼ç¨å­æ®µåéæ¥è·åãè¿éç%{[host][name]}è·åçå°±æ¯æ¥å¿æ°æ®çæ¥æºIPï¼è¿ä¸ªæ¥æºIPå¨filebeatéç½®ä¸­çnameéé¡¹è¿è¡å®ä¹ã\n             }\n\n        }\n}\n\n\noutput {\n\n\nif [type] == "pro-idc_bms-logs" {\n\n        if [message]  =~ /(error_code:!=0|ERROR|Failed|éè¯¯åå |status:404|process day|æ°æ®åºæä½å¤±è´¥)/  {\n              zabbix {\n                        zabbix_host => "[zabbix_host]"      #è¿ä¸ªzabbix_hostå°è·åä¸é¢filteré¨åå®ä¹çå­æ®µåé%{[host][name]}çå¼\n                        zabbix_key => "[zabbix_key]"        #è¿ä¸ªzabbix_keyå°è·åä¸é¢filteré¨åä¸­ç»åºçå¼\n                        zabbix_server_host => "172.16.30.241"  #è¿æ¯æå®zabbix serverçIPå°å\n                        zabbix_server_port => "10051"           #è¿æ¯æå®zabbix serverççå¬ç«¯å£\n                        zabbix_value => "message"\n                        }\n                    }\n\n\n  }\n\n}\n\n\nãzabbix-çæ§æ¨¡æ¿åå»ºå° åè­¦ä¸è§¦å³åã\n\n1.åå»ºæ¨¡æ¿\n\nå°è¯æ¨¡æ¿é¾æ¥å°192.168.37.147ä¸ï¼åå»ºçæ¨¡æ¿ä¸ççæ§é¡¹å°±ä¼å¨192.168.37.147ä¸èªå¨çæäº\n\n\n\n2.åå»ºåºç¨éï¼ç¹å»åºç¨é-åå»ºåºç¨é\n\n\n\n3.åå»ºçæ§é¡¹ï¼ç¹å»çæ§é¡¹ï¼åå»ºçæ§é¡¹\n\n\n\n4.åè­¦è§¦åï¼åå»º è§¦åå¨\n\n\n\nå°å±ä»¬åå»ºçæ¶éæ¥å¿çæ¨¡æ¿è¿æ¥å° éè¦æ¶éæ¥å¿çä¸»æºï¼éªè¯åè­¦è§¦åææ\n\n\n\næ³¨æäºé¡¹ï¼filebeatéç½®nameå¿é¡»è¦åzabbixä¸»æºåç§°ä¸è´ï¼ä¸ç¶æ¶éä¸å°æ¥å¿ä¿¡æ¯\n\nå³é­æ¥å¿åè­¦èæ¬\n\n#!/usr/bin/python\n# -*- coding:utf-8 -*-\n\nimport json\nimport requests\n\npost_headers = {\'Content-Type\': \'application/json\'}\n#http://127.0.0.1/zabbix.php zabbixçwebè®¿é®å°åæ¹æapiè®¿é®\nurl = \'http://172.16.30.241:82/api_jsonrpc.php\' \n#è¿éçé´ækeyå¯ä»¥éè¿user.login æ¥å£è·å ç¾åº¦ä¸ä¸å æç¨\n#æç¨4.0çæ¬çzabbix API å®æ¹ææ¡£è¿æ¥ï¼https://www.zabbix.com/documentation/4.0/zh/manual/api/reference/user/login\nkey = \'###############\'\n\npost_data = {\n    "jsonrpc": "2.0",\n    "method": "problem.get",\n    "params": {\n               "output": "extend",\n               "severities": 1\n    },\n    "auth": key,\n    "id": 1\n}\nret = requests.post(url, data=json.dumps(post_data), headers=post_headers)\nresult = json.loads(ret.text)\n#ç¸å³æ¥å£ææ¡£ï¼https://www.zabbix.com/documentation/4.0/zh/manual/api/reference/event/acknowledge\nfor id in json.loads(ret.text)[\'result\']:\n    print(id)\n    post_data = {\n        "jsonrpc": "2.0",\n        "method": "event.acknowledge",\n        "params": {\n            "eventids": id[\'eventid\'],\n            "action": 1,\n            "message": "Problem resolved."\n        },\n        "auth": key,\n        "id": 1\n    }\n    ret = requests.post(url, data=json.dumps(post_data), headers=post_headers)\n    result = json.loads(ret.text)\n    print(result)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n\n\nè·åzabbix token\n\n\n\nåèé¾æ¥\n\nhttps://www.cnblogs.com/bixiaoyu/p/9595698.html\n\nhttps://blog.csdn.net/JineD/article/details/114440164',normalizedContent:'# zabbixæ´åelkæ¶éç³»ç»å¼å¸¸æ¥å¿è§¦ååè­¦\n\n> ä»å¤©æ¥äºè§£ä¸ä¸å³äºelkçâlâ-logstash,æ²¡éï¼å°±æ¯è¿ä¸ªç¥å¥å°ç»ä»¶ï¼æä»¬é½ç¥éï¼å®æ¯elkä¸å¯ç¼ºå°çç»ä»¶ï¼å®æäºè¾å¥ï¼inputï¼ï¼è¿æ»¤ï¼fileterï¼ï¼outputï¼è¾åºï¼å·¥ä½éï¼ä¹æ¯æä»¬ä½ä¸ºè¿ç»´äººåéè¦ææ¡çé¾ç¹ï¼è¯´å°è¿é ï¼åç±åæ¨ï¼âç±ä¹å¥½ï¼æ¨ä¹é¾âï¼è¿ä¸ªlogstashæ¥æè¿å¼ºå¤§çæä»¶åè½ï¼é¤äºå¸®æä»¬è¿æ»¤ï¼é«æçè¾åºæ¥å¿ï¼è¿è½å¸®æä»¬ä¸zabbixçæ§ç¸ç»åï¼\n> \n> å ä¸ºæä»¬çlogstashæ¯æå¤ç§è¾åºç±»åï¼è½å¤æ¶éwebæå¡æ¥å¿ï¼ç³»ç»æ¥å¿ï¼åæ ¸æ¥å¿ï¼ä½æ¯ï¼ç«ç¶æ¯ææ¥å¿è¾åºï¼è¯å®é¿åä¸äºéè¯¯ï¼errorï¼æ¥å¿çåºç°ï¼å½erroræ¥å¿åºç°çæ¶åï¼è½ç¶å¯ä»¥éè¿elkæ¥æ¾åºæ¥ï¼ä½æ¯elkä¸è½å®æ¶æä¾æ¥è­¦ï¼è¿å°±æç¹å°´å°¬äºï¼æä»¬è¦åçå°±æ¯è½å¤åzabbixï¼nagiosçæ§é£æ ·ï¼ä¸è½è¦åå°çæ§ï¼è¿è¦åå°æ¥è­¦ï¼è¿ä¸ç¹ï¼elkåªåå°äºçæ§ï¼ä½æ¯æ²¡æåå°æ¥è­¦ï¼ä¸è¿æ²¡å³ç³»ï¼æä»¬çlogstashæä»¶è½å¤ä¸zabbixç»åèµ·æ¥ï¼å°éè¦åè­¦ çæ¥å¿æ¶éèµ·æ¥ï¼æ¯å¦è¯´æéè¯¯æ è¯çæ¥å¿ï¼å®ææ¥å¿çæ§è§¦ååè­¦~\n> \n> logstashæ¯æå¤ç§è¾åºä»è´¨ï¼æ¯å¦è¯´syslogï¼httpï¼tcpï¼elasticsearch,kafkaç­ï¼å¦ææä»¬å°logstashæ¶éçæ¥å¿è¾åºå°zabbixåè­¦ï¼å°±å¿é¡»è¦ç¨å°logstash-output-zabbixæä»¶ï¼éè¿è¿ä¸ªæä»¶å°logstashä¸zabbixæ´åï¼logstashæ¶éå°çæ°æ®è¿æ»¤åºéè¯¯ä¿¡æ¯çæ¥å¿è¾åºå°zabbixä¸­ï¼æåéè¿zabbixåè­¦æºå¶è§¦åï¼\n\n[root@localhost ~]# /usr/local/logstash/bin/logstash-plugin install logstash-output-zabbix      #å®è£logstash-output-zabbixæä»¶\nvalidating logstash-output-zabbix\ninstalling logstash-output-zabbix\ninstallation successful\n\n\n1\n2\n3\n4\n\n\nç¯å¢æ¡ä¾éæ±ï¼\n\néè¿è¯»ç³»ç»æ¥å¿æä»¶ççæ§ï¼è¿æ»¤ææ¥å¿ä¿¡æ¯ä¸­çå¼å¸¸å³é®è¯ï¼å¦err,errorï¼failedï¼warningç­ä¿¡æ¯ï¼å°è¿äºå¸¦æå¼å¸¸å³é®è¯çå¼å¸¸æ¥å¿ä¿¡æ¯è¿æ»¤åºæ¥ï¼ç¶åè¾åºå°zabbixï¼éè¿zabbixåè­¦æºå¶å®ç°è§¦ååè­¦ï¼ä¸é¢ç¯å¢æ¯filebeatä½ä¸ºééç«¯ï¼è¾åºå°kafakaæ¶æ¯éåï¼æåç±logsatshæåæ¥å¿å¹¶è¿æ»¤ï¼è¾åºå°zabbix\n\nfilebeat\n\n- type: log\n\n  # change to true to enable this input configuration.\n  enabled: true\n\n  # paths that should be crawled and fetched. glob based paths.\n  paths:\n    -  /opt/apps/nginx_proxy/log/*.log\n    - /opt/apps/idc/idc_service_go/logs/*.log\n    - /workspace/apps/goldmerry/business_server/storage/logs/*.log\n    - /workspace/apps/goldmerry/cms_server/storage/logs/*.log\n    - /opt/apps/bms/bms_go_server/logs/backend/*.log\n    - /opt/apps/bms/bms_go_server/logs/contractmgr/*.log\n    - /opt/apps/bms/bms_go_server/logs/crm/*.log\n    - /opt/apps/bms/bms_go_server/logs/frontend/*.log\n    - /opt/apps/bms/bms_go_server/logs/product/*.log\n    - /opt/apps/idc/idc_service_go/logs/*.log\n    - /workspace/apps/goldmerry/crm_server/runtime/log/**/*.log\n    - /opt/apps/idc/idc_python/logs/*.log\n    - /opt/apps/idc/idc_python_2/logs/*.log\n    #- c:\\programdata\\elasticsearch\\logs\\*\n  fields:\n    topic: pro-idc_bms-logs\nname: pro_bms_idc\noutput.kafka:\n  hosts: ["xx:9093","xx:9094","xx:9095"]\n  topic: \'%{[fields.topic]}\'\n  partition.round_robin:\n    reachable_only: true\n  required_acks: 1\n\nlogging:\n    to_syslog: false\n    to_files: true\n    files:\n        rotateeverybytes: 10485760 # é»è®¤ç10mb\n        level: info\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\ninput {\n kafka {\n    type => "pro-idc_bms-logs"\n    bootstrap_servers => ["172.16.30.247:9093, 172.16.30.247:9094, 172.16.30.247:9095"]\n    client_id => "pro-idc_bms-logs"\n    topics => ["pro-idc_bms-logs"]\n    consumer_threads => 3\n    codec => "json"\n  }\n}\n\nfilter {\n    if [fields][topic] == "pro-idc_bms-logs" {    #æå®filebeatäº§ççæ¥å¿ä¸»é¢\n             mutate {\n             add_field => [ "[zabbix_key]", "oslogs" ]      #æ°å¢çå­æ®µï¼å­æ®µåæ¯zabbix_keyï¼å¼ä¸ºoslogsã\n             add_field => [ "[zabbix_host]", "%{[host][name]}" ]   #æ°å¢çå­æ®µï¼å­æ®µåæ¯zabbix_hostï¼å¼å¯ä»¥å¨è¿éç´æ¥å®ä¹ï¼ä¹å¯ä»¥å¼ç¨å­æ®µåéæ¥è·åãè¿éç%{[host][name]}è·åçå°±æ¯æ¥å¿æ°æ®çæ¥æºipï¼è¿ä¸ªæ¥æºipå¨filebeatéç½®ä¸­çnameéé¡¹è¿è¡å®ä¹ã\n             }\n\n        }\n}\n\n\noutput {\n\n\nif [type] == "pro-idc_bms-logs" {\n\n        if [message]  =~ /(error_code:!=0|error|failed|éè¯¯åå |status:404|process day|æ°æ®åºæä½å¤±è´¥)/  {\n              zabbix {\n                        zabbix_host => "[zabbix_host]"      #è¿ä¸ªzabbix_hostå°è·åä¸é¢filteré¨åå®ä¹çå­æ®µåé%{[host][name]}çå¼\n                        zabbix_key => "[zabbix_key]"        #è¿ä¸ªzabbix_keyå°è·åä¸é¢filteré¨åä¸­ç»åºçå¼\n                        zabbix_server_host => "172.16.30.241"  #è¿æ¯æå®zabbix serverçipå°å\n                        zabbix_server_port => "10051"           #è¿æ¯æå®zabbix serverççå¬ç«¯å£\n                        zabbix_value => "message"\n                        }\n                    }\n\n\n  }\n\n}\n\n\nãzabbix-çæ§æ¨¡æ¿åå»ºå° åè­¦ä¸è§¦å³åã\n\n1.åå»ºæ¨¡æ¿\n\nå°è¯æ¨¡æ¿é¾æ¥å°192.168.37.147ä¸ï¼åå»ºçæ¨¡æ¿ä¸ççæ§é¡¹å°±ä¼å¨192.168.37.147ä¸èªå¨çæäº\n\n\n\n2.åå»ºåºç¨éï¼ç¹å»åºç¨é-åå»ºåºç¨é\n\n\n\n3.åå»ºçæ§é¡¹ï¼ç¹å»çæ§é¡¹ï¼åå»ºçæ§é¡¹\n\n\n\n4.åè­¦è§¦åï¼åå»º è§¦åå¨\n\n\n\nå°å±ä»¬åå»ºçæ¶éæ¥å¿çæ¨¡æ¿è¿æ¥å° éè¦æ¶éæ¥å¿çä¸»æºï¼éªè¯åè­¦è§¦åææ\n\n\n\næ³¨æäºé¡¹ï¼filebeatéç½®nameå¿é¡»è¦åzabbixä¸»æºåç§°ä¸è´ï¼ä¸ç¶æ¶éä¸å°æ¥å¿ä¿¡æ¯\n\nå³é­æ¥å¿åè­¦èæ¬\n\n#!/usr/bin/python\n# -*- coding:utf-8 -*-\n\nimport json\nimport requests\n\npost_headers = {\'content-type\': \'application/json\'}\n#http://127.0.0.1/zabbix.php zabbixçwebè®¿é®å°åæ¹æapiè®¿é®\nurl = \'http://172.16.30.241:82/api_jsonrpc.php\' \n#è¿éçé´ækeyå¯ä»¥éè¿user.login æ¥å£è·å ç¾åº¦ä¸ä¸å æç¨\n#æç¨4.0çæ¬çzabbix api å®æ¹ææ¡£è¿æ¥ï¼https://www.zabbix.com/documentation/4.0/zh/manual/api/reference/user/login\nkey = \'###############\'\n\npost_data = {\n    "jsonrpc": "2.0",\n    "method": "problem.get",\n    "params": {\n               "output": "extend",\n               "severities": 1\n    },\n    "auth": key,\n    "id": 1\n}\nret = requests.post(url, data=json.dumps(post_data), headers=post_headers)\nresult = json.loads(ret.text)\n#ç¸å³æ¥å£ææ¡£ï¼https://www.zabbix.com/documentation/4.0/zh/manual/api/reference/event/acknowledge\nfor id in json.loads(ret.text)[\'result\']:\n    print(id)\n    post_data = {\n        "jsonrpc": "2.0",\n        "method": "event.acknowledge",\n        "params": {\n            "eventids": id[\'eventid\'],\n            "action": 1,\n            "message": "problem resolved."\n        },\n        "auth": key,\n        "id": 1\n    }\n    ret = requests.post(url, data=json.dumps(post_data), headers=post_headers)\n    result = json.loads(ret.text)\n    print(result)\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n\n\nè·åzabbix token\n\n\n\nåèé¾æ¥\n\nhttps://www.cnblogs.com/bixiaoyu/p/9595698.html\n\nhttps://blog.csdn.net/jined/article/details/114440164',charsets:{cjk:!0}},{title:"zabbixçæ§windowsè¿ç¨",frontmatter:{title:"zabbixçæ§windowsè¿ç¨",date:"2022-12-20T17:04:24.000Z",permalink:"/pages/269839/",categories:["ä¸é¢","zabbix"],tags:[null],readingShow:"top",description:"å°Zåå­¦æè¿éå°ä¸ªé¡¹ç®éæ±ï¼éæ±æ¯ç¨zabbixçæ§è¿è¡å¨windowsçè¿ç¨ãç¶é¹ï¼å½å°Zåå­¦å¨ç½ä¸æäºä¸å¤§å ï¼åç°åºæ¬ä¸é½æ¯ä½¿ç¨å®æ¹çproc.num(*.exe)é®å¼æ¿å°è¿ç¨æ°éï¼å¾æ¾ç¶ï¼è¿å¹¶ä¸ç¬¦åå®¢æ·å®éçéæ±ï¼å¦ææ¯åªè¿è¡1ä¸ªçè¿å¥½ï¼è¥æ¯è¿è¡äº3å°6ä¸ªï¼ä¾å¦javaï¼å°±ç¹å«çdanç¼ï¼å¨ä»»å¡ç®¡çå¨åç°å¨æ¯java.exeçãä¹è®¸ï¼ä½ å¯ä»¥æ¾å°æäºæç« çè¯´å¯ä»¥ä½¿ç¨ä»»å¡ç®¡çå¨å¯ä»¥çå°å½ä»¤è¡ï¼å¾ä¸ï¼ï¼tasklist /Væ¥çè¿ç¨è¯¦æï¼å¾äºï¼ç­ç­ï¼ç¶é¹ï¼å¯¹äºjavaæ¥è¯´è¿æ¯çä¸å°çã\n> å½ç¶äºæ¿å°java.exeåpidä¹å¯ä»¥ï¼ä½ä½ä¸ºè¿ç»´äººåæå³æ³¨çæ¯è¦ç¥éæ¯è°åäºï¼èä¸æ¯PIDï¼åµä¸äººå®¶ä¹ä¸ç¥éPIDå¯¹åºçè¿ç¨æ¯å¥ãæä»¥ï¼æ¬çä¸è¿è´è´£çç²¾ç¥ï¼å¨æ¥éäºå å¤©çèµæåï¼ç»äºå®ç°äºï¼ï¼ï¼å¨è¿éè®°å½ä¸æ¥ï¼ä¸ºç­ç±zabbixçå°ä¼ä¼´åä¸ªåèï¼ä¹å¯ä»¥èªè¡æå±ç»åèæ¬ç­å¶ä»ææ¯å®ç°ãæç¨ä¸å¤æï¼å¤åå æ¬¡å°±ä¸æäºã",meta:[{name:"image",content:"https://img-blog.csdnimg.cn/20200417105538630.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzYzMTYzMQ==,size_16,color_FFFFFF,t_70"},{name:"twitter:title",content:"zabbixçæ§windowsè¿ç¨"},{name:"twitter:description",content:"å°Zåå­¦æè¿éå°ä¸ªé¡¹ç®éæ±ï¼éæ±æ¯ç¨zabbixçæ§è¿è¡å¨windowsçè¿ç¨ãç¶é¹ï¼å½å°Zåå­¦å¨ç½ä¸æäºä¸å¤§å ï¼åç°åºæ¬ä¸é½æ¯ä½¿ç¨å®æ¹çproc.num(*.exe)é®å¼æ¿å°è¿ç¨æ°éï¼å¾æ¾ç¶ï¼è¿å¹¶ä¸ç¬¦åå®¢æ·å®éçéæ±ï¼å¦ææ¯åªè¿è¡1ä¸ªçè¿å¥½ï¼è¥æ¯è¿è¡äº3å°6ä¸ªï¼ä¾å¦javaï¼å°±ç¹å«çdanç¼ï¼å¨ä»»å¡ç®¡çå¨åç°å¨æ¯java.exeçãä¹è®¸ï¼ä½ å¯ä»¥æ¾å°æäºæç« çè¯´å¯ä»¥ä½¿ç¨ä»»å¡ç®¡çå¨å¯ä»¥çå°å½ä»¤è¡ï¼å¾ä¸ï¼ï¼tasklist /Væ¥çè¿ç¨è¯¦æï¼å¾äºï¼ç­ç­ï¼ç¶é¹ï¼å¯¹äºjavaæ¥è¯´è¿æ¯çä¸å°çã\n> å½ç¶äºæ¿å°java.exeåpidä¹å¯ä»¥ï¼ä½ä½ä¸ºè¿ç»´äººåæå³æ³¨çæ¯è¦ç¥éæ¯è°åäºï¼èä¸æ¯PIDï¼åµä¸äººå®¶ä¹ä¸ç¥éPIDå¯¹åºçè¿ç¨æ¯å¥ãæä»¥ï¼æ¬çä¸è¿è´è´£çç²¾ç¥ï¼å¨æ¥éäºå å¤©çèµæåï¼ç»äºå®ç°äºï¼ï¼ï¼å¨è¿éè®°å½ä¸æ¥ï¼ä¸ºç­ç±zabbixçå°ä¼ä¼´åä¸ªåèï¼ä¹å¯ä»¥èªè¡æå±ç»åèæ¬ç­å¶ä»ææ¯å®ç°ãæç¨ä¸å¤æï¼å¤åå æ¬¡å°±ä¸æäºã"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://img-blog.csdnimg.cn/20200417105538630.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzYzMTYzMQ==,size_16,color_FFFFFF,t_70"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/07.zabbix%E7%9B%91%E6%8E%A7windows%E8%BF%9B%E7%A8%8B.html"},{property:"og:type",content:"article"},{property:"og:title",content:"zabbixçæ§windowsè¿ç¨"},{property:"og:description",content:"å°Zåå­¦æè¿éå°ä¸ªé¡¹ç®éæ±ï¼éæ±æ¯ç¨zabbixçæ§è¿è¡å¨windowsçè¿ç¨ãç¶é¹ï¼å½å°Zåå­¦å¨ç½ä¸æäºä¸å¤§å ï¼åç°åºæ¬ä¸é½æ¯ä½¿ç¨å®æ¹çproc.num(*.exe)é®å¼æ¿å°è¿ç¨æ°éï¼å¾æ¾ç¶ï¼è¿å¹¶ä¸ç¬¦åå®¢æ·å®éçéæ±ï¼å¦ææ¯åªè¿è¡1ä¸ªçè¿å¥½ï¼è¥æ¯è¿è¡äº3å°6ä¸ªï¼ä¾å¦javaï¼å°±ç¹å«çdanç¼ï¼å¨ä»»å¡ç®¡çå¨åç°å¨æ¯java.exeçãä¹è®¸ï¼ä½ å¯ä»¥æ¾å°æäºæç« çè¯´å¯ä»¥ä½¿ç¨ä»»å¡ç®¡çå¨å¯ä»¥çå°å½ä»¤è¡ï¼å¾ä¸ï¼ï¼tasklist /Væ¥çè¿ç¨è¯¦æï¼å¾äºï¼ç­ç­ï¼ç¶é¹ï¼å¯¹äºjavaæ¥è¯´è¿æ¯çä¸å°çã\n> å½ç¶äºæ¿å°java.exeåpidä¹å¯ä»¥ï¼ä½ä½ä¸ºè¿ç»´äººåæå³æ³¨çæ¯è¦ç¥éæ¯è°åäºï¼èä¸æ¯PIDï¼åµä¸äººå®¶ä¹ä¸ç¥éPIDå¯¹åºçè¿ç¨æ¯å¥ãæä»¥ï¼æ¬çä¸è¿è´è´£çç²¾ç¥ï¼å¨æ¥éäºå å¤©çèµæåï¼ç»äºå®ç°äºï¼ï¼ï¼å¨è¿éè®°å½ä¸æ¥ï¼ä¸ºç­ç±zabbixçå°ä¼ä¼´åä¸ªåèï¼ä¹å¯ä»¥èªè¡æå±ç»åèæ¬ç­å¶ä»ææ¯å®ç°ãæç¨ä¸å¤æï¼å¤åå æ¬¡å°±ä¸æäºã"},{property:"og:image",content:"https://img-blog.csdnimg.cn/20200417105538630.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzYzMTYzMQ==,size_16,color_FFFFFF,t_70"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/07.zabbix%E7%9B%91%E6%8E%A7windows%E8%BF%9B%E7%A8%8B.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-20T17:04:24.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"zabbixçæ§windowsè¿ç¨"},{itemprop:"description",content:"å°Zåå­¦æè¿éå°ä¸ªé¡¹ç®éæ±ï¼éæ±æ¯ç¨zabbixçæ§è¿è¡å¨windowsçè¿ç¨ãç¶é¹ï¼å½å°Zåå­¦å¨ç½ä¸æäºä¸å¤§å ï¼åç°åºæ¬ä¸é½æ¯ä½¿ç¨å®æ¹çproc.num(*.exe)é®å¼æ¿å°è¿ç¨æ°éï¼å¾æ¾ç¶ï¼è¿å¹¶ä¸ç¬¦åå®¢æ·å®éçéæ±ï¼å¦ææ¯åªè¿è¡1ä¸ªçè¿å¥½ï¼è¥æ¯è¿è¡äº3å°6ä¸ªï¼ä¾å¦javaï¼å°±ç¹å«çdanç¼ï¼å¨ä»»å¡ç®¡çå¨åç°å¨æ¯java.exeçãä¹è®¸ï¼ä½ å¯ä»¥æ¾å°æäºæç« çè¯´å¯ä»¥ä½¿ç¨ä»»å¡ç®¡çå¨å¯ä»¥çå°å½ä»¤è¡ï¼å¾ä¸ï¼ï¼tasklist /Væ¥çè¿ç¨è¯¦æï¼å¾äºï¼ç­ç­ï¼ç¶é¹ï¼å¯¹äºjavaæ¥è¯´è¿æ¯çä¸å°çã\n> å½ç¶äºæ¿å°java.exeåpidä¹å¯ä»¥ï¼ä½ä½ä¸ºè¿ç»´äººåæå³æ³¨çæ¯è¦ç¥éæ¯è°åäºï¼èä¸æ¯PIDï¼åµä¸äººå®¶ä¹ä¸ç¥éPIDå¯¹åºçè¿ç¨æ¯å¥ãæä»¥ï¼æ¬çä¸è¿è´è´£çç²¾ç¥ï¼å¨æ¥éäºå å¤©çèµæåï¼ç»äºå®ç°äºï¼ï¼ï¼å¨è¿éè®°å½ä¸æ¥ï¼ä¸ºç­ç±zabbixçå°ä¼ä¼´åä¸ªåèï¼ä¹å¯ä»¥èªè¡æå±ç»åèæ¬ç­å¶ä»ææ¯å®ç°ãæç¨ä¸å¤æï¼å¤åå æ¬¡å°±ä¸æäºã"},{itemprop:"image",content:"https://img-blog.csdnimg.cn/20200417105538630.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzYzMTYzMQ==,size_16,color_FFFFFF,t_70"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/07.zabbix%E7%9B%91%E6%8E%A7windows%E8%BF%9B%E7%A8%8B.html",relativePath:"04.è¿ç»´/12.çæ§/01.zabbix/07.zabbixçæ§windowsè¿ç¨.md",key:"v-3bd0d01e",path:"/pages/269839/",headersStr:null,content:"> å°Zåå­¦æè¿éå°ä¸ªé¡¹ç®éæ±ï¼éæ±æ¯ç¨zabbixçæ§è¿è¡å¨windowsçè¿ç¨ãç¶é¹ï¼å½å°Zåå­¦å¨ç½ä¸æäºä¸å¤§å ï¼åç°åºæ¬ä¸é½æ¯ä½¿ç¨å®æ¹çproc.num(***.exe)é®å¼æ¿å°è¿ç¨æ°éï¼å¾æ¾ç¶ï¼è¿å¹¶ä¸ç¬¦åå®¢æ·å®éçéæ±ï¼å¦ææ¯åªè¿è¡1ä¸ªçè¿å¥½ï¼è¥æ¯è¿è¡äº3å°6ä¸ªï¼ä¾å¦javaï¼å°±ç¹å«çdanç¼ï¼å¨ä»»å¡ç®¡çå¨åç°å¨æ¯java.exeçãä¹è®¸ï¼ä½ å¯ä»¥æ¾å°æäºæç« çè¯´å¯ä»¥ä½¿ç¨ä»»å¡ç®¡çå¨å¯ä»¥çå°å½ä»¤è¡ï¼å¾ä¸ï¼ï¼tasklist /Væ¥çè¿ç¨è¯¦æï¼å¾äºï¼ç­ç­ï¼ç¶é¹ï¼å¯¹äºjavaæ¥è¯´è¿æ¯çä¸å°çã å½ç¶äºæ¿å°java.exeåpidä¹å¯ä»¥ï¼ä½ä½ä¸ºè¿ç»´äººåæå³æ³¨çæ¯è¦ç¥éæ¯è°åäºï¼èä¸æ¯PIDï¼åµä¸äººå®¶ä¹ä¸ç¥éPIDå¯¹åºçè¿ç¨æ¯å¥ãæä»¥ï¼æ¬çä¸è¿è´è´£çç²¾ç¥ï¼å¨æ¥éäºå å¤©çèµæåï¼ç»äºå®ç°äºï¼ï¼ï¼å¨è¿éè®°å½ä¸æ¥ï¼ä¸ºç­ç±zabbixçå°ä¼ä¼´åä¸ªåèï¼ä¹å¯ä»¥èªè¡æå±ç»åèæ¬ç­å¶ä»ææ¯å®ç°ãæç¨ä¸å¤æï¼å¤åå æ¬¡å°±ä¸æäºã\n\n\n\n\n\næ¹æ³ï¼\n\nå¯¹äºéjavaçè¿ç¨ï¼ç¡®å®ä½¿ç¨tasklistå¯ä»¥çæ§å°å·ä½çè¿ç¨åï¼ä¾å¦çæ§é®ç®±æå¡å¨ç¨åºï¼æ¹æ³æ¯æå¼cmdï¼è¾å¥ tasklist | findstr âmailServer.exeâ è¿éåªè¾åºå·ä½çè¿ç¨å æè tasklist | find âmailServer.exeâ è¿éä¼è¾åºè¿ç¨ï¼ä½¿ç¨çèµæºï¼PIDç­ç­ãç¶ååzabbix_agentd.confåé¢å ä¸ UserParameter=mailServer, tasklist | findstr âmailServer.exeâ ä¿å­éå¯agentï¼å¨zabbixåçæ§æ¶ï¼ä¿¡æ¯ç±»åéæ©å­ç¬¦æèææ¬å³å¯ã éç¹æ¥äºï¼å¯¹äºjavaè¿ç¨äº¦æèæ¯å¨ä»»å¡ç®¡çå¨åªçå°è¿è¡äºä¸å ç¸åçè¿ç¨åï¼ä½çä¸å°å·ä½çå®ä¾åå¯ä»¥å©ç¨windowsèªå¸¦ç WMICå½ä»¤æ¥è·åï¼æå¼cmdï¼è¾å¥ wmic process åè½¦ï¼ä¼è¾åºç®åå¨è¿è¡çææè¿ç¨ï¼æ¯tasklistè¿è¯¦ç»ï¼è¾åºçç»æåå«å½ä»¤è¡ãæ§è¡è·¯å¾ãPIDãä½¿ç¨çèµæºãææèç­ç­ãæå´è¶£çå°ä¼ä¼´å¯ä»¥å°å®ç½å¤å¤äºè§£ï¼æå±ä¸ä¸å¶ä»çWMICåæ°ã å½ç¶äºï¼å¯¹äºå°è£å¥½çjaråç¨åºï¼å¸¸è§çæ§è¡å½ä»¤ä¹å°±æ¯java âjar ****.jarï¼æ¯å¯ä»¥ç¨wmicæ¿å°çï¼å½ä»¤æ¯ wmic process where name=âjava.exeâ å°±å¯ä»¥è¾åºå½åæ­£å¨è¿è¡çææjavaè¿ç¨ï¼ä½ç»æä¸å¤ªç¾è§ï¼æä»¥å¯ä»¥æå®ä¸ä¸è¦æ¾çjarååï¼ä¾å¦ï¼ wimc process where name=âjava.exeâ | find âjarååâ ï¼è¿æ ·åºæ¥çç»æå°±æ¯å®¢æ·æ³è¦çäºã\n\n\n\nä»¥ä¸æ¯agentéç½®ç¤ºä¾ï¼ UserParameter=java_jar, WMIC.exe process where name=âjava.exeâ | find âjarååâ è¿éä¿é©ä¸ç¹ï¼åä¸å®æ´çWMIC.exeå°±ä¸ä¼æ¥å½ä»¤æ¾ä¸å°çéãçæ§é¡¹ç§ä¸ä¸æ­¥ã è§¦åå¨ å¨ç»éæ°å¼ççæ§éç½®è§¦åå¨æ¶ï¼è¦æ³¨æç±»åè¦éæ©çº¢æ¡ç str()\n\n\n\nå ä¸ºè¿åçç»ææ¯å­ç¬¦ä¸²ï¼æä»¥å¨Vè¿éå¡«ä¸jaråè¿ç¨åå³å¯ãå¯ä»¥åªååå+çæ¬ï¼ä¸ç¨æ´è¡é½åã\n\n\n\né®é¢åæ¢å¤çè¡¨è¾¾å¼ï¼çæ§é¡¹æ¯æ¯60sæ£æµä¸æ¬¡ï¼è§¦åå¨è¿éä¹æ¯æ¯60sæ£æµä¸æ¬¡ï¼åç°ååå¼ä¸ç¬¦ååéåè­¦ä¿¡æ¯ãå¦æåç°ä¹±æ¥è­¦ï¼é£å°±å¤æ³¨æè°æ´ä¸ã\n\n\n\nå®æåï¼å¯ä»¥åæ­¢ç¨åºæ£æµä¸æ¯å¦ç¬¦åéæ±ã\n\nåæé¾æ¥ï¼\n\nhttps://blog.csdn.net/weixin_43631631/article/details/105575412",normalizedContent:"> å°zåå­¦æè¿éå°ä¸ªé¡¹ç®éæ±ï¼éæ±æ¯ç¨zabbixçæ§è¿è¡å¨windowsçè¿ç¨ãç¶é¹ï¼å½å°zåå­¦å¨ç½ä¸æäºä¸å¤§å ï¼åç°åºæ¬ä¸é½æ¯ä½¿ç¨å®æ¹çproc.num(***.exe)é®å¼æ¿å°è¿ç¨æ°éï¼å¾æ¾ç¶ï¼è¿å¹¶ä¸ç¬¦åå®¢æ·å®éçéæ±ï¼å¦ææ¯åªè¿è¡1ä¸ªçè¿å¥½ï¼è¥æ¯è¿è¡äº3å°6ä¸ªï¼ä¾å¦javaï¼å°±ç¹å«çdanç¼ï¼å¨ä»»å¡ç®¡çå¨åç°å¨æ¯java.exeçãä¹è®¸ï¼ä½ å¯ä»¥æ¾å°æäºæç« çè¯´å¯ä»¥ä½¿ç¨ä»»å¡ç®¡çå¨å¯ä»¥çå°å½ä»¤è¡ï¼å¾ä¸ï¼ï¼tasklist /væ¥çè¿ç¨è¯¦æï¼å¾äºï¼ç­ç­ï¼ç¶é¹ï¼å¯¹äºjavaæ¥è¯´è¿æ¯çä¸å°çã å½ç¶äºæ¿å°java.exeåpidä¹å¯ä»¥ï¼ä½ä½ä¸ºè¿ç»´äººåæå³æ³¨çæ¯è¦ç¥éæ¯è°åäºï¼èä¸æ¯pidï¼åµä¸äººå®¶ä¹ä¸ç¥épidå¯¹åºçè¿ç¨æ¯å¥ãæä»¥ï¼æ¬çä¸è¿è´è´£çç²¾ç¥ï¼å¨æ¥éäºå å¤©çèµæåï¼ç»äºå®ç°äºï¼ï¼ï¼å¨è¿éè®°å½ä¸æ¥ï¼ä¸ºç­ç±zabbixçå°ä¼ä¼´åä¸ªåèï¼ä¹å¯ä»¥èªè¡æå±ç»åèæ¬ç­å¶ä»ææ¯å®ç°ãæç¨ä¸å¤æï¼å¤åå æ¬¡å°±ä¸æäºã\n\n\n\n\n\næ¹æ³ï¼\n\nå¯¹äºéjavaçè¿ç¨ï¼ç¡®å®ä½¿ç¨tasklistå¯ä»¥çæ§å°å·ä½çè¿ç¨åï¼ä¾å¦çæ§é®ç®±æå¡å¨ç¨åºï¼æ¹æ³æ¯æå¼cmdï¼è¾å¥ tasklist | findstr âmailserver.exeâ è¿éåªè¾åºå·ä½çè¿ç¨å æè tasklist | find âmailserver.exeâ è¿éä¼è¾åºè¿ç¨ï¼ä½¿ç¨çèµæºï¼pidç­ç­ãç¶ååzabbix_agentd.confåé¢å ä¸ userparameter=mailserver, tasklist | findstr âmailserver.exeâ ä¿å­éå¯agentï¼å¨zabbixåçæ§æ¶ï¼ä¿¡æ¯ç±»åéæ©å­ç¬¦æèææ¬å³å¯ã éç¹æ¥äºï¼å¯¹äºjavaè¿ç¨äº¦æèæ¯å¨ä»»å¡ç®¡çå¨åªçå°è¿è¡äºä¸å ç¸åçè¿ç¨åï¼ä½çä¸å°å·ä½çå®ä¾åå¯ä»¥å©ç¨windowsèªå¸¦ç wmicå½ä»¤æ¥è·åï¼æå¼cmdï¼è¾å¥ wmic process åè½¦ï¼ä¼è¾åºç®åå¨è¿è¡çææè¿ç¨ï¼æ¯tasklistè¿è¯¦ç»ï¼è¾åºçç»æåå«å½ä»¤è¡ãæ§è¡è·¯å¾ãpidãä½¿ç¨çèµæºãææèç­ç­ãæå´è¶£çå°ä¼ä¼´å¯ä»¥å°å®ç½å¤å¤äºè§£ï¼æå±ä¸ä¸å¶ä»çwmicåæ°ã å½ç¶äºï¼å¯¹äºå°è£å¥½çjaråç¨åºï¼å¸¸è§çæ§è¡å½ä»¤ä¹å°±æ¯java âjar ****.jarï¼æ¯å¯ä»¥ç¨wmicæ¿å°çï¼å½ä»¤æ¯ wmic process where name=âjava.exeâ å°±å¯ä»¥è¾åºå½åæ­£å¨è¿è¡çææjavaè¿ç¨ï¼ä½ç»æä¸å¤ªç¾è§ï¼æä»¥å¯ä»¥æå®ä¸ä¸è¦æ¾çjarååï¼ä¾å¦ï¼ wimc process where name=âjava.exeâ | find âjarååâ ï¼è¿æ ·åºæ¥çç»æå°±æ¯å®¢æ·æ³è¦çäºã\n\n\n\nä»¥ä¸æ¯agentéç½®ç¤ºä¾ï¼ userparameter=java_jar, wmic.exe process where name=âjava.exeâ | find âjarååâ è¿éä¿é©ä¸ç¹ï¼åä¸å®æ´çwmic.exeå°±ä¸ä¼æ¥å½ä»¤æ¾ä¸å°çéãçæ§é¡¹ç§ä¸ä¸æ­¥ã è§¦åå¨ å¨ç»éæ°å¼ççæ§éç½®è§¦åå¨æ¶ï¼è¦æ³¨æç±»åè¦éæ©çº¢æ¡ç str()\n\n\n\nå ä¸ºè¿åçç»ææ¯å­ç¬¦ä¸²ï¼æä»¥å¨vè¿éå¡«ä¸jaråè¿ç¨åå³å¯ãå¯ä»¥åªååå+çæ¬ï¼ä¸ç¨æ´è¡é½åã\n\n\n\né®é¢åæ¢å¤çè¡¨è¾¾å¼ï¼çæ§é¡¹æ¯æ¯60sæ£æµä¸æ¬¡ï¼è§¦åå¨è¿éä¹æ¯æ¯60sæ£æµä¸æ¬¡ï¼åç°ååå¼ä¸ç¬¦ååéåè­¦ä¿¡æ¯ãå¦æåç°ä¹±æ¥è­¦ï¼é£å°±å¤æ³¨æè°æ´ä¸ã\n\n\n\nå®æåï¼å¯ä»¥åæ­¢ç¨åºæ£æµä¸æ¯å¦ç¬¦åéæ±ã\n\nåæé¾æ¥ï¼\n\nhttps://blog.csdn.net/weixin_43631631/article/details/105575412",charsets:{cjk:!0}},{title:"zabbixæ·»å è¿ç¨pidçæ§",frontmatter:{title:"zabbixæ·»å è¿ç¨pidçæ§",date:"2022-12-20T17:02:20.000Z",permalink:"/pages/20f905/",categories:["ä¸é¢","zabbix"],tags:[null],readingShow:"top",description:"ZabbixÂ çæ§è¿ç¨å®æº\n>\n> Â Â ä¸å¡éæ±åç«¯è¿ç¨å®æºä»¥åè½å¨ç­æ¶é´åè¿éæèµ·ï¼ä¸å¡å½±åä¸å¤§ï¼ä½æ¯å¼åéè¦æ¥çcoredumpï¼è¦æ±è½çæ§å°pidååï¼å¨ç°æææ¶ä¸zabbixè½çæ§å¹¶æ¥è­¦ï¼\n>\n> å½ç¶zabbixè®¾ç½®æ¥è­¦è®¾ç½®å°±ä¸åä¸ä¸",meta:[{name:"image",content:"https://s1.51cto.com/images/20180223/1519371651993152.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk="},{name:"twitter:title",content:"zabbixæ·»å è¿ç¨pidçæ§"},{name:"twitter:description",content:"ZabbixÂ çæ§è¿ç¨å®æº\n>\n> Â Â ä¸å¡éæ±åç«¯è¿ç¨å®æºä»¥åè½å¨ç­æ¶é´åè¿éæèµ·ï¼ä¸å¡å½±åä¸å¤§ï¼ä½æ¯å¼åéè¦æ¥çcoredumpï¼è¦æ±è½çæ§å°pidååï¼å¨ç°æææ¶ä¸zabbixè½çæ§å¹¶æ¥è­¦ï¼\n>\n> å½ç¶zabbixè®¾ç½®æ¥è­¦è®¾ç½®å°±ä¸åä¸ä¸"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://s1.51cto.com/images/20180223/1519371651993152.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk="},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/06.zabbix%E6%B7%BB%E5%8A%A0%E8%BF%9B%E7%A8%8Bpid%E7%9B%91%E6%8E%A7.html"},{property:"og:type",content:"article"},{property:"og:title",content:"zabbixæ·»å è¿ç¨pidçæ§"},{property:"og:description",content:"ZabbixÂ çæ§è¿ç¨å®æº\n>\n> Â Â ä¸å¡éæ±åç«¯è¿ç¨å®æºä»¥åè½å¨ç­æ¶é´åè¿éæèµ·ï¼ä¸å¡å½±åä¸å¤§ï¼ä½æ¯å¼åéè¦æ¥çcoredumpï¼è¦æ±è½çæ§å°pidååï¼å¨ç°æææ¶ä¸zabbixè½çæ§å¹¶æ¥è­¦ï¼\n>\n> å½ç¶zabbixè®¾ç½®æ¥è­¦è®¾ç½®å°±ä¸åä¸ä¸"},{property:"og:image",content:"https://s1.51cto.com/images/20180223/1519371651993152.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk="},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/06.zabbix%E6%B7%BB%E5%8A%A0%E8%BF%9B%E7%A8%8Bpid%E7%9B%91%E6%8E%A7.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-20T17:02:20.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"zabbixæ·»å è¿ç¨pidçæ§"},{itemprop:"description",content:"ZabbixÂ çæ§è¿ç¨å®æº\n>\n> Â Â ä¸å¡éæ±åç«¯è¿ç¨å®æºä»¥åè½å¨ç­æ¶é´åè¿éæèµ·ï¼ä¸å¡å½±åä¸å¤§ï¼ä½æ¯å¼åéè¦æ¥çcoredumpï¼è¦æ±è½çæ§å°pidååï¼å¨ç°æææ¶ä¸zabbixè½çæ§å¹¶æ¥è­¦ï¼\n>\n> å½ç¶zabbixè®¾ç½®æ¥è­¦è®¾ç½®å°±ä¸åä¸ä¸"},{itemprop:"image",content:"https://s1.51cto.com/images/20180223/1519371651993152.png?x-oss-process=image/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_100,g_se,x_10,y_10,shadow_90,type_ZmFuZ3poZW5naGVpdGk="}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/06.zabbix%E6%B7%BB%E5%8A%A0%E8%BF%9B%E7%A8%8Bpid%E7%9B%91%E6%8E%A7.html",relativePath:"04.è¿ç»´/12.çæ§/01.zabbix/06.zabbixæ·»å è¿ç¨pidçæ§.md",key:"v-1955a3de",path:"/pages/20f905/",headersStr:null,content:"> ZabbixÂ çæ§è¿ç¨å®æº\n> \n> ä¸å¡éæ±åç«¯è¿ç¨å®æºä»¥åè½å¨ç­æ¶é´åè¿éæèµ·ï¼ä¸å¡å½±åä¸å¤§ï¼ä½æ¯å¼åéè¦æ¥çcoredumpï¼è¦æ±è½çæ§å°pidååï¼å¨ç°æææ¶ä¸zabbixè½çæ§å¹¶æ¥è­¦ï¼\n> \n> å½ç¶zabbixè®¾ç½®æ¥è­¦è®¾ç½®å°±ä¸åä¸ä¸\n\nå¨æ¯å°æå¡å¨/etc/zabbix/zabbix_agentd.confè®¾ç½®è·¯å¾ï¼æ­¤ä¾åªéè¦piddiff.sh\n\nUserParameter=checkpid,sh /usr/local/script/piddiff.sh\n\nUserParameter=test,sh /usr/local/script/test.sh\n\nUserParameter=discovery.process,/usr/local/script/disprocess.sh\n\nUserParameter=process.check[*],/usr/local/script/proc_check.sh $1 $2 $3\n\n\n/usr/local/scriptä¸é¢å­æ¾èæ¬\n\nVim piddiff.sh\n\naapidä¸ºä¸å¡çæ§idÂ åå¼æ ¹æ®ä¸å¡éæ±ï¼\n\n#/bin/sh\n\nonl_ok=1\n\nonl_cored=3\n\ndir=/usr/local/script\n\nif [[ ! -f \"$dir/old.txt\" ]];then\n\n ps aux|grep aapid |grep -v grep|grep -v /bin/bash|awk  '{print $2,$11}' > $dir/old.txt\n\n      else\n\n         sleep 1s           \n\nfi\n\n ps aux|grep aapid |grep -v grep|grep -v /bin/bash|awk  '{print $2,$11}' > $dir/now.txt\n\nif ! diff -q $dir/old.txt  $dir/now.txt > /dev/null; then\n\n          echo $onl_cored\n\n          diff -c $dir/old.txt  $dir/now.txt > $dir/`date \"+%Y%m%d%H%M\"`_diff.txt\n\n          cat $dir/now.txt >$dir/old.txt\n\n     else\n\n          echo $onl_ok    \n\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nä¸ä¸ªç®åçå¤æ­èæ¬ï¼\n\nZabbix30ç§ä¼æåä¸æ¬¡ï¼æ­£å¸¸æ²¡ååä¸º1ï¼æååä¸º3ï¼é£ä¹zabbixæåæ°å¼ä¸º3åè¡¨ç¤ºpidæååï¼ä¼ååºè­¦æ¥ï¼\n\nZabbixè®¾ç½®ï¼\n\nçæ§é¡¹æ¨¡æ¿æ·»å å¦ä¸ï¼\n\n\n\nè§¦åå¨ï¼{Template OS Linux:checkpid.last()}=3\n\n\n\nè½¬è½½äº:https://blog.51cto.com/xpu2001/2072366",normalizedContent:"> zabbixÂ çæ§è¿ç¨å®æº\n> \n> ä¸å¡éæ±åç«¯è¿ç¨å®æºä»¥åè½å¨ç­æ¶é´åè¿éæèµ·ï¼ä¸å¡å½±åä¸å¤§ï¼ä½æ¯å¼åéè¦æ¥çcoredumpï¼è¦æ±è½çæ§å°pidååï¼å¨ç°æææ¶ä¸zabbixè½çæ§å¹¶æ¥è­¦ï¼\n> \n> å½ç¶zabbixè®¾ç½®æ¥è­¦è®¾ç½®å°±ä¸åä¸ä¸\n\nå¨æ¯å°æå¡å¨/etc/zabbix/zabbix_agentd.confè®¾ç½®è·¯å¾ï¼æ­¤ä¾åªéè¦piddiff.sh\n\nuserparameter=checkpid,sh /usr/local/script/piddiff.sh\n\nuserparameter=test,sh /usr/local/script/test.sh\n\nuserparameter=discovery.process,/usr/local/script/disprocess.sh\n\nuserparameter=process.check[*],/usr/local/script/proc_check.sh $1 $2 $3\n\n\n/usr/local/scriptä¸é¢å­æ¾èæ¬\n\nvim piddiff.sh\n\naapidä¸ºä¸å¡çæ§idÂ åå¼æ ¹æ®ä¸å¡éæ±ï¼\n\n#/bin/sh\n\nonl_ok=1\n\nonl_cored=3\n\ndir=/usr/local/script\n\nif [[ ! -f \"$dir/old.txt\" ]];then\n\n ps aux|grep aapid |grep -v grep|grep -v /bin/bash|awk  '{print $2,$11}' > $dir/old.txt\n\n      else\n\n         sleep 1s           \n\nfi\n\n ps aux|grep aapid |grep -v grep|grep -v /bin/bash|awk  '{print $2,$11}' > $dir/now.txt\n\nif ! diff -q $dir/old.txt  $dir/now.txt > /dev/null; then\n\n          echo $onl_cored\n\n          diff -c $dir/old.txt  $dir/now.txt > $dir/`date \"+%y%m%d%h%m\"`_diff.txt\n\n          cat $dir/now.txt >$dir/old.txt\n\n     else\n\n          echo $onl_ok    \n\nfi\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n\n\nä¸ä¸ªç®åçå¤æ­èæ¬ï¼\n\nzabbix30ç§ä¼æåä¸æ¬¡ï¼æ­£å¸¸æ²¡ååä¸º1ï¼æååä¸º3ï¼é£ä¹zabbixæåæ°å¼ä¸º3åè¡¨ç¤ºpidæååï¼ä¼ååºè­¦æ¥ï¼\n\nzabbixè®¾ç½®ï¼\n\nçæ§é¡¹æ¨¡æ¿æ·»å å¦ä¸ï¼\n\n\n\nè§¦åå¨ï¼{template os linux:checkpid.last()}=3\n\n\n\nè½¬è½½äº:https://blog.51cto.com/xpu2001/2072366",charsets:{cjk:!0}},{title:"zabbixæ·»å webçæ§",frontmatter:{title:"zabbixæ·»å webçæ§",date:"2022-12-21T17:35:46.000Z",permalink:"/pages/b70eb8/",categories:["ä¸é¢","zabbix"],tags:[null],readingShow:"top",description:"ç¹å»éç½®-ä¸»æº-æçæå¡å¨-webåºæ¯-åå»ºwebåºæ¯-æä¸é¢å¡«åæ­¥éª¤",meta:[{name:"image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/20221212Dingtalk_20221221174005.jpg"},{name:"twitter:title",content:"zabbixæ·»å webçæ§"},{name:"twitter:description",content:"ç¹å»éç½®-ä¸»æº-æçæå¡å¨-webåºæ¯-åå»ºwebåºæ¯-æä¸é¢å¡«åæ­¥éª¤"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/20221212Dingtalk_20221221174005.jpg"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/08.zabbix%E6%B7%BB%E5%8A%A0web%E7%9B%91%E6%8E%A7.html"},{property:"og:type",content:"article"},{property:"og:title",content:"zabbixæ·»å webçæ§"},{property:"og:description",content:"ç¹å»éç½®-ä¸»æº-æçæå¡å¨-webåºæ¯-åå»ºwebåºæ¯-æä¸é¢å¡«åæ­¥éª¤"},{property:"og:image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/20221212Dingtalk_20221221174005.jpg"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/08.zabbix%E6%B7%BB%E5%8A%A0web%E7%9B%91%E6%8E%A7.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-21T17:35:46.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"zabbixæ·»å webçæ§"},{itemprop:"description",content:"ç¹å»éç½®-ä¸»æº-æçæå¡å¨-webåºæ¯-åå»ºwebåºæ¯-æä¸é¢å¡«åæ­¥éª¤"},{itemprop:"image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/20221212Dingtalk_20221221174005.jpg"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/08.zabbix%E6%B7%BB%E5%8A%A0web%E7%9B%91%E6%8E%A7.html",relativePath:"04.è¿ç»´/12.çæ§/01.zabbix/08.zabbixæ·»å webçæ§.md",key:"v-8105e1aa",path:"/pages/b70eb8/",headers:[{level:4,title:"webçæ§",slug:"webçæ§",normalizedTitle:"webçæ§",charIndex:2},{level:4,title:"åå»ºè§¦åå¨",slug:"åå»ºè§¦åå¨",normalizedTitle:"åå»ºè§¦åå¨",charIndex:52}],headersStr:"webçæ§ åå»ºè§¦åå¨",content:"# webçæ§\n\nç¹å»éç½®-ä¸»æº-æçæå¡å¨-webåºæ¯-åå»ºwebåºæ¯-æä¸é¢å¡«åæ­¥éª¤\n\n\n\n\n\n# åå»ºè§¦åå¨\n\n\n\nåèé¾æ¥ï¼ä½¿ç¨zabbixçæ§ç«¯å£åwebé¡µé¢è§¦åæ¥è­¦éç½®æ¹æ³ | ITåå®¢ç«-çè¡",normalizedContent:"# webçæ§\n\nç¹å»éç½®-ä¸»æº-æçæå¡å¨-webåºæ¯-åå»ºwebåºæ¯-æä¸é¢å¡«åæ­¥éª¤\n\n\n\n\n\n# åå»ºè§¦åå¨\n\n\n\nåèé¾æ¥ï¼ä½¿ç¨zabbixçæ§ç«¯å£åwebé¡µé¢è§¦åæ¥è­¦éç½®æ¹æ³ | itåå®¢ç«-çè¡",charsets:{cjk:!0}},{title:"centos7ç¼è¯å®è£zabbix5.0 proxyç«¯",frontmatter:{title:"centos7ç¼è¯å®è£zabbix5.0 proxyç«¯",date:"2023-03-01T14:31:52.000Z",permalink:"/pages/723e7e/",categories:["è¿ç»´","çæ§","zabbix"],tags:[null],readingShow:"top",description:"zabbix-prxoyæ¯ä¸ä¸ªä»£çæå¡å¨ï¼å®æ¶éçæ§å°çæ°æ®ï¼åå­æ¾æ°æ®åºï¼ç¶ååä¼ éå°zabbix-serverï¼æä»¥ä»£çéè¦ä¸ä¸ªåç¬çæ°æ®åº",meta:[{name:"image",content:"http://pic.zzppjj.top/LightPicture/2023/03/e44061ad1ce81c4d.png"},{name:"twitter:title",content:"centos7ç¼è¯å®è£zabbix5.0 proxyç«¯"},{name:"twitter:description",content:"zabbix-prxoyæ¯ä¸ä¸ªä»£çæå¡å¨ï¼å®æ¶éçæ§å°çæ°æ®ï¼åå­æ¾æ°æ®åºï¼ç¶ååä¼ éå°zabbix-serverï¼æä»¥ä»£çéè¦ä¸ä¸ªåç¬çæ°æ®åº"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"http://pic.zzppjj.top/LightPicture/2023/03/e44061ad1ce81c4d.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/09.centos7%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85zabbix%20proxy%E7%AB%AF.html"},{property:"og:type",content:"article"},{property:"og:title",content:"centos7ç¼è¯å®è£zabbix5.0 proxyç«¯"},{property:"og:description",content:"zabbix-prxoyæ¯ä¸ä¸ªä»£çæå¡å¨ï¼å®æ¶éçæ§å°çæ°æ®ï¼åå­æ¾æ°æ®åºï¼ç¶ååä¼ éå°zabbix-serverï¼æä»¥ä»£çéè¦ä¸ä¸ªåç¬çæ°æ®åº"},{property:"og:image",content:"http://pic.zzppjj.top/LightPicture/2023/03/e44061ad1ce81c4d.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/09.centos7%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85zabbix%20proxy%E7%AB%AF.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-03-01T14:31:52.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"centos7ç¼è¯å®è£zabbix5.0 proxyç«¯"},{itemprop:"description",content:"zabbix-prxoyæ¯ä¸ä¸ªä»£çæå¡å¨ï¼å®æ¶éçæ§å°çæ°æ®ï¼åå­æ¾æ°æ®åºï¼ç¶ååä¼ éå°zabbix-serverï¼æä»¥ä»£çéè¦ä¸ä¸ªåç¬çæ°æ®åº"},{itemprop:"image",content:"http://pic.zzppjj.top/LightPicture/2023/03/e44061ad1ce81c4d.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/09.centos7%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85zabbix%20proxy%E7%AB%AF.html",relativePath:"04.è¿ç»´/12.çæ§/01.zabbix/09.centos7ç¼è¯å®è£zabbix proxyç«¯.md",key:"v-c5ed0f8c",path:"/pages/723e7e/",headers:[{level:2,title:"1ãåå¤ç¯å¢",slug:"_1ãåå¤ç¯å¢",normalizedTitle:"1ãåå¤ç¯å¢",charIndex:2},{level:2,title:"2ãå¼å§å®è£",slug:"_2ãå¼å§å®è£",normalizedTitle:"2ãå¼å§å®è£",charIndex:263},{level:3,title:"æ·»å zabbixç¨æ·ç¨äºè¿è¡zabbixæå¡",slug:"æ·»å zabbixç¨æ·ç¨äºè¿è¡zabbixæå¡",normalizedTitle:"æ·»å zabbixç¨æ·ç¨äºè¿è¡zabbixæå¡",charIndex:274},{level:3,title:"å®è£ä¾èµå",slug:"å®è£ä¾èµå",normalizedTitle:"å®è£ä¾èµå",charIndex:366},{level:3,title:"è§£åæºç å",slug:"è§£åæºç å",normalizedTitle:"è§£åæºç å",charIndex:470},{level:3,title:"ç¼è¯åæ°",slug:"ç¼è¯åæ°",normalizedTitle:"ç¼è¯åæ°",charIndex:541},{level:3,title:"åå§åæ°æ®åºä¿¡æ¯",slug:"åå§åæ°æ®åºä¿¡æ¯",normalizedTitle:"åå§åæ°æ®åºä¿¡æ¯",charIndex:1147},{level:4,title:"ç»å½æ°æ®åºåå»ºzabbix-proxyåº",slug:"ç»å½æ°æ®åºåå»ºzabbix-proxyåº",normalizedTitle:"ç»å½æ°æ®åºåå»ºzabbix-proxyåº",charIndex:1220},{level:4,title:"å¯¼å¥æ°æ®",slug:"å¯¼å¥æ°æ®",normalizedTitle:"å¯¼å¥æ°æ®",charIndex:1686},{level:4,title:"éç½®zabbix_proxy.conféç½®æä»¶",slug:"éç½®zabbix-proxy-conféç½®æä»¶",normalizedTitle:"éç½®zabbix_proxy.conféç½®æä»¶",charIndex:1804},{level:4,title:"ä¿®æ¹ä»¥ä¸ä¿¡æ¯",slug:"ä¿®æ¹ä»¥ä¸ä¿¡æ¯",normalizedTitle:"ä¿®æ¹ä»¥ä¸ä¿¡æ¯",charIndex:1833},{level:4,title:"å¯å¨zabbix-proxy",slug:"å¯å¨zabbix-proxy",normalizedTitle:"å¯å¨zabbix-proxy",charIndex:2054},{level:4,title:"å¯å¨æ¥éæç¤ºæ¾ä¸å°mysqlç¸å³libæä»¶",slug:"å¯å¨æ¥éæç¤ºæ¾ä¸å°mysqlç¸å³libæä»¶",normalizedTitle:"å¯å¨æ¥éæç¤ºæ¾ä¸å°mysqlç¸å³libæä»¶",charIndex:2202},{level:4,title:"å°mysql libç®å½æ·»å å°libç¯å¢åéä¸­",slug:"å°mysql-libç®å½æ·»å å°libç¯å¢åéä¸­",normalizedTitle:"å°mysql libç®å½æ·»å å°libç¯å¢åéä¸­",charIndex:2229},{level:4,title:"åæ¬¡å¯å¨zabbix-proxy",slug:"åæ¬¡å¯å¨zabbix-proxy",normalizedTitle:"åæ¬¡å¯å¨zabbix-proxy",charIndex:2402},{level:3,title:"æå¼zabbix-serveré¡µé¢ï¼éæ©éç½®---ãagentä»£çç¨åº",slug:"æå¼zabbix-serveré¡µé¢-éæ©éç½®-ãagentä»£çç¨åº",normalizedTitle:"æå¼zabbix-serveré¡µé¢ï¼éæ©éç½®---ãagentä»£çç¨åº",charIndex:2431},{level:3,title:"éæ©åå»ºä»£çç¨åº",slug:"éæ©åå»ºä»£çç¨åº",normalizedTitle:"éæ©åå»ºä»£çç¨åº",charIndex:2473},{level:3,title:"å¡«åç¸å³ä¿¡æ¯ï¼ä¿å­å³å¯",slug:"å¡«åç¸å³ä¿¡æ¯-ä¿å­å³å¯",normalizedTitle:"å¡«åç¸å³ä¿¡æ¯ï¼ä¿å­å³å¯",charIndex:2488}],headersStr:"1ãåå¤ç¯å¢ 2ãå¼å§å®è£ æ·»å zabbixç¨æ·ç¨äºè¿è¡zabbixæå¡ å®è£ä¾èµå è§£åæºç å ç¼è¯åæ° åå§åæ°æ®åºä¿¡æ¯ ç»å½æ°æ®åºåå»ºzabbix-proxyåº å¯¼å¥æ°æ® éç½®zabbix_proxy.conféç½®æä»¶ ä¿®æ¹ä»¥ä¸ä¿¡æ¯ å¯å¨zabbix-proxy å¯å¨æ¥éæç¤ºæ¾ä¸å°mysqlç¸å³libæä»¶ å°mysql libç®å½æ·»å å°libç¯å¢åéä¸­ åæ¬¡å¯å¨zabbix-proxy æå¼zabbix-serveré¡µé¢ï¼éæ©éç½®---ãagentä»£çç¨åº éæ©åå»ºä»£çç¨åº å¡«åç¸å³ä¿¡æ¯ï¼ä¿å­å³å¯",content:"# 1ãåå¤ç¯å¢\n\nzabbix-prxoyæ¯ä¸ä¸ªä»£çæå¡å¨ï¼å®æ¶éçæ§å°çæ°æ®ï¼åå­æ¾æ°æ®åºï¼ç¶ååä¼ éå°zabbix-serverï¼æä»¥ä»£çéè¦ä¸ä¸ªåç¬çæ°æ®åº\n\nzabbix-prxoyçä½ç¨ï¼\n\n1ãå½çæ§è®¾å¤è¿å¤æ¶ï¼ç¨äºåæzabbix-serverçæ§åå\n\n2ãéå¯¹ä¸åçç½ç»ç¯å¢ï¼å¯ä»¥ç»æåå¸å¼çæ§\n\nç¯å¢ï¼å·²å®è£MySQL 5.7.31\n\nzabbix5.0Â ï¼https://cdn.zabbix.com/zabbix/sources/stable/5.0/zabbix-5.0.2.tar.gz\n\n\n# 2ãå¼å§å®è£\n\n\n# æ·»å zabbixç¨æ·ç¨äºè¿è¡zabbixæå¡\n\n[root@swarm-node2 local]# useradd -s /sbin/nologin zabbixã\n\n\n1\n\n\n\n# å®è£ä¾èµå\n\nyum install unixODBC-devel net-snmp-devel libevent-devel libxml2-devel libcurl-devel -y\n\n\n1\n\n\n\n# è§£åæºç å\n\n[root@swarm-node2 local]# tar -zxf zabbix-5.0.2.tar.gz\n\n\n1\n\n\n\n# ç¼è¯åæ°\n\n./configure --prefix=/usr/local/zabbix-proxy --enable-proxy --with-mysql=/usr/local/mysql/bin/mysql_config --with-net-snmp --with-libcurl --with-libxml2 --with-unixodbc\n\n\n1\n\n\n--prefix=/usr/local/zabbix-proxyÂ  Â  Â  Â  # ç¼è¯å®è£è·¯å¾\n\n--enable-prxoyããããããããã # å¯å¨proxyç«¯\n\n--with-mysql=/usr/local/mysql/bin/mysql_configÂ  Â  #ç¼è¯è¿æ¥mysqlç¸å³ä¾èµåï¼å¹¶æå®mysql_configçè·¯å¾\n\n--with-net-snmpããããããããã#å¯å¨snmpç¸å³ï¼ç¨äºsnmpçæ§è®¾å¤\n\n--with-libcurlãããããããããã #å¯å¨curlç¸å³\n\n--with-libxml2ãããããããããã#å¯å¨xmlç¸å³\n\n--with-unixodbcããããããããã#å¯å¨odbcç¸å³ç¨äºçæ§æ°æ®åº\n\n\n\nç¡®è®¤æ è¯¯åå°±å¼å§make && make install\n\n[root@swarm-node2 zabbix-5.0.2]# make && make install\n\n\n1\n\n\n\n# åå§åæ°æ®åºä¿¡æ¯\n\næ°æ®åºæä»¶å¨zabbix-5.0.2/database/mysql ä¸­\n\nproxyåªéè¦å¯¼å¥schema.sqlå³å¯\n\n# ç»å½æ°æ®åºåå»ºzabbix-proxyåº\n\nmysql> create database proxy character set UTF8 collate utf8_bin;\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> \nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| proxy              |\n| sys                |\n+--------------------+\n5 rows in set (0.00 sec)\n\nmysql> \nmysql> \nmysql>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n# å¯¼å¥æ°æ®\n\nmysql> \nmysql> use proxy;\nDatabase changed\nmysql> source /usr/local/zabbix-5.0.2/database/mysql/schema.sql;\n\n\n# éç½®zabbix_proxy.conféç½®æä»¶\n\n\n\n# ä¿®æ¹ä»¥ä¸ä¿¡æ¯\n\nServer=192.168.137.128                #æå®zabbix-serverçipå°å\nDBHost=localhostããããããããããããã#ä»¥ä¸é½æ¯æ°æ®åºä¿¡æ¯\nDBName=proxy\nDBUser=root\nDBPassword=123.com\nDBSocket=/usr/local/mysql/mysql.sock\nDBPort=3306\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# å¯å¨zabbix-proxy\n\n[root@swarm-node2 zabbix-proxy]# /usr/local/zabbix-proxy/sbin/zabbix_proxy -c /usr/local/zabbix-proxy/etc/zabbix_proxy.conf\n\n\n1\n\n\n# å¯å¨æ¥éæç¤ºæ¾ä¸å°mysqlç¸å³libæä»¶\n\n\n\n# å°mysql libç®å½æ·»å å°libç¯å¢åéä¸­\n\n[root@swarm-node2 zabbix-proxy]# echo '/usr/local/mysql/lib/' > /etc/ld.so.conf.d/mysql.conf\n[root@swarm-node2 zabbix-proxy]# ldconfig -v\n\n\n1\n2\n\n\n# åæ¬¡å¯å¨zabbix-proxy\n\nå¯å¨æå\n\n\n\n\n# æå¼zabbix-serveré¡µé¢ï¼éæ©éç½®---ãagentä»£çç¨åº\n\n\n\n\n# éæ©åå»ºä»£çç¨åº\n\n\n\n\n# å¡«åç¸å³ä¿¡æ¯ï¼ä¿å­å³å¯\n\nagentä»£çç¨åºåç§°ï¼ä¸ºzabbix-proxyéç½®æä»¶ä¸­çHostname\n\nç³»ç»ä»£çç¨åºæ¨¡å¼ï¼éæ©ä¸»å¨å¼\n\n\n\n----------------------------------------\n\nåæé¾æ¥ï¼CentOS-7 ç¼è¯å®è£zabbix5.0ï¼proxyç«¯ï¼ - cchenppp - åå®¢å­",normalizedContent:"# 1ãåå¤ç¯å¢\n\nzabbix-prxoyæ¯ä¸ä¸ªä»£çæå¡å¨ï¼å®æ¶éçæ§å°çæ°æ®ï¼åå­æ¾æ°æ®åºï¼ç¶ååä¼ éå°zabbix-serverï¼æä»¥ä»£çéè¦ä¸ä¸ªåç¬çæ°æ®åº\n\nzabbix-prxoyçä½ç¨ï¼\n\n1ãå½çæ§è®¾å¤è¿å¤æ¶ï¼ç¨äºåæzabbix-serverçæ§åå\n\n2ãéå¯¹ä¸åçç½ç»ç¯å¢ï¼å¯ä»¥ç»æåå¸å¼çæ§\n\nç¯å¢ï¼å·²å®è£mysql 5.7.31\n\nzabbix5.0Â ï¼https://cdn.zabbix.com/zabbix/sources/stable/5.0/zabbix-5.0.2.tar.gz\n\n\n# 2ãå¼å§å®è£\n\n\n# æ·»å zabbixç¨æ·ç¨äºè¿è¡zabbixæå¡\n\n[root@swarm-node2 local]# useradd -s /sbin/nologin zabbixã\n\n\n1\n\n\n\n# å®è£ä¾èµå\n\nyum install unixodbc-devel net-snmp-devel libevent-devel libxml2-devel libcurl-devel -y\n\n\n1\n\n\n\n# è§£åæºç å\n\n[root@swarm-node2 local]# tar -zxf zabbix-5.0.2.tar.gz\n\n\n1\n\n\n\n# ç¼è¯åæ°\n\n./configure --prefix=/usr/local/zabbix-proxy --enable-proxy --with-mysql=/usr/local/mysql/bin/mysql_config --with-net-snmp --with-libcurl --with-libxml2 --with-unixodbc\n\n\n1\n\n\n--prefix=/usr/local/zabbix-proxyÂ  Â  Â  Â  # ç¼è¯å®è£è·¯å¾\n\n--enable-prxoyããããããããã # å¯å¨proxyç«¯\n\n--with-mysql=/usr/local/mysql/bin/mysql_configÂ  Â  #ç¼è¯è¿æ¥mysqlç¸å³ä¾èµåï¼å¹¶æå®mysql_configçè·¯å¾\n\n--with-net-snmpããããããããã#å¯å¨snmpç¸å³ï¼ç¨äºsnmpçæ§è®¾å¤\n\n--with-libcurlãããããããããã #å¯å¨curlç¸å³\n\n--with-libxml2ãããããããããã#å¯å¨xmlç¸å³\n\n--with-unixodbcããããããããã#å¯å¨odbcç¸å³ç¨äºçæ§æ°æ®åº\n\n\n\nç¡®è®¤æ è¯¯åå°±å¼å§make && make install\n\n[root@swarm-node2 zabbix-5.0.2]# make && make install\n\n\n1\n\n\n\n# åå§åæ°æ®åºä¿¡æ¯\n\næ°æ®åºæä»¶å¨zabbix-5.0.2/database/mysql ä¸­\n\nproxyåªéè¦å¯¼å¥schema.sqlå³å¯\n\n# ç»å½æ°æ®åºåå»ºzabbix-proxyåº\n\nmysql> create database proxy character set utf8 collate utf8_bin;\nquery ok, 1 row affected (0.00 sec)\n\nmysql> \nmysql> show databases;\n+--------------------+\n| database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| proxy              |\n| sys                |\n+--------------------+\n5 rows in set (0.00 sec)\n\nmysql> \nmysql> \nmysql>\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n\n\n# å¯¼å¥æ°æ®\n\nmysql> \nmysql> use proxy;\ndatabase changed\nmysql> source /usr/local/zabbix-5.0.2/database/mysql/schema.sql;\n\n\n# éç½®zabbix_proxy.conféç½®æä»¶\n\n\n\n# ä¿®æ¹ä»¥ä¸ä¿¡æ¯\n\nserver=192.168.137.128                #æå®zabbix-serverçipå°å\ndbhost=localhostããããããããããããã#ä»¥ä¸é½æ¯æ°æ®åºä¿¡æ¯\ndbname=proxy\ndbuser=root\ndbpassword=123.com\ndbsocket=/usr/local/mysql/mysql.sock\ndbport=3306\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n# å¯å¨zabbix-proxy\n\n[root@swarm-node2 zabbix-proxy]# /usr/local/zabbix-proxy/sbin/zabbix_proxy -c /usr/local/zabbix-proxy/etc/zabbix_proxy.conf\n\n\n1\n\n\n# å¯å¨æ¥éæç¤ºæ¾ä¸å°mysqlç¸å³libæä»¶\n\n\n\n# å°mysql libç®å½æ·»å å°libç¯å¢åéä¸­\n\n[root@swarm-node2 zabbix-proxy]# echo '/usr/local/mysql/lib/' > /etc/ld.so.conf.d/mysql.conf\n[root@swarm-node2 zabbix-proxy]# ldconfig -v\n\n\n1\n2\n\n\n# åæ¬¡å¯å¨zabbix-proxy\n\nå¯å¨æå\n\n\n\n\n# æå¼zabbix-serveré¡µé¢ï¼éæ©éç½®---ãagentä»£çç¨åº\n\n\n\n\n# éæ©åå»ºä»£çç¨åº\n\n\n\n\n# å¡«åç¸å³ä¿¡æ¯ï¼ä¿å­å³å¯\n\nagentä»£çç¨åºåç§°ï¼ä¸ºzabbix-proxyéç½®æä»¶ä¸­çhostname\n\nç³»ç»ä»£çç¨åºæ¨¡å¼ï¼éæ©ä¸»å¨å¼\n\n\n\n----------------------------------------\n\nåæé¾æ¥ï¼centos-7 ç¼è¯å®è£zabbix5.0ï¼proxyç«¯ï¼ - cchenppp - åå®¢å­",charsets:{cjk:!0}},{title:"rpmå®è£zabbix proxyè¿ç¨ç®è®°",frontmatter:{title:"rpmå®è£zabbix proxyè¿ç¨ç®è®°",date:"2023-03-02T10:13:05.000Z",permalink:"/pages/ef347e/",categories:["è¿ç»´","çæ§","zabbix"],tags:[null],readingShow:"top",description:"æ¥éªçæ¬",meta:[{name:"twitter:title",content:"rpmå®è£zabbix proxyè¿ç¨ç®è®°"},{name:"twitter:description",content:"æ¥éªçæ¬"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/10.rpm%E5%AE%89%E8%A3%85zabbix%20proxy%E8%BF%87%E7%A8%8B%E7%AE%80%E8%AE%B0.html"},{property:"og:type",content:"article"},{property:"og:title",content:"rpmå®è£zabbix proxyè¿ç¨ç®è®°"},{property:"og:description",content:"æ¥éªçæ¬"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/10.rpm%E5%AE%89%E8%A3%85zabbix%20proxy%E8%BF%87%E7%A8%8B%E7%AE%80%E8%AE%B0.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-03-02T10:13:05.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"rpmå®è£zabbix proxyè¿ç¨ç®è®°"},{itemprop:"description",content:"æ¥éªçæ¬"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/01.zabbix/10.rpm%E5%AE%89%E8%A3%85zabbix%20proxy%E8%BF%87%E7%A8%8B%E7%AE%80%E8%AE%B0.html",relativePath:"04.è¿ç»´/12.çæ§/01.zabbix/10.rpmå®è£zabbix proxyè¿ç¨ç®è®°.md",key:"v-20df7df7",path:"/pages/ef347e/",headers:[{level:3,title:"ç¯å¢åå§å",slug:"ç¯å¢åå§å",normalizedTitle:"ç¯å¢åå§å",charIndex:2},{level:3,title:"å®è£ä¾èµå",slug:"å®è£ä¾èµå",normalizedTitle:"å®è£ä¾èµå",charIndex:260},{level:3,title:"ä¸è½½å¯¹åºçæ¬çzabbix-proxy-mysqlå®è£å",slug:"ä¸è½½å¯¹åºçæ¬çzabbix-proxy-mysqlå®è£å",normalizedTitle:"ä¸è½½å¯¹åºçæ¬çzabbix-proxy-mysqlå®è£å",charIndex:534},{level:3,title:"å®è£å¹¶åå§åæ°æ®åº",slug:"å®è£å¹¶åå§åæ°æ®åº",normalizedTitle:"å®è£å¹¶åå§åæ°æ®åº",charIndex:837},{level:3,title:"éç½®zabbix-proxyæ°æ®åº",slug:"éç½®zabbix-proxyæ°æ®åº",normalizedTitle:"éç½®zabbix-proxyæ°æ®åº",charIndex:1002},{level:4,title:"ç»å½æ°æ®åº",slug:"ç»å½æ°æ®åº",normalizedTitle:"ç»å½æ°æ®åº",charIndex:1023},{level:4,title:"åå»ºzabbix_proxyåºå¹¶è®¾ç½®å­ç¬¦é",slug:"åå»ºzabbix-proxyåºå¹¶è®¾ç½®å­ç¬¦é",normalizedTitle:"åå»ºzabbix_proxyåºå¹¶è®¾ç½®å­ç¬¦é",charIndex:1068},{level:4,title:"å¯¹rootç¨æ·è¿è¡ææ",slug:"å¯¹rootç¨æ·è¿è¡ææ",normalizedTitle:"å¯¹rootç¨æ·è¿è¡ææ",charIndex:1186},{level:4,title:"åå»ºzabbixç¨æ·",slug:"åå»ºzabbixç¨æ·",normalizedTitle:"åå»ºzabbixç¨æ·",charIndex:1290},{level:4,title:"å¯¹zabbixè¿è¡ææ(ææå¶ä»è½è®¿é®zabbix_proxyåºï¼",slug:"å¯¹zabbixè¿è¡ææ-ææå¶ä»è½è®¿é®zabbix-proxyåº",normalizedTitle:"å¯¹zabbixè¿è¡ææ(ææå¶ä»è½è®¿é®zabbix_proxyåºï¼",charIndex:1386},{level:4,title:"quitæ¨åºæ°æ®åº",slug:"quitæ¨åºæ°æ®åº",normalizedTitle:"quitæ¨åºæ°æ®åº",charIndex:1535},{level:3,title:"å¯¼å¥zabbix-proxy-mysqlåºæä»¶",slug:"å¯¼å¥zabbix-proxy-mysqlåºæä»¶",normalizedTitle:"å¯¼å¥zabbix-proxy-mysqlåºæä»¶",charIndex:1549},{level:3,title:"ä¿®æ¹éç½®æä»¶",slug:"ä¿®æ¹éç½®æä»¶",normalizedTitle:"ä¿®æ¹éç½®æä»¶",charIndex:1690},{level:3,title:"éå¯zabbix-proxyåzabbix-agentæå¡",slug:"éå¯zabbix-proxyåzabbix-agentæå¡",normalizedTitle:"éå¯zabbix-proxyåzabbix-agentæå¡",charIndex:2140},{level:3,title:"æ·»å agentä»£çéç½®",slug:"æ·»å agentä»£çéç½®",normalizedTitle:"æ·»å agentä»£çéç½®",charIndex:2335}],headersStr:"ç¯å¢åå§å å®è£ä¾èµå ä¸è½½å¯¹åºçæ¬çzabbix-proxy-mysqlå®è£å å®è£å¹¶åå§åæ°æ®åº éç½®zabbix-proxyæ°æ®åº ç»å½æ°æ®åº åå»ºzabbix_proxyåºå¹¶è®¾ç½®å­ç¬¦é å¯¹rootç¨æ·è¿è¡ææ åå»ºzabbixç¨æ· å¯¹zabbixè¿è¡ææ(ææå¶ä»è½è®¿é®zabbix_proxyåºï¼ quitæ¨åºæ°æ®åº å¯¼å¥zabbix-proxy-mysqlåºæä»¶ ä¿®æ¹éç½®æä»¶ éå¯zabbix-proxyåzabbix-agentæå¡ æ·»å agentä»£çéç½®",content:"# ç¯å¢åå§å\n\næ¥éªçæ¬\n\n#cat /etc/redhat-release\n\nå³é­é²ç«å¢ï¼selinux systemctl stop firewalld.service && systemctl disable firewalld.service sed -i âs/^SELINUX=enforcing/#SELINUX=enforcing\\nSELINUX=disabled/gâ /etc/selinux/config éç½®æ¶é´åæ­¥ éç½®yumæº ä¼åsshæå¡ å®è£å¿è¦è½¯ä»¶å ä»¥ä¸è¿ç¨ä¸ä¸ä¸ç»è®²\n\n\n# å®è£ä¾èµå\n\nyum -y install OpenIPMI OpenIPMI-modalias net-snmp-libs net-snmp-agent-libs fping unixODBC\n\nfpingéè¦epelæºï¼è¥æ²¡æçè¯ä¹å¯ä»¥ä½¿ç¨rpmåè¿è¡å®è£ wget http://www.rpmfind.net/linux/dag/redhat/el7/en/x86_64/dag/RPMS/fping-3.10-1.el7.rf.x86_64.rpm rpm -ivh fping-3.10-1.el7.rf.x86_64.rpm\n\n\n# ä¸è½½å¯¹åºçæ¬çzabbix-proxy-mysqlå®è£å\n\nå®ç½ï¼https://repo.zabbix.com/zabbix/5.0/ ç±äºæè¿éçzabbix-serverç«¯ççæ¬æ¯5.0.19ï¼å æ­¤è¿éçzabbix-proxyçæ¬ä¹ç¨çæ¯5.0.X; yum -y install wget wget https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-proxy-mysql-5.0.25-1.el7.x86_64.rpm rpm -ivh zabbix-proxy-mysql-5.0.25-1.el7.x86_64.rpm\n\n\n# å®è£å¹¶åå§åæ°æ®åº\n\nyum -y install mariadb-server systemctl restart mariadb && systemctl enable mariadb netstat -anptu | grep -i mysqld *åå§åæ°æ®åº mysql_secure_installation\n\n\n# éç½®zabbix-proxyæ°æ®åº\n\n# ç»å½æ°æ®åº\n\n[root@CentOS79 ~]# mysql -uroot -p\n\n# åå»ºzabbix_proxyåºå¹¶è®¾ç½®å­ç¬¦é\n\nMariaDB [(none)]> create database zabbix_proxy default character set utf8 collate utf8_bin;\n\n# å¯¹rootç¨æ·è¿è¡ææ\n\nMariaDB [(none)]> grant all privileges on . to root@127.0.0.1 identified by âroot@123â;\n\n# åå»ºzabbixç¨æ·\n\nMariaDB [zabbix_proxy]> create user zabbix@localhost identified by âzabbix@123â;\n\n# å¯¹zabbixè¿è¡ææ(ææå¶ä»è½è®¿é®zabbix_proxyåºï¼\n\nMariaDB [zabbix_proxy]> grant all privileges on zabbix_proxy.* to zabbix@localhost identified by âzabbix@123â;\n\n# quitæ¨åºæ°æ®åº\n\n\n# å¯¼å¥zabbix-proxy-mysqlåºæä»¶\n\n[root@CentOS79 ~]# zcat /usr/share/doc/zabbix-proxy-mysql-5.0.25/schema.sql.gz | mysql -uzabbix -p zabbix_proxy\n\n\n# ä¿®æ¹éç½®æä»¶\n\n[root@CentOS79 ~]# vim /etc/zabbix/zabbix_proxy.conf ç¼è¾å¦ä¸åæ°ï¼ 30 Server=10.0.3.246 ##éç½®zabbix-serveræå¡ç«¯å°åï¼zabbix-proxyä¼å°æ¶éå°æ° æ®åå¾è¯¥å°å 49 Hostname=YCGF-Zabbix-Proxy ##éç½®ä¸»æºå 163 DBHost=localhost ##éç½®æ°æ®åºä¸»æºï¼é»è®¤localhostå³å¯ï¼ 174 DBName=zabbix_proxy ##éç½®æ°æ®åºåæï¼å°±æ¯ä½ ååå»ºçåºåï¼ 189 DBUser=zabbix ##éç½®ä¹¦åºæ®æä½ç¨æ· 198 DBPassword=Longi@123 ##è¾å¥æ°æ®åºç¨æ·å¯ç  å¶ä»éç½®é»è®¤å³å¯ [root@CentOS79 zabbix]# vim /etc/zabbix/zabbix_agentd.conf 100 Server=10.0.3.246 ##éç½®zabbix-serverç«¯å°å\n\n\n# éå¯zabbix-proxyåzabbix-agentæå¡\n\nsystemctl restart zabbix-proxy.service && systemctl enable zabbix-proxy.service systemctl restart zabbix-agent.service && systemctl enable zabbix-agent.service\n\n\n# æ·»å agentä»£çéç½®\n\nç»å½zabbix-webââç®¡çââagentä»£çç¨åºââåå»ºä»£çââæ ¹æ®é¡µé¢å¡«ç©ºå³å¯\n\næ­¤å¤æéæ©çæ¯è¢«å¨å¼ã ä¸»å¨æ¨¡å¼ï¼å®¢æ·ç«¯æ¯éä¸æ®µæ¶é´ä¸»å¨åæå¡ç«¯åèµ·è¿æ¥è¯·æ±â>æå¡ç«¯æ¶å°è¯·æ±,æ¥è¯¢å®¢æ·ç«¯éè¦åçitemä¿¡æ¯,åéç»å®¢æ·ç«¯â>å®¢æ·ç«¯æ¶éæ°æ®åéæå¡ç«¯â>ç»æãï¼æ¶éæ°æ®æ¶é´ä¸è´ï¼ è¢«å¨æ¨¡å¼ï¼å®¢æ·ç«¯å¼ä¸ä¸ªç«¯å£é»è®¤10050,ç­å¾æå¡ç«¯æ¥åæ°æ®,ç¶åå®¢æ·ç«¯æ¶éæ°æ®åéå°æå¡ç«¯,ç¶åç»æã\n\nåæé¾æ¥ï¼CentOS7.9é¨ç½²zabbix-proxy-5.0.25è¿ç¨ç®è®°_çå¤§æ±1018çåå®¢-CSDNåå®¢",normalizedContent:"# ç¯å¢åå§å\n\næ¥éªçæ¬\n\n#cat /etc/redhat-release\n\nå³é­é²ç«å¢ï¼selinux systemctl stop firewalld.service && systemctl disable firewalld.service sed -i âs/^selinux=enforcing/#selinux=enforcing\\nselinux=disabled/gâ /etc/selinux/config éç½®æ¶é´åæ­¥ éç½®yumæº ä¼åsshæå¡ å®è£å¿è¦è½¯ä»¶å ä»¥ä¸è¿ç¨ä¸ä¸ä¸ç»è®²\n\n\n# å®è£ä¾èµå\n\nyum -y install openipmi openipmi-modalias net-snmp-libs net-snmp-agent-libs fping unixodbc\n\nfpingéè¦epelæºï¼è¥æ²¡æçè¯ä¹å¯ä»¥ä½¿ç¨rpmåè¿è¡å®è£ wget http://www.rpmfind.net/linux/dag/redhat/el7/en/x86_64/dag/rpms/fping-3.10-1.el7.rf.x86_64.rpm rpm -ivh fping-3.10-1.el7.rf.x86_64.rpm\n\n\n# ä¸è½½å¯¹åºçæ¬çzabbix-proxy-mysqlå®è£å\n\nå®ç½ï¼https://repo.zabbix.com/zabbix/5.0/ ç±äºæè¿éçzabbix-serverç«¯ççæ¬æ¯5.0.19ï¼å æ­¤è¿éçzabbix-proxyçæ¬ä¹ç¨çæ¯5.0.x; yum -y install wget wget https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-proxy-mysql-5.0.25-1.el7.x86_64.rpm rpm -ivh zabbix-proxy-mysql-5.0.25-1.el7.x86_64.rpm\n\n\n# å®è£å¹¶åå§åæ°æ®åº\n\nyum -y install mariadb-server systemctl restart mariadb && systemctl enable mariadb netstat -anptu | grep -i mysqld *åå§åæ°æ®åº mysql_secure_installation\n\n\n# éç½®zabbix-proxyæ°æ®åº\n\n# ç»å½æ°æ®åº\n\n[root@centos79 ~]# mysql -uroot -p\n\n# åå»ºzabbix_proxyåºå¹¶è®¾ç½®å­ç¬¦é\n\nmariadb [(none)]> create database zabbix_proxy default character set utf8 collate utf8_bin;\n\n# å¯¹rootç¨æ·è¿è¡ææ\n\nmariadb [(none)]> grant all privileges on . to root@127.0.0.1 identified by âroot@123â;\n\n# åå»ºzabbixç¨æ·\n\nmariadb [zabbix_proxy]> create user zabbix@localhost identified by âzabbix@123â;\n\n# å¯¹zabbixè¿è¡ææ(ææå¶ä»è½è®¿é®zabbix_proxyåºï¼\n\nmariadb [zabbix_proxy]> grant all privileges on zabbix_proxy.* to zabbix@localhost identified by âzabbix@123â;\n\n# quitæ¨åºæ°æ®åº\n\n\n# å¯¼å¥zabbix-proxy-mysqlåºæä»¶\n\n[root@centos79 ~]# zcat /usr/share/doc/zabbix-proxy-mysql-5.0.25/schema.sql.gz | mysql -uzabbix -p zabbix_proxy\n\n\n# ä¿®æ¹éç½®æä»¶\n\n[root@centos79 ~]# vim /etc/zabbix/zabbix_proxy.conf ç¼è¾å¦ä¸åæ°ï¼ 30 server=10.0.3.246 ##éç½®zabbix-serveræå¡ç«¯å°åï¼zabbix-proxyä¼å°æ¶éå°æ° æ®åå¾è¯¥å°å 49 hostname=ycgf-zabbix-proxy ##éç½®ä¸»æºå 163 dbhost=localhost ##éç½®æ°æ®åºä¸»æºï¼é»è®¤localhostå³å¯ï¼ 174 dbname=zabbix_proxy ##éç½®æ°æ®åºåæï¼å°±æ¯ä½ ååå»ºçåºåï¼ 189 dbuser=zabbix ##éç½®ä¹¦åºæ®æä½ç¨æ· 198 dbpassword=longi@123 ##è¾å¥æ°æ®åºç¨æ·å¯ç  å¶ä»éç½®é»è®¤å³å¯ [root@centos79 zabbix]# vim /etc/zabbix/zabbix_agentd.conf 100 server=10.0.3.246 ##éç½®zabbix-serverç«¯å°å\n\n\n# éå¯zabbix-proxyåzabbix-agentæå¡\n\nsystemctl restart zabbix-proxy.service && systemctl enable zabbix-proxy.service systemctl restart zabbix-agent.service && systemctl enable zabbix-agent.service\n\n\n# æ·»å agentä»£çéç½®\n\nç»å½zabbix-webââç®¡çââagentä»£çç¨åºââåå»ºä»£çââæ ¹æ®é¡µé¢å¡«ç©ºå³å¯\n\næ­¤å¤æéæ©çæ¯è¢«å¨å¼ã ä¸»å¨æ¨¡å¼ï¼å®¢æ·ç«¯æ¯éä¸æ®µæ¶é´ä¸»å¨åæå¡ç«¯åèµ·è¿æ¥è¯·æ±â>æå¡ç«¯æ¶å°è¯·æ±,æ¥è¯¢å®¢æ·ç«¯éè¦åçitemä¿¡æ¯,åéç»å®¢æ·ç«¯â>å®¢æ·ç«¯æ¶éæ°æ®åéæå¡ç«¯â>ç»æãï¼æ¶éæ°æ®æ¶é´ä¸è´ï¼ è¢«å¨æ¨¡å¼ï¼å®¢æ·ç«¯å¼ä¸ä¸ªç«¯å£é»è®¤10050,ç­å¾æå¡ç«¯æ¥åæ°æ®,ç¶åå®¢æ·ç«¯æ¶éæ°æ®åéå°æå¡ç«¯,ç¶åç»æã\n\nåæé¾æ¥ï¼centos7.9é¨ç½²zabbix-proxy-5.0.25è¿ç¨ç®è®°_çå¤§æ±1018çåå®¢-csdnåå®¢",charsets:{cjk:!0}},{title:"prometheusçæ§ãåè­¦ä¸å­å¨",frontmatter:{title:"prometheusçæ§ãåè­¦ä¸å­å¨",date:"2022-12-12T09:57:58.000Z",permalink:"/pages/40794d/",categories:["çæ§","prometheus"],tags:[null],readingShow:"top",description:"githubå°åï¼https://github.com/kubernetes/kube-state-metrics",meta:[{name:"image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/27521399-c2fb1fc8fbb0563f.png"},{name:"twitter:title",content:"prometheusçæ§ãåè­¦ä¸å­å¨"},{name:"twitter:description",content:"githubå°åï¼https://github.com/kubernetes/kube-state-metrics"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/27521399-c2fb1fc8fbb0563f.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/02.prometheus/01.prometheus%E7%9B%91%E6%8E%A7%E3%80%81%E5%91%8A%E8%AD%A6%E4%B8%8E%E5%AD%98%E5%82%A8.html"},{property:"og:type",content:"article"},{property:"og:title",content:"prometheusçæ§ãåè­¦ä¸å­å¨"},{property:"og:description",content:"githubå°åï¼https://github.com/kubernetes/kube-state-metrics"},{property:"og:image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/27521399-c2fb1fc8fbb0563f.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/02.prometheus/01.prometheus%E7%9B%91%E6%8E%A7%E3%80%81%E5%91%8A%E8%AD%A6%E4%B8%8E%E5%AD%98%E5%82%A8.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-12T09:57:58.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"prometheusçæ§ãåè­¦ä¸å­å¨"},{itemprop:"description",content:"githubå°åï¼https://github.com/kubernetes/kube-state-metrics"},{itemprop:"image",content:"https://raw.githubusercontent.com/zpj874878956/images/main/img/27521399-c2fb1fc8fbb0563f.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/02.prometheus/01.prometheus%E7%9B%91%E6%8E%A7%E3%80%81%E5%91%8A%E8%AD%A6%E4%B8%8E%E5%AD%98%E5%82%A8.html",relativePath:"04.è¿ç»´/12.çæ§/02.prometheus/01.prometheusçæ§ãåè­¦ä¸å­å¨.md",key:"v-4008dcfe",path:"/pages/40794d/",headers:[{level:2,title:"1.1 kube-state-metricsä»ç»",slug:"_1-1-kube-state-metricsä»ç»",normalizedTitle:"1.1 kube-state-metricsä»ç»",charIndex:27},{level:2,title:"1.2 é¨ç½²kube-state-metrics",slug:"_1-2-é¨ç½²kube-state-metrics",normalizedTitle:"1.2 é¨ç½²kube-state-metrics",charIndex:512},{level:2,title:"1.3 éªè¯æ°æ®",slug:"_1-3-éªè¯æ°æ®",normalizedTitle:"1.3 éªè¯æ°æ®",charIndex:605},{level:2,title:"1.4 prometheusæ°æ®éé",slug:"_1-4-prometheusæ°æ®éé",normalizedTitle:"1.4 prometheusæ°æ®éé",charIndex:622},{level:2,title:"1.5 éªè¯prometheusç¶æ",slug:"_1-5-éªè¯prometheusç¶æ",normalizedTitle:"1.5 éªè¯prometheusç¶æ",charIndex:769},{level:2,title:"1.6 grafanaå¯¼å¥æ¨¡æ¿",slug:"_1-6-grafanaå¯¼å¥æ¨¡æ¿",normalizedTitle:"1.6 grafanaå¯¼å¥æ¨¡æ¿",charIndex:792},{level:2,title:"2.1 tomcat",slug:"_2-1-tomcat",normalizedTitle:"2.1 tomcat",charIndex:950},{level:2,title:"2.2 redis",slug:"_2-2-redis",normalizedTitle:"2.2 redis",charIndex:1673},{level:2,title:"2.3 mysql",slug:"_2-3-mysql",normalizedTitle:"2.3 mysql",charIndex:1989},{level:2,title:"2.4 haproxy",slug:"_2-4-haproxy",normalizedTitle:"2.4 haproxy",charIndex:3402},{level:2,title:"2.5 nginx",slug:"_2-5-nginx",normalizedTitle:"2.5 nginx",charIndex:5022},{level:2,title:"2.6 blockboxçæ§url",slug:"_2-6-blockboxçæ§url",normalizedTitle:"2.6 blockboxçæ§url",charIndex:7199},{level:2,title:"3.1 Alertmanager",slug:"_3-1-alertmanager",normalizedTitle:"3.1 alertmanager",charIndex:10420},{level:2,title:"3.2 é®ä»¶",slug:"_3-2-é®ä»¶",normalizedTitle:"3.2 é®ä»¶",charIndex:11588},{level:2,title:"3.3 éé",slug:"_3-3-éé",normalizedTitle:"3.3 éé",charIndex:15377}],headersStr:"1.1 kube-state-metricsä»ç» 1.2 é¨ç½²kube-state-metrics 1.3 éªè¯æ°æ® 1.4 prometheusæ°æ®éé 1.5 éªè¯prometheusç¶æ 1.6 grafanaå¯¼å¥æ¨¡æ¿ 2.1 tomcat 2.2 redis 2.3 mysql 2.4 haproxy 2.5 nginx 2.6 blockboxçæ§url 3.1 Alertmanager 3.2 é®ä»¶ 3.3 éé",content:'# ä¸ãkube-state-metrics\n\n\n# 1.1 kube-state-metricsä»ç»\n\ngithubå°åï¼https://github.com/kubernetes/kube-state-metrics\n\néåå°åï¼https://hub.docker.com/r/bitnami/kube-state-metrics\n\nåå®¢ä»ç»ï¼https://xie.infoq.cn/article/9e1fff6306649e65480a96bb1\n\nkube-state-metricsæ¯éè¿çå¬API Serverçææå³èµæºå¯¹è±¡çç¶æææ ï¼æ¯å¦DeploymentãNodeãPodï¼éè¦æ³¨æçæ¯kube-state-metricsåªæ¯ç®åçæä¾ä¸ä¸ªmetricsæ°æ®ï¼å¹¶ä¸ä¼å­å¨è¿äºææ æ°æ®ï¼æä»¥æä»¬å¯ä»¥ä½¿ç¨Prometheusæ¥æåè¿äºæ°æ®ç¶åå­å¨ï¼ä¸»è¦å³æ³¨çæ¯ä¸å¡ç¸å³çä¸äºåæ°æ®ï¼æ¯å¦DeploymentãPodãå¯æ¬ç¶æç­ï¼è°åº¦äºå¤å°ä¸ªreplicasï¼ç°å¨å¯ç¨çæå ä¸ªï¼å¤å°ä¸ªPodæ¯running/stopped/terminatedç¶æï¼Podéå¯äºå¤å°æ¬¡ï¼ç®åç±å¤å°jobå¨è¿è¡ä¸­\n\n\n# 1.2 é¨ç½²kube-state-metrics\n\n 1. ç¼ååºäºdeployæ§å¶å¨çyamlæä»¶\n 2. ç¼åsvcçyamlæä»¶ï¼ç«¯å£æ´é²ä¸ºNodePort\n 3. é¨ç½²\n\n\n# 1.3 éªè¯æ°æ®\n\n\n\n\n\n\n# 1.4 prometheusæ°æ®éé\n\n    - job_name: \'kube-state-metrics\'\n      static_configs:\n        - targets: ["IP:PORT"]\n\n\n1\n2\n3\n\n\n> k8séç½®æä»¶configmapç¼©è¿æ ¼å¼\n\n\n# 1.5 éªè¯prometheusç¶æ\n\n\n# 1.6 grafanaå¯¼å¥æ¨¡æ¿\n\n 1. 13824\n 2. 14518\n\n> å ä¸ºçæ¬ä¸åï¼å¯æ ¹æ®å¯¹åºçæ¬è¿è¡è®¾ç½®\n> \n> Dashboardæ¨¡æ¿ç½åï¼https://grafana.com/grafana/dashboards/\n\n\n# äºãçæ§ç¤ºä¾\n\nåºäºç¬¬ä¸æ¹exporterå®ç°å¯¹ç®æ æå¡ççæ§\n\n\n# 2.1 tomcat\n\n * æå»ºéå\n\ngithubå°åï¼https://github.com/nlighten/tomcat_exporter\n\næ ¹æ®tomcatå®æ¹éåæ·»å jarå\n\nADD metrics.war /data/tomcat/webapps\nADD simpleclient-0.8.0.jar  /usr/local/tomcat/lib/\nADD simpleclient_common-0.8.0.jar /usr/local/tomcat/lib/\nADD simpleclient_hotspot-0.8.0.jar /usr/local/tomcat/lib/\nADD simpleclient_servlet-0.8.0.jar /usr/local/tomcat/lib/\nADD tomcat_exporter_client-0.0.12.jar /usr/local/tomcat/lib/\n\n\n1\n2\n3\n4\n5\n6\n\n * prometheuséé\n\n    - job_name: \'kube-state-metrics\'\n      static_configs:\n        - targets: ["IP:PORT"]\n\n\n1\n2\n3\n\n\n> k8séç½®æä»¶configmapç¼©è¿æ ¼å¼\n\n * prometheuséªè¯\n\n * grafanaå¯¼å¥æ¨¡æ¿\n\ngithubå°åï¼https://github.com/nlighten/tomcat_exporter/blob/master/dashboard/example.json\n\n> ä¸è½½è¿ä¸ªjsonæä»¶å¯¼å¥grafanaå³å¯\n\n\n# 2.2 redis\n\néè¿redis_exporterçæ§redisæå¡è£æ\n\ngithubç½åï¼https://github.com/oliver006/redis_exporter\n\n * é¨ç½²redis\n\n> ä¸ä¸ªpodä¸¤ä¸ªå®¹å¨ï¼redisåredis-exporter\n\n * prometheuséé\n\n    - job_name: \'redis-metrics\'\n      static_configs:\n        - targets: ["IP:PORT"]\n\n\n1\n2\n3\n\n\n> k8séç½®æä»¶configmapç¼©è¿æ ¼å¼\n\n * grafanaå¯¼å¥æ¨¡æ¿\n\n 1. 14615\n 2. 11692\n\n\n# 2.3 mysql\n\néè¿mysqld_exporterçæ§MySQLæå¡çè¿è¡ç¶æ\n\ngithubç½åï¼https://github.com/prometheus/mysqld_exporter\n\n * å®è£mariadb-server\n\napt install -y mariadb\n\n\n1\n\n * ä¿®æ¹éç½®æä»¶/etc/mysql/mariadb.conf.d/50-server.cnfçå¬å°åï¼ä¿®æ¹ä¸º0.0.0.0\n\n> bind-address = 0.0.0.0\n> \n> éå¯mariadb\n\n * åå»ºmysql_exporterç¨æ·\n\ncreate user \'mysql_exporter\'@\'localhost\' identified by \'password\';\n\n\n1\n\n * æµè¯ç¨æ·åå¯ç è¿æ¥\n\nmysql -umysql_exporter -hlocalhost -ppassword\n\n\n1\n\n * ä¸è½½mysql_exporter\n\n# ä¸è½½\nwget https://github.com/prometheus/mysqld_exporter/releases/download/v0.13.0/mysqld_exporter-0.13.0.linux-amd64.tar.gz\n# è§£å\ntar xvf mysqld_exporter-0.13.0.linux-amd64.tar.gz\n# æ¥çå¯å¨åæ°\n./mysqld_exporter --help\n\n\n1\n2\n3\n4\n5\n6\n\n * åå»ºåå¯ç»éæä»¶/root/.my.cnf\n\ncat >> /root/.my.cnf <<EOF\n[client]\nuser=mysql_exporter\npassword=123321\nEOF\n\n\n1\n2\n3\n4\n5\n\n * åå»ºmysqld_serviceæä»¶å¹¶å¯å¨\n\n# åå»ºè½¯é¾æ¥\nln -sv /apps/mysqld_exporter-0.13.0.linux-amd64 /apps/mysqld_exporter\n\n# åå»ºserviceæä»¶\ncat >> /etc/systemd/system/mysqld_exporter.service <<EOF\n[Unit]\nDescription=Prometheus Mysql Exporter\nAfter=network.target\n\n[Service]\nExecStart=/apps/mysqld_exporter/mysqld_exporter --config.my-cnf=/root/.my.cnf\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\n# éæ°å è½½éç½®\nsystemctl daemon-reload\n\n# å¯å¨mysqld_exporter\nsystemctl start mysqld_exporter.service\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n * éªè¯metrics\n\n1647316276383.png\n\n * éªè¯prometheus\n\n1647316313220.png\n\n * grafanaå¯¼å¥æ¨¡æ¿\n\n 1. 13106\n 2. 11323\n\n\n# 2.4 haproxy\n\néè¿haproxy_exporterçæ§haproxy\n\ngithubç½åï¼https://github.com/prometheus/haproxy_exporter\n\n * å®è£haproxy\n\napt install -y haproxy\n\n\n1\n\n * ä¿®æ¹éç½®æä»¶ï¼çå¬ä¸ä¸ªæå¡\n\nlisten SERVICE\n  bind BIND_IP:PORT\n  mode tcp\n  server SERVER_NAME LISTEN_IP:PORT check inter 3s fall 3 rise 3\n\n\n1\n2\n3\n4\n\n\n> ç¡®ä¿sockæä»¶æ¯adminç¨æ·ï¼levelåè¾¹çadminï¼\n> \n>     stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners\n> \n> \n> 1\n\n * éå¯haproxy\n\nsystemctl restart haproxy\n\n\n1\n\n\n> æ£æ¥çå¬ç«¯å£æ¯å¦æ­£å¸¸\n\n * ä¸è½½haproxy_exporter\n\n# ä¸è½½\nwget https://github.com/prometheus/haproxy_exporter/releases/download/v0.13.0/haproxy_exporter-0.13.0.linux-amd64.tar.gz\n# è§£å\ntar xvf haproxy_exporter-0.13.0.linux-amd64.tar.gz\n# åå»ºè½¯é¾æ¥\nln -sv /apps/haproxy_exporter-0.13.0.linux-amd64 /apps/haproxy_exporter\n\n\n1\n2\n3\n4\n5\n6\n\n * éç½®æä»¶å¯å¨haproxy_expoter\n\n./haproxy_exporter --haproxy.scrape-uri=unix:/run/haproxy/admin.sock\n\n\n1\n\n\n> ç«¯å£é»è®¤çå¬9101\n\n * éç½®haproxyç¶æé¡µ\n\nlisten stats\n  bind :PORT\n  stats enable\n  stats uri /haproxy-status\n  stats realm HAProxy\\ Stats\\ Page\n  stats auth haadmin:123456\n  stats auth admin:123456\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n> ç¼è¾/etc/haproxy/haproxy.cfgæ·»å å¦ä¸éç½®åå®¹\n\n * ç¶æé¡µå¯å¨haproxy\n\n./haproxy_exporter --haproxy.scrape-uri="http://admin:123456@127.0.0.1:PORT/haproxy-status;csv"\n\n\n1\n\n\n> éè¦æå®ç¨æ·åå¯ç ï¼csvæ¯æå®ä»¥csvå½¢å¼å±ç¤º\n\n * éªè¯exporter\n\n1647397779547.png\n\n * prometheusæ°æ®éé\n\n  - job_name: "haproxy-exporter"\n    static_configs:\n      - targets: ["127.0.0.1:9101"]\n\n\n1\n2\n3\n\n\n> èææºprometheus.ymléç½®ç¼©è¿æ ¼å¼\n> \n> ./promtool check config prometheus.yml # ä¿®æ¹åæ£æ¥éç½®æä»¶æ¯å¦æ­£ç¡®\n\n * éå¯prometheus\n\nsystemctl restart prometheus.service\n\n\n1\n\n\n * éªè¯prometheus\n\n * grafanaå¯¼å¥æ¨¡æ¿\n\n 1. 367\n 2. 2428\n\n\n# 2.5 nginx\n\néè¿nginx_exporterçæ§ngix\n\ngithubæ¨¡åä¾èµç½åï¼https://github.com/vozlt/nginx-module-vts\n\n * å®è£nginx\n\n# åéä¾èµæ¨¡å\ngit clone https://github.com/vozlt/nginx-module-vts.git\n# ä¸è½½nginxæºç \nwget http://nginx.org/download/nginx-1.20.2.tar.gz\n# è§£å\ntar xvf nginx-1.20.2.tar.gz\n# å®è£nginxç¼è¯ä¾èµå\napt install -y libgd-dev libgeoip-dev libpcre3 libpcre3-dev libssl-dev gcc make\n# ç¼è¯nginx\ncd nginx-1.20.2\n./configure --prefix=/apps/nginx \\\n--with-http_ssl_module \\\n--with-http_v2_module \\\n--with-http_realip_module \\\n--with-http_stub_status_module  \\\n--with-http_gzip_static_module \\\n--with-pcre \\\n--with-file-aio \\\n--with-stream \\\n--with-stream_ssl_module \\\n--with-stream_realip_module \\\n--add-module=/usr/local/src/nginx-module-vts/\n# make\nmake\n# make install\nmake install\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n * ä¿®æ¹éç½®æä»¶\n\nhttp {\n    vhost_traffic_status_zone;\n\n    ...\n\n    server {\n\n        ...\n\n        location /status {\n            vhost_traffic_status_display;\n            vhost_traffic_status_display_format html;\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n> åèhttps://github.com/vozlt/nginx-module-vtsæ·»å éç½®\n\n * å¯å¨nginx\n\n# æ£æ¥éç½®æä»¶\n/apps/nginx/sbin/nginx -t\n# å¯å¨nginx\n/apps/nginx/sbin/nginx\n\n\n1\n2\n3\n4\n\n * éç½®nginxçupstream\n\n    # httpæ¨¡åéè¾¹ï¼serveræ¨¡ååçº§\n    upstream SERVICE {\n      server IP:PORT;\n    }\n        # serveræ¨¡åéè¾¹ï¼è½¬åé¦é¡µ\n        location / {\n            #root   html;\n            #index  index.html index.htm;\n            proxy_pass http://SERVICE;\n        }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * æ£æ¥ç¶æé¡µ\n\n> å¯ä»¥ä»¥jsonæ¨¡å¼æ¾ç¤ºæ°æ®\n\n * å®è£nginx_exporter\n\n# ä¸è½½\nwget https://github.com/hnlq715/nginx-vts-exporter/releases/download/v0.10.3/nginx-vts-exporter-0.10.3.linux-amd64.tar.gz\n# è§£å\ntar xvf nginx-vts-exporter-0.10.3.linux-amd64.tar.gz\n# åå»ºè½¯é¾æ¥\nln -sv /apps/nginx-vts-exporter-0.10.3.linux-amd64 nginx-vts-exporter\n# å¯å¨nginx_exporter\n./nginx-vts-exporter  -nginx.scrape_uri http://IP/status/format/json\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n> é»è®¤çå¬ç«¯å£å·9913\n\n * éªè¯æ°æ®\n\n1647402416180.png\n\n * prometheusæ°æ®éé\n\n  - job_name: "nginx-exporter"\n    static_configs:\n      - targets: ["127.0.0.1:9913"]\n\n\n1\n2\n3\n\n\n> èææºprometheus.ymléç½®æä»¶ç¼©è¿æ ¼å¼\n\n * prometheuséªè¯æ°æ®\n\n * grafanaå¯¼å¥æ¨¡æ¿\n\n 1. 2949\n\n\n# 2.6 blockboxçæ§url\n\nå®æ¹å°åï¼https://prometheus.io/download/#blackbox_exporter\n\nblockbox_exporteræ¯prometheuså®æ¹æä¾çä¸ä¸ªexporterï¼å¯ä»¥éè¿httpï¼httpsï¼dnsï¼tcpåicmpå¯¹è¢«çæ§èç¹è¿è¡çæ§åæ°æ®éé\n\n> http/httpsï¼url/apiå¯ç¨æ§æ£æµ\n> \n> TCPï¼ç«¯å£çå¬æ£æµ\n> \n> ICMPï¼ä¸»æºå­æ´»æ£æµ\n> \n> DNSï¼ååè§£æ\n\n * é¨ç½²blackbox_exporter\n\n# ä¸è½½\nwget https://github.com/prometheus/blackbox_exporter/releases/download/v0.19.0/blackbox_exporter-0.19.0.linux-amd64.tar.gz\n# è§£å\ntar xvf blackbox_exporter-0.19.0.linux-amd64.tar.gz\n# åå»ºè½¯é¾æ¥\nln -sv /apps/blackbox_exporter-0.19.0.linux-amd64 blackbox_exporter\n\n\n1\n2\n3\n4\n5\n6\n\n * åå»ºblackbox-exporter.serviceæä»¶\n\ncat > /etc/systemd/system/blackbox-exporter.service <<EOF\n[Unit]\nDescription=Prometheus Blackbox Exporter\nDocumentation=https://prometheus.io/download/#blackbox_exporter\n\nAfter=network.target\n\n[Service]\nType=simple\nUser=root\nGroup=root\nRestart=on-failure\nExecStart=/apps/blackbox_exporter/blackbox_exporter --config.file=/apps/blackbox_exporter/blackbox.yml     --web.listen-address=:9115\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n * å¯å¨blackbox_exporter\n\nsystemctl daemon-reload\nsystemctl restart blackbox-exporter\n\n\n1\n2\n\n * éªè¯æ°æ®\n\n1647413347284.png\n\n> é»è®¤çå¬ç«¯å£9115\n\n * blackbox exporterçæ§url\n\nprometheusæ°æ®éé\n\n  - job_name: "http_status"\n    metrics_path: /probe\n    params:\n      module: [http_2xx]\n    static_configs:\n      - targets: ["domainname1","domainname2"]\n        labels:\n          instance: http_status\n          group: web\n    relabel_configs:\n      - source_labels: [__address__] # relbeléè¿å°__address__(å½åç®æ å°å)åå¥__param_tartgetæ ç­¾æ¥åå»ºä¸ä¸ªlabel\n        target_label: __param_target # çæ§ç®æ domainnameï¼ä½ä¸º__address__çvalue\n      - source_labels: [__param_target] # çæ§ç®æ \n        target_label: url # å°çæ§ç®æ ä¸urlåå»ºä¸ä¸ªlabel\n      - target_label: __address__\n        replacement: BLACKBOX_EXPORTER:PORT\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n> èææºprometheus.ymléç½®æä»¶ç¼©è¿æ ¼å¼\n\n * éªè¯prometheusç¶æ\n\n * æ¥çblackboxé¡µé¢\n\n1647415523065.png\n\n * blockbox_exporterçæ§icmp\n\nprometheusæ°æ®éé\n\n  - job_name: "ping_status"\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets: ["IP1","IP2"]\n        labels:\n          instance: \'ping_status\'\n          group: \'icmp\'\n    relabel_configs:\n      - source_labels: [__address__] \n        target_label: __param_target \n      - source_labels: [__param_target]\n        target_label: ip # å°ipä¸__param_targetåå»ºä¸ä¸ªlabel\n      - target_label: __address__\n        replacement: BLACKBOX_EXPORTER:PORT\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n> èææºprometheus.ymléç½®æä»¶ç¼©è¿æ ¼å¼\n\n * éªè¯prometheusç¶æ\n\n1647417886518.png\n\n * blackbox_exporterçæ§ç«¯å£\n\nprometheusæ°æ®éé\n\n# ç«¯å£çæ§\n  - job_name: "port_status"\n    metrics_path: /probe\n    params:\n      module: [tcp_connect]\n    static_configs:\n      - targets: ["IP:PORT","IP:PORT"]\n        labels:\n          instance: \'port_status\'\n          group: \'port\'\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target \n      - source_labels: [__param_target] \n        target_label: ip\n      - target_label: __address__\n        replacement: BLACKBOX_EXPORTER:PORT\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n * éªè¯prometheusç¶æ\n\n1647418487723.png\n\n * grafanaå¯¼å¥æ¨¡æ¿\n\n 1. 9965\n 2. 13587\n\n\n# ä¸ãåè­¦\n\n\n# 3.1 Alertmanager\n\nprometheus--\x3eè§¦åéå¼--\x3eè¶åºæç»­æ¶é´--\x3ealertmanager--\x3eåç»|æå¶|éé»--\x3eåªä½ç±»å--\x3eé®ä»¶|éé|å¾®ä¿¡ç­\n\n> prometheus serveréè¿éç½®çæ§è§åï¼å®ç°åè­¦åéï¼ç¶åæåè­¦pushç»Alertmanagerï¼å¹éAlertmanageréç½®çRouterï¼ä»¥WeChatãEmailæWebhookæ¹å¼åéç»å¯¹åºçReceiver\n\nåç»ï¼groupï¼ï¼å°ç±»ä¼¼æ§è´¨çåè­¦åå¹¶ä¸ºåä¸ªéç¥ï¼æ¯å¦ç½ç»éç¥ãä¸»æºéç¥ãæå¡éç¥\n\néé»ï¼silencesï¼ï¼æ¯ä¸ç§ç®åçç¹å®æ¶é´éé³çæºå¶ï¼ä¾å¦ï¼æå¡å¨è¦åçº§ç»´æ¤å¯ä»¥åè®¾ç½®è¿ä¸ªæ¶é´æ®µåè­¦éé»\n\næå¶ï¼inhibitionï¼ï¼å½åè­¦ååºåï¼åæ­¢éå¤åéç±æ­¤åè­¦å¼åçå¶ä»åè­¦ï¼å³åå¹¶ç±ä¸ä¸ªæéå¼èµ·çå¤ä¸ªåè­¦äºä»¶ï¼å¯ä»¥æ¶é¤åä½åè­¦\n\n * å®è£alertmanager\n\n# ä¸è½½\nwget https://github.com/prometheus/alertmanager/releases/download/v0.23.0/alertmanager-0.23.0.linux-amd64.tar.gz\n# è§£å\ntar xvf alertmanager-0.23.0.linux-amd64.tar.gz\n# åå»ºè½¯é¾æ¥\nln -sv /apps/alertmanager-0.23.0.linux-amd64 /apps/alertmanager\n\n\n1\n2\n3\n4\n5\n6\n\n * åå»ºalertmanager.serviceæä»¶\n\ncat > /etc/systemd/system/alertmanager.service <<EOF\n[Unit]\nDescription=Prometheus alertmanager\nAfter=network.target\n\n[Service]\nExecStart=/apps/alertmanager/alertmamager --config.file="/apps/alertmanager/alertmanager.yml"\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n * å¯å¨alertmanager\n\nsystemctl start alertmanager.service\n\n\n1\n\n\n> é»è®¤çå¬ç«¯å£9093ï¼9094\n\nçæ§éç½®å®æ¹ç½åï¼https://prometheus.io/docs/alerting/latest/configuration/\n\n * éªè¯alertmanagerç¶æ\n\n1647481599806.png\n\n\n# 3.2 é®ä»¶\n\nå®æ¹ç½åï¼https://prometheus.io/docs/alerting/latest/configuration/#email_config\n\n * éç½®æä»¶ä»ç»\n\nalertmanager.ymléç½®æä»¶\n\nglobal:\n  resolve_timeout: 5m # alertmanagerå¨æç»­å¤ä¹æ²¡ææ¶å°æ°åè­¦åæ è®°ä¸ºresolved\n  smtp_from:  # åä»¶äººé®ç®±å°å\n  smtp_smarthost:  # é®ç®±smtpå°å\n  smtp_auth_username:  # åä»¶äººçç»éç¨æ·åï¼é»è®¤ååä»¶äººå°åä¸è´\n  smtp_auth_password:  # åä»¶äººçç»éå¯ç ï¼ææ¶åæ¯ææç \n  smtp_hello:\n  smtp_require_tls:  # æ¯å¦éè¦tlsåè®®ãé»è®¤æ¯true\n\nroute:\n  group_by: [alertname] # éè¿alertnameçå¼å¯¹åè­¦è¿è¡åç±»\n  group_wait: 10s # ä¸ç»åè­¦ç¬¬ä¸æ¬¡åéä¹åç­å¾çæ¶å»¶ï¼å³äº§çåè­¦10så°ç»åæ°äº§ççæ¶æ¯åå¹¶åéï¼éå¸¸æ¯0s~å åéï¼é»è®¤æ¯30sï¼\n  group_interval: 2m # ä¸ç»å·²åéè¿åå§åè­¦éç¥çåè­¦ï¼æ¥æ¶å°æ°åè­¦åï¼ä¸æ¬¡åééç¥åç­å¾æ¶å»¶ï¼éå¸¸æ¯5mææ´ä¹ï¼é»è®¤æ¯5mï¼\n  repeat_interval: 5m # ä¸ç»å·²ç»åéè¿éç¥çåè­¦ï¼éå¤åéåè­¦çé´éï¼éå¸¸è®¾ç½®ä¸º3hæèæ´ä¹ï¼é»è®¤æ¯4hï¼\n  receiver: \'default-receiver\' # è®¾ç½®åè­¦æ¥æ¶äºº\n\nreceivers:\n- name: \'default-receiver\'\n  email_configs:\n  - to: \'EMAIL@DOMAIN.com\'\n    send_resolved: true # åéæ¢å¤åè­¦éç¥\n\ninhibit_rules: # æå¶è§å\n  - source_match:  # æºå¹éçº§å«ï¼å½å¹éæåååºéç¥ï¼å¶ä»çº§å«äº§çåè­¦å°è¢«æå¶\n      severity: \'critical\' # åè­¦æ¶é´çº§å«ï¼åè­¦çº§å«æ ¹æ®è§åèªå®ä¹ï¼\n    target_match: \n      severity: \'warning\' # å¹éç®æ æååï¼æ°äº§ççç®æ åè­¦ä¸º\'warning\'å°è¢«æå¶\n    equal: [\'alertname\',\'dev\',\'instance\'] # åºäºè¿äºæ ç­¾æå¶å¹éåè­¦ççº§å«\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n> # æ¶é´ç¤ºä¾è§£æ\n> # group_wait: 10s # ç¬¬ä¸æ¬¡äº§çåè­¦ï¼ç­å¾10sï¼ç»åææ°å¢åè­¦ï¼ä¸èµ·ååºï¼æ²¡æååç¬ååº\n> # group_interval: 2m # ç¬¬äºæ¬¡äº§çåè­¦ï¼åç­å¾2mï¼2måæ²¡ææ¢å¤å°±è¿å¥repeat_interval\n> # repeat_interval: 5m # å¨ç¬¬äºæ¬¡åè­¦æ¶å»¶è¿åï¼åç­å¾5mï¼5måæ²¡ææ¢å¤ï¼å°±åéç¬¬äºæ¬¡åè­¦\n> \n> \n> 1\n> 2\n> 3\n> 4\n> \n> \n> å¦ä¸éç½®ï¼å¦æåè­¦æ²¡ææ¢å¤ï¼ç¬¬äºæ¬¡åè­¦ä¼ç­å¾2m+5mï¼å³7åéåååº\n\n * éç½®åè­¦è§å\n\ngroups:\n  - name: alertmanager_pod.rules\n    rules:\n    - alert: Pod_all_cpu_usage\n      expr: (sum by(name)(rate(container_cpu_usage_seconds_total{image!=""}[5m]))*100) > 1\n      for: 2m\n      labels:\n        serverity: critical\n        service: pods\n      annotations:\n        description: å®¹å¨ {{ $labels.name }} CPU èµæºå©ç¨çå¤§äº 10% , (current value is {{ $value }})\n        summary: Dev CPU è´è½½åè­¦\n\n    - alert: Pod_all_memory_usage\n      expr: sort_desc(avg by(name)(irate(node_memory_MemFree_bytes {name!=""}[5m]))) > 2147483648 # åå­å¤§äº2G\n      for: 2m\n      labels:\n        severity: critical\n      annotations:\n        description: å®¹å¨ {{ $labels.name }} Memory èµæºå©ç¨å¤§äº 2G , (current value is {{ $value }})\n        summary: Dev Memory è´è½½åè­¦\n\n    - alert: Pod_all_network_receive_usage\n      expr: sum by(name)(irate(container_network_reveive_bytes_total{container_name="POD"}[1m])) > 52428800 # å¤§äº50M\n      for: 2m\n      labels:\n        severity: critical\n      annotations:\n        description: å®¹å¨ {{ $labels.name }} network_receive èµæºå©ç¨å¤§äº 50M , (current value is {{ $value }})\n\n    - alert: nodeåå­å¯ç¨å¤§å°\n      expr: node_memory_MemFree_bytes < 4294967296 # åå­å°äº4G\n      for: 2m\n      labels:\n        severity: critical\n      annotations:\n        description: nodeå¯ç¨åå­å°äº4G\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\n> å¨/apps/prometheus/ç®å½ä¸åå»ºrulesç®å½ï¼åå»ºpods_rule.yamlæä»¶ï¼åå®¹å¦ä¸\n> \n> æ³¨æç¼©è¿æ ¼å¼ï¼å¦ææä»¶æ ¼å¼æè¯¯ï¼éå¯prometheusçæ¶åï¼promethuesä¼ä¸ç´èµ·ä¸æ¥ï¼å¯ä»¥åç¨promtoolæ£æ¥éç½®æä»¶æ ¼å¼ï¼å ä¸ºå è½½åè­¦éç½®çæ¶åï¼å¼å¥äºè¿ä¸ªæä»¶ï¼æä»¥å¨æ£æ¥promethues.ymlæä»¶çæ¶åä¹ä¼æ£æ¥èªå®ä¹çpods_rule.yamlæä»¶\n\n * promethueså è½½åè­¦éç½®\n\n# Alertmanager configuration\nalerting:\n  alertmanagers:\n    - static_configs:\n        - targets:\n          - IP:9093\n\n# Load rules once and periodically evaluate them according to the global \'evaluation_interval\'.\nrule_files:\n  - "/apps/prometheus/rules/pods_rule.yaml"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n> æ³¨ï¼å¦æä¿®æ¹rule_filesä¸­çåå®¹ï¼éè¦åéå¯prometheusï¼å è½½ä¿®æ¹åçéç½®ï¼ç¶åä¿®æ¹alertmanagerï¼ä¸ç¶ä¿®æ¹åçåè­¦åå®¹ä¸ä¼çæ\n\n * éå¯prometheus\n\nsystemctl restart prometheus.service\n\n\n1\n\n * éªè¯prometheusç¶æ\n\n> å¨prometheusé¡µé¢ï¼ç¹å»Alertsæ¥çåè­¦ç¶æï¼å½åä¸ºPENDINGï¼è¯´æå·²ç»æ£æµå°åè­¦ï¼è¿æ²¡æ»¡è¶³åé®ä»¶çæ¶é´è§å\n\n1647485888388.png\n\n> FIRINGè¯æåè­¦å·²æåï¼æ­¤æ¶åºè¯¥å·²ç»æ¶å°é®ä»¶\n\n * æ¥çalertmanageråè­¦\n\n * æ¥çåè­¦é®ä»¶\n\n1647485953827.png\n\n> ç¹å»Sourceé¾æ¥ï¼è·³è½¬çæ¯ä¸»æºåå prometheus-serverçç«¯å£ï¼æ æ³è§£æå°±è·³è½¬ä¸è¿å»\n\n * ä½¿ç¨amtoolæ¥çåè­¦\n\n./amtool alert --alertmanager.url=http://IP:9093\n\n\n1\n\n\n1647485846885.png\n\n\n# 3.3 éé\n\n * ééæ·»å æºå¨äºº\n\nåå»ºæºå¨äººå®æ¹ç½åï¼https://open.dingtalk.com/document/robots/custom-robot-access\n\n * åéæ¶æ¯èæ¬\n\nvim /data/scripts/dingding-keywords.sh\nMESSAGE=$1\n\n/usr/bin/curl -X POST \'https://oapi.dingtalk.com/robot/send?access_token=TOKEN\'\\\n-H \'Content-Type: application/json\' \\\n-d \'{"msgtype": "text",\n     "text": {\n        "content": "${MESSAGE}"\n     }\n    }\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * æµè¯åéæ¶æ¯\n\n1647506928206.png\n\n> åéçæ¶æ¯åå®¹ä¸­ï¼å¿é¡»åå«èªå®ä¹çå³é®å­ï¼ä¸ç¶åéæ¶æ¯ä¼å¤±è´¥ï¼åéèæ¬åéæ¶æ¯æååï¼ç¾¤éä¼æ¶å°\n\n * é¨ç½²webhook-dingtalk\n\n# ä¸è½½\nwget https://github.com/timonwong/prometheus-webhook-dingtalk/releases/download/v1.4.0/prometheus-webhook-dingtalk-1.4.0.linux-amd64.tar.gz\n# è§£å\ntar xvf prometheus-webhook-dingtalk-1.4.0.linux-amd64.tar.gz\n# åå»ºè½¯é¾æ¥\nln -sv /apps/prometheus-webhook-dingtalk-1.4.0.linux-amd64 prometheus-webhook-dingtalk\n\n\n1\n2\n3\n4\n5\n6\n\n\n> ä¸è½½çwebhook-dingtalkçæ¬æå¥½è·è¿ä¸ªä¿æä¸ç´ï¼æ°çæ¬æäºå°æ¹ä¸å¼å®¹\n\n * å¯å¨webhook-dingtalk\n\ncd /apps/prometheus-webhook-dingtalk\n./prometheus-webhook-dingtalk --web.listen-address="0.0.0.0:8060" --ding.profile="KEYWORD=https://oapi.dingtalk.com/robot/send?access_token=TOKEN" \n\n\n1\n2\n\n\n> æå®çå¬ç«¯å£8060\n> \n> KEYWORDå¿é¡»æ¯åå»ºæºå¨äººæ¶çèªå®ä¹å³é®å­ï¼ä¸ç¶åè­¦åå¸åºå»ï¼ä¼æ¥é\n\n * éç½®alertmanager\n\n- name: \'dingding\'\n  webhook_configs:\n  - url: \'http://IP:8060/dingtalk/alertsen/send\'\n    send_resolved: true\n\n\n1\n2\n3\n4\n\n * éå¯alertmanager\n\nsystemctl restart alertmanager.service\n\n\n1\n',normalizedContent:'# ä¸ãkube-state-metrics\n\n\n# 1.1 kube-state-metricsä»ç»\n\ngithubå°åï¼https://github.com/kubernetes/kube-state-metrics\n\néåå°åï¼https://hub.docker.com/r/bitnami/kube-state-metrics\n\nåå®¢ä»ç»ï¼https://xie.infoq.cn/article/9e1fff6306649e65480a96bb1\n\nkube-state-metricsæ¯éè¿çå¬api serverçææå³èµæºå¯¹è±¡çç¶æææ ï¼æ¯å¦deploymentãnodeãpodï¼éè¦æ³¨æçæ¯kube-state-metricsåªæ¯ç®åçæä¾ä¸ä¸ªmetricsæ°æ®ï¼å¹¶ä¸ä¼å­å¨è¿äºææ æ°æ®ï¼æä»¥æä»¬å¯ä»¥ä½¿ç¨prometheusæ¥æåè¿äºæ°æ®ç¶åå­å¨ï¼ä¸»è¦å³æ³¨çæ¯ä¸å¡ç¸å³çä¸äºåæ°æ®ï¼æ¯å¦deploymentãpodãå¯æ¬ç¶æç­ï¼è°åº¦äºå¤å°ä¸ªreplicasï¼ç°å¨å¯ç¨çæå ä¸ªï¼å¤å°ä¸ªpodæ¯running/stopped/terminatedç¶æï¼podéå¯äºå¤å°æ¬¡ï¼ç®åç±å¤å°jobå¨è¿è¡ä¸­\n\n\n# 1.2 é¨ç½²kube-state-metrics\n\n 1. ç¼ååºäºdeployæ§å¶å¨çyamlæä»¶\n 2. ç¼åsvcçyamlæä»¶ï¼ç«¯å£æ´é²ä¸ºnodeport\n 3. é¨ç½²\n\n\n# 1.3 éªè¯æ°æ®\n\n\n\n\n\n\n# 1.4 prometheusæ°æ®éé\n\n    - job_name: \'kube-state-metrics\'\n      static_configs:\n        - targets: ["ip:port"]\n\n\n1\n2\n3\n\n\n> k8séç½®æä»¶configmapç¼©è¿æ ¼å¼\n\n\n# 1.5 éªè¯prometheusç¶æ\n\n\n# 1.6 grafanaå¯¼å¥æ¨¡æ¿\n\n 1. 13824\n 2. 14518\n\n> å ä¸ºçæ¬ä¸åï¼å¯æ ¹æ®å¯¹åºçæ¬è¿è¡è®¾ç½®\n> \n> dashboardæ¨¡æ¿ç½åï¼https://grafana.com/grafana/dashboards/\n\n\n# äºãçæ§ç¤ºä¾\n\nåºäºç¬¬ä¸æ¹exporterå®ç°å¯¹ç®æ æå¡ççæ§\n\n\n# 2.1 tomcat\n\n * æå»ºéå\n\ngithubå°åï¼https://github.com/nlighten/tomcat_exporter\n\næ ¹æ®tomcatå®æ¹éåæ·»å jarå\n\nadd metrics.war /data/tomcat/webapps\nadd simpleclient-0.8.0.jar  /usr/local/tomcat/lib/\nadd simpleclient_common-0.8.0.jar /usr/local/tomcat/lib/\nadd simpleclient_hotspot-0.8.0.jar /usr/local/tomcat/lib/\nadd simpleclient_servlet-0.8.0.jar /usr/local/tomcat/lib/\nadd tomcat_exporter_client-0.0.12.jar /usr/local/tomcat/lib/\n\n\n1\n2\n3\n4\n5\n6\n\n * prometheuséé\n\n    - job_name: \'kube-state-metrics\'\n      static_configs:\n        - targets: ["ip:port"]\n\n\n1\n2\n3\n\n\n> k8séç½®æä»¶configmapç¼©è¿æ ¼å¼\n\n * prometheuséªè¯\n\n * grafanaå¯¼å¥æ¨¡æ¿\n\ngithubå°åï¼https://github.com/nlighten/tomcat_exporter/blob/master/dashboard/example.json\n\n> ä¸è½½è¿ä¸ªjsonæä»¶å¯¼å¥grafanaå³å¯\n\n\n# 2.2 redis\n\néè¿redis_exporterçæ§redisæå¡è£æ\n\ngithubç½åï¼https://github.com/oliver006/redis_exporter\n\n * é¨ç½²redis\n\n> ä¸ä¸ªpodä¸¤ä¸ªå®¹å¨ï¼redisåredis-exporter\n\n * prometheuséé\n\n    - job_name: \'redis-metrics\'\n      static_configs:\n        - targets: ["ip:port"]\n\n\n1\n2\n3\n\n\n> k8séç½®æä»¶configmapç¼©è¿æ ¼å¼\n\n * grafanaå¯¼å¥æ¨¡æ¿\n\n 1. 14615\n 2. 11692\n\n\n# 2.3 mysql\n\néè¿mysqld_exporterçæ§mysqlæå¡çè¿è¡ç¶æ\n\ngithubç½åï¼https://github.com/prometheus/mysqld_exporter\n\n * å®è£mariadb-server\n\napt install -y mariadb\n\n\n1\n\n * ä¿®æ¹éç½®æä»¶/etc/mysql/mariadb.conf.d/50-server.cnfçå¬å°åï¼ä¿®æ¹ä¸º0.0.0.0\n\n> bind-address = 0.0.0.0\n> \n> éå¯mariadb\n\n * åå»ºmysql_exporterç¨æ·\n\ncreate user \'mysql_exporter\'@\'localhost\' identified by \'password\';\n\n\n1\n\n * æµè¯ç¨æ·åå¯ç è¿æ¥\n\nmysql -umysql_exporter -hlocalhost -ppassword\n\n\n1\n\n * ä¸è½½mysql_exporter\n\n# ä¸è½½\nwget https://github.com/prometheus/mysqld_exporter/releases/download/v0.13.0/mysqld_exporter-0.13.0.linux-amd64.tar.gz\n# è§£å\ntar xvf mysqld_exporter-0.13.0.linux-amd64.tar.gz\n# æ¥çå¯å¨åæ°\n./mysqld_exporter --help\n\n\n1\n2\n3\n4\n5\n6\n\n * åå»ºåå¯ç»éæä»¶/root/.my.cnf\n\ncat >> /root/.my.cnf <<eof\n[client]\nuser=mysql_exporter\npassword=123321\neof\n\n\n1\n2\n3\n4\n5\n\n * åå»ºmysqld_serviceæä»¶å¹¶å¯å¨\n\n# åå»ºè½¯é¾æ¥\nln -sv /apps/mysqld_exporter-0.13.0.linux-amd64 /apps/mysqld_exporter\n\n# åå»ºserviceæä»¶\ncat >> /etc/systemd/system/mysqld_exporter.service <<eof\n[unit]\ndescription=prometheus mysql exporter\nafter=network.target\n\n[service]\nexecstart=/apps/mysqld_exporter/mysqld_exporter --config.my-cnf=/root/.my.cnf\n\n[install]\nwantedby=multi-user.target\neof\n\n# éæ°å è½½éç½®\nsystemctl daemon-reload\n\n# å¯å¨mysqld_exporter\nsystemctl start mysqld_exporter.service\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n\n * éªè¯metrics\n\n1647316276383.png\n\n * éªè¯prometheus\n\n1647316313220.png\n\n * grafanaå¯¼å¥æ¨¡æ¿\n\n 1. 13106\n 2. 11323\n\n\n# 2.4 haproxy\n\néè¿haproxy_exporterçæ§haproxy\n\ngithubç½åï¼https://github.com/prometheus/haproxy_exporter\n\n * å®è£haproxy\n\napt install -y haproxy\n\n\n1\n\n * ä¿®æ¹éç½®æä»¶ï¼çå¬ä¸ä¸ªæå¡\n\nlisten service\n  bind bind_ip:port\n  mode tcp\n  server server_name listen_ip:port check inter 3s fall 3 rise 3\n\n\n1\n2\n3\n4\n\n\n> ç¡®ä¿sockæä»¶æ¯adminç¨æ·ï¼levelåè¾¹çadminï¼\n> \n>     stats socket /run/haproxy/admin.sock mode 660 level admin expose-fd listeners\n> \n> \n> 1\n\n * éå¯haproxy\n\nsystemctl restart haproxy\n\n\n1\n\n\n> æ£æ¥çå¬ç«¯å£æ¯å¦æ­£å¸¸\n\n * ä¸è½½haproxy_exporter\n\n# ä¸è½½\nwget https://github.com/prometheus/haproxy_exporter/releases/download/v0.13.0/haproxy_exporter-0.13.0.linux-amd64.tar.gz\n# è§£å\ntar xvf haproxy_exporter-0.13.0.linux-amd64.tar.gz\n# åå»ºè½¯é¾æ¥\nln -sv /apps/haproxy_exporter-0.13.0.linux-amd64 /apps/haproxy_exporter\n\n\n1\n2\n3\n4\n5\n6\n\n * éç½®æä»¶å¯å¨haproxy_expoter\n\n./haproxy_exporter --haproxy.scrape-uri=unix:/run/haproxy/admin.sock\n\n\n1\n\n\n> ç«¯å£é»è®¤çå¬9101\n\n * éç½®haproxyç¶æé¡µ\n\nlisten stats\n  bind :port\n  stats enable\n  stats uri /haproxy-status\n  stats realm haproxy\\ stats\\ page\n  stats auth haadmin:123456\n  stats auth admin:123456\n\n\n1\n2\n3\n4\n5\n6\n7\n\n\n> ç¼è¾/etc/haproxy/haproxy.cfgæ·»å å¦ä¸éç½®åå®¹\n\n * ç¶æé¡µå¯å¨haproxy\n\n./haproxy_exporter --haproxy.scrape-uri="http://admin:123456@127.0.0.1:port/haproxy-status;csv"\n\n\n1\n\n\n> éè¦æå®ç¨æ·åå¯ç ï¼csvæ¯æå®ä»¥csvå½¢å¼å±ç¤º\n\n * éªè¯exporter\n\n1647397779547.png\n\n * prometheusæ°æ®éé\n\n  - job_name: "haproxy-exporter"\n    static_configs:\n      - targets: ["127.0.0.1:9101"]\n\n\n1\n2\n3\n\n\n> èææºprometheus.ymléç½®ç¼©è¿æ ¼å¼\n> \n> ./promtool check config prometheus.yml # ä¿®æ¹åæ£æ¥éç½®æä»¶æ¯å¦æ­£ç¡®\n\n * éå¯prometheus\n\nsystemctl restart prometheus.service\n\n\n1\n\n\n * éªè¯prometheus\n\n * grafanaå¯¼å¥æ¨¡æ¿\n\n 1. 367\n 2. 2428\n\n\n# 2.5 nginx\n\néè¿nginx_exporterçæ§ngix\n\ngithubæ¨¡åä¾èµç½åï¼https://github.com/vozlt/nginx-module-vts\n\n * å®è£nginx\n\n# åéä¾èµæ¨¡å\ngit clone https://github.com/vozlt/nginx-module-vts.git\n# ä¸è½½nginxæºç \nwget http://nginx.org/download/nginx-1.20.2.tar.gz\n# è§£å\ntar xvf nginx-1.20.2.tar.gz\n# å®è£nginxç¼è¯ä¾èµå\napt install -y libgd-dev libgeoip-dev libpcre3 libpcre3-dev libssl-dev gcc make\n# ç¼è¯nginx\ncd nginx-1.20.2\n./configure --prefix=/apps/nginx \\\n--with-http_ssl_module \\\n--with-http_v2_module \\\n--with-http_realip_module \\\n--with-http_stub_status_module  \\\n--with-http_gzip_static_module \\\n--with-pcre \\\n--with-file-aio \\\n--with-stream \\\n--with-stream_ssl_module \\\n--with-stream_realip_module \\\n--add-module=/usr/local/src/nginx-module-vts/\n# make\nmake\n# make install\nmake install\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n\n * ä¿®æ¹éç½®æä»¶\n\nhttp {\n    vhost_traffic_status_zone;\n\n    ...\n\n    server {\n\n        ...\n\n        location /status {\n            vhost_traffic_status_display;\n            vhost_traffic_status_display_format html;\n        }\n    }\n}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n> åèhttps://github.com/vozlt/nginx-module-vtsæ·»å éç½®\n\n * å¯å¨nginx\n\n# æ£æ¥éç½®æä»¶\n/apps/nginx/sbin/nginx -t\n# å¯å¨nginx\n/apps/nginx/sbin/nginx\n\n\n1\n2\n3\n4\n\n * éç½®nginxçupstream\n\n    # httpæ¨¡åéè¾¹ï¼serveræ¨¡ååçº§\n    upstream service {\n      server ip:port;\n    }\n        # serveræ¨¡åéè¾¹ï¼è½¬åé¦é¡µ\n        location / {\n            #root   html;\n            #index  index.html index.htm;\n            proxy_pass http://service;\n        }\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * æ£æ¥ç¶æé¡µ\n\n> å¯ä»¥ä»¥jsonæ¨¡å¼æ¾ç¤ºæ°æ®\n\n * å®è£nginx_exporter\n\n# ä¸è½½\nwget https://github.com/hnlq715/nginx-vts-exporter/releases/download/v0.10.3/nginx-vts-exporter-0.10.3.linux-amd64.tar.gz\n# è§£å\ntar xvf nginx-vts-exporter-0.10.3.linux-amd64.tar.gz\n# åå»ºè½¯é¾æ¥\nln -sv /apps/nginx-vts-exporter-0.10.3.linux-amd64 nginx-vts-exporter\n# å¯å¨nginx_exporter\n./nginx-vts-exporter  -nginx.scrape_uri http://ip/status/format/json\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n> é»è®¤çå¬ç«¯å£å·9913\n\n * éªè¯æ°æ®\n\n1647402416180.png\n\n * prometheusæ°æ®éé\n\n  - job_name: "nginx-exporter"\n    static_configs:\n      - targets: ["127.0.0.1:9913"]\n\n\n1\n2\n3\n\n\n> èææºprometheus.ymléç½®æä»¶ç¼©è¿æ ¼å¼\n\n * prometheuséªè¯æ°æ®\n\n * grafanaå¯¼å¥æ¨¡æ¿\n\n 1. 2949\n\n\n# 2.6 blockboxçæ§url\n\nå®æ¹å°åï¼https://prometheus.io/download/#blackbox_exporter\n\nblockbox_exporteræ¯prometheuså®æ¹æä¾çä¸ä¸ªexporterï¼å¯ä»¥éè¿httpï¼httpsï¼dnsï¼tcpåicmpå¯¹è¢«çæ§èç¹è¿è¡çæ§åæ°æ®éé\n\n> http/httpsï¼url/apiå¯ç¨æ§æ£æµ\n> \n> tcpï¼ç«¯å£çå¬æ£æµ\n> \n> icmpï¼ä¸»æºå­æ´»æ£æµ\n> \n> dnsï¼ååè§£æ\n\n * é¨ç½²blackbox_exporter\n\n# ä¸è½½\nwget https://github.com/prometheus/blackbox_exporter/releases/download/v0.19.0/blackbox_exporter-0.19.0.linux-amd64.tar.gz\n# è§£å\ntar xvf blackbox_exporter-0.19.0.linux-amd64.tar.gz\n# åå»ºè½¯é¾æ¥\nln -sv /apps/blackbox_exporter-0.19.0.linux-amd64 blackbox_exporter\n\n\n1\n2\n3\n4\n5\n6\n\n * åå»ºblackbox-exporter.serviceæä»¶\n\ncat > /etc/systemd/system/blackbox-exporter.service <<eof\n[unit]\ndescription=prometheus blackbox exporter\ndocumentation=https://prometheus.io/download/#blackbox_exporter\n\nafter=network.target\n\n[service]\ntype=simple\nuser=root\ngroup=root\nrestart=on-failure\nexecstart=/apps/blackbox_exporter/blackbox_exporter --config.file=/apps/blackbox_exporter/blackbox.yml     --web.listen-address=:9115\n\n[install]\nwantedby=multi-user.target\neof\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n * å¯å¨blackbox_exporter\n\nsystemctl daemon-reload\nsystemctl restart blackbox-exporter\n\n\n1\n2\n\n * éªè¯æ°æ®\n\n1647413347284.png\n\n> é»è®¤çå¬ç«¯å£9115\n\n * blackbox exporterçæ§url\n\nprometheusæ°æ®éé\n\n  - job_name: "http_status"\n    metrics_path: /probe\n    params:\n      module: [http_2xx]\n    static_configs:\n      - targets: ["domainname1","domainname2"]\n        labels:\n          instance: http_status\n          group: web\n    relabel_configs:\n      - source_labels: [__address__] # relbeléè¿å°__address__(å½åç®æ å°å)åå¥__param_tartgetæ ç­¾æ¥åå»ºä¸ä¸ªlabel\n        target_label: __param_target # çæ§ç®æ domainnameï¼ä½ä¸º__address__çvalue\n      - source_labels: [__param_target] # çæ§ç®æ \n        target_label: url # å°çæ§ç®æ ä¸urlåå»ºä¸ä¸ªlabel\n      - target_label: __address__\n        replacement: blackbox_exporter:port\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n> èææºprometheus.ymléç½®æä»¶ç¼©è¿æ ¼å¼\n\n * éªè¯prometheusç¶æ\n\n * æ¥çblackboxé¡µé¢\n\n1647415523065.png\n\n * blockbox_exporterçæ§icmp\n\nprometheusæ°æ®éé\n\n  - job_name: "ping_status"\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets: ["ip1","ip2"]\n        labels:\n          instance: \'ping_status\'\n          group: \'icmp\'\n    relabel_configs:\n      - source_labels: [__address__] \n        target_label: __param_target \n      - source_labels: [__param_target]\n        target_label: ip # å°ipä¸__param_targetåå»ºä¸ä¸ªlabel\n      - target_label: __address__\n        replacement: blackbox_exporter:port\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n\n\n> èææºprometheus.ymléç½®æä»¶ç¼©è¿æ ¼å¼\n\n * éªè¯prometheusç¶æ\n\n1647417886518.png\n\n * blackbox_exporterçæ§ç«¯å£\n\nprometheusæ°æ®éé\n\n# ç«¯å£çæ§\n  - job_name: "port_status"\n    metrics_path: /probe\n    params:\n      module: [tcp_connect]\n    static_configs:\n      - targets: ["ip:port","ip:port"]\n        labels:\n          instance: \'port_status\'\n          group: \'port\'\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target \n      - source_labels: [__param_target] \n        target_label: ip\n      - target_label: __address__\n        replacement: blackbox_exporter:port\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n * éªè¯prometheusç¶æ\n\n1647418487723.png\n\n * grafanaå¯¼å¥æ¨¡æ¿\n\n 1. 9965\n 2. 13587\n\n\n# ä¸ãåè­¦\n\n\n# 3.1 alertmanager\n\nprometheus--\x3eè§¦åéå¼--\x3eè¶åºæç»­æ¶é´--\x3ealertmanager--\x3eåç»|æå¶|éé»--\x3eåªä½ç±»å--\x3eé®ä»¶|éé|å¾®ä¿¡ç­\n\n> prometheus serveréè¿éç½®çæ§è§åï¼å®ç°åè­¦åéï¼ç¶åæåè­¦pushç»alertmanagerï¼å¹éalertmanageréç½®çrouterï¼ä»¥wechatãemailæwebhookæ¹å¼åéç»å¯¹åºçreceiver\n\nåç»ï¼groupï¼ï¼å°ç±»ä¼¼æ§è´¨çåè­¦åå¹¶ä¸ºåä¸ªéç¥ï¼æ¯å¦ç½ç»éç¥ãä¸»æºéç¥ãæå¡éç¥\n\néé»ï¼silencesï¼ï¼æ¯ä¸ç§ç®åçç¹å®æ¶é´éé³çæºå¶ï¼ä¾å¦ï¼æå¡å¨è¦åçº§ç»´æ¤å¯ä»¥åè®¾ç½®è¿ä¸ªæ¶é´æ®µåè­¦éé»\n\næå¶ï¼inhibitionï¼ï¼å½åè­¦ååºåï¼åæ­¢éå¤åéç±æ­¤åè­¦å¼åçå¶ä»åè­¦ï¼å³åå¹¶ç±ä¸ä¸ªæéå¼èµ·çå¤ä¸ªåè­¦äºä»¶ï¼å¯ä»¥æ¶é¤åä½åè­¦\n\n * å®è£alertmanager\n\n# ä¸è½½\nwget https://github.com/prometheus/alertmanager/releases/download/v0.23.0/alertmanager-0.23.0.linux-amd64.tar.gz\n# è§£å\ntar xvf alertmanager-0.23.0.linux-amd64.tar.gz\n# åå»ºè½¯é¾æ¥\nln -sv /apps/alertmanager-0.23.0.linux-amd64 /apps/alertmanager\n\n\n1\n2\n3\n4\n5\n6\n\n * åå»ºalertmanager.serviceæä»¶\n\ncat > /etc/systemd/system/alertmanager.service <<eof\n[unit]\ndescription=prometheus alertmanager\nafter=network.target\n\n[service]\nexecstart=/apps/alertmanager/alertmamager --config.file="/apps/alertmanager/alertmanager.yml"\n\n[install]\nwantedby=multi-user.target\neof\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n * å¯å¨alertmanager\n\nsystemctl start alertmanager.service\n\n\n1\n\n\n> é»è®¤çå¬ç«¯å£9093ï¼9094\n\nçæ§éç½®å®æ¹ç½åï¼https://prometheus.io/docs/alerting/latest/configuration/\n\n * éªè¯alertmanagerç¶æ\n\n1647481599806.png\n\n\n# 3.2 é®ä»¶\n\nå®æ¹ç½åï¼https://prometheus.io/docs/alerting/latest/configuration/#email_config\n\n * éç½®æä»¶ä»ç»\n\nalertmanager.ymléç½®æä»¶\n\nglobal:\n  resolve_timeout: 5m # alertmanagerå¨æç»­å¤ä¹æ²¡ææ¶å°æ°åè­¦åæ è®°ä¸ºresolved\n  smtp_from:  # åä»¶äººé®ç®±å°å\n  smtp_smarthost:  # é®ç®±smtpå°å\n  smtp_auth_username:  # åä»¶äººçç»éç¨æ·åï¼é»è®¤ååä»¶äººå°åä¸è´\n  smtp_auth_password:  # åä»¶äººçç»éå¯ç ï¼ææ¶åæ¯ææç \n  smtp_hello:\n  smtp_require_tls:  # æ¯å¦éè¦tlsåè®®ãé»è®¤æ¯true\n\nroute:\n  group_by: [alertname] # éè¿alertnameçå¼å¯¹åè­¦è¿è¡åç±»\n  group_wait: 10s # ä¸ç»åè­¦ç¬¬ä¸æ¬¡åéä¹åç­å¾çæ¶å»¶ï¼å³äº§çåè­¦10så°ç»åæ°äº§ççæ¶æ¯åå¹¶åéï¼éå¸¸æ¯0s~å åéï¼é»è®¤æ¯30sï¼\n  group_interval: 2m # ä¸ç»å·²åéè¿åå§åè­¦éç¥çåè­¦ï¼æ¥æ¶å°æ°åè­¦åï¼ä¸æ¬¡åééç¥åç­å¾æ¶å»¶ï¼éå¸¸æ¯5mææ´ä¹ï¼é»è®¤æ¯5mï¼\n  repeat_interval: 5m # ä¸ç»å·²ç»åéè¿éç¥çåè­¦ï¼éå¤åéåè­¦çé´éï¼éå¸¸è®¾ç½®ä¸º3hæèæ´ä¹ï¼é»è®¤æ¯4hï¼\n  receiver: \'default-receiver\' # è®¾ç½®åè­¦æ¥æ¶äºº\n\nreceivers:\n- name: \'default-receiver\'\n  email_configs:\n  - to: \'email@domain.com\'\n    send_resolved: true # åéæ¢å¤åè­¦éç¥\n\ninhibit_rules: # æå¶è§å\n  - source_match:  # æºå¹éçº§å«ï¼å½å¹éæåååºéç¥ï¼å¶ä»çº§å«äº§çåè­¦å°è¢«æå¶\n      severity: \'critical\' # åè­¦æ¶é´çº§å«ï¼åè­¦çº§å«æ ¹æ®è§åèªå®ä¹ï¼\n    target_match: \n      severity: \'warning\' # å¹éç®æ æååï¼æ°äº§ççç®æ åè­¦ä¸º\'warning\'å°è¢«æå¶\n    equal: [\'alertname\',\'dev\',\'instance\'] # åºäºè¿äºæ ç­¾æå¶å¹éåè­¦ççº§å«\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n\n\n> # æ¶é´ç¤ºä¾è§£æ\n> # group_wait: 10s # ç¬¬ä¸æ¬¡äº§çåè­¦ï¼ç­å¾10sï¼ç»åææ°å¢åè­¦ï¼ä¸èµ·ååºï¼æ²¡æååç¬ååº\n> # group_interval: 2m # ç¬¬äºæ¬¡äº§çåè­¦ï¼åç­å¾2mï¼2måæ²¡ææ¢å¤å°±è¿å¥repeat_interval\n> # repeat_interval: 5m # å¨ç¬¬äºæ¬¡åè­¦æ¶å»¶è¿åï¼åç­å¾5mï¼5måæ²¡ææ¢å¤ï¼å°±åéç¬¬äºæ¬¡åè­¦\n> \n> \n> 1\n> 2\n> 3\n> 4\n> \n> \n> å¦ä¸éç½®ï¼å¦æåè­¦æ²¡ææ¢å¤ï¼ç¬¬äºæ¬¡åè­¦ä¼ç­å¾2m+5mï¼å³7åéåååº\n\n * éç½®åè­¦è§å\n\ngroups:\n  - name: alertmanager_pod.rules\n    rules:\n    - alert: pod_all_cpu_usage\n      expr: (sum by(name)(rate(container_cpu_usage_seconds_total{image!=""}[5m]))*100) > 1\n      for: 2m\n      labels:\n        serverity: critical\n        service: pods\n      annotations:\n        description: å®¹å¨ {{ $labels.name }} cpu èµæºå©ç¨çå¤§äº 10% , (current value is {{ $value }})\n        summary: dev cpu è´è½½åè­¦\n\n    - alert: pod_all_memory_usage\n      expr: sort_desc(avg by(name)(irate(node_memory_memfree_bytes {name!=""}[5m]))) > 2147483648 # åå­å¤§äº2g\n      for: 2m\n      labels:\n        severity: critical\n      annotations:\n        description: å®¹å¨ {{ $labels.name }} memory èµæºå©ç¨å¤§äº 2g , (current value is {{ $value }})\n        summary: dev memory è´è½½åè­¦\n\n    - alert: pod_all_network_receive_usage\n      expr: sum by(name)(irate(container_network_reveive_bytes_total{container_name="pod"}[1m])) > 52428800 # å¤§äº50m\n      for: 2m\n      labels:\n        severity: critical\n      annotations:\n        description: å®¹å¨ {{ $labels.name }} network_receive èµæºå©ç¨å¤§äº 50m , (current value is {{ $value }})\n\n    - alert: nodeåå­å¯ç¨å¤§å°\n      expr: node_memory_memfree_bytes < 4294967296 # åå­å°äº4g\n      for: 2m\n      labels:\n        severity: critical\n      annotations:\n        description: nodeå¯ç¨åå­å°äº4g\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n\n\n> å¨/apps/prometheus/ç®å½ä¸åå»ºrulesç®å½ï¼åå»ºpods_rule.yamlæä»¶ï¼åå®¹å¦ä¸\n> \n> æ³¨æç¼©è¿æ ¼å¼ï¼å¦ææä»¶æ ¼å¼æè¯¯ï¼éå¯prometheusçæ¶åï¼promethuesä¼ä¸ç´èµ·ä¸æ¥ï¼å¯ä»¥åç¨promtoolæ£æ¥éç½®æä»¶æ ¼å¼ï¼å ä¸ºå è½½åè­¦éç½®çæ¶åï¼å¼å¥äºè¿ä¸ªæä»¶ï¼æä»¥å¨æ£æ¥promethues.ymlæä»¶çæ¶åä¹ä¼æ£æ¥èªå®ä¹çpods_rule.yamlæä»¶\n\n * promethueså è½½åè­¦éç½®\n\n# alertmanager configuration\nalerting:\n  alertmanagers:\n    - static_configs:\n        - targets:\n          - ip:9093\n\n# load rules once and periodically evaluate them according to the global \'evaluation_interval\'.\nrule_files:\n  - "/apps/prometheus/rules/pods_rule.yaml"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\n> æ³¨ï¼å¦æä¿®æ¹rule_filesä¸­çåå®¹ï¼éè¦åéå¯prometheusï¼å è½½ä¿®æ¹åçéç½®ï¼ç¶åä¿®æ¹alertmanagerï¼ä¸ç¶ä¿®æ¹åçåè­¦åå®¹ä¸ä¼çæ\n\n * éå¯prometheus\n\nsystemctl restart prometheus.service\n\n\n1\n\n * éªè¯prometheusç¶æ\n\n> å¨prometheusé¡µé¢ï¼ç¹å»alertsæ¥çåè­¦ç¶æï¼å½åä¸ºpendingï¼è¯´æå·²ç»æ£æµå°åè­¦ï¼è¿æ²¡æ»¡è¶³åé®ä»¶çæ¶é´è§å\n\n1647485888388.png\n\n> firingè¯æåè­¦å·²æåï¼æ­¤æ¶åºè¯¥å·²ç»æ¶å°é®ä»¶\n\n * æ¥çalertmanageråè­¦\n\n * æ¥çåè­¦é®ä»¶\n\n1647485953827.png\n\n> ç¹å»sourceé¾æ¥ï¼è·³è½¬çæ¯ä¸»æºåå prometheus-serverçç«¯å£ï¼æ æ³è§£æå°±è·³è½¬ä¸è¿å»\n\n * ä½¿ç¨amtoolæ¥çåè­¦\n\n./amtool alert --alertmanager.url=http://ip:9093\n\n\n1\n\n\n1647485846885.png\n\n\n# 3.3 éé\n\n * ééæ·»å æºå¨äºº\n\nåå»ºæºå¨äººå®æ¹ç½åï¼https://open.dingtalk.com/document/robots/custom-robot-access\n\n * åéæ¶æ¯èæ¬\n\nvim /data/scripts/dingding-keywords.sh\nmessage=$1\n\n/usr/bin/curl -x post \'https://oapi.dingtalk.com/robot/send?access_token=token\'\\\n-h \'content-type: application/json\' \\\n-d \'{"msgtype": "text",\n     "text": {\n        "content": "${message}"\n     }\n    }\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n * æµè¯åéæ¶æ¯\n\n1647506928206.png\n\n> åéçæ¶æ¯åå®¹ä¸­ï¼å¿é¡»åå«èªå®ä¹çå³é®å­ï¼ä¸ç¶åéæ¶æ¯ä¼å¤±è´¥ï¼åéèæ¬åéæ¶æ¯æååï¼ç¾¤éä¼æ¶å°\n\n * é¨ç½²webhook-dingtalk\n\n# ä¸è½½\nwget https://github.com/timonwong/prometheus-webhook-dingtalk/releases/download/v1.4.0/prometheus-webhook-dingtalk-1.4.0.linux-amd64.tar.gz\n# è§£å\ntar xvf prometheus-webhook-dingtalk-1.4.0.linux-amd64.tar.gz\n# åå»ºè½¯é¾æ¥\nln -sv /apps/prometheus-webhook-dingtalk-1.4.0.linux-amd64 prometheus-webhook-dingtalk\n\n\n1\n2\n3\n4\n5\n6\n\n\n> ä¸è½½çwebhook-dingtalkçæ¬æå¥½è·è¿ä¸ªä¿æä¸ç´ï¼æ°çæ¬æäºå°æ¹ä¸å¼å®¹\n\n * å¯å¨webhook-dingtalk\n\ncd /apps/prometheus-webhook-dingtalk\n./prometheus-webhook-dingtalk --web.listen-address="0.0.0.0:8060" --ding.profile="keyword=https://oapi.dingtalk.com/robot/send?access_token=token" \n\n\n1\n2\n\n\n> æå®çå¬ç«¯å£8060\n> \n> keywordå¿é¡»æ¯åå»ºæºå¨äººæ¶çèªå®ä¹å³é®å­ï¼ä¸ç¶åè­¦åå¸åºå»ï¼ä¼æ¥é\n\n * éç½®alertmanager\n\n- name: \'dingding\'\n  webhook_configs:\n  - url: \'http://ip:8060/dingtalk/alertsen/send\'\n    send_resolved: true\n\n\n1\n2\n3\n4\n\n * éå¯alertmanager\n\nsystemctl restart alertmanager.service\n\n\n1\n',charsets:{cjk:!0}},{title:"ä½¿ç¨docker-composeæ­å»ºpromethes+grafanaçæ§ç³»ç»",frontmatter:{title:"ä½¿ç¨docker-composeæ­å»ºpromethes+grafanaçæ§ç³»ç»",date:"2023-01-09T14:26:28.000Z",permalink:"/pages/712f5c/",categories:["ä¸é¢","prometheus"],tags:[null],readingShow:"top",description:"å¦æä½ ä¹åå®è£è¿ dockerï¼è¯·åå æ",meta:[{name:"twitter:title",content:"ä½¿ç¨docker-composeæ­å»ºpromethes+grafanaçæ§ç³»ç»"},{name:"twitter:description",content:"å¦æä½ ä¹åå®è£è¿ dockerï¼è¯·åå æ"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/02.prometheus/02.%E4%BD%BF%E7%94%A8docker-compose%E6%90%AD%E5%BB%BApromethes+grafana%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F.html"},{property:"og:type",content:"article"},{property:"og:title",content:"ä½¿ç¨docker-composeæ­å»ºpromethes+grafanaçæ§ç³»ç»"},{property:"og:description",content:"å¦æä½ ä¹åå®è£è¿ dockerï¼è¯·åå æ"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/02.prometheus/02.%E4%BD%BF%E7%94%A8docker-compose%E6%90%AD%E5%BB%BApromethes+grafana%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-09T14:26:28.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"ä½¿ç¨docker-composeæ­å»ºpromethes+grafanaçæ§ç³»ç»"},{itemprop:"description",content:"å¦æä½ ä¹åå®è£è¿ dockerï¼è¯·åå æ"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/02.prometheus/02.%E4%BD%BF%E7%94%A8docker-compose%E6%90%AD%E5%BB%BApromethes+grafana%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F.html",relativePath:"04.è¿ç»´/12.çæ§/02.prometheus/02.ä½¿ç¨docker-composeæ­å»ºpromethes+grafanaçæ§ç³»ç».md",key:"v-6f6532a7",path:"/pages/712f5c/",headers:[{level:3,title:"å®è£docker",slug:"å®è£docker",normalizedTitle:"å®è£docker",charIndex:2},{level:3,title:"docker-composeå®è£",slug:"docker-composeå®è£",normalizedTitle:"docker-composeå®è£",charIndex:550},{level:3,title:"é¨ç½²prometheusågrafanaãalertmanager",slug:"é¨ç½²prometheusågrafanaãalertmanager",normalizedTitle:"é¨ç½²prometheusågrafanaãalertmanager",charIndex:793}],headersStr:"å®è£docker docker-composeå®è£ é¨ç½²prometheusågrafanaãalertmanager",content:"# å®è£docker\n\nå¦æä½ ä¹åå®è£è¿ dockerï¼è¯·åå æ\n\nsudo yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine\n\nå®è£ä¸äºä¾èµ\n\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\n\n**æ ¹æ®ä½ çåè¡çä¸è½½repoæä»¶:Â **\n\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n\næè½¯ä»¶ä»åºå°åæ¿æ¢ä¸º TUNA:\n\nsudo sed -i 's+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+' /etc/yum.repos.d/docker-ce.repo\n\næåå®è£:\n\nsudo yum makecache fast\n\nsudo yum install docker-ce\n\n\n# docker-composeå®è£\n\nä¸è½½å°å\n\nhttps://github.com/docker/compose/releases/download/v2.15.0/docker-compose-linux-x86_64\n\nç¹å»ä¸è½½ï¼å®æåä¸ä¼ å°æå¡å¨ä¸ï¼ç¶åæ§è¡å¦ä¸å½ä»¤\n\nmv docker-compose-Linux-x86_64 /usr/local/bin/docker-compose chmod +x /usr/local/bin/docker-compose\n\n\n# é¨ç½²prometheusågrafanaãalertmanager\n\næ°å¢prometheuséç½®æä»¶ï¼åå»ºprometheus.yml,åå®¹å¦ä¸\n\n# my global config\nglobal:\n  scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.\n  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.\n  # scrape_timeout is set to the global default (10s).\n\n# Alertmanager configuration\n\nalerting:\n  alertmanagers:\n    - static_configs:\n         - targets: [\"alertmanager:9093\"]\n# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.\nrule_files:\n  - \"rules.yml\"\n  - \"quote.yml\"\n  #- \"rabbitmq.yml\"\n  # - \"second_rules.yml\"\n\n# A scrape configuration containing exactly one endpoint to scrape:\n# Here it's Prometheus itself.\nscrape_configs:\n  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.\n  - job_name: \"prometheus\"\n\n    # metrics_path defaults to '/metrics'\n    # scheme defaults to 'http'.\n\n    static_configs:\n      - targets: [\"localhost:9090\"]\n#  - job_name: 'cadvisor'\n#    static_configs:\n#      - targets: ['10.10.10.235:8088']\n#        labels:\n#          instance: cadvisor\n  - job_name: 'airm-php'\n    static_configs:\n      - targets: ['10.10.10.13:8199']\n        labels:\n          instance: airm-php\n  - job_name: 'airm-c++'\n    static_configs:\n      - targets: ['10.10.10.155:8199']\n        labels:\n          instance: airm-c++\n  - job_name: 'get-front'\n    static_configs:\n      - targets: ['10.10.10.75:8199']\n        labels:\n          instance: get-front\n#  - job_name: 'gg-website'\n#    static_configs:\n#      - targets: ['10.10.10.200:8199']\n#        labels:\n#          instance: gg-website\n  - job_name: 'IDC-BMS'\n    static_configs:\n      - targets: ['10.10.10.16:8199']\n        labels:\n          instance: IDC-BMS\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n\n\næ¥çåå»ºrules.ymlï¼quote.yml\n\ngroups:\n- name: Node_Down\n  rules:\n  - alert: Nodeå®ä¾å®æº\n    expr: up == 0\n    for: 3m\n    labels:\n      severity: critical\n      level: 1\n    annotations:\n      summary: \"{{ $labels.instance }} æå¡å®æº\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been Down.\"\n- name: airm_RabbitMQ_queue_messages\n  interval: 5m\n  rules:\n  - alert: airm_RabbitMQ\n    expr: rabbitmq_queue_messages_unacked{job=\"airm_RabbitMQ\"} >=1\n    for: 3m\n    labels:\n      severity: critical\n      level: 1\n    annotations:\n      summary: \"{{ $labels.instance }} is problem\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n- name: gf_RabbitMQ_queue_messages\n  interval: 5m\n  rules:\n  - alert: gf_RabbitMQ_queue_messages\n    expr: rabbitmq_queue_messages_unacked{job=\"gf_RabbitMQ\"} !=0\n    for: 10s\n    labels:\n      severity: critical\n      level: 1\n    annotations:\n      summary: \"{{ $labels.instance }} is problem\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n- name: gf_RabbitMQ_published\n  interval: 5m\n  rules:\n  - alert: gf_RabbitMQ_published\n    expr: irate(rabbitmq_channel_messages_published_total{instance=\"gf_RabbitMQ\", job=\"gf_RabbitMQ\"}[2m]) ==0\n    for: 3m\n    labels:\n      severity: critical\n      level: 1\n    annotations:\n      summary: \"{{ $labels.instance }} is problem\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n\n- name: RabbitMQ_Down\n  rules:\n  - alert: Rabbitmq-down\n    expr: rabbitmq_up{job='airm_RabbitMQ'} !=1\n    labels:\n      status: critical\n      team: Rabbitmq_monitor\n      level: 1\n    annotations:\n      description: \"Instance: {{ $labels.instance }} is Down ! ! !\"\n      value: '{{ $value }}'\n      summary:  \"The host node is down\"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n\n\ngroups:\n#- name: gf-md\n#  interval: 10m # æ¥è¯¢é´é\n#  rules:\n#  - alert: gf_md\n#    expr: irate(source_server_receive_tick_counter{instance=\"gf-md_hq\"}[2m]) ==0\n#    for: 10m # æ¥è¯¢æ¶é´é´é\n#    labels:\n#      severity: critical\n#      level: 2\n#    annotations:\n#      summary: \"{{ $labels.instance }} is problem\"\n#      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n- name: airm-nano\n  interval: 5m # æ¥è¯¢é´é\n  rules:\n  - alert: airm_nano\n    expr: irate(source_server_receive_tick_counter{instance=\"airm-nano_hq\", job=\"airm-nano_hq\", source=\"nano_source\"}[2m]) ==0\n    for: 5m # æ¥è¯¢æ¶é´é´é\n    labels:\n      severity: critical\n      level: 2\n    annotations:\n      summary: \"{{ $labels.instance }} is problem\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n- name: gf-md_hq_qianhai\n  interval: 5m # æ¥è¯¢é´é\n  rules:\n  - alert: gf-md_hq_qianhai\n    expr: irate(source_server_receive_tick_counter{instance=\"gf-md_hq_qianhai\"}[2m]) ==0\n    for: 5m\n    labels:\n      severity: critical\n      level: 2\n    annotations:\n      summary: \"{{ $labels.instance }} is problem\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n- name: airm-fortex\n  rules:\n  - alert: airm_fortex\n    expr: irate(source_server_receive_tick_counter{instance=\"airm-fortex_hq\"}[2m]) ==0\n    for: 3m\n    labels:\n      severity: critical\n      level: 2\n    annotations:\n      summary: \"{{ $labels.instance }} is problem\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n\n\nåå»ºalertmanager.ymlæä»¶\n\nglobal:\n  #æ¯ä¸åéæ£æ¥ä¸æ¬¡æ¯å¦æ¢å¤\n  resolve_timeout: 5m\nroute:\n  #è®¾ç½®é»è®¤æ¥æ¶äºº\n  receiver: 'webhook'\n  #ç»åè­¦ç­å¾æ¶é´ãä¹å°±æ¯åè­¦äº§çåç­å¾10sï¼å¦ææåç»åè­¦ä¸èµ·ååº\n  group_wait: 10s\n  #ä¸¤ç»åè­¦çé´éæ¶é´\n  group_interval: 30m\n  #éå¤åè­¦çé´éæ¶é´ï¼åå°ç¸åå¾®ä¿¡åè­¦çåéé¢ç\n  repeat_interval: 2h\n  #repeat_interval: 60s\n  #éç¨åªä¸ªæ ç­¾æ¥ä½ä¸ºåç»ä¾æ®\n  group_by: ['alertname','severity','channel','env']\n  routes:\n  - receiver: webhook\n    match_re:\n      severity: critical|warning\n    continue: true\n  - receiver: webhook1\n    match:\n      severity: critical\n    continue: true\n  - receiver: prometheusalert-phone    #ç­ä¿¡åè­¦\n    match_re:    #æ­£åå¹é\n      level: 1|2\nreceivers:\n- name: 'webhook'\n  webhook_configs:\n#  - url: http://10.10.10.250:8060/dingtalk/ops_dingding/send \n  - url: http://10.10.10.250:8060/dingtalk/webhook/send \n    #è­¦æ¥è¢«è§£å³ä¹åæ¯å¦éç¥\n    send_resolved: true\n- name: 'webhook1'\n  webhook_configs:\n#  - url: http://10.10.10.250:8060/dingtalk/ops_dingding/send \n  - url: http://10.10.10.250:8060/dingtalk/webhook1/send\n    #è­¦æ¥è¢«è§£å³ä¹åæ¯å¦éç¥\n    send_resolved: true\n- name: 'prometheusalert-phone'\n  webhook_configs:\n  - url: 'http://10.10.10.250:8081/prometheusalert?type=alydx&tpl=ali-phone&phone=xxx'\n  #- url: 'http://10.10.10.250:8081/prometheusalert?type=alydx&tpl=ali-phone&phone=xxx'\n    send_resolved: true\n#inhibit_rules:\n##  - source_match:  # å½æ­¤åè­¦åçï¼å¶ä»çåè­¦è¢«æå¶\n##      severity: 'critical'   \n##    target_match:   # è¢«æå¶çå¯¹è±¡\n##      severity: 'High'  \n##    equal: ['id', 'instance']\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n\n\ndocker-composeæä»¶\n\nversion: '2'\nservices:\n  # æ·»å  æ®ç½ç±³ä¿®æ¯æå¡\n  prometheus:\n    # Docker Hub éå\n    image: prom/prometheus:latest\n    # å®¹å¨åç§°\n    container_name: prometheus\n    # å®¹å¨åé¨ hostname\n    hostname: prometheus\n    # å®¹å¨æ¯æèªå¯å¨\n    restart: always\n    # å®¹å¨ä¸å®¿ä¸»æº ç«¯å£æ å°\n    ports:\n      - '9090:9090'\n    # å°å®¿ä¸»æºä¸­çconfigæä»¶å¤¹ï¼æè½½å°å®¹å¨ä¸­/configæä»¶å¤¹\n    volumes:\n      - './prometheus/config:/config'\n      - '/data/prometheus/data/prometheus:/prometheus/data'\n      - '/etc/localtime:/etc/localtime'\n    # æå®å®¹å¨ä¸­çéç½®æä»¶\n    command:\n      - '--config.file=/config/prometheus.yml'\n      # æ¯æç­æ´æ°\n      - '--web.enable-lifecycle'\n    networks:\n      - monitor\n\n  # æ·»å åè­¦æ¨¡å\n  alertmanager:\n    image: prom/alertmanager:latest\n    container_name: alertmanager\n    hostname: alertmanager\n    restart: always\n    ports:\n      - '9093:9093'\n    volumes:\n      - './prometheus/config:/config'\n      - '/data/prometheus/data/alertmanager:/alertmanager/data'\n      - '/etc/localtime:/etc/localtime'\n    command:\n      - '--config.file=/config/alertmanager.yml'\n    networks:\n      - monitor\n\n  # æ·»å çæ§å¯è§åé¢æ¿\n  grafana:\n    image: grafana/grafana:latest\n    container_name: grafana\n    hostname: grafana\n    restart: always\n    ports:\n      - '3000:3000'\n    volumes:\n      # éç½®grafana é®ä»¶æå¡å¨\n      - './grafana/config/grafana.ini:/etc/grafana/grafana.ini'\n      - '/data/grafana/data/grafana:/var/lib/grafana'\n      - '/etc/localtime:/etc/localtime'\n      - './grafana/config/ldap.toml:/etc/grafana/ldap.toml'\n    networks:\n      - monitor\nnetworks:\n  monitor:\n    driver: bridge\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n\n\nå¯å¨docker-compose\n\ndocker-compose up -d",normalizedContent:"# å®è£docker\n\nå¦æä½ ä¹åå®è£è¿ dockerï¼è¯·åå æ\n\nsudo yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine\n\nå®è£ä¸äºä¾èµ\n\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\n\n**æ ¹æ®ä½ çåè¡çä¸è½½repoæä»¶:Â **\n\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n\næè½¯ä»¶ä»åºå°åæ¿æ¢ä¸º tuna:\n\nsudo sed -i 's+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+' /etc/yum.repos.d/docker-ce.repo\n\næåå®è£:\n\nsudo yum makecache fast\n\nsudo yum install docker-ce\n\n\n# docker-composeå®è£\n\nä¸è½½å°å\n\nhttps://github.com/docker/compose/releases/download/v2.15.0/docker-compose-linux-x86_64\n\nç¹å»ä¸è½½ï¼å®æåä¸ä¼ å°æå¡å¨ä¸ï¼ç¶åæ§è¡å¦ä¸å½ä»¤\n\nmv docker-compose-linux-x86_64 /usr/local/bin/docker-compose chmod +x /usr/local/bin/docker-compose\n\n\n# é¨ç½²prometheusågrafanaãalertmanager\n\næ°å¢prometheuséç½®æä»¶ï¼åå»ºprometheus.yml,åå®¹å¦ä¸\n\n# my global config\nglobal:\n  scrape_interval: 15s # set the scrape interval to every 15 seconds. default is every 1 minute.\n  evaluation_interval: 15s # evaluate rules every 15 seconds. the default is every 1 minute.\n  # scrape_timeout is set to the global default (10s).\n\n# alertmanager configuration\n\nalerting:\n  alertmanagers:\n    - static_configs:\n         - targets: [\"alertmanager:9093\"]\n# load rules once and periodically evaluate them according to the global 'evaluation_interval'.\nrule_files:\n  - \"rules.yml\"\n  - \"quote.yml\"\n  #- \"rabbitmq.yml\"\n  # - \"second_rules.yml\"\n\n# a scrape configuration containing exactly one endpoint to scrape:\n# here it's prometheus itself.\nscrape_configs:\n  # the job name is added as a label `job=<job_name>` to any timeseries scraped from this config.\n  - job_name: \"prometheus\"\n\n    # metrics_path defaults to '/metrics'\n    # scheme defaults to 'http'.\n\n    static_configs:\n      - targets: [\"localhost:9090\"]\n#  - job_name: 'cadvisor'\n#    static_configs:\n#      - targets: ['10.10.10.235:8088']\n#        labels:\n#          instance: cadvisor\n  - job_name: 'airm-php'\n    static_configs:\n      - targets: ['10.10.10.13:8199']\n        labels:\n          instance: airm-php\n  - job_name: 'airm-c++'\n    static_configs:\n      - targets: ['10.10.10.155:8199']\n        labels:\n          instance: airm-c++\n  - job_name: 'get-front'\n    static_configs:\n      - targets: ['10.10.10.75:8199']\n        labels:\n          instance: get-front\n#  - job_name: 'gg-website'\n#    static_configs:\n#      - targets: ['10.10.10.200:8199']\n#        labels:\n#          instance: gg-website\n  - job_name: 'idc-bms'\n    static_configs:\n      - targets: ['10.10.10.16:8199']\n        labels:\n          instance: idc-bms\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n\n\næ¥çåå»ºrules.ymlï¼quote.yml\n\ngroups:\n- name: node_down\n  rules:\n  - alert: nodeå®ä¾å®æº\n    expr: up == 0\n    for: 3m\n    labels:\n      severity: critical\n      level: 1\n    annotations:\n      summary: \"{{ $labels.instance }} æå¡å®æº\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been down.\"\n- name: airm_rabbitmq_queue_messages\n  interval: 5m\n  rules:\n  - alert: airm_rabbitmq\n    expr: rabbitmq_queue_messages_unacked{job=\"airm_rabbitmq\"} >=1\n    for: 3m\n    labels:\n      severity: critical\n      level: 1\n    annotations:\n      summary: \"{{ $labels.instance }} is problem\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n- name: gf_rabbitmq_queue_messages\n  interval: 5m\n  rules:\n  - alert: gf_rabbitmq_queue_messages\n    expr: rabbitmq_queue_messages_unacked{job=\"gf_rabbitmq\"} !=0\n    for: 10s\n    labels:\n      severity: critical\n      level: 1\n    annotations:\n      summary: \"{{ $labels.instance }} is problem\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n- name: gf_rabbitmq_published\n  interval: 5m\n  rules:\n  - alert: gf_rabbitmq_published\n    expr: irate(rabbitmq_channel_messages_published_total{instance=\"gf_rabbitmq\", job=\"gf_rabbitmq\"}[2m]) ==0\n    for: 3m\n    labels:\n      severity: critical\n      level: 1\n    annotations:\n      summary: \"{{ $labels.instance }} is problem\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n\n- name: rabbitmq_down\n  rules:\n  - alert: rabbitmq-down\n    expr: rabbitmq_up{job='airm_rabbitmq'} !=1\n    labels:\n      status: critical\n      team: rabbitmq_monitor\n      level: 1\n    annotations:\n      description: \"instance: {{ $labels.instance }} is down ! ! !\"\n      value: '{{ $value }}'\n      summary:  \"the host node is down\"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n\n\ngroups:\n#- name: gf-md\n#  interval: 10m # æ¥è¯¢é´é\n#  rules:\n#  - alert: gf_md\n#    expr: irate(source_server_receive_tick_counter{instance=\"gf-md_hq\"}[2m]) ==0\n#    for: 10m # æ¥è¯¢æ¶é´é´é\n#    labels:\n#      severity: critical\n#      level: 2\n#    annotations:\n#      summary: \"{{ $labels.instance }} is problem\"\n#      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n- name: airm-nano\n  interval: 5m # æ¥è¯¢é´é\n  rules:\n  - alert: airm_nano\n    expr: irate(source_server_receive_tick_counter{instance=\"airm-nano_hq\", job=\"airm-nano_hq\", source=\"nano_source\"}[2m]) ==0\n    for: 5m # æ¥è¯¢æ¶é´é´é\n    labels:\n      severity: critical\n      level: 2\n    annotations:\n      summary: \"{{ $labels.instance }} is problem\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n- name: gf-md_hq_qianhai\n  interval: 5m # æ¥è¯¢é´é\n  rules:\n  - alert: gf-md_hq_qianhai\n    expr: irate(source_server_receive_tick_counter{instance=\"gf-md_hq_qianhai\"}[2m]) ==0\n    for: 5m\n    labels:\n      severity: critical\n      level: 2\n    annotations:\n      summary: \"{{ $labels.instance }} is problem\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n- name: airm-fortex\n  rules:\n  - alert: airm_fortex\n    expr: irate(source_server_receive_tick_counter{instance=\"airm-fortex_hq\"}[2m]) ==0\n    for: 3m\n    labels:\n      severity: critical\n      level: 2\n    annotations:\n      summary: \"{{ $labels.instance }} is problem\"\n      description: \"{{ $labels.instance }} of job {{ $labels.job }} has been problem.\"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n\n\nåå»ºalertmanager.ymlæä»¶\n\nglobal:\n  #æ¯ä¸åéæ£æ¥ä¸æ¬¡æ¯å¦æ¢å¤\n  resolve_timeout: 5m\nroute:\n  #è®¾ç½®é»è®¤æ¥æ¶äºº\n  receiver: 'webhook'\n  #ç»åè­¦ç­å¾æ¶é´ãä¹å°±æ¯åè­¦äº§çåç­å¾10sï¼å¦ææåç»åè­¦ä¸èµ·ååº\n  group_wait: 10s\n  #ä¸¤ç»åè­¦çé´éæ¶é´\n  group_interval: 30m\n  #éå¤åè­¦çé´éæ¶é´ï¼åå°ç¸åå¾®ä¿¡åè­¦çåéé¢ç\n  repeat_interval: 2h\n  #repeat_interval: 60s\n  #éç¨åªä¸ªæ ç­¾æ¥ä½ä¸ºåç»ä¾æ®\n  group_by: ['alertname','severity','channel','env']\n  routes:\n  - receiver: webhook\n    match_re:\n      severity: critical|warning\n    continue: true\n  - receiver: webhook1\n    match:\n      severity: critical\n    continue: true\n  - receiver: prometheusalert-phone    #ç­ä¿¡åè­¦\n    match_re:    #æ­£åå¹é\n      level: 1|2\nreceivers:\n- name: 'webhook'\n  webhook_configs:\n#  - url: http://10.10.10.250:8060/dingtalk/ops_dingding/send \n  - url: http://10.10.10.250:8060/dingtalk/webhook/send \n    #è­¦æ¥è¢«è§£å³ä¹åæ¯å¦éç¥\n    send_resolved: true\n- name: 'webhook1'\n  webhook_configs:\n#  - url: http://10.10.10.250:8060/dingtalk/ops_dingding/send \n  - url: http://10.10.10.250:8060/dingtalk/webhook1/send\n    #è­¦æ¥è¢«è§£å³ä¹åæ¯å¦éç¥\n    send_resolved: true\n- name: 'prometheusalert-phone'\n  webhook_configs:\n  - url: 'http://10.10.10.250:8081/prometheusalert?type=alydx&tpl=ali-phone&phone=xxx'\n  #- url: 'http://10.10.10.250:8081/prometheusalert?type=alydx&tpl=ali-phone&phone=xxx'\n    send_resolved: true\n#inhibit_rules:\n##  - source_match:  # å½æ­¤åè­¦åçï¼å¶ä»çåè­¦è¢«æå¶\n##      severity: 'critical'   \n##    target_match:   # è¢«æå¶çå¯¹è±¡\n##      severity: 'high'  \n##    equal: ['id', 'instance']\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n\n\ndocker-composeæä»¶\n\nversion: '2'\nservices:\n  # æ·»å  æ®ç½ç±³ä¿®æ¯æå¡\n  prometheus:\n    # docker hub éå\n    image: prom/prometheus:latest\n    # å®¹å¨åç§°\n    container_name: prometheus\n    # å®¹å¨åé¨ hostname\n    hostname: prometheus\n    # å®¹å¨æ¯æèªå¯å¨\n    restart: always\n    # å®¹å¨ä¸å®¿ä¸»æº ç«¯å£æ å°\n    ports:\n      - '9090:9090'\n    # å°å®¿ä¸»æºä¸­çconfigæä»¶å¤¹ï¼æè½½å°å®¹å¨ä¸­/configæä»¶å¤¹\n    volumes:\n      - './prometheus/config:/config'\n      - '/data/prometheus/data/prometheus:/prometheus/data'\n      - '/etc/localtime:/etc/localtime'\n    # æå®å®¹å¨ä¸­çéç½®æä»¶\n    command:\n      - '--config.file=/config/prometheus.yml'\n      # æ¯æç­æ´æ°\n      - '--web.enable-lifecycle'\n    networks:\n      - monitor\n\n  # æ·»å åè­¦æ¨¡å\n  alertmanager:\n    image: prom/alertmanager:latest\n    container_name: alertmanager\n    hostname: alertmanager\n    restart: always\n    ports:\n      - '9093:9093'\n    volumes:\n      - './prometheus/config:/config'\n      - '/data/prometheus/data/alertmanager:/alertmanager/data'\n      - '/etc/localtime:/etc/localtime'\n    command:\n      - '--config.file=/config/alertmanager.yml'\n    networks:\n      - monitor\n\n  # æ·»å çæ§å¯è§åé¢æ¿\n  grafana:\n    image: grafana/grafana:latest\n    container_name: grafana\n    hostname: grafana\n    restart: always\n    ports:\n      - '3000:3000'\n    volumes:\n      # éç½®grafana é®ä»¶æå¡å¨\n      - './grafana/config/grafana.ini:/etc/grafana/grafana.ini'\n      - '/data/grafana/data/grafana:/var/lib/grafana'\n      - '/etc/localtime:/etc/localtime'\n      - './grafana/config/ldap.toml:/etc/grafana/ldap.toml'\n    networks:\n      - monitor\nnetworks:\n  monitor:\n    driver: bridge\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n\n\nå¯å¨docker-compose\n\ndocker-compose up -d",charsets:{cjk:!0}},{title:"prometheusæ·»å ééæ¶æ¯åè­¦",frontmatter:{title:"prometheusæ·»å ééæ¶æ¯åè­¦",date:"2023-01-10T17:38:03.000Z",permalink:"/pages/22b836/",categories:["ä¸é¢","prometheus"],tags:[null],readingShow:"top",description:"cd /opt/apps/dingding/prometheus-webhook-dingtalk",meta:[{name:"image",content:"https://oss-test-v1.1quant.com/monitor/logo.png"},{name:"twitter:title",content:"prometheusæ·»å ééæ¶æ¯åè­¦"},{name:"twitter:description",content:"cd /opt/apps/dingding/prometheus-webhook-dingtalk"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://oss-test-v1.1quant.com/monitor/logo.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/02.prometheus/03.prometheus%E6%B7%BB%E5%8A%A0%E9%92%89%E9%92%89%E6%B6%88%E6%81%AF%E5%91%8A%E8%AD%A6.html"},{property:"og:type",content:"article"},{property:"og:title",content:"prometheusæ·»å ééæ¶æ¯åè­¦"},{property:"og:description",content:"cd /opt/apps/dingding/prometheus-webhook-dingtalk"},{property:"og:image",content:"https://oss-test-v1.1quant.com/monitor/logo.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/02.prometheus/03.prometheus%E6%B7%BB%E5%8A%A0%E9%92%89%E9%92%89%E6%B6%88%E6%81%AF%E5%91%8A%E8%AD%A6.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-10T17:38:03.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"prometheusæ·»å ééæ¶æ¯åè­¦"},{itemprop:"description",content:"cd /opt/apps/dingding/prometheus-webhook-dingtalk"},{itemprop:"image",content:"https://oss-test-v1.1quant.com/monitor/logo.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/02.prometheus/03.prometheus%E6%B7%BB%E5%8A%A0%E9%92%89%E9%92%89%E6%B6%88%E6%81%AF%E5%91%8A%E8%AD%A6.html",relativePath:"04.è¿ç»´/12.çæ§/02.prometheus/03.prometheusæ·»å ééæ¶æ¯åè­¦.md",key:"v-003c987e",path:"/pages/22b836/",headers:[{level:4,title:"å®è£prometheus-webhook-dingtalkæä»¶",slug:"å®è£prometheus-webhook-dingtalkæä»¶",normalizedTitle:"å®è£prometheus-webhook-dingtalkæä»¶",charIndex:2},{level:4,title:"åå»ºå¯å¨æå¡æä»¶",slug:"åå»ºå¯å¨æå¡æä»¶",normalizedTitle:"åå»ºå¯å¨æå¡æä»¶",charIndex:433}],headersStr:"å®è£prometheus-webhook-dingtalkæä»¶ åå»ºå¯å¨æå¡æä»¶",content:'# å®è£prometheus-webhook-dingtalkæä»¶\n\n#ä¸è½½\nwget https://github.com/timonwong/prometheus-webhook-dingtalk/releases/download/v1.4.0/prometheus-webhook-dingtalk-1.4.0.linux-amd64.tar.gz\n#è§£å\ntar -zxf prometheus-webhook-dingtalk-1.4.0.linux-amd64.tar.gz\n# ç§»å¨å°å®è£ç®å½\nmv prometheus-webhook-dingtalk-1.4.0.linux-amd64 /opt/apps/dingding/prometheus-webhook-dingtalk\n# è¿å¥ç®å½\ncd /opt/apps/dingding/prometheus-webhook-dingtalk\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# åå»ºå¯å¨æå¡æä»¶\n\n#prometheus-webhook-dingtalk.service\n[Unit]\nDescription=prometheus-webhook-dingtalk\nAfter=network-online.target\n\n[Service]\nRestart=on-failure\nExecStart=/opt/apps/dingding/prometheus-webhook-dingtalk/prometheus-webhook-dingtalk --config.file=/opt/apps/dingding/prometheus-webhook-dingtalk/config.yml\n\n[Install]\nWantedBy=default.target\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå°prometheus-webhook-dingtalk.serviceæä»¶ç§»å¨å°/usr/lib/systemd/systemä¸\n\n\n#çæç³»ç»æä»¶\nsystemctl daemon-reload\n# å¯å¨\nsystemctl start prometheus-webhook-dingtalk.service\n# åæ­¢\nsystemctl stop prometheus-webhook-dingtalk.service \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\néç½®æä»¶config.yml\n\n## Request timeout\n# timeout: 5s\n\n## Customizable templates path\ntemplates:\n  - /opt/apps/dingding/prometheus-webhook-dingtalk/contrib/templates/default.tmpl\n\n## You can also override default template using `default_message`\n## The following example to use the \'legacy\' template from v0.3.0\n# default_message:\n#   title: \'{{ template "legacy.title" . }}\'\n#   text: \'{{ template "legacy.content" . }}\'\n\n## Targets, previously was known as "profiles"\ntargets:\n  webhook:\n    url: https://oapi.dingtalk.com/robot/send?access_token=xxx\n    message:\n      title: \'{{ template "default.title" . }}\'\n      text: \'{{ template "default.content" . }}\'\n  webhook1:\n    url: https://oapi.dingtalk.com/robot/send?access_token=xxx\n    message:\n      title: \'{{ template "default.title" . }}\'\n      text: \'{{ template "default.content" . }}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\nåè­¦æ¨¡æ¿default.tmpl\n\n{{ define "__subject" }}\n[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}]\n{{ end }}\n\n{{ define "__alert_list" }}{{ range . }}\n---\n**åè­¦åç§°**: {{ index .Annotations "summary" }}\n\n**åè­¦çº§å«**: {{ .Labels.severity }}\n\n**åè­¦ä¸»æº**: {{ .Labels.instance }}\n\n**åè­¦ä¿¡æ¯**: {{ index .Annotations "description" }}\n\n**ç»´æ¤å¢é**: {{ .Labels.team | upper }}\n\n**åè­¦æ¶é´**: {{ dateInZone "2006.01.02 15:04:05" (.StartsAt) "Asia/Shanghai" }}\n\n{{ end }}{{ end }}\n\n{{ define "__resolved_list" }}{{ range . }}\n---\n**åè­¦åç§°**: {{ index .Annotations "summary" }}\n\n**åè­¦çº§å«**: {{ .Labels.severity }}\n\n**åè­¦ä¸»æº**: {{ .Labels.instance }}\n\n**åè­¦ä¿¡æ¯**: {{ index .Annotations "description" }}\n\n**ç»´æ¤å¢é**: {{ .Labels.team | upper }}\n\n**åè­¦æ¶é´**: {{ dateInZone "2006.01.02 15:04:05" (.StartsAt) "Asia/Shanghai" }}\n\n**æ¢å¤æ¶é´**: {{ dateInZone "2006.01.02 15:04:05" (.EndsAt) "Asia/Shanghai" }}\n\n{{ end }}{{ end }}\n\n\n{{ define "default.title" }}\n{{ template "__subject" . }}\n{{ end }}\n\n{{ define "default.content" }}\n![è­¦æ¥ å¾æ ](https://oss-test-v1.1quant.com/monitor/logo.png)\n\n{{ if gt (len .Alerts.Firing) 0 }}\n\n**====ä¾¦æµå°{{ .Alerts.Firing | len  }}ä¸ªæé====**\n{{ template "__alert_list" .Alerts.Firing }}\n---\n{{ end }}\n\n{{ if gt (len .Alerts.Resolved) 0 }}\n**====æ¢å¤{{ .Alerts.Resolved | len  }}ä¸ªæé====**\n{{ template "__resolved_list" .Alerts.Resolved }}\n{{ end }}\n{{ end }}\n\n\n{{ define "ding.link.title" }}{{ template "default.title" . }}{{ end }}\n{{ define "ding.link.content" }}{{ template "default.content" . }}{{ end }}\n{{ template "default.title" . }}\n{{ template "default.content" . }}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n',normalizedContent:'# å®è£prometheus-webhook-dingtalkæä»¶\n\n#ä¸è½½\nwget https://github.com/timonwong/prometheus-webhook-dingtalk/releases/download/v1.4.0/prometheus-webhook-dingtalk-1.4.0.linux-amd64.tar.gz\n#è§£å\ntar -zxf prometheus-webhook-dingtalk-1.4.0.linux-amd64.tar.gz\n# ç§»å¨å°å®è£ç®å½\nmv prometheus-webhook-dingtalk-1.4.0.linux-amd64 /opt/apps/dingding/prometheus-webhook-dingtalk\n# è¿å¥ç®å½\ncd /opt/apps/dingding/prometheus-webhook-dingtalk\n\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n# åå»ºå¯å¨æå¡æä»¶\n\n#prometheus-webhook-dingtalk.service\n[unit]\ndescription=prometheus-webhook-dingtalk\nafter=network-online.target\n\n[service]\nrestart=on-failure\nexecstart=/opt/apps/dingding/prometheus-webhook-dingtalk/prometheus-webhook-dingtalk --config.file=/opt/apps/dingding/prometheus-webhook-dingtalk/config.yml\n\n[install]\nwantedby=default.target\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n\n\nå°prometheus-webhook-dingtalk.serviceæä»¶ç§»å¨å°/usr/lib/systemd/systemä¸\n\n\n#çæç³»ç»æä»¶\nsystemctl daemon-reload\n# å¯å¨\nsystemctl start prometheus-webhook-dingtalk.service\n# åæ­¢\nsystemctl stop prometheus-webhook-dingtalk.service \n\n\n1\n2\n3\n4\n5\n6\n7\n\n\néç½®æä»¶config.yml\n\n## request timeout\n# timeout: 5s\n\n## customizable templates path\ntemplates:\n  - /opt/apps/dingding/prometheus-webhook-dingtalk/contrib/templates/default.tmpl\n\n## you can also override default template using `default_message`\n## the following example to use the \'legacy\' template from v0.3.0\n# default_message:\n#   title: \'{{ template "legacy.title" . }}\'\n#   text: \'{{ template "legacy.content" . }}\'\n\n## targets, previously was known as "profiles"\ntargets:\n  webhook:\n    url: https://oapi.dingtalk.com/robot/send?access_token=xxx\n    message:\n      title: \'{{ template "default.title" . }}\'\n      text: \'{{ template "default.content" . }}\'\n  webhook1:\n    url: https://oapi.dingtalk.com/robot/send?access_token=xxx\n    message:\n      title: \'{{ template "default.title" . }}\'\n      text: \'{{ template "default.content" . }}\'\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n\n\nåè­¦æ¨¡æ¿default.tmpl\n\n{{ define "__subject" }}\n[{{ .status | toupper }}{{ if eq .status "firing" }}:{{ .alerts.firing | len }}{{ end }}]\n{{ end }}\n\n{{ define "__alert_list" }}{{ range . }}\n---\n**åè­¦åç§°**: {{ index .annotations "summary" }}\n\n**åè­¦çº§å«**: {{ .labels.severity }}\n\n**åè­¦ä¸»æº**: {{ .labels.instance }}\n\n**åè­¦ä¿¡æ¯**: {{ index .annotations "description" }}\n\n**ç»´æ¤å¢é**: {{ .labels.team | upper }}\n\n**åè­¦æ¶é´**: {{ dateinzone "2006.01.02 15:04:05" (.startsat) "asia/shanghai" }}\n\n{{ end }}{{ end }}\n\n{{ define "__resolved_list" }}{{ range . }}\n---\n**åè­¦åç§°**: {{ index .annotations "summary" }}\n\n**åè­¦çº§å«**: {{ .labels.severity }}\n\n**åè­¦ä¸»æº**: {{ .labels.instance }}\n\n**åè­¦ä¿¡æ¯**: {{ index .annotations "description" }}\n\n**ç»´æ¤å¢é**: {{ .labels.team | upper }}\n\n**åè­¦æ¶é´**: {{ dateinzone "2006.01.02 15:04:05" (.startsat) "asia/shanghai" }}\n\n**æ¢å¤æ¶é´**: {{ dateinzone "2006.01.02 15:04:05" (.endsat) "asia/shanghai" }}\n\n{{ end }}{{ end }}\n\n\n{{ define "default.title" }}\n{{ template "__subject" . }}\n{{ end }}\n\n{{ define "default.content" }}\n![è­¦æ¥ å¾æ ](https://oss-test-v1.1quant.com/monitor/logo.png)\n\n{{ if gt (len .alerts.firing) 0 }}\n\n**====ä¾¦æµå°{{ .alerts.firing | len  }}ä¸ªæé====**\n{{ template "__alert_list" .alerts.firing }}\n---\n{{ end }}\n\n{{ if gt (len .alerts.resolved) 0 }}\n**====æ¢å¤{{ .alerts.resolved | len  }}ä¸ªæé====**\n{{ template "__resolved_list" .alerts.resolved }}\n{{ end }}\n{{ end }}\n\n\n{{ define "ding.link.title" }}{{ template "default.title" . }}{{ end }}\n{{ define "ding.link.content" }}{{ template "default.content" . }}{{ end }}\n{{ template "default.title" . }}\n{{ template "default.content" . }}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n34\n35\n36\n37\n38\n39\n40\n41\n42\n43\n44\n45\n46\n47\n48\n49\n50\n51\n52\n53\n54\n55\n56\n57\n58\n59\n60\n61\n62\n63\n64\n',charsets:{cjk:!0}},{title:"å½æ¡£",frontmatter:{archivesPage:!0,title:"å½æ¡£",permalink:"/archives/",article:!1,readingShow:"top",description:"",meta:[{name:"twitter:title",content:"å½æ¡£"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/@pages/archivesPage.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å½æ¡£"},{property:"og:description",content:""},{property:"og:url",content:"https://blog.zzppjj.top/@pages/archivesPage.html"},{property:"og:site_name",content:"zpj"},{itemprop:"name",content:"å½æ¡£"},{itemprop:"description",content:""}]},regularPath:"/@pages/archivesPage.html",relativePath:"@pages/archivesPage.md",key:"v-403d9ae8",path:"/archives/",headersStr:null,content:"",normalizedContent:"",charsets:{}},{title:"alertmanagerå®ç°æä¸ªæ¶é´æ®µéé»æäºåè­¦é¡¹",frontmatter:{title:"alertmanagerå®ç°æä¸ªæ¶é´æ®µéé»æäºåè­¦é¡¹",date:"2023-01-11T11:40:32.000Z",permalink:"/pages/96c6ce/",categories:["ä¸é¢","prometheus"],tags:[null],readingShow:"top",description:"éæ±ï¼æéè¦æ¯å¤©å±è½æä¸ªæ¶é´æ®µçæäºåè­¦é¡¹",meta:[{name:"image",content:"https://img2022.cnblogs.com/blog/1302413/202203/1302413-20220317170106813-275993103.png"},{name:"twitter:title",content:"alertmanagerå®ç°æä¸ªæ¶é´æ®µéé»æäºåè­¦é¡¹"},{name:"twitter:description",content:"éæ±ï¼æéè¦æ¯å¤©å±è½æä¸ªæ¶é´æ®µçæäºåè­¦é¡¹"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:"https://img2022.cnblogs.com/blog/1302413/202203/1302413-20220317170106813-275993103.png"},{name:"twitter:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/02.prometheus/04.alertmanager%E5%AE%9E%E7%8E%B0%E6%9F%90%E4%B8%AA%E6%97%B6%E9%97%B4%E6%AE%B5%E9%9D%99%E9%BB%98%E6%9F%90%E4%BA%9B%E5%91%8A%E8%AD%A6%E9%A1%B9.html"},{property:"og:type",content:"article"},{property:"og:title",content:"alertmanagerå®ç°æä¸ªæ¶é´æ®µéé»æäºåè­¦é¡¹"},{property:"og:description",content:"éæ±ï¼æéè¦æ¯å¤©å±è½æä¸ªæ¶é´æ®µçæäºåè­¦é¡¹"},{property:"og:image",content:"https://img2022.cnblogs.com/blog/1302413/202203/1302413-20220317170106813-275993103.png"},{property:"og:url",content:"https://blog.zzppjj.top/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/02.prometheus/04.alertmanager%E5%AE%9E%E7%8E%B0%E6%9F%90%E4%B8%AA%E6%97%B6%E9%97%B4%E6%AE%B5%E9%9D%99%E9%BB%98%E6%9F%90%E4%BA%9B%E5%91%8A%E8%AD%A6%E9%A1%B9.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2023-01-11T11:40:32.000Z"},{property:"article:tag",content:null},{itemprop:"name",content:"alertmanagerå®ç°æä¸ªæ¶é´æ®µéé»æäºåè­¦é¡¹"},{itemprop:"description",content:"éæ±ï¼æéè¦æ¯å¤©å±è½æä¸ªæ¶é´æ®µçæäºåè­¦é¡¹"},{itemprop:"image",content:"https://img2022.cnblogs.com/blog/1302413/202203/1302413-20220317170106813-275993103.png"}]},regularPath:"/04.%E8%BF%90%E7%BB%B4/12.%E7%9B%91%E6%8E%A7/02.prometheus/04.alertmanager%E5%AE%9E%E7%8E%B0%E6%9F%90%E4%B8%AA%E6%97%B6%E9%97%B4%E6%AE%B5%E9%9D%99%E9%BB%98%E6%9F%90%E4%BA%9B%E5%91%8A%E8%AD%A6%E9%A1%B9.html",relativePath:"04.è¿ç»´/12.çæ§/02.prometheus/04.alertmanagerå®ç°æä¸ªæ¶é´æ®µéé»æäºåè­¦é¡¹.md",key:"v-75545c56",path:"/pages/96c6ce/",headers:[{level:2,title:"ã0ãè§£å³æè·¯åæ",slug:"ã0ãè§£å³æè·¯åæ",normalizedTitle:"ã0ãè§£å³æè·¯åæ",charIndex:2},{level:2,title:"ã1ãAPI",slug:"ã1ãapi",normalizedTitle:"ã1ãapi",charIndex:165},{level:3,title:"API Version",slug:"api-version",normalizedTitle:"api version",charIndex:215},{level:3,title:"POST /api/v2/alerts",slug:"post-api-v2-alerts",normalizedTitle:"post /api/v2/alerts",charIndex:2326},{level:3,title:"GET /api/v2/alerts",slug:"get-api-v2-alerts",normalizedTitle:"get /api/v2/alerts",charIndex:2703},{level:3,title:"GET /api/v2/alerts/groups",slug:"get-api-v2-alerts-groups",normalizedTitle:"get /api/v2/alerts/groups",charIndex:3650},{level:2,title:"ã2ãAPIä½¿ç¨å®è·µ",slug:"ã2ãapiä½¿ç¨å®è·µ",normalizedTitle:"ã2ãapiä½¿ç¨å®è·µ",charIndex:4289},{level:3,title:"ï¼2.1ï¼åºæ¬æ¡ä¾",slug:"_2-1-åºæ¬æ¡ä¾",normalizedTitle:"ï¼2.1ï¼åºæ¬æ¡ä¾",charIndex:4342},{level:2,title:"ã3ãæä½³å®è·µï¼å®æ¶éé»ï¼",slug:"ã3ãæä½³å®è·µ-å®æ¶éé»",normalizedTitle:"ã3ãæä½³å®è·µï¼å®æ¶éé»ï¼",charIndex:5073},{level:3,title:"ï¼3.1ï¼ç«é©¬æé åºæéçåè­¦ä¿¡æ¯",slug:"_3-1-ç«é©¬æé åºæéçåè­¦ä¿¡æ¯",normalizedTitle:"ï¼3.1ï¼ç«é©¬æé åºæéçåè­¦ä¿¡æ¯",charIndex:5115},{level:3,title:"ï¼3.2ï¼æå»ºå¥½éé»ï¼è·åéé»è¯­å¥",slug:"_3-2-æå»ºå¥½éé»-è·åéé»è¯­å¥",normalizedTitle:"ï¼3.2ï¼æå»ºå¥½éé»ï¼è·åéé»è¯­å¥",charIndex:5143},{level:3,title:"ï¼3.3ï¼ä½¿ç¨çæéé»è§å",slug:"_3-3-ä½¿ç¨çæéé»è§å",normalizedTitle:"ï¼3.3ï¼ä½¿ç¨çæéé»è§å",charIndex:6135},{level:3,title:"ï¼3.4ï¼èªå¨åèæ¬",slug:"_3-4-èªå¨åèæ¬",normalizedTitle:"ï¼3.4ï¼èªå¨åèæ¬",charIndex:7214}],headersStr:"ã0ãè§£å³æè·¯åæ ã1ãAPI API Version POST /api/v2/alerts GET /api/v2/alerts GET /api/v2/alerts/groups ã2ãAPIä½¿ç¨å®è·µ ï¼2.1ï¼åºæ¬æ¡ä¾ ã3ãæä½³å®è·µï¼å®æ¶éé»ï¼ ï¼3.1ï¼ç«é©¬æé åºæéçåè­¦ä¿¡æ¯ ï¼3.2ï¼æå»ºå¥½éé»ï¼è·åéé»è¯­å¥ ï¼3.3ï¼ä½¿ç¨çæéé»è§å ï¼3.4ï¼èªå¨åèæ¬",content:'# ã0ãè§£å³æè·¯åæ\n\néæ±ï¼æéè¦æ¯å¤©å±è½æä¸ªæ¶é´æ®µçæäºåè­¦é¡¹\n\næ¯å¦ï¼åæ¨4ç¹ä¼å¼å°å¤ä»½ï¼å¯¼è´æµéæ¥è­¦ï¼ææ³å±è½æ¯å¤©4ç¹-4ç¹30åçè¯¥åè­¦é¡¹\n\næè·¯ï¼\n\nç´æ¥æä½æ¯æ²¡æè¿ä¸ªæ­¥éª¤çï¼æ²çº¿æå½å§ï¼\n\nï¼1ï¼å®æ¶ä»»å¡ï¼æ¯å¤©åæ¨åç¹ç silences\n\nï¼2ï¼å®æ¶ä»»å¡ä¸­ä½¿ç¨ alertmanager api æ¥å»ºè®¾\n\n\n# ã1ãAPI\n\nå®ç½ï¼AlertManagerçAPI Â· prometheus Â· çäº\n\n\n# API Version\n\nAlertManageræä¸¤å¥APIï¼v1ä¸v2ï¼ä¸è¿ä¸¤å¥APIçåé¨é»è¾åºæ¬æ¯ä¸è´çï¼è°ç¨åªå¥é½æ²¡æå³ç³»ãv1æ²¡æç¸å³çææ¡£ï¼ä¸è¿æä»¬å¯ä»¥æ¾å°v2çç¸å³ææ¡£ã\nAPI-v2çswaggeræä»¶çé¾æ¥ä¸ºï¼\n\nalertmanager/openapi.yaml at main Â· prometheus/alertmanager Â· GitHub\n\næè¿ä¸ªæä»¶çåå®¹æ·è´å°Â https://editor.swagger.ioÂ éé¢ï¼ä¾¿å¯ä»¥æ¥çAPIãä¸é¢ç½åäºv2çæ¬çææAPIï¼\n\n# Alert\nGET    /api/v2/alerts\nPOST   /api/v2/alerts\n\n# AlertGroup\nGET    /api/v2/alerts/groups  \n\n# General\nGET    /api/v2/status\n\n# Receiver\nGET    /api/v2/receivers\n\n# Silence\nGET    /api/v2/silences\nPOST   /api/v2/silences\nGET    /api/v2/silence/{silenceID}\nDELETE /api/v2/silence/{silenceID}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nå¶ä¸­æéè¦çæ¯Alertä¸AlertGroupçé£ä¸ä¸ªAPIï¼æ¥ä¸æ¥æä»¬è¯¦ç»å°è®²è§£ä¸ä¸\n\nä½¿ç¨å¶ä¸­æä¾çurlï¼http://127.0.0.1:9090/api/v1/alertsÂ ï¼å¯ä»¥è·åå°æ¥è­¦çjsonä¿¡æ¯ï¼å³å¯è·å¾jsonçæ ¼å¼\n\n[{"annotations":\n{"description":\n"localhost:9100 of job exporter has been down for more than 5 minutes.",\n"summary":"Instance localhost:9100 down"},\n"endsAt":"2021-11-25T08:13:56.026Z",\n"fingerprint":"d44e90ffc89b2ea1",\n"receivers":[{"name":"mail"}],\n"startsAt":"2021-11-25T07:36:11.026Z",\n"status":{"inhibitedBy":[],"silencedBy":[],"state":"active"},\n"updatedAt":"2021-11-25T16:09:56.030+08:00",\n"generatorURL":"http://localhost.localdomain:9090/graph?g0.expr=up+%3D%3D+0\\u0026g0.tab=1",\n"labels":{"alertname":"InstanceDown","instance":"localhost:9100","job":"exporter","severity":"page"}\n}]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nç¼åå¥½çjsonæä»¶å¯ä»¥ä½¿ç¨curlè¯­å¥è¿è¡æµè¯\n\ncurl -i -k -H "Content-type: application/json" -X POST -d\n[{"annotations":\n{"description":\n"localhost:9100 of job exporter has been down for more than 5 minutes.",\n"summary":"Instance localhost:9100 down"},\n"endsAt":"2021-11-25T08:13:56.026Z",\n"fingerprint":"d44e90ffc89b2ea1",\n"receivers":[{"name":"mail"}],\n"startsAt":"2021-11-25T07:36:11.026Z",\n"status":{"inhibitedBy":[],"silencedBy":[],"state":"active"},\n"updatedAt":"2021-11-25T16:09:56.030+08:00",\n"generatorURL":"http://localhost.localdomain:9090/graph?g0.expr=up+%3D%3D+0\\u0026g0.tab=1",\n"labels":{"alertname":"InstanceDown","instance":"localhost:9100","job":"exporter","severity":"page"}\n}]\n"http://192.168.217.22:9093/api/v1/alerts"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# POST /api/v2/alerts\n\nBodyåæ°ç¤ºä¾å¦ä¸ï¼\n\n[\n  {\n    "labels": {"label": "value", ...},\n    "annotations": {"label": "value", ...},\n    "generatorURL": "string",\n    "startsAt": "2020-01-01T00:00:00.000+08:00", # optional\n    "endsAt": "2020-01-01T01:00:00.000+08:00" # optional\n  },\n  ...\n]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nBodyåæ°æ¯ä¸ä¸ªæ°ç»ï¼éé¢æ¯ä¸ä¸ªä¸ªçåè­¦ãå¶ä¸­startsAtä¸endsAtæ¯å¯éåæ°ï¼ä¸æ ¼å¼å¿é¡»æ¯ä¸é¢çé£ç§ï¼ä¸è½æ¯æ¶é´æ³ã\n\n\n# GET /api/v2/alerts\n\nQueryåæ°å¦ä¸ï¼ä»¥ä¸åæ°ç¨æ¥è¿æ»¤åè­¦\n\nåæ°å           ç±»å              é»è®¤å¼    æ¯å¦å¿é¡»       å¶ä»è¯´æ\nactive        bool            true   optional   -\nsilenced      bool            true   optional   -\ninhibited     bool            true   optional   -\nunprocessed   bool            true   optional   -\nfilter        array[string]   æ       optional   -\nreceiver      string          æ       optional   -\n\nå¶è¿åå¼å¦ä¸ï¼\n\n[\n  {\n    "labels": {"label": "value", ...},\n    "annotations": {"label": "value", ...},\n    "generatorURL": "string",\n    "startsAt": "2020-01-01T00:00:00.000+08:00", \n    "endsAt": "2020-01-01T01:00:00.000+08:00",\n    "updatedAt": "2020-01-01T01:00:00.000+08:00",\n    "fingerprint": "string"\n    "receivers": [{"name": "string"}, ...],\n    "status": {\n      "state": "active", # active, unprocessed, ...\n      "silencedBy": ["string", ...],\n      "inhibitedBy": ["string", ...]\n  },\n  ...\n]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# GET /api/v2/alerts/groups\n\nQueryåæ°å¦ä¸ï¼ä»¥ä¸åæ°ç¨æ¥è¿æ»¤åè­¦\n\nåæ°å           ç±»å              é»è®¤å¼    æ¯å¦å¿é¡»       å¶ä»è¯´æ\nactive        bool            true   optional   -\nsilenced      bool            true   optional   -\ninhibited     bool            true   optional   -\nunprocessed   bool            true   optional   -\nfilter        array[string]   æ       optional   -\nreceiver      string          æ       optional   -\n\nå¶è¿åå¼å¦ä¸ï¼\n\n[\n  { \n    "labels": {"label": "value", ...},\n    "receiver": {"name": "string"},  # æ³¨æä¸alertçreceiversçåºå«\n    "alerts": [alert1, alert2, ...]  # alertçJsonç»æä¸ `GET /api/v2/alerts` è¿åå¼ä¸­çç»æä¸è´\n  },\n  ...\n]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# ã2ãAPIä½¿ç¨å®è·µ\n\nåèï¼å®è·µï¼AlertManager Â· prometheus Â· çäº\n\n\n# ï¼2.1ï¼åºæ¬æ¡ä¾\n\næé æµè¯æ°æ®ï¼\n\n# æé æµè¯æ°æ®\n\naa=\'[\n    {\n        "Labels": {\n            "alertname": "NodeCpuPressure",\n            "IP": "192.168.2.101"\n        },\n        "Annotations": {\n            "summary": "NodeCpuPressure, IP: 192.168.2.101, Value: 90%, Threshold: 85%"\n        },\n        "StartsAt": "2020-02-17T23:00:00.000+08:00", \n        "EndsAt": "2023-02-18T23:00:00.000+08:00"\n    }\n]\'\n\n# æ§è¡ POST\ncurl http://127.0.0.1:9093/api/v2/alerts -XPOST -H\'Content-Type: application/json\' -d"$aa"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nå¦ææ¯ä½¿ç¨V1çæ¬ï¼å¯ä»¥ä¸ç¨å Â Â -H\'Content-Type: application/json\'\n\n\n\næä¹åæ¶æï¼æç»ææ¶é´ä¿®æ¹ä¸ä¸å°±å¥½äºï¼\n\næä»¬å¯ä»¥éè¿Â Â curl -X GET localhost:9093/api/v2/alertsÂ Â è·å\n\n\n\nç¶åä¿®æ¹å¶æ¶é´\n\n\n\nç¶åæä»¬å¨ä¸è¿°çæä½åï¼\n\næ´»è·ä¸æ²¡è¢«éé»ç Alert\n\n\n\næä½åï¼\n\n\n\nåå°é¡¶é¨\n\n\n# ã3ãæä½³å®è·µï¼å®æ¶éé»ï¼\n\næ³¨æï¼éé»æ¡ç®æçæãæ¾ç¤ºçæ¶é´æ¯UTCæ¶é´\n\n\n# ï¼3.1ï¼ç«é©¬æé åºæéçåè­¦ä¿¡æ¯\n\n\n\n\n\n\n\n\n# ï¼3.2ï¼æå»ºå¥½éé»ï¼è·åéé»è¯­å¥\n\n\n\n\n\næç»ç»æï¼\n\n\n\ncurl \'127.0.0.1:9093/api/v2/silences\' \\\n  -H \'Connection: keep-alive\' \\\n  -H \'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36\' \\\n  -H \'Content-Type: application/json\' \\\n  -H \'Accept: */*\' \\\n  -H \'Origin: http://127.0.0.1:9093\' \\\n  -H \'Referer: http://127.0.0.1:9093/\' \\\n  -H \'Accept-Language: zh-CN,zh;q=0.9\' \\\n  -H \'Cookie: grafana_session=a504e4a78501efe7009fa8b7587d5fb4\' \\\n  --data-raw \'{"matchers":[{"name":"alertname","value":"ç£çè¯»ååè¿é«","isRegex":false},{"name":"instance","value":"127.0.0.1:9182","isRegex":false},{"name":"job","value":"æµè¯_win","isRegex":false},{"name":"name","value":"æµè¯æ°æ®åºé¸­[47.103.57.124]","isRegex":false},{"name":"severity","value":"warning","isRegex":false}],"startsAt":"2022-03-17T07:44:45.446Z","endsAt":"2022-03-17T09:44:45.446Z","createdBy":"guochaoqun","comment":"tmp","id":null}\' \\\n  --compressed \\\n  --insecure\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# ï¼3.3ï¼ä½¿ç¨çæéé»è§å\n\nV1æ¹å¼\n\ncurl -X POST http://127.0.0.1:9093/api/v1/silences -d\'{"matchers":[{"name":"alertname","value":"ç£çè¯»å åè¿é«","isRegex":false},{"name":"instance","value":"47.103.57.124:9182","isRegex":false},{"name":"job","value":"test","isRegex":false},{"name":"name","value":"teståº[47.103.57.124]","isRegex":false},{"name":"severity","value":"warning","isRegex":false}],"startsAt":"2022-03-17T07:44:45.446Z","endsAt":"2022-03-17T09:44:45.446Z","createdBy":"guochaoqun","comment":"tmp","id":null}\' \n\n\n1\n\n\nV2 æ¹å¼ï¼å°±å¿é¡»è¦å  -H\n\ncurl \'127.0.0.1:9093/api/v2/silences\' \\-H \'Content-Type: application/json\' \\\n  --data \'{"matchers":[{"name":"alertname","value":"ç£çè¯»ååè¿é«","isRegex":false},{"name":"instance","value":"127.0.0.1:9182","isRegex":false},{"name":"job","value":"æµè¯_win","isRegex":false},{"name":"name","value":"æµè¯åº[47.103.57.124]","isRegex":false},{"name":"severity","value":"warning","isRegex":false}],"startsAt":"2022-03-17T07:44:45.446Z","endsAt":"2022-03-17T09:44:45.446Z","createdBy":"guochaoqun","comment":"tmp","id":null}\' \\\n  --compressed \\\n  --insecure\n\n\n1\n2\n3\n4\n\n\n\n\n\n# ï¼3.4ï¼èªå¨åèæ¬\n\nnow_date=`date +%F --date="-1 day"`\ncurl \'http://127.0.0.1:9093/api/v2/silences\' \\\n-H \'Content-Type: application/json\' \\\n--data \'{"matchers":[{"name":"alertname","value":"ç£çè¯»ååè¿é«","isRegex":false},{"name":"instance","value":"47.103.57.124:9182","isRegex":false},{"name":"job","value":"éæ¸¸ä¸ç_win","isRegex":false},{"name":"name","value":"8833ä¸»åº_è¯¦ç»å¯¹å±[47.103.57.124]","isRegex":false},{"name":"severity","value":"warning","isRegex":false}],"startsAt":"\'${now_date}\'T20:10:45.446Z","endsAt":"\'${now_date}\'T20:40:45.446Z","createdBy":"guochaoqun","comment":"tmp","id":null}\' \\\n--compressed --insecure\n\n\n1\n2\n3\n4\n5\n\n\nåæé¾æ¥ï¼\n\nhttps://www.cnblogs.com/gered/p/15946822.html',normalizedContent:'# ã0ãè§£å³æè·¯åæ\n\néæ±ï¼æéè¦æ¯å¤©å±è½æä¸ªæ¶é´æ®µçæäºåè­¦é¡¹\n\næ¯å¦ï¼åæ¨4ç¹ä¼å¼å°å¤ä»½ï¼å¯¼è´æµéæ¥è­¦ï¼ææ³å±è½æ¯å¤©4ç¹-4ç¹30åçè¯¥åè­¦é¡¹\n\næè·¯ï¼\n\nç´æ¥æä½æ¯æ²¡æè¿ä¸ªæ­¥éª¤çï¼æ²çº¿æå½å§ï¼\n\nï¼1ï¼å®æ¶ä»»å¡ï¼æ¯å¤©åæ¨åç¹ç silences\n\nï¼2ï¼å®æ¶ä»»å¡ä¸­ä½¿ç¨ alertmanager api æ¥å»ºè®¾\n\n\n# ã1ãapi\n\nå®ç½ï¼alertmanagerçapi Â· prometheus Â· çäº\n\n\n# api version\n\nalertmanageræä¸¤å¥apiï¼v1ä¸v2ï¼ä¸è¿ä¸¤å¥apiçåé¨é»è¾åºæ¬æ¯ä¸è´çï¼è°ç¨åªå¥é½æ²¡æå³ç³»ãv1æ²¡æç¸å³çææ¡£ï¼ä¸è¿æä»¬å¯ä»¥æ¾å°v2çç¸å³ææ¡£ã\napi-v2çswaggeræä»¶çé¾æ¥ä¸ºï¼\n\nalertmanager/openapi.yaml at main Â· prometheus/alertmanager Â· github\n\næè¿ä¸ªæä»¶çåå®¹æ·è´å°Â https://editor.swagger.ioÂ éé¢ï¼ä¾¿å¯ä»¥æ¥çapiãä¸é¢ç½åäºv2çæ¬çææapiï¼\n\n# alert\nget    /api/v2/alerts\npost   /api/v2/alerts\n\n# alertgroup\nget    /api/v2/alerts/groups  \n\n# general\nget    /api/v2/status\n\n# receiver\nget    /api/v2/receivers\n\n# silence\nget    /api/v2/silences\npost   /api/v2/silences\nget    /api/v2/silence/{silenceid}\ndelete /api/v2/silence/{silenceid}\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nå¶ä¸­æéè¦çæ¯alertä¸alertgroupçé£ä¸ä¸ªapiï¼æ¥ä¸æ¥æä»¬è¯¦ç»å°è®²è§£ä¸ä¸\n\nä½¿ç¨å¶ä¸­æä¾çurlï¼http://127.0.0.1:9090/api/v1/alertsÂ ï¼å¯ä»¥è·åå°æ¥è­¦çjsonä¿¡æ¯ï¼å³å¯è·å¾jsonçæ ¼å¼\n\n[{"annotations":\n{"description":\n"localhost:9100 of job exporter has been down for more than 5 minutes.",\n"summary":"instance localhost:9100 down"},\n"endsat":"2021-11-25t08:13:56.026z",\n"fingerprint":"d44e90ffc89b2ea1",\n"receivers":[{"name":"mail"}],\n"startsat":"2021-11-25t07:36:11.026z",\n"status":{"inhibitedby":[],"silencedby":[],"state":"active"},\n"updatedat":"2021-11-25t16:09:56.030+08:00",\n"generatorurl":"http://localhost.localdomain:9090/graph?g0.expr=up+%3d%3d+0\\u0026g0.tab=1",\n"labels":{"alertname":"instancedown","instance":"localhost:9100","job":"exporter","severity":"page"}\n}]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n\n\nç¼åå¥½çjsonæä»¶å¯ä»¥ä½¿ç¨curlè¯­å¥è¿è¡æµè¯\n\ncurl -i -k -h "content-type: application/json" -x post -d\n[{"annotations":\n{"description":\n"localhost:9100 of job exporter has been down for more than 5 minutes.",\n"summary":"instance localhost:9100 down"},\n"endsat":"2021-11-25t08:13:56.026z",\n"fingerprint":"d44e90ffc89b2ea1",\n"receivers":[{"name":"mail"}],\n"startsat":"2021-11-25t07:36:11.026z",\n"status":{"inhibitedby":[],"silencedby":[],"state":"active"},\n"updatedat":"2021-11-25t16:09:56.030+08:00",\n"generatorurl":"http://localhost.localdomain:9090/graph?g0.expr=up+%3d%3d+0\\u0026g0.tab=1",\n"labels":{"alertname":"instancedown","instance":"localhost:9100","job":"exporter","severity":"page"}\n}]\n"http://192.168.217.22:9093/api/v1/alerts"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n\n\n\n# post /api/v2/alerts\n\nbodyåæ°ç¤ºä¾å¦ä¸ï¼\n\n[\n  {\n    "labels": {"label": "value", ...},\n    "annotations": {"label": "value", ...},\n    "generatorurl": "string",\n    "startsat": "2020-01-01t00:00:00.000+08:00", # optional\n    "endsat": "2020-01-01t01:00:00.000+08:00" # optional\n  },\n  ...\n]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n\n\nbodyåæ°æ¯ä¸ä¸ªæ°ç»ï¼éé¢æ¯ä¸ä¸ªä¸ªçåè­¦ãå¶ä¸­startsatä¸endsatæ¯å¯éåæ°ï¼ä¸æ ¼å¼å¿é¡»æ¯ä¸é¢çé£ç§ï¼ä¸è½æ¯æ¶é´æ³ã\n\n\n# get /api/v2/alerts\n\nqueryåæ°å¦ä¸ï¼ä»¥ä¸åæ°ç¨æ¥è¿æ»¤åè­¦\n\nåæ°å           ç±»å              é»è®¤å¼    æ¯å¦å¿é¡»       å¶ä»è¯´æ\nactive        bool            true   optional   -\nsilenced      bool            true   optional   -\ninhibited     bool            true   optional   -\nunprocessed   bool            true   optional   -\nfilter        array[string]   æ       optional   -\nreceiver      string          æ       optional   -\n\nå¶è¿åå¼å¦ä¸ï¼\n\n[\n  {\n    "labels": {"label": "value", ...},\n    "annotations": {"label": "value", ...},\n    "generatorurl": "string",\n    "startsat": "2020-01-01t00:00:00.000+08:00", \n    "endsat": "2020-01-01t01:00:00.000+08:00",\n    "updatedat": "2020-01-01t01:00:00.000+08:00",\n    "fingerprint": "string"\n    "receivers": [{"name": "string"}, ...],\n    "status": {\n      "state": "active", # active, unprocessed, ...\n      "silencedby": ["string", ...],\n      "inhibitedby": ["string", ...]\n  },\n  ...\n]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n\n\n\n# get /api/v2/alerts/groups\n\nqueryåæ°å¦ä¸ï¼ä»¥ä¸åæ°ç¨æ¥è¿æ»¤åè­¦\n\nåæ°å           ç±»å              é»è®¤å¼    æ¯å¦å¿é¡»       å¶ä»è¯´æ\nactive        bool            true   optional   -\nsilenced      bool            true   optional   -\ninhibited     bool            true   optional   -\nunprocessed   bool            true   optional   -\nfilter        array[string]   æ       optional   -\nreceiver      string          æ       optional   -\n\nå¶è¿åå¼å¦ä¸ï¼\n\n[\n  { \n    "labels": {"label": "value", ...},\n    "receiver": {"name": "string"},  # æ³¨æä¸alertçreceiversçåºå«\n    "alerts": [alert1, alert2, ...]  # alertçjsonç»æä¸ `get /api/v2/alerts` è¿åå¼ä¸­çç»æä¸è´\n  },\n  ...\n]\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n\n\n\n# ã2ãapiä½¿ç¨å®è·µ\n\nåèï¼å®è·µï¼alertmanager Â· prometheus Â· çäº\n\n\n# ï¼2.1ï¼åºæ¬æ¡ä¾\n\næé æµè¯æ°æ®ï¼\n\n# æé æµè¯æ°æ®\n\naa=\'[\n    {\n        "labels": {\n            "alertname": "nodecpupressure",\n            "ip": "192.168.2.101"\n        },\n        "annotations": {\n            "summary": "nodecpupressure, ip: 192.168.2.101, value: 90%, threshold: 85%"\n        },\n        "startsat": "2020-02-17t23:00:00.000+08:00", \n        "endsat": "2023-02-18t23:00:00.000+08:00"\n    }\n]\'\n\n# æ§è¡ post\ncurl http://127.0.0.1:9093/api/v2/alerts -xpost -h\'content-type: application/json\' -d"$aa"\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n\n\nå¦ææ¯ä½¿ç¨v1çæ¬ï¼å¯ä»¥ä¸ç¨å Â Â -h\'content-type: application/json\'\n\n\n\næä¹åæ¶æï¼æç»ææ¶é´ä¿®æ¹ä¸ä¸å°±å¥½äºï¼\n\næä»¬å¯ä»¥éè¿Â Â curl -x get localhost:9093/api/v2/alertsÂ Â è·å\n\n\n\nç¶åä¿®æ¹å¶æ¶é´\n\n\n\nç¶åæä»¬å¨ä¸è¿°çæä½åï¼\n\næ´»è·ä¸æ²¡è¢«éé»ç alert\n\n\n\næä½åï¼\n\n\n\nåå°é¡¶é¨\n\n\n# ã3ãæä½³å®è·µï¼å®æ¶éé»ï¼\n\næ³¨æï¼éé»æ¡ç®æçæãæ¾ç¤ºçæ¶é´æ¯utcæ¶é´\n\n\n# ï¼3.1ï¼ç«é©¬æé åºæéçåè­¦ä¿¡æ¯\n\n\n\n\n\n\n\n\n# ï¼3.2ï¼æå»ºå¥½éé»ï¼è·åéé»è¯­å¥\n\n\n\n\n\næç»ç»æï¼\n\n\n\ncurl \'127.0.0.1:9093/api/v2/silences\' \\\n  -h \'connection: keep-alive\' \\\n  -h \'user-agent: mozilla/5.0 (windows nt 10.0; win64; x64) applewebkit/537.36 (khtml, like gecko) chrome/98.0.4758.102 safari/537.36\' \\\n  -h \'content-type: application/json\' \\\n  -h \'accept: */*\' \\\n  -h \'origin: http://127.0.0.1:9093\' \\\n  -h \'referer: http://127.0.0.1:9093/\' \\\n  -h \'accept-language: zh-cn,zh;q=0.9\' \\\n  -h \'cookie: grafana_session=a504e4a78501efe7009fa8b7587d5fb4\' \\\n  --data-raw \'{"matchers":[{"name":"alertname","value":"ç£çè¯»ååè¿é«","isregex":false},{"name":"instance","value":"127.0.0.1:9182","isregex":false},{"name":"job","value":"æµè¯_win","isregex":false},{"name":"name","value":"æµè¯æ°æ®åºé¸­[47.103.57.124]","isregex":false},{"name":"severity","value":"warning","isregex":false}],"startsat":"2022-03-17t07:44:45.446z","endsat":"2022-03-17t09:44:45.446z","createdby":"guochaoqun","comment":"tmp","id":null}\' \\\n  --compressed \\\n  --insecure\n\n\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n\n\n\n# ï¼3.3ï¼ä½¿ç¨çæéé»è§å\n\nv1æ¹å¼\n\ncurl -x post http://127.0.0.1:9093/api/v1/silences -d\'{"matchers":[{"name":"alertname","value":"ç£çè¯»å åè¿é«","isregex":false},{"name":"instance","value":"47.103.57.124:9182","isregex":false},{"name":"job","value":"test","isregex":false},{"name":"name","value":"teståº[47.103.57.124]","isregex":false},{"name":"severity","value":"warning","isregex":false}],"startsat":"2022-03-17t07:44:45.446z","endsat":"2022-03-17t09:44:45.446z","createdby":"guochaoqun","comment":"tmp","id":null}\' \n\n\n1\n\n\nv2 æ¹å¼ï¼å°±å¿é¡»è¦å  -h\n\ncurl \'127.0.0.1:9093/api/v2/silences\' \\-h \'content-type: application/json\' \\\n  --data \'{"matchers":[{"name":"alertname","value":"ç£çè¯»ååè¿é«","isregex":false},{"name":"instance","value":"127.0.0.1:9182","isregex":false},{"name":"job","value":"æµè¯_win","isregex":false},{"name":"name","value":"æµè¯åº[47.103.57.124]","isregex":false},{"name":"severity","value":"warning","isregex":false}],"startsat":"2022-03-17t07:44:45.446z","endsat":"2022-03-17t09:44:45.446z","createdby":"guochaoqun","comment":"tmp","id":null}\' \\\n  --compressed \\\n  --insecure\n\n\n1\n2\n3\n4\n\n\n\n\n\n# ï¼3.4ï¼èªå¨åèæ¬\n\nnow_date=`date +%f --date="-1 day"`\ncurl \'http://127.0.0.1:9093/api/v2/silences\' \\\n-h \'content-type: application/json\' \\\n--data \'{"matchers":[{"name":"alertname","value":"ç£çè¯»ååè¿é«","isregex":false},{"name":"instance","value":"47.103.57.124:9182","isregex":false},{"name":"job","value":"éæ¸¸ä¸ç_win","isregex":false},{"name":"name","value":"8833ä¸»åº_è¯¦ç»å¯¹å±[47.103.57.124]","isregex":false},{"name":"severity","value":"warning","isregex":false}],"startsat":"\'${now_date}\'t20:10:45.446z","endsat":"\'${now_date}\'t20:40:45.446z","createdby":"guochaoqun","comment":"tmp","id":null}\' \\\n--compressed --insecure\n\n\n1\n2\n3\n4\n5\n\n\nåæé¾æ¥ï¼\n\nhttps://www.cnblogs.com/gered/p/15946822.html',charsets:{cjk:!0}},{title:"å³äº",frontmatter:{title:"å³äº",date:"2022-12-15T13:14:01.000Z",permalink:"/about/",sidebar:!0,article:!1,description:"",readingShow:"top",meta:[{name:"twitter:title",content:"å³äº"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/05.%E5%85%B3%E4%BA%8E/01.%E5%85%B3%E4%BA%8E.html"},{property:"og:type",content:"article"},{property:"og:title",content:"å³äº"},{property:"og:description",content:""},{property:"og:url",content:"https://blog.zzppjj.top/05.%E5%85%B3%E4%BA%8E/01.%E5%85%B3%E4%BA%8E.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T13:14:01.000Z"},{itemprop:"name",content:"å³äº"},{itemprop:"description",content:""}]},regularPath:"/05.%E5%85%B3%E4%BA%8E/01.%E5%85%B3%E4%BA%8E.html",relativePath:"05.å³äº/01.å³äº.md",key:"v-17a259f2",path:"/about/",headers:[{level:2,title:"å³äºåä¸»",slug:"å³äºåä¸»",normalizedTitle:"å³äºåä¸»",charIndex:2}],headersStr:"å³äºåä¸»",content:"# å³äºåä¸»\n\n7å¹´è¿ç»´ç»éªçæå·¥äººï¼åäº«åå®¹ï¼åäº«çæ´»",normalizedContent:"# å³äºåä¸»\n\n7å¹´è¿ç»´ç»éªçæå·¥äººï¼åäº«åå®¹ï¼åäº«çæ´»",charsets:{cjk:!0}},{title:"åé¾",frontmatter:{title:"åé¾",date:"2022-12-15T09:17:44.000Z",permalink:"/friends",categories:["åé¾"],tags:["friend"],description:"::: cardList",readingShow:"top",meta:[{name:"twitter:title",content:"åé¾"},{name:"twitter:description",content:"::: cardList"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/06.%E5%8F%8B%E9%93%BE/01.%E5%8F%8B%E9%93%BE.html"},{property:"og:type",content:"article"},{property:"og:title",content:"åé¾"},{property:"og:description",content:"::: cardList"},{property:"og:url",content:"https://blog.zzppjj.top/06.%E5%8F%8B%E9%93%BE/01.%E5%8F%8B%E9%93%BE.html"},{property:"og:site_name",content:"zpj"},{property:"article:published_time",content:"2022-12-15T09:17:44.000Z"},{property:"article:tag",content:"friend"},{itemprop:"name",content:"åé¾"},{itemprop:"description",content:"::: cardList"}]},regularPath:"/06.%E5%8F%8B%E9%93%BE/01.%E5%8F%8B%E9%93%BE.html",relativePath:"06.åé¾/01.åé¾.md",key:"v-50528ad2",path:"/friends/",headers:[{level:2,title:"æçåé¾",slug:"æçåé¾",normalizedTitle:"æçåé¾",charIndex:2},{level:2,title:"åé¾ç³è¯·",slug:"åé¾ç³è¯·",normalizedTitle:"åé¾ç³è¯·",charIndex:181}],headersStr:"æçåé¾ åé¾ç³è¯·",content:"# æçåé¾\n\näºä¸«è®²æ¢µ\n\nð»å­¦ä¹ ðè®°å½ðåäº«\n\n- name: äºä¸«è®²æ¢µ\n  desc: 'ð»å­¦ä¹ ðè®°å½ðåäº«'\n  avatar: https://wiki.eryajf.net/img/logo.png\n  link: https://wiki.eryajf.net\n  bgColor: '#f8f9fa'\n\n\n1\n2\n3\n4\n5\n\n\n\n# åé¾ç³è¯·\n\nä¸æèç³»æè å¨æ¬é¡µé¢è¯è®ºåºçè¨æ¨çåé¾ä¿¡æ¯ï¼æ ¼å¼ï¼(ç¹å»ä»£ç åå³ä¸è§ä¸é®å¤å¶)\n\n- name: ç« å·¥è¿ç»´ # æµç§°\n  desc: å¥½å¥½å­¦ä¹ ï¼å¤©å¤©åä¸\n  avatar: http://pic.zzppjj.top/LightPicture/2023/02/b8f9973008054c97.png # å¤´å\n  link: https://blog.zzppjj.top/  # é¾æ¥\n\n\n1\n2\n3\n4\n\n\nç³è¯·åè®°å¾åæ·»å æ¬ç«å¦~",normalizedContent:"# æçåé¾\n\näºä¸«è®²æ¢µ\n\nð»å­¦ä¹ ðè®°å½ðåäº«\n\n- name: äºä¸«è®²æ¢µ\n  desc: 'ð»å­¦ä¹ ðè®°å½ðåäº«'\n  avatar: https://wiki.eryajf.net/img/logo.png\n  link: https://wiki.eryajf.net\n  bgcolor: '#f8f9fa'\n\n\n1\n2\n3\n4\n5\n\n\n\n# åé¾ç³è¯·\n\nä¸æèç³»æè å¨æ¬é¡µé¢è¯è®ºåºçè¨æ¨çåé¾ä¿¡æ¯ï¼æ ¼å¼ï¼(ç¹å»ä»£ç åå³ä¸è§ä¸é®å¤å¶)\n\n- name: ç« å·¥è¿ç»´ # æµç§°\n  desc: å¥½å¥½å­¦ä¹ ï¼å¤©å¤©åä¸\n  avatar: http://pic.zzppjj.top/lightpicture/2023/02/b8f9973008054c97.png # å¤´å\n  link: https://blog.zzppjj.top/  # é¾æ¥\n\n\n1\n2\n3\n4\n\n\nç³è¯·åè®°å¾åæ·»å æ¬ç«å¦~",charsets:{cjk:!0}},{title:"åç±»",frontmatter:{categoriesPage:!0,title:"åç±»",permalink:"/categories/",article:!1,readingShow:"top",description:"",meta:[{name:"twitter:title",content:"åç±»"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/@pages/categoriesPage.html"},{property:"og:type",content:"article"},{property:"og:title",content:"åç±»"},{property:"og:description",content:""},{property:"og:url",content:"https://blog.zzppjj.top/@pages/categoriesPage.html"},{property:"og:site_name",content:"zpj"},{itemprop:"name",content:"åç±»"},{itemprop:"description",content:""}]},regularPath:"/@pages/categoriesPage.html",relativePath:"@pages/categoriesPage.md",key:"v-65b5a670",path:"/categories/",headersStr:null,content:"",normalizedContent:"",charsets:{}},{title:"æ ç­¾",frontmatter:{tagsPage:!0,title:"æ ç­¾",permalink:"/tags/",article:!1,readingShow:"top",description:"",meta:[{name:"twitter:title",content:"æ ç­¾"},{name:"twitter:description",content:""},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/@pages/tagsPage.html"},{property:"og:type",content:"article"},{property:"og:title",content:"æ ç­¾"},{property:"og:description",content:""},{property:"og:url",content:"https://blog.zzppjj.top/@pages/tagsPage.html"},{property:"og:site_name",content:"zpj"},{itemprop:"name",content:"æ ç­¾"},{itemprop:"description",content:""}]},regularPath:"/@pages/tagsPage.html",relativePath:"@pages/tagsPage.md",key:"v-8923d930",path:"/tags/",headersStr:null,content:"",normalizedContent:"",charsets:{}},{title:"Home",frontmatter:{home:!0,heroText:"ç« å·¥è¿ç»´",tagline:"åªåãæ¼æ",bannerBg:"http://pic.zzppjj.top/LightPicture/2023/02/7c6d3b8425f739ab.jpg",features:[{title:"è¿ç»´",details:"å¥½å¥½å­¦ä¹ ï¼å¤©å¤©åä¸",link:"/ops/"},{title:"çæ´»",details:"è®°å½ãåå¿",link:"/life/"},{title:"ç¼ç¨",details:"åäº«ãè®°å½",link:"/code/"}],readingShow:"top",description:"å¥½å¥½å­¦ä¹ ï¼å¤©å¤©åä¸",meta:[{name:"twitter:title",content:"ç« å·¥è¿ç»´"},{name:"twitter:description",content:"å¥½å¥½å­¦ä¹ ï¼å¤©å¤©åä¸"},{name:"twitter:card",content:"summary"},{name:"twitter:url",content:"https://blog.zzppjj.top/"},{property:"og:type",content:"website"},{property:"og:title",content:"ç« å·¥è¿ç»´"},{property:"og:description",content:"å¥½å¥½å­¦ä¹ ï¼å¤©å¤©åä¸"},{property:"og:url",content:"https://blog.zzppjj.top/"},{property:"og:site_name",content:"zpj"},{itemprop:"name",content:"ç« å·¥è¿ç»´"},{itemprop:"description",content:"å¥½å¥½å­¦ä¹ ï¼å¤©å¤©åä¸"}]},regularPath:"/",relativePath:"README.md",key:"v-7e9c1840",path:"/",headersStr:null,content:"åªåãæ¼æãèªä¿¡\n\n",normalizedContent:"åªåãæ¼æãèªä¿¡\n\n",charsets:{cjk:!0}}],themeConfig:{nav:[{text:"é¦é¡µ",link:"/"},{text:"è¿ç»´",link:"/ops/",items:[{text:"linux",link:"/linux/"},{text:"windows",link:"/windows/"},{text:"ä¸­é´ä»¶",link:"/middleware/"},{text:"çæ§",link:"/monitor/"},{text:"ç½ç»",link:"/network/"},{text:"å­å¨",link:"/storage/"},{text:"å®å¨",link:"/safety/"},{text:"é²ç«å¢",link:"/firewalld/"},{text:"æ°æ®åº",link:"/db/"},{text:"ç³»ç»",link:"/sys/"},{text:"docker",link:"/docker/"},{text:"è¿ç»´å·¥å·",link:"/tool/"},{text:"other",link:"/other/"}]},{text:"ä¸é¢",link:"/topic/",items:[{text:"elk",link:"/elk/"},{text:"k8s",link:"/k8s/"},{text:"ansible",link:"/ansible/"},{text:"Jenkins",link:"/jenkins/"}]},{text:"çæ´»",link:"/life/",items:[{text:"éç¬",link:"/suibi/"},{text:"é¢è¯",link:"/mianshi/"},{text:"å·¥å·",link:"/gongju/"}]},{text:"ç¼ç¨",link:"/code/",items:[{text:"Shell",link:"/shell/"},{text:"python",link:"/python/"}]},{text:"å³äº",link:"/about/"},{text:"åé¾",link:"/friends/"},{text:"ç´¢å¼",link:"/categories/",items:[{text:"åç±»",link:"/categories/"},{text:"æ ç­¾",link:"/tags/"},{text:"å½æ¡£",link:"/archives/"}]},{text:"é¡µé¢",link:"/nav/",items:[{items:[{text:"chatgpt",link:"https://aichat.zzppjj.top"},{text:"å¾åº",link:"https://pic.zzppjj.top"},{text:"è¯è®º",link:"https://artalk.zzppjj.top"}]}]},{text:"å¼å¾",link:"https://www.travellings.cn/go.html"}],sidebarDepth:2,logo:"http://pic.zzppjj.top/LightPicture/2023/02/b8f9973008054c97.png",repo:"zpj874878956",searchMaxSuggestions:10,lastUpdated:"ä¸æ¬¡æ´æ°",editLinks:!1,sidebarHoverTriggerOpen:!0,searchPlaceholder:"æä¸ ðº æç´¢",pageButton:!1,sidebar:{"/00.ç®å½é¡µ/":[["01.ansible.md","ansible","/ansible/"],["02.k8s.md","k8s","/k8s/"],["03.elk.md","elk","/elk/"],["04.jenkins.md","jenkins","/jenkins/"],["05.éç¬.md","éç¬","/suibi/"],["06.é¢è¯.md","é¢è¯","/mianshi/"],["07.å·¥å·.md","å·¥å·","/gongju/"],["08.çæ´».md","çæ´»","/life/"],["09.ç¼ç¨.md","ç¼ç¨","/code/"],["10.python.md","python","/python/"],["11.shell.md","shell","/shell/"],["12.ä¸é¢.md","ä¸é¢","/topic/"],["13.è¿ç»´.md","è¿ç»´","/ops/"],["14.ä¸­é´ä»¶.md","ä¸­é´ä»¶","/middleware/"],["15.linux.md","linux","/linux/"],["16.windows.md","windows","/windows/"],["17.ç½ç».md","ç½ç»","/network/"],["18.å®å¨.md","å®å¨","/safety/"],["19.å­å¨.md","å­å¨","/storage/"],["20.é²ç«å¢.md","é²ç«å¢","/firewalld/"],["21.æ°æ®åº.md","æ°æ®åº","/db/"],["22.ç³»ç».md","ç³»ç»","/sys/"],["23.docker.md","docker","/docker/"],["24.è¿ç»´å·¥å·.md","è¿ç»´å·¥å·","/tool/"],["25.çæ§.md","çæ§","/monitor/"],["26.other.md","other","/other/"]],catalogue:{ansible:"/ansible/",k8s:"/k8s/",elk:"/elk/",jenkins:"/jenkins/","éç¬":"/suibi/","é¢è¯":"/mianshi/","å·¥å·":"/gongju/","çæ´»":"/life/","ç¼ç¨":"/code/",python:"/python/",shell:"/shell/","ä¸é¢":"/topic/","è¿ç»´":"/ops/","ä¸­é´ä»¶":"/middleware/",linux:"/linux/",windows:"/windows/","ç½ç»":"/network/","å®å¨":"/safety/","å­å¨":"/storage/","é²ç«å¢":"/firewalld/","æ°æ®åº":"/db/","ç³»ç»":"/sys/",docker:"/docker/","è¿ç»´å·¥å·":"/tool/","çæ§":"/monitor/",other:"/other/"},"/01.ä¸é¢/":[{title:"ansibleç³»åæç« ",collapsable:!0,children:[["01.ansibleç³»åæç« /01.ansibleå¥é¨.md","ansibleå¥é¨","/pages/12c5da01/"],["01.ansibleç³»åæç« /02.anisbleæ¹éå®è£node_exporter.md","anisbleæ¹éå®è£node_exporter","/pages/f8f66c/"],["01.ansibleç³»åæç« /03.ansible-playbookä¸­çåé.md","ansible-playbookä¸­çåé","/pages/d740bc/"],["01.ansibleç³»åæç« /04.Ansibleæ§è½ä¼åââæåansibleæ§è¡æç.md","Ansibleæ§è½ä¼åââæåansibleæ§è¡æç","/pages/a06506/"],["01.ansibleç³»åæç« /05.ansibleä¹rolesç®åä½¿ç¨.md","ansibleä¹rolesç®åä½¿ç¨","/pages/847542/"],["01.ansibleç³»åæç« /06.ansibleä¸­templateç®åä½¿ç¨.md","ansibleä¸­templateç®åä½¿ç¨","/pages/4189b8/"],["01.ansibleç³»åæç« /07.Ansibleä¸­çplaybook è¯¦è§£.md","playbookè¯¦è§£","/pages/14eda9/"],["01.ansibleç³»åæç« /08.ansible-playbookç¼æä½¿ç¨tips.md","ansible-playbookç¼æä½¿ç¨tips","/pages/7eca6b/"],["01.ansibleç³»åæç« /09.ansibleä¼ç§æ¡ä¾.md","ansibleä¼ç§æ¡ä¾","/pages/4fbba1/"]]},{title:"k8s",collapsable:!0,children:[["02.k8s/01.å¿«éé¨ç½²k8séç¾¤.md","å¿«éé¨ç½²k8séç¾¤","/pages/fc6bfb/"]]},{title:"elk",collapsable:!0,children:[["03.elk/01.elkå®è£.md","elkå®è£","/pages/98c9f5/"],["03.elk/02.docker-composeå®è£elk.md","docker-composeå®è£elk","/pages/bbe108/"],["03.elk/03.filebeat-logç¸å³éç½®æå.md","filebeat-logç¸å³éç½®æå","/pages/ed9e8d/"]]},{title:"jenkins",collapsable:!0,children:[["04.jenkins/01.jenkinså®¹å¨å®è£.md","jenkinså®¹å¨å®è£","/pages/ce2b89/"],["04.jenkins/02.jenkinsæµæ°´çº¿é¨ç½².md","jenkinsæµæ°´çº¿é¨ç½²","/pages/a9ff44/"]]}],"/02.çæ´»/":[{title:"éç¬",collapsable:!0,children:[["01.éç¬/01.ç·äººå¿æºæççä¹å¤§è¡¨ç°.md","ç·äººå¿æºæççä¹å¤§è¡¨ç°","/pages/aa6ada/"],["01.éç¬/02.å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯.md","å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯","/pages/0cd089/"],["01.éç¬/03.è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç.md","è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç","/pages/7b0831/"],["01.éç¬/04.å°è¯´æ´»çæå½.md","å°è¯´æ´»çæå½","/pages/e7e74b/"],["01.éç¬/05.äººçæ ¼è¨.md","äººçæ ¼è¨","/pages/58b3c0/"]]},{title:"é¢è¯",collapsable:!0,children:[["02.é¢è¯/01.è¿ç»´10éåºç¡é¢è¯é¢.md","è¿ç»´10éåºç¡é¢è¯é¢","/pages/f6c9c9/"],["02.é¢è¯/02.httpç¶æç .md","httpç¶æç ","/pages/a2e381/"],["02.é¢è¯/03.é«çº§è¿ç»´å·¥ç¨éè¦ææ¡çæè½.md","é«çº§è¿ç»´å·¥ç¨éè¦ææ¡çæè½","/pages/9245d9/"]]},{title:"å·¥å·",collapsable:!0,children:[{title:"vpn",collapsable:!0,children:[["03.å·¥å·/01.vpn/01.ä¼ä¸çº§openvpnæ­å»º.md","ä¼ä¸çº§openvpnæ­å»º","/pages/45fa3c/"]]},{title:"ç¿»å¢æç¨",collapsable:!0,children:[["03.å·¥å·/02.ç¿»å¢æç¨/01.å®ç°V2Rayéè¿CloudFlareèªéIPå é.md","å®ç°V2Rayéè¿CloudFlareèªéIPå é","/pages/e9bb88/"]]},["03.å·¥å·/03.macçµèå¸¸ç¨è½¯ä»¶.md","macçµèå¸¸ç¨è½¯ä»¶","/pages/4ad301/"],["03.å·¥å·/04.ä¸ªäººå·¥å·é¾æ¥.md","å·¥å·é¾æ¥","/pages/8994e9/"],["03.å·¥å·/05.vuepresséç½®artalk.md","vuepresséç½®artalk","/pages/468f43/"],["03.å·¥å·/06.windowsç®å½å®æ¶åæ­¥å·¥å·.md","windowsç®å½å®æ¶åæ­¥å·¥å·","/pages/112008/"]]}],"/03.ç¼ç¨/":[{title:"python",collapsable:!0,children:[["01.python/01.çæ§ç®å½ææä»¶åå.md","çæ§ç®å½ææä»¶åå","/pages/f8da74/"],["01.python/02.æ¹éæ´æ¹æä»¶.md","æ¹éæ´æ¹æä»¶","/pages/f659cd/"],["01.python/03.pythonå¼ç¨æ°æ®åº.md","pythonå¼ç¨æ°æ®åº","/pages/a109ec/"],["01.python/04.python3ç»é²ç«å¢æ·»å æ¾è¡.md","python3ç»é²ç«å¢æ·»å æ¾è¡","/pages/457fb7/"],["01.python/05.pythonçæé¨ç½²èæ¬.md","pythonçæé¨ç½²èæ¬","/pages/d0fcb5/"],["01.python/06.pythonå°å¤ä¸ªæä»¶åå®¹è¾åºå°ä¸ä¸ªæä»¶ä¸­.md","pythonå°å¤ä¸ªæä»¶åå®¹è¾åºå°ä¸ä¸ªæä»¶ä¸­","/pages/8d0b76/"]]},{title:"shell",collapsable:!0,children:[["02.shell/01.è¿ç¨pidå¤æ­èæ¬.md","è¿ç¨pidå¤æ­èæ¬","/pages/cae02d/"],["02.shell/02.æ¥å¿åå²èæ¬.md","æ¥å¿åå²èæ¬","/pages/3b937e/"],["02.shell/03.è®¾ç½®è·³æ¿æºèæ¬.md","è®¾ç½®è·³æ¿æºèæ¬","/pages/69b699/"],["02.shell/04.ç¼åå¯å¨ãåæ­¢ãéå¯çèæ¬.md","ç¼åå¯å¨ãåæ­¢ãéå¯çèæ¬","/pages/fe0782/"],["02.shell/05.mysqlæ°æ®åºå¤ä»½çä¸ç§æ¹å¼.md","mysqlæ°æ®åºå¤ä»½çä¸ç§æ¹å¼","/pages/93dcc7/"],["02.shell/06.jenkinsç¼è¯æå¡èæ¬.md","jenkinsç¼è¯æå¡èæ¬","/pages/2019f8/"],["02.shell/07.appç¼è¯èæ¬.md","appç¼è¯èæ¬","/pages/fd3678/"],["02.shell/08.å¸¸ç¨shellèæ¬.md","å¸¸ç¨shellèæ¬","/pages/8fdac1/"],["02.shell/09.å­ç¬¦ä¸²çæªåæ¼æ¥.md","å­ç¬¦ä¸²çæªåæ¼æ¥","/pages/f5c376/"],["02.shell/10.shellåºç¡.md","shellåºç¡","/pages/665355/"]]}],"/04.è¿ç»´/":[{title:"linux",collapsable:!0,children:[{title:"rsync",collapsable:!0,children:[["01.linux/01.rsync/01.rsyncç¨æ³ååæ°è¯¦è§£.md","rsyncç¨æ³ååæ°è¯¦è§£","/pages/98cac7/"],["01.linux/01.rsync/02.rsyncæå¡å®ç°æ¨éï¼æå.md","rsyncæå¡å®ç°æ¨éï¼æå","/pages/c7f1bc/"]]},{title:"dns",collapsable:!0,children:[["01.linux/02.dns/01.centos7æ­å»ºdns,bindéç½®.md","centos7æ­å»ºdns,bindéç½®","/pages/78c801/"]]},{title:"sedãawkãgrepãfindååå®¢",collapsable:!0,children:[["01.linux/03.sedãawkãgrepãfindååå®¢/01.sedå½ä»¤å¨ææ¬æ¯è¡,è¡å°¾æè¡é¦æ·»å å­ç¬¦.md","sedå½ä»¤å¨ææ¬æ¯è¡,è¡å°¾æè¡é¦æ·»å å­ç¬¦","/pages/4baba0/"]]},["01.linux/04.LVMç®¡ç.md","LVMç®¡ç","/pages/5f261c/"],["01.linux/05.sudoæéè§å.md","sudoæéè§å","/pages/0bac05/"],["01.linux/06.linuxä¿®æ¹ç½å¡ä¸ºeth0çä¸¤ç§æ¹æ³.md","linuxä¿®æ¹ç½å¡ä¸ºeth0çä¸¤ç§æ¹æ³","/pages/c17655/"],["01.linux/07.Logrotateå¥é¨äºè§£åçäº§å®è·µ.md","Logrotateå¥é¨äºè§£åçäº§å®è·µ","/pages/a8c469/"]]},{title:"windows",collapsable:!0,children:[["02.windows/01.windowsæ¯æå¤ç¨æ·è¿ç¨ç»å½.md","windowsæ¯æå¤ç¨æ·è¿ç¨ç»å½","/pages/18b06c/"],["02.windows/02.windowsåºç¨æå¡é¨ç½²èæ¬.md","windowsåºç¨æå¡é¨ç½²èæ¬","/pages/adbe78/"]]},{title:"ä¸­é´ä»¶",collapsable:!0,children:[{title:"nginx",collapsable:!0,children:[["03.ä¸­é´ä»¶/01.nginx/01.nginxéç½®æç¨.md","nginxéç½®æç¨","/pages/5ed327/"],["03.ä¸­é´ä»¶/01.nginx/02.nginxå¸¸ç¨éç½®.md","nginxå¸¸ç¨éç½®","/pages/df9ea8/"]]},{title:"kafka",collapsable:!0,children:[["03.ä¸­é´ä»¶/02.kafka/01.kafkaä»ç»åå¸¸è§æä½.md","kafkaä»ç»åå¸¸è§æä½","/pages/98b071/"],["03.ä¸­é´ä»¶/02.kafka/02.docker-composeå®è£kafkaéç¾¤.md","docker-composeå®è£kafkaéç¾¤","/pages/43f361/"],["03.ä¸­é´ä»¶/02.kafka/03.kafkaå·¥ä½åç.md","kafkaå·¥ä½åç","/pages/b73d79/"]]},["03.ä¸­é´ä»¶/03.apolloé¨ç½².md","apolloé¨ç½²","/pages/fd6cf8/"]]},{title:"ç½ç»",collapsable:!0,children:[["04.ç½ç»/01.æåå·¥å· tcpdump ç¨æ³è¯´æ.md","æåå·¥å· tcpdump ç¨æ³è¯´æ","/pages/2f613d/"],["04.ç½ç»/02.ç½ç»ä»£ç.md","ç½ç»ä»£ç","/pages/5933ee/"],["04.ç½ç»/03.ç½ç»å·¥å·.md","ç½ç»å·¥å·","/pages/38ce88/"]]},{title:"å®å¨",collapsable:!0,children:[["05.å®å¨/01.dockeré¨ç½²openvas.md","dockeré¨ç½²openvas","/pages/7f4bdd/"],["05.å®å¨/02.ç½å¸½å­è®²webå®å¨.md","ç½å¸½å­è®²webå®å¨","/pages/fcba46/"],["05.å®å¨/03.sshå®å¨.md","sshå®å¨","/pages/3913e5/"],["05.å®å¨/04.ç³»ç»å®å¨ååºç¨åºç¡.md","ç³»ç»å®å¨ååºç¨åºç¡","/pages/8dcd54/"]]},{title:"å­å¨",collapsable:!0,children:[["06.å­å¨/01.fastdfs.md","fastdfs","/pages/988870/"],["06.å­å¨/02.glusterfs.md","glusterfs","/pages/70e7ad/"],{title:"ceph",collapsable:!0,children:[["06.å­å¨/03.ceph/01.é¨ç½²cephéç¾¤ Nautilusç.md","é¨ç½²cephéç¾¤ Nautilusç","/pages/88a4de/"]]}]},{title:"é²ç«å¢",collapsable:!0,children:[["07.é²ç«å¢/01.centos7ä¸éç½®firewalldå®ç°natè½¬åè½¯è·¯ç±.md","centos7ä¸éç½®firewalldå®ç°natè½¬åè½¯è·¯ç±","/pages/ce46b6/"]]},{title:"æ°æ®åº",collapsable:!0,children:[{title:"mysql",collapsable:!0,children:[["08.æ°æ®åº/01.mysql/01.æ°æ®åºäºè¿å¶å®è£.md","æ°æ®åºäºè¿å¶å®è£","/pages/1f5460/"]]},{title:"mongodb",collapsable:!0,children:[["08.æ°æ®åº/02.mongodb/01.mongodbç¸å³æ¦å¿µ.md","mongodbç¸å³æ¦å¿µ","/pages/598be1/"],["08.æ°æ®åº/02.mongodb/02.mongodbå¯æ¬é.md","mongodbå¯æ¬é","/pages/359db9/"]]},{title:"oracle",collapsable:!0,children:[["08.æ°æ®åº/03.oracle/01.oracleæ°æ®åºå®è£.md","oracleæ°æ®åºå®è£","/pages/e977f3/"]]}]},{title:"ç³»ç»",collapsable:!0,children:[{title:"vmware",collapsable:!0,children:[["09.ç³»ç»/01.vmware/01.æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤.md","æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤","/pages/26f193/"]]},{title:"ftp",collapsable:!0,children:[["09.ç³»ç»/02.ftp/01.proftpdç¯å¢é¨ç½².md","proftpdç¯å¢é¨ç½²","/pages/affcf2/"]]},{title:"nexus",collapsable:!0,children:[["09.ç³»ç»/03.nexus/01.nexuså®è£.md","nexuså®è£","/pages/af4fce/"],["09.ç³»ç»/03.nexus/02.ä½¿ç¨nexus3éç½®npmç§æä»åº.md","ä½¿ç¨nexus3éç½®npmç§æä»åº","/pages/b851fe/"],["09.ç³»ç»/03.nexus/03.ä½¿ç¨nexus3éç½®mavenç§æä»åº.md","ä½¿ç¨nexus3éç½®mavenç§æä»åº","/pages/12e16a/"]]}]},{title:"docker",collapsable:!0,children:[["10.docker/01.Dockeræå»ºéå.md","Dockeræå»ºéå","/pages/83a393/"],["10.docker/02.dockerådocker-composeå®è£.md","dockerådocker-composeå®è£","/pages/217e32/"],["10.docker/03.å¦ä½éæ©dockeråºç¡éå.md","å¦ä½éæ©dockeråºç¡éå","/pages/8884ac/"],["10.docker/04.å¸¸è§çdockerfileæ±æ».md","å¸¸è§çdockerfileæ±æ»","/pages/382a6c/"],["10.docker/05.åºäºå®æ¹php7-2-34éåæå»ºçäº§å¯ç¨éå.md","åºäºå®æ¹php7.2.34éåæå»ºçäº§å¯ç¨éå","/pages/6e3cb9/"]]},{title:"other",collapsable:!0,children:[["11.other/01.debianä¸­ç§å¤§æ¿æ¢æç¨.md","debianä¸­ç§å¤§æ¿æ¢æç¨","/pages/767641/"],["11.other/02.Alpineå®è£phpåç§æ©å±.md","Alpineå®è£phpåç§æ©å±","/pages/aa9eee/"]]},{title:"çæ§",collapsable:!0,children:[{title:"zabbix",collapsable:!0,children:[["12.çæ§/01.zabbix/01.zabbixæ·»å è¯ä¹¦çæ§.md","zabbixæ·»å è¯ä¹¦çæ§","/pages/3dac52/"],["12.çæ§/01.zabbix/02.zabbixæ·»å ç«¯å£åè¿ç¨çæ§.md","zabbixæ·»å ç«¯å£åè¿ç¨çæ§","/pages/a0a3ae/"],["12.çæ§/01.zabbix/03.dockeræä»¶å®è£zabbix5.md","dockeræä»¶å®è£zabbix5","/pages/e0085e/"],["12.çæ§/01.zabbix/04.zabbixéç½®ééåè­¦.md","zabbixéç½®ééåè­¦","/pages/a4e3ce/"],["12.çæ§/01.zabbix/05.zabbixæ·»å æ¥å¿çæ§.md","zabbixæ·»å æ¥å¿çæ§","/pages/334bec/"],["12.çæ§/01.zabbix/06.zabbixæ·»å è¿ç¨pidçæ§.md","zabbixæ·»å è¿ç¨pidçæ§","/pages/20f905/"],["12.çæ§/01.zabbix/07.zabbixçæ§windowsè¿ç¨.md","zabbixçæ§windowsè¿ç¨","/pages/269839/"],["12.çæ§/01.zabbix/08.zabbixæ·»å webçæ§.md","zabbixæ·»å webçæ§","/pages/b70eb8/"],["12.çæ§/01.zabbix/09.centos7ç¼è¯å®è£zabbix proxyç«¯.md","centos7ç¼è¯å®è£zabbix5.0 proxyç«¯","/pages/723e7e/"],["12.çæ§/01.zabbix/10.rpmå®è£zabbix proxyè¿ç¨ç®è®°.md","rpmå®è£zabbix proxyè¿ç¨ç®è®°","/pages/ef347e/"]]},{title:"prometheus",collapsable:!0,children:[["12.çæ§/02.prometheus/01.prometheusçæ§ãåè­¦ä¸å­å¨.md","prometheusçæ§ãåè­¦ä¸å­å¨","/pages/40794d/"],["12.çæ§/02.prometheus/02.ä½¿ç¨docker-composeæ­å»ºpromethes+grafanaçæ§ç³»ç».md","ä½¿ç¨docker-composeæ­å»ºpromethes+grafanaçæ§ç³»ç»","/pages/712f5c/"],["12.çæ§/02.prometheus/03.prometheusæ·»å ééæ¶æ¯åè­¦.md","prometheusæ·»å ééæ¶æ¯åè­¦","/pages/22b836/"],["12.çæ§/02.prometheus/04.alertmanagerå®ç°æä¸ªæ¶é´æ®µéé»æäºåè­¦é¡¹.md","alertmanagerå®ç°æä¸ªæ¶é´æ®µéé»æäºåè­¦é¡¹","/pages/96c6ce/"]]}]}],"/05.å³äº/":[["01.å³äº.md","å³äº","/about/"]],"/06.åé¾/":[["01.åé¾.md","åé¾","/friends"]]},blogInfo:{blogCreate:"2019-09-20",indexView:!0,pageView:!0,mdFileCountType:"archives",totalWords:"archives",eachFileWords:[{name:"ansible",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\01.ansible.md",wordsCount:46,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"01.ä¸é¢/01.ansibleç³»åæç« ",description:"ansible"}},title:"ansible",date:"2022-12-15T10:37:52.000Z",permalink:"/ansible/",categories:["ç®å½é¡µ"],tags:[null]},{name:"k8s",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\02.k8s.md",wordsCount:42,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"01.ä¸é¢/02.k8s",description:"k8s"}},title:"k8s",date:"2022-12-15T14:40:52.000Z",permalink:"/k8s/",categories:["ç®å½é¡µ"],tags:[null]},{name:"elk",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\03.elk.md",wordsCount:42,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"01.ä¸é¢/03.elk",description:"elk"}},title:"elk",date:"2022-12-15T10:41:32.000Z",permalink:"/elk/",categories:["ç®å½é¡µ"],tags:[null]},{name:"jenkins",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\04.jenkins.md",wordsCount:42,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"01.ä¸é¢/06.jenkins",description:"jenkins"}},title:"jenkins",date:"2022-12-15T14:43:23.000Z",permalink:"/jenkins/",categories:["ç®å½é¡µ"],tags:[null]},{name:"éç¬",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\05.éç¬.md",wordsCount:45,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"02.çæ´»/01.éç¬",description:"éç¬"}},title:"éç¬",date:"2022-12-15T14:43:23.000Z",permalink:"/suibi/",categories:["ç®å½é¡µ"],tags:[null]},{name:"é¢è¯",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\06.é¢è¯.md",wordsCount:45,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"02.çæ´»/02.é¢è¯",description:"é¢è¯"}},title:"é¢è¯",date:"2022-12-15T14:43:23.000Z",permalink:"/mianshi/",categories:["ç®å½é¡µ"],tags:[null]},{name:"å·¥å·",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\07.å·¥å·.md",wordsCount:45,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"02.çæ´»/03.å·¥å·",description:"å·¥å·"}},title:"å·¥å·",date:"2022-12-15T14:43:23.000Z",permalink:"/gongju/",categories:["ç®å½é¡µ"],tags:[null]},{name:"çæ´»",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\08.çæ´».md",wordsCount:42,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"02.çæ´»",description:"çæ´»"}},title:"çæ´»",date:"2022-12-15T14:43:23.000Z",permalink:"/life/",categories:["ç®å½é¡µ"],tags:[null]},{name:"ç¼ç¨",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\09.ç¼ç¨.md",wordsCount:42,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"03.ç¼ç¨",description:"ç¼ç¨"}},title:"ç¼ç¨",date:"2022-12-15T14:43:23.000Z",permalink:"/code/",categories:["ç®å½é¡µ"],tags:[null]},{name:"python",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\10.python.md",wordsCount:42,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"03.ç¼ç¨/01.python",description:"python"}},title:"python",date:"2022-12-15T14:43:23.000Z",permalink:"/python/",categories:["ç®å½é¡µ"],tags:[null]},{name:"shell",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\11.shell.md",wordsCount:42,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"03.ç¼ç¨/02.shell",description:"shell"}},title:"shell",date:"2022-12-15T14:43:23.000Z",permalink:"/shell/",categories:["ç®å½é¡µ"],tags:[null]},{name:"ä¸é¢",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\12.ä¸é¢.md",wordsCount:42,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"01.ä¸é¢",description:"ä¸é¢"}},title:"ä¸é¢",date:"2022-12-15T14:43:23.000Z",permalink:"/topic/",categories:["ç®å½é¡µ"],tags:[null]},{name:"è¿ç»´",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\13.è¿ç»´.md",wordsCount:42,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´",description:"è¿ç»´"}},title:"è¿ç»´",date:"2022-12-15T14:43:23.000Z",permalink:"/ops/",categories:["ç®å½é¡µ"],tags:[null]},{name:"ä¸­é´ä»¶",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\14.ä¸­é´ä»¶.md",wordsCount:48,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/03.ä¸­é´ä»¶",description:"ä¸­é´ä»¶"}},title:"ä¸­é´ä»¶",date:"2022-12-15T14:43:23.000Z",permalink:"/middleware/",categories:["ç®å½é¡µ"],tags:[null]},{name:"linux",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\15.linux.md",wordsCount:42,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/01.linux",description:"linux"}},title:"linux",date:"2022-12-15T14:43:23.000Z",permalink:"/linux/",categories:["ç®å½é¡µ"],tags:[null]},{name:"windows",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\16.windows.md",wordsCount:42,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/02.windows",description:"windows"}},title:"windows",date:"2022-12-15T14:43:23.000Z",permalink:"/windows/",categories:["ç®å½é¡µ"],tags:[null]},{name:"ç½ç»",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\17.ç½ç».md",wordsCount:45,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/04.ç½ç»",description:"ç½ç»"}},title:"ç½ç»",date:"2022-12-15T14:43:23.000Z",permalink:"/network/",categories:["ç®å½é¡µ"],tags:[null]},{name:"å®å¨",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\18.å®å¨.md",wordsCount:45,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/05.å®å¨",description:"å®å¨"}},title:"å®å¨",date:"2022-12-15T14:43:23.000Z",permalink:"/safety/",categories:["ç®å½é¡µ"],tags:[null]},{name:"å­å¨",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\19.å­å¨.md",wordsCount:45,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/06.å­å¨",description:"å­å¨"}},title:"å­å¨",date:"2022-12-15T14:43:23.000Z",permalink:"/storage/",categories:["ç®å½é¡µ"],tags:[null]},{name:"é²ç«å¢",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\20.é²ç«å¢.md",wordsCount:48,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/07.é²ç«å¢",description:"é²ç«å¢"}},title:"é²ç«å¢",date:"2022-12-15T14:43:23.000Z",permalink:"/firewalld/",categories:["ç®å½é¡µ"],tags:[null]},{name:"æ°æ®åº",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\21.æ°æ®åº.md",wordsCount:48,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/08.æ°æ®åº",description:"æ°æ®åº"}},title:"æ°æ®åº",date:"2022-12-15T14:43:23.000Z",permalink:"/db/",categories:["ç®å½é¡µ"],tags:[null]},{name:"ç³»ç»",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\22.ç³»ç».md",wordsCount:45,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/09.ç³»ç»",description:"ç³»ç»"}},title:"ç³»ç»",date:"2022-12-15T14:43:23.000Z",permalink:"/sys/",categories:["ç®å½é¡µ"],tags:[null]},{name:"docker",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\23.docker.md",wordsCount:42,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/10.docker",description:"docker"}},title:"docker",date:"2022-12-15T14:43:23.000Z",permalink:"/docker/",categories:["ç®å½é¡µ"],tags:[null]},{name:"è¿ç»´å·¥å·",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\24.è¿ç»´å·¥å·.md",wordsCount:47,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"02.çæ´»/03.å·¥å·",description:"å·¥å·"}},title:"è¿ç»´å·¥å·",date:"2022-12-15T14:43:23.000Z",permalink:"/tool/",categories:["ç®å½é¡µ"],tags:[null]},{name:"çæ§",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\25.çæ§.md",wordsCount:45,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/12.çæ§",description:"çæ§"}},title:"çæ§",date:"2022-12-15T14:43:23.000Z",permalink:"/monitor/",categories:["ç®å½é¡µ"],tags:[null]},{name:"other",filePath:"D:\\blog\\blog-master\\docs\\00.ç®å½é¡µ\\26.other.md",wordsCount:42,readingTime:"1",pageComponent:{name:"Catalogue",data:{path:"04.è¿ç»´/11.other",description:"other"}},title:"other",date:"2022-12-15T14:43:23.000Z",permalink:"/other/",categories:["ç®å½é¡µ"],tags:[null]},{name:"ansibleå¥é¨",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\01.ansibleç³»åæç« \\01.ansibleå¥é¨.md",wordsCount:"6.8k",readingTime:"30.7m",title:"ansibleå¥é¨",date:null,permalink:"/pages/12c5da01/",categories:["ç³»åä¸é¢","ansible"],tags:["ansible"],description:null},{name:"anisbleæ¹éå®è£node_exporter",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\01.ansibleç³»åæç« \\02.anisbleæ¹éå®è£node_exporter.md",wordsCount:361,readingTime:"1.9m",title:"anisbleæ¹éå®è£node_exporter",categories:["ç³»åä¸é¢","ansible"],tags:["ansible"],date:"2022-12-09T20:53:14.000Z",permalink:"/pages/f8f66c/"},{name:"ansible-playbookä¸­çåé",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\01.ansibleç³»åæç« \\03.ansible-playbookä¸­çåé.md",wordsCount:"3.2k",readingTime:"15.3m",title:"ansible-playbookä¸­çåé",categories:["ç³»åä¸é¢","ansible"],tags:["ansible"],date:"2022-12-09T20:53:14.000Z",permalink:"/pages/d740bc/"},{name:"Ansibleæ§è½ä¼åââæåansibleæ§è¡æç",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\01.ansibleç³»åæç« \\04.Ansibleæ§è½ä¼åââæåansibleæ§è¡æç.md",wordsCount:"3k",readingTime:"12.9m",title:"Ansibleæ§è½ä¼åââæåansibleæ§è¡æç",categories:["ansible"],tags:["ansible"],date:"2022-12-09T20:53:07.000Z",permalink:"/pages/a06506/"},{name:"ansibleä¹rolesç®åä½¿ç¨",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\01.ansibleç³»åæç« \\05.ansibleä¹rolesç®åä½¿ç¨.md",wordsCount:"1.1k",readingTime:"5m",title:"ansibleä¹rolesç®åä½¿ç¨",categories:["ç³»åä¸é¢","ansible"],tags:["ansible"],date:"2022-12-09T20:53:07.000Z",permalink:"/pages/847542/"},{name:"ansibleä¸­templateç®åä½¿ç¨",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\01.ansibleç³»åæç« \\06.ansibleä¸­templateç®åä½¿ç¨.md",wordsCount:"1.5k",readingTime:"7.1m",title:"ansibleä¸­templateç®åä½¿ç¨",categories:["ç³»åä¸é¢","ansible"],tags:["ansible"],date:"2022-12-09T20:53:07.000Z",permalink:"/pages/4189b8/"},{name:"Ansibleä¸­çplaybook è¯¦è§£",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\01.ansibleç³»åæç« \\07.Ansibleä¸­çplaybook è¯¦è§£.md",wordsCount:"8.3k",readingTime:"40.5m",title:"playbookè¯¦è§£",categories:["ç³»åä¸é¢","ansible"],tags:["ansible"],date:"2022-12-09T20:53:07.000Z",permalink:"/pages/14eda9/"},{name:"ansible-playbookç¼æä½¿ç¨tips",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\01.ansibleç³»åæç« \\08.ansible-playbookç¼æä½¿ç¨tips.md",wordsCount:"2.2k",readingTime:"10m",title:"ansible-playbookç¼æä½¿ç¨tips",date:"2023-01-11T15:06:48.000Z",permalink:"/pages/7eca6b/",categories:["ä¸é¢","ansibleç³»åæç« "],tags:[null]},{name:"ansibleä¼ç§æ¡ä¾",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\01.ansibleç³»åæç« \\09.ansibleä¼ç§æ¡ä¾.md",wordsCount:144,readingTime:"1",title:"ansibleä¼ç§æ¡ä¾",date:"2023-01-29T15:16:58.000Z",permalink:"/pages/4fbba1/",categories:["ä¸é¢","ansibleç³»åæç« "],tags:[null]},{name:"å¿«éé¨ç½²k8séç¾¤",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\02.k8s\\01.å¿«éé¨ç½²k8séç¾¤.md",wordsCount:878,readingTime:"4.2m",title:"å¿«éé¨ç½²k8séç¾¤",categories:["k8s"],tags:["k8s"],date:"2022-12-09T20:51:06.000Z",permalink:"/pages/fc6bfb/"},{name:"elkå®è£",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\03.elk\\01.elkå®è£.md",wordsCount:"1.3k",readingTime:"5.9m",title:"elkå®è£",categories:"elk",tags:["elk"],date:"2022-12-09T20:50:18.000Z",permalink:"/pages/98c9f5/"},{name:"docker-composeå®è£elk",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\03.elk\\02.docker-composeå®è£elk.md",wordsCount:386,readingTime:"2.3m",title:"docker-composeå®è£elk",date:"2023-01-13T16:45:28.000Z",permalink:"/pages/bbe108/",categories:["ä¸é¢","elk"],tags:[null]},{name:"filebeat-logç¸å³éç½®æå",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\03.elk\\03.filebeat-logç¸å³éç½®æå.md",wordsCount:"3.7k",readingTime:"14.6m",title:"filebeat-logç¸å³éç½®æå",date:"2023-02-23T09:01:59.000Z",permalink:"/pages/ed9e8d/",categories:["ä¸é¢","elk"],tags:[null]},{name:"jenkinså®¹å¨å®è£",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\04.jenkins\\01.jenkinså®¹å¨å®è£.md",wordsCount:218,readingTime:"1.3m",title:"jenkinså®¹å¨å®è£",date:"2022-12-15T14:01:31.000Z",permalink:"/pages/ce2b89/",categories:["ä¸é¢","jenkins"],tags:[null]},{name:"jenkinsæµæ°´çº¿é¨ç½²",filePath:"D:\\blog\\blog-master\\docs\\01.ä¸é¢\\04.jenkins\\02.jenkinsæµæ°´çº¿é¨ç½².md",wordsCount:"1.4k",readingTime:"8m",title:"jenkinsæµæ°´çº¿é¨ç½²",date:"2023-01-06T14:41:01.000Z",permalink:"/pages/a9ff44/",categories:["ä¸é¢","jenkins"],tags:[null]},{name:"ç·äººå¿æºæççä¹å¤§è¡¨ç°",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\01.éç¬\\01.ç·äººå¿æºæççä¹å¤§è¡¨ç°.md",wordsCount:"1k",readingTime:"3.5m",title:"ç·äººå¿æºæççä¹å¤§è¡¨ç°",categories:"éç¬",tags:["éç¬"],date:"2022-12-09T20:46:02.000Z",permalink:"/pages/aa6ada/"},{name:"å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\01.éç¬\\02.å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯.md",wordsCount:583,readingTime:"2m",title:"å¦æé¢è¯æ¶å¤§å®¶é½è¯´çè¯",date:"2020-01-06T14:28:22.000Z",categories:"éç¬",tags:["é¢è¯é¢é"],permalink:"/pages/0cd089/"},{name:"è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\01.éç¬\\03.è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç.md",wordsCount:557,readingTime:"1.9m",title:"è¿åä¸ªæäºå°æ®µï¼å¤ä½ åç¨ä¸ç",date:"2023-02-23T12:14:52.000Z",permalink:"/pages/7b0831/",categories:["çæ´»","éç¬"],tags:[null]},{name:"å°è¯´æ´»çæå½",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\01.éç¬\\04.å°è¯´æ´»çæå½.md",wordsCount:"2.3k",readingTime:"7.8m",title:"å°è¯´æ´»çæå½",date:"2023-02-24T16:40:24.000Z",permalink:"/pages/e7e74b/",categories:["çæ´»","éç¬"],tags:[null]},{name:"äººçæ ¼è¨",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\01.éç¬\\05.äººçæ ¼è¨.md",wordsCount:113,readingTime:"1",title:"äººçæ ¼è¨",date:"2023-02-24T16:42:33.000Z",permalink:"/pages/58b3c0/",categories:["çæ´»","éç¬"],tags:[null]},{name:"è¿ç»´10éåºç¡é¢è¯é¢",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\02.é¢è¯\\01.è¿ç»´10éåºç¡é¢è¯é¢.md",wordsCount:956,readingTime:"3.9m",title:"è¿ç»´10éåºç¡é¢è¯é¢",date:"2020-01-13T14:28:22.000Z",categories:["é¢è¯"],tags:["é¢è¯é¢é"],permalink:"/pages/f6c9c9/"},{name:"httpç¶æç ",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\02.é¢è¯\\02.httpç¶æç .md",wordsCount:183,readingTime:"1",title:"httpç¶æç ",date:"2020-01-06T14:28:22.000Z",categories:"ææ¯",tags:["é¢è¯é¢é"],permalink:"/pages/a2e381/"},{name:"é«çº§è¿ç»´å·¥ç¨éè¦ææ¡çæè½",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\02.é¢è¯\\03.é«çº§è¿ç»´å·¥ç¨éè¦ææ¡çæè½.md",wordsCount:826,readingTime:"3.1m",title:"é«çº§è¿ç»´å·¥ç¨éè¦ææ¡çæè½",date:"2022-12-15T10:29:16.000Z",permalink:"/pages/9245d9/",categories:["ä¸é¢","é¢è¯"],tags:[null]},{name:"ä¼ä¸çº§openvpnæ­å»º",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\03.å·¥å·\\01.vpn\\01.ä¼ä¸çº§openvpnæ­å»º.md",wordsCount:"2.6k",readingTime:"12.6m",title:"ä¼ä¸çº§openvpnæ­å»º",date:"2022-12-15T19:13:50.000Z",permalink:"/pages/45fa3c/",categories:["è¿ç»´","vpn"],tags:[null]},{name:"å®ç°V2Rayéè¿CloudFlareèªéIPå é",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\03.å·¥å·\\02.ç¿»å¢æç¨\\01.å®ç°V2Rayéè¿CloudFlareèªéIPå é.md",wordsCount:641,readingTime:"2.8m",title:"å®ç°V2Rayéè¿CloudFlareèªéIPå é",date:"2022-12-15T19:05:28.000Z",permalink:"/pages/e9bb88/",categories:["è¿ç»´","ç¿»å¢æç¨"],tags:[null]},{name:"macçµèå¸¸ç¨è½¯ä»¶",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\03.å·¥å·\\03.macçµèå¸¸ç¨è½¯ä»¶.md",wordsCount:60,readingTime:"1",title:"macçµèå¸¸ç¨è½¯ä»¶",date:"2022-12-15T14:59:50.000Z",permalink:"/pages/4ad301/",categories:["çæ´»","å·¥å·"],tags:[null]},{name:"ä¸ªäººå·¥å·é¾æ¥",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\03.å·¥å·\\04.ä¸ªäººå·¥å·é¾æ¥.md",wordsCount:58,readingTime:"1",title:"å·¥å·é¾æ¥",date:"2022-12-16T14:39:26.000Z",permalink:"/pages/8994e9/",categories:["çæ´»","å·¥å·"],tags:[null]},{name:"vuepresséç½®artalk",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\03.å·¥å·\\05.vuepresséç½®artalk.md",wordsCount:306,readingTime:"1.5m",title:"vuepresséç½®artalk",date:"2023-01-11T14:19:31.000Z",permalink:"/pages/468f43/",categories:["çæ´»","å·¥å·"],tags:[null]},{name:"windowsç®å½å®æ¶åæ­¥å·¥å·",filePath:"D:\\blog\\blog-master\\docs\\02.çæ´»\\03.å·¥å·\\06.windowsç®å½å®æ¶åæ­¥å·¥å·.md",wordsCount:42,readingTime:"1",title:"windowsç®å½å®æ¶åæ­¥å·¥å·",date:"2022-12-15T15:00:54.000Z",permalink:"/pages/112008/",categories:["çæ´»","å·¥å·"],tags:[null]},{name:"çæ§ç®å½ææä»¶åå",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\01.python\\01.çæ§ç®å½ææä»¶åå.md",wordsCount:373,readingTime:"1.7m",title:"çæ§ç®å½ææä»¶åå",date:"2022-12-13T18:01:34.000Z",permalink:"/pages/f8da74/",categories:["ç¼ç¨","python"],tags:[null]},{name:"æ¹éæ´æ¹æä»¶",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\01.python\\02.æ¹éæ´æ¹æä»¶.md",wordsCount:82,readingTime:"1",title:"æ¹éæ´æ¹æä»¶",date:"2022-12-13T18:01:34.000Z",permalink:"/pages/f659cd/",categories:["ç¼ç¨","python"],tags:[null]},{name:"pythonå¼ç¨æ°æ®åº",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\01.python\\03.pythonå¼ç¨æ°æ®åº.md",wordsCount:424,readingTime:"2.3m",title:"pythonå¼ç¨æ°æ®åº",date:"2022-12-13T18:35:51.000Z",permalink:"/pages/a109ec/",categories:["ç¼ç¨","python"],tags:[null]},{name:"python3ç»é²ç«å¢æ·»å æ¾è¡",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\01.python\\04.python3ç»é²ç«å¢æ·»å æ¾è¡.md",wordsCount:258,readingTime:"1.5m",title:"python3ç»é²ç«å¢æ·»å æ¾è¡",date:"2022-12-14T14:51:21.000Z",permalink:"/pages/457fb7/",categories:["ç¼ç¨","python"],tags:[null]},{name:"pythonçæé¨ç½²èæ¬",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\01.python\\05.pythonçæé¨ç½²èæ¬.md",wordsCount:"1.7k",readingTime:"10.6m",title:"pythonçæé¨ç½²èæ¬",date:"2023-01-06T11:10:56.000Z",permalink:"/pages/d0fcb5/",categories:["ç¼ç¨","python"],tags:[null]},{name:"pythonå°å¤ä¸ªæä»¶åå®¹è¾åºå°ä¸ä¸ªæä»¶ä¸­",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\01.python\\06.pythonå°å¤ä¸ªæä»¶åå®¹è¾åºå°ä¸ä¸ªæä»¶ä¸­.md",wordsCount:224,readingTime:"1.1m",title:"pythonå°å¤ä¸ªæä»¶åå®¹è¾åºå°ä¸ä¸ªæä»¶ä¸­",date:"2023-01-09T17:43:27.000Z",permalink:"/pages/8d0b76/",categories:["ç¼ç¨","python"],tags:[null]},{name:"è¿ç¨pidå¤æ­èæ¬",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\02.shell\\01.è¿ç¨pidå¤æ­èæ¬.md",wordsCount:244,readingTime:"1.2m",title:"è¿ç¨pidå¤æ­èæ¬",date:"2022-12-14T14:30:33.000Z",permalink:"/pages/cae02d/",categories:["ç¼ç¨","shell"],tags:[null]},{name:"æ¥å¿åå²èæ¬",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\02.shell\\02.æ¥å¿åå²èæ¬.md",wordsCount:86,readingTime:"1",title:"æ¥å¿åå²èæ¬",date:"2022-12-15T12:32:31.000Z",permalink:"/pages/3b937e/",categories:["ç¼ç¨","shell"],tags:[null]},{name:"è®¾ç½®è·³æ¿æºèæ¬",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\02.shell\\03.è®¾ç½®è·³æ¿æºèæ¬.md",wordsCount:261,readingTime:"1.5m",title:"è®¾ç½®è·³æ¿æºèæ¬",date:"2022-12-15T12:41:13.000Z",permalink:"/pages/69b699/",categories:["ç¼ç¨","shell"],tags:[null]},{name:"ç¼åå¯å¨ãåæ­¢ãéå¯çèæ¬",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\02.shell\\04.ç¼åå¯å¨ãåæ­¢ãéå¯çèæ¬.md",wordsCount:148,readingTime:"1",title:"ç¼åå¯å¨ãåæ­¢ãéå¯çèæ¬",date:"2022-12-21T18:07:20.000Z",permalink:"/pages/fe0782/",categories:["ç¼ç¨","shell"],tags:[null]},{name:"mysqlæ°æ®åºå¤ä»½çä¸ç§æ¹å¼",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\02.shell\\05.mysqlæ°æ®åºå¤ä»½çä¸ç§æ¹å¼.md",wordsCount:799,readingTime:"4.1m",title:"mysqlæ°æ®åºå¤ä»½çä¸ç§æ¹å¼",date:"2023-01-04T14:22:29.000Z",permalink:"/pages/93dcc7/",categories:["ç¼ç¨","shell"],tags:[null]},{name:"jenkinsç¼è¯æå¡èæ¬",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\02.shell\\06.jenkinsç¼è¯æå¡èæ¬.md",wordsCount:433,readingTime:"2.5m",title:"jenkinsç¼è¯æå¡èæ¬",date:"2023-01-06T11:01:07.000Z",permalink:"/pages/2019f8/",categories:["ç¼ç¨","shell"],tags:[null]},{name:"appç¼è¯èæ¬",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\02.shell\\07.appç¼è¯èæ¬.md",wordsCount:"1.4k",readingTime:"8.2m",title:"appç¼è¯èæ¬",date:"2023-01-06T11:06:30.000Z",permalink:"/pages/fd3678/",categories:["ç¼ç¨","shell"],tags:[null]},{name:"å¸¸ç¨shellèæ¬",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\02.shell\\08.å¸¸ç¨shellèæ¬.md",wordsCount:"1.6k",readingTime:"8.4m",title:"å¸¸ç¨shellèæ¬",date:"2023-02-24T15:30:36.000Z",permalink:"/pages/8fdac1/",categories:["ç¼ç¨","shell"],tags:[null]},{name:"å­ç¬¦ä¸²çæªåæ¼æ¥",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\02.shell\\09.å­ç¬¦ä¸²çæªåæ¼æ¥.md",wordsCount:828,readingTime:"3.7m",title:"å­ç¬¦ä¸²çæªåæ¼æ¥",date:"2023-02-24T17:28:59.000Z",permalink:"/pages/f5c376/",categories:["ç¼ç¨","shell"],tags:[null]},{name:"shellåºç¡",filePath:"D:\\blog\\blog-master\\docs\\03.ç¼ç¨\\02.shell\\10.shellåºç¡.md",wordsCount:"5k",readingTime:"20.3m",title:"shellåºç¡",date:"2023-02-24T17:31:50.000Z",permalink:"/pages/665355/",categories:["ç¼ç¨","shell"],tags:[null]},{name:"rsyncç¨æ³ååæ°è¯¦è§£",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\01.linux\\01.rsync\\01.rsyncç¨æ³ååæ°è¯¦è§£.md",wordsCount:"1.9k",readingTime:"7.2m",title:"rsyncç¨æ³ååæ°è¯¦è§£",categories:["rsync"],tags:["rsync"],date:"2022-12-09T20:51:06.000Z",permalink:"/pages/98cac7/",feed:{enable:!0},description:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{name:"rsyncæå¡å®ç°æ¨éï¼æå",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\01.linux\\01.rsync\\02.rsyncæå¡å®ç°æ¨éï¼æå.md",wordsCount:"1.2k",readingTime:"5.3m",title:"rsyncæå¡å®ç°æ¨éï¼æå",categories:["rsync"],tags:["rsync"],date:"2022-12-09T20:51:06.000Z",permalink:"/pages/c7f1bc/",feed:{enable:!0},description:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{name:"centos7æ­å»ºdns,bindéç½®",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\01.linux\\02.dns\\01.centos7æ­å»ºdns,bindéç½®.md",wordsCount:969,readingTime:"4.7m",title:"centos7æ­å»ºdns,bindéç½®",date:"2022-12-15T19:18:37.000Z",permalink:"/pages/78c801/",categories:["è¿ç»´","dns"],tags:[null],feed:{enable:!0},description:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{name:"sedå½ä»¤å¨ææ¬æ¯è¡,è¡å°¾æè¡é¦æ·»å å­ç¬¦",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\01.linux\\03.sedãawkãgrepãfindååå®¢\\01.sedå½ä»¤å¨ææ¬æ¯è¡,è¡å°¾æè¡é¦æ·»å å­ç¬¦.md",wordsCount:370,readingTime:"1.5m",title:"sedå½ä»¤å¨ææ¬æ¯è¡,è¡å°¾æè¡é¦æ·»å å­ç¬¦",date:"2022-12-21T20:56:09.000Z",permalink:"/pages/4baba0/",categories:["è¿ç»´","linux","sedãawkãgrepãfindååå®¢"],tags:[null],feed:{enable:!0},description:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{name:"LVMç®¡ç",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\01.linux\\04.LVMç®¡ç.md",wordsCount:"4k",readingTime:"21m",title:"LVMç®¡ç",date:"2022-12-15T17:38:10.000Z",permalink:"/pages/5f261c/",categories:["è¿ç»´","linuxç³»ç»"],tags:[null],feed:{enable:!0},description:null},{name:"sudoæéè§å",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\01.linux\\05.sudoæéè§å.md",wordsCount:"2.7k",readingTime:"11.8m",title:"sudoæéè§å",date:"2022-12-15T18:49:07.000Z",permalink:"/pages/0bac05/",categories:["è¿ç»´","linuxç³»ç»"],tags:[null],feed:{enable:!0},description:"sudoæéè§å"},{name:"linuxä¿®æ¹ç½å¡ä¸ºeth0çä¸¤ç§æ¹æ³",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\01.linux\\06.linuxä¿®æ¹ç½å¡ä¸ºeth0çä¸¤ç§æ¹æ³.md",wordsCount:255,readingTime:"1.1m",title:"linuxä¿®æ¹ç½å¡ä¸ºeth0çä¸¤ç§æ¹æ³",date:"2022-12-21T14:34:00.000Z",permalink:"/pages/c17655/",categories:["è¿ç»´","linux"],tags:[null],feed:{enable:!0},description:"sudoæéè§å"},{name:"Logrotateå¥é¨äºè§£åçäº§å®è·µ",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\01.linux\\07.Logrotateå¥é¨äºè§£åçäº§å®è·µ.md",wordsCount:"1.5k",readingTime:"5.7m",title:"Logrotateå¥é¨äºè§£åçäº§å®è·µ",date:"2023-01-11T15:19:54.000Z",permalink:"/pages/a8c469/",categories:["è¿ç»´","linux"],tags:[null],feed:{enable:!0},description:"Logrotateå¥é¨äºè§£åçäº§å®è·µ"},{name:"windowsæ¯æå¤ç¨æ·è¿ç¨ç»å½",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\02.windows\\01.windowsæ¯æå¤ç¨æ·è¿ç¨ç»å½.md",wordsCount:"1k",readingTime:"3.8m",title:"windowsæ¯æå¤ç¨æ·è¿ç¨ç»å½",date:"2022-12-15T18:56:36.000Z",permalink:"/pages/18b06c/",categories:["è¿ç»´","windowsç³»ç»"],tags:[null]},{name:"windowsåºç¨æå¡é¨ç½²èæ¬",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\02.windows\\02.windowsåºç¨æå¡é¨ç½²èæ¬.md",wordsCount:287,readingTime:"1.6m",title:"windowsåºç¨æå¡é¨ç½²èæ¬",date:"2023-02-28T22:13:50.000Z",permalink:"/pages/adbe78/",categories:["è¿ç»´","windows"],tags:[null]},{name:"nginxéç½®æç¨",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\03.ä¸­é´ä»¶\\01.nginx\\01.nginxéç½®æç¨.md",wordsCount:"10.4k",readingTime:"45.3m",title:"nginxéç½®æç¨",categories:"nginx",tags:["nginx"],date:"2022-12-09T20:48:36.000Z",permalink:"/pages/5ed327/"},{name:"nginxå¸¸ç¨éç½®",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\03.ä¸­é´ä»¶\\01.nginx\\02.nginxå¸¸ç¨éç½®.md",wordsCount:"3.1k",readingTime:"14m",title:"nginxå¸¸ç¨éç½®",date:"2023-02-09T20:26:18.000Z",permalink:"/pages/df9ea8/",categories:["è¿ç»´","ä¸­é´ä»¶","nginx"],tags:[null]},{name:"kafkaä»ç»åå¸¸è§æä½",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\03.ä¸­é´ä»¶\\02.kafka\\01.kafkaä»ç»åå¸¸è§æä½.md",wordsCount:"1k",readingTime:"4.6m",title:"kafkaä»ç»åå¸¸è§æä½",date:"2023-02-23T09:16:02.000Z",permalink:"/pages/98b071/",categories:["è¿ç»´","ä¸­é´ä»¶","kafka"],tags:[null]},{name:"docker-composeå®è£kafkaéç¾¤",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\03.ä¸­é´ä»¶\\02.kafka\\02.docker-composeå®è£kafkaéç¾¤.md",wordsCount:189,readingTime:"1.1m",title:"docker-composeå®è£kafkaéç¾¤",date:"2023-01-13T16:48:12.000Z",permalink:"/pages/43f361/",categories:["è¿ç»´","ç³»ç»"],tags:[null]},{name:"kafkaå·¥ä½åç",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\03.ä¸­é´ä»¶\\02.kafka\\03.kafkaå·¥ä½åç.md",wordsCount:"1.3k",readingTime:"5.1m",title:"kafkaå·¥ä½åç",date:"2023-03-01T14:14:49.000Z",permalink:"/pages/b73d79/",categories:["è¿ç»´","ä¸­é´ä»¶","kafka"],tags:[null]},{name:"apolloé¨ç½²",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\03.ä¸­é´ä»¶\\03.apolloé¨ç½².md",wordsCount:"5.5k",readingTime:"23.8m",title:"apolloé¨ç½²",date:"2022-12-15T19:20:45.000Z",permalink:"/pages/fd6cf8/",categories:["è¿ç»´","ç¨åº"],tags:[null]},{name:"æåå·¥å· tcpdump ç¨æ³è¯´æ",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\04.ç½ç»\\01.æåå·¥å· tcpdump ç¨æ³è¯´æ.md",wordsCount:"2.7k",readingTime:"12.3m",title:"æåå·¥å· tcpdump ç¨æ³è¯´æ",date:"2022-12-15T19:00:25.000Z",permalink:"/pages/2f613d/",categories:["è¿ç»´","ç½ç»"],tags:[null]},{name:"ç½ç»ä»£ç",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\04.ç½ç»\\02.ç½ç»ä»£ç.md",wordsCount:"4.9k",readingTime:"21.5m",title:"ç½ç»ä»£ç",date:"2023-02-20T09:19:56.000Z",permalink:"/pages/5933ee/",categories:["è¿ç»´","ç½ç»"],tags:[null]},{name:"ç½ç»å·¥å·",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\04.ç½ç»\\03.ç½ç»å·¥å·.md",wordsCount:148,readingTime:"1",title:"ç½ç»å·¥å·",date:"2023-02-20T09:33:21.000Z",permalink:"/pages/38ce88/",categories:["è¿ç»´","ç½ç»"],tags:[null]},{name:"dockeré¨ç½²openvas",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\05.å®å¨\\01.dockeré¨ç½²openvas.md",wordsCount:611,readingTime:"2.5m",title:"dockeré¨ç½²openvas",date:"2022-12-15T19:21:33.000Z",permalink:"/pages/7f4bdd/",categories:["è¿ç»´","å®å¨"],tags:[null]},{name:"ç½å¸½å­è®²webå®å¨",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\05.å®å¨\\02.ç½å¸½å­è®²webå®å¨.md",wordsCount:"1.2k",readingTime:"4.1m",title:"ç½å¸½å­è®²webå®å¨",date:"2023-02-24T15:38:46.000Z",permalink:"/pages/fcba46/",categories:["è¿ç»´","å®å¨"],tags:[null]},{name:"sshå®å¨",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\05.å®å¨\\03.sshå®å¨.md",wordsCount:390,readingTime:"2m",title:"sshå®å¨",date:"2023-02-24T15:44:20.000Z",permalink:"/pages/3913e5/",categories:["è¿ç»´","å®å¨"],tags:[null]},{name:"ç³»ç»å®å¨ååºç¨åºç¡",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\05.å®å¨\\04.ç³»ç»å®å¨ååºç¨åºç¡.md",wordsCount:"2.1k",readingTime:"9m",title:"ç³»ç»å®å¨ååºç¨åºç¡",date:"2023-02-24T15:49:26.000Z",permalink:"/pages/8dcd54/",categories:["è¿ç»´","å®å¨"],tags:[null]},{name:"fastdfs",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\06.å­å¨\\01.fastdfs.md",wordsCount:"6.1k",readingTime:"26.6m",title:"fastdfs",categories:"fastdfs",tags:["åå¸å¼æä»¶ç³»ç»"],date:"2022-12-09T20:47:55.000Z",permalink:"/pages/988870/"},{name:"glusterfs",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\06.å­å¨\\02.glusterfs.md",wordsCount:"2k",readingTime:"9.5m",title:"glusterfs",categories:"glusterfs",tags:["åå¸å¼æä»¶ç³»ç»"],date:"2022-12-09T20:47:55.000Z",permalink:"/pages/70e7ad/"},{name:"é¨ç½²cephéç¾¤ Nautilusç",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\06.å­å¨\\03.ceph\\01.é¨ç½²cephéç¾¤ Nautilusç.md",wordsCount:"3.8k",readingTime:"17.8m",title:"é¨ç½²cephéç¾¤ Nautilusç",date:"2023-03-01T15:47:49.000Z",permalink:"/pages/88a4de/",categories:["è¿ç»´","å­å¨","ceph"],tags:[null]},{name:"centos7ä¸éç½®firewalldå®ç°natè½¬åè½¯è·¯ç±",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\07.é²ç«å¢\\01.centos7ä¸éç½®firewalldå®ç°natè½¬åè½¯è·¯ç±.md",wordsCount:932,readingTime:"4.1m",title:"centos7ä¸éç½®firewalldå®ç°natè½¬åè½¯è·¯ç±",date:"2022-12-15T19:03:12.000Z",permalink:"/pages/ce46b6/",categories:["è¿ç»´","é²ç«å¢"],tags:[null]},{name:"æ°æ®åºäºè¿å¶å®è£",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\08.æ°æ®åº\\01.mysql\\01.æ°æ®åºäºè¿å¶å®è£.md",wordsCount:"2.1k",readingTime:"10.2m",title:"æ°æ®åºäºè¿å¶å®è£",categories:"mysql",tags:["mysql"],date:"2022-12-09T20:49:19.000Z",permalink:"/pages/1f5460/"},{name:"mongodbç¸å³æ¦å¿µ",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\08.æ°æ®åº\\02.mongodb\\01.mongodbç¸å³æ¦å¿µ.md",wordsCount:"12.3k",readingTime:"49.8m",title:"mongodbç¸å³æ¦å¿µ",categories:"mongodb",tags:["mongodb"],date:"2022-12-09T20:50:33.000Z",permalink:"/pages/598be1/"},{name:"mongodbå¯æ¬é",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\08.æ°æ®åº\\02.mongodb\\02.mongodbå¯æ¬é.md",wordsCount:"23.9k",readingTime:"1h43m",title:"mongodbå¯æ¬é",categories:"mongodb",tags:["mongodb"],date:"2022-12-09T20:50:33.000Z",permalink:"/pages/359db9/"},{name:"oracleæ°æ®åºå®è£",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\08.æ°æ®åº\\03.oracle\\01.oracleæ°æ®åºå®è£.md",wordsCount:"1.9k",readingTime:"8.9m",title:"oracleæ°æ®åºå®è£",date:"2023-03-01T15:15:52.000Z",permalink:"/pages/e977f3/",categories:["è¿ç»´","æ°æ®åº","oracle"],tags:[null]},{name:"æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\09.ç³»ç»\\01.vmware\\01.æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤.md",wordsCount:"2.8k",readingTime:"12.4m",title:"æå¡å¨èæåVMware ESXIæ­å»ºéç¾¤",date:"2022-12-16T15:57:11.000Z",permalink:"/pages/26f193/",categories:["è¿ç»´","ç³»ç»","vmware"],tags:[null]},{name:"proftpdç¯å¢é¨ç½²",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\09.ç³»ç»\\02.ftp\\01.proftpdç¯å¢é¨ç½².md",wordsCount:"2.9k",readingTime:"13.4m",title:"proftpdç¯å¢é¨ç½²",date:"2022-12-21T17:59:19.000Z",permalink:"/pages/affcf2/",categories:["è¿ç»´","ç³»ç»","ftp"],tags:[null]},{name:"nexuså®è£",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\09.ç³»ç»\\03.nexus\\01.nexuså®è£.md",wordsCount:"1.9k",readingTime:"7.6m",title:"nexuså®è£",date:"2023-02-17T10:48:27.000Z",permalink:"/pages/af4fce/",categories:["è¿ç»´","ç³»ç»","nexus"],tags:[null]},{name:"ä½¿ç¨nexus3éç½®npmç§æä»åº",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\09.ç³»ç»\\03.nexus\\02.ä½¿ç¨nexus3éç½®npmç§æä»åº.md",wordsCount:"1.2k",readingTime:"5.3m",title:"ä½¿ç¨nexus3éç½®npmç§æä»åº",date:"2023-02-20T10:57:40.000Z",permalink:"/pages/b851fe/",categories:["è¿ç»´","ç³»ç»","nexus"],tags:[null]},{name:"ä½¿ç¨nexus3éç½®mavenç§æä»åº",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\09.ç³»ç»\\03.nexus\\03.ä½¿ç¨nexus3éç½®mavenç§æä»åº.md",wordsCount:"2.3k",readingTime:"12.5m",title:"ä½¿ç¨nexus3éç½®mavenç§æä»åº",date:"2023-02-20T12:03:31.000Z",permalink:"/pages/12e16a/",categories:["è¿ç»´","ç³»ç»","nexus"],tags:[null]},{name:"Dockeræå»ºéå",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\10.docker\\01.Dockeræå»ºéå.md",wordsCount:"8.4k",readingTime:"34.2m",title:"Dockeræå»ºéå",date:"2023-02-24T16:15:35.000Z",permalink:"/pages/83a393/",categories:["è¿ç»´","docker"],tags:[null]},{name:"dockerådocker-composeå®è£",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\10.docker\\02.dockerådocker-composeå®è£.md",wordsCount:331,readingTime:"1.7m",title:"dockerådocker-composeå®è£",date:"2022-12-15T18:52:58.000Z",permalink:"/pages/217e32/",categories:["è¿ç»´","docker"],tags:[null]},{name:"å¦ä½éæ©dockeråºç¡éå",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\10.docker\\03.å¦ä½éæ©dockeråºç¡éå.md",wordsCount:656,readingTime:"2.8m",title:"å¦ä½éæ©dockeråºç¡éå",date:"2023-01-30T16:28:23.000Z",permalink:"/pages/8884ac/",categories:["è¿ç»´","docker"],tags:[null]},{name:"å¸¸è§çdockerfileæ±æ»",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\10.docker\\04.å¸¸è§çdockerfileæ±æ».md",wordsCount:546,readingTime:"3.3m",title:"å¸¸è§çdockerfileæ±æ»",date:"2023-02-01T12:38:37.000Z",permalink:"/pages/382a6c/",categories:["è¿ç»´","docker"],tags:[null]},{name:"åºäºå®æ¹php7-2-34éåæå»ºçäº§å¯ç¨éå",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\10.docker\\05.åºäºå®æ¹php7-2-34éåæå»ºçäº§å¯ç¨éå.md",wordsCount:"2k",readingTime:"9.1m",title:"åºäºå®æ¹php7.2.34éåæå»ºçäº§å¯ç¨éå",date:"2023-01-30T20:21:15.000Z",permalink:"/pages/6e3cb9/",categories:["docker"],tags:[null]},{name:"debianä¸­ç§å¤§æ¿æ¢æç¨",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\11.other\\01.debianä¸­ç§å¤§æ¿æ¢æç¨.md",wordsCount:400,readingTime:"1.9m",title:"debianä¸­ç§å¤§æ¿æ¢æç¨",date:"2022-12-15T18:58:50.000Z",permalink:"/pages/767641/",categories:["è¿ç»´","éåæº"],tags:[null]},{name:"Alpineå®è£phpåç§æ©å±",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\11.other\\02.Alpineå®è£phpåç§æ©å±.md",wordsCount:462,readingTime:"2.7m",title:"Alpineå®è£phpåç§æ©å±",date:"2023-01-30T20:43:25.000Z",permalink:"/pages/aa9eee/",categories:["è¿ç»´","ä¸­é´ä»¶"],tags:[null]},{name:"zabbixæ·»å è¯ä¹¦çæ§",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\01.zabbix\\01.zabbixæ·»å è¯ä¹¦çæ§.md",wordsCount:642,readingTime:"3.5m",title:"zabbixæ·»å è¯ä¹¦çæ§",date:"2022-12-14T15:03:30.000Z",permalink:"/pages/3dac52/",categories:["ä¸é¢","zabbix"],tags:[null]},{name:"zabbixæ·»å ç«¯å£åè¿ç¨çæ§",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\01.zabbix\\02.zabbixæ·»å ç«¯å£åè¿ç¨çæ§.md",wordsCount:594,readingTime:"2.7m",title:"zabbixæ·»å ç«¯å£åè¿ç¨çæ§",date:"2022-12-14T15:03:30.000Z",permalink:"/pages/a0a3ae/",categories:["ä¸é¢","zabbix"],tags:[null]},{name:"dockeræä»¶å®è£zabbix5",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\01.zabbix\\03.dockeræä»¶å®è£zabbix5.md",wordsCount:873,readingTime:"5.3m",title:"dockeræä»¶å®è£zabbix5",date:"2022-12-20T16:08:39.000Z",permalink:"/pages/e0085e/",categories:["ä¸é¢","zabbix"],tags:[null]},{name:"zabbixéç½®ééåè­¦",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\01.zabbix\\04.zabbixéç½®ééåè­¦.md",wordsCount:353,readingTime:"1.8m",title:"zabbixéç½®ééåè­¦",date:"2022-12-20T16:16:02.000Z",permalink:"/pages/a4e3ce/",categories:["ä¸é¢","zabbix"],tags:[null]},{name:"zabbixæ·»å æ¥å¿çæ§",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\01.zabbix\\05.zabbixæ·»å æ¥å¿çæ§.md",wordsCount:"1.4k",readingTime:"6.3m",title:"zabbixæ·»å æ¥å¿çæ§",date:"2022-12-20T16:41:01.000Z",permalink:"/pages/334bec/",categories:["ä¸é¢","zabbix"],tags:[null]},{name:"zabbixæ·»å è¿ç¨pidçæ§",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\01.zabbix\\06.zabbixæ·»å è¿ç¨pidçæ§.md",wordsCount:405,readingTime:"2m",title:"zabbixæ·»å è¿ç¨pidçæ§",date:"2022-12-20T17:02:20.000Z",permalink:"/pages/20f905/",categories:["ä¸é¢","zabbix"],tags:[null]},{name:"zabbixçæ§windowsè¿ç¨",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\01.zabbix\\07.zabbixçæ§windowsè¿ç¨.md",wordsCount:972,readingTime:"3.7m",title:"zabbixçæ§windowsè¿ç¨",date:"2022-12-20T17:04:24.000Z",permalink:"/pages/269839/",categories:["ä¸é¢","zabbix"],tags:[null]},{name:"zabbixæ·»å webçæ§",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\01.zabbix\\08.zabbixæ·»å webçæ§.md",wordsCount:119,readingTime:"1",title:"zabbixæ·»å webçæ§",date:"2022-12-21T17:35:46.000Z",permalink:"/pages/b70eb8/",categories:["ä¸é¢","zabbix"],tags:[null]},{name:"centos7ç¼è¯å®è£zabbix proxyç«¯",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\01.zabbix\\09.centos7ç¼è¯å®è£zabbix proxyç«¯.md",wordsCount:737,readingTime:"3.5m",title:"centos7ç¼è¯å®è£zabbix5.0 proxyç«¯",date:"2023-03-01T14:31:52.000Z",permalink:"/pages/723e7e/",categories:["è¿ç»´","çæ§","zabbix"],tags:[null]},{name:"rpmå®è£zabbix proxyè¿ç¨ç®è®°",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\01.zabbix\\10.rpmå®è£zabbix proxyè¿ç¨ç®è®°.md",wordsCount:790,readingTime:"3.6m",title:"rpmå®è£zabbix proxyè¿ç¨ç®è®°",date:"2023-03-02T10:13:05.000Z",permalink:"/pages/ef347e/",categories:["è¿ç»´","çæ§","zabbix"],tags:[null]},{name:"prometheusçæ§ãåè­¦ä¸å­å¨",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\02.prometheus\\01.prometheusçæ§ãåè­¦ä¸å­å¨.md",wordsCount:"3.8k",readingTime:"18m",title:"prometheusçæ§ãåè­¦ä¸å­å¨",date:"2022-12-12T09:57:58.000Z",permalink:"/pages/40794d/",categories:["çæ§","prometheus"],tags:[null]},{name:"ä½¿ç¨docker-composeæ­å»ºpromethes+grafanaçæ§ç³»ç»",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\02.prometheus\\02.ä½¿ç¨docker-composeæ­å»ºpromethes+grafanaçæ§ç³»ç».md",wordsCount:"1.3k",readingTime:"7.2m",title:"ä½¿ç¨docker-composeæ­å»ºpromethes+grafanaçæ§ç³»ç»",date:"2023-01-09T14:26:28.000Z",permalink:"/pages/712f5c/",categories:["ä¸é¢","prometheus"],tags:[null]},{name:"prometheusæ·»å ééæ¶æ¯åè­¦",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\02.prometheus\\03.prometheusæ·»å ééæ¶æ¯åè­¦.md",wordsCount:517,readingTime:"2.8m",title:"prometheusæ·»å ééæ¶æ¯åè­¦",date:"2023-01-10T17:38:03.000Z",permalink:"/pages/22b836/",categories:["ä¸é¢","prometheus"],tags:[null]},{name:"alertmanagerå®ç°æä¸ªæ¶é´æ®µéé»æäºåè­¦é¡¹",filePath:"D:\\blog\\blog-master\\docs\\04.è¿ç»´\\12.çæ§\\02.prometheus\\04.alertmanagerå®ç°æä¸ªæ¶é´æ®µéé»æäºåè­¦é¡¹.md",wordsCount:"1.7k",readingTime:"8.8m",title:"alertmanagerå®ç°æä¸ªæ¶é´æ®µéé»æäºåè­¦é¡¹",date:"2023-01-11T11:40:32.000Z",permalink:"/pages/96c6ce/",categories:["ä¸é¢","prometheus"],tags:[null]},{name:"å³äº",filePath:"D:\\blog\\blog-master\\docs\\05.å³äº\\01.å³äº.md",wordsCount:39,readingTime:"1",title:"å³äº",date:"2022-12-15T13:14:01.000Z",permalink:"/about/",sidebar:!0,article:!1,description:null},{name:"åé¾",filePath:"D:\\blog\\blog-master\\docs\\06.åé¾\\01.åé¾.md",wordsCount:212,readingTime:"1",title:"åé¾",date:"2022-12-15T09:17:44.000Z",permalink:"/friends",categories:["åé¾"],tags:["friend"],description:null}],moutedEvent:".tags-wrapper",readingTime:!0,indexIteration:2500,pageIteration:2500},author:{name:"ç« å·¥è¿ç»´",link:"https://github.com/zpj874878956"},blogger:{avatar:"http://pic.zzppjj.top/LightPicture/2023/02/c7ac9de8fb6cfb17.jpg",name:"ç« å·¥è¿ç»´",slogan:"å¥½å¥½å­¦ä¹ ï¼å¤©å¤©åä¸"},social:{icons:[{iconClass:"icon-github",title:"GitHub",link:"https://github.com/zpj874878956"},{iconClass:"icon-youjian",title:"åé®ä»¶",link:"874878956@qq.com"},{iconClass:"icon-rss",title:"è®¢é",link:"https://blog.zzppjj.top/rss.xml"}]},htmlModules:{homeSidebarB:'<div style="padding: 0.95rem">\n      <p style="\n        color: var(--textColor);\n        opacity: 0.9;\n        font-size: 20px;\n        font-weight: bold;\n        margin: 0 0 8px 0;\n      ">å¬ä¼å·</p>\n      <img src="http://pic.zzppjj.top/LightPicture/2023/01/72a7c6cb076f44bc.jpg"  style="width:100%;" />\n      <p>\n      ç« å·¥è¿ç»´ï¼æ«ç æèæç´¢å³æ³¨\n      </p>\n      </div>',pageB:'<div class="donation">\n  <button>æèµ</button>\n  <div class="main">\n      <div class="pic">\n          <img src="http://pic.zzppjj.top/LightPicture/2023/02/cebf13bbcea9264d.jpg" alt="å¾®ä¿¡">\n          <img src="http://pic.zzppjj.top/LightPicture/2023/02/d98d15501306c7c4.jpg" alt="æ¯ä»å®">\n      </div>\n  </div>\n</div>'},footer:{createYear:2019,copyrightInfo:'| <a href="https://www.foreverblog.cn/" class="d-inline-block text-muted" target="_blank" rel="external nofollow"><img src="/img/964560013b68c2e4.png" alt="ç¹å»æ¥çåå¹´ä¹çº¦" style="width:auto;height:11px;">'}}};var kl=t(98),xl=t(99),wl=t(11);var El={computed:{$filterPosts(){return this.$site.pages.filter(n=>{const{frontmatter:{pageComponent:e,article:t,home:o}}=n;return!(e||!1===t||!0===o)})},$sortPosts(){return(n=this.$filterPosts).sort((n,e)=>{const t=n.frontmatter.sticky,o=e.frontmatter.sticky;return t&&o?t==o?Object(wl.a)(n,e):t-o:t&&!o?-1:!t&&o?1:Object(wl.a)(n,e)}),n;var n},$sortPostsByDate(){return(n=this.$filterPosts).sort((n,e)=>Object(wl.a)(n,e)),n;var n},$groupPosts(){return function(n){const e={},t={};for(let o=0,a=n.length;o<a;o++){const{frontmatter:{categories:a,tags:s}}=n[o];"array"===Object(wl.n)(a)&&a.forEach(t=>{t&&(e[t]||(e[t]=[]),e[t].push(n[o]))}),"array"===Object(wl.n)(s)&&s.forEach(e=>{e&&(t[e]||(t[e]=[]),t[e].push(n[o]))})}return{categories:e,tags:t}}(this.$sortPosts)},$categoriesAndTags(){return function(n){const e=[],t=[];for(let t in n.categories)e.push({key:t,length:n.categories[t].length});for(let e in n.tags)t.push({key:e,length:n.tags[e].length});return{categories:e,tags:t}}(this.$groupPosts)}}};Vt.component(kl.default),Vt.component(xl.default);function Al(n){return n.toString().padStart(2,"0")}t(247);Vt.component("BlockToggle",()=>Promise.all([t.e(0),t.e(4)]).then(t.bind(null,354))),Vt.component("WebInfo",()=>Promise.all([t.e(0),t.e(3)]).then(t.bind(null,352))),Vt.component("PageInfo",()=>t.e(7).then(t.bind(null,355))),Vt.component("CodeBlock",()=>Promise.resolve().then(t.bind(null,98))),Vt.component("Badge",()=>Promise.all([t.e(0),t.e(5)]).then(t.bind(null,490))),Vt.component("CodeGroup",()=>Promise.resolve().then(t.bind(null,99)));t(248);var zl=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},Bl=(n,e,t)=>(zl(n,e,"read from private field"),t?t.call(n):e.get(n)),Tl=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},Sl=(n,e,t,o)=>(zl(n,e,"write to private field"),o?o.call(n,t):e.set(n,t),t);var $l,jl;const Il=class{constructor(n,e,t,o=!0){Tl(this,$l,void 0),Tl(this,jl,void 0),Sl(this,$l,{width:0,height:0});const{el:a,ctx:s}=Il.initCanvas(n);this.el=a,this.ctx=s,Sl(this,jl,o),this.size={width:e||window.innerWidth,height:t||window.innerHeight}}get size(){return{...Bl(this,$l)}}set size({width:n,height:e}){var t;if(Bl(this,$l).width===n&&Bl(this,$l).height===e)return;Bl(this,$l).width=n,Bl(this,$l).height=e;const o=null!=(t=Bl(this,jl)?window.devicePixelRatio:1)?t:1;this.el.width=Math.round(Bl(this,$l).width*o),this.el.height=Math.round(Bl(this,$l).height*o),this.el.style.width=Bl(this,$l).width+"px",this.el.style.height=Bl(this,$l).height+"px",Bl(this,jl)&&this.ctx.scale(o,o)}clear(){Il.clearCanvas(this.ctx,{...Bl(this,$l)})}to(n){n.ctx.drawImage(this.el,0,0,Bl(this,$l).width,Bl(this,$l).height)}handleResize(n){this.size={width:window.innerWidth,height:window.innerHeight}}static setCanvasStyle(n,e,t){const o=n.style,{zIndex:a=0,opacity:s=1}=e;o.position="fixed",o.top="0",o.left="0",o.zIndex=a.toString(),o.width=(t?t.width:n.width).toString()+"px",o.height=(t?t.height:n.height).toString()+"px",1!==s&&(o.opacity=s.toString()),o.pointerEvents="none"}static initCanvas(n){n||(n=document.createElement("canvas"));const e=n.getContext("2d");return{el:n,ctx:e}}static createOffscreenCanvas(){return new Il}static clearCanvas(n,e){const{width:t,height:o}=e;n.clearRect(0,0,t,o)}};let Pl=Il;var Dl,Cl;$l=new WeakMap,jl=new WeakMap;class Rl{constructor(n,e,t,o=!0,a=!0,s={zIndex:0,opacity:1}){Tl(this,Dl,void 0),Tl(this,Cl,void 0),Sl(this,Dl,new Pl(n,e,t,o)),Pl.setCanvasStyle(Bl(this,Dl).el,s,{width:e,height:t}),Sl(this,Cl,a?new Pl(void 0,e,t,o):null)}get size(){return Bl(this,Dl).size}draw(n){var e;const t=null!=(e=Bl(this,Cl))?e:Bl(this,Dl);t.clear(),n(t.ctx,{...t.size})}render(){!Bl(this,Cl)||(Bl(this,Dl).clear(),Bl(this,Cl).to(Bl(this,Dl)))}handleResize(n){Bl(this,Dl).handleResize(n),Bl(this,Cl)&&Bl(this,Cl).handleResize(n)}clear(){Bl(this,Dl).clear(),Bl(this,Cl)&&Bl(this,Cl).clear()}}Dl=new WeakMap,Cl=new WeakMap;var Ol=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},Ll=(n,e,t)=>(Ol(n,e,"read from private field"),t?t.call(n):e.get(n));var Ml;class ql{constructor(){((n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)})(this,Ml,void 0),((n,e,t,o)=>{Ol(n,e,"write to private field"),o?o.call(n,t):e.set(n,t)})(this,Ml,new Map)}add(n,e,t=window){Ll(this,Ml).has(t)||Ll(this,Ml).set(t,new Map);const o=Ll(this,Ml).get(t);o.has(n)||o.set(n,new Set),o.get(n).add(e)}startAll(){for(const[n,e]of Ll(this,Ml))for(const[t,o]of e)for(const e of o)n.addEventListener(t,e)}stopAll(){for(const[n,e]of Ll(this,Ml))for(const[t,o]of e)for(const e of o)n.removeEventListener(t,e)}clear(){Ll(this,Ml).clear()}}function Nl(n){return!!n.touches}Ml=new WeakMap;class Fl{static randomFloat(n,e){return Math.random()*(e-n)+n}static randomInt(n,e){return Math.floor(Fl.randomFloat(n,e))}static choice(n){const e=n.length;return n[Math.floor(e*Math.random())]}static color(n="0123456789ABCDEF"){return"#"+Fl.choice(n)+Fl.choice(n)+Fl.choice(n)+Fl.choice(n)+Fl.choice(n)+Fl.choice(n)}}var Ul,Gl,Hl,Vl,Zl,Kl=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)},Wl=(n,e,t)=>(Kl(n,e,"read from private field"),t?t.call(n):e.get(n)),Yl=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},Xl=(n,e,t,o)=>(Kl(n,e,"write to private field"),o?o.call(n,t):e.set(n,t),t),Ql=(n,e,t)=>(Kl(n,e,"access private method"),t);class Jl{constructor(n,e,t,o,a){Yl(this,Ul,void 0),Yl(this,Gl,void 0),Yl(this,Hl,void 0),this.size=t,this.color=o,Xl(this,Hl,0),Xl(this,Ul,a),Xl(this,Gl,e),this.position={...n}}move(){this.position.x=Math.sin(Wl(this,Ul))*Wl(this,Gl)+this.position.x,this.position.y=Math.cos(Wl(this,Ul))*Wl(this,Gl)+this.position.y+.3*Wl(this,Hl),((n,e,t,o)=>({set _(o){Xl(n,e,o,t)},get _(){return Wl(n,e,o)}}))(this,Hl)._++}shouleRemove(n){return this.position.x<0||this.position.x>n.width||this.position.y>n.height}}Ul=new WeakMap,Gl=new WeakMap,Hl=new WeakMap;Vl=new WeakMap;class nc{static create(n,e,t,o,a,s){return new(this.shapeMap.get(n))(e,t,o,a,s)}}nc.shapeMap=new Map([["star",class extends Jl{constructor(n,e,t,o,a){super(n,e,t,o,a),Yl(this,Vl,0)}draw(n,e){n.fillStyle=this.color,n.beginPath();const t=2*this.size,o=this.size;for(let e=0;e<5;e++)n.lineTo(Math.cos((18+72*e-Wl(this,Vl))/180*Math.PI)*t+this.position.x,-Math.sin((18+72*e-Wl(this,Vl))/180*Math.PI)*t+this.position.y),n.lineTo(Math.cos((54+72*e-Wl(this,Vl))/180*Math.PI)*o+this.position.x,-Math.sin((54+72*e-Wl(this,Vl))/180*Math.PI)*o+this.position.y);n.fill(),Xl(this,Vl,Wl(this,Vl)+5)}}],["circle",class extends Jl{draw(n,e){n.fillStyle=this.color,n.beginPath(),n.arc(this.position.x,this.position.y,this.size,0,2*Math.PI),n.fill()}}]]);class ec{constructor(n,e,t,o){Yl(this,Zl,void 0),this.stopped=!1,Xl(this,Zl,new Set);for(let a=0;a<o;a++){const o=nc.create(n,e,Fl.randomFloat(1,6),t,Fl.color("89ABCDEF"),Fl.randomFloat(Math.PI-1,Math.PI+1));Wl(this,Zl).add(o)}}move(n){for(const e of Wl(this,Zl))e.shouleRemove(n)?Wl(this,Zl).delete(e):e.move();0===Wl(this,Zl).size&&(this.stopped=!0)}draw(n,e){for(const t of Wl(this,Zl))t.draw(n,e)}}Zl=new WeakMap;var tc,oc,ac,sc,rc,ic,lc,cc,pc,dc,mc,uc,hc,gc,bc,fc,yc,_c,vc,kc;class xc{constructor({shape:n="star",size:e=2,numParticles:t=10}={},o={}){Yl(this,pc),Yl(this,mc),Yl(this,hc),Yl(this,bc),Yl(this,yc),Yl(this,vc),Yl(this,tc,void 0),Yl(this,oc,void 0),Yl(this,ac,void 0),Yl(this,sc,null),Yl(this,rc,new Set),Yl(this,ic,!1),Yl(this,lc,void 0),Yl(this,cc,new ql),Xl(this,tc,n),Xl(this,oc,e),Xl(this,ac,t),Xl(this,lc,o),this.animate=this.animate.bind(this)}mount(n){Xl(this,sc,new Rl(n,window.innerWidth,window.innerHeight,!0,!0,Wl(this,lc))),Ql(this,pc,dc).call(this),function(n,{leftColor:e="#fff",rightColor:t="#444",leftBgColor:o="#35495e",rightBgColor:a="#00ffc0"}={}){console.log(`%c ${n} %c v0.5.2 112fa81 %c`,`background: ${o}; padding: 2px; color: ${e}; font-weight: bold; text-transform: uppercase;`,`background: ${a}; padding: 2px; color: ${t}; font-weight: bold; text-transform: uppercase;`,"background: transparent")}("Theme Popper ð",{leftBgColor:"#ffb366"})}unmount(){Ql(this,mc,uc).call(this),Xl(this,ic,!1)}animate(){if(Xl(this,ic,!0),0===Wl(this,rc).size)return Xl(this,ic,!1),void Wl(this,sc).clear();requestAnimationFrame(this.animate);for(const n of Wl(this,rc)){if(n.stopped)return void Wl(this,rc).delete(n);n.move(Wl(this,sc).size)}Wl(this,sc).draw((n,e)=>{for(const t of Wl(this,rc))t.draw(n,e)}),Wl(this,sc).render()}}tc=new WeakMap,oc=new WeakMap,ac=new WeakMap,sc=new WeakMap,rc=new WeakMap,ic=new WeakMap,lc=new WeakMap,cc=new WeakMap,pc=new WeakSet,dc=function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?Wl(this,cc).add("touchstart",Ql(this,hc,gc).bind(this)):Wl(this,cc).add("mousedown",Ql(this,hc,gc).bind(this)),Wl(this,cc).add("visibilitychange",Ql(this,yc,_c).bind(this)),Wl(this,cc).add("resize",function(n,e,t){var o,a,s;void 0===e&&(e=50),void 0===t&&(t={});var r=null!=(o=t.isImmediate)&&o,i=null!=(a=t.callback)&&a,l=t.maxWait,c=Date.now(),p=[];function d(){if(void 0!==l){var n=Date.now()-c;if(n+e>=l)return l-n}return e}var m=function(){var e=[].slice.call(arguments),t=this;return new Promise((function(o,a){var l=r&&void 0===s;if(void 0!==s&&clearTimeout(s),s=setTimeout((function(){if(s=void 0,c=Date.now(),!r){var o=n.apply(t,e);i&&i(o),p.forEach((function(n){return(0,n.resolve)(o)})),p=[]}}),d()),l){var m=n.apply(t,e);return i&&i(m),o(m)}p.push({resolve:o,reject:a})}))};return m.cancel=function(n){void 0!==s&&clearTimeout(s),p.forEach((function(e){return(0,e.reject)(n)})),p=[]},m}(Ql(this,bc,fc).bind(this),500)),Wl(this,cc).startAll()},mc=new WeakSet,uc=function(){Wl(this,cc).stopAll(),Wl(this,cc).clear()},hc=new WeakSet,gc=function(n){const e={x:Nl(n)?n.touches[0].clientX:n.clientX,y:Nl(n)?n.touches[0].clientY:n.clientY},t=new ec(Wl(this,tc),{...e},Wl(this,oc),Wl(this,ac));Wl(this,rc).add(t),Wl(this,ic)||Ql(this,vc,kc).call(this)},bc=new WeakSet,fc=function(n){Wl(this,sc).handleResize(n)},yc=new WeakSet,_c=function(n){Wl(this,rc).clear(),Xl(this,ic,!1)},vc=new WeakSet,kc=function(){requestAnimationFrame(this.animate)};var wc={name:"CursorEffects",data:()=>({popper:new xc({shape:"star",size:2},{opacity:1,zIndex:999999999})}),mounted(){this.popper.mount(this.$el)},beforeDestroy(){this.popper.unmount()}},Ec=Object(fl.a)(wc,(function(){return(0,this._self._c)("canvas",{attrs:{id:"vuepress-canvas-cursor"}})}),[],!1,null,null,null).exports,Ac={name:"ReadingProgress",data:()=>({readingTop:0,readingHeight:1,progressStyle:null,transform:void 0,running:!1}),watch:{$readingShow(){this.progressStyle=this.getProgressStyle(),this.$readingShow&&window.addEventListener("scroll",this.base)}},mounted(){this.transform=this.getTransform(),this.progressStyle=this.getProgressStyle(),this.$readingShow&&window.addEventListener("scroll",this.base)},beforeDestroy(){this.$readingShow&&window.removeEventListener("scroll",this.base)},methods:{base(){this.running||(this.running=!0,requestAnimationFrame(this.getReadingBase))},getReadingBase(){this.readingHeight=this.getReadingHeight()-this.getScreenHeight(),this.readingTop=this.getReadingTop(),this.progressStyle=this.getProgressStyle(),this.running=!1},getReadingHeight:()=>Math.max(document.body.scrollHeight,document.body.offsetHeight,0),getScreenHeight:()=>Math.max(window.innerHeight,document.documentElement.clientHeight,0),getReadingTop:()=>Math.max(window.pageYOffset,document.documentElement.scrollTop,0),getTransform(){const n=document.createElement("div");return["transform","-webkit-transform","-moz-transform","-o-transform","-ms-transform"].find(e=>e in n.style)||void 0},getProgressStyle(){const n=this.readingTop/this.readingHeight;switch(this.$readingShow){case"top":case"bottom":return this.transform?`${this.transform}: scaleX(${n})`:`width: ${100*n}%`;case"left":case"right":return this.transform?`${this.transform}: scaleY(${n})`:`height: ${100*n}%`;default:return null}}}},zc=(t(249),Object(fl.a)(Ac,(function(){var n=this._self._c;return n("ClientOnly",[this.$readingShow?n("div",{staticClass:"reading-progress",class:this.$readingShow},[n("div",{staticClass:"progress",style:this.progressStyle})]):this._e()])}),[],!1,null,"3640397f",null).exports),Bc={props:{color:{required:!1,default:"rgb(66, 185, 131)"}}},Tc=(t(250),Object(fl.a)(Bc,(function(){return(0,this._self._c)("div",{staticClass:"spinner",style:{background:this.color}})}),[],!1,null,"1bbcb91a",null).exports);const Sc={name:"Mermaid",props:{id:{type:String,required:!1,default:()=>"diagram_"+Date.now()},graph:{type:String,required:!1}},data:()=>({svg:void 0}),computed:{graphData(){return this.graph?this.graph:this.$slots.default[0].text}},render(n){return void 0===this.svg?n("Loading"):n("div",{class:["mermaid-diagram"],domProps:{innerHTML:this.svg,style:"width: 100%"}})},mounted(){t.e(144).then(t.t.bind(null,344,7)).then(n=>{n.initialize({startOnLoad:!0}),n.render(this.id,this.graphData,n=>{this.svg=n})})},components:{Loading:Tc}};t(251);var $c=t(97),jc=t.n($c),Ic=t(17);let Pc,Dc,Cc;var Rc;"valine"===(Rc="artalk")?t.e(148).then(t.t.bind(null,345,7)).then(n=>Dc=n.default):"gitalk"===Rc?Promise.all([t.e(0),t.e(146)]).then(t.t.bind(null,346,7)).then(()=>t.e(143).then(t.t.bind(null,347,7))).then(n=>Pc=n.default):"artalk"===Rc&&Promise.all([t.e(0),t.e(145)]).then(t.t.bind(null,348,7)).then(()=>Promise.all([t.e(0),t.e(147)]).then(t.t.bind(null,349,7))).then(()=>t.e(8).then(t.bind(null,350))).then(n=>Cc=n.default);function Oc(n,e){const t={};return Reflect.ownKeys(n).forEach(o=>{if("string"==typeof n[o])try{t[o]=jc.a.render(n[o],e)}catch(e){console.warn(`Comment config option error at key named "${o}"`),console.warn("More info: "+e.message),t[o]=n[o]}else t[o]=n[o]}),t}console.log(`Current frontend version is ${Ic.dependencies.artalk} , plugin version is ${Ic.name}@v${Ic.version} , more details:`,Ic.homepage);const Lc={gitalk:{render(n,e){const t=document.createElement("div");t.id=e;document.querySelector("main.page").appendChild(t);new Pc(Oc({server:"https://artalk.zzppjj.top",site:"zzppjj",disableEmotion:!1,disablePicture:!1,disablePreview:!1},{frontmatter:n})).render(e)},clear(n){const e=document.querySelector("#"+n);return e&&e.remove(),!0}},valine:{render(n,e){const t=document.createElement("div");t.id=e;document.querySelector("main.page").appendChild(t),new Dc({...Oc({server:"https://artalk.zzppjj.top",site:"zzppjj",disableEmotion:!1,disablePicture:!1,disablePreview:!1},{frontmatter:n}),el:"#"+e})},clear(n){const e=document.querySelector("#"+n);return e&&e.remove(),!0}},artalk:{render(n,e){const t=document.createElement("div");t.id=e;document.querySelector("main.page").appendChild(t),new Cc({el:"#"+e,pageKey:"",pageTitle:"",server:"https://artalk.zzppjj.top",site:"zzppjj"}),function(){const n=setInterval((function(){const e=document.querySelectorAll(".atk-plug-btn");e&&e.length>0&&(3===e.length?console.log("Artalkèªå¸¦å¾çå·²å¼å¯"):console.log("Artalkèªå¸¦å¾çå·²å³é­"),clearInterval(n))}),500)}()},clear(n){const e=document.querySelector("#"+n);return e&&e.remove(),!0}}},Mc="vuepress-plugin-vdoing-comment";let qc=null;function Nc(n){return Lc.artalk.clear(Mc)}function Fc(n){return!1!==n.comment&&!1!==n.comments}function Uc(n){clearTimeout(qc);if(document.querySelector("main.page"))return Lc.artalk.render(n,Mc);qc=setTimeout(()=>Uc(n),200)}var Gc={mounted(){qc=setTimeout(()=>{const n={to:{},from:{},...this.$frontmatter};Nc()&&Fc(n)&&Uc(n)},1e3),this.$router.afterEach((n,e)=>{if(n&&e&&n.path===e.path)return;const t={to:n,from:e,...this.$frontmatter};Nc()&&Fc(t)&&Uc(t)})}},Hc=Object(fl.a)(Gc,(function(){return(0,this._self._c)("div")}),[],!1,null,null,null).exports,Vc=[({Vue:n,options:e,router:t,siteData:o})=>{o.pages.map(n=>{const{frontmatter:{date:e,author:t}}=n;"string"==typeof e&&"Z"===e.charAt(e.length-1)&&(n.frontmatter.date=function(n){n instanceof Date||(n=new Date(n));return`${n.getUTCFullYear()}-${Al(n.getUTCMonth()+1)}-${Al(n.getUTCDate())} ${Al(n.getUTCHours())}:${Al(n.getUTCMinutes())}:${Al(n.getUTCSeconds())}`}(e)),t?n.author=t:o.themeConfig.author&&(n.author=o.themeConfig.author)}),n.mixin(El)},{},({Vue:n})=>{n.mixin({computed:{$dataBlock(){return this.$options.__data__block__}}})},{},{},({router:n})=>{"undefined"!=typeof window&&function(){var n=document.createElement("script"),e=window.location.protocol.split(":")[0];n.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(n,t)}()},({Vue:n})=>{n.component("CursorEffects",Ec)},({Vue:n})=>{n.component(zc.name,zc),n.mixin({computed:{$readingShow(){return this.$page.frontmatter.readingShow}}})},({router:n})=>{"undefined"!=typeof window&&(window._hmt=window._hmt||[],function(){var n=document.createElement("script");n.src="https://hm.baidu.com/hm.js?a2eb5aefa7df511c4cda2ae0aecea086";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)}(),n.afterEach((function(n){_hmt.push(["_trackPageview",n.fullPath])})))},({Vue:n})=>{n.component(Sc.name,Sc)},({Vue:n})=>{n.component("Comment",Hc)}],Zc=["CursorEffects","ReadingProgress","PageInfo","BlockToggle","Comment"];class Kc extends class{constructor(){this.store=new Vt({data:{state:{}}})}$get(n){return this.store.state[n]}$set(n,e){Vt.set(this.store.state,n,e)}$emit(...n){this.store.$emit(...n)}$on(...n){this.store.$on(...n)}}{}Object.assign(Kc.prototype,{getPageAsyncComponent:ri,getLayoutAsyncComponent:ii,getAsyncComponent:li,getVueComponent:ci});var Wc={install(n){const e=new Kc;n.$vuepress=e,n.prototype.$vuepress=e}};function Yc(n,e){const t=e.toLowerCase();return n.options.routes.some(n=>n.path.toLowerCase()===t)}var Xc={props:{pageKey:String,slotKey:{type:String,default:"default"}},render(n){const e=this.pageKey||this.$parent.$page.key;return di("pageKey",e),Vt.component(e)||Vt.component(e,ri(e)),Vt.component(e)?n(e):n("")}},Qc={functional:!0,props:{slotKey:String,required:!0},render:(n,{props:e,slots:t})=>n("div",{class:["content__"+e.slotKey]},t()[e.slotKey])},Jc={computed:{openInNewWindowTitle(){return this.$themeLocaleConfig.openNewWindowText||"(opens new window)"}}},np=(t(257),t(258),Object(fl.a)(Jc,(function(){var n=this._self._c;return n("span",[n("svg",{staticClass:"icon outbound",attrs:{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15"}},[n("path",{attrs:{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}}),this._v(" "),n("polygon",{attrs:{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"}})]),this._v(" "),n("span",{staticClass:"sr-only"},[this._v(this._s(this.openInNewWindowTitle))])])}),[],!1,null,null,null).exports),ep={functional:!0,render(n,{parent:e,children:t}){if(e._isMounted)return t;e.$once("hook:mounted",()=>{e.$forceUpdate()})}};Vt.config.productionTip=!1,Vt.use(Gr),Vt.use(Wc),Vt.mixin(function(n,e,t=Vt){!function(n){n.locales&&Object.keys(n.locales).forEach(e=>{n.locales[e].path=e});Object.freeze(n)}(e),t.$vuepress.$set("siteData",e);const o=new(n(t.$vuepress.$get("siteData"))),a=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(o)),s={};return Object.keys(a).reduce((n,e)=>(e.startsWith("$")&&(n[e]=a[e].get),n),s),{computed:s}}(n=>class{setPage(n){this.__page=n}get $site(){return n}get $themeConfig(){return this.$site.themeConfig}get $frontmatter(){return this.$page.frontmatter}get $localeConfig(){const{locales:n={}}=this.$site;let e,t;for(const o in n)"/"===o?t=n[o]:0===this.$page.path.indexOf(o)&&(e=n[o]);return e||t||{}}get $siteTitle(){return this.$localeConfig.title||this.$site.title||""}get $canonicalUrl(){const{canonicalUrl:n}=this.$page.frontmatter;return"string"==typeof n&&n}get $title(){const n=this.$page,{metaTitle:e}=this.$page.frontmatter;if("string"==typeof e)return e;const t=this.$siteTitle,o=n.frontmatter.home?null:n.frontmatter.title||n.title;return t?o?o+" | "+t:t:o||"VuePress"}get $description(){const n=function(n){if(n){const e=n.filter(n=>"description"===n.name)[0];if(e)return e.content}}(this.$page.frontmatter.meta);return n||(this.$page.frontmatter.description||this.$localeConfig.description||this.$site.description||"")}get $lang(){return this.$page.frontmatter.lang||this.$localeConfig.lang||"en-US"}get $localePath(){return this.$localeConfig.path||"/"}get $themeLocaleConfig(){return(this.$site.themeConfig.locales||{})[this.$localePath]||{}}get $page(){return this.__page?this.__page:function(n,e){for(let t=0;t<n.length;t++){const o=n[t];if(o.path.toLowerCase()===e.toLowerCase())return o}return{path:"",frontmatter:{}}}(this.$site.pages,this.$route.path)}},vl)),Vt.component("Content",Xc),Vt.component("ContentSlotsDistributor",Qc),Vt.component("OutboundLink",np),Vt.component("ClientOnly",ep),Vt.component("Layout",ii("Layout")),Vt.component("NotFound",ii("NotFound")),Vt.prototype.$withBase=function(n){const e=this.$site.base;return"/"===n.charAt(0)?e+n.slice(1):n},window.__VUEPRESS__={version:"1.9.9",hash:""},async function(n){const e="undefined"!=typeof window&&window.__VUEPRESS_ROUTER_BASE__?window.__VUEPRESS_ROUTER_BASE__:vl.routerBase||vl.base,t=new Gr({base:e,mode:"history",fallback:!1,routes:_l,scrollBehavior:(n,e,t)=>t||(n.hash?!Vt.$vuepress.$get("disableScrollBehavior")&&{selector:decodeURIComponent(n.hash)}:{x:0,y:0})});!function(n){n.beforeEach((e,t,o)=>{if(Yc(n,e.path))o();else if(/(\/|\.html)$/.test(e.path))if(/\/$/.test(e.path)){const t=e.path.replace(/\/$/,"")+".html";Yc(n,t)?o(t):o()}else o();else{const t=e.path+"/",a=e.path+".html";Yc(n,a)?o(a):Yc(n,t)?o(t):o()}})}(t);const o={};try{await Promise.all(Vc.filter(n=>"function"==typeof n).map(e=>e({Vue:Vt,options:o,router:t,siteData:vl,isServer:n})))}catch(n){console.error(n)}return{app:new Vt(Object.assign(o,{router:t,render:n=>n("div",{attrs:{id:"app"}},[n("RouterView",{ref:"layout"}),n("div",{class:"global-ui"},Zc.map(e=>n(e)))])})),router:t}}(!1).then(({app:n,router:e})=>{e.onReady(()=>{n.$mount("#app")})})}]);