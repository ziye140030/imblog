(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{391:function(e,t,_){"use strict";_.r(t);var v=_(0),s=Object(v.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"å¿«é€Ÿéƒ¨ç½²k8sé›†ç¾¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å¿«é€Ÿéƒ¨ç½²k8sé›†ç¾¤"}},[e._v("#")]),e._v(" å¿«é€Ÿéƒ¨ç½²k8sé›†ç¾¤")]),e._v(" "),t("p",[e._v("kubeadmæ˜¯å®˜æ–¹ç¤¾åŒºæ¨å‡ºçš„ä¸€ä¸ªç”¨äºå¿«é€Ÿéƒ¨ç½²kubernetesé›†ç¾¤çš„å·¥å…·ã€‚")]),e._v(" "),t("p",[e._v("è¿™ä¸ªå·¥å…·èƒ½é€šè¿‡ä¸¤æ¡æŒ‡ä»¤å®Œæˆä¸€ä¸ªkubernetesé›†ç¾¤çš„éƒ¨ç½²ï¼š")]),e._v(" "),t("p",[e._v("# åˆ›å»ºä¸€ä¸ª Master èŠ‚ç‚¹")]),e._v(" "),t("p",[e._v("$ kubeadm init")]),e._v(" "),t("p",[e._v("# å°†ä¸€ä¸ª Node èŠ‚ç‚¹åŠ å…¥åˆ°å½“å‰é›†ç¾¤ä¸­")]),e._v(" "),t("p",[e._v("$ kubeadm join <MasterèŠ‚ç‚¹çš„IPå’Œç«¯å£ >")]),e._v(" "),t("h2",{attrs:{id:"_1-å®‰è£…è¦æ±‚"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-å®‰è£…è¦æ±‚"}},[e._v("#")]),e._v(" 1. å®‰è£…è¦æ±‚")]),e._v(" "),t("p",[e._v("åœ¨å¼€å§‹ä¹‹å‰ï¼Œéƒ¨ç½²Kubernetesé›†ç¾¤æœºå™¨éœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š")]),e._v(" "),t("ul",[t("li",[e._v("ä¸€å°æˆ–å¤šå°æœºå™¨ï¼Œæ“ä½œç³»ç»Ÿ CentOS7.x-86_x64")]),e._v(" "),t("li",[e._v("ç¡¬ä»¶é…ç½®ï¼š2GBæˆ–æ›´å¤šRAMï¼Œ2ä¸ªCPUæˆ–æ›´å¤šCPUï¼Œç¡¬ç›˜30GBæˆ–æ›´å¤š")]),e._v(" "),t("li",[e._v("å¯ä»¥è®¿é—®å¤–ç½‘ï¼Œéœ€è¦æ‹‰å–é•œåƒï¼Œå¦‚æœæœåŠ¡å™¨ä¸èƒ½ä¸Šç½‘ï¼Œéœ€è¦æå‰ä¸‹è½½é•œåƒå¹¶å¯¼å…¥èŠ‚ç‚¹")]),e._v(" "),t("li",[e._v("ç¦æ­¢swapåˆ†åŒº")])]),e._v(" "),t("h2",{attrs:{id:"_2-å‡†å¤‡ç¯å¢ƒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-å‡†å¤‡ç¯å¢ƒ"}},[e._v("#")]),e._v(" 2. å‡†å¤‡ç¯å¢ƒ")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("è§’è‰²")]),e._v(" "),t("th",[e._v("IP")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("master")]),e._v(" "),t("td",[e._v("192.168.1.11")])]),e._v(" "),t("tr",[t("td",[e._v("node1")]),e._v(" "),t("td",[e._v("192.168.1.12")])]),e._v(" "),t("tr",[t("td",[e._v("node2")]),e._v(" "),t("td",[e._v("192.168.1.13")])])])]),e._v(" "),t("p",[e._v("# å…³é—­é˜²ç«å¢™")]),e._v(" "),t("p",[e._v("systemctl stop firewalld")]),e._v(" "),t("p",[e._v("systemctl disable firewalld")]),e._v(" "),t("p",[e._v("# å…³é—­selinux")]),e._v(" "),t("p",[e._v("sed -i 's/enforcing/disabled/' /etc/selinux/config  # æ°¸ä¹…")]),e._v(" "),t("p",[e._v("setenforce 0  # ä¸´æ—¶")]),e._v(" "),t("p",[e._v("# å…³é—­swap")]),e._v(" "),t("p",[e._v("swapoff -a  # ä¸´æ—¶")]),e._v(" "),t("p",[e._v("sed -ri 's/."),t("em",[e._v("swap.")]),e._v("/#&/' /etc/fstab   # æ°¸ä¹…")]),e._v(" "),t("p",[e._v("# æ ¹æ®è§„åˆ’è®¾ç½®ä¸»æœºå")]),e._v(" "),t("p",[e._v("hostnamectl set-hostname "),t("hostname")],1),e._v(" "),t("p",[e._v("# åœ¨masteræ·»åŠ hosts")]),e._v(" "),t("p",[e._v("cat >> /etc/hosts << EOF")]),e._v(" "),t("p",[e._v("192.168.44.146 k8smaster")]),e._v(" "),t("p",[e._v("192.168.44.145 k8snode1")]),e._v(" "),t("p",[e._v("192.168.44.144 k8snode2")]),e._v(" "),t("p",[e._v("EOF")]),e._v(" "),t("p",[e._v("# å°†æ¡¥æ¥çš„IPv4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾")]),e._v(" "),t("p",[e._v("cat > /etc/sysctl.d/k8s.conf << EOF")]),e._v(" "),t("p",[e._v("net.bridge.bridge-nf-call-ip6tables = 1")]),e._v(" "),t("p",[e._v("net.bridge.bridge-nf-call-iptables = 1")]),e._v(" "),t("p",[e._v("EOF")]),e._v(" "),t("p",[e._v("sysctl --system  # ç”Ÿæ•ˆ")]),e._v(" "),t("p",[e._v("# æ—¶é—´åŒæ­¥")]),e._v(" "),t("p",[e._v("yum install ntpdate -y")]),e._v(" "),t("p",[e._v("ntpdate time.windows.com")]),e._v(" "),t("h2",{attrs:{id:"_3-æ‰€æœ‰èŠ‚ç‚¹å®‰è£…docker-kubeadm-kubelet"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-æ‰€æœ‰èŠ‚ç‚¹å®‰è£…docker-kubeadm-kubelet"}},[e._v("#")]),e._v(" 3. æ‰€æœ‰èŠ‚ç‚¹å®‰è£…Docker/kubeadm/kubelet")]),e._v(" "),t("p",[e._v("Kubernetesé»˜è®¤CRIï¼ˆå®¹å™¨è¿è¡Œæ—¶ï¼‰ä¸ºDockerï¼Œå› æ­¤å…ˆå®‰è£…Dockerã€‚")]),e._v(" "),t("h3",{attrs:{id:"_3-1-å®‰è£…docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-å®‰è£…docker"}},[e._v("#")]),e._v(" 3.1 å®‰è£…Docker")]),e._v(" "),t("p",[e._v("$ wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo")]),e._v(" "),t("p",[e._v("$ yum -y install docker-ce-18.06.1.ce-3.el7")]),e._v(" "),t("p",[e._v("$ systemctl enable docker && systemctl start docker")]),e._v(" "),t("p",[e._v("$ docker --version")]),e._v(" "),t("p",[e._v("Docker version 18.06.1-ce, build e68fc7a")]),e._v(" "),t("p",[e._v("$ cat > /etc/docker/daemon.json << EOF")]),e._v(" "),t("p",[e._v("{")]),e._v(" "),t("p",[e._v('"registry-mirrors": ["https://b9pmyelo.mirror.aliyuncs.com"]')]),e._v(" "),t("p",[e._v("}")]),e._v(" "),t("p",[e._v("EOF")]),e._v(" "),t("h3",{attrs:{id:"_3-2-æ·»åŠ é˜¿é‡Œäº‘yumè½¯ä»¶æº"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-æ·»åŠ é˜¿é‡Œäº‘yumè½¯ä»¶æº"}},[e._v("#")]),e._v(" 3.2 æ·»åŠ é˜¿é‡Œäº‘YUMè½¯ä»¶æº")]),e._v(" "),t("p",[e._v("$ cat > /etc/yum.repos.d/kubernetes.repo << EOF")]),e._v(" "),t("p",[e._v("[kubernetes]")]),e._v(" "),t("p",[e._v("name=Kubernetes")]),e._v(" "),t("p",[e._v("baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64")]),e._v(" "),t("p",[e._v("enabled=1")]),e._v(" "),t("p",[e._v("gpgcheck=0")]),e._v(" "),t("p",[e._v("repo_gpgcheck=0")]),e._v(" "),t("p",[e._v("gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg")]),e._v(" "),t("p",[e._v("EOF")]),e._v(" "),t("h3",{attrs:{id:"_3-3-å®‰è£…kubeadm-kubeletå’Œkubectl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-å®‰è£…kubeadm-kubeletå’Œkubectl"}},[e._v("#")]),e._v(" 3.3 å®‰è£…kubeadmï¼Œkubeletå’Œkubectl")]),e._v(" "),t("p",[e._v("ç”±äºç‰ˆæœ¬æ›´æ–°é¢‘ç¹ï¼Œè¿™é‡ŒæŒ‡å®šç‰ˆæœ¬å·éƒ¨ç½²ï¼š")]),e._v(" "),t("p",[e._v("$ yum install -y kubelet-1.18.0 kubeadm-1.18.0 kubectl-1.18.0")]),e._v(" "),t("p",[e._v("$ systemctl enable kubelet")]),e._v(" "),t("h2",{attrs:{id:"_4-éƒ¨ç½²kubernetes-master"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-éƒ¨ç½²kubernetes-master"}},[e._v("#")]),e._v(" 4. éƒ¨ç½²Kubernetes Master")]),e._v(" "),t("p",[e._v("åœ¨192.168.1.11ï¼ˆMasterï¼‰æ‰§è¡Œã€‚")]),e._v(" "),t("p",[e._v("$ kubeadm init \\")]),e._v(" "),t("p",[e._v("--apiserver-advertise-address=192.168.31.61 \\")]),e._v(" "),t("p",[e._v("--image-repository registry.aliyuncs.com/google_containers \\")]),e._v(" "),t("p",[e._v("--kubernetes-version v1.18.0 \\")]),e._v(" "),t("p",[e._v("--service-cidr=10.96.0.0/12 \\")]),e._v(" "),t("p",[e._v("--pod-network-cidr=10.244.0.0/16")]),e._v(" "),t("p",[e._v("ç”±äºé»˜è®¤æ‹‰å–é•œåƒåœ°å€k8s.gcr.ioå›½å†…æ— æ³•è®¿é—®ï¼Œè¿™é‡ŒæŒ‡å®šé˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€ã€‚")]),e._v(" "),t("p",[e._v("ä½¿ç”¨kubectlå·¥å…·ï¼š")]),e._v(" "),t("p",[e._v("mkdir -p $HOME/.kube")]),e._v(" "),t("p",[e._v("sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config")]),e._v(" "),t("p",[e._v("sudo chown $(id -u)ğŸ˜’(id -g) $HOME/.kube/config")]),e._v(" "),t("p",[e._v("$ kubectl get nodes")]),e._v(" "),t("h2",{attrs:{id:"_5-åŠ å…¥kubernetes-node"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-åŠ å…¥kubernetes-node"}},[e._v("#")]),e._v(" 5. åŠ å…¥Kubernetes Node")]),e._v(" "),t("p",[e._v("åœ¨192.168.1.12/13ï¼ˆNodeï¼‰æ‰§è¡Œã€‚")]),e._v(" "),t("p",[e._v("å‘é›†ç¾¤æ·»åŠ æ–°èŠ‚ç‚¹ï¼Œæ‰§è¡Œåœ¨kubeadm initè¾“å‡ºçš„kubeadm joinå‘½ä»¤ï¼š")]),e._v(" "),t("p",[e._v("$ kubeadm join 192.168.1.11:6443 --token esce21.q6hetwm8si29qxwn \\")]),e._v(" "),t("p",[e._v("--discovery-token-ca-cert-hash sha256:00603a05805807501d7181c3d60b478788408cfe6cedefedb1f97569708be9c5")]),e._v(" "),t("p",[e._v("é»˜è®¤tokenæœ‰æ•ˆæœŸä¸º24å°æ—¶ï¼Œå½“è¿‡æœŸä¹‹åï¼Œè¯¥tokenå°±ä¸å¯ç”¨äº†ã€‚è¿™æ—¶å°±éœ€è¦é‡æ–°åˆ›å»ºtokenï¼Œæ“ä½œå¦‚ä¸‹ï¼š")]),e._v(" "),t("p",[e._v("kubeadm token create --print-join-command")]),e._v(" "),t("h2",{attrs:{id:"_6-éƒ¨ç½²cniç½‘ç»œæ’ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-éƒ¨ç½²cniç½‘ç»œæ’ä»¶"}},[e._v("#")]),e._v(" 6. éƒ¨ç½²CNIç½‘ç»œæ’ä»¶")]),e._v(" "),t("p",[e._v("wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml")]),e._v(" "),t("p",[e._v("é»˜è®¤é•œåƒåœ°å€æ— æ³•è®¿é—®ï¼Œsedå‘½ä»¤ä¿®æ”¹ä¸ºdocker hubé•œåƒä»“åº“ã€‚")]),e._v(" "),t("p",[e._v("kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml")]),e._v(" "),t("p",[e._v("kubectl get pods -n kube-system")]),e._v(" "),t("p",[e._v("NAME              READY  STATUS   RESTARTS  AGE")]),e._v(" "),t("p",[e._v("kube-flannel-ds-amd64-2pc95  1/1   Running  0      72s")]),e._v(" "),t("h2",{attrs:{id:"_7-æµ‹è¯•kubernetesé›†ç¾¤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-æµ‹è¯•kubernetesé›†ç¾¤"}},[e._v("#")]),e._v(" 7. æµ‹è¯•kubernetesé›†ç¾¤")]),e._v(" "),t("p",[e._v("åœ¨Kubernetesé›†ç¾¤ä¸­åˆ›å»ºä¸€ä¸ªpodï¼ŒéªŒè¯æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š")]),e._v(" "),t("p",[e._v("$ kubectl create deployment nginx --image=nginx")]),e._v(" "),t("p",[e._v("$ kubectl expose deployment nginx --port=80 --type=NodePort")]),e._v(" "),t("p",[e._v("$ kubectl get pod,svc")]),e._v(" "),t("p",[e._v("è®¿é—®åœ°å€ï¼šhttp://NodeIP:Port")])])}),[],!1,null,null,null);t.default=s.exports}}]);